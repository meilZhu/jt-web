// @<COPYRIGHT>@
// ==================================================
// Copyright 2016.
// Siemens Product Lifecycle Management Software Inc.
// All Rights Reserved.
// ==================================================
// @<COPYRIGHT>@ 

/// <summary>
/// Namespace declaration.
/// </summary>
JT2GoOfficeApp = {
     PRODUCT: 'JT2GoOfficeApp',
     VERSION: '1.0.0',
     COPYRIGHT: 'Copyright 2016 Siemens Product Lifecycle Management Software Inc., All Rights Reserved.'
};

            //Â© 2016 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PLMVisWeb=t():e.PLMVisWeb=t()}(window,function(){/******/
return function(e){// webpackBootstrap
/******/ // The module cache
/******/var t={};
/******/
/******/ // The require function
/******/function __webpack_require__(n){
/******/
/******/ // Check if module is in cache
/******/if(t[n])
/******/return t[n].exports;
/******/
/******/ // Create a new module (and put it into the cache)
/******/var r=t[n]={
/******/i:n,
/******/l:!1,
/******/exports:{}
/******/};
/******/
/******/ // Execute the module function
/******/
/******/
/******/ // Return the exports of the module
/******/return e[n].call(r.exports,r,r.exports,__webpack_require__),
/******/
/******/ // Flag the module as loaded
/******/r.l=!0,r.exports;
/******/}
/******/
/******/
/******/ // expose the modules object (__webpack_modules__)
/******/
/******/
/******/
/******/ // Load entry module and return exports
/******/return __webpack_require__.m=e,
/******/
/******/ // expose the module cache
/******/__webpack_require__.c=t,
/******/
/******/ // define getter function for harmony exports
/******/__webpack_require__.d=function(e,t,n){
/******/__webpack_require__.o(e,t)||
/******/Object.defineProperty(e,t,{
/******/configurable:!1,
/******/enumerable:!0,
/******/get:n
/******/})
/******/},
/******/
/******/ // define __esModule on exports
/******/__webpack_require__.r=function(e){
/******/Object.defineProperty(e,"__esModule",{value:!0});
/******/},
/******/
/******/ // getDefaultExport function for compatibility with non-harmony modules
/******/__webpack_require__.n=function(e){
/******/var t=e&&e.__esModule?
/******/function getDefault(){return e.default}:
/******/function getModuleExports(){return e};
/******/
/******/return __webpack_require__.d(t,"a",t),t;
/******/},
/******/
/******/ // Object.prototype.hasOwnProperty.call
/******/__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},
/******/
/******/ // __webpack_public_path__
/******/__webpack_require__.p="./",__webpack_require__(__webpack_require__.s=141);
/******/}
/************************************************************************/
/******/([
/* 0 */
/***/function(e,t,n){"use strict";
// EXTERNAL MODULE: ./node_modules/three/build/three.module.js
var r=n(1),i=n(9),a=n(6),o=n(2),s=n(5),l=function(e,t,n){n=n||2;var r,i,a,o,s,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=linkedList(e,0,h,n,!0),p=[];if(!d)return p;
// if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox
if(u&&(d=
// link every hole into the outer loop, producing a single-ring polygon without holes
function eliminateHoles(e,t,n,r){var i,a,o,s,l,c=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(l=linkedList(e,o,s,r,!1))&&(l===l.next&&(l.steiner=!0),c.push(getLeftmost(l)));
// process holes from left to right
for(c.sort(compareX),i=0;i<c.length;i++)eliminateHole(c[i],n),n=filterPoints(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var f=n;f<h;f+=n)s=e[f],l=e[f+1],s<r&&(r=s),l<i&&(i=l),s>a&&(a=s),l>o&&(o=l);
// minX, minY and invSize are later used to transform coords into integers for z-order calculation
c=0!==(c=Math.max(a-r,o-i))?1/c:0}return earcutLinked(d,p,n,r,i,c),p};
// EXTERNAL MODULE: ./staging/InstancedShaderMaterial.js
// create a circular doubly linked list from polygon points in the specified winding order
function linkedList(e,t,n,r,i){var a,o;if(i===function signedArea(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}
// EXTERNAL MODULE: ./staging/ThreeExtensions/lines/LineMaterial.js
(e,t,n,r)>0)for(a=t;a<n;a+=r)o=insertNode(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=insertNode(a,e[a],e[a+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}
// eliminate colinear or duplicate points
function filterPoints(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!equals(r,r.next)&&0!==Earcut_area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}
// main ear slicing loop which triangulates a polygon (given as a linked list)
function earcutLinked(e,t,n,r,i,a,o){if(e){
// interlink polygon nodes in z-order
!o&&a&&
// interlink polygon nodes in z-order
function indexCurve(e,t,n,r){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,
// Simon Tatham's linked list merge sort algorithm
// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html
function sortLinked(e){var t,n,r,i,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,c*=2}while(o>1);return e}
// z-order of a point given coords and inverse of the longer side of data bbox
(i)}(e,r,i,a);
// iterate through ears, slicing them one by one
for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?isEarHashed(e,r,i,a):isEar(e))
// cut off the triangle
t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),removeNode(e),
// skipping the next vertice leads to less sliver triangles
e=l.next,c=l.next;else
// if we looped through the whole remaining polygon and can't find any more ears
if((e=l)===c){
// try filtering points and slicing again
o?1===o?earcutLinked(e=cureLocalIntersections(e,t,n),t,n,r,i,a,2):2===o&&splitEarcut(e,t,n,r,i,a):earcutLinked(filterPoints(e),t,n,r,i,a,1);break}}}
// check whether a polygon node forms a valid ear with adjacent nodes
function isEar(e){var t=e.prev,n=e,r=e.next;if(Earcut_area(t,n,r)>=0)return!1;// reflex, can't be an ear
// now make sure we don't have other points inside the potential ear
for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Earcut_area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,t,n,r){var i=e.prev,a=e,o=e.next;if(Earcut_area(i,a,o)>=0)return!1;// reflex, can't be an ear
// triangle bbox; min & max are calculated like this for speed
for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=zOrder(s,l,t,n,r),d=zOrder(c,u,t,n,r),p=e.nextZ
// z-order range for the current triangle bbox;
;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Earcut_area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}
// then look for points in decreasing z-order
for(p=e.prevZ;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Earcut_area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}
// go through all polygon nodes and cure small local self-intersections
function cureLocalIntersections(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!equals(i,a)&&Earcut_intersects(i,r,r.next,a)&&locallyInside(i,a)&&locallyInside(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),
// remove two nodes involved
removeNode(r),removeNode(r.next),r=e=a),r=r.next}while(r!==e);return r}
// try splitting polygon into two and triangulate them independently
function splitEarcut(e,t,n,r,i,a){
// look for a valid diagonal that divides the polygon into two
var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){
// split the polygon in two by the diagonal
var l=splitPolygon(o,s);
// filter colinear points around the cuts
return o=filterPoints(o,o.next),l=filterPoints(l,l.next),
// run earcut on each half
earcutLinked(o,t,n,r,i,a),void earcutLinked(l,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function compareX(e,t){return e.x-t.x}
// find a bridge between vertices that connects hole with an outer ring and and link it
function eliminateHole(e,t){if(t=
// David Eberly's algorithm for finding a bridge between hole and outer polygon
function findHoleBridge(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;
// find a segment intersected by a ray from the hole's leftmost point to the left;
// segment's endpoint with lesser x will be potential connection point
do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n.prev;// hole touches outer segment; pick lower endpoint
// look for points inside the triangle of hole point, segment intersection and endpoint;
// if there are no points found, we have a valid connection;
// otherwise choose the point of the minimum angle with the ray as connection point
var l,c=n,u=n.x,h=n.y,d=1/0;r=n.next;for(;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&pointInTriangle(a<h?i:o,a,u,h,a<h?o:i,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&locallyInside(r,e)&&(n=r,d=l),r=r.next;return n}(e,t)){var n=splitPolygon(t,e);filterPoints(n,n.next)}}function zOrder(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((
// coords are transformed into non-negative 15-bit integer range
e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}
// find the leftmost node of a polygon ring
function getLeftmost(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}
// check if a point lies within a convex triangle
function pointInTriangle(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}
// check if a diagonal between two polygon nodes is valid (lies in polygon interior)
function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!
// check if a polygon diagonal intersects any polygon segments
function intersectsPolygon(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Earcut_intersects(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}
// check if a polygon diagonal is locally inside the polygon
(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&
// check if the middle point of a polygon diagonal is inside the polygon
function middleInside(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}
// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;
// if one belongs to the outer ring and another to a hole, it merges it into a single ring
(e,t)}
// signed area of a triangle
function Earcut_area(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}
// check if two points are equal
function equals(e,t){return e.x===t.x&&e.y===t.y}
// check if two segments intersect
function Earcut_intersects(e,t,n,r){return!!(equals(e,t)&&equals(n,r)||equals(e,r)&&equals(n,t))||Earcut_area(e,t,n)>0!=Earcut_area(e,t,r)>0&&Earcut_area(n,r,e)>0!=Earcut_area(n,r,t)>0}function locallyInside(e,t){return Earcut_area(e.prev,e,e.next)<0?Earcut_area(e,t,e.next)>=0&&Earcut_area(e,e.prev,t)>=0:Earcut_area(e,t,e.prev)<0||Earcut_area(e,e.next,t)<0}function splitPolygon(e,t){var n=new Node(e.i,e.x,e.y),r=new Node(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}
// create a node and optionally link it with previous one (in a circular doubly linked list)
function insertNode(e,t,n,r){var i=new Node(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,n){
// vertice index in coordinates array
this.i=e,
// vertex coordinates
this.x=t,this.y=n,
// previous and next vertice nodes in a polygon ring
this.prev=null,this.next=null,
// z-order curve value
this.z=null,
// previous and next nodes in z-order
this.prevZ=null,this.nextZ=null,
// indicates whether this is a steiner point
this.steiner=!1}var c=n(10);
// CONCATENATED MODULE: ./staging/Utilities.js
/* harmony export (binding) */n.d(t,"a",function(){return K});var u=null,h=null,d=6,p=4,f=null,m=function(e,t){var n="number"==typeof e;if(!n&&t)throw new TypeError("Expecting a number value.");return n},g=function(e,t){var n="string"==typeof e;if(!n&&t)throw new TypeError("Expecting a string value.");return n},v=function(e,t){var n=e instanceof Function;if(!n&&t)throw new TypeError("Expecting a function value.");return n},y=function(e){if(null==h){var t=e.href,n=t.substring(0,t.lastIndexOf("/"));h=n+"/",h=e.protocol+"//"+e.host+"/"}return h},b=function(){for(var e=arguments,t="",n=!0,r=0,i=e.length;r<i;r++)t+=n?e[r]:"/"+e[r],n=void 0!==e[r]&&e[r].lastIndexOf("/")===e[r].length-1;return t},x=function(e){if(/^http/i.test(e))return e;if(0===e.indexOf("/"))return y(location)+e.substring(1);var t=function(e){if(null==u){var t=e.href,n=t.indexOf("#");n>=1&&(t=t.substring(0,n));var r=t.substring(0,t.lastIndexOf("/"));u=r+"/"}return u}(location).split("/"),n=e.split("/");t=t.filter(Boolean);for(var r=0;r<n.length;r++)"."!==n[r]&&(".."===n[r]?t.pop():t.push(n[r]));var i=t.join("/");return-1===i.indexOf("://")&&(i=i.replace(/:\//,"://")),-1!==i.indexOf("android_asset")&&i.indexOf(!0)&&(i=i.replace(/:\//,"://")),i},_=function(e,t,n){return n=n||1e-6,Math.abs(e-t)<=n},w=function(e){var t=1;switch(e){case o.E.MICROMETER:t=.01;break;case o.E.CENTIMETER:t=10;break;case o.E.DECIMETER:t=100;break;case o.E.UNKNOWN:case o.E.METER:t=1e3;break;case o.E.KILOMETER:t=1e6;break;case o.E.INCH:t=25.4;break;case o.E.FEET:t=304.8;break;case o.E.YARD:t=914.4;break;case o.E.MILE:t=1609344;break;case o.E.MIL:t=.0254;break;default:t=1}return t},M=function(e,t){return e<<5+e^t},E=function(){var e=new r.Matrix4;return function(t,n,i,a){var o=a.offsetWidth>0?a.offsetWidth:1,s=a.offsetHeight>0?a.offsetHeight:1,l=new r.Vector3(t.x/o*2-1,1-t.y/s*2,0),c=new r.Vector3(n.x/o*2-1,1-n.y/s*2,0);return e.multiplyMatrices(i.matrixWorld,e.getInverse(i.projectionMatrix)),l.applyMatrix4(e),c.applyMatrix4(e),c.sub(l),c}}(),S=function(){var e=new r.Vector3,t=new r.Vector3,n=new r.Matrix4,i=2*Math.sqrt(2);return function(r,a){var o=a.offsetWidth>0?a.offsetWidth:1,s=a.offsetHeight>0?a.offsetHeight:1,l=i/(o+s);return n.multiplyMatrices(r.matrixWorld,n.getInverse(r.projectionMatrix)),e.set(0,0,0),e.applyMatrix4(n),t.set(l,l,0),t.applyMatrix4(n),e.sub(t).length()}}(),L=function(e,t){if(void 0!==e&&null!==e&&e.visible)if(e instanceof r.Mesh||e instanceof r.Line||e instanceof r.PointCloud)null===e.geometry.boundingBox&&e.geometry.computeBoundingBox(),(n=e.geometry.boundingBox.clone()).applyMatrix4(e.matrixWorld),t.union(n);else if("Part"===e.type||"Body"===e.type){var n;if(e.boundingBox&&!e.isAssembly&&e.shapes&&e.shapes.length>0)(n=e.boundingBox.clone()).applyMatrix4(e.matrixWorld),t.union(n);else for(var i=e.children.length,a=0;a<i;++a)L(e.children[a],t)}else for(i=e.children.length,a=0;a<i;++a)L(e.children[a],t)},T=function(e,t){if(void 0!==e&&null!==e)if(e instanceof r.Mesh||e instanceof r.Line||e instanceof r.Points){if(e.geometry){if(e.geometry.unmodifiedGroups&&delete e.geometry.unmodifiedGroups,e.geometry.xtBodies){for(var n in e.geometry.xtBodies)if(e.geometry.xtBodies[n]){var i=e.geometry.xtBodies[n];i.manifoldEdgeMap&&delete i.manifoldEdgeMap,delete e.geometry.xtBodies[n]}delete e.geometry.xtBodies}e.geometry.dispose()}if(e.material){var a=!e.material.isGlobal;if(!0!==t&&a&&void 0!==e.material.instanceCount&&(a=0===e.material.instanceCount),a)if(Array.isArray(e.material))for(var o=0,s=e.material.length;o<s;++o)e.material[o]&&e.material[o].dispose();else e.material.dispose();e=null}}else if(void 0!==e.children)for(;e.children.length>0;)T(e.children[0]),e.remove(e.children[0])},A=function(e){if(void 0!==e&&null!==e){if(void 0!==e.children){for(var t=e.children.length,n=0;n<t;++n)A(e.children[n]);delete e.children}for(var r=Object.keys(e),i=r.length,a=0;a<i;++a)delete e[r[a]];e=null}},C=function(e){return!isNaN(e)&&e>0&&(p=e,!0)},P=function(){return p},I=function(e){return!isNaN(e)&&e>0&&(d=e,!0)},O=function(){return d},B=function(){var e=new r.Vector3,t={};return function(n,i,s,l,c,u,h,m,g){if(null!=h&&void 0!==h||(h=o.x.FREE),null!=m&&void 0!==m||(m=!1),void 0===n||void 0===i||!u)return null;e.set(n/s.offsetWidth*2-1,1-i/s.offsetHeight*2,1),null===f&&(f=new a.a(new r.Vector3,new r.Vector3,0,2e32)),f.linePrecision=p,f.params.Points.threshold=d;var v=l.pixelScale;v||(v=S(u,s)),v=Math.max(v,.001*l.modelBoundingSphere.radius),f.linePrecision*=v,f.params.Points.threshold*=v,f.setFromCamera(e,u),t.pickingMode=h,t.spriteOnly=m,t.sectionOnly=g;var y=l.search(f);if(!y||0===y.length)return null;if(c){var b=c.search(f);y.push.apply(y,b)}return f.intersectOctreeObjects(y,t)}}(),R=new r.Sphere,G=function(e,t,n,a,o){null==n&&(n=1),null==a&&(a=!1),null==o&&(o=!1);var l=m(t)?t:1;l=Math.max(Math.min(l,1),0);var c=r.UniformsUtils.clone(s.c.lineSection.uniforms);c.diffuse.value.setHex(e),c.opacity.value=l;var u={fragmentShader:s.c.lineSection.fragmentShader,vertexShader:s.c.lineSection.vertexShader,uniforms:c,lights:!1,fog:!1,linewidth:n,blending:r.NoBlending,clipping:o,transparent:c.opacity.value<1,opacity:c.opacity.value},h=new i.a(u);return h.isInstanced=a,h},D=function(e,t,n,a){null==t&&(t=1),null==n&&(n=!1),null==a&&(a=!1);var o=r.UniformsUtils.clone(s.c.hiddenLineSection.uniforms);o.opacity.value=e;var l={fragmentShader:s.c.hiddenLineSection.fragmentShader,vertexShader:s.c.hiddenLineSection.vertexShader,uniforms:o,linewidth:t,blending:r.NoBlending,clipping:a,transparent:o.opacity.value<1},c=new i.a(l);return c.isInstanced=n,c},V=function(e,t,n,a){null==n&&(n=!1),null==a&&(a=!1);var o=r.UniformsUtils.clone(s.c.outlineSection.uniforms);o.diffuse.value.setHex(e),o.opacity.value=t;var l={fragmentShader:s.c.outlineSection.fragmentShader,vertexShader:s.c.outlineSection.vertexShader,uniforms:o,side:r.BackSide,clipping:a,transparent:!0},c=new i.a(l);return c.isInstanced=n,c},N=function(e,t,n,a){var o=r.UniformsUtils.clone(s.c.points.uniforms);o.diffuse.value.setHex(e),o.opacity.value=t,o.size.value=d,null==n&&(n=!1),null==a&&(a=!1);var l={fragmentShader:s.c.points.fragmentShader,vertexShader:s.c.points.vertexShader,uniforms:o,alphaTest:.8,clipping:a,transparent:o.opacity.value<1},c=new i.a(l);return c.isInstanced=n,c},U=function(e,t,n){var r=new c.a({color:e.diffuse,linewidth:e.linewidth});return r.resolution.set(window.innerWidth,window.innerHeight),r},F=function(e,t,n){null==t&&(t=!1),null==n&&(n=!1);var a=r.UniformsUtils.clone(s.c.phongSection.uniforms);a.diffuse.value.setHex(e.diffuse),a.emissive.value.setHex(e.emissive),a.specular.value.setHex(e.specular),a.shininess.value=e.shininess,a.opacity.value=e.opacity,a.shininess.value<=0&&(a.shininess.value=1e-6),null!==e.clipping&&void 0!==e.clipping&&(n=e.clipping),null!==e.refractionRatio&&void 0!==e.refractionRatio&&(a.refractionRatio.value=e.refractionRatio),null!==e.reflectivity&&void 0!==e.reflectivity&&(a.reflectivity.value=e.reflectivity),null!==e.envMap&&void 0!==e.envMap&&(a.envMap.value=e.envMap),null!==e.bumpMap&&void 0!==e.bumpMap&&(a.bumpMap.value=e.bumpMap),null!==e.bumpScale&&void 0!==e.bumpScale&&(a.bumpScale.value=e.bumpScale);var o={fragmentShader:s.c.phongSection.fragmentShader,vertexShader:s.c.phongSection.vertexShader,uniforms:a,lights:!0,fog:!1,blending:r.NormalBlending,clipping:n,transparent:a.opacity.value<1,opacity:a.opacity.value,side:r.DoubleSide},l=new i.a(o);return l.isInstanced=t,l},z=function(e,t){var n=null;null!==e&&void 0!==e&&(new r.CubeTextureLoader).load(e,function(e){(n=e).format=r.RGBFormat,n.needsUpdate=!0,t(n)}.bind(this),onprogress,onerror)},k=function(e,t){var n=null;null!==e&&void 0!==e&&(new r.CubeTextureLoader).load(e,function(e){(n=e).mapping=r.CubeRefractionMapping,n.format=r.RGBFormat,t(n)}.bind(this),onprogress,onerror)},j=function(e,t){null!==e&&void 0!==e&&(new r.TextureLoader).load(e,function(e){e.anisotropy=4,e.repeat.set(.998,.998),e.offset.set(.001,.001),e.wrapS=e.wrapT=r.RepeatWrapping,e.format=r.RGBFormat,t(e)}.bind(this),onprogress,onerror)},H=function(e,t,n){var a=s.c.phongSection,o={};e.wrapS=r.RepeatWrapping,e.wrapT=r.RepeatWrapping;var l=r.UniformsUtils.clone(a.uniforms);l.diffuse.value.setHex(16777215),l.emissive.value.setHex(0),l.specular.value.setHex(0),l.shininess.value=1e-6,l.map.value=e,o.USE_MAP="";var c={fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,defines:o,lights:!0,fog:!1,blending:r.NormalBlending,clipping:n,transparent:!0},u=new i.a(c);return u.isInstanced=t,u},W=function(e,t,n,a,o){null==n&&(n=1),null==a&&(a=!1),null==o&&(o=!1);var l=0;e?l=1:e=16777215;var c=r.UniformsUtils.merge([s.c.lineSection.uniforms,{vertexColor:{type:"c",value:new r.Color(e)},overrideColor:{type:"f",value:l}}]);c.opacity.value=t;var u={fragmentShader:s.c.lineSection.fragmentShader,vertexShader:s.c.lineSection.vertexShader,uniforms:c,defines:{USE_COLOR:""},lights:!1,fog:!1,linewidth:n,blending:r.NoBlending,clipping:o,transparent:c.opacity.value<1},h=new i.a(u);return h.isInstanced=a,h},X=function(e,t,n){var a=0;e?a=1:e=16777215;var o=r.UniformsUtils.merge([r.UniformsLib.lights,{vertexColor:{type:"c",value:new r.Color(e)},overrideColor:{type:"f",value:a},diffuse:{type:"c",value:new r.Color(16777215)},emissive:{type:"c",value:new r.Color(0)},specular:{type:"c",value:new r.Color(0)},shininess:{type:"f",value:1e-6},opacity:{type:"f",value:1}}]),l={fragmentShader:s.c.phongSection.fragmentShader,vertexShader:s.c.phongSection.vertexShader,uniforms:o,defines:{USE_COLOR:""},lights:!0,fog:!1,blending:r.NormalBlending,clipping:n,transparent:!1},c=new i.a(l);return c.isInstanced=t,c},q=function(e){return void 0===e||null===e},Y=function(e,t){var n=void 0!==e&&null!==e;if(!n&&t)throw new TypeError("Expecting value to be defined.");return n},Z=function(){var e=new r.Matrix4,t=new r.Matrix3;return function(n){return n.isMatrix4?n.equals(e):!!n.isMatrix3&&n.equals(t)}}(),J=function(){var e=new r.Vector3,t=new r.Vector3;return function(n,r){return e.fromArray(n),t.fromArray(r),e.sub(t).toArray()}}(),Q=function(){var e=new r.Vector3,t=new r.Vector3;return function(n,r){return e.fromArray(n),t.fromArray(r),e.add(t).toArray()}}(),K={combineHash:M,createBumpMap:j,createHiddenLineMaterial:D,createLineMaterial:G,createLineVertexColorMaterial:W,createWideLineMaterial:U,createMeshMaterial:F,createMeshVertexColorMaterial:X,createOutlineMaterial:V,createPointsMaterial:N,createReflectionCube:z,createRefractionCube:k,createTextureMaterial:H,getAbsolutePath:x,getRaycasterLinePrecision:P,getRaycasterPointSize:O,joinUrls:b,setRaycasterLinePrecision:C,setRaycasterPointSize:I},$={_arrayEqual:function(e,t){if(e.length===t.length){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1},_calculateDistanceForCulling:function(e,t,n,r,i){if(e.boundingBox){e.boundingBox.clone().applyMatrix4(e.matrixWorld).getBoundingSphere(R);var a=R.radius,o=i*(Math.PI/180),s=parseInt(r.domElement.height),l=50,c=0,u=0;return null!==t&&void 0!==t?c=s*a/((l=t)*Math.tan(o/2)):null!==t&&void 0!==t||(c=s*a/(l*Math.tan(o/2))),null!==n&&void 0!==n?u=s*a/((l=n)*Math.tan(o/2)):null!==n&&void 0!==n||(u=2*c),c<u&&(e.userData.layerBoundary1=c,e.userData.layerBoundary2=u,!0)}},_calculatePixelScale:S,_checkLicense:function(){return!0},_clearArray:function(e){for(var t=e.length||0,n=0;n<t;++n)e.pop()},_clearJsonObject:A,_clearObject3D:T,_cloneMultiMaterial:function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r].clone());return n},_combineHash:M,_createBumpMap:j,_createHiddenLineMaterial:D,_createLineMaterial:G,_createLineVertexColorMaterial:W,_createWideLineMaterial:U,_createMeshMaterial:F,_createMeshVertexColorMaterial:X,_createOutlineMaterial:V,_createPointsMaterial:N,_createReflectionCube:z,_createRefractionCube:k,_createTextureMaterial:H,_decodeBase64ToBinaryBuffer:function(e){if(void 0!==e){for(var t=atob(e),n=[],r=0,i=t.length;r<i;++r)n.push(t.charCodeAt(r));return new Uint8Array(n).buffer}},_epsilonIsZero:function(e,t){return!(t.x>e||t.x<-e||t.y>e||t.y<-e||t.z&&(t.z>e||t.z<-e))},_earcutTriangulation:function(e,t){function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}removeDupEndPts(e),t.forEach(removeDupEndPts);var n=[];addContour(n,e);for(var r=[],i=e.length,a=0;a<t.length;a++)r.push(i),i+=t[a].length,addContour(n,t[a]);0===r.length&&(r=null);var o=l(n,r,2),s=[];for(a=0;a<o.length;a+=3)s.push(o.slice(a,a+3));return s},_eventMapIndex:function(e,t){for(var n=e.length,r=0;r<n;++r)if(e[r]===t)return r;return-1},_floatEqual:_,_getTargetHeight:function(e){return void 0===e?window.innerHeight:0===e.clientHeight||void 0===e.clientHeight?parseInt(e.height):parseInt(e.clientHeight)},_getTargetWidth:function(e){return void 0===e?window.innerWidth:0===e.clientWidth||void 0===e.clientWidth?parseInt(e.width):parseInt(e.clientWidth)},_getSubPixelAbsoluteTop:function(e){for(var t=0,n=e;n.offsetParent;)t-=n.scrollTop,n=n.parentNode;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},_getSubPixelAbsoluteLeft:function(e){for(var t=0,n=e;n.offsetParent;)t-=n.scrollLeft,n=n.parentNode;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},_getMousePositionAsPercentage:function(e,t){var n,i;if(void 0!==t&&null!==t){var a=parseInt($._getSubPixelAbsoluteLeft(t)),o=parseInt(t.scrollLeft||0),s="CSS1Compat"===t.ownerDocument.compatMode?t.ownerDocument.documentElement:doc.body,l=parseInt(s.scrollLeft||0),c=parseInt($._getSubPixelAbsoluteTop(t)),u=parseInt(t.scrollTop||0),h=parseInt(s.scrollTop||0);n=parseInt(e.clientX)-a+o+l,i=parseInt(e.clientY)-c+u+h}else n=e.clientX,i=e.clientY;return new r.Vector2(n/$._getTargetWidth(t),i/$._getTargetHeight(t))},_getAbsolutePath:x,_getHostUrl:y,_getIntersectionsAtViewportCoordinate:B,_getObjectAtViewportCoordinate:function(e,t,n,i,a,s,l,c,u){var h={type:o.i.pickingOverride},d=B(e,t,n,i,a,s,l,c,u);if(Y(d)&&(d.length>0&&(h.candidates=d,i.dispatchEvent(h)),d.length>0&&d[0].object)){var p={object:null,point:d[0].point,ray:f.ray},m=d[0].object;switch(l){case o.x.FREE:for(var g,v,y=0;y<d.length;y++)if("Dimension"===d[y].object.parent.name){g=d[y].object,v=d[y].dimComponent;break}if(g){p.object=g,p.dimComponent=v;break}if("SectionEdgeShape"===m.type)p.object=m;else if("GenericShape"===m.type||"SectionPlane"===m.type)p.object=m;else if("Part"===m.parent.type||"Body"===m.parent.type)p.object=m.parent;else if(m.isPmi){for(;void 0===m.userData.psId;)m=m.owner;p.object=m,null!==d[0].index&&void 0===d[0].faceIndex&&(p.pointIndex=d[0].index)}else m instanceof r.Sprite&&(p.object=m);break;case o.x.PART:"Part"===m.parent.type&&(p.object=m.parent);break;default:if((l&o.x.FACE)===o.x.FACE&&d[0].xtFace){d[0].xtFace.face?p.object=d[0].xtFace:"Part"!==m.type&&"Body"!==m.parent.type||(p.object=m.parent);break}if((l&o.x.BODY)===o.x.BODY&&d[0].xtFace){p.object=m.parent;break}if((l&o.x.EDGE)===o.x.EDGE&&("Edge"===d[0].object.type||"EdgeShapeBase"===d[0].object.type)){p.object=d[0].object,p.pointIndex=d[0].index;break}if((l&o.x.VERTEX)===o.x.VERTEX&&"Vertex"===d[0].object.type){p.pointIndex=d[0].index,p.object=d[0].object;break}if((l&o.x.POINT)===o.x.POINT&&("Part"===m.parent.type||"Body"===m.parent.type)){p.object=d[0].point,p.face=d[0].face,p.parent=m.parent;break}if((l&o.x.PMI)===o.x.PMI&&m.isPmi){for(;void 0===m.userData.psId;)m=m.owner;p.object=m,null!==d[0].index&&void 0===d[0].faceIndex&&(p.pointIndex=d[0].index);break}if((l&o.x.DIMENSION)===o.x.DIMENSION&&"Dimension"===m.parent.name){p.object=m;break}if("GenericShape"===m.type){p.object=m;break}}return p}return null},_getPartTolerance:function(e){var t=1e-5;return t*=1/w(e.getUnit())},_getRaycasterLinePrecision:P,_getRaycasterPointSize:O,_getTopModelBBox:function(e,t){if(e&&e.children&&e.children.length>0)for(var n=0,r=e.children.length;n<r;n++){var i=e.children[n];if(i.boundingBox){var a=i.boundingBox.clone();a.applyMatrix4(i.matrixWorld),t.union(a)}}},_getUnitScale:w,_getValidOpacity:function(e){var t=e;return t=m(t)?(t=t<0?0:t)>1?1:t:1},_getVisibleBBox:L,_getZ:function(e){if(!e)return 0;for(var t=0,n=0;e;){if(e===document.body||!e.parentNode)return 0;if(n=parseInt(window.getComputedStyle(e).zIndex),!isNaN(n)){t=n;break}e=e.parent}return t},_isArray:function(e,t,n){var r=Y(e)&&Array.isArray(e);if(!r&&t)throw new TypeError("Expecting an array value.");if(v(n))for(var i=0;i<e.length;++i)if(!n(e[i]))throw new TypeError("Failed type check at array index:"+i);return r},_isBoolean:function(e,t){var n=typeof e==typeof!0;if(!n&&t)throw new TypeError("Expecting a boolean value.");return n},_isFunction:v,_isIdentity:Z,_isNullOrUndefined:q,_isNumber:m,_isObject:function(e,t){var n=e instanceof Object;if(!n&&t)throw new TypeError("Expecting an Object value.");return n},_isObjectEmpty:function(e){if("object"!=typeof e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},_isString:g,_isStringEmpty:function(e){return!g(e)||0===e.length||0===e.trim().length},_updatePositionFromArray:function(e,t,n){Array.isArray(t)&&3===t.length&&m(n)&&(e.setXYZ(n,t[0],t[1],t[2]),e.needsUpdate=!0)},_subArrayVectors:J,_addArrayVectors:Q,_isZero:function(e,t){return t=t||1e-6,Math.abs(e)<=t},_joinUrls:b,_notNullOrUndefined:Y,_optionalArgCheck:function(e,t,n){Y(e)&&v(t)&&t(e,!0,n)},_parsePsId:function(e){if(q(e))return null;var t=e.indexOf("|");return t<=0?{psId:e}:1===t||t===e.length-1?null:{psId:e.substring(0,t),xtId:e.substring(t+1)}},_setLicense:function(e){e},_setMaterial:function(e,t){var n=!1;Y(e.uniforms.diffuse)&&Y(t.diffuse)&&(e.uniforms.diffuse.value.setHex(t.diffuse),n=!0),Y(e.uniforms.ambient)&&Y(t.ambient)&&(e.uniforms.ambient.value.setHex(t.ambient),n=!0),Y(e.uniforms.emissive)&&Y(t.emissive)&&(e.uniforms.emissive.value.setHex(t.emissive),n=!0),Y(e.uniforms.specular)&&Y(t.specular)&&(e.uniforms.specular.value.setHex(t.specular),n=!0),Y(e.uniforms.shininess)&&Y(t.shininess)&&(e.uniforms.shininess.value=t.shininess,n=!0),Y(t.opacity)&&(e.uniforms.opacity.value=t.opacity,e.opacity=t.opacity,e.transparent=t.opacity<1,n=!0),e.needsUpdate=n},_setRaycasterLinePrecision:C,_setRaycasterPointSize:I,_typedArrayAppend:function(e,t){var n=null;return e instanceof Float32Array?n=new Float32Array(e.length+t.length):e instanceof Uint32Array&&(n=new Uint32Array(e.length+t.length)),n&&(n.set(e),n.set(t,e.length)),n},_unionModelBBox:function(e,t,n){var r=n.elements,i=1/(r[3]*t.min.x+r[7]*t.min.y+r[11]*t.min.z+r[15]),a=1/(r[3]*t.max.x+r[7]*t.max.y+r[11]*t.max.z+r[15]),o=(r[0]*t.min.x+r[4]*t.min.y+r[8]*t.min.z+r[12])*i,s=(r[1]*t.min.x+r[5]*t.min.y+r[9]*t.min.z+r[13])*i,l=(r[2]*t.min.x+r[6]*t.min.y+r[10]*t.min.z+r[14])*i,c=(r[0]*t.max.x+r[4]*t.max.y+r[8]*t.max.z+r[12])*a,u=(r[1]*t.max.x+r[5]*t.max.y+r[9]*t.max.z+r[13])*a,h=(r[2]*t.max.x+r[6]*t.max.y+r[10]*t.max.z+r[14])*a;(o<e.min.x||c<e.min.x)&&(e.min.x=o<c?o:c),(s<e.min.y||u<e.min.y)&&(e.min.y=s<u?s:u),(l<e.min.z||h<e.min.z)&&(e.min.z=l<h?l:h),(c>e.max.x||o>e.max.x)&&(e.max.x=c>o?c:o),(u>e.max.y||s>e.max.y)&&(e.max.y=u>s?u:s),(h>e.max.z||l>e.max.z)&&(e.max.z=h>l?h:l)},_unprojectScreenDirection:E,_vector3ToVector2:function(e,t){var n=[];t.normalize();for(var i=0;i<e.length;i++){var a=e[i];Math.abs(Math.round(t.x))?n.push(new r.Vector2(a.y,a.z)):Math.abs(Math.round(t.y))?n.push(new r.Vector2(a.x,a.z)):Math.abs(Math.round(t.z))&&n.push(new r.Vector2(a.x,a.y))}return n},_vertexEqual:function(e,t,n,r,i,a,o){return _(e,r,o)&&_(t,i,o)&&_(n,a,o)},_vectorMatrixMultiply:function(e,t){var n=t.elements,r=e.x*n[0]+e.y*n[4]+e.z*n[8],i=e.x*n[1]+e.y*n[5]+e.z*n[9],a=e.x*n[2]+e.y*n[6]+e.z*n[10];return e.x=r,e.y=i,e.z=a,e}};t.b=$},
/* 1 */
/***/function(e,t,n){"use strict";
/**
 * https://github.com/mrdoob/eventdispatcher.js/
 */
function EventDispatcher(){}n.r(t),
/* harmony export (binding) */n.d(t,"WebGLRenderTargetCube",function(){return WebGLRenderTargetCube}),
/* harmony export (binding) */n.d(t,"WebGLRenderTarget",function(){return WebGLRenderTarget}),
/* harmony export (binding) */n.d(t,"WebGLRenderer",function(){return WebGLRenderer}),
/* harmony export (binding) */n.d(t,"ShaderLib",function(){return Wt}),
/* harmony export (binding) */n.d(t,"UniformsLib",function(){return Ht}),
/* harmony export (binding) */n.d(t,"UniformsUtils",function(){return kt}),
/* harmony export (binding) */n.d(t,"ShaderChunk",function(){return zt}),
/* harmony export (binding) */n.d(t,"FogExp2",function(){return FogExp2}),
/* harmony export (binding) */n.d(t,"Fog",function(){return Fog}),
/* harmony export (binding) */n.d(t,"Scene",function(){return Scene}),
/* harmony export (binding) */n.d(t,"Sprite",function(){return Sprite}),
/* harmony export (binding) */n.d(t,"LOD",function(){return LOD}),
/* harmony export (binding) */n.d(t,"SkinnedMesh",function(){return SkinnedMesh}),
/* harmony export (binding) */n.d(t,"Skeleton",function(){return Skeleton}),
/* harmony export (binding) */n.d(t,"Bone",function(){return Bone}),
/* harmony export (binding) */n.d(t,"Mesh",function(){return Mesh}),
/* harmony export (binding) */n.d(t,"LineSegments",function(){return LineSegments}),
/* harmony export (binding) */n.d(t,"LineLoop",function(){return LineLoop}),
/* harmony export (binding) */n.d(t,"Line",function(){return Line}),
/* harmony export (binding) */n.d(t,"Points",function(){return Points}),
/* harmony export (binding) */n.d(t,"Group",function(){return Group}),
/* harmony export (binding) */n.d(t,"VideoTexture",function(){return VideoTexture}),
/* harmony export (binding) */n.d(t,"DataTexture",function(){return DataTexture}),
/* harmony export (binding) */n.d(t,"DataTexture3D",function(){return DataTexture3D}),
/* harmony export (binding) */n.d(t,"CompressedTexture",function(){return CompressedTexture}),
/* harmony export (binding) */n.d(t,"CubeTexture",function(){return CubeTexture}),
/* harmony export (binding) */n.d(t,"CanvasTexture",function(){return CanvasTexture}),
/* harmony export (binding) */n.d(t,"DepthTexture",function(){return DepthTexture}),
/* harmony export (binding) */n.d(t,"Texture",function(){return Texture}),
/* harmony export (binding) */n.d(t,"CompressedTextureLoader",function(){return CompressedTextureLoader}),
/* harmony export (binding) */n.d(t,"DataTextureLoader",function(){return DataTextureLoader}),
/* harmony export (binding) */n.d(t,"CubeTextureLoader",function(){return CubeTextureLoader}),
/* harmony export (binding) */n.d(t,"TextureLoader",function(){return TextureLoader}),
/* harmony export (binding) */n.d(t,"ObjectLoader",function(){return ObjectLoader}),
/* harmony export (binding) */n.d(t,"MaterialLoader",function(){return MaterialLoader}),
/* harmony export (binding) */n.d(t,"BufferGeometryLoader",function(){return BufferGeometryLoader}),
/* harmony export (binding) */n.d(t,"DefaultLoadingManager",function(){return mn}),
/* harmony export (binding) */n.d(t,"LoadingManager",function(){return LoadingManager}),
/* harmony export (binding) */n.d(t,"JSONLoader",function(){return JSONLoader}),
/* harmony export (binding) */n.d(t,"ImageLoader",function(){return ImageLoader}),
/* harmony export (binding) */n.d(t,"ImageBitmapLoader",function(){return ImageBitmapLoader}),
/* harmony export (binding) */n.d(t,"FontLoader",function(){return FontLoader}),
/* harmony export (binding) */n.d(t,"FileLoader",function(){return FileLoader}),
/* harmony export (binding) */n.d(t,"Loader",function(){return Loader}),
/* harmony export (binding) */n.d(t,"LoaderUtils",function(){return En}),
/* harmony export (binding) */n.d(t,"Cache",function(){return fn}),
/* harmony export (binding) */n.d(t,"AudioLoader",function(){return AudioLoader}),
/* harmony export (binding) */n.d(t,"SpotLightShadow",function(){return SpotLightShadow}),
/* harmony export (binding) */n.d(t,"SpotLight",function(){return SpotLight}),
/* harmony export (binding) */n.d(t,"PointLight",function(){return PointLight}),
/* harmony export (binding) */n.d(t,"RectAreaLight",function(){return RectAreaLight}),
/* harmony export (binding) */n.d(t,"HemisphereLight",function(){return HemisphereLight}),
/* harmony export (binding) */n.d(t,"DirectionalLightShadow",function(){return DirectionalLightShadow}),
/* harmony export (binding) */n.d(t,"DirectionalLight",function(){return DirectionalLight}),
/* harmony export (binding) */n.d(t,"AmbientLight",function(){return AmbientLight}),
/* harmony export (binding) */n.d(t,"LightShadow",function(){return LightShadow}),
/* harmony export (binding) */n.d(t,"Light",function(){return Light}),
/* harmony export (binding) */n.d(t,"StereoCamera",function(){return StereoCamera}),
/* harmony export (binding) */n.d(t,"PerspectiveCamera",function(){return PerspectiveCamera}),
/* harmony export (binding) */n.d(t,"OrthographicCamera",function(){return OrthographicCamera}),
/* harmony export (binding) */n.d(t,"CubeCamera",function(){return CubeCamera}),
/* harmony export (binding) */n.d(t,"ArrayCamera",function(){return ArrayCamera}),
/* harmony export (binding) */n.d(t,"Camera",function(){return Camera}),
/* harmony export (binding) */n.d(t,"AudioListener",function(){return AudioListener}),
/* harmony export (binding) */n.d(t,"PositionalAudio",function(){return PositionalAudio}),
/* harmony export (binding) */n.d(t,"AudioContext",function(){return Cn}),
/* harmony export (binding) */n.d(t,"AudioAnalyser",function(){return AudioAnalyser}),
/* harmony export (binding) */n.d(t,"Audio",function(){return Audio}),
/* harmony export (binding) */n.d(t,"VectorKeyframeTrack",function(){return VectorKeyframeTrack}),
/* harmony export (binding) */n.d(t,"StringKeyframeTrack",function(){return StringKeyframeTrack}),
/* harmony export (binding) */n.d(t,"QuaternionKeyframeTrack",function(){return QuaternionKeyframeTrack}),
/* harmony export (binding) */n.d(t,"NumberKeyframeTrack",function(){return NumberKeyframeTrack}),
/* harmony export (binding) */n.d(t,"ColorKeyframeTrack",function(){return ColorKeyframeTrack}),
/* harmony export (binding) */n.d(t,"BooleanKeyframeTrack",function(){return BooleanKeyframeTrack}),
/* harmony export (binding) */n.d(t,"PropertyMixer",function(){return PropertyMixer}),
/* harmony export (binding) */n.d(t,"PropertyBinding",function(){return PropertyBinding}),
/* harmony export (binding) */n.d(t,"KeyframeTrack",function(){return KeyframeTrack}),
/* harmony export (binding) */n.d(t,"AnimationUtils",function(){return wn}),
/* harmony export (binding) */n.d(t,"AnimationObjectGroup",function(){return AnimationObjectGroup}),
/* harmony export (binding) */n.d(t,"AnimationMixer",function(){return AnimationMixer}),
/* harmony export (binding) */n.d(t,"AnimationClip",function(){return AnimationClip}),
/* harmony export (binding) */n.d(t,"Uniform",function(){return Uniform}),
/* harmony export (binding) */n.d(t,"InstancedBufferGeometry",function(){return InstancedBufferGeometry}),
/* harmony export (binding) */n.d(t,"BufferGeometry",function(){return BufferGeometry}),
/* harmony export (binding) */n.d(t,"Geometry",function(){return Geometry}),
/* harmony export (binding) */n.d(t,"InterleavedBufferAttribute",function(){return InterleavedBufferAttribute}),
/* harmony export (binding) */n.d(t,"InstancedInterleavedBuffer",function(){return InstancedInterleavedBuffer}),
/* harmony export (binding) */n.d(t,"InterleavedBuffer",function(){return InterleavedBuffer}),
/* harmony export (binding) */n.d(t,"InstancedBufferAttribute",function(){return InstancedBufferAttribute}),
/* harmony export (binding) */n.d(t,"Face3",function(){return Face3}),
/* harmony export (binding) */n.d(t,"Object3D",function(){return Object3D}),
/* harmony export (binding) */n.d(t,"Raycaster",function(){return Raycaster}),
/* harmony export (binding) */n.d(t,"Layers",function(){return Layers}),
/* harmony export (binding) */n.d(t,"EventDispatcher",function(){return EventDispatcher}),
/* harmony export (binding) */n.d(t,"Clock",function(){return Clock}),
/* harmony export (binding) */n.d(t,"QuaternionLinearInterpolant",function(){return QuaternionLinearInterpolant}),
/* harmony export (binding) */n.d(t,"LinearInterpolant",function(){return LinearInterpolant}),
/* harmony export (binding) */n.d(t,"DiscreteInterpolant",function(){return DiscreteInterpolant}),
/* harmony export (binding) */n.d(t,"CubicInterpolant",function(){return CubicInterpolant}),
/* harmony export (binding) */n.d(t,"Interpolant",function(){return Interpolant}),
/* harmony export (binding) */n.d(t,"Triangle",function(){return Triangle}),
/* harmony export (binding) */n.d(t,"Math",function(){return Nt}),
/* harmony export (binding) */n.d(t,"Spherical",function(){return Spherical}),
/* harmony export (binding) */n.d(t,"Cylindrical",function(){return Cylindrical}),
/* harmony export (binding) */n.d(t,"Plane",function(){return Plane}),
/* harmony export (binding) */n.d(t,"Frustum",function(){return Frustum}),
/* harmony export (binding) */n.d(t,"Sphere",function(){return Sphere}),
/* harmony export (binding) */n.d(t,"Ray",function(){return Ray}),
/* harmony export (binding) */n.d(t,"Matrix4",function(){return Matrix4}),
/* harmony export (binding) */n.d(t,"Matrix3",function(){return Matrix3}),
/* harmony export (binding) */n.d(t,"Box3",function(){return Box3}),
/* harmony export (binding) */n.d(t,"Box2",function(){return Box2}),
/* harmony export (binding) */n.d(t,"Line3",function(){return Line3}),
/* harmony export (binding) */n.d(t,"Euler",function(){return Euler}),
/* harmony export (binding) */n.d(t,"Vector4",function(){return Vector4}),
/* harmony export (binding) */n.d(t,"Vector3",function(){return Vector3}),
/* harmony export (binding) */n.d(t,"Vector2",function(){return Vector2}),
/* harmony export (binding) */n.d(t,"Quaternion",function(){return Quaternion}),
/* harmony export (binding) */n.d(t,"Color",function(){return Color}),
/* harmony export (binding) */n.d(t,"ImmediateRenderObject",function(){return ImmediateRenderObject}),
/* harmony export (binding) */n.d(t,"VertexNormalsHelper",function(){return VertexNormalsHelper}),
/* harmony export (binding) */n.d(t,"SpotLightHelper",function(){return SpotLightHelper}),
/* harmony export (binding) */n.d(t,"SkeletonHelper",function(){return SkeletonHelper}),
/* harmony export (binding) */n.d(t,"PointLightHelper",function(){return PointLightHelper}),
/* harmony export (binding) */n.d(t,"RectAreaLightHelper",function(){return RectAreaLightHelper}),
/* harmony export (binding) */n.d(t,"HemisphereLightHelper",function(){return HemisphereLightHelper}),
/* harmony export (binding) */n.d(t,"GridHelper",function(){return GridHelper}),
/* harmony export (binding) */n.d(t,"PolarGridHelper",function(){return PolarGridHelper}),
/* harmony export (binding) */n.d(t,"FaceNormalsHelper",function(){return FaceNormalsHelper}),
/* harmony export (binding) */n.d(t,"DirectionalLightHelper",function(){return DirectionalLightHelper}),
/* harmony export (binding) */n.d(t,"CameraHelper",function(){return CameraHelper}),
/* harmony export (binding) */n.d(t,"BoxHelper",function(){return BoxHelper}),
/* harmony export (binding) */n.d(t,"Box3Helper",function(){return Box3Helper}),
/* harmony export (binding) */n.d(t,"PlaneHelper",function(){return PlaneHelper}),
/* harmony export (binding) */n.d(t,"ArrowHelper",function(){return ArrowHelper}),
/* harmony export (binding) */n.d(t,"AxesHelper",function(){return AxesHelper}),
/* harmony export (binding) */n.d(t,"Shape",function(){return Shape}),
/* harmony export (binding) */n.d(t,"Path",function(){return Path}),
/* harmony export (binding) */n.d(t,"ShapePath",function(){return ShapePath}),
/* harmony export (binding) */n.d(t,"Font",function(){return Font}),
/* harmony export (binding) */n.d(t,"CurvePath",function(){return CurvePath}),
/* harmony export (binding) */n.d(t,"Curve",function(){return Curve}),
/* harmony export (binding) */n.d(t,"ImageUtils",function(){return Ut}),
/* harmony export (binding) */n.d(t,"ShapeUtils",function(){return un}),
/* harmony export (binding) */n.d(t,"WebGLUtils",function(){return WebGLUtils}),
/* harmony export (binding) */n.d(t,"WireframeGeometry",function(){return WireframeGeometry}),
/* harmony export (binding) */n.d(t,"ParametricGeometry",function(){return ParametricGeometry}),
/* harmony export (binding) */n.d(t,"ParametricBufferGeometry",function(){return ParametricBufferGeometry}),
/* harmony export (binding) */n.d(t,"TetrahedronGeometry",function(){return TetrahedronGeometry}),
/* harmony export (binding) */n.d(t,"TetrahedronBufferGeometry",function(){return TetrahedronBufferGeometry}),
/* harmony export (binding) */n.d(t,"OctahedronGeometry",function(){return OctahedronGeometry}),
/* harmony export (binding) */n.d(t,"OctahedronBufferGeometry",function(){return OctahedronBufferGeometry}),
/* harmony export (binding) */n.d(t,"IcosahedronGeometry",function(){return IcosahedronGeometry}),
/* harmony export (binding) */n.d(t,"IcosahedronBufferGeometry",function(){return IcosahedronBufferGeometry}),
/* harmony export (binding) */n.d(t,"DodecahedronGeometry",function(){return DodecahedronGeometry}),
/* harmony export (binding) */n.d(t,"DodecahedronBufferGeometry",function(){return DodecahedronBufferGeometry}),
/* harmony export (binding) */n.d(t,"PolyhedronGeometry",function(){return PolyhedronGeometry}),
/* harmony export (binding) */n.d(t,"PolyhedronBufferGeometry",function(){return PolyhedronBufferGeometry}),
/* harmony export (binding) */n.d(t,"TubeGeometry",function(){return TubeGeometry}),
/* harmony export (binding) */n.d(t,"TubeBufferGeometry",function(){return TubeBufferGeometry}),
/* harmony export (binding) */n.d(t,"TorusKnotGeometry",function(){return TorusKnotGeometry}),
/* harmony export (binding) */n.d(t,"TorusKnotBufferGeometry",function(){return TorusKnotBufferGeometry}),
/* harmony export (binding) */n.d(t,"TorusGeometry",function(){return TorusGeometry}),
/* harmony export (binding) */n.d(t,"TorusBufferGeometry",function(){return TorusBufferGeometry}),
/* harmony export (binding) */n.d(t,"TextGeometry",function(){return TextGeometry}),
/* harmony export (binding) */n.d(t,"TextBufferGeometry",function(){return TextBufferGeometry}),
/* harmony export (binding) */n.d(t,"SphereGeometry",function(){return SphereGeometry}),
/* harmony export (binding) */n.d(t,"SphereBufferGeometry",function(){return SphereBufferGeometry}),
/* harmony export (binding) */n.d(t,"RingGeometry",function(){return RingGeometry}),
/* harmony export (binding) */n.d(t,"RingBufferGeometry",function(){return RingBufferGeometry}),
/* harmony export (binding) */n.d(t,"PlaneGeometry",function(){return PlaneGeometry}),
/* harmony export (binding) */n.d(t,"PlaneBufferGeometry",function(){return PlaneBufferGeometry}),
/* harmony export (binding) */n.d(t,"LatheGeometry",function(){return LatheGeometry}),
/* harmony export (binding) */n.d(t,"LatheBufferGeometry",function(){return LatheBufferGeometry}),
/* harmony export (binding) */n.d(t,"ShapeGeometry",function(){return ShapeGeometry}),
/* harmony export (binding) */n.d(t,"ShapeBufferGeometry",function(){return ShapeBufferGeometry}),
/* harmony export (binding) */n.d(t,"ExtrudeGeometry",function(){return ExtrudeGeometry}),
/* harmony export (binding) */n.d(t,"ExtrudeBufferGeometry",function(){return ExtrudeBufferGeometry}),
/* harmony export (binding) */n.d(t,"EdgesGeometry",function(){return EdgesGeometry}),
/* harmony export (binding) */n.d(t,"ConeGeometry",function(){return ConeGeometry}),
/* harmony export (binding) */n.d(t,"ConeBufferGeometry",function(){return ConeBufferGeometry}),
/* harmony export (binding) */n.d(t,"CylinderGeometry",function(){return CylinderGeometry}),
/* harmony export (binding) */n.d(t,"CylinderBufferGeometry",function(){return CylinderBufferGeometry}),
/* harmony export (binding) */n.d(t,"CircleGeometry",function(){return CircleGeometry}),
/* harmony export (binding) */n.d(t,"CircleBufferGeometry",function(){return CircleBufferGeometry}),
/* harmony export (binding) */n.d(t,"BoxGeometry",function(){return BoxGeometry}),
/* harmony export (binding) */n.d(t,"BoxBufferGeometry",function(){return BoxBufferGeometry}),
/* harmony export (binding) */n.d(t,"ShadowMaterial",function(){return ShadowMaterial}),
/* harmony export (binding) */n.d(t,"SpriteMaterial",function(){return SpriteMaterial}),
/* harmony export (binding) */n.d(t,"RawShaderMaterial",function(){return RawShaderMaterial}),
/* harmony export (binding) */n.d(t,"ShaderMaterial",function(){return ShaderMaterial}),
/* harmony export (binding) */n.d(t,"PointsMaterial",function(){return PointsMaterial}),
/* harmony export (binding) */n.d(t,"MeshPhysicalMaterial",function(){return MeshPhysicalMaterial}),
/* harmony export (binding) */n.d(t,"MeshStandardMaterial",function(){return MeshStandardMaterial}),
/* harmony export (binding) */n.d(t,"MeshPhongMaterial",function(){return MeshPhongMaterial}),
/* harmony export (binding) */n.d(t,"MeshToonMaterial",function(){return MeshToonMaterial}),
/* harmony export (binding) */n.d(t,"MeshNormalMaterial",function(){return MeshNormalMaterial}),
/* harmony export (binding) */n.d(t,"MeshLambertMaterial",function(){return MeshLambertMaterial}),
/* harmony export (binding) */n.d(t,"MeshDepthMaterial",function(){return MeshDepthMaterial}),
/* harmony export (binding) */n.d(t,"MeshDistanceMaterial",function(){return MeshDistanceMaterial}),
/* harmony export (binding) */n.d(t,"MeshBasicMaterial",function(){return MeshBasicMaterial}),
/* harmony export (binding) */n.d(t,"MeshMatcapMaterial",function(){return MeshMatcapMaterial}),
/* harmony export (binding) */n.d(t,"LineDashedMaterial",function(){return LineDashedMaterial}),
/* harmony export (binding) */n.d(t,"LineBasicMaterial",function(){return LineBasicMaterial}),
/* harmony export (binding) */n.d(t,"Material",function(){return Material}),
/* harmony export (binding) */n.d(t,"Float64BufferAttribute",function(){return Float64BufferAttribute}),
/* harmony export (binding) */n.d(t,"Float32BufferAttribute",function(){return Float32BufferAttribute}),
/* harmony export (binding) */n.d(t,"Uint32BufferAttribute",function(){return Uint32BufferAttribute}),
/* harmony export (binding) */n.d(t,"Int32BufferAttribute",function(){return Int32BufferAttribute}),
/* harmony export (binding) */n.d(t,"Uint16BufferAttribute",function(){return Uint16BufferAttribute}),
/* harmony export (binding) */n.d(t,"Int16BufferAttribute",function(){return Int16BufferAttribute}),
/* harmony export (binding) */n.d(t,"Uint8ClampedBufferAttribute",function(){return Uint8ClampedBufferAttribute}),
/* harmony export (binding) */n.d(t,"Uint8BufferAttribute",function(){return Uint8BufferAttribute}),
/* harmony export (binding) */n.d(t,"Int8BufferAttribute",function(){return Int8BufferAttribute}),
/* harmony export (binding) */n.d(t,"BufferAttribute",function(){return BufferAttribute}),
/* harmony export (binding) */n.d(t,"ArcCurve",function(){return ArcCurve}),
/* harmony export (binding) */n.d(t,"CatmullRomCurve3",function(){return CatmullRomCurve3}),
/* harmony export (binding) */n.d(t,"CubicBezierCurve",function(){return CubicBezierCurve}),
/* harmony export (binding) */n.d(t,"CubicBezierCurve3",function(){return CubicBezierCurve3}),
/* harmony export (binding) */n.d(t,"EllipseCurve",function(){return EllipseCurve}),
/* harmony export (binding) */n.d(t,"LineCurve",function(){return LineCurve}),
/* harmony export (binding) */n.d(t,"LineCurve3",function(){return LineCurve3}),
/* harmony export (binding) */n.d(t,"QuadraticBezierCurve",function(){return QuadraticBezierCurve}),
/* harmony export (binding) */n.d(t,"QuadraticBezierCurve3",function(){return QuadraticBezierCurve3}),
/* harmony export (binding) */n.d(t,"SplineCurve",function(){return SplineCurve}),
/* harmony export (binding) */n.d(t,"REVISION",function(){return r}),
/* harmony export (binding) */n.d(t,"MOUSE",function(){return i}),
/* harmony export (binding) */n.d(t,"CullFaceNone",function(){return a}),
/* harmony export (binding) */n.d(t,"CullFaceBack",function(){return o}),
/* harmony export (binding) */n.d(t,"CullFaceFront",function(){return s}),
/* harmony export (binding) */n.d(t,"CullFaceFrontBack",function(){return l}),
/* harmony export (binding) */n.d(t,"FrontFaceDirectionCW",function(){return c}),
/* harmony export (binding) */n.d(t,"FrontFaceDirectionCCW",function(){return u}),
/* harmony export (binding) */n.d(t,"BasicShadowMap",function(){return h}),
/* harmony export (binding) */n.d(t,"PCFShadowMap",function(){return d}),
/* harmony export (binding) */n.d(t,"PCFSoftShadowMap",function(){return p}),
/* harmony export (binding) */n.d(t,"FrontSide",function(){return f}),
/* harmony export (binding) */n.d(t,"BackSide",function(){return m}),
/* harmony export (binding) */n.d(t,"DoubleSide",function(){return g}),
/* harmony export (binding) */n.d(t,"FlatShading",function(){return y}),
/* harmony export (binding) */n.d(t,"SmoothShading",function(){return b}),
/* harmony export (binding) */n.d(t,"NoColors",function(){return x}),
/* harmony export (binding) */n.d(t,"FaceColors",function(){return _}),
/* harmony export (binding) */n.d(t,"VertexColors",function(){return w}),
/* harmony export (binding) */n.d(t,"NoBlending",function(){return M}),
/* harmony export (binding) */n.d(t,"NormalBlending",function(){return E}),
/* harmony export (binding) */n.d(t,"AdditiveBlending",function(){return S}),
/* harmony export (binding) */n.d(t,"SubtractiveBlending",function(){return L}),
/* harmony export (binding) */n.d(t,"MultiplyBlending",function(){return T}),
/* harmony export (binding) */n.d(t,"CustomBlending",function(){return A}),
/* harmony export (binding) */n.d(t,"AddEquation",function(){return C}),
/* harmony export (binding) */n.d(t,"SubtractEquation",function(){return P}),
/* harmony export (binding) */n.d(t,"ReverseSubtractEquation",function(){return I}),
/* harmony export (binding) */n.d(t,"MinEquation",function(){return O}),
/* harmony export (binding) */n.d(t,"MaxEquation",function(){return B}),
/* harmony export (binding) */n.d(t,"ZeroFactor",function(){return R}),
/* harmony export (binding) */n.d(t,"OneFactor",function(){return G}),
/* harmony export (binding) */n.d(t,"SrcColorFactor",function(){return D}),
/* harmony export (binding) */n.d(t,"OneMinusSrcColorFactor",function(){return V}),
/* harmony export (binding) */n.d(t,"SrcAlphaFactor",function(){return N}),
/* harmony export (binding) */n.d(t,"OneMinusSrcAlphaFactor",function(){return U}),
/* harmony export (binding) */n.d(t,"DstAlphaFactor",function(){return F}),
/* harmony export (binding) */n.d(t,"OneMinusDstAlphaFactor",function(){return z}),
/* harmony export (binding) */n.d(t,"DstColorFactor",function(){return k}),
/* harmony export (binding) */n.d(t,"OneMinusDstColorFactor",function(){return j}),
/* harmony export (binding) */n.d(t,"SrcAlphaSaturateFactor",function(){return H}),
/* harmony export (binding) */n.d(t,"NeverDepth",function(){return W}),
/* harmony export (binding) */n.d(t,"AlwaysDepth",function(){return X}),
/* harmony export (binding) */n.d(t,"LessDepth",function(){return q}),
/* harmony export (binding) */n.d(t,"LessEqualDepth",function(){return Y}),
/* harmony export (binding) */n.d(t,"EqualDepth",function(){return Z}),
/* harmony export (binding) */n.d(t,"GreaterEqualDepth",function(){return J}),
/* harmony export (binding) */n.d(t,"GreaterDepth",function(){return Q}),
/* harmony export (binding) */n.d(t,"NotEqualDepth",function(){return K}),
/* harmony export (binding) */n.d(t,"MultiplyOperation",function(){return $}),
/* harmony export (binding) */n.d(t,"MixOperation",function(){return ee}),
/* harmony export (binding) */n.d(t,"AddOperation",function(){return te}),
/* harmony export (binding) */n.d(t,"NoToneMapping",function(){return ne}),
/* harmony export (binding) */n.d(t,"LinearToneMapping",function(){return re}),
/* harmony export (binding) */n.d(t,"ReinhardToneMapping",function(){return ie}),
/* harmony export (binding) */n.d(t,"Uncharted2ToneMapping",function(){return ae}),
/* harmony export (binding) */n.d(t,"CineonToneMapping",function(){return oe}),
/* harmony export (binding) */n.d(t,"UVMapping",function(){return se}),
/* harmony export (binding) */n.d(t,"CubeReflectionMapping",function(){return le}),
/* harmony export (binding) */n.d(t,"CubeRefractionMapping",function(){return ce}),
/* harmony export (binding) */n.d(t,"EquirectangularReflectionMapping",function(){return ue}),
/* harmony export (binding) */n.d(t,"EquirectangularRefractionMapping",function(){return he}),
/* harmony export (binding) */n.d(t,"SphericalReflectionMapping",function(){return de}),
/* harmony export (binding) */n.d(t,"CubeUVReflectionMapping",function(){return pe}),
/* harmony export (binding) */n.d(t,"CubeUVRefractionMapping",function(){return fe}),
/* harmony export (binding) */n.d(t,"RepeatWrapping",function(){return me}),
/* harmony export (binding) */n.d(t,"ClampToEdgeWrapping",function(){return ge}),
/* harmony export (binding) */n.d(t,"MirroredRepeatWrapping",function(){return ve}),
/* harmony export (binding) */n.d(t,"NearestFilter",function(){return ye}),
/* harmony export (binding) */n.d(t,"NearestMipMapNearestFilter",function(){return be}),
/* harmony export (binding) */n.d(t,"NearestMipMapLinearFilter",function(){return xe}),
/* harmony export (binding) */n.d(t,"LinearFilter",function(){return _e}),
/* harmony export (binding) */n.d(t,"LinearMipMapNearestFilter",function(){return we}),
/* harmony export (binding) */n.d(t,"LinearMipMapLinearFilter",function(){return Me}),
/* harmony export (binding) */n.d(t,"UnsignedByteType",function(){return Ee}),
/* harmony export (binding) */n.d(t,"ByteType",function(){return Se}),
/* harmony export (binding) */n.d(t,"ShortType",function(){return Le}),
/* harmony export (binding) */n.d(t,"UnsignedShortType",function(){return Te}),
/* harmony export (binding) */n.d(t,"IntType",function(){return Ae}),
/* harmony export (binding) */n.d(t,"UnsignedIntType",function(){return Ce}),
/* harmony export (binding) */n.d(t,"FloatType",function(){return Pe}),
/* harmony export (binding) */n.d(t,"HalfFloatType",function(){return Ie}),
/* harmony export (binding) */n.d(t,"UnsignedShort4444Type",function(){return Oe}),
/* harmony export (binding) */n.d(t,"UnsignedShort5551Type",function(){return Be}),
/* harmony export (binding) */n.d(t,"UnsignedShort565Type",function(){return Re}),
/* harmony export (binding) */n.d(t,"UnsignedInt248Type",function(){return Ge}),
/* harmony export (binding) */n.d(t,"AlphaFormat",function(){return De}),
/* harmony export (binding) */n.d(t,"RGBFormat",function(){return Ve}),
/* harmony export (binding) */n.d(t,"RGBAFormat",function(){return Ne}),
/* harmony export (binding) */n.d(t,"LuminanceFormat",function(){return Ue}),
/* harmony export (binding) */n.d(t,"LuminanceAlphaFormat",function(){return Fe}),
/* harmony export (binding) */n.d(t,"RGBEFormat",function(){return ze}),
/* harmony export (binding) */n.d(t,"DepthFormat",function(){return ke}),
/* harmony export (binding) */n.d(t,"DepthStencilFormat",function(){return je}),
/* harmony export (binding) */n.d(t,"RedFormat",function(){return He}),
/* harmony export (binding) */n.d(t,"RGB_S3TC_DXT1_Format",function(){return We}),
/* harmony export (binding) */n.d(t,"RGBA_S3TC_DXT1_Format",function(){return Xe}),
/* harmony export (binding) */n.d(t,"RGBA_S3TC_DXT3_Format",function(){return qe}),
/* harmony export (binding) */n.d(t,"RGBA_S3TC_DXT5_Format",function(){return Ye}),
/* harmony export (binding) */n.d(t,"RGB_PVRTC_4BPPV1_Format",function(){return Ze}),
/* harmony export (binding) */n.d(t,"RGB_PVRTC_2BPPV1_Format",function(){return Je}),
/* harmony export (binding) */n.d(t,"RGBA_PVRTC_4BPPV1_Format",function(){return Qe}),
/* harmony export (binding) */n.d(t,"RGBA_PVRTC_2BPPV1_Format",function(){return Ke}),
/* harmony export (binding) */n.d(t,"RGB_ETC1_Format",function(){return $e}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_4x4_Format",function(){return et}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_5x4_Format",function(){return tt}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_5x5_Format",function(){return nt}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_6x5_Format",function(){return rt}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_6x6_Format",function(){return it}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_8x5_Format",function(){return at}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_8x6_Format",function(){return ot}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_8x8_Format",function(){return st}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_10x5_Format",function(){return lt}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_10x6_Format",function(){return ct}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_10x8_Format",function(){return ut}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_10x10_Format",function(){return ht}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_12x10_Format",function(){return dt}),
/* harmony export (binding) */n.d(t,"RGBA_ASTC_12x12_Format",function(){return pt}),
/* harmony export (binding) */n.d(t,"LoopOnce",function(){return ft}),
/* harmony export (binding) */n.d(t,"LoopRepeat",function(){return mt}),
/* harmony export (binding) */n.d(t,"LoopPingPong",function(){return gt}),
/* harmony export (binding) */n.d(t,"InterpolateDiscrete",function(){return vt}),
/* harmony export (binding) */n.d(t,"InterpolateLinear",function(){return yt}),
/* harmony export (binding) */n.d(t,"InterpolateSmooth",function(){return bt}),
/* harmony export (binding) */n.d(t,"ZeroCurvatureEnding",function(){return xt}),
/* harmony export (binding) */n.d(t,"ZeroSlopeEnding",function(){return _t}),
/* harmony export (binding) */n.d(t,"WrapAroundEnding",function(){return wt}),
/* harmony export (binding) */n.d(t,"TrianglesDrawMode",function(){return Mt}),
/* harmony export (binding) */n.d(t,"TriangleStripDrawMode",function(){return Et}),
/* harmony export (binding) */n.d(t,"TriangleFanDrawMode",function(){return St}),
/* harmony export (binding) */n.d(t,"LinearEncoding",function(){return Lt}),
/* harmony export (binding) */n.d(t,"sRGBEncoding",function(){return Tt}),
/* harmony export (binding) */n.d(t,"GammaEncoding",function(){return At}),
/* harmony export (binding) */n.d(t,"RGBEEncoding",function(){return Ct}),
/* harmony export (binding) */n.d(t,"LogLuvEncoding",function(){return Pt}),
/* harmony export (binding) */n.d(t,"RGBM7Encoding",function(){return It}),
/* harmony export (binding) */n.d(t,"RGBM16Encoding",function(){return Ot}),
/* harmony export (binding) */n.d(t,"RGBDEncoding",function(){return Bt}),
/* harmony export (binding) */n.d(t,"BasicDepthPacking",function(){return Rt}),
/* harmony export (binding) */n.d(t,"RGBADepthPacking",function(){return Gt}),
/* harmony export (binding) */n.d(t,"TangentSpaceNormalMap",function(){return Dt}),
/* harmony export (binding) */n.d(t,"ObjectSpaceNormalMap",function(){return Vt}),
/* harmony export (binding) */n.d(t,"CubeGeometry",function(){return BoxGeometry}),
/* harmony export (binding) */n.d(t,"Face4",function(){return Face4}),
/* harmony export (binding) */n.d(t,"LineStrip",function(){return On}),
/* harmony export (binding) */n.d(t,"LinePieces",function(){return Bn}),
/* harmony export (binding) */n.d(t,"MeshFaceMaterial",function(){return MeshFaceMaterial}),
/* harmony export (binding) */n.d(t,"MultiMaterial",function(){return MultiMaterial}),
/* harmony export (binding) */n.d(t,"PointCloud",function(){return PointCloud}),
/* harmony export (binding) */n.d(t,"Particle",function(){return Particle}),
/* harmony export (binding) */n.d(t,"ParticleSystem",function(){return ParticleSystem}),
/* harmony export (binding) */n.d(t,"PointCloudMaterial",function(){return PointCloudMaterial}),
/* harmony export (binding) */n.d(t,"ParticleBasicMaterial",function(){return ParticleBasicMaterial}),
/* harmony export (binding) */n.d(t,"ParticleSystemMaterial",function(){return ParticleSystemMaterial}),
/* harmony export (binding) */n.d(t,"Vertex",function(){return Vertex}),
/* harmony export (binding) */n.d(t,"DynamicBufferAttribute",function(){return DynamicBufferAttribute}),
/* harmony export (binding) */n.d(t,"Int8Attribute",function(){return Int8Attribute}),
/* harmony export (binding) */n.d(t,"Uint8Attribute",function(){return Uint8Attribute}),
/* harmony export (binding) */n.d(t,"Uint8ClampedAttribute",function(){return Uint8ClampedAttribute}),
/* harmony export (binding) */n.d(t,"Int16Attribute",function(){return Int16Attribute}),
/* harmony export (binding) */n.d(t,"Uint16Attribute",function(){return Uint16Attribute}),
/* harmony export (binding) */n.d(t,"Int32Attribute",function(){return Int32Attribute}),
/* harmony export (binding) */n.d(t,"Uint32Attribute",function(){return Uint32Attribute}),
/* harmony export (binding) */n.d(t,"Float32Attribute",function(){return Float32Attribute}),
/* harmony export (binding) */n.d(t,"Float64Attribute",function(){return Float64Attribute}),
/* harmony export (binding) */n.d(t,"ClosedSplineCurve3",function(){return ClosedSplineCurve3}),
/* harmony export (binding) */n.d(t,"SplineCurve3",function(){return SplineCurve3}),
/* harmony export (binding) */n.d(t,"Spline",function(){return Spline}),
/* harmony export (binding) */n.d(t,"AxisHelper",function(){return AxisHelper}),
/* harmony export (binding) */n.d(t,"BoundingBoxHelper",function(){return BoundingBoxHelper}),
/* harmony export (binding) */n.d(t,"EdgesHelper",function(){return EdgesHelper}),
/* harmony export (binding) */n.d(t,"WireframeHelper",function(){return WireframeHelper}),
/* harmony export (binding) */n.d(t,"XHRLoader",function(){return XHRLoader}),
/* harmony export (binding) */n.d(t,"BinaryTextureLoader",function(){return BinaryTextureLoader}),
/* harmony export (binding) */n.d(t,"GeometryUtils",function(){return Rn}),
/* harmony export (binding) */n.d(t,"Projector",function(){return Projector}),
/* harmony export (binding) */n.d(t,"CanvasRenderer",function(){return CanvasRenderer}),
/* harmony export (binding) */n.d(t,"SceneUtils",function(){return Gn}),
/* harmony export (binding) */n.d(t,"LensFlare",function(){return LensFlare}),
// Polyfills
void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(
// Missing in IE
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger
Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),
//
void 0===Math.sign&&(
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign
Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&
// Missing in IE
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name
Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}),Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});var r="97",i={LEFT:0,MIDDLE:1,RIGHT:2},a=0,o=1,s=2,l=3,c=0,u=1,h=0,d=1,p=2,f=0,m=1,g=2,y=1,b=2,x=0,_=1,w=2,M=0,E=1,S=2,L=3,T=4,A=5,C=100,P=101,I=102,O=103,B=104,R=200,G=201,D=202,V=203,N=204,U=205,F=206,z=207,k=208,j=209,H=210,W=0,X=1,q=2,Y=3,Z=4,J=5,Q=6,K=7,$=0,ee=1,te=2,ne=0,re=1,ie=2,ae=3,oe=4,se=300,le=301,ce=302,ue=303,he=304,de=305,pe=306,fe=307,me=1e3,ge=1001,ve=1002,ye=1003,be=1004,xe=1005,_e=1006,we=1007,Me=1008,Ee=1009,Se=1010,Le=1011,Te=1012,Ae=1013,Ce=1014,Pe=1015,Ie=1016,Oe=1017,Be=1018,Re=1019,Ge=1020,De=1021,Ve=1022,Ne=1023,Ue=1024,Fe=1025,ze=Ne,ke=1026,je=1027,He=1028,We=33776,Xe=33777,qe=33778,Ye=33779,Ze=35840,Je=35841,Qe=35842,Ke=35843,$e=36196,et=37808,tt=37809,nt=37810,rt=37811,it=37812,at=37813,ot=37814,st=37815,lt=37816,ct=37817,ut=37818,ht=37819,dt=37820,pt=37821,ft=2200,mt=2201,gt=2202,vt=2300,yt=2301,bt=2302,xt=2400,_t=2401,wt=2402,Mt=0,Et=1,St=2,Lt=3e3,Tt=3001,At=3007,Ct=3002,Pt=3003,It=3004,Ot=3005,Bt=3006,Rt=3200,Gt=3201,Dt=0,Vt=1,Nt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(
// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function generateUUID(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;
// .toUpperCase() here flattens concatenated strings to save heap memory space.
return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]).toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},
// compute euclidian modulo of m % n
// https://en.wikipedia.org/wiki/Modulo_operation
euclideanModulo:function(e,t){return(e%t+t)%t},
// Linear mapping from range <a1, a2> to range <b1, b2>
mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},
// https://en.wikipedia.org/wiki/Linear_interpolation
lerp:function(e,t,n){return(1-n)*e+n*t},
// http://en.wikipedia.org/wiki/Smoothstep
smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},
// Random integer from <low, high> interval
randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},
// Random float from <low, high> interval
randFloat:function(e,t){return e+Math.random()*(t-e)},
// Random float from <-range/2, range/2> interval
randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Nt.DEG2RAD},radToDeg:function(e){return e*Nt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};
/**
 * @author mrdoob / http://mrdoob.com/
 * @author philogb / http://blog.thejit.org/
 * @author egraether / http://egraether.com/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 */
function Vector2(e,t){this.x=e||0,this.y=t||0}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author philogb / http://blog.thejit.org/
 * @author jordi_ros / http://plattsoft.com
 * @author D1plo1d / http://github.com/D1plo1d
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author timknip / http://www.floorplanner.com/
 * @author bhouston / http://clara.io
 * @author WestLangley / http://github.com/WestLangley
 */
function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}
/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://clara.io
 */
function Quaternion(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author kile / http://kile.stravaganza.org/
 * @author philogb / http://blog.thejit.org/
 * @author mikael emtinger / http://gomo.se/
 * @author egraether / http://egraether.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function Vector3(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://clara.io
 * @author tschw
 */
function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){
// assumes min < max, componentwise
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Vector2,t=new Vector2;return function clampScalar(n,r){return e.set(n,n),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){
// computes the angle in radians with respect to the positive x-axis
var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}}),Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,a,o,s,l,c,u,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new Vector3;return function extractRotation(t){
// this method does not support reflection matrices
var n=this.elements,r=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-o*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*o,t[4]=v*o-g,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=g*o-v,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*o,t[4]=-a*u,t[8]=v+g*o,t[1]=g+v*o,t[5]=a*c,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var b=a*s,x=a*l,_=o*s,w=o*l;t[0]=s*c,t[4]=w-b*u,t[8]=_*u+x,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=x*u+_,t[10]=b-w*u}else if("XZY"===e.order){b=a*s,x=a*l,_=o*s,w=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=b*u+w,t[5]=a*c,t[9]=x*u-_,t[2]=_*u-x,t[6]=o*c,t[10]=w*u+b}
// bottom row
return t[3]=0,t[7]=0,t[11]=0,
// last column
t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new Vector3(0,0,0),t=new Vector3(1,1,1);return function makeRotationFromQuaternion(n){return this.compose(e,n,t)}}(),lookAt:function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function lookAt(r,i,a){var o=this.elements;return n.subVectors(r,i),0===n.lengthSq()&&(
// eye and target are in the same position
n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(
// up and z are parallel
1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],M=r[8],E=r[12],S=r[1],L=r[5],T=r[9],A=r[13],C=r[2],P=r[6],I=r[10],O=r[14],B=r[3],R=r[7],G=r[11],D=r[15];return i[0]=a*_+o*S+s*C+l*B,i[4]=a*w+o*L+s*P+l*R,i[8]=a*M+o*T+s*I+l*G,i[12]=a*E+o*A+s*O+l*D,i[1]=c*_+u*S+h*C+d*B,i[5]=c*w+u*L+h*P+d*R,i[9]=c*M+u*T+h*I+d*G,i[13]=c*E+u*A+h*O+d*D,i[2]=p*_+f*S+m*C+g*B,i[6]=p*w+f*L+m*P+g*R,i[10]=p*M+f*T+m*I+g*G,i[14]=p*E+f*A+m*O+g*D,i[3]=v*_+y*S+b*C+x*B,i[7]=v*w+y*L+b*P+x*R,i[11]=v*M+y*T+b*I+x*G,i[15]=v*E+y*A+b*O+x*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];
//TODO: make this more efficient
//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )
return e[3]*(+i*s*u-r*l*u-i*o*h+n*l*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*a*h-r*a*d+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*d-i*a*u+n*a*d+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*h+r*a*u-n*a*h+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){
// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm
var n=this.elements,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],x=p*y*h-v*f*h+v*u*m-c*y*m-p*u*b+c*f*b,_=g*f*h-d*y*h-g*u*m+l*y*m+d*u*b-l*f*b,w=d*v*h-g*p*h+g*c*m-l*v*m-d*c*b+l*p*b,M=g*p*u-d*v*u-g*c*f+l*v*f+d*c*y-l*p*y,E=i*x+a*_+o*w+s*M;if(0===E){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var L=1/E;return n[0]=x*L,n[1]=(v*f*s-p*y*s-v*o*m+a*y*m+p*o*b-a*f*b)*L,n[2]=(c*y*s-v*u*s+v*o*h-a*y*h-c*o*b+a*u*b)*L,n[3]=(p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m)*L,n[4]=_*L,n[5]=(d*y*s-g*f*s+g*o*m-i*y*m-d*o*b+i*f*b)*L,n[6]=(g*u*s-l*y*s-g*o*h+i*y*h+l*o*b-i*u*b)*L,n[7]=(l*f*s-d*u*s+d*o*h-i*f*h-l*o*m+i*u*m)*L,n[8]=w*L,n[9]=(g*p*s-d*v*s-g*a*m+i*v*m+d*a*b-i*p*b)*L,n[10]=(l*v*s-g*c*s+g*a*h-i*v*h-l*a*b+i*c*b)*L,n[11]=(d*c*s-l*p*s-d*a*h+i*p*h+l*a*m-i*c*m)*L,n[12]=M*L,n[13]=(d*v*o-g*p*o+g*a*f-i*v*f-d*a*y+i*p*y)*L,n[14]=(g*c*o-l*v*o-g*a*u+i*v*u+l*a*y-i*c*y)*L,n[15]=(l*p*o-d*c*o+d*a*u-i*p*u-l*a*f+i*c*f)*L,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){
// Based on http://www.gamedev.net/reference/articles/article1199.asp
var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+n,c*s-r*a,0,l*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,p=i*u,f=a*c,m=a*u,g=o*u,v=s*l,y=s*c,b=s*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-b)*_,r[5]=(1-(h+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(){var e=new Vector3,t=new Matrix4;return function decompose(n,r,i){var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),l=e.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),n.x=a[12],n.y=a[13],n.z=a[14],
// scale the rotation part
t.copy(this);var c=1/o,u=1/s,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),i.x=o,i.y=s,i.z=l,this}}(),makePerspective:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),l=1/(n-r),c=1/(a-i),u=(t+e)*s,h=(n+r)*l,d=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),Object.assign(Quaternion,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,a,o){
// fuzz-free, array-based Quaternion SLERP operation
var s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(u!==f||s!==h||l!==d||c!==p){var m=1-o,g=s*h+l*d+c*p+u*f,v=g>=0?1:-1,y=1-g*g;
// Skip the Slerp for tiny steps to avoid numeric problems:
if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,g*v);m=Math.sin(m*x)/b,o=Math.sin(o*x)/b}var _=o*v;
// Normalize in case we just did a lerp:
if(s=s*m+h*_,l=l*m+d*_,c=c*m+p*_,u=u*m+f*_,m===1-o){var w=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=w,l*=w,c*=w,u*=w}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=s(n/2),d=s(r/2),p=s(i/2);
// http://www.mathworks.com/matlabcentral/fileexchange/
//  20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/
//  content/SpinCalc.m
return"XYZ"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===a?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===a?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===a&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm
// assumes axis is normalized
var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
var t,n=e.elements,r=n[0],i=n[4],a=n[8],o=n[1],s=n[5],l=n[9],c=n[2],u=n[6],h=n[10],d=r+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-i)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+c)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(a-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(o-i)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){
// assumes direction vectors vFrom and vTo are normalized
var e,t=new Vector3;return function setFromUnitVectors(n,r){return void 0===t&&(t=new Vector3),(e=n.dot(r)+1)<1e-6?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(Nt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){
// quaternion is assumed to have unit length
return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){
// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm
var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+r*l-i*s,this._y=r*c+a*s+i*o-n*l,this._z=i*c+a*l+n*s-r*o,this._w=a*c-n*o-r*s-i*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;
// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/
if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Vector3.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new Quaternion;return function applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new Quaternion;return function applyAxisAngle(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,c=s*n+o*t-i*r,u=s*r+i*n-a*t,h=-i*t-a*n-o*r;
// calculate result * inverse quat
return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new Matrix4;return function unproject(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){
// input: THREE.Matrix4 affine matrix
// vector interpreted as a direction
var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){
// assumes min < max, componentwise
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Vector3,t=new Vector3;return function clampScalar(n,r){return e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},
// TODO lengthSquared?
lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Vector3;return function projectOnPlane(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){
// reflect incident vector off plane orthogonal to normal
// normal is assumed to have unit length
var e=new Vector3;return function reflect(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());
// clamp, to handle numerical problems
return Math.acos(Nt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=a*f+o*v+s*x,i[3]=a*m+o*y+s*_,i[6]=a*g+o*b+s*w,i[1]=l*f+c*v+u*x,i[4]=l*m+c*y+u*_,i[7]=l*g+c*b+u*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*_,i[8]=h*g+d*b+p*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,g=i*p+a*f+o*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return r[0]=p*y,r[1]=(o*h-d*a)*y,r[2]=(c*a-o*l)*y,r[3]=f*y,r[4]=(d*i-o*u)*y,r[5]=(o*s-c*i)*y,r[6]=m*y,r[7]=(a*u-h*i)*y,r[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*c,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*c,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 */
var Ut={getDataURL:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var n=t.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Ft=0;
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 */function Texture(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(this,"id",{value:Ft++}),this.uuid=Nt.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:ge,this.wrapT=void 0!==r?r:ge,this.magFilter=void 0!==i?i:_e,this.minFilter=void 0!==a?a:Me,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Ne,this.type=void 0!==s?s:Ee,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)
// Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.
//
// Also changing the encoding after already used by a Material will not automatically make the Material
// update.  You need to explicitly call Material.needsUpdate to trigger it to recompile.
this.encoding=void 0!==c?c:Lt,this.version=0,this.onUpdate=null}
/**
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author philogb / http://blog.thejit.org/
 * @author mikael emtinger / http://gomo.se/
 * @author egraether / http://egraether.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function Vector4(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}
/**
 * @author szimek / https://github.com/szimek/
 * @author alteredq / http://alteredqualia.com/
 * @author Marius Kintel / https://github.com/kintel
 */
/*
 In options, we can specify:
 * Texture parameters for an auto-generated target texture
 * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers
*/
function WebGLRenderTarget(e,t,n){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),void 0===(n=n||{}).minFilter&&(n.minFilter=_e),this.texture=new Texture(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.generateMipmaps=void 0===n.generateMipmaps||n.generateMipmaps,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}
/**
 * @author alteredq / http://alteredqualia.com
 */
function WebGLRenderTargetCube(e,t,n){WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0,// PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5
this.activeMipMapLevel=0}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function DataTexture(e,t,n,r,i,a,o,s,l,c,u,h){Texture.call(this,null,a,o,s,l,c,r,i,u,h),this.image={data:e,width:t,height:n},this.magFilter=void 0!==l?l:ye,this.minFilter=void 0!==c?c:ye,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}
/**
 * @author bhouston / http://clara.io
 * @author WestLangley / http://github.com/WestLangley
 */
function Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}
/**
 * @author bhouston / http://clara.io
 * @author mrdoob / http://mrdoob.com/
 */
function Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}
/**
 * @author bhouston / http://clara.io
 */
function Plane(e,t){
// normal is assumed to be normalized
this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author bhouston / http://clara.io
 */
function Frustum(e,t,n,r,i,a){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==n?n:new Plane,void 0!==r?r:new Plane,void 0!==i?i:new Plane,void 0!==a?a:new Plane]}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=se,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){
// TODO: Move to THREE.Image
var r=this.image;if(void 0===r.uuid&&(r.uuid=Nt.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){
// process array of images e.g. CubeTexture
i=[];for(var a=0,o=r.length;a<o;a++)i.push(Ut.getDataURL(r[a]))}else
// process single image
i=Ut.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==se)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case me:e.x=e.x-Math.floor(e.x);break;case ge:e.x=e.x<0?0:1;break;case ve:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case me:e.y=e.y-Math.floor(e.y);break;case ge:e.y=e.y<0?0:1;break;case ve:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm
// q is assumed to be normalized
this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
var t,n,r,i,// margin to distinguish between 0 and 180 degrees
a=e.elements,o=a[0],s=a[4],l=a[8],c=a[1],u=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){
// singularity found
// first check for identity matrix which must have +1 for all terms
// in leading diagonal and zero in other terms
if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)
// this singularity is identity matrix so angle = 0
return this.set(1,0,0,0),this;// zero angle, arbitrary axis
// otherwise this singularity is angle = 180
t=Math.PI;var m=(o+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+c)/4,b=(l+d)/4,x=(h+p)/4;return m>g&&m>v?
// m11 is the largest diagonal term
m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=b/n):g>v?
// m22 is the largest diagonal term
g<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(g)),i=x/r):
// m33 is the largest diagonal term so base result on this
v<.01?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(v)),r=x/i),this.set(n,r,i,t),this;// return 180 deg rotation
}
// as we have reached here there are no singularities so we can handle normally
var _=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-s)*(c-s));// used to normalize
return Math.abs(_)<.001&&(_=1),
// prevent divide by zero, should not happen if matrix is orthogonal and should be
// caught by singularity test above, but I've left it in just in case
this.x=(p-h)/_,this.y=(l-d)/_,this.z=(c-s)/_,this.w=Math.acos((o+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){
// assumes min < max, componentwise
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function clampScalar(n,r){return void 0===e&&(e=new Vector4,t=new Vector4),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype),WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube,WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0,DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0,Object.assign(Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector3;return function setFromCenterAndSize(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){
// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes
return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){
// Computes the world-axis-aligned bounding box of an object (including its children),
// accounting for both the object's, and children's, world transforms
var e,t,n,r=new Vector3;function traverse(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,n=o.length;t<n;t++)r.copy(o[t]),r.applyMatrix4(i.matrixWorld),e.expandByPoint(r)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,n=s.count;t<n;t++)r.fromBufferAttribute(s,t).applyMatrix4(i.matrixWorld),e.expandByPoint(r)}}return function expandByObject(t){return e=this,t.updateMatrixWorld(!0),t.traverse(traverse),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){
// This can potentially have a divide by zero if the box
// has a size dimension of 0.
return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){
// using 6 splitting planes to rule out intersections.
return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new Vector3;return function intersectsSphere(t){
// If that point is inside the sphere, the AABB and sphere intersect.
// Find the point on the AABB closest to the sphere center.
return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){
// We compute the minimum and maximum dot product values. If those values
// are on the same side (back or front) of the plane, then there is no intersection.
var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(){
// triangle centered vertices
var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3,i=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector3;function satForAxes(r){var i,a;for(i=0,a=r.length-3;i<=a;i+=3){o.fromArray(r,i);
// project the aabb onto the seperating axis
var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),c=e.dot(o),u=t.dot(o),h=n.dot(o);
// project all 3 vertices of the triangle onto the seperating axis
// actual test, basically see if either of the most extreme of the triangle points intersects r
if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)
// points of the projected triangle are outside the projected half-length of the aabb
// the axis is seperating and we can exit
return!1}return!0}return function intersectsTriangle(o){if(this.isEmpty())return!1;
// compute box center and extents
this.getCenter(s),l.subVectors(this.max,s),
// translate triangle to aabb origin
e.subVectors(o.a,s),t.subVectors(o.b,s),n.subVectors(o.c,s),
// compute edge vectors for triangle
r.subVectors(t,e),i.subVectors(n,t),a.subVectors(e,n);
// test against axes that are given by cross product combinations of the edges of the triangle and the edges of the aabb
// make an axis testing of each of the 3 sides of the aabb against each of the 3 sides of the triangle = 9 axis of separation
// axis_ij = u_i x f_j (u0, u1, u2 = face normals of aabb = x,y,z axes vectors since aabb is axis aligned)
var u=[0,-r.z,r.y,0,-i.z,i.y,0,-a.z,a.y,r.z,0,-r.x,i.z,0,-i.x,a.z,0,-a.x,-r.y,r.x,0,-i.y,i.x,0,-a.y,a.x,0];return!!satForAxes(u)&&(!!satForAxes(
// test 3 face normals from the aabb
u=[1,0,0,0,1,0,0,0,1])&&(
// finally testing the face normal of the triangle
// use already existing triangle edge vectors here
c.crossVectors(r,i),satForAxes(u=[c.x,c.y,c.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector3;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Vector3;return function getBoundingSphere(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Sphere),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),
// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.
this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3];return function applyMatrix4(t){
// transform of empty box is an empty box.
return this.isEmpty()?this:(
// NOTE: I am using a binary pattern to specify all 2^3 combinations below
e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),// 000
e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),// 001
e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),// 010
e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),// 011
e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),// 100
e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),// 101
e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),// 110
e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),// 111
this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Box3;return function setFromPoints(t,n){var r=this.center;void 0!==n?r.copy(n):e.setFromPoints(t).getCenter(r);for(var i=0,a=0,o=t.length;a<o;a++)i=Math.max(i,r.distanceToSquared(t[a]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(Plane.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Vector3,t=new Vector3;return function setFromCoplanarPoints(n,r,i){var a=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();
// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?
return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){
// Note: will lead to a divide by zero if the plane is invalid.
var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Vector3;return function intersectLine(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new Vector3);var r=t.delta(e),i=this.normal.dot(r);if(0===i)
// line is coplanar, return origin
return 0===this.distanceToPoint(t.start)?n.copy(t.start):
// Unsure if this is the correct method to handle this case.
void 0;var a=-(t.start.dot(this.normal)+this.constant)/i;return a<0||a>1?void 0:n.copy(r).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){
// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.
var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Vector3,t=new Matrix3;return function applyMatrix4(n,r){var i=r||t.getNormalMatrix(n),a=this.coplanarPoint(e).applyMatrix4(n),o=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Frustum.prototype,{set:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-r,u-s,f-h,y-m).normalize(),t[1].setComponents(o+r,u+s,f+h,y+m).normalize(),t[2].setComponents(o+i,u+l,f+d,y+g).normalize(),t[3].setComponents(o-i,u-l,f-d,y-g).normalize(),t[4].setComponents(o-a,u-c,f-p,y-v).normalize(),t[5].setComponents(o+a,u+c,f+p,y+v).normalize(),this},intersectsObject:function(){var e=new Sphere;return function intersectsObject(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Sphere;return function intersectsSprite(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){for(var n=this.planes,r=0;r<6;r++){var i=n[r];
// corner at max distance
if(e.x=i.normal.x>0?t.max.x:t.min.x,e.y=i.normal.y>0?t.max.y:t.min.y,e.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(e)<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var zt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif\n",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif\n",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n}\n",background_vert:"varying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = vec4( position, 1.0 );\n\tgl_Position.z = 1.0;\n}\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\tvec4 matcapColor = texture2D( matcap, uv );\n\tmatcapColor = matcapTexelToLinear( matcapColor );\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n"},kt={merge:function(e){for(var t={},n=0;n<e.length;n++){var r=this.clone(e[n]);for(var i in r)t[i]=r[i]}return t},clone:function(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}},jt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Color(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function hue2rgb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function setHSL(e,t,n){if(
// h,s,l ranges are in 0.0 - 1.0
e=Nt.euclideanModulo(e,1),t=Nt.clamp(t,0,1),n=Nt.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=hue2rgb(i,r,e+1/3),this.g=hue2rgb(i,r,e),this.b=hue2rgb(i,r,e-1/3)}return this}}(),setStyle:function(e){function handleAlpha(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var t;if(t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){
// rgb / hsl
var n,r=t[1],i=t[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))
// rgb(255,0,0) rgba(255,0,0,0.5)
return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,handleAlpha(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))
// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)
return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,handleAlpha(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){
// hsl(120,50%,50%) hsla(120,50%,50%,0.5)
var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return handleAlpha(n[5]),this.setHSL(a,o,s)}}}else if(t=/^\#([A-Fa-f0-9]+)$/.exec(e)){
// hex color
var l,c=(l=t[1]).length;if(3===c)
// #ff0
return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)
// #ff0000
return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(l=jt[e])?
// red
this.setHex(l):
// unknown color
console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}}(),copyLinearToSRGB:function(){function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){
// h,s,l ranges are in 0.0 - 1.0
void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),l=(s+o)/2;if(s===o)t=0,n=0;else{var c=o-s;switch(n=l<=.5?c/(o+s):c/(2-o-s),o){case r:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-r)/c+2;break;case a:t=(r-i)/c+4}t/=6}return e.h=t,e.s=n,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,n,r){return this.getHSL(e),e.h+=t,e.s+=n,e.l+=r,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function lerpHSL(n,r){this.getHSL(e),n.getHSL(t);var i=Nt.lerp(e.h,t.h,r),a=Nt.lerp(e.s,t.s,r),o=Nt.lerp(e.l,t.l,r);return this.setHSL(i,a,o),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});
/**
 * Uniforms library for shared webgl shaders
 */
var Ht={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},
// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src
rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Matrix3}}},Wt={basic:{uniforms:kt.merge([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.fog]),vertexShader:zt.meshbasic_vert,fragmentShader:zt.meshbasic_frag},lambert:{uniforms:kt.merge([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.fog,Ht.lights,{emissive:{value:new Color(0)}}]),vertexShader:zt.meshlambert_vert,fragmentShader:zt.meshlambert_frag},phong:{uniforms:kt.merge([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.gradientmap,Ht.fog,Ht.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:zt.meshphong_vert,fragmentShader:zt.meshphong_frag},standard:{uniforms:kt.merge([Ht.common,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.roughnessmap,Ht.metalnessmap,Ht.fog,Ht.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:zt.meshphysical_vert,fragmentShader:zt.meshphysical_frag},matcap:{uniforms:kt.merge([Ht.common,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.fog,{matcap:{value:null}}]),vertexShader:zt.meshmatcap_vert,fragmentShader:zt.meshmatcap_frag},points:{uniforms:kt.merge([Ht.points,Ht.fog]),vertexShader:zt.points_vert,fragmentShader:zt.points_frag},dashed:{uniforms:kt.merge([Ht.common,Ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zt.linedashed_vert,fragmentShader:zt.linedashed_frag},depth:{uniforms:kt.merge([Ht.common,Ht.displacementmap]),vertexShader:zt.depth_vert,fragmentShader:zt.depth_frag},normal:{uniforms:kt.merge([Ht.common,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,{opacity:{value:1}}]),vertexShader:zt.normal_vert,fragmentShader:zt.normal_frag},sprite:{uniforms:kt.merge([Ht.sprite,Ht.fog]),vertexShader:zt.sprite_vert,fragmentShader:zt.sprite_frag},background:{uniforms:{t2D:{value:null}},vertexShader:zt.background_vert,fragmentShader:zt.background_frag},
/* -------------------------------------------------------------------------
    //  Cube map shader
     ------------------------------------------------------------------------- */
cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:zt.cube_vert,fragmentShader:zt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zt.equirect_vert,fragmentShader:zt.equirect_frag},distanceRGBA:{uniforms:kt.merge([Ht.common,Ht.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zt.distanceRGBA_vert,fragmentShader:zt.distanceRGBA_frag},shadow:{uniforms:kt.merge([Ht.lights,Ht.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:zt.shadow_vert,fragmentShader:zt.shadow_frag}};
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 */
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLAnimation(){var e=null,t=!1,n=null;function onAnimationFrame(r,i){!1!==t&&(n(r,i),e.requestAnimationFrame(onAnimationFrame))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(onAnimationFrame),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */function WebGLAttributes(e){var t=new WeakMap;return{get:
//
function get(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function remove(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function update(n,r){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);void 0===i?t.set(n,function createBuffer(t,n){var r=t.array,i=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,r,i),t.onUploadCallback();var o=e.FLOAT;return r instanceof Float32Array?o=e.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=e.UNSIGNED_SHORT:r instanceof Int16Array?o=e.SHORT:r instanceof Uint32Array?o=e.UNSIGNED_INT:r instanceof Int32Array?o=e.INT:r instanceof Int8Array?o=e.BYTE:r instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(n,r)):i.version<n.version&&(function updateBuffer(t,n,r){var i=n.array,a=n.updateRange;e.bindBuffer(r,t),!1===n.dynamic?e.bufferData(r,i,e.STATIC_DRAW):-1===a.count?
// Not using update ranges
e.bufferSubData(r,0,i):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,a.offset*i.BYTES_PER_ELEMENT,i.subarray(a.offset,a.offset+a.count)),a.count=-1)}(i.buffer,n,r),i.version=n.version)}}}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */function Face3(e,t,n,r,i,a){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://clara.io
 */
function Euler(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||Euler.DefaultOrder}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Layers(){this.mask=1}Wt.physical={uniforms:kt.merge([Wt.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:zt.meshphysical_vert,fragmentShader:zt.meshphysical_frag},Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=Nt.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Matrix4;return function setFromQuaternion(t,n,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){
// WARNING: this discards revolution information -bhouston
var e=new Quaternion;return function reorder(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});
/**
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author elephantatwork / www.elephantatwork.ch
 */
var Xt=0;function Object3D(){Object.defineProperty(this,"id",{value:Xt++}),this.uuid=Nt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,n=new Quaternion,r=new Vector3(1,1,1);t.onChange(function onRotationChange(){n.setFromEuler(t,!1)}),n.onChange(function onQuaternionChange(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){
// assumes axis is normalized
this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){
// assumes q is normalized
this.quaternion.copy(e)},rotateOnAxis:function(){
// rotate object on axis in object space
// axis is assumed to be normalized
var e=new Quaternion;return function rotateOnAxis(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){
// rotate object on axis in world space
// axis is assumed to be normalized
// method assumes no rotated parent
var e=new Quaternion;return function rotateOnWorldAxis(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Vector3(1,0,0);return function rotateX(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Vector3(0,1,0);return function rotateY(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Vector3(0,0,1);return function rotateZ(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){
// translate object by distance along axis in object space
// axis is assumed to be normalized
var e=new Vector3;return function translateOnAxis(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new Vector3(1,0,0);return function translateX(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Vector3(0,1,0);return function translateY(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Vector3(0,0,1);return function translateZ(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Matrix4;return function worldToLocal(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){
// This method does not support objects having non-uniformly-scaled parent(s)
var e=new Quaternion,t=new Matrix4,n=new Vector3,r=new Vector3;return function lookAt(i,a,o){i.isVector3?n.copy(i):n.set(i,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(r,n,this.up):t.lookAt(n,r,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new Vector3,t=new Vector3;return function getWorldQuaternion(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldScale:function(){var e=new Vector3,t=new Quaternion;return function getWorldScale(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(
// update children
var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;
// update children
if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){
// meta is a string when called from JSON.stringify
var t=void 0===e||"string"==typeof e,n={};
// meta is a hash used to collect geometries, materials.
// not providing it implies that this is the root object
// being serialized.
t&&(
// initialize meta obj
e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});
// standard Object3D serialization
var r={};
//
function serialize(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){r.geometry=serialize(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var a=i.shapes;if(Array.isArray(a))for(var o=0,s=a.length;o<s;o++){var l=a[o];serialize(e.shapes,l)}else serialize(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(o=0,s=this.material.length;o<s;o++)c.push(serialize(e.materials,this.material[o]));r.material=c}else r.material=serialize(e.materials,this.material);
//
if(this.children.length>0){r.children=[];for(o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(t){var u=extractFromCache(e.geometries),h=extractFromCache(e.materials),d=extractFromCache(e.textures),p=extractFromCache(e.images);a=extractFromCache(e.shapes);u.length>0&&(n.geometries=u),h.length>0&&(n.materials=h),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),a.length>0&&(n.shapes=a)}return n.object=r,n;
// extract data from the cache hash
// remove metadata on each item
// and return as array
function extractFromCache(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}});
/**
 * @author mrdoob / http://mrdoob.com/
 * @author kile / http://kile.stravaganza.org/
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author bhouston / http://clara.io
 */
var qt=0;// Geometry uses even numbers as Id
function Geometry(){Object.defineProperty(this,"id",{value:qt+=2}),this.uuid=Nt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,
// update flags
this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function BufferAttribute(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}
//
function Int8BufferAttribute(e,t,n){BufferAttribute.call(this,new Int8Array(e),t,n)}function Uint8BufferAttribute(e,t,n){BufferAttribute.call(this,new Uint8Array(e),t,n)}function Uint8ClampedBufferAttribute(e,t,n){BufferAttribute.call(this,new Uint8ClampedArray(e),t,n)}function Int16BufferAttribute(e,t,n){BufferAttribute.call(this,new Int16Array(e),t,n)}function Uint16BufferAttribute(e,t,n){BufferAttribute.call(this,new Uint16Array(e),t,n)}function Int32BufferAttribute(e,t,n){BufferAttribute.call(this,new Int32Array(e),t,n)}function Uint32BufferAttribute(e,t,n){BufferAttribute.call(this,new Uint32Array(e),t,n)}function Float32BufferAttribute(e,t,n){BufferAttribute.call(this,new Float32Array(e),t,n)}function Float64BufferAttribute(e,t,n){BufferAttribute.call(this,new Float64Array(e),t,n)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],
// this.lineDistances = [];
this.boundingBox=null,this.boundingSphere=null,
// update flags
this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function(e){for(var t=(new Matrix3).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){
// rotate geometry around world x-axis
var e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){
// rotate geometry around world y-axis
var e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){
// rotate geometry around world z-axis
var e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){
// translate geometry
var e=new Matrix4;return function translate(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){
// scale geometry
var e=new Matrix4;return function scale(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes,i=r.position.array,a=void 0!==r.normal?r.normal.array:void 0,o=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)t.vertices.push(new Vector3(i[d],i[d+1],i[d+2])),void 0!==a&&c.push(new Vector3(a[d],a[d+1],a[d+2])),void 0!==o&&t.colors.push(new Color(o[d],o[d+1],o[d+2])),void 0!==s&&u.push(new Vector2(s[p],s[p+1])),void 0!==l&&h.push(new Vector2(l[p],l[p+1]));function addFace(e,n,r,i){var d=new Face3(e,n,r,void 0!==a?[c[e].clone(),c[n].clone(),c[r].clone()]:[],void 0!==o?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[],i);t.faces.push(d),void 0!==s&&t.faceVertexUvs[0].push([u[e].clone(),u[n].clone(),u[r].clone()]),void 0!==l&&t.faceVertexUvs[1].push([h[e].clone(),h[n].clone(),h[r].clone()])}var f=e.groups;if(f.length>0)for(d=0;d<f.length;d++)for(var m=f[d],g=m.start,v=(p=g,g+m.count);p<v;p+=3)void 0!==n?addFace(n[p],n[p+1],n[p+2],m.materialIndex):addFace(p,p+1,p+2,m.materialIndex);else if(void 0!==n)for(d=0;d<n.length;d+=3)addFace(n[d],n[d+1],n[d+2]);else for(d=0;d<i.length/3;d+=3)addFace(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Matrix4;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new Vector3;if(e){
// vertex normals weighted by triangle areas
// http://www.iquilezles.org/www/articles/normals/normals.htm
var s,l,c,u=new Vector3,h=new Vector3;for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],s=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)o[(a=this.faces[r]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var d=(a=this.faces[r]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;
// save original normals
// - create temp variables on first access
//   otherwise just copy (for faster repeated calls)
for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();
// use temp geometry to compute face and vertex normals for each morph
var a=new Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){
// create on first access
if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)l=new Vector3,c={a:new Vector3,b:new Vector3,c:new Vector3},o.push(l),s.push(c)}var l,c,u=this.morphNormals[e];
// set vertices to morph target
for(a.vertices=this.morphTargets[e].vertices,
// compute morph normals
a.computeFaceNormals(),a.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}
// restore original normals
for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new Matrix3).getNormalMatrix(t));
// vertices
for(var p=0,f=o.length;p<f;p++){var m=o[p].clone();void 0!==t&&m.applyMatrix4(t),a.push(m)}
// colors
for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());
// faces
for(p=0,f=l.length;p<f;p++){var g,v,y,b=l[p],x=b.vertexNormals,_=b.vertexColors;(g=new Face3(b.a+i,b.b+i,b.c+i)).normal.copy(b.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var w=0,M=x.length;w<M;w++)v=x[w].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(b.color);for(w=0,M=_.length;w<M;w++)y=_[w],g.vertexColors.push(y.clone());g.materialIndex=b.materialIndex+n,s.push(g)}
// uvs
for(p=0,f=u.length;p<f;p++){var E=u[p],S=[];if(void 0!==E){for(w=0,M=E.length;w<M;w++)S.push(E[w].clone());c.push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},
/*
     * Checks for duplicate vertices with hashmap.
     * Duplicated vertices are removed
     * and faces' vertices are updated.
     */
mergeVertices:function(){var e,t,n,r,i,a,o,s,l={},c=[],u=[],h=Math.pow(10,4);// Hashmap for looking up vertices by position coordinates (and making sure they are unique)
for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):
//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);
u[n]=u[l[t]];
// if faces are completely degenerate after merging vertices, we
// have to remove them from the geometry.
var d=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],a=[i.a,i.b,i.c];
// if any duplicate vertices are found in a Face3
// we have to remove the face as nothing can be saved
for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var f=d[n];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}
// Use unique set of vertices
var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){
// tag faces
for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;
// sort faces
e.sort(function materialIndexSort(e,t){return e.materialIndex-t.materialIndex});
// sort uvs
var r,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(a[s]),i&&i.push(o[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};
// standard Geometry serialization
if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}var o=[],s=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=setBit(b=setBit(b=setBit(b=setBit(b=setBit(b=setBit(// isQuad
b=setBit(b=setBit(b,0,0),1,!0),2,!1),3,f),4,m),5,g),6,v),7,y),o.push(b),o.push(p.a,p.b,p.c),o.push(p.materialIndex),f){var x=this.faceVertexUvs[0][i];o.push(getUvIndex(x[0]),getUvIndex(x[1]),getUvIndex(x[2]))}if(m&&o.push(getNormalIndex(p.normal)),g){var _=p.vertexNormals;o.push(getNormalIndex(_[0]),getNormalIndex(_[1]),getNormalIndex(_[2]))}if(v&&o.push(getColorIndex(p.color)),y){var w=p.vertexColors;o.push(getColorIndex(w[0]),getColorIndex(w[1]),getColorIndex(w[2]))}}function setBit(e,t,n){return n?e|1<<t:e&~(1<<t)}function getNormalIndex(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function getColorIndex(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function getUvIndex(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),// temporal backward compatibility
e.data.faces=o,e},clone:function(){
/*
         // Handle primitives

         var parameters = this.parameters;

         if ( parameters !== undefined ) {

         var values = [];

         for ( var key in parameters ) {

         values.push( parameters[ key ] );

         }

         var geometry = Object.create( this.constructor.prototype );
         this.constructor.apply( geometry, values );
         return geometry;

         }

         return new this.constructor().copy( this );
         */
return(new Geometry).copy(this)},copy:function(e){var t,n,r,i,a,o;
// reset
this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,
// name
this.name=e.name;
// vertices
var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());
// colors
var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());
// faces
var c=e.faces;for(t=0,n=c.length;t<n;t++)this.faces.push(c[t].clone());
// face vertex uvs
for(t=0,n=e.faceVertexUvs.length;t<n;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=u.length;r<i;r++){var h=u[r],d=[];for(a=0,o=h.length;a<o;a++){var p=h[a];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}
// morph targets
var f=e.morphTargets;for(t=0,n=f.length;t<n;t++){var m={};
// vertices
if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,i=f[t].vertices.length;r<i;r++)m.vertices.push(f[t].vertices[r].clone());
// normals
if(void 0!==f[t].normals)for(m.normals=[],r=0,i=f[t].normals.length;r<i;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}
// morph normals
var g=e.morphNormals;for(t=0,n=g.length;t<n;t++){var v={};
// vertex normals
if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],r=0,i=g[t].vertexNormals.length;r<i;r++){var y=g[t].vertexNormals[r],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}
// face normals
if(void 0!==g[t].faceNormals)for(v.faceNormals=[],r=0,i=g[t].faceNormals.length;r<i;r++)v.faceNormals.push(g[t].faceNormals[r].clone());this.morphNormals.push(v)}
// skin weights
var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());
// skin indices
var _=e.skinIndices;for(t=0,n=_.length;t<n;t++)this.skinIndices.push(_[t].clone());
// line distances
var w=e.lineDistances;for(t=0,n=w.length;t<n;t++)this.lineDistances.push(w[t]);
// bounding box
var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());
// bounding sphere
var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),
// update flags
this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new Color),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new Vector2),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new Vector3),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Vector4),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];
// materials
o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:r})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(c=0;c<d;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}
// skins
var p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,g=f.length===r.length;
//
r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<n.length;c++){var v=n[c];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var x,_=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===a)void 0!==(x=i[0][c])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===o)void 0!==(x=i[1][c])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Vector2,new Vector2,new Vector2));
// morphs
for(var M=0;M<l;M++){var E=s[M].vertices;t[M].data.push(E[v.a],E[v.b],E[v.c])}for(M=0;M<d;M++){var S=h[M].vertexNormals[c];u[M].data.push(S.a,S.b,S.c)}
// skins
m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Yt=1;// BufferGeometry uses odd numbers as Id
function BufferGeometry(){Object.defineProperty(this,"id",{value:Yt+=2}),this.uuid=Nt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
// BoxGeometry
function BoxGeometry(e,t,n,r,i,a){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new BoxBufferGeometry(e,t,n,r,i,a)),this.mergeVertices()}
// BoxBufferGeometry
function BoxBufferGeometry(e,t,n,r,i,a){BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};var o=this;e=e||1,t=t||1,n=n||1,
// segments
r=Math.floor(r)||1,i=Math.floor(i)||1;
// buffers
var s=[],l=[],c=[],u=[],h=0,d=0;function buildPlane(e,t,n,r,i,a,p,f,m,g,v){var y,b,x=a/m,_=p/g,w=a/2,M=p/2,E=f/2,S=m+1,L=g+1,T=0,A=0,C=new Vector3;
// generate vertices, normals and uvs
for(b=0;b<L;b++){var P=b*_-M;for(y=0;y<S;y++){var I=y*x-w;
// set values to correct vector component
C[e]=I*r,C[t]=P*i,C[n]=E,
// now apply vector to vertex buffer
l.push(C.x,C.y,C.z),
// set values to correct vector component
C[e]=0,C[t]=0,C[n]=f>0?1:-1,
// now apply vector to normal buffer
c.push(C.x,C.y,C.z),
// uvs
u.push(y/m),u.push(1-b/g),
// counters
T+=1}}
// indices
// 1. you need three indices to draw a single face
// 2. a single segment consists of two faces
// 3. so we need to generate six (2*3) indices per segment
for(b=0;b<g;b++)for(y=0;y<m;y++){var O=h+y+S*b,B=h+y+S*(b+1),R=h+(y+1)+S*(b+1),G=h+(y+1)+S*b;
// faces
s.push(O,B,G),s.push(B,R,G),
// increase counter
A+=6}
// add a group to the geometry. this will ensure multi material support
o.addGroup(d,A,v),
// calculate new start value for groups
d+=A,
// update total number of vertices
h+=T}
// build each side of the box geometry
buildPlane("z","y","x",-1,-1,n,t,e,a=Math.floor(a)||1,i,0),// px
buildPlane("z","y","x",1,-1,n,t,-e,a,i,1),// nx
buildPlane("x","z","y",1,1,e,n,t,r,a,2),// py
buildPlane("x","z","y",1,-1,e,n,-t,r,a,3),// ny
buildPlane("x","y","z",1,-1,e,t,n,r,i,4),// pz
buildPlane("x","y","z",-1,-1,e,t,-n,r,i,5),// nz
// build geometry
this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2))}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
// PlaneGeometry
function PlaneGeometry(e,t,n,r){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,n,r)),this.mergeVertices()}
// PlaneBufferGeometry
function PlaneBufferGeometry(e,t,n,r){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(n)||1,c=Math.floor(r)||1,u=l+1,h=c+1,d=e/l,p=t/c,f=[],m=[],g=[],v=[];
// generate vertices, normals and uvs
for(a=0;a<h;a++){var y=a*p-s;for(i=0;i<u;i++){var b=i*d-o;m.push(b,-y,0),g.push(0,0,1),v.push(i/l),v.push(1-a/c)}}
// indices
for(a=0;a<c;a++)for(i=0;i<l;i++){var x=i+u*a,_=i+u*(a+1),w=i+1+u*(a+1),M=i+1+u*a;
// faces
f.push(x,_,M),f.push(_,w,M)}
// build geometry
this.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(v,2))}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new Matrix3).getNormalMatrix(e).applyToBufferAttribute(n),n.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){
// rotate geometry around world x-axis
var e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){
// rotate geometry around world y-axis
var e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){
// rotate geometry around world z-axis
var e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){
// translate geometry
var e=new Matrix4;return function translate(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){
// scale geometry
var e=new Matrix4;return function scale(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){
// console.log( 'THREE.BufferGeometry.setFromObject(). Converting', object, this );
var t=e.geometry;if(e.isPoints||e.isLine){var n=new Float32BufferAttribute(3*t.vertices.length,3),r=new Float32BufferAttribute(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Float32BufferAttribute(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new BufferAttribute(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new BufferAttribute(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new BufferAttribute(a,2).copyVector2sArray(e.uvs2))}
// groups
// morphs
for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,u=l.length;c<u;c++){var h=l[c],d=new Float32BufferAttribute(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}
// skinning
if(e.skinIndices.length>0){var p=new Float32BufferAttribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Float32BufferAttribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}
//
return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Box3,t=new Vector3;return function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;e.setFromBufferAttribute(n),e.getCenter(r);for(
// hoping to find a boundingSphere with a radius smaller than the
// boundingSphere of the boundingBox: sqrt(3) smaller in the best case
var i=0,a=0,o=n.count;a<o;a++)t.x=n.getX(a),t.y=n.getY(a),t.z=n.getZ(a),i=Math.max(i,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){
// backwards compatibility
},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(n.length),3));else for(
// reset existing normals to zero
var r=t.normal.array,i=0,a=r.length;i<a;i++)r[i]=0;var o,s,l,c=t.normal.array,u=new Vector3,h=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3;
// indexed elements
if(e){var m=e.array;for(i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(n,o),h.fromArray(n,s),d.fromArray(n,l),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[o]+=p.x,c[o+1]+=p.y,c[o+2]+=p.z,c[s]+=p.x,c[s+1]+=p.y,c[s+2]+=p.z,c[l]+=p.x,c[l+1]+=p.y,c[l+2]+=p.z}else
// non-indexed elements (unconnected triangle soup)
for(i=0,a=n.length;i<a;i+=9)u.fromArray(n,i),h.fromArray(n,i+3),d.fromArray(n,i+6),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[i]=p.x,c[i+1]=p.y,c[i+2]=p.z,c[i+3]=p.x,c[i+4]=p.y,c[i+5]=p.z,c[i+6]=p.x,c[i+7]=p.y,c[i+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=0,l=a.itemSize*t;s<o.length;s++,l++)i[l]=o[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Vector3;return function normalizeNormals(){for(var t=this.attributes.normal,n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new BufferGeometry,t=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],a=i.array,o=i.itemSize,s=new a.constructor(t.length*o),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*o;for(var d=0;d<o;d++)s[c++]=a[l++]}e.addAttribute(r,new BufferAttribute(s,o))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};
// standard BufferGeometry serialization
if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:i}}var a=this.attributes;for(var n in a){var o=a[n];i=Array.prototype.slice.call(o.array);e.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:i,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){
/*
         // Handle primitives

         var parameters = this.parameters;

         if ( parameters !== undefined ) {

         var values = [];

         for ( var key in parameters ) {

         values.push( parameters[ key ] );

         }

         var geometry = Object.create( this.constructor.prototype );
         this.constructor.apply( geometry, values );
         return geometry;

         }

         return new this.constructor().copy( this );
         */
return(new BufferGeometry).copy(this)},copy:function(e){var t,n,r;
// reset
this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,
// name
this.name=e.name;
// index
var i=e.index;null!==i&&this.setIndex(i.clone());
// attributes
var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}
// morph attributes
var s=e.morphAttributes;for(t in s){var l=[],c=s[t];// morphAttribute: array of Float32BufferAttributes
for(n=0,r=c.length;n<r;n++)l.push(c[n].clone());this.morphAttributes[t]=l}
// groups
var u=e.groups;for(n=0,r=u.length;n<r;n++){var h=u[n];this.addGroup(h.start,h.count,h.materialIndex)}
// bounding box
var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());
// bounding sphere
var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),
// draw range
this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,
// user data
this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),BoxGeometry.prototype=Object.create(Geometry.prototype),BoxGeometry.prototype.constructor=BoxGeometry,BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype),BoxBufferGeometry.prototype.constructor=BoxBufferGeometry,PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */
var Zt=0;function Material(){Object.defineProperty(this,"id",{value:Zt++}),this.uuid=Nt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=E,this.side=f,this.flatShading=!1,this.vertexColors=x,// THREE.NoColors, THREE.VertexColors, THREE.FaceColors
this.opacity=1,this.transparent=!1,this.blendSrc=N,this.blendDst=U,this.blendEquation=C,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Y,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,// override the renderer's default precision for this material
this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,// Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer
this.visible=!0,this.userData={},this.needsUpdate=!0}
/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  defines: { "label" : "value" },
 *  uniforms: { "parameter1": { value: 1.0 }, "parameter2": { value2: 2 } },
 *
 *  fragmentShader: <string>,
 *  vertexShader: <string>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  lights: <bool>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */
function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,// set to use scene fog
this.lights=!1,// set to use scene lights
this.clipping=!1,// set to use user-defined clipping planes
this.skinning=!1,// set to use skinning attribute streams
this.morphTargets=!1,// set to use morph targets
this.morphNormals=!1,// set to use morph normals
this.extensions={derivatives:!1,// set to use derivatives
fragDepth:!1,// set to use fragment depth values
drawBuffers:!1,// set to use draw buffers
shaderTextureLOD:!1},
// When rendered geometry doesn't include these attributes but the material does,
// use these default values in WebGL. This avoids errors when buffer data is missing.
this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}
/**
 * @author bhouston / http://clara.io
 */
function Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3}
/**
 * @author bhouston / http://clara.io
 * @author mrdoob / http://mrdoob.com/
 */
function Triangle(e,t,n){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==n?n:new Vector3}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *  lightMapIntensity: <float>
 *
 *  aoMap: new THREE.Texture( <Image> ),
 *  aoMapIntensity: <float>
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>
 * }
 */
function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),// emissive
this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author jonobr1 / http://jonobr1.com/
 */
function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=Mt,this.updateMorphTargets()}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function CubeTexture(e,t,n,r,i,a,o,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:le,Texture.call(this,e,t,n,r,i,a,o,s,l,c),this.flipY=!1}
/**
 * @author Artur Trzesiok
 */
function DataTexture3D(e,t,n,r){
// We're going to add .setXXX() methods for setting properties later.
// Users can still set in DataTexture3D directly.
//
//  var texture = new THREE.DataTexture3D( data, width, height, depth );
//  texture.anisotropy = 16;
//
// See #14839
Texture.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=ye,this.minFilter=ye,this.generateMipmaps=!1,this.flipY=!1}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)
// for backward compatability if shading is set in the constructor
if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):
// ensure overdraw is backwards-compatible with legacy boolean type
this[t]="overdraw"===t?Number(n):n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===y;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};
// standard Material serialization
// TODO: Copied from Object3D.toJSON
function extractFromCache(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,// Scale behind envMap
void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==E&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==f&&(n.side=this.side),this.vertexColors!==x&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,
// rotation (SpriteMaterial)
0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=extractFromCache(e.textures),i=extractFromCache(e.images);r.length>0&&(n.textures=r),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=kt.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}return Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Vector3;return function recast(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Vector3;return function distanceSqToPoint(t){var n=e.subVectors(t,this.origin).dot(this.direction);
// point behind the ray
return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function distanceSqToSegment(r,i,a,o){
// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteDistRaySegment.h
// It returns the min distance between the ray and the segment
// defined by v0 and v1
// It can also set two optional targets :
// - The closest point on the ray
// - The closest point on the segment
e.copy(r).add(i).multiplyScalar(.5),t.copy(i).sub(r).normalize(),n.copy(this.origin).sub(e);var s,l,c,u,h=.5*r.distanceTo(i),d=-this.direction.dot(t),p=n.dot(this.direction),f=-n.dot(t),m=n.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(
// The ray and segment are not parallel.
l=d*p-f,u=h*g,(s=d*f-p)>=0)if(l>=-u)if(l<=u){
// region 0
// Minimum at interior points of ray and segment.
var v=1/g;c=(s*=v)*(s+d*(l*=v)+2*p)+l*(d*s+l+2*f)+m}else
// region 1
l=h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else
// region 5
l=-h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l<=-u?c=-(
// region 4
s=Math.max(0,-(-d*h+p)))*s+(l=s>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(
// region 3
s=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(
// region 2
s=Math.max(0,-(d*h+p)))*s+(l=s>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else
// Ray and segment are parallel.
l=d>0?-h:h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new Vector3;return function intersectSphere(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),i=e.dot(e)-r*r,a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i),s=r-o,l=r+o;
// t0 = first intersect point - entrance on front of sphere
// test to see if both t0 and t1 are behind the ray - if so, return null
return s<0&&l<0?null:
// test to see if t0 is behind the ray:
// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,
// in order to always return an intersect point that is in front of the ray.
s<0?this.at(l,n):this.at(s,n)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)
// line is coplanar, return origin
return 0===e.distanceToPoint(this.origin)?0:null;
// Null is preferable to undefined since undefined means.... it is undefined
var n=-(this.origin.dot(e.normal)+e.constant)/t;
// Return if the ray never intersects the plane
return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){
// check if the ray lies on the plane first
var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||i>r?null:(
// These lines also handle the case where tmin or tmax is NaN
// (result of 0 * Infinity). x !== x returns true if x is NaN
(i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),
//return point closest to the ray (positive side)
r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){
// Compute the offset origin, edges, and normal.
var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3;return function intersectTriangle(i,a,o,s,l){
// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h
t.subVectors(a,i),n.subVectors(o,i),r.crossVectors(t,n);
// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,
// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by
//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))
//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))
//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)
var c,u=this.direction.dot(r);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,i);var h=c*this.direction.dot(n.crossVectors(e,n));
// b1 < 0, no intersection
if(h<0)return null;var d=c*this.direction.dot(t.cross(e));
// b2 < 0, no intersection
if(d<0)return null;
// b1+b2 > 1, no intersection
if(h+d>u)return null;
// Line intersects triangle, check if ray does.
var p=-c*e.dot(r);
// t < 0, no intersection
return p<0?null:this.at(p/u,l);
// Ray intersects triangle.
}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Triangle,{getNormal:function(){var e=new Vector3;return function getNormal(t,n,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Vector3),i.subVectors(r,n),e.subVectors(t,n),i.cross(e);var a=i.lengthSq();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}}(),
// static/instance method to calculate barycentric coordinates
// based on: http://www.blackpawn.com/texts/pointinpoly/default.html
getBarycoord:function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function getBarycoord(r,i,a,o,s){e.subVectors(o,i),t.subVectors(a,i),n.subVectors(r,i);var l=e.dot(e),c=e.dot(t),u=e.dot(n),h=t.dot(t),d=t.dot(n),p=l*h-c*c;
// collinear or singular triangle
if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),0===p)
// arbitrary location outside of triangle?
// not sure if this is the best idea, maybe should be returning undefined
return s.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,g=(l*d-c*u)*f;
// barycentric coordinates must always sum to 1
return s.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new Vector3;return function containsPoint(t,n,r,i){return Triangle.getBarycoord(t,n,r,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:function(){var e=new Vector3;return function getUV(t,n,r,i,a,o,s,l){return this.getBarycoord(t,n,r,i,e),l.set(0,0),l.addScaledVector(a,e.x),l.addScaledVector(o,e.y),l.addScaledVector(s,e.z),l}}()}),Object.assign(Triangle.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Vector3,t=new Vector3;return function getArea(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Vector3),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,n,r,i){return Triangle.getUV(e,this.a,this.b,this.c,t,n,r,i)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3,i=new Vector3,a=new Vector3;return function closestPointToPoint(o,s){void 0===s&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),s=new Vector3);var l,c,u=this.a,h=this.b,d=this.c;
// algorithm thanks to Real-Time Collision Detection by Christer Ericson,
// published by Morgan Kaufmann Publishers, (c) 2005 Elsevier Inc.,
// under the accompanying license; see chapter 5.1.5 for detailed explanation.
// basically, we're distinguishing which of the voronoi regions of the triangle
// the point lies in with the minimum amount of redundant computation.
e.subVectors(h,u),t.subVectors(d,u),r.subVectors(o,u);var p=e.dot(r),f=t.dot(r);if(p<=0&&f<=0)
// vertex region of A; barycentric coords (1, 0, 0)
return s.copy(u);i.subVectors(o,h);var m=e.dot(i),g=t.dot(i);if(m>=0&&g<=m)
// vertex region of B; barycentric coords (0, 1, 0)
return s.copy(h);var v=p*g-m*f;if(v<=0&&p>=0&&m<=0)
// edge region of AB; barycentric coords (1-v, v, 0)
return l=p/(p-m),s.copy(u).addScaledVector(e,l);a.subVectors(o,d);var y=e.dot(a),b=t.dot(a);if(b>=0&&y<=b)
// vertex region of C; barycentric coords (0, 0, 1)
return s.copy(d);var x=y*f-p*b;if(x<=0&&f>=0&&b<=0)
// edge region of AC; barycentric coords (1-w, 0, w)
return c=f/(f-b),s.copy(u).addScaledVector(t,c);var _=m*b-y*g;if(_<=0&&g-m>=0&&y-b>=0)
// edge region of BC; barycentric coords (0, 1-w, w)
return n.subVectors(d,h),c=(g-m)/(g-m+(y-b)),s.copy(h).addScaledVector(n,c);// edge region of BC
// face region
var w=1/(_+x+v);
// u = va * denom
return l=x*w,c=v*w,s.copy(u).addScaledVector(e,l).addScaledVector(t,c)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)n=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}},raycast:function(){var e=new Matrix4,t=new Ray,n=new Sphere,r=new Vector3,i=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector2,u=new Vector2,h=new Vector2,d=new Vector3,p=new Vector3;function checkIntersection(e,t,n,r,i,a,o,s){if(null===(t.side===m?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==g,s)))return null;p.copy(s),p.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(p);return l<n.near||l>n.far?null:{distance:l,point:p.clone(),object:e}}function checkBufferGeometryIntersection(e,t,n,o,s,l,p,f,m){r.fromBufferAttribute(s,p),i.fromBufferAttribute(s,f),a.fromBufferAttribute(s,m);var g=checkIntersection(e,t,n,o,r,i,a,d);if(g){l&&(c.fromBufferAttribute(l,p),u.fromBufferAttribute(l,f),h.fromBufferAttribute(l,m),g.uv=Triangle.getUV(d,r,i,a,c,u,h,new Vector2));var v=new Face3(p,f,m);Triangle.getNormal(r,i,a,v.normal),g.face=v}return g}return function raycast(p,f){var m,g=this.geometry,v=this.material,y=this.matrixWorld;if(void 0!==v&&(
// Checking boundingSphere distance to ray
null===g.boundingSphere&&g.computeBoundingSphere(),n.copy(g.boundingSphere),n.applyMatrix4(y),!1!==p.ray.intersectsSphere(n)&&(
//
e.getInverse(y),t.copy(p.ray).applyMatrix4(e),null===g.boundingBox||!1!==t.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var b,x,_,w,M,E,S,L,T,A=g.index,C=g.attributes.position,P=g.attributes.uv,I=g.groups,O=g.drawRange;if(null!==A)
// indexed buffer geometry
if(Array.isArray(v))for(w=0,E=I.length;w<E;w++)for(T=v[(L=I[w]).materialIndex],M=Math.max(L.start,O.start),S=Math.min(L.start+L.count,O.start+O.count);M<S;M+=3)b=A.getX(M),x=A.getX(M+1),_=A.getX(M+2),(m=checkBufferGeometryIntersection(this,T,p,t,C,P,b,x,_))&&(m.faceIndex=Math.floor(M/3),// triangle number in indexed buffer semantics
f.push(m));else for(w=Math.max(0,O.start),E=Math.min(A.count,O.start+O.count);w<E;w+=3)b=A.getX(w),x=A.getX(w+1),_=A.getX(w+2),(m=checkBufferGeometryIntersection(this,v,p,t,C,P,b,x,_))&&(m.faceIndex=Math.floor(w/3),// triangle number in indexed buffer semantics
f.push(m));else if(void 0!==C)
// non-indexed buffer geometry
if(Array.isArray(v))for(w=0,E=I.length;w<E;w++)for(T=v[(L=I[w]).materialIndex],M=Math.max(L.start,O.start),S=Math.min(L.start+L.count,O.start+O.count);M<S;M+=3)(m=checkBufferGeometryIntersection(this,T,p,t,C,P,b=M,x=M+1,_=M+2))&&(m.faceIndex=Math.floor(M/3),// triangle number in non-indexed buffer semantics
f.push(m));else for(w=Math.max(0,O.start),E=Math.min(C.count,O.start+O.count);w<E;w+=3)(m=checkBufferGeometryIntersection(this,v,p,t,C,P,b=w,x=w+1,_=w+2))&&(m.faceIndex=Math.floor(w/3),// triangle number in non-indexed buffer semantics
f.push(m))}else if(g.isGeometry){var B,R,G,D,V=Array.isArray(v),N=g.vertices,U=g.faces,F=g.faceVertexUvs[0];F.length>0&&(D=F);for(var z=0,k=U.length;z<k;z++){var j=U[z],H=V?v[j.materialIndex]:v;if(void 0!==H){if(B=N[j.a],R=N[j.b],G=N[j.c],!0===H.morphTargets){var W=g.morphTargets,X=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),a.set(0,0,0);for(var q=0,Y=W.length;q<Y;q++){var Z=X[q];if(0!==Z){var J=W[q].vertices;r.addScaledVector(o.subVectors(J[j.a],B),Z),i.addScaledVector(s.subVectors(J[j.b],R),Z),a.addScaledVector(l.subVectors(J[j.c],G),Z)}}r.add(B),i.add(R),a.add(G),B=r,R=i,G=a}if(m=checkIntersection(this,H,p,t,B,R,G,d)){if(D&&D[z]){var Q=D[z];c.copy(Q[0]),u.copy(Q[1]),h.copy(Q[2]),m.uv=Triangle.getUV(d,B,R,G,c,u,h,new Vector2)}m.face=j,m.faceIndex=z,f.push(m)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;
/**
 * @author tschw
 * @author Mugen87 / https://github.com/Mugen87
 * @author mrdoob / http://mrdoob.com/
 *
 * Uniforms of a program.
 * Those form a tree structure with a special top-level container for the root,
 * which you get by calling 'new WebGLUniforms( gl, program, renderer )'.
 *
 *
 * Properties of inner nodes including the top-level container:
 *
 * .seq - array of nested uniforms
 * .map - nested uniforms by name
 *
 *
 * Methods of all nodes except the top-level container:
 *
 * .setValue( gl, value, [renderer] )
 *
 *      uploads a uniform value(s)
 *      the 'renderer' parameter is needed for sampler uniforms
 *
 *
 * Static methods of the top-level container (renderer factorizations):
 *
 * .upload( gl, seq, values, renderer )
 *
 *      sets uniforms in 'seq' to 'values[id].value'
 *
 * .seqWithValue( seq, values ) : filteredSeq
 *
 *      filters 'seq' entries with corresponding entry in values
 *
 *
 * Methods of the top-level container (renderer factorizations):
 *
 * .setValue( gl, name, value )
 *
 *      sets uniform with  name 'name' to 'value'
 *
 * .set( gl, obj, prop )
 *
 *      sets uniform from object and property with same name than uniform
 *
 * .setOptional( gl, obj, prop )
 *
 *      like .set for an optional property of the object
 *
 */
var Jt=new Texture,Qt=new DataTexture3D,Kt=new CubeTexture;
// --- Base for inner nodes (including the root) ---
function UniformContainer(){this.seq=[],this.map={}}
// --- Utilities ---
// Array Caches (provide typed arrays for temporary by size)
var $t=[],en=[],tn=new Float32Array(16),nn=new Float32Array(9),rn=new Float32Array(4);
// Flattening for arrays of vectors and matrices
function flatten(e,t,n){var r=e[0];if(r<=0||r>0)return e;
// unoptimized: ! isNaN( firstElem )
// see http://jacksondunstan.com/articles/983
var i=t*n,a=$t[i];if(void 0===a&&(a=new Float32Array(i),$t[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function copyArray(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}
// Texture unit allocation
function allocTexUnits(e,t){var n=en[t];void 0===n&&(n=new Int32Array(t),en[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocTextureUnit();return n}
// --- Setters ---
// Note: Defining these methods externally, because they come in a bunch
// and this way their names minify.
// Single scalar
function setValue1f(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function setValue1i(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}
// Single float vector (from flat array or THREE.VectorN)
function setValue2fv(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(arraysEqual(n,t))return;e.uniform2fv(this.addr,t),copyArray(n,t)}}function setValue3fv(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(arraysEqual(n,t))return;e.uniform3fv(this.addr,t),copyArray(n,t)}}function setValue4fv(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(arraysEqual(n,t))return;e.uniform4fv(this.addr,t),copyArray(n,t)}}
// Single matrix (from flat array or MatrixN)
function setValue2fm(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(n,t)}else{if(arraysEqual(n,r))return;rn.set(r),e.uniformMatrix2fv(this.addr,!1,rn),copyArray(n,r)}}function setValue3fm(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(n,t)}else{if(arraysEqual(n,r))return;nn.set(r),e.uniformMatrix3fv(this.addr,!1,nn),copyArray(n,r)}}function setValue4fm(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(n,t)}else{if(arraysEqual(n,r))return;tn.set(r),e.uniformMatrix4fv(this.addr,!1,tn),copyArray(n,r)}}
// Single texture (2D / Cube)
function setValueT1(e,t,n){var r=this.cache,i=n.allocTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||Jt,i)}function setValueT3D1(e,t,n){var r=this.cache,i=n.allocTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Qt,i)}function setValueT6(e,t,n){var r=this.cache,i=n.allocTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Kt,i)}
// Integer / Boolean vectors or arrays thereof (always flat arrays)
function setValue2iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform2iv(this.addr,t),copyArray(n,t))}function setValue3iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform3iv(this.addr,t),copyArray(n,t))}function setValue4iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform4iv(this.addr,t),copyArray(n,t))}
// Helper to pick the right setter for the singular case
// Array of scalars
function setValue1fv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform1fv(this.addr,t),copyArray(n,t))}function setValue1iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform1iv(this.addr,t),copyArray(n,t))}
// Array of vectors (flat or from THREE classes)
function setValueV2a(e,t){var n=this.cache,r=flatten(t,this.size,2);arraysEqual(n,r)||(e.uniform2fv(this.addr,r),this.updateCache(r))}function setValueV3a(e,t){var n=this.cache,r=flatten(t,this.size,3);arraysEqual(n,r)||(e.uniform3fv(this.addr,r),this.updateCache(r))}function setValueV4a(e,t){var n=this.cache,r=flatten(t,this.size,4);arraysEqual(n,r)||(e.uniform4fv(this.addr,r),this.updateCache(r))}
// Array of matrices (flat or from THREE clases)
function setValueM2a(e,t){var n=this.cache,r=flatten(t,this.size,4);arraysEqual(n,r)||(e.uniformMatrix2fv(this.addr,!1,r),this.updateCache(r))}function setValueM3a(e,t){var n=this.cache,r=flatten(t,this.size,9);arraysEqual(n,r)||(e.uniformMatrix3fv(this.addr,!1,r),this.updateCache(r))}function setValueM4a(e,t){var n=this.cache,r=flatten(t,this.size,16);arraysEqual(n,r)||(e.uniformMatrix4fv(this.addr,!1,r),this.updateCache(r))}
// Array of textures (2D / Cube)
function setValueT1a(e,t,n){var r=this.cache,i=t.length,a=allocTexUnits(n,i);!1===arraysEqual(r,a)&&(e.uniform1iv(this.addr,a),copyArray(r,a));for(var o=0;o!==i;++o)n.setTexture2D(t[o]||Jt,a[o])}function setValueT6a(e,t,n){var r=this.cache,i=t.length,a=allocTexUnits(n,i);!1===arraysEqual(r,a)&&(e.uniform1iv(this.addr,a),copyArray(r,a));for(var o=0;o!==i;++o)n.setTextureCube(t[o]||Kt,a[o])}
// Helper to pick the right setter for a pure (bottom-level) array
// --- Uniform Classes ---
function SingleUniform(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function getSingularSetter(e){switch(e){case 5126:return setValue1f;// FLOAT
case 35664:return setValue2fv;// _VEC2
case 35665:return setValue3fv;// _VEC3
case 35666:return setValue4fv;// _VEC4
case 35674:return setValue2fm;// _MAT2
case 35675:return setValue3fm;// _MAT3
case 35676:return setValue4fm;// _MAT4
case 35678:case 36198:return setValueT1;// SAMPLER_2D, SAMPLER_EXTERNAL_OES
case 35679:return setValueT3D1;// SAMPLER_3D
case 35680:return setValueT6;// SAMPLER_CUBE
case 5124:case 35670:return setValue1i;// INT, BOOL
case 35667:case 35671:return setValue2iv;// _VEC2
case 35668:case 35672:return setValue3iv;// _VEC3
case 35669:case 35673:return setValue4iv;// _VEC4
}}(t.type)}function PureArrayUniform(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function getPureArraySetter(e){switch(e){case 5126:return setValue1fv;// FLOAT
case 35664:return setValueV2a;// _VEC2
case 35665:return setValueV3a;// _VEC3
case 35666:return setValueV4a;// _VEC4
case 35674:return setValueM2a;// _MAT2
case 35675:return setValueM3a;// _MAT3
case 35676:return setValueM4a;// _MAT4
case 35678:return setValueT1a;// SAMPLER_2D
case 35680:return setValueT6a;// SAMPLER_CUBE
case 5124:case 35670:return setValue1iv;// INT, BOOL
case 35667:case 35671:return setValue2iv;// _VEC2
case 35668:case 35672:return setValue3iv;// _VEC3
case 35669:case 35673:return setValue4iv;// _VEC4
}}(t.type)}function StructuredUniform(e){this.id=e,UniformContainer.call(this)}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};
// --- Top-level ---
// Parser - builds up the property tree from the path strings
var an=/([\w\d_]+)(\])?(\[|\.)?/g;
// extracts
//  - the identifier (member name or array index)
//  - followed by an optional right bracket (found when array index)
//  - followed by an optional left bracket or dot (type of subscript)
//
// Note: These portions can be read in a non-overlapping fashion and
// allow straightforward parsing of the hierarchy that WebGL encodes
// in the uniform names.
function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,n){var r=e.name,i=r.length;
// reset RegExp object, because of the early exit of a previous run
for(an.lastIndex=0;;){var a=an.exec(r),o=an.lastIndex,s=a[1],l="]"===a[2],c=a[3];// convert to integer
if(l&&(s|=0),void 0===c||"["===c&&o+2===i){
// bare name or "pure" bottom-level array "[0]" suffix
addUniform(n,void 0===c?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}
// step into inner node / create it in case it doesn't exist
var u=n.map[s];void 0===u&&addUniform(n,u=new StructuredUniform(s)),n=u}}
// Root Container
function WebGLUniforms(e,t,n){UniformContainer.call(this),this.renderer=n;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;++i){var a=e.getActiveUniform(t,i);parseUniform(a,e.getUniformLocation(t,a.name),this)}}function WebGLShader(e,t,n){var r=e.createShader(t);
// --enable-privileged-webgl-extension
// console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );
return e.shaderSource(r,n),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),
/**
 * @author mrdoob / http://mrdoob.com/
 */
function addLineNumbers(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n)),r}
/**
 * @author mrdoob / http://mrdoob.com/
 */WebGLUniforms.prototype.setValue=function(e,t,n){var r=this.map[t];void 0!==r&&r.setValue(e,n,this.renderer)},WebGLUniforms.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},
// Static interface
WebGLUniforms.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&
// note: always updating when .needsUpdate is undefined
o.setValue(e,s.value,r)}},WebGLUniforms.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n};var on=0;function getEncodingComponents(e){switch(e){case Lt:return["Linear","( value )"];case Tt:return["sRGB","( value )"];case Ct:return["RGBE","( value )"];case It:return["RGBM","( value, 7.0 )"];case Ot:return["RGBM","( value, 16.0 )"];case Bt:return["RGBD","( value, 256.0 )"];case At:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function getTexelDecodingFunction(e,t){var n=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function parseIncludes(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function replace(e,t){var n=zt[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return parseIncludes(n)})}function unrollLoops(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function replace(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[ i \]/g,"[ "+a+" ]");return i})}function WebGLProgram(e,t,n,r,i,a,o){var s=e.context,l=r.defines,c=i.vertexShader,u=i.fragmentShader,h="SHADOWMAP_TYPE_BASIC";a.shadowMapType===d?h="SHADOWMAP_TYPE_PCF":a.shadowMapType===p&&(h="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",g="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(r.envMap.mapping){case le:case ce:f="ENVMAP_TYPE_CUBE";break;case pe:case fe:f="ENVMAP_TYPE_CUBE_UV";break;case ue:case he:f="ENVMAP_TYPE_EQUIREC";break;case de:f="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case ce:case he:m="ENVMAP_MODE_REFRACTION"}switch(r.combine){case $:g="ENVMAP_BLENDING_MULTIPLY";break;case ee:g="ENVMAP_BLENDING_MIX";break;case te:g="ENVMAP_BLENDING_ADD"}}var v,y,b=e.gammaFactor>0?e.gammaFactor:1,x=o.isWebGL2?"":function generateExtensions(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(r.extensions,a,t),_=function generateDefines(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(l),w=s.createProgram();
// console.log( 'building new program ' );
//
if(r.isRawShaderMaterial?((v=[_].filter(filterEmptyLine).join("\n")).length>0&&(v+="\n"),(y=[x,_].filter(filterEmptyLine).join("\n")).length>0&&(y+="\n")):(v=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,_,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+b,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),y=[x,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,_,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"",// add '.0' if integer
"#define GAMMA_FACTOR "+b,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.envMap?"#define "+m:"",a.envMap?"#define "+g:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==ne?"#define TONE_MAPPING":"",a.toneMapping!==ne?zt.tonemapping_pars_fragment:"",// this code is required here because it is used by the toneMapping() function defined below
a.toneMapping!==ne?function getToneMappingFunction(e,t){var n;switch(t){case re:n="Linear";break;case ie:n="Reinhard";break;case ae:n="Uncharted2";break;case oe:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?zt.encodings_pars_fragment:"",// this code is required here because it is used by the various encoding/decoding function defined below
a.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?function getTexelEncodingFunction(e,t){var n=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),c=replaceClippingPlaneNums(c=replaceLightNums(c=parseIncludes(c),a),a),u=replaceClippingPlaneNums(u=replaceLightNums(u=parseIncludes(u),a),a),c=unrollLoops(c),u=unrollLoops(u),o.isWebGL2&&!r.isRawShaderMaterial){var M=!1,E=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==c.match(E)&&null!==u.match(E)&&(M=!0,c=c.replace(E,""),u=u.replace(E,"")),
// GLSL 3.0 conversion
v=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,y=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y}var S=v+c,L=y+u,T=WebGLShader(s,s.VERTEX_SHADER,S),A=WebGLShader(s,s.FRAGMENT_SHADER,L);s.attachShader(w,T),s.attachShader(w,A),
// Force a particular attribute to index 0.
void 0!==r.index0AttributeName?s.bindAttribLocation(w,0,r.index0AttributeName):!0===a.morphTargets&&
// programs with morphTargets displace position out of attribute 0
s.bindAttribLocation(w,0,"position"),s.linkProgram(w);var C,P,I=s.getProgramInfoLog(w).trim(),O=s.getShaderInfoLog(T).trim(),B=s.getShaderInfoLog(A).trim(),R=!0,G=!0;
// console.log( '**VERTEX**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );
// console.log( '**FRAGMENT**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );
return!1===s.getProgramParameter(w,s.LINK_STATUS)?(R=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(w,s.VALIDATE_STATUS),"gl.getProgramInfoLog",I,O,B)):""!==I?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",I):""!==O&&""!==B||(G=!1),G&&(this.diagnostics={runnable:R,material:r,programLog:I,vertexShader:{log:O,prefix:v},fragmentShader:{log:B,prefix:y}}),
// clean up
s.deleteShader(T),s.deleteShader(A),this.getUniforms=function(){return void 0===C&&(C=new WebGLUniforms(s,w,e)),C},this.getAttributes=function(){return void 0===P&&(P=function fetchAttributeLocations(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var a=e.getActiveAttrib(t,i).name;
// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );
n[a]=e.getAttribLocation(t,a)}return n}(s,w)),P},
// free resource
this.destroy=function(){s.deleteProgram(w),this.program=void 0},
// DEPRECATED
Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),
//
this.name=i.name,this.id=on++,this.code=n,this.usedTimes=1,this.program=w,this.vertexShader=T,this.fragmentShader=A,this}
/**
 * @author mrdoob / http://mrdoob.com/
 */function WebGLPrograms(e,t,n){var r=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function getTextureEncodingFromMap(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=Lt,
// add backwards compatibility for WebGLRenderer.gammaInput/gammaOutput parameter, should probably be removed at some point.
n===Lt&&t&&(n=At),n}this.getParameters=function(t,r,a,o,s,l,c){var u=i[t.type],h=c.isSkinnedMesh?function allocateBones(e){var t=e.skeleton.bones;if(n.floatVertexTextures)return 1024;
// default for when object is not specified
// ( for example when prebuilding shader to be used with multiple objects )
//
//  - leave some extra space for other uniforms
//  - limit here is ANGLE's 254 max uniform vectors
//    (up to 54 should be safe)
var r=n.maxVertexUniforms,i=Math.floor((r-20)/4),a=Math.min(i,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(c):0,d=n.precision;
// heuristics to create shader parameters according to lights in the scene
// (not to blow over maxLights budget)
null!==t.precision&&(d=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",d,"instead.");var p=e.getRenderTarget();return{shaderID:u,precision:d,supportsVertexTextures:n.vertexTextures,outputEncoding:getTextureEncodingFromMap(p?p.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:getTextureEncodingFromMap(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:getTextureEncodingFromMap(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===pe||t.envMap.mapping===fe),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===Vt,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!o,useFog:t.fog,fogExp:o&&o.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:t.skinning&&h>0,maxBones:h,useVertexTexture:n.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:s,numClipIntersection:l,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===g,flipSided:t.side===m,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)r.push(i),r.push(t.defines[i]);for(var o=0;o<a.length;o++)r.push(n[a[o]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.join()},this.acquireProgram=function(i,a,o,s){
// Check if code has been already compiled
for(var l,c=0,u=r.length;c<u;c++){var h=r[c];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new WebGLProgram(e,t,s,i,a,o,n),r.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){
// Remove from unordered set
var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),
// Free WebGL resources
e.destroy()}},
// Exposed for resource monitoring & error feedback via renderer.info:
this.programs=r}
/**
 * @author fordacious / fordacious.github.io
 */
/**
 * @author mrdoob / http://mrdoob.com/
 */
function painterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderLists(){var e={};return{get:function get(t,n){var r=t.id+","+n.id,i=e[r];return void 0===i&&(
// console.log( 'THREE.WebGLRenderLists:', hash );
i=new function WebGLRenderList(){var e=[],t=0,n=[],r=[];return{opaque:n,transparent:r,init:function init(){t=0,n.length=0,r.length=0},push:function push(i,a,o,s,l){var c=e[t];void 0===c?(c={id:i.id,object:i,geometry:a,material:o,program:o.program,renderOrder:i.renderOrder,z:s,group:l},e[t]=c):(c.id=i.id,c.object=i,c.geometry=a,c.material=o,c.program=o.program,c.renderOrder=i.renderOrder,c.z=s,c.group=l),(!0===o.transparent?r:n).push(c),t++},sort:function sort(){n.length>1&&n.sort(painterSortStable),r.length>1&&r.sort(reversePainterSortStable)}}},e[r]=i),i},dispose:function dispose(){e={}}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */var sn,ln=0;function WebGLLights(){var e=new function UniformsCache(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":n={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":n={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":n={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=n,n}}},t={id:ln++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new Vector3,r=new Matrix4,i=new Matrix4;return{setup:function setup(a,o,s){for(var l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=s.matrixWorldInverse,v=0,y=a.length;v<y;v++){var b=a[v],x=b.color,_=b.intensity,w=b.distance,M=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)l+=x.r*_,c+=x.g*_,u+=x.b*_;else if(b.isDirectionalLight){if((S=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),S.direction.setFromMatrixPosition(b.matrixWorld),n.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.shadow=b.castShadow,b.castShadow){var E=b.shadow;S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize}t.directionalShadowMap[h]=M,t.directionalShadowMatrix[h]=b.shadow.matrix,t.directional[h]=S,h++}else if(b.isSpotLight)(S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(x).multiplyScalar(_),S.distance=w,S.direction.setFromMatrixPosition(b.matrixWorld),n.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.coneCos=Math.cos(b.angle),S.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),S.decay=b.decay,S.shadow=b.castShadow,b.castShadow&&(E=b.shadow,S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize),t.spotShadowMap[p]=M,t.spotShadowMatrix[p]=b.shadow.matrix,t.spot[p]=S,p++;else if(b.isRectAreaLight)
// (a) intensity is the total visible light emitted
//uniforms.color.copy( color ).multiplyScalar( intensity / ( light.width * light.height * Math.PI ) );
// (b) intensity is the brightness of the light
(S=e.get(b)).color.copy(x).multiplyScalar(_),S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),
// extract local rotation of light to derive width/height half vectors
i.identity(),r.copy(b.matrixWorld),r.premultiply(g),i.extractRotation(r),S.halfWidth.set(.5*b.width,0,0),S.halfHeight.set(0,.5*b.height,0),S.halfWidth.applyMatrix4(i),S.halfHeight.applyMatrix4(i),
// TODO (abelnation): RectAreaLight distance?
// uniforms.distance = distance;
t.rectArea[f]=S,f++;else if(b.isPointLight)(S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(b.color).multiplyScalar(b.intensity),S.distance=b.distance,S.decay=b.decay,S.shadow=b.castShadow,b.castShadow&&(E=b.shadow,S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize,S.shadowCameraNear=E.camera.near,S.shadowCameraFar=E.camera.far),t.pointShadowMap[d]=M,t.pointShadowMatrix[d]=b.shadow.matrix,t.point[d]=S,d++;else if(b.isHemisphereLight){var S;(S=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(g),S.direction.normalize(),S.skyColor.copy(b.color).multiplyScalar(_),S.groundColor.copy(b.groundColor).multiplyScalar(_),t.hemi[m]=S,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=p,t.rectArea.length=f,t.point.length=d,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=d,t.hash.spotLength=p,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}
/**
 * @author Mugen87 / https://github.com/Mugen87
 */function WebGLRenderState(){var e=new WebGLLights,t=[],n=[];return{init:function init(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function setupLights(r){e.setup(t,n,r)},pushLight:function pushLight(e){t.push(e)},pushShadow:function pushShadow(e){n.push(e)}}}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author bhouston / https://clara.io
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>
 * }
 */
function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=Rt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}
/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *
 *  referencePosition: <float>,
 *  nearDistance: <float>,
 *  farDistance: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>
 *
 * }
 */
function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLShadowMap(e,t,n){
// init
for(var r=new Frustum,i=new Matrix4,a=new Vector2,o=new Vector2(n,n),s=new Vector3,l=new Vector3,c=1,u=2,h=1+(c|u),p=new Array(h),v=new Array(h),y={},b={0:m,1:f,2:g},x=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],_=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],w=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],M=0;M!==h;++M){var E=0!=(M&c),S=0!=(M&u),L=new MeshDepthMaterial({depthPacking:Gt,morphTargets:E,skinning:S});p[M]=L;
//
var T=new MeshDistanceMaterial({morphTargets:E,skinning:S});v[M]=T}
//
var A=this;function getDepthMaterial(t,n,r,i,a,o){var s=t.geometry,l=null,h=p,d=t.customDepthMaterial;if(r&&(h=v,d=t.customDistanceMaterial),d)l=d;else{var f=!1;n.morphTargets&&(s&&s.isBufferGeometry?f=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(f=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var m=t.isSkinnedMesh&&n.skinning,g=0;f&&(g|=c),m&&(g|=u),l=h[g]}if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){
// in this case we need a unique material instance reflecting the
// appropriate state
var x=l.uuid,_=n.uuid,w=y[x];void 0===w&&(w={},y[x]=w);var M=w[_];void 0===M&&(M=l.clone(),w[_]=M),l=M}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=null!=n.shadowSide?n.shadowSide:b[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,r&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=a,l.farDistance=o),l}function renderObject(n,i,a,o){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var s=t.update(n),c=n.material;if(Array.isArray(c))for(var u=s.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=c[p.materialIndex];if(f&&f.visible){var m=getDepthMaterial(n,f,o,l,a.near,a.far);e.renderBufferDirect(a,null,s,m,n,p)}}else if(c.visible){m=getDepthMaterial(n,c,o,l,a.near,a.far);e.renderBufferDirect(a,null,s,m,n,null)}}for(var g=n.children,v=0,y=g.length;v<y;v++)renderObject(g[v],i,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d,this.render=function(t,n,c){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){
// TODO Clean up (needed in case of contextlost)
var u,h=e.context,d=e.state;
// Set GL state for depth map.
d.disable(h.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],g=m.shadow,v=m&&m.isPointLight;if(void 0!==g){var y=g.camera;if(a.copy(g.mapSize),a.min(o),v){var b=a.x,M=a.y;
// These viewports map a cube-map onto a 2D texture with the
// following orientation:
//
//  xzXZ
//   y Y
//
// X - Positive x direction
// x - Negative x direction
// Y - Positive y direction
// y - Negative y direction
// Z - Positive z direction
// z - Negative z direction
// positive X
w[0].set(2*b,M,b,M),
// negative X
w[1].set(0,M,b,M),
// positive Z
w[2].set(3*b,M,b,M),
// negative Z
w[3].set(b,M,b,M),
// positive Y
w[4].set(3*b,0,b,M),
// negative Y
w[5].set(b,0,b,M),a.x*=4,a.y*=2}if(null===g.map){var E={minFilter:ye,magFilter:ye,format:Ne};g.map=new WebGLRenderTarget(a.x,a.y,E),g.map.texture.name=m.name+".shadowMap",y.updateProjectionMatrix()}g.isSpotLightShadow&&g.update(m);var S=g.map,L=g.matrix;l.setFromMatrixPosition(m.matrixWorld),y.position.copy(l),v?(u=6,
// for point lights we set the shadow matrix to be a translation-only matrix
// equal to inverse of the light's position
L.makeTranslation(-l.x,-l.y,-l.z)):(u=1,s.setFromMatrixPosition(m.target.matrixWorld),y.lookAt(s),y.updateMatrixWorld(),
// compute shadow matrix
L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(y.projectionMatrix),L.multiply(y.matrixWorldInverse)),e.setRenderTarget(S),e.clear();
// render shadow map for each cube face (if omni-directional) or
// run a single pass if not
for(var T=0;T<u;T++){if(v){s.copy(y.position),s.add(x[T]),y.up.copy(_[T]),y.lookAt(s),y.updateMatrixWorld();var C=w[T];d.viewport(C)}
// update camera matrices and frustum
i.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),r.setFromMatrix(i),
// set object matrices & frustum culling
renderObject(n,c,y,v)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}A.needsUpdate=!1}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLTextures(e,t,n,r,i,a,o){var s,l={};
//
function clampToMaxSize(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");
// Warning: Scaling through the canvas will only work with images that use
// premultiplied alpha.
var n=t/Math.max(e.width,e.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=Math.floor(e.width*n),r.height=Math.floor(e.height*n),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height),r}return e}function isPowerOfTwo(e){return Nt.isPowerOfTwo(e.width)&&Nt.isPowerOfTwo(e.height)}function textureNeedsGenerateMipmaps(e,t){return e.generateMipmaps&&t&&e.minFilter!==ye&&e.minFilter!==_e}function generateMipmap(t,n,i,a){e.generateMipmap(t),
// Note: Math.log( x ) * Math.LOG2E used instead of Math.log2( x ) which is not supported by IE11
r.get(n).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function getInternalFormat(t,n){if(!i.isWebGL2)return t;if(t===e.RED){if(n===e.FLOAT)return e.R32F;if(n===e.HALF_FLOAT)return e.R16F;if(n===e.UNSIGNED_BYTE)return e.R8}if(t===e.RGB){if(n===e.FLOAT)return e.RGB32F;if(n===e.HALF_FLOAT)return e.RGB16F;if(n===e.UNSIGNED_BYTE)return e.RGB8}if(t===e.RGBA){if(n===e.FLOAT)return e.RGBA32F;if(n===e.HALF_FLOAT)return e.RGBA16F;if(n===e.UNSIGNED_BYTE)return e.RGBA8}return t}
// Fallback filters for non-power-of-2 textures
function filterFallback(t){return t===ye||t===be||t===xe?e.NEAREST:e.LINEAR}
//
function onTextureDispose(t){var n=t.target;n.removeEventListener("dispose",onTextureDispose),
//
function deallocateTexture(t){var n=r.get(t);if(t.image&&n.__image__webglTextureCube)
// cube texture
e.deleteTexture(n.__image__webglTextureCube);else{
// 2D texture
if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture)}
// remove all webgl properties
r.remove(t)}(n),n.isVideoTexture&&delete l[n.id],o.memory.textures--}function onRenderTargetDispose(t){var n=t.target;n.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}
//
(n),o.memory.textures--}function setTexture2D(t,i){var a=r.get(t);if(t.isVideoTexture&&function updateVideoTexture(e){var t=e.id,n=o.render.frame;
// Check the last frame we updated the VideoTexture
l[t]!==n&&(l[t]=n,e.update())}(t),t.version>0&&a.__version!==t.version){var s=t.image;if(void 0===s)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==s.complete)return void uploadTexture(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function setTextureParameters(n,o,s){var l;if(s?(e.texParameteri(n,e.TEXTURE_WRAP_S,a.convert(o.wrapS)),e.texParameteri(n,e.TEXTURE_WRAP_T,a.convert(o.wrapT)),e.texParameteri(n,e.TEXTURE_MAG_FILTER,a.convert(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a.convert(o.minFilter))):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o.wrapS===ge&&o.wrapT===ge||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,filterFallback(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,filterFallback(o.minFilter)),o.minFilter!==ye&&o.minFilter!==_e&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(o.type===Pe&&null===t.get("OES_texture_float_linear"))return;if(o.type===Ie&&null===(i.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function uploadTexture(t,r,l){var c;c=r.isDataTexture3D?e.TEXTURE_3D:e.TEXTURE_2D,void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",onTextureDispose),t.__webglTexture=e.createTexture(),o.memory.textures++),n.activeTexture(e.TEXTURE0+l),n.bindTexture(c,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var u=clampToMaxSize(r.image,i.maxTextureSize);(function textureNeedsPowerOfTwo(e){return!i.isWebGL2&&(e.wrapS!==ge||e.wrapT!==ge||e.minFilter!==ye&&e.minFilter!==_e)})(r)&&!1===isPowerOfTwo(u)&&(u=function makePowerOfTwo(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=Nt.floorPowerOfTwo(e.width),s.height=Nt.floorPowerOfTwo(e.height),s.getContext("2d").drawImage(e,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+s.width+"x"+s.height),s):e}(u));var h=isPowerOfTwo(u),d=a.convert(r.format),p=a.convert(r.type),f=getInternalFormat(d,p);setTextureParameters(c,r,h);var m,g=r.mipmaps;if(r.isDepthTexture){if(
// populate depth texture with dummy data
f=e.DEPTH_COMPONENT,r.type===Pe){if(!i.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");f=e.DEPTH_COMPONENT32F}else i.isWebGL2&&(
// WebGL 2.0 requires signed internalformat for glTexImage2D
f=e.DEPTH_COMPONENT16);r.format===ke&&f===e.DEPTH_COMPONENT&&r.type!==Te&&r.type!==Ce&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Te,p=a.convert(r.type)),
// Depth stencil textures need the DEPTH_STENCIL internal format
// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
r.format===je&&(f=e.DEPTH_STENCIL,
// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are
// DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.
// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
r.type!==Ge&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ge,p=a.convert(r.type))),n.texImage2D(e.TEXTURE_2D,0,f,u.width,u.height,0,d,p,null)}else if(r.isDataTexture)
// use manually created mipmaps if available
// if there are no manual mipmaps
// set 0 level mipmap and then use GL to generate other mipmap levels
if(g.length>0&&h){for(var v=0,y=g.length;v<y;v++)m=g[v],n.texImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,d,p,m.data);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(e.TEXTURE_2D,0,f,u.width,u.height,0,d,p,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(v=0,y=g.length;v<y;v++)m=g[v],r.format!==Ne&&r.format!==Ve?n.getCompressedTextureFormats().indexOf(d)>-1?n.compressedTexImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,d,p,m.data);t.__maxMipLevel=g.length-1}else if(r.isDataTexture3D)n.texImage3D(e.TEXTURE_3D,0,f,u.width,u.height,u.depth,0,d,p,u.data),t.__maxMipLevel=0;else
// regular Texture (image, video, canvas)
// use manually created mipmaps if available
// if there are no manual mipmaps
// set 0 level mipmap and then use GL to generate other mipmap levels
if(g.length>0&&h){for(v=0,y=g.length;v<y;v++)m=g[v],n.texImage2D(e.TEXTURE_2D,v,f,d,p,m);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(e.TEXTURE_2D,0,f,d,p,u),t.__maxMipLevel=0;textureNeedsGenerateMipmaps(r,h)&&generateMipmap(e.TEXTURE_2D,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}
// Render targets
// Setup storage for target texture and bind it to correct framebuffer
function setupFrameBufferTexture(t,i,o,s){var l=a.convert(i.texture.format),c=a.convert(i.texture.type),u=getInternalFormat(l,c);n.texImage2D(s,0,u,i.width,i.height,0,l,c,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}
// Setup storage for internal depth/stencil buffers and bind to correct framebuffer
function setupRenderBufferStorage(t,n){e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):n.depthBuffer&&n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):
// FIXME: We don't support !depth !stencil
e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,n.width,n.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}
// Setup resources for a Depth Texture for a FBO (needs an extension)
// Setup GL resources for a non-texture depth buffer
function setupDepthRenderbuffer(t){var n=r.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");
// upload an empty depth texture with framebuffer size
r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),setTexture2D(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===ke)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(n.depthTexture.format!==je)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),setupRenderBufferStorage(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),setupRenderBufferStorage(n.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}
// Set up GL resources for the render target
this.setTexture2D=setTexture2D,this.setTexture3D=function setTexture3D(t,i){var a=r.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_3D,a.__webglTexture))},this.setTextureCube=function setTextureCube(t,s){var l=r.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",onTextureDispose),l.__image__webglTextureCube=e.createTexture(),o.memory.textures++),n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var c=t&&t.isCompressedTexture,u=t.image[0]&&t.image[0].isDataTexture,h=[],d=0;d<6;d++)h[d]=c||u?u?t.image[d].image:t.image[d]:clampToMaxSize(t.image[d],i.maxCubemapSize);var p=h[0],f=isPowerOfTwo(p),m=a.convert(t.format),g=a.convert(t.type),v=getInternalFormat(m,g);for(setTextureParameters(e.TEXTURE_CUBE_MAP,t,f),d=0;d<6;d++)if(c)for(var y,b=h[d].mipmaps,x=0,_=b.length;x<_;x++)y=b[x],t.format!==Ne&&t.format!==Ve?n.getCompressedTextureFormats().indexOf(m)>-1?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,x,v,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,x,v,y.width,y.height,0,m,g,y.data);else u?n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,v,h[d].width,h[d].height,0,m,g,h[d].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,v,m,g,h[d]);l.__maxMipLevel=c?b.length-1:0,textureNeedsGenerateMipmaps(t,f)&&
// We assume images for cube map have the same size.
generateMipmap(e.TEXTURE_CUBE_MAP,t,p.width,p.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function setTextureCubeDynamic(t,i){n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function setupRenderTarget(t){var i=r.get(t),a=r.get(t.texture);t.addEventListener("dispose",onRenderTargetDispose),a.__webglTexture=e.createTexture(),o.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,l=isPowerOfTwo(t);
// Setup framebuffer
if(s){i.__webglFramebuffer=[];for(var c=0;c<6;c++)i.__webglFramebuffer[c]=e.createFramebuffer()}else i.__webglFramebuffer=e.createFramebuffer();
// Setup color buffer
if(s){for(n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture),setTextureParameters(e.TEXTURE_CUBE_MAP,t.texture,l),c=0;c<6;c++)setupFrameBufferTexture(i.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c);textureNeedsGenerateMipmaps(t.texture,l)&&generateMipmap(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else n.bindTexture(e.TEXTURE_2D,a.__webglTexture),setTextureParameters(e.TEXTURE_2D,t.texture,l),setupFrameBufferTexture(i.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),textureNeedsGenerateMipmaps(t.texture,l)&&generateMipmap(e.TEXTURE_2D,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null);
// Setup depth and stencil buffers
t.depthBuffer&&setupDepthRenderbuffer(t)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){var i=t.texture;if(textureNeedsGenerateMipmaps(i,isPowerOfTwo(t))){var a=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=r.get(i).__webglTexture;n.bindTexture(a,o),generateMipmap(a,i,t.width,t.height),n.bindTexture(a,null)}}}
/**
 * @author thespite / http://www.twitter.com/thespite
 */function WebGLUtils(e,t,n){return{convert:function convert(r){var i;if(r===me)return e.REPEAT;if(r===ge)return e.CLAMP_TO_EDGE;if(r===ve)return e.MIRRORED_REPEAT;if(r===ye)return e.NEAREST;if(r===be)return e.NEAREST_MIPMAP_NEAREST;if(r===xe)return e.NEAREST_MIPMAP_LINEAR;if(r===_e)return e.LINEAR;if(r===we)return e.LINEAR_MIPMAP_NEAREST;if(r===Me)return e.LINEAR_MIPMAP_LINEAR;if(r===Ee)return e.UNSIGNED_BYTE;if(r===Oe)return e.UNSIGNED_SHORT_4_4_4_4;if(r===Be)return e.UNSIGNED_SHORT_5_5_5_1;if(r===Re)return e.UNSIGNED_SHORT_5_6_5;if(r===Se)return e.BYTE;if(r===Le)return e.SHORT;if(r===Te)return e.UNSIGNED_SHORT;if(r===Ae)return e.INT;if(r===Ce)return e.UNSIGNED_INT;if(r===Pe)return e.FLOAT;if(r===Ie){if(n.isWebGL2)return e.HALF_FLOAT;if(null!==(i=t.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(r===De)return e.ALPHA;if(r===Ve)return e.RGB;if(r===Ne)return e.RGBA;if(r===Ue)return e.LUMINANCE;if(r===Fe)return e.LUMINANCE_ALPHA;if(r===ke)return e.DEPTH_COMPONENT;if(r===je)return e.DEPTH_STENCIL;if(r===He)return e.RED;if(r===C)return e.FUNC_ADD;if(r===P)return e.FUNC_SUBTRACT;if(r===I)return e.FUNC_REVERSE_SUBTRACT;if(r===R)return e.ZERO;if(r===G)return e.ONE;if(r===D)return e.SRC_COLOR;if(r===V)return e.ONE_MINUS_SRC_COLOR;if(r===N)return e.SRC_ALPHA;if(r===U)return e.ONE_MINUS_SRC_ALPHA;if(r===F)return e.DST_ALPHA;if(r===z)return e.ONE_MINUS_DST_ALPHA;if(r===k)return e.DST_COLOR;if(r===j)return e.ONE_MINUS_DST_COLOR;if(r===H)return e.SRC_ALPHA_SATURATE;if((r===We||r===Xe||r===qe||r===Ye)&&null!==(i=t.get("WEBGL_compressed_texture_s3tc"))){if(r===We)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Xe)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===qe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Ye)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===Ze||r===Je||r===Qe||r===Ke)&&null!==(i=t.get("WEBGL_compressed_texture_pvrtc"))){if(r===Ze)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Je)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Qe)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Ke)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===$e&&null!==(i=t.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((r===et||r===tt||r===nt||r===rt||r===it||r===at||r===ot||r===st||r===lt||r===ct||r===ut||r===ht||r===dt||r===pt)&&null!==(i=t.get("WEBGL_compressed_texture_astc")))return r;if(r===O||r===B){if(n.isWebGL2){if(r===O)return e.MIN;if(r===B)return e.MAX}if(null!==(i=t.get("EXT_blend_minmax"))){if(r===O)return i.MIN_EXT;if(r===B)return i.MAX_EXT}}if(r===Ge){if(n.isWebGL2)return e.UNSIGNED_INT_24_8;if(null!==(i=t.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */function Group(){Object3D.call(this),this.type="Group"}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 * @author WestLangley / http://github.com/WestLangley
*/
function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author greggman / http://games.greggman.com/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author tschw
 */
function PerspectiveCamera(e,t,n,r){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,// width of the film (default in millimeters)
this.filmOffset=0,// horizontal film offset (same unit as gauge)
this.updateProjectionMatrix()}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebVRManager(e){var t=this,n=null,r=null,i=null,a=[],o=new Matrix4,s=new Matrix4,l="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",onVRDisplayPresentChange,!1));var c=new Matrix4,u=new Quaternion,h=new Vector3,d=new PerspectiveCamera;d.bounds=new Vector4(0,0,.5,1),d.layers.enable(1);var p=new PerspectiveCamera;p.bounds=new Vector4(.5,0,.5,1),p.layers.enable(2);var f,m,g=new ArrayCamera([d,p]);
//
function isPresenting(){return null!==n&&!0===n.isPresenting}function onVRDisplayPresentChange(){if(isPresenting()){var r=n.getEyeParameters("left"),i=r.renderWidth,a=r.renderHeight;m=e.getPixelRatio(),f=e.getSize(),e.setDrawingBufferSize(2*i,a,1),y.start()}else t.enabled&&e.setDrawingBufferSize(f.width,f.height,m),y.stop()}
//
g.layers.enable(1),g.layers.enable(2);var v=[];function findGamepad(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),n=0,r=0,i=t.length;n<i;n++){var a=t[n];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(r===e)return a;r++}}}
//
this.enabled=!1,this.getController=function(e){var t=a[e];return void 0===t&&((t=new Group).matrixAutoUpdate=!1,t.visible=!1,a[e]=t),t},this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e),y.setContext(e)},this.setFrameOfReferenceType=function(e){l=e},this.setPoseTarget=function(e){void 0!==e&&(i=e)},this.getCamera=function(e){var t="stage"===l?1.6:0;if(null===n)return e.position.set(0,t,0),e;
//
if(n.depthNear=e.near,n.depthFar=e.far,n.getFrameData(r),"stage"===l){var f=n.stageParameters;f?o.fromArray(f.sittingToStandingTransform):o.makeTranslation(0,t,0)}var m=r.pose,y=null!==i?i:e;if(
// We want to manipulate poseObject by its position and quaternion components since users may rely on them.
y.matrix.copy(o),y.matrix.decompose(y.position,y.quaternion,y.scale),null!==m.orientation&&(u.fromArray(m.orientation),y.quaternion.multiply(u)),null!==m.position&&(u.setFromRotationMatrix(o),h.fromArray(m.position),h.applyQuaternion(u),y.position.add(h)),y.updateMatrixWorld(),!1===n.isPresenting)return e;
//
d.near=e.near,p.near=e.near,d.far=e.far,p.far=e.far,g.matrixWorld.copy(e.matrixWorld),g.matrixWorldInverse.copy(e.matrixWorldInverse),d.matrixWorldInverse.fromArray(r.leftViewMatrix),p.matrixWorldInverse.fromArray(r.rightViewMatrix),
// TODO (mrdoob) Double check this code
s.getInverse(o),"stage"===l&&(d.matrixWorldInverse.multiply(s),p.matrixWorldInverse.multiply(s));var b=y.parent;null!==b&&(c.getInverse(b.matrixWorld),d.matrixWorldInverse.multiply(c),p.matrixWorldInverse.multiply(c)),
// envMap and Mirror needs camera.matrixWorld
d.matrixWorld.getInverse(d.matrixWorldInverse),p.matrixWorld.getInverse(p.matrixWorldInverse),d.projectionMatrix.fromArray(r.leftProjectionMatrix),p.projectionMatrix.fromArray(r.rightProjectionMatrix),
// HACK (mrdoob)
// https://github.com/w3c/webvr/issues/203
g.projectionMatrix.copy(d.projectionMatrix);
//
var x=n.getLayers();if(x.length){var _=x[0];null!==_.leftBounds&&4===_.leftBounds.length&&d.bounds.fromArray(_.leftBounds),null!==_.rightBounds&&4===_.rightBounds.length&&p.bounds.fromArray(_.rightBounds)}return function updateControllers(){for(var e=0;e<a.length;e++){var t=a[e],n=findGamepad(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;
//  Pose
var r=n.pose;!1===r.hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(o),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;
//  Trigger
var i="Daydream Controller"===n.id?0:1;v[e]!==n.buttons[i].pressed&&(v[e]=n.buttons[i].pressed,!0===v[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return o},this.isPresenting=isPresenting;
// Animation Loop
var y=new WebGLAnimation;this.setAnimationLoop=function(e){y.setAnimationLoop(e)},this.submitFrame=function(){isPresenting()&&n.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",onVRDisplayPresentChange)}}
/**
 * @author mrdoob / http://mrdoob.com/
 */
/**
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 * @author tschw
 */
function WebGLRenderer(e){console.log("THREE.WebGLRenderer",r);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,l=void 0===e.depth||e.depth,c=void 0===e.stencil||e.stencil,u=void 0!==e.antialias&&e.antialias,h=void 0===e.premultipliedAlpha||e.premultipliedAlpha,d=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,p=void 0!==e.powerPreference?e.powerPreference:"default",v=null,y=null;
// public properties
this.domElement=t,this.context=null,
// clearing
this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,
// scene graph
this.sortObjects=!0,
// user-defined clipping
this.clippingPlanes=[],this.localClippingEnabled=!1,
// physically based shading
this.gammaFactor=2,// for backwards compatibility
this.gammaInput=!1,this.gammaOutput=!1,
// physical lights
this.physicallyCorrectLights=!1,
// tone mapping
this.toneMapping=re,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,
// morphs
this.maxMorphTargets=8,this.maxMorphNormals=4;
// internal properties
var b,x,_,w,P,I,O,B,R,G,D,V,N,U,F,z,k,j,H=this,$=!1,
// internal state cache
ee=null,te=null,ne=null,ie=-1,
// geometry and program caching
ae={geometry:null,program:null,wireframe:!1},oe=null,se=null,le=new Vector4,ce=new Vector4,ue=null,
//
he=0,
//
de=t.width,pe=t.height,fe=1,me=new Vector4(0,0,de,pe),ge=new Vector4(0,0,de,pe),ve=!1,
// frustum
ye=new Frustum,
// clipping
be=new
/**
 * @author tschw
 */
function WebGLClipping(){var e=this,t=null,n=0,r=!1,i=!1,a=new Plane,o=new Matrix3,s={value:null,needsUpdate:!1};function resetGlobalState(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function projectPlanes(t,n,r,i){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==i||null===c){var u=r+4*l,h=n.matrixWorldInverse;o.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=r;d!==l;++d,p+=4)a.copy(t[d]).applyMatrix4(h,o),a.normal.toArray(c,p),c[p+3]=a.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||
// enable state of previous frame - the clipping code has to
// run another frame in order to reset the state:
0!==n||r;return r=i,t=projectPlanes(e,a,0),n=e.length,o},this.beginShadows=function(){i=!0,projectPlanes(null)},this.endShadows=function(){i=!1,resetGlobalState()},this.setState=function(e,a,o,l,c,u){if(!r||null===e||0===e.length||i&&!o)
// there's no local clipping
i?
// there's no global clipping
projectPlanes(null):resetGlobalState();else{var h=i?0:n,d=4*h,p=c.clippingState||null;s.value=p,// ensure unique state
p=projectPlanes(e,l,d,u);for(var f=0;f!==d;++f)p[f]=t[f];c.clippingState=p,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=h}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */,xe=!1,_e=!1,
// camera matrices cache
we=new Matrix4,Me=new Vector3;function getTargetPixelRatio(){return null===te?fe:1}
// initialize
try{var Se={alpha:i,depth:l,stencil:c,antialias:u,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:p};
// event listeners must be registered before WebGL context is created, see #12753
if(t.addEventListener("webglcontextlost",onContextLost,!1),t.addEventListener("webglcontextrestored",onContextRestore,!1),null===(b=n||t.getContext("webgl",Se)||t.getContext("experimental-webgl",Se)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");
// Some experimental-webgl implementations do not have getShaderPrecisionFormat
void 0===b.getShaderPrecisionFormat&&(b.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function initGLContext(){x=new function WebGLExtensions(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */(b),(_=new
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLCapabilities(e,t,n){var r;function getMaxPrecision(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var i="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==n.precision?n.precision:"highp",o=getMaxPrecision(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);var s=!0===n.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_TEXTURE_SIZE),h=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=c>0,v=i||!!t.get("OES_texture_float");return{isWebGL2:i,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:a,logarithmicDepthBuffer:s,maxTextures:l,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:h,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v}}(b,x,e)).isWebGL2||(x.get("WEBGL_depth_texture"),x.get("OES_texture_float"),x.get("OES_texture_half_float"),x.get("OES_texture_half_float_linear"),x.get("OES_standard_derivatives"),x.get("OES_element_index_uint"),x.get("ANGLE_instanced_arrays")),x.get("OES_texture_float_linear"),j=new WebGLUtils(b,x,_),(w=new function WebGLState(e,t,n,r){
//
var i=new function ColorBuffer(){var t=!1,n=new Vector4,r=null,i=new Vector4(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},l=new function DepthBuffer(){var t=!1,n=null,r=null,i=null;return{setTest:function(t){t?enable(e.DEPTH_TEST):disable(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case W:e.depthFunc(e.NEVER);break;case X:e.depthFunc(e.ALWAYS);break;case q:e.depthFunc(e.LESS);break;case Y:e.depthFunc(e.LEQUAL);break;case Z:e.depthFunc(e.EQUAL);break;case J:e.depthFunc(e.GEQUAL);break;case Q:e.depthFunc(e.GREATER);break;case K:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},c=new function StencilBuffer(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(t){t?enable(e.STENCIL_TEST):disable(e.STENCIL_TEST)},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}},u=e.getParameter(e.MAX_VERTEX_ATTRIBS),h=new Uint8Array(u),d=new Uint8Array(u),p=new Uint8Array(u),f={},v=null,y=null,b=null,x=null,_=null,w=null,P=null,I=null,O=null,B=null,R=!1,G=null,D=null,V=null,N=null,U=null,F=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),z=!1,k=0,j=e.getParameter(e.VERSION);-1!==j.indexOf("WebGL")?(k=parseFloat(/^WebGL\ ([0-9])/.exec(j)[1]),z=k>=1):-1!==j.indexOf("OpenGL ES")&&(k=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(j)[1]),z=k>=2);var H=null,$={},ee=new Vector4,te=new Vector4;function createTexture(t,n,r){var i=new Uint8Array(4),a=e.createTexture();// 4 is required to match default unpack alignment of 4.
e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<r;o++)e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return a}var ne={};function enableAttributeAndDivisor(n,i){h[n]=1,0===d[n]&&(e.enableVertexAttribArray(n),d[n]=1),p[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),p[n]=i)}function enable(t){!0!==f[t]&&(e.enable(t),f[t]=!0)}function disable(t){!1!==f[t]&&(e.disable(t),f[t]=!1)}function setBlending(t,r,i,a,o,s,l,c){if(t!==M){if(b||(enable(e.BLEND),b=!0),t===A)
// custom blending
o=o||r,s=s||i,l=l||a,r===_&&o===I||(e.blendEquationSeparate(n.convert(r),n.convert(o)),_=r,I=o),i===w&&a===P&&s===O&&l===B||(e.blendFuncSeparate(n.convert(i),n.convert(a),n.convert(s),n.convert(l)),w=i,P=a,O=s,B=l),x=t,R=null;else if(t!==x||c!==R){if(_===C&&I===C||(e.blendEquation(e.FUNC_ADD),_=C,I=C),c)switch(t){case E:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case S:e.blendFunc(e.ONE,e.ONE);break;case L:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case T:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case E:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case S:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case L:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case T:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}w=null,P=null,O=null,B=null,x=t,R=c}}else b&&(disable(e.BLEND),b=!1)}
//
function setFlipSided(t){G!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),G=t)}function setCullFace(t){t!==a?(enable(e.CULL_FACE),t!==D&&(t===o?e.cullFace(e.BACK):t===s?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):disable(e.CULL_FACE),D=t}function setPolygonOffset(t,n,r){t?(enable(e.POLYGON_OFFSET_FILL),N===n&&U===r||(e.polygonOffset(n,r),N=n,U=r)):disable(e.POLYGON_OFFSET_FILL)}
// texture
function activeTexture(t){void 0===t&&(t=e.TEXTURE0+F-1),H!==t&&(e.activeTexture(t),H=t)}return ne[e.TEXTURE_2D]=createTexture(e.TEXTURE_2D,e.TEXTURE_2D,1),ne[e.TEXTURE_CUBE_MAP]=createTexture(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),
// init
i.setClear(0,0,0,1),l.setClear(1),c.setClear(0),enable(e.DEPTH_TEST),l.setFunc(Y),setFlipSided(!1),setCullFace(o),enable(e.CULL_FACE),setBlending(M),{buffers:{color:i,depth:l,stencil:c},initAttributes:
//
function initAttributes(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function enableAttribute(e){enableAttributeAndDivisor(e,0)},enableAttributeAndDivisor:enableAttributeAndDivisor,disableUnusedAttributes:function disableUnusedAttributes(){for(var t=0,n=d.length;t!==n;++t)d[t]!==h[t]&&(e.disableVertexAttribArray(t),d[t]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function getCompressedTextureFormats(){if(null===v&&(v=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)v.push(n[r]);return v},useProgram:function useProgram(t){return y!==t&&(e.useProgram(t),y=t,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,n){t.side===g?disable(e.CULL_FACE):enable(e.CULL_FACE);var r=t.side===m;n&&(r=!r),setFlipSided(r),t.blending===E&&!1===t.transparent?setBlending(M):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),i.setMask(t.colorWrite),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(t){t!==V&&(z&&e.lineWidth(t),V=t)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(e.SCISSOR_TEST):disable(e.SCISSOR_TEST)},activeTexture:activeTexture,bindTexture:function bindTexture(t,n){null===H&&activeTexture();var r=$[H];void 0===r&&(r={type:void 0,texture:void 0},$[H]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ne[t]),r.type=t,r.texture=n)},compressedTexImage2D:function compressedTexImage2D(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function texImage2D(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function texImage3D(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}
//
,scissor:function scissor(t){!1===ee.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ee.copy(t))},viewport:function viewport(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))}
//
,reset:function reset(){for(var t=0;t<d.length;t++)1===d[t]&&(e.disableVertexAttribArray(t),d[t]=0);f={},v=null,H=null,$={},y=null,x=null,G=null,D=null,i.reset(),l.reset(),c.reset()}}}(b,x,j,_)).scissor(ce.copy(ge).multiplyScalar(fe)),w.viewport(le.copy(me).multiplyScalar(fe)),P=new
/**
 * @author Mugen87 / https://github.com/Mugen87
 */
function WebGLInfo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function reset(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function update(n,r,i){switch(i=i||1,t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=i*(n-2);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}(b),I=new function WebGLProperties(){var e=new WeakMap;return{get:function get(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function remove(t){e.delete(t)},update:function update(t,n,r){e.get(t)[n]=r},dispose:function dispose(){e=new WeakMap}}},O=new WebGLTextures(b,x,w,I,_,j,P),B=new WebGLAttributes(b),R=new function WebGLGeometries(e,t,n){var r={},i={};function onGeometryDispose(e){var a=e.target,o=r[a.id];for(var s in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[s]);a.removeEventListener("dispose",onGeometryDispose),delete r[a.id];var l=i[o.id];l&&(t.remove(l),delete i[o.id]),
//
n.memory.geometries--}return{get:function get(e,t){var i=r[t.id];return i||(t.addEventListener("dispose",onGeometryDispose),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry).setFromObject(e)),i=t._bufferGeometry),r[t.id]=i,n.memory.geometries++,i)},update:function update(n){var r=n.index,i=n.attributes;for(var a in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),i)t.update(i[a],e.ARRAY_BUFFER);
// morph targets
var o=n.morphAttributes;for(var a in o)for(var s=o[a],l=0,c=s.length;l<c;l++)t.update(s[l],e.ARRAY_BUFFER)},getWireframeAttribute:function getWireframeAttribute(n){var r=i[n.id];if(r)return r;var a,o=[],s=n.index,l=n.attributes;
// console.time( 'wireframe' );
if(null!==s)for(var c=0,u=(a=s.array).length;c<u;c+=3){var h=a[c+0],d=a[c+1],p=a[c+2];o.push(h,d,d,p,p,h)}else for(c=0,u=(a=l.position.array).length/3-1;c<u;c+=3)h=c+0,d=c+1,p=c+2,o.push(h,d,d,p,p,h);
// console.timeEnd( 'wireframe' );
return r=new(arrayMax(o)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(o,1),t.update(r,e.ELEMENT_ARRAY_BUFFER),i[n.id]=r,r}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */(b,B,P),G=new
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLObjects(e,t){var n={};return{update:function update(r){var i=t.render.frame,a=r.geometry,o=e.get(r,a);
// Update once per frame
return n[o.id]!==i&&(a.isGeometry&&o.updateFromObject(r),e.update(o),n[o.id]=i),o},dispose:function dispose(){n={}}}}(R,P),F=new function WebGLMorphtargets(e){var t={},n=new Float32Array(8);return{update:function update(r,i,a,o){var s=r.morphTargetInfluences,l=s.length,c=t[i.id];if(void 0===c){
// initialise list
c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[i.id]=c}var h=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal;
// Remove current morphAttributes
for(u=0;u<l;u++)0!==(p=c[u])[1]&&(h&&i.removeAttribute("morphTarget"+u),d&&i.removeAttribute("morphNormal"+u));
// Collect influences
for(u=0;u<l;u++)(p=c[u])[0]=u,p[1]=s[u];
// Add morphAttributes
for(c.sort(absNumericalSort),u=0;u<8;u++){var p;if(p=c[u]){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+u,h[f]),d&&i.addAttribute("morphNormal"+u,d[f]),n[u]=m;continue}}n[u]=0}o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}(b),D=new WebGLPrograms(H,x,_),V=new WebGLRenderLists,N=new function WebGLRenderStates(){var e={};return{get:function get(t,n){var r;return void 0===e[t.id]?(r=new WebGLRenderState,e[t.id]={},e[t.id][n.id]=r):void 0===e[t.id][n.id]?(r=new WebGLRenderState,e[t.id][n.id]=r):r=e[t.id][n.id],r},dispose:function dispose(){e={}}}},U=new
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLBackground(e,t,n,r){var i,a,o=new Color(0),s=0;function setClear(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),setClear(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){setClear(o,s=e)},render:function render(t,r,l,c){var u=r.background;null===u?setClear(o,s):u&&u.isColor&&(setClear(u,1),c=!0),(e.autoClear||c)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),u&&u.isCubeTexture?(void 0===a&&((a=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({uniforms:kt.clone(Wt.cube.uniforms),vertexShader:Wt.cube.vertexShader,fragmentShader:Wt.cube.fragmentShader,side:m,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},n.update(a)),a.material.uniforms.tCube.value=u,t.push(a,a.geometry,a.material,0,null)):u&&u.isTexture&&(void 0===i&&((i=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({uniforms:kt.clone(Wt.background.uniforms),vertexShader:Wt.background.vertexShader,fragmentShader:Wt.background.fragmentShader,side:f,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),n.update(i)),i.material.uniforms.t2D.value=u,t.push(i,i.geometry,i.material,0,null))}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */(H,w,G,h),z=new function WebGLBufferRenderer(e,t,n,r){var i;
//
this.setMode=function setMode(e){i=e},this.render=function render(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function renderInstances(a,o,s){var l;if(r.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[r.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](i,o,s,a.maxInstancedCount),n.update(s,i,a.maxInstancedCount)}}(b,x,P,_),k=new function WebGLIndexedBufferRenderer(e,t,n,r){var i,a,o;
//
this.setMode=function setMode(e){i=e},this.setIndex=function setIndex(e){a=e.type,o=e.bytesPerElement},this.render=function render(t,r){e.drawElements(i,r,a,t*o),n.update(r,i)},this.renderInstances=function renderInstances(s,l,c){var u;if(r.isWebGL2)u=e;else if(null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[r.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](i,c,a,l*o,s.maxInstancedCount),n.update(c,i,s.maxInstancedCount)}}(b,x,P,_),P.programs=D.programs,H.context=b,H.capabilities=_,H.extensions=x,H.properties=I,H.renderLists=V,H.state=w,H.info=P}initGLContext();
// vr
var Le=null;"undefined"!=typeof navigator&&(Le="xr"in navigator?new function WebXRManager(e){var t=e.context,n=null,r=null,i=null,a="stage",o=null,s=[],l=[];function isPresenting(){return null!==r&&null!==i}
//
var c=new PerspectiveCamera;c.layers.enable(1),c.viewport=new Vector4;var u=new PerspectiveCamera;u.layers.enable(2),u.viewport=new Vector4;var h=new ArrayCamera([c,u]);
//
function onSessionEvent(e){var t=s[l.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function onSessionEnd(){e.setFramebuffer(null),p.stop()}function updateCamera(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}h.layers.enable(1),h.layers.enable(2),
//
this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new Group).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e),e instanceof XRDevice&&t.setCompatibleXRDevice(e)},this.setFrameOfReferenceType=function(e){a=e},this.setSession=function(n){null!==(r=n)&&(r.addEventListener("select",onSessionEvent),r.addEventListener("selectstart",onSessionEvent),r.addEventListener("selectend",onSessionEvent),r.addEventListener("end",onSessionEnd),r.baseLayer=new XRWebGLLayer(r,t),r.requestFrameOfReference(a).then(function(t){i=t,e.setFramebuffer(r.baseLayer.framebuffer),p.setContext(r),p.start()}),
//
l=r.getInputSources(),r.addEventListener("inputsourceschange",function(){l=r.getInputSources(),console.log(l)}))},this.getCamera=function(e){if(isPresenting()){var t=e.parent,n=h.cameras;
// apply camera.parent to cameraVR
updateCamera(h,t);for(var r=0;r<n.length;r++)updateCamera(n[r],t);
// update camera and its children
e.matrixWorld.copy(h.matrixWorld);for(var i=e.children,a=(r=0,i.length);r<a;r++)i[r].updateMatrixWorld(!0);return h}return e},this.isPresenting=isPresenting;
// Animation Loop
var d=null,p=new WebGLAnimation;p.setAnimationLoop(function onAnimationFrame(e,t){if(null!==(o=t.getDevicePose(i)))for(var n=r.baseLayer,a=t.views,c=0;c<a.length;c++){var u=a[c],p=n.getViewport(u),f=o.getViewMatrix(u),m=h.cameras[c];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(u.projectionMatrix),m.viewport.set(p.x,p.y,p.width,p.height),0===c&&(h.matrix.copy(m.matrix),
// HACK (mrdoob)
// https://github.com/w3c/webvr/issues/203
h.projectionMatrix.copy(m.projectionMatrix))}
//
for(c=0;c<s.length;c++){var g=s[c],v=l[c];if(v){var y=t.getInputPose(v,i);if(null!==y){"targetRay"in y?g.matrix.elements=y.targetRay.transformMatrix:"pointerMatrix"in y&&(
// DEPRECATED
g.matrix.elements=y.pointerMatrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.visible=!0;continue}}g.visible=!1}d&&d(e)}),this.setAnimationLoop=function(e){d=e},this.dispose=function(){},
// DEPRECATED
this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}(H):new WebVRManager(H)),this.vr=Le;
// shadow map
var Te=new WebGLShadowMap(H,G,_.maxTextureSize);
// Events
function onContextLost(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),$=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),$=!1,initGLContext()}function onMaterialDispose(e){var t=e.target;t.removeEventListener("dispose",onMaterialDispose),
// Buffer deallocation
function deallocateMaterial(e){releaseMaterialProgramReference(e),I.remove(e)}(t)}function releaseMaterialProgramReference(e){var t=I.get(e).program;e.program=void 0,void 0!==t&&D.releaseProgram(t)}
// Buffer rendering
this.shadowMap=Te,
// API
this.getContext=function(){return b},this.getContextAttributes=function(){return b.getContextAttributes()},this.forceContextLoss=function(){var e=x.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=x.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return fe},this.setPixelRatio=function(e){void 0!==e&&(fe=e,this.setSize(de,pe,!1))},this.getSize=function(){return{width:de,height:pe}},this.setSize=function(e,n,r){Le.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(de=e,pe=n,t.width=e*fe,t.height=n*fe,!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(){return{width:de*fe,height:pe*fe}},this.setDrawingBufferSize=function(e,n,r){de=e,pe=n,fe=r,t.width=e*r,t.height=n*r,this.setViewport(0,0,e,n)},this.getCurrentViewport=function(){return le},this.setViewport=function(e,t,n,r){me.set(e,pe-t-r,n,r),w.viewport(le.copy(me).multiplyScalar(fe))},this.setScissor=function(e,t,n,r){ge.set(e,pe-t-r,n,r),w.scissor(ce.copy(ge).multiplyScalar(fe))},this.setScissorTest=function(e){w.setScissorTest(ve=e)},
// Clearing
this.getClearColor=function(){return U.getClearColor()},this.setClearColor=function(){U.setClearColor.apply(U,arguments)},this.getClearAlpha=function(){return U.getClearAlpha()},this.setClearAlpha=function(){U.setClearAlpha.apply(U,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=b.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=b.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=b.STENCIL_BUFFER_BIT),b.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},
//
this.dispose=function(){t.removeEventListener("webglcontextlost",onContextLost,!1),t.removeEventListener("webglcontextrestored",onContextRestore,!1),V.dispose(),N.dispose(),I.dispose(),G.dispose(),Le.dispose(),Ce.stop()},this.renderBufferImmediate=function(e,t){w.initAttributes();var n=I.get(e);e.hasPositions&&!n.position&&(n.position=b.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=b.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=b.createBuffer()),e.hasColors&&!n.color&&(n.color=b.createBuffer());var r=t.getAttributes();e.hasPositions&&(b.bindBuffer(b.ARRAY_BUFFER,n.position),b.bufferData(b.ARRAY_BUFFER,e.positionArray,b.DYNAMIC_DRAW),w.enableAttribute(r.position),b.vertexAttribPointer(r.position,3,b.FLOAT,!1,0,0)),e.hasNormals&&(b.bindBuffer(b.ARRAY_BUFFER,n.normal),b.bufferData(b.ARRAY_BUFFER,e.normalArray,b.DYNAMIC_DRAW),w.enableAttribute(r.normal),b.vertexAttribPointer(r.normal,3,b.FLOAT,!1,0,0)),e.hasUvs&&(b.bindBuffer(b.ARRAY_BUFFER,n.uv),b.bufferData(b.ARRAY_BUFFER,e.uvArray,b.DYNAMIC_DRAW),w.enableAttribute(r.uv),b.vertexAttribPointer(r.uv,2,b.FLOAT,!1,0,0)),e.hasColors&&(b.bindBuffer(b.ARRAY_BUFFER,n.color),b.bufferData(b.ARRAY_BUFFER,e.colorArray,b.DYNAMIC_DRAW),w.enableAttribute(r.color),b.vertexAttribPointer(r.color,3,b.FLOAT,!1,0,0)),w.disableUnusedAttributes(),b.drawArrays(b.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,a){var o=i.isMesh&&i.normalMatrix.determinant()<0;w.setMaterial(r,o);var s=setProgram(e,t,r,i),l=!1;ae.geometry===n.id&&ae.program===s.id&&ae.wireframe===(!0===r.wireframe)||(ae.geometry=n.id,ae.program=s.id,ae.wireframe=!0===r.wireframe,l=!0),i.morphTargetInfluences&&(F.update(i,n,r,s),l=!0);
//
var c,u=n.index,h=n.attributes.position,d=1;!0===r.wireframe&&(u=R.getWireframeAttribute(n),d=2);var p=z;null!==u&&(c=B.get(u),(p=k).setIndex(c)),l&&(!function setupVertexAttributes(e,t,n){if(n&&n.isInstancedBufferGeometry&!_.isWebGL2&&null===x.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");w.initAttributes();var r=n.attributes,i=t.getAttributes(),a=e.defaultAttributeValues;for(var o in i){var s=i[o];if(s>=0){var l=r[o];if(void 0!==l){var c=l.normalized,u=l.itemSize,h=B.get(l);
// TODO Attribute may not be available on context restore
if(void 0===h)continue;var d=h.buffer,p=h.type,f=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var m=l.data,g=m.stride,v=l.offset;m&&m.isInstancedInterleavedBuffer?(w.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=m.meshPerAttribute*m.count)):w.enableAttribute(s),b.bindBuffer(b.ARRAY_BUFFER,d),b.vertexAttribPointer(s,u,p,c,g*f,v*f)}else l.isInstancedBufferAttribute?(w.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):w.enableAttribute(s),b.bindBuffer(b.ARRAY_BUFFER,d),b.vertexAttribPointer(s,u,p,c,0,0)}else if(void 0!==a){var y=a[o];if(void 0!==y)switch(y.length){case 2:b.vertexAttrib2fv(s,y);break;case 3:b.vertexAttrib3fv(s,y);break;case 4:b.vertexAttrib4fv(s,y);break;default:b.vertexAttrib1fv(s,y)}}}}w.disableUnusedAttributes()}
// Compile
(r,s,n),null!==u&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.buffer));
//
var f=1/0;null!==u?f=u.count:void 0!==h&&(f=h.count);var m=n.drawRange.start*d,g=n.drawRange.count*d,v=null!==a?a.start*d:0,y=null!==a?a.count*d:1/0,M=Math.max(m,v),E=Math.min(f,m+g,v+y)-1,S=Math.max(0,E-M+1);if(0!==S){
//
if(i.isMesh)if(!0===r.wireframe)w.setLineWidth(r.wireframeLinewidth*getTargetPixelRatio()),p.setMode(b.LINES);else switch(i.drawMode){case Mt:p.setMode(b.TRIANGLES);break;case Et:p.setMode(b.TRIANGLE_STRIP);break;case St:p.setMode(b.TRIANGLE_FAN)}else if(i.isLine){var L=r.linewidth;void 0===L&&(L=1),// Not using Line*Material
w.setLineWidth(L*getTargetPixelRatio()),i.isLineSegments?p.setMode(b.LINES):i.isLineLoop?p.setMode(b.LINE_LOOP):p.setMode(b.LINE_STRIP)}else i.isPoints?p.setMode(b.POINTS):i.isSprite&&p.setMode(b.TRIANGLES);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&p.renderInstances(n,M,S):p.render(M,S)}},this.compile=function(e,t){(y=N.get(e,t)).init(),e.traverse(function(e){e.isLight&&(y.pushLight(e),e.castShadow&&y.pushShadow(e))}),y.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)initMaterial(t.material[n],e.fog,t);else initMaterial(t.material,e.fog,t)})};
// Animation Loop
var Ae=null;var Ce=new WebGLAnimation;function renderObjects(e,t,n,r){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,c=void 0===r?o.material:r,u=o.group;if(n.isArrayCamera){se=n;for(var h=n.cameras,d=0,p=h.length;d<p;d++){var f=h[d];if(s.layers.test(f.layers)){if("viewport"in f)// XR
w.viewport(le.copy(f.viewport));else{var m=f.bounds,g=m.x*de,v=m.y*pe,b=m.z*de,x=m.w*pe;w.viewport(le.set(g,v,b,x).multiplyScalar(fe))}y.setupLights(f),renderObject(s,t,f,l,c,u)}}}else se=null,renderObject(s,t,n,l,c,u)}}function renderObject(e,t,n,r,i,a){if(e.onBeforeRender(H,t,n,r,i,a),y=N.get(t,se||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){w.setMaterial(i);var o=setProgram(n,t.fog,i,e);ae.geometry=null,ae.program=null,ae.wireframe=!1,function renderObjectImmediate(e,t){e.render(function(e){H.renderBufferImmediate(e,t)})}(e,o)}else H.renderBufferDirect(n,t.fog,r,i,e,a);e.onAfterRender(H,t,n,r,i,a),y=N.get(t,se||n)}function initMaterial(e,t,n){var r=I.get(e),i=y.state.lights,a=y.state.shadowsArray,o=r.lightsHash,s=i.state.hash,l=D.getParameters(e,i.state,a,t,be.numPlanes,be.numIntersection,n),c=D.getProgramCode(e,l),u=r.program,h=!0;if(void 0===u)
// new material
e.addEventListener("dispose",onMaterialDispose);else if(u.code!==c)
// changed glsl or parameters
releaseMaterialProgramReference(e);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,h=!1;else{if(void 0!==l.shaderID)
// same glsl and uniform list
return;
// only rebuild uniform list
h=!1}if(h){if(l.shaderID){var d=Wt[l.shaderID];r.shader={name:e.type,uniforms:kt.clone(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,H),
// Computing code again as onBeforeCompile may have changed the shaders
c=D.getProgramCode(e,l),u=D.acquireProgram(e,r.shader,l,c),r.program=u,e.program=u}var p=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<H.maxMorphTargets;f++)p["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<H.maxMorphNormals;f++)p["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var m=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=be.numPlanes,r.numIntersection=be.numIntersection,m.clippingPlanes=be.uniform),r.fog=t,
// store the light setup it was created for
void 0===o&&(r.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(
// wire up the material to this renderer's lighting state
m.ambientLightColor.value=i.state.ambient,m.directionalLights.value=i.state.directional,m.spotLights.value=i.state.spot,m.rectAreaLights.value=i.state.rectArea,m.pointLights.value=i.state.point,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);var g=r.program.getUniforms(),v=WebGLUniforms.seqWithValue(g.seq,m);r.uniformsList=v}function setProgram(e,t,n,r){he=0;var i=I.get(n),a=y.state.lights,o=i.lightsHash,s=a.state.hash;if(xe&&(_e||e!==oe)){var l=e===oe&&n.id===ie;
// we might want to call this function with some ClippingGroup
// object instead of the material, once it becomes feasible
// (#8465, #8379)
be.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,i,l)}!1===n.needsUpdate&&(void 0===i.program?n.needsUpdate=!0:n.fog&&i.fog!==t?n.needsUpdate=!0:(!n.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===i.numClippingPlanes||i.numClippingPlanes===be.numPlanes&&i.numIntersection===be.numIntersection)||(n.needsUpdate=!0)),n.needsUpdate&&(initMaterial(n,t,r),n.needsUpdate=!1);var c=!1,u=!1,h=!1,d=i.program,p=d.getUniforms(),f=i.shader.uniforms;if(w.useProgram(d.program)&&(c=!0,u=!0,h=!0),n.id!==ie&&(ie=n.id,u=!0),c||oe!==e){
// load material specific uniforms
// (shader material also gets them for the sake of genericity)
if(p.setValue(b,"projectionMatrix",e.projectionMatrix),_.logarithmicDepthBuffer&&p.setValue(b,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),oe!==e&&(oe=e,
// lighting uniforms depend on the camera so enforce an update
// now, in case this material supports lights - or later, when
// the next material that does gets activated:
u=!0,// set to true on material change
h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var g=p.map.cameraPosition;void 0!==g&&g.setValue(b,Me.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&p.setValue(b,"viewMatrix",e.matrixWorldInverse)}
// skinning uniforms must be set even if material didn't change
// auto-setting of texture unit for bone texture must go before other textures
// not sure why, but otherwise weird things happen
if(n.skinning){p.setOptional(b,r,"bindMatrix"),p.setOptional(b,r,"bindMatrixInverse");var v=r.skeleton;if(v){var x=v.bones;if(_.floatVertexTextures){if(void 0===v.boneTexture){
// layout (1 matrix = 4 pixels)
//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)
//  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)
//       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)
//       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)
//       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)
var M=Math.sqrt(4*x.length);// 4 pixels needed for 1 matrix
M=Nt.ceilPowerOfTwo(M),M=Math.max(M,4);var E=new Float32Array(M*M*4);// 4 floats per RGBA pixel
E.set(v.boneMatrices);// copy current values
var S=new DataTexture(E,M,M,Ne,Pe);S.needsUpdate=!0,v.boneMatrices=E,v.boneTexture=S,v.boneTextureSize=M}p.setValue(b,"boneTexture",v.boneTexture),p.setValue(b,"boneTextureSize",v.boneTextureSize)}else p.setOptional(b,v,"boneMatrices")}}return u&&(p.setValue(b,"toneMappingExposure",H.toneMappingExposure),p.setValue(b,"toneMappingWhitePoint",H.toneMappingWhitePoint),n.lights&&
// the current material requires lighting info
// note: all lighting uniforms are always set correctly
// they simply reference the renderer's state for their
// values
//
// use the current material's .needsUpdate flags to set
// the GL state when required
// If uniforms are marked as clean, they don't need to be loaded to the GPU.
function markUniformsLightsNeedsUpdate(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}
// Textures
(f,h),
// refresh uniforms common to several materials
t&&n.fog&&function refreshUniformsFog(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(f,t),n.isMeshBasicMaterial?refreshUniformsCommon(f,n):n.isMeshLambertMaterial?(refreshUniformsCommon(f,n),function refreshUniformsLambert(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(f,n)):n.isMeshPhongMaterial?(refreshUniformsCommon(f,n),n.isMeshToonMaterial?function refreshUniformsToon(e,t){refreshUniformsPhong(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(f,n):refreshUniformsPhong(f,n)):n.isMeshStandardMaterial?(refreshUniformsCommon(f,n),n.isMeshPhysicalMaterial?function refreshUniformsPhysical(e,t){refreshUniformsStandard(e,t),e.reflectivity.value=t.reflectivity,// also part of uniforms common
e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(f,n):refreshUniformsStandard(f,n)):n.isMeshMatcapMaterial?(refreshUniformsCommon(f,n),function refreshUniformsMatcap(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(f,n)):n.isMeshDepthMaterial?(refreshUniformsCommon(f,n),function refreshUniformsDepth(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(f,n)):n.isMeshDistanceMaterial?(refreshUniformsCommon(f,n),function refreshUniformsDistance(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(f,n)):n.isMeshNormalMaterial?(refreshUniformsCommon(f,n),function refreshUniformsNormal(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(f,n)):n.isLineBasicMaterial?(!function refreshUniformsLine(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(f,n),n.isLineDashedMaterial&&function refreshUniformsDash(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(f,n)):n.isPointsMaterial?function refreshUniformsPoints(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*fe,e.scale.value=.5*pe,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(f,n):n.isSpriteMaterial?function refreshUniformsSprites(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(f,n):n.isShadowMaterial&&(f.color.value=n.color,f.opacity.value=n.opacity),
// RectAreaLight Texture
// TODO (mrdoob): Find a nicer implementation
void 0!==f.ltc_1&&(f.ltc_1.value=Ht.LTC_1),void 0!==f.ltc_2&&(f.ltc_2.value=Ht.LTC_2),WebGLUniforms.upload(b,i.uniformsList,f,H)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(WebGLUniforms.upload(b,i.uniformsList,f,H),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&p.setValue(b,"center",r.center),
// common matrices
p.setValue(b,"modelViewMatrix",r.modelViewMatrix),p.setValue(b,"normalMatrix",r.normalMatrix),p.setValue(b,"modelMatrix",r.matrixWorld),d}
// Uniforms (refresh uniforms objects)
function refreshUniformsCommon(e,t){
// uv repeat and offset setting priorities
// 1. color map
// 2. specular map
// 3. normal map
// 4. bump map
// 5. alpha map
// 6. emissive map
var n;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,
// don't flip CubeTexture envMaps, flip everything else:
//  WebGLRenderTargetCube will be flipped for backwards compatibility
//  WebGLRenderTargetCube.texture will be flipped because it's a Texture and NOT a CubeTexture
// this check must be handled differently, or removed entirely, if WebGLRenderTargetCube uses a CubeTexture in the future
e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=I.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(
// backwards compatibility
n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function refreshUniformsPhong(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),// to prevent pow( 0.0, 0.0 )
t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function refreshUniformsStandard(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(
//uniforms.envMap.value = material.envMap; // part of uniforms common
e.envMapIntensity.value=t.envMapIntensity)}Ce.setAnimationLoop(function onAnimationFrame(e){Le.isPresenting()||Ae&&Ae(e)}),"undefined"!=typeof window&&Ce.setContext(window),this.setAnimationLoop=function(e){Ae=e,Le.setAnimationLoop(e),Ce.start()},
// Rendering
this.render=function(e,t,n,r){if(t&&t.isCamera){if(!$){
// reset caching for this frame
ae.geometry=null,ae.program=null,ae.wireframe=!1,ie=-1,oe=null,
// update scene graph
!0===e.autoUpdate&&e.updateMatrixWorld(),
// update camera matrices and frustum
null===t.parent&&t.updateMatrixWorld(),Le.enabled&&(t=Le.getCamera(t)),(
//
y=N.get(e,t)).init(),e.onBeforeRender(H,e,t,n),we.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ye.setFromMatrix(we),_e=this.localClippingEnabled,xe=be.init(this.clippingPlanes,_e,t),(v=V.get(e,t)).init(),
/*
    // TODO Duplicated code (Frustum)

    var _sphere = new Sphere();

    function isObjectViewable( object ) {

        var geometry = object.geometry;

        if ( geometry.boundingSphere === null )
            geometry.computeBoundingSphere();

        _sphere.copy( geometry.boundingSphere ).
        applyMatrix4( object.matrixWorld );

        return isSphereViewable( _sphere );

    }

    function isSpriteViewable( sprite ) {

        _sphere.center.set( 0, 0, 0 );
        _sphere.radius = 0.7071067811865476;
        _sphere.applyMatrix4( sprite.matrixWorld );

        return isSphereViewable( _sphere );

    }

    function isSphereViewable( sphere ) {

        if ( ! _frustum.intersectsSphere( sphere ) ) return false;

        var numPlanes = _clipping.numPlanes;

        if ( numPlanes === 0 ) return true;

        var planes = _this.clippingPlanes,

            center = sphere.center,
            negRad = - sphere.radius,
            i = 0;

        do {

            // out when deeper than radius in the negative halfspace
            if ( planes[ i ].distanceToPoint( center ) < negRad ) return false;

        } while ( ++ i !== numPlanes );

        return true;

    }
    */
function projectObject(e,t,n){if(!1===e.visible)return;var r=e.layers.test(t.layers);if(r)if(e.isLight)y.pushLight(e),e.castShadow&&y.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ye.intersectsSprite(e)){n&&Me.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we);var i=G.update(e),a=e.material;v.push(e,i,a,Me.z,null)}}else if(e.isImmediateRenderObject)n&&Me.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we),v.push(e,null,e.material,Me.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||ye.intersectsObject(e))){n&&Me.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we);var i=G.update(e),a=e.material;if(Array.isArray(a))for(var o=i.groups,s=0,l=o.length;s<l;s++){var c=o[s],u=a[c.materialIndex];u&&u.visible&&v.push(e,i,u,Me.z,c)}else a.visible&&v.push(e,i,a,Me.z,null)}var h=e.children;for(var s=0,l=h.length;s<l;s++)projectObject(h[s],t,n)}(e,t,H.sortObjects),!0===H.sortObjects&&v.sort(),
//
xe&&be.beginShadows();var i=y.state.shadowsArray;Te.render(i,e,t),y.setupLights(t),xe&&be.endShadows(),
//
this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n),
//
U.render(v,e,t,r);
// render scene
var a=v.opaque,o=v.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&renderObjects(a,e,t,s),o.length&&renderObjects(o,e,t,s)}else
// opaque pass (front-to-back order)
a.length&&renderObjects(a,e,t),
// transparent pass (back-to-front order)
o.length&&renderObjects(o,e,t);
// Generate mipmap if we're using any kind of mipmap filtering
n&&O.updateRenderTargetMipmap(n),
// Ensure depth buffer writing is enabled so it can be cleared on next render
w.buffers.depth.setTest(!0),w.buffers.depth.setMask(!0),w.buffers.color.setMask(!0),w.setPolygonOffset(!1),e.onAfterRender(H,e,t),Le.enabled&&Le.submitFrame(),
// _gl.finish();
v=null,y=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function allocTextureUnit(){var e=he;return e>=_.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+_.maxTextures),he+=1,e},
// this.setTexture2D = setTexture2D;
this.setTexture2D=function(){var e=!1;
// backwards compatibility: peel texture.texture
return function setTexture2D(t,n){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),O.setTexture2D(t,n)}}(),this.setTexture3D=function setTexture3D(e,t){O.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function setTexture(t,n){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),O.setTexture2D(t,n)}}(),this.setTextureCube=function(){var e=!1;return function setTextureCube(t,n){
// backwards compatibility: peel texture.texture
t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),
// currently relying on the fact that WebGLRenderTargetCube.texture is a Texture and NOT a CubeTexture
// TODO: unify these code paths
t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?
// CompressedTexture can have Array in image :/
// this function alone should take care of cube textures
O.setTextureCube(t,n):
// assumed: texture property of THREE.WebGLRenderTargetCube
O.setTextureCubeDynamic(t,n)}}(),
//
this.setFramebuffer=function(e){ee=e},this.getRenderTarget=function(){return te},this.setRenderTarget=function(e){te=e,e&&void 0===I.get(e).__webglFramebuffer&&O.setupRenderTarget(e);var t=ee,n=!1;if(e){var r=I.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=r[e.activeCubeFace],n=!0):t=r,le.copy(e.viewport),ce.copy(e.scissor),ue=e.scissorTest}else le.copy(me).multiplyScalar(fe),ce.copy(ge).multiplyScalar(fe),ue=ve;if(ne!==t&&(b.bindFramebuffer(b.FRAMEBUFFER,t),ne=t),w.viewport(le),w.scissor(ce),w.setScissorTest(ue),n){var i=I.get(e.texture);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,n,r,i,a){if(e&&e.isWebGLRenderTarget){var o=I.get(e).__webglFramebuffer;if(o){var s=!1;o!==ne&&(b.bindFramebuffer(b.FRAMEBUFFER,o),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Ne&&j.convert(c)!==b.getParameter(b.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===Ee||j.convert(u)===b.getParameter(b.IMPLEMENTATION_COLOR_READ_TYPE)||u===Pe&&(_.isWebGL2||x.get("OES_texture_float")||x.get("WEBGL_color_buffer_float"))||u===Ie&&(_.isWebGL2?x.get("EXT_color_buffer_float"):x.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE?
// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)
t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&b.readPixels(t,n,r,i,j.convert(c),j.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&b.bindFramebuffer(b.FRAMEBUFFER,ne)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var r=t.image.width,i=t.image.height,a=j.convert(t.format);this.setTexture2D(t,0),b.copyTexImage2D(b.TEXTURE_2D,n||0,a,e.x,e.y,r,i,0)},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,a=t.image.height,o=j.convert(n.format),s=j.convert(n.type);this.setTexture2D(n,0),t.isDataTexture?b.texSubImage2D(b.TEXTURE_2D,r||0,e.x,e.y,i,a,o,s,t.image.data):b.texSubImage2D(b.TEXTURE_2D,r||0,e.x,e.y,o,s,t.image)}}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */
function Fog(e,t,n){this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}
/**
 * @author benaadams / https://twitter.com/ben_a_adams
 */
function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}
/**
 * @author benaadams / https://twitter.com/ben_a_adams
 */
function InterleavedBufferAttribute(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}
/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  map: new THREE.Texture( <Image> ),
 *  rotation: <float>,
 *  sizeAttenuation: <bool>
 * }
 */
function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Sprite(e){if(Object3D.call(this),this.type="Sprite",void 0===sn){sn=new BufferGeometry;var t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);sn.setIndex([0,1,2,0,2,3]),sn.addAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),sn.addAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=sn,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}
/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */
function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}
/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author michael guerrero / http://realitymeltdown.com
 * @author ikerr / http://verold.com
 */
function Skeleton(e,t){
// use the supplied bone inverses or calculate the inverses
if(
// copy the bone array
e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Matrix4)}}
/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author ikerr / http://verold.com
 */
function Bone(){Object3D.call(this),this.type="Bone"}
/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author ikerr / http://verold.com
 */
function SkinnedMesh(e,t){Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4;var n=new Skeleton(this.initBones());this.bind(n,this.matrixWorld),this.normalizeSkinWeights()}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *
 *  linewidth: <float>,
 *  linecap: "round",
 *  linejoin: "round"
 * }
 */
function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Line(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial({color:16777215*Math.random()})}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}
/**
 * @author mgreter / http://github.com/mgreter
 */
function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *  map: new THREE.Texture( <Image> ),
 *
 *  size: <float>,
 *  sizeAttenuation: <bool>
 *
 *  morphTargets: <bool>
 * }
 */
function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial({color:16777215*Math.random()})}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function VideoTexture(e,t,n,r,i,a,o,s,l){Texture.call(this,e,t,n,r,i,a,o,s,l),this.generateMipmaps=!1}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function CompressedTexture(e,t,n,r,i,a,o,s,l,c,u,h){Texture.call(this,null,a,o,s,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,
// no flipping for cube textures
// (also flipping doesn't work for compressed textures )
this.flipY=!1,
// can't generate mipmaps for compressed textures
// mips must be embedded in DDS files
this.generateMipmaps=!1}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function CanvasTexture(e,t,n,r,i,a,o,s,l){Texture.call(this,e,t,n,r,i,a,o,s,l),this.needsUpdate=!0}
/**
 * @author Matt DesLauriers / @mattdesl
 * @author atix / arthursilber.de
 */
function DepthTexture(e,t,n,r,i,a,o,s,l,c){if((c=void 0!==c?c:ke)!==ke&&c!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===ke&&(n=Te),void 0===n&&c===je&&(n=Ge),Texture.call(this,null,r,i,a,o,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:ye,this.minFilter=void 0!==s?s:ye,this.flipY=!1,this.generateMipmaps=!1}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
function WireframeGeometry(e){BufferGeometry.call(this),this.type="WireframeGeometry";
// buffer
var t,n,r,i,a,o,s,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];
// helper variables
// different logic for Geometry and BufferGeometry
if(e&&e.isGeometry){
// create a data structure that contains all edges without duplicates
var m=e.faces;for(t=0,r=m.length;t<r;t++){var g=m[t];for(n=0;n<3;n++)s=g[f[n]],l=g[f[(n+1)%3]],d[0]=Math.min(s,l),// sorting prevents duplicates
d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}
// generate vertices
for(c in p)o=p[c],u=e.vertices[o.index1],h.push(u.x,u.y,u.z),u=e.vertices[o.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var v,y,b,x,_,w,M;if(u=new Vector3,null!==e.index){
// create a data structure that contains all eges without duplicates
for(
// indexed BufferGeometry
v=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),i=0,a=b.length;i<a;++i)for(t=_=(x=b[i]).start,r=_+x.count;t<r;t+=3)for(n=0;n<3;n++)s=y.getX(t+n),l=y.getX(t+(n+1)%3),d[0]=Math.min(s,l),// sorting prevents duplicates
d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});
// generate vertices
for(c in p)o=p[c],u.fromBufferAttribute(v,o.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(v,o.index2),h.push(u.x,u.y,u.z)}else for(
// non-indexed BufferGeometry
t=0,r=(v=e.attributes.position).count/3;t<r;t++)for(n=0;n<3;n++)
// three edges per triangle, an edge is represented as (index1, index2)
// e.g. the first triangle has the following edges: (0,1),(1,2),(2,0)
w=3*t+n,u.fromBufferAttribute(v,w),h.push(u.x,u.y,u.z),M=3*t+(n+1)%3,u.fromBufferAttribute(v,M),h.push(u.x,u.y,u.z)}
// build geometry
this.addAttribute("position",new Float32BufferAttribute(h,3))}
/**
 * @author zz85 / https://github.com/zz85
 * @author Mugen87 / https://github.com/Mugen87
 *
 * Parametric Surfaces Geometry
 * based on the brilliant article by @prideout http://prideout.net/blog/?p=44
 */
// ParametricGeometry
function ParametricGeometry(e,t,n){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,n)),this.mergeVertices()}
// ParametricBufferGeometry
function ParametricBufferGeometry(e,t,n){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};
// buffers
var r,i,a=[],o=[],s=[],l=[],c=new Vector3,u=new Vector3,h=new Vector3,d=new Vector3,p=new Vector3;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");
// generate vertices, normals and uvs
var f=t+1;for(r=0;r<=n;r++){var m=r/n;for(i=0;i<=t;i++){var g=i/t;
// vertex
e(g,m,u),o.push(u.x,u.y,u.z),
// normal
// approximate tangent vectors via finite differences
g-1e-5>=0?(e(g-1e-5,m,h),d.subVectors(u,h)):(e(g+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(e(g,m-1e-5,h),p.subVectors(u,h)):(e(g,m+1e-5,h),p.subVectors(h,u)),
// cross product of tangent vectors returns surface normal
c.crossVectors(d,p).normalize(),s.push(c.x,c.y,c.z),
// uv
l.push(g,m)}}
// generate indices
for(r=0;r<n;r++)for(i=0;i<t;i++){var v=r*f+i,y=r*f+i+1,b=(r+1)*f+i+1,x=(r+1)*f+i;
// faces one and two
a.push(v,y,x),a.push(y,b,x)}
// build geometry
this.setIndex(a),this.addAttribute("position",new Float32BufferAttribute(o,3)),this.addAttribute("normal",new Float32BufferAttribute(s,3)),this.addAttribute("uv",new Float32BufferAttribute(l,2))}
/**
 * @author clockworkgeek / https://github.com/clockworkgeek
 * @author timothypratley / https://github.com/timothypratley
 * @author WestLangley / http://github.com/WestLangley
 * @author Mugen87 / https://github.com/Mugen87
 */
// PolyhedronGeometry
function PolyhedronGeometry(e,t,n,r){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,n,r)),this.mergeVertices()}
// PolyhedronBufferGeometry
function PolyhedronBufferGeometry(e,t,n,r){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;
// default buffer data
var i=[],a=[];function subdivideFace(e,t,n,r){var i,a,o=Math.pow(2,r),s=[];
// we use this multidimensional array as a data structure for creating the subdivision
// construct all of the vertices for this subdivision
for(i=0;i<=o;i++){s[i]=[];var l=e.clone().lerp(n,i/o),c=t.clone().lerp(n,i/o),u=o-i;for(a=0;a<=u;a++)s[i][a]=0===a&&i===o?l:l.clone().lerp(c,a/u)}
// construct all of the faces
for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var h=Math.floor(a/2);a%2==0?(pushVertex(s[i][h+1]),pushVertex(s[i+1][h]),pushVertex(s[i][h])):(pushVertex(s[i][h+1]),pushVertex(s[i+1][h+1]),pushVertex(s[i+1][h]))}}function pushVertex(e){i.push(e.x,e.y,e.z)}function getVertexByIndex(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function correctUV(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}
// Angle around the Y axis, counter-clockwise when looking from above.
function azimuth(e){return Math.atan2(e.z,-e.x)}
// Angle above the XZ plane.
function inclination(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}
// the subdivision creates the vertex buffer data
!
// helper functions
function subdivide(e){
// iterate over all faces and apply a subdivison with the given detail value
for(var n=new Vector3,r=new Vector3,i=new Vector3,a=0;a<t.length;a+=3)
// get the vertices of the face
getVertexByIndex(t[a+0],n),getVertexByIndex(t[a+1],r),getVertexByIndex(t[a+2],i),
// perform subdivision
subdivideFace(n,r,i,e)}(r=r||0),
// all vertices should lie on a conceptual sphere with a given radius
function appplyRadius(e){
// iterate over the entire buffer and apply the radius to each vertex
for(var t=new Vector3,n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),
// finally, create the uv data
function generateUVs(){for(var e=new Vector3,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var n=azimuth(e)/2/Math.PI+.5,r=inclination(e)/Math.PI+.5;a.push(n,1-r)}(function correctUVs(){for(var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3,o=new Vector2,s=new Vector2,l=new Vector2,c=0,u=0;c<i.length;c+=9,u+=6){e.set(i[c+0],i[c+1],i[c+2]),t.set(i[c+3],i[c+4],i[c+5]),n.set(i[c+6],i[c+7],i[c+8]),o.set(a[u+0],a[u+1]),s.set(a[u+2],a[u+3]),l.set(a[u+4],a[u+5]),r.copy(e).add(t).add(n).divideScalar(3);var h=azimuth(r);correctUV(o,u+0,e,h),correctUV(s,u+2,t,h),correctUV(l,u+4,n,h)}})(),function correctSeam(){
// handle case when face straddles the seam, see #3269
for(var e=0;e<a.length;e+=6){
// uv data of a single face
var t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),o=Math.min(t,n,r);
// 0.9 is somewhat arbitrary
i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),
// build non-indexed geometry
this.addAttribute("position",new Float32BufferAttribute(i,3)),this.addAttribute("normal",new Float32BufferAttribute(i.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}
/**
 * @author timothypratley / https://github.com/timothypratley
 * @author Mugen87 / https://github.com/Mugen87
 */
// TetrahedronGeometry
function TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}
// TetrahedronBufferGeometry
function TetrahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}
/**
 * @author timothypratley / https://github.com/timothypratley
 * @author Mugen87 / https://github.com/Mugen87
 */
// OctahedronGeometry
function OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}
// OctahedronBufferGeometry
function OctahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}
/**
 * @author timothypratley / https://github.com/timothypratley
 * @author Mugen87 / https://github.com/Mugen87
 */
// IcosahedronGeometry
function IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}
// IcosahedronBufferGeometry
function IcosahedronBufferGeometry(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];PolyhedronBufferGeometry.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}
/**
 * @author Abe Pazos / https://hamoid.com
 * @author Mugen87 / https://github.com/Mugen87
 */
// DodecahedronGeometry
function DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}
// DodecahedronBufferGeometry
function DodecahedronBufferGeometry(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[
// (Â±1, Â±1, Â±1)
-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,
// (0, Â±1/Ï, Â±Ï)
0,-r,-n,0,-r,n,0,r,-n,0,r,n,
// (Â±1/Ï, Â±Ï, 0)
-r,-n,0,-r,n,0,r,-n,0,r,n,0,
// (Â±Ï, 0, Â±1/Ï)
-n,0,-r,n,0,-r,-n,0,r,n,0,r];PolyhedronBufferGeometry.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}
/**
 * @author oosmoxiecode / https://github.com/oosmoxiecode
 * @author WestLangley / https://github.com/WestLangley
 * @author zz85 / https://github.com/zz85
 * @author miningold / https://github.com/miningold
 * @author jonobr1 / https://github.com/jonobr1
 * @author Mugen87 / https://github.com/Mugen87
 *
 */
// TubeGeometry
function TubeGeometry(e,t,n,r,i,a){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new TubeBufferGeometry(e,t,n,r,i);
// expose internals
this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,
// create geometry
this.fromBufferGeometry(o),this.mergeVertices()}
// TubeBufferGeometry
function TubeBufferGeometry(e,t,n,r,i){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var a=e.computeFrenetFrames(t,i);
// expose internals
this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;
// helper variables
var o,s,l=new Vector3,c=new Vector3,u=new Vector2,h=new Vector3,d=[],p=[],f=[],m=[];function generateSegment(i){
// we use getPointAt to sample evenly distributed points from the given path
h=e.getPointAt(i/t,h);
// retrieve corresponding normal and binormal
var o=a.normals[i],u=a.binormals[i];
// generate normals and vertices for the current segment
for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);
// normal
c.x=g*o.x+m*u.x,c.y=g*o.y+m*u.y,c.z=g*o.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),
// vertex
l.x=h.x+n*c.x,l.y=h.y+n*c.y,l.z=h.z+n*c.z,d.push(l.x,l.y,l.z)}}
// create buffer data
!
// functions
function generateBufferData(){for(o=0;o<t;o++)generateSegment(o);
// if the geometry is not closed, generate the last row of vertices and normals
// at the regular position on the given path
//
// if the geometry is closed, duplicate the first row of vertices and normals (uvs will differ)
generateSegment(!1===i?t:0),
// uvs are generated in a separate function.
// this makes it easy compute correct values for closed geometries
function generateUVs(){for(o=0;o<=t;o++)for(s=0;s<=r;s++)u.x=o/t,u.y=s/r,f.push(u.x,u.y)}(),
// finally create faces
function generateIndices(){for(s=1;s<=t;s++)for(o=1;o<=r;o++){var e=(r+1)*(s-1)+(o-1),n=(r+1)*s+(o-1),i=(r+1)*s+o,a=(r+1)*(s-1)+o;
// faces
m.push(e,n,a),m.push(n,i,a)}}()}(),
// build geometry
this.setIndex(m),this.addAttribute("position",new Float32BufferAttribute(d,3)),this.addAttribute("normal",new Float32BufferAttribute(p,3)),this.addAttribute("uv",new Float32BufferAttribute(f,2))}
/**
 * @author oosmoxiecode
 * @author Mugen87 / https://github.com/Mugen87
 *
 * based on http://www.blackpawn.com/texts/pqtorus/
 */
// TorusKnotGeometry
function TorusKnotGeometry(e,t,n,r,i,a,o){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,n,r,i,a)),this.mergeVertices()}
// TorusKnotBufferGeometry
function TorusKnotBufferGeometry(e,t,n,r,i,a){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,a=a||3;
// buffers
var o,s,l=[],c=[],u=[],h=[],d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3,g=new Vector3,v=new Vector3,y=new Vector3;
// generate vertices, normals and uvs
for(o=0;o<=n;++o){
// the radian "u" is used to calculate the position on the torus curve of the current tubular segement
var b=o/n*i*Math.PI*2;
// now we calculate two points. P1 is our current position on the curve, P2 is a little farther ahead.
// these points are used to create a special "coordinate space", which is necessary to calculate the correct vertex positions
for(calculatePositionOnCurve(b,i,a,e,f),calculatePositionOnCurve(b+.01,i,a,e,m),
// calculate orthonormal basis
v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),
// normalize B, N. T can be ignored, we don't use it
g.normalize(),y.normalize(),s=0;s<=r;++s){
// now calculate the vertices. they are nothing more than an extrusion of the torus curve.
// because we extrude a shape in the xy-plane, there is no need to calculate a z-value.
var x=s/r*Math.PI*2,_=-t*Math.cos(x),w=t*Math.sin(x);
// now calculate the final vertex position.
// first we orient the extrusion with our basis vectos, then we add it to the current position on the curve
d.x=f.x+(_*y.x+w*g.x),d.y=f.y+(_*y.y+w*g.y),d.z=f.z+(_*y.z+w*g.z),c.push(d.x,d.y,d.z),
// normal (P1 is always the center/origin of the extrusion, thus we can use it to calculate the normal)
p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),
// uv
h.push(o/n),h.push(s/r)}}
// generate indices
for(s=1;s<=n;s++)for(o=1;o<=r;o++){
// indices
var M=(r+1)*(s-1)+(o-1),E=(r+1)*s+(o-1),S=(r+1)*s+o,L=(r+1)*(s-1)+o;
// faces
l.push(M,E,L),l.push(E,S,L)}
// build geometry
// this function calculates the current position on the torus curve
function calculatePositionOnCurve(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(h,2))}
/**
 * @author oosmoxiecode
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
// TorusGeometry
function TorusGeometry(e,t,n,r,i){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new TorusBufferGeometry(e,t,n,r,i)),this.mergeVertices()}
// TorusBufferGeometry
function TorusBufferGeometry(e,t,n,r,i){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;
// buffers
var a,o,s=[],l=[],c=[],u=[],h=new Vector3,d=new Vector3,p=new Vector3;
// generate vertices, normals and uvs
for(a=0;a<=n;a++)for(o=0;o<=r;o++){var f=o/r*i,m=a/n*Math.PI*2;
// vertex
d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),
// normal
h.x=e*Math.cos(f),h.y=e*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),
// uv
u.push(o/r),u.push(a/n)}
// generate indices
for(a=1;a<=n;a++)for(o=1;o<=r;o++){
// indices
var g=(r+1)*a+o-1,v=(r+1)*(a-1)+o-1,y=(r+1)*(a-1)+o,b=(r+1)*a+o;
// faces
s.push(g,v,b),s.push(v,y,b)}
// build geometry
this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2))}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},
/**
     * Sets the FOV by focal length in respect to the current .filmGauge.
     *
     * The default film gauge is 35, so that the focal length can be specified for
     * a 35mm (full frame) camera.
     *
     * Values for focal length and film gauge must have the same unit.
     */
setFocalLength:function(e){
// see http://www.bobatkins.com/photography/technical/field_of_view.html
var t=.5*this.getFilmHeight()/e;this.fov=2*Nt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},
/**
     * Calculates the focal length from the current .fov and .filmGauge.
     */
getFocalLength:function(){var e=Math.tan(.5*Nt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Nt.RAD2DEG*Math.atan(Math.tan(.5*Nt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){
// film not completely covered in portrait format (aspect < 1)
return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){
// film not completely covered in landscape format (aspect > 1)
return this.filmGauge/Math.max(this.aspect,1)},
/**
     * Sets an offset in a larger frustum. This is useful for multi-window or
     * multi-monitor/multi-machine setups.
     *
     * For example, if you have 3x2 monitors and each monitor is 1920x1080 and
     * the monitors are in grid like this
     *
     *   +---+---+---+
     *   | A | B | C |
     *   +---+---+---+
     *   | D | E | F |
     *   +---+---+---+
     *
     * then for each monitor you would call it like this
     *
     *   var w = 1920;
     *   var h = 1080;
     *   var fullWidth = w * 3;
     *   var fullHeight = h * 2;
     *
     *   --A--
     *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );
     *   --B--
     *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );
     *   --C--
     *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );
     *   --D--
     *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );
     *   --E--
     *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );
     *   --F--
     *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );
     *
     *   Note there is no reason monitors have to be the same size or in a grid.
     */
setViewOffset:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Nt.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),FogExp2.prototype.isFogExp2=!0,FogExp2.prototype.clone=function(){return new FogExp2(this.color,this.density)},FogExp2.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Fog.prototype.isFog=!0,Fog.prototype.clone=function(){return new Fog(this.color,this.near,this.far)},Fog.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(){var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector2,i=new Vector2,a=new Matrix4,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector2,u=new Vector2,h=new Vector2;function transformVertex(e,t,n,o,s,l){
// compute position in camera space
r.subVectors(e,n).addScalar(.5).multiply(o),
// to check if rotation is not zero
void 0!==s?(i.x=l*r.x-s*r.y,i.y=s*r.x+l*r.y):i.copy(r),e.copy(t),e.x+=i.x,e.y+=i.y,
// transform to world space
e.applyMatrix4(a)}return function raycast(r,i){t.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),n.setFromMatrixPosition(this.modelViewMatrix);var d,p,f=this.material.rotation;0!==f&&(p=Math.cos(f),d=Math.sin(f));var m=this.center;transformVertex(o.set(-.5,-.5,0),n,m,t,d,p),transformVertex(s.set(.5,-.5,0),n,m,t,d,p),transformVertex(l.set(.5,.5,0),n,m,t,d,p),c.set(0,0),u.set(1,0),h.set(1,1);
// check first triangle
var g=r.ray.intersectTriangle(o,s,l,!1,e);if(null!==g||(
// check second triangle
transformVertex(s.set(-.5,.5,0),n,m,t,d,p),u.set(0,1),null!==(g=r.ray.intersectTriangle(o,l,s,!1,e)))){var v=r.ray.origin.distanceTo(e);v<r.near||v>r.far||i.push({distance:v,point:e.clone(),uv:Triangle.getUV(e,o,s,l,c,u,h,new Vector2),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Object3D.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);n.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object},raycast:function(){var e=new Vector3;return function raycast(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,n)}}(),update:function(){var e=new Vector3,t=new Vector3;return function update(n){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);r[0].object.visible=!0;for(var a=1,o=r.length;a<o&&i>=r[a].distance;a++)r[a-1].object.visible=!1,r[a].object.visible=!0;for(;a<o;a++)r[a].object.visible=!1}}}(),toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var a=n[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;
// recover the bind-time world matrices
for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);
// compute the local matrices, positions, rotations and scales
for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new Matrix4,t=new Matrix4;return function update(){
// flatten bone matrices to array
for(var n=this.bones,r=this.boneInverses,i=this.boneMatrices,a=this.boneTexture,o=0,s=n.length;o<s;o++){
// compute the offset between the current and the original transform
var l=n[o]?n[o].matrixWorld:t;e.multiplyMatrices(l,r[o]),e.toArray(i,16*o)}void 0!==a&&(a.needsUpdate=!0)}}(),clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,initBones:function(){var e,t,n,r,i=[];if(this.geometry&&void 0!==this.geometry.bones){
// first, create array of 'Bone' objects from geometry data
for(n=0,r=this.geometry.bones.length;n<r;n++)t=this.geometry.bones[n],
// create new 'Bone' object
e=new Bone,i.push(e),
// apply values
e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);
// second, create bone hierarchy
for(n=0,r=this.geometry.bones.length;n<r;n++)-1!==(t=this.geometry.bones[n]).parent&&null!==t.parent&&void 0!==i[t.parent]?
// subsequent bones in the hierarchy
i[t.parent].add(i[n]):
// topmost bone, immediate child of the skinned mesh
this.add(i[n])}
// now the bones are part of the scene graph and children of the skinned mesh.
// let's update the corresponding matrices
return this.updateMatrixWorld(!0),i},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var n=this.geometry.skinWeights[t];(e=1/n.manhattanLength())!==1/0?n.multiplyScalar(e):n.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new Vector4,i=this.geometry.attributes.skinWeight;for(t=0;t<i.count;t++)r.x=i.getX(t),r.y=i.getY(t),r.z=i.getZ(t),r.w=i.getW(t),(e=1/r.manhattanLength())!==1/0?r.multiplyScalar(e):r.set(1,0,0,0),i.setXYZW(t,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function computeLineDistances(){var n=this.geometry;if(n.isBufferGeometry)
// we assume non-indexed geometry
if(null===n.index){for(var r=n.attributes.position,i=[0],a=1,o=r.count;a<o;a++)e.fromBufferAttribute(r,a-1),t.fromBufferAttribute(r,a),i[a]=i[a-1],i[a]+=e.distanceTo(t);n.addAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;(i=n.lineDistances)[0]=0;for(a=1,o=s.length;a<o;a++)i[a]=i[a-1],i[a]+=s[a-1].distanceTo(s[a])}return this}}(),raycast:function(){var e=new Matrix4,t=new Ray,n=new Sphere;return function raycast(r,i){var a=r.linePrecision,o=this.geometry,s=this.matrixWorld;if(
// Checking boundingSphere distance to ray
null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(s),n.radius+=a,!1!==r.ray.intersectsSphere(n)){
//
e.getInverse(s),t.copy(r.ray).applyMatrix4(e);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=new Vector3,h=new Vector3,d=new Vector3,p=new Vector3,f=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,g=o.attributes.position.array;if(null!==m)for(var v=m.array,y=0,b=v.length-1;y<b;y+=f){var x=v[y],_=v[y+1];if(u.fromArray(g,3*x),h.fromArray(g,3*_),!(t.distanceSqToSegment(u,h,p,d)>c))p.applyMatrix4(this.matrixWorld),(E=r.ray.origin.distanceTo(p))<r.near||E>r.far||i.push({distance:E,
// What do we want? intersection point on the ray or on the segment??
// point: raycaster.ray.at( distance ),
point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(y=0,b=g.length/3-1;y<b;y+=f){if(u.fromArray(g,3*y),h.fromArray(g,3*y+3),!(t.distanceSqToSegment(u,h,p,d)>c))p.applyMatrix4(this.matrixWorld),(E=r.ray.origin.distanceTo(p))<r.near||E>r.far||i.push({distance:E,
// What do we want? intersection point on the ray or on the segment??
// point: raycaster.ray.at( distance ),
point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(o.isGeometry){var w=o.vertices,M=w.length;for(y=0;y<M-1;y+=f){var E;if(!(t.distanceSqToSegment(w[y],w[y+1],p,d)>c))p.applyMatrix4(this.matrixWorld),(E=r.ray.origin.distanceTo(p))<r.near||E>r.far||i.push({distance:E,
// What do we want? intersection point on the ray or on the segment??
// point: raycaster.ray.at( distance ),
point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function computeLineDistances(){var n=this.geometry;if(n.isBufferGeometry)
// we assume non-indexed geometry
if(null===n.index){for(var r=n.attributes.position,i=[],a=0,o=r.count;a<o;a+=2)e.fromBufferAttribute(r,a),t.fromBufferAttribute(r,a+1),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t);n.addAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;for(i=n.lineDistances,a=0,o=s.length;a<o;a+=2)e.copy(s[a]),t.copy(s[a+1]),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t)}return this}}()}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var e=new Matrix4,t=new Ray,n=new Sphere;return function raycast(r,i){var a=this,o=this.geometry,s=this.matrixWorld,l=r.params.Points.threshold;if(
// Checking boundingSphere distance to ray
null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(s),n.radius+=l,!1!==r.ray.intersectsSphere(n)){
//
e.getInverse(s),t.copy(r.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Vector3,d=new Vector3;if(o.isBufferGeometry){var p=o.index,f=o.attributes.position.array;if(null!==p)for(var m=p.array,g=0,v=m.length;g<v;g++){var y=m[g];h.fromArray(f,3*y),testPoint(h,y)}else{g=0;for(var b=f.length/3;g<b;g++)h.fromArray(f,3*g),testPoint(h,g)}}else{var x=o.vertices;for(g=0,b=x.length;g<b;g++)testPoint(x[g],g)}}function testPoint(e,n){var o=t.distanceSqToPoint(e);if(o<u){t.closestPointToPoint(e,d),d.applyMatrix4(s);var l=r.ray.origin.distanceTo(d);if(l<r.near||l>r.far)return;i.push({distance:l,distanceToRay:Math.sqrt(o),point:d.clone(),index:n,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0,WireframeGeometry.prototype=Object.create(BufferGeometry.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,TetrahedronGeometry.prototype=Object.create(Geometry.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,IcosahedronGeometry.prototype=Object.create(Geometry.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,TubeGeometry.prototype=Object.create(Geometry.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TorusKnotGeometry.prototype=Object.create(Geometry.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TorusGeometry.prototype=Object.create(Geometry.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;
/**
 * @author Mugen87 / https://github.com/Mugen87
 * Port from https://github.com/mapbox/earcut (v2.1.2)
 */
var cn=function(e,t,n){n=n||2;var r,i,a,o,s,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=linkedList(e,0,h,n,!0),p=[];if(!d)return p;
// if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox
if(u&&(d=
// link every hole into the outer loop, producing a single-ring polygon without holes
function eliminateHoles(e,t,n,r){var i,a,o,s,l,c=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(l=linkedList(e,o,s,r,!1))===l.next&&(l.steiner=!0),c.push(getLeftmost(l));
// process holes from left to right
for(c.sort(compareX),i=0;i<c.length;i++)eliminateHole(c[i],n),n=filterPoints(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var f=n;f<h;f+=n)s=e[f],l=e[f+1],s<r&&(r=s),l<i&&(i=l),s>a&&(a=s),l>o&&(o=l);
// minX, minY and invSize are later used to transform coords into integers for z-order calculation
c=0!==(c=Math.max(a-r,o-i))?1/c:0}return earcutLinked(d,p,n,r,i,c),p};
// create a circular doubly linked list from polygon points in the specified winding order
function linkedList(e,t,n,r,i){var a,o;if(i===function signedArea(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 */(e,t,n,r)>0)for(a=t;a<n;a+=r)o=insertNode(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=insertNode(a,e[a],e[a+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}
// eliminate colinear or duplicate points
function filterPoints(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}
// main ear slicing loop which triangulates a polygon (given as a linked list)
function earcutLinked(e,t,n,r,i,a,o){if(e){
// interlink polygon nodes in z-order
!o&&a&&
// interlink polygon nodes in z-order
function indexCurve(e,t,n,r){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,
// Simon Tatham's linked list merge sort algorithm
// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html
function sortLinked(e){var t,n,r,i,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,c*=2}while(o>1);return e}
// z-order of a point given coords and inverse of the longer side of data bbox
(i)}(e,r,i,a);
// iterate through ears, slicing them one by one
for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?isEarHashed(e,r,i,a):isEar(e))
// cut off the triangle
t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),removeNode(e),
// skipping the next vertice leads to less sliver triangles
e=l.next,c=l.next;else
// if we looped through the whole remaining polygon and can't find any more ears
if((e=l)===c){
// try filtering points and slicing again
o?1===o?earcutLinked(e=cureLocalIntersections(e,t,n),t,n,r,i,a,2):2===o&&splitEarcut(e,t,n,r,i,a):earcutLinked(filterPoints(e),t,n,r,i,a,1);break}}}
// check whether a polygon node forms a valid ear with adjacent nodes
function isEar(e){var t=e.prev,n=e,r=e.next;if(area(t,n,r)>=0)return!1;// reflex, can't be an ear
// now make sure we don't have other points inside the potential ear
for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,t,n,r){var i=e.prev,a=e,o=e.next;if(area(i,a,o)>=0)return!1;// reflex, can't be an ear
// triangle bbox; min & max are calculated like this for speed
for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=zOrder(s,l,t,n,r),d=zOrder(c,u,t,n,r),p=e.nextZ
// z-order range for the current triangle bbox;
;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}
// then look for points in decreasing z-order
for(p=e.prevZ;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}
// go through all polygon nodes and cure small local self-intersections
function cureLocalIntersections(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!equals(i,a)&&intersects(i,r,r.next,a)&&locallyInside(i,a)&&locallyInside(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),
// remove two nodes involved
removeNode(r),removeNode(r.next),r=e=a),r=r.next}while(r!==e);return r}
// try splitting polygon into two and triangulate them independently
function splitEarcut(e,t,n,r,i,a){
// look for a valid diagonal that divides the polygon into two
var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){
// split the polygon in two by the diagonal
var l=splitPolygon(o,s);
// filter colinear points around the cuts
return o=filterPoints(o,o.next),l=filterPoints(l,l.next),
// run earcut on each half
earcutLinked(o,t,n,r,i,a),void earcutLinked(l,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function compareX(e,t){return e.x-t.x}
// find a bridge between vertices that connects hole with an outer ring and and link it
function eliminateHole(e,t){if(t=
// David Eberly's algorithm for finding a bridge between hole and outer polygon
function findHoleBridge(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;
// find a segment intersected by a ray from the hole's leftmost point to the left;
// segment's endpoint with lesser x will be potential connection point
do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n.prev;// hole touches outer segment; pick lower endpoint
// look for points inside the triangle of hole point, segment intersection and endpoint;
// if there are no points found, we have a valid connection;
// otherwise choose the point of the minimum angle with the ray as connection point
var l,c=n,u=n.x,h=n.y,d=1/0;r=n.next;for(;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&pointInTriangle(a<h?i:o,a,u,h,a<h?o:i,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&locallyInside(r,e)&&(n=r,d=l),r=r.next;return n}(e,t)){var n=splitPolygon(t,e);filterPoints(n,n.next)}}function zOrder(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((
// coords are transformed into non-negative 15-bit integer range
e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}
// find the leftmost node of a polygon ring
function getLeftmost(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}
// check if a point lies within a convex triangle
function pointInTriangle(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}
// check if a diagonal between two polygon nodes is valid (lies in polygon interior)
function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!
// check if a polygon diagonal intersects any polygon segments
function intersectsPolygon(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&intersects(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}
// check if a polygon diagonal is locally inside the polygon
(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&
// check if the middle point of a polygon diagonal is inside the polygon
function middleInside(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}
// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;
// if one belongs to the outer ring and another to a hole, it merges it into a single ring
(e,t)}
// signed area of a triangle
function area(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}
// check if two points are equal
function equals(e,t){return e.x===t.x&&e.y===t.y}
// check if two segments intersect
function intersects(e,t,n,r){return!!(equals(e,t)&&equals(n,r)||equals(e,r)&&equals(n,t))||area(e,t,n)>0!=area(e,t,r)>0&&area(n,r,e)>0!=area(n,r,t)>0}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function splitPolygon(e,t){var n=new Node(e.i,e.x,e.y),r=new Node(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}
// create a node and optionally link it with previous one (in a circular doubly linked list)
function insertNode(e,t,n,r){var i=new Node(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,n){
// vertice index in coordinates array
this.i=e,
// vertex coordinates
this.x=t,this.y=n,
// previous and next vertice nodes in a polygon ring
this.prev=null,this.next=null,
// z-order curve value
this.z=null,
// previous and next nodes in z-order
this.prevZ=null,this.nextZ=null,
// indicates whether this is a steiner point
this.steiner=!1}var un={
// calculate area of the contour polygon
area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return un.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];// flat array of vertices like [ x0,y0, x1,y1, x2,y2, ... ]
// final array of vertex indices like [ [ a,b,d ], [ b,c,d ] ]
removeDupEndPts(e),addContour(n,e);
//
var a=e.length;t.forEach(removeDupEndPts);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,addContour(n,t[o]);
//
var s=cn(n,r);
//
for(o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Creates extruded geometry from a path shape.
 *
 * parameters = {
 *
 *  curveSegments: <int>, // number of points on the curves
 *  steps: <int>, // number of points for z-side extrusions / used for subdividing segments of extrude spline too
 *  depth: <float>, // Depth to extrude the shape
 *
 *  bevelEnabled: <bool>, // turn on bevel
 *  bevelThickness: <float>, // how deep into the original shape bevel goes
 *  bevelSize: <float>, // how far from shape outline is bevel
 *  bevelSegments: <int>, // number of bevel layers
 *
 *  extrudePath: <THREE.Curve> // curve to extrude shape along
 *
 *  UVGenerator: <Object> // object that provides UV generator functions
 *
 * }
 */
// ExtrudeGeometry
function ExtrudeGeometry(e,t){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}
// ExtrudeBufferGeometry
function ExtrudeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var n=this,r=[],i=[],a=0,o=(e=Array.isArray(e)?e:[e]).length;a<o;a++){addShape(e[a])}
// build geometry
// functions
function addShape(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:hn;
// options
// deprecated options
void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);
//
var m,g,y,b,x,_,w,M,E=!1;p&&(m=p.getSpacedPoints(s),E=!0,c=!1,// bevels not supported for path extrusion
// SETUP TNB variables
// TODO1 - have a .isClosed in spline?
g=p.computeFrenetFrames(s,!1),
// console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);
y=new Vector3,b=new Vector3,x=new Vector3),
// Safeguards if bevels are not enabled
c||(d=0,u=0,h=0);// looping of holes
var S=e.extractPoints(o),L=S.shape,T=S.holes;if(!un.isClockWise(L))
// Maybe we should also check if holes are in the opposite direction, just to be safe ...
for(L=L.reverse(),w=0,M=T.length;w<M;w++)_=T[w],un.isClockWise(_)&&(T[w]=_.reverse());var A=un.triangulateShape(L,T),C=L;
/* Vertices */ // vertices has all points but contour has only points of circumference
for(w=0,M=T.length;w<M;w++)_=T[w],L=L.concat(_);function scalePt2(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var P,I,O,B,R,G,D=L.length,V=A.length;
// Find directions for point movement
function getBevelVec(e,t,n){
// computes for inPt the corresponding point inPt' on a new contour
//   shifted by 1 unit (length of normalized vector) to the left
// if we walk along contour clockwise, this new contour is outside the old one
//
// inPt' is the intersection of the two lines parallel to the two
//  adjacent edges of inPt at a distance of 1 unit on the left side.
var r,i,a,o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s,h=o*c-s*l;// resulting translation vector for inPt
// good reading for geometry algorithms (here: line-line intersection)
// http://geomalgorithms.com/a05-_intersect-1.html
if(Math.abs(h)>Number.EPSILON){
// not collinear
// length of vectors for normalizing
var d=Math.sqrt(u),p=Math.sqrt(l*l+c*c),f=t.x-s/d,m=t.y+o/d,g=((n.x-c/p-f)*c-(n.y+l/p-m)*l)/(o*c-s*l),v=(
// vector from inPt to intersection point
r=f+o*g-e.x)*r+(i=m+s*g-e.y)*i;if(v<=2)return new Vector2(r,i);a=Math.sqrt(v/2)}else{
// handle special case of collinear edges
var y=!1;// assumes: opposite
o>Number.EPSILON?l>Number.EPSILON&&(y=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(
// console.log("Warning: lines are a straight sequence");
r=-s,i=o,a=Math.sqrt(u)):(
// console.log("Warning: lines are a straight spike");
r=o,i=s,a=Math.sqrt(u/2))}return new Vector2(r/a,i/a)}for(var N=[],U=0,F=C.length,z=F-1,k=U+1;U<F;U++,z++,k++)z===F&&(z=0),k===F&&(k=0),
//  (j)---(i)---(k)
// console.log('i,j,k', i, j , k)
N[U]=getBevelVec(C[U],C[z],C[k]);var j,H,W=[],X=N.concat();for(w=0,M=T.length;w<M;w++){for(_=T[w],j=[],U=0,z=(F=_.length)-1,k=U+1;U<F;U++,z++,k++)z===F&&(z=0),k===F&&(k=0),
//  (j)---(i)---(k)
j[U]=getBevelVec(_[U],_[z],_[k]);W.push(j),X=X.concat(j)}
// Loop bevelSegments, 1 for the front, 1 for the back
for(P=0;P<d;P++){
// contract shape
for(
//for ( b = bevelSegments; b > 0; b -- ) {
O=P/d,B=u*Math.cos(O*Math.PI/2),I=h*Math.sin(O*Math.PI/2),U=0,F=C.length;U<F;U++)v((R=scalePt2(C[U],N[U],I)).x,R.y,-B);
// expand holes
for(w=0,M=T.length;w<M;w++)for(_=T[w],j=W[w],U=0,F=_.length;U<F;U++)v((R=scalePt2(_[U],j[U],I)).x,R.y,-B)}
// Back facing vertices
for(I=h,U=0;U<D;U++)R=c?scalePt2(L[U],X[U],I):L[U],E?(
// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );
b.copy(g.normals[0]).multiplyScalar(R.x),y.copy(g.binormals[0]).multiplyScalar(R.y),x.copy(m[0]).add(b).add(y),v(x.x,x.y,x.z)):v(R.x,R.y,0);
// Add stepped vertices...
// Including front facing vertices
for(H=1;H<=s;H++)for(U=0;U<D;U++)R=c?scalePt2(L[U],X[U],I):L[U],E?(
// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );
b.copy(g.normals[H]).multiplyScalar(R.x),y.copy(g.binormals[H]).multiplyScalar(R.y),x.copy(m[H]).add(b).add(y),v(x.x,x.y,x.z)):v(R.x,R.y,l/s*H);
// Add bevel segments planes
//for ( b = 1; b <= bevelSegments; b ++ ) {
for(P=d-1;P>=0;P--){
// contract shape
for(O=P/d,B=u*Math.cos(O*Math.PI/2),I=h*Math.sin(O*Math.PI/2),U=0,F=C.length;U<F;U++)v((R=scalePt2(C[U],N[U],I)).x,R.y,l+B);
// expand holes
for(w=0,M=T.length;w<M;w++)for(_=T[w],j=W[w],U=0,F=_.length;U<F;U++)R=scalePt2(_[U],j[U],I),E?v(R.x,R.y+m[s-1].y,m[s-1].x+B):v(R.x,R.y,l+B)}
/* Faces */
// Top and bottom faces
function sidewalls(e,t){var n,r;for(U=e.length;--U>=0;){n=U,(r=U-1)<0&&(r=e.length-1);
//console.log('b', i,j, i-1, k,vertices.length);
var i=0,a=s+2*d;for(i=0;i<a;i++){var o=D*i,l=D*(i+1);f4(t+n+o,t+r+o,t+r+l,t+n+l)}}}function v(e,t,n){a.push(e),a.push(t),a.push(n)}function f3(e,t,i){addVertex(e),addVertex(t),addVertex(i);var a=r.length/3,o=f.generateTopUV(n,r,a-3,a-2,a-1);addUV(o[0]),addUV(o[1]),addUV(o[2])}function f4(e,t,i,a){addVertex(e),addVertex(t),addVertex(a),addVertex(t),addVertex(i),addVertex(a);var o=r.length/3,s=f.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);addUV(s[0]),addUV(s[1]),addUV(s[3]),addUV(s[1]),addUV(s[2]),addUV(s[3])}function addVertex(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function addUV(e){i.push(e.x),i.push(e.y)}!
/////  Internal functions
function buildLidFaces(){var e=r.length/3;if(c){var t=0,i=D*t;// steps + 1
// Bottom faces
for(U=0;U<V;U++)f3((G=A[U])[2]+i,G[1]+i,G[0]+i);
// Top faces
for(i=D*(t=s+2*d),U=0;U<V;U++)f3((G=A[U])[0]+i,G[1]+i,G[2]+i)}else{
// Bottom faces
for(U=0;U<V;U++)f3((G=A[U])[2],G[1],G[0]);
// Top faces
for(U=0;U<V;U++)f3((G=A[U])[0]+D*s,G[1]+D*s,G[2]+D*s)}n.addGroup(e,r.length/3-e,0)}
// Create faces for the z-sides of the shape
(),
// Sides faces
function buildSideFaces(){var e=r.length/3,t=0;for(sidewalls(C,t),t+=C.length,w=0,M=T.length;w<M;w++)sidewalls(_=T[w],t),
//, true
t+=_.length;n.addGroup(e,r.length/3-e,1)}()}this.addAttribute("position",new Float32BufferAttribute(r,3)),this.addAttribute("uv",new Float32BufferAttribute(i,2)),this.computeVertexNormals()}ExtrudeGeometry.prototype=Object.create(Geometry.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,e)},ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,e)};
//
var hn={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new Vector2(a,o),new Vector2(s,l),new Vector2(c,u)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-u)<.01?[new Vector2(o,1-l),new Vector2(c,1-h),new Vector2(d,1-f),new Vector2(m,1-v)]:[new Vector2(s,1-l),new Vector2(u,1-h),new Vector2(p,1-f),new Vector2(g,1-v)]}};function toJSON(e,t,n){if(
//
n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);
//
return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author alteredq / http://alteredqualia.com/
 *
 * Text = 3D Text
 *
 * parameters = {
 *  font: <THREE.Font>, // font
 *
 *  size: <float>, // size of the text
 *  height: <float>, // thickness to extrude text
 *  curveSegments: <int>, // number of points on the curves
 *
 *  bevelEnabled: <bool>, // turn on bevel
 *  bevelThickness: <float>, // how deep into text bevel goes
 *  bevelSize: <float> // how far from text outline is bevel
 * }
 */
// TextGeometry
function TextGeometry(e,t){Geometry.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new TextBufferGeometry(e,t)),this.mergeVertices()}
// TextBufferGeometry
function TextBufferGeometry(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var r=n.generateShapes(e,t.size);
// translate parameters to ExtrudeGeometry API
t.depth=void 0!==t.height?t.height:50,
// defaults
void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,r,t),this.type="TextBufferGeometry"}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author benaadams / https://twitter.com/ben_a_adams
 * @author Mugen87 / https://github.com/Mugen87
 */
// SphereGeometry
function SphereGeometry(e,t,n,r,i,a,o){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new SphereBufferGeometry(e,t,n,r,i,a,o)),this.mergeVertices()}
// SphereBufferGeometry
function SphereBufferGeometry(e,t,n,r,i,a,o){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var s,l,c=(a=void 0!==a?a:0)+(o=void 0!==o?o:Math.PI),u=0,h=[],d=new Vector3,p=new Vector3,f=[],m=[],g=[],v=[];
// generate vertices, normals and uvs
for(l=0;l<=n;l++){var y=[],b=l/n;for(s=0;s<=t;s++){var x=s/t;
// vertex
d.x=-e*Math.cos(r+x*i)*Math.sin(a+b*o),d.y=e*Math.cos(a+b*o),d.z=e*Math.sin(r+x*i)*Math.sin(a+b*o),m.push(d.x,d.y,d.z),
// normal
p.set(d.x,d.y,d.z).normalize(),g.push(p.x,p.y,p.z),
// uv
v.push(x,1-b),y.push(u++)}h.push(y)}
// indices
for(l=0;l<n;l++)for(s=0;s<t;s++){var _=h[l][s+1],w=h[l][s],M=h[l+1][s],E=h[l+1][s+1];(0!==l||a>0)&&f.push(_,w,E),(l!==n-1||c<Math.PI)&&f.push(w,M,E)}
// build geometry
this.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(v,2))}
/**
 * @author Kaleb Murphy
 * @author Mugen87 / https://github.com/Mugen87
 */
// RingGeometry
function RingGeometry(e,t,n,r,i,a){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new RingBufferGeometry(e,t,n,r,i,a)),this.mergeVertices()}
// RingBufferGeometry
function RingBufferGeometry(e,t,n,r,i,a){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;
// buffers
var o,s,l,c=[],u=[],h=[],d=[],p=e,f=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new Vector3,g=new Vector2;
// generate vertices, normals and uvs
for(s=0;s<=r;s++){for(l=0;l<=n;l++)
// values are generate from the inside of the ring to the outside
o=i+l/n*a,
// vertex
m.x=p*Math.cos(o),m.y=p*Math.sin(o),u.push(m.x,m.y,m.z),
// normal
h.push(0,0,1),
// uv
g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,d.push(g.x,g.y);
// increase the radius for next row of vertices
p+=f}
// indices
for(s=0;s<r;s++){var v=s*(n+1);for(l=0;l<n;l++){var y=o=l+v,b=o+n+1,x=o+n+2,_=o+1;
// faces
c.push(y,b,_),c.push(b,x,_)}}
// build geometry
this.setIndex(c),this.addAttribute("position",new Float32BufferAttribute(u,3)),this.addAttribute("normal",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(d,2))}
/**
 * @author zz85 / https://github.com/zz85
 * @author bhouston / http://clara.io
 * @author Mugen87 / https://github.com/Mugen87
 */
// LatheGeometry
function LatheGeometry(e,t,n,r){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new LatheBufferGeometry(e,t,n,r)),this.mergeVertices()}
// LatheBufferGeometry
function LatheBufferGeometry(e,t,n,r){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,
// clamp phiLength so it's in range of [ 0, 2PI ]
r=Nt.clamp(r,0,2*Math.PI);
// buffers
var i,a,o,s=[],l=[],c=[],u=1/t,h=new Vector3,d=new Vector2;
// generate vertices and uvs
for(a=0;a<=t;a++){var p=n+a*u*r,f=Math.sin(p),m=Math.cos(p);for(o=0;o<=e.length-1;o++)
// vertex
h.x=e[o].x*f,h.y=e[o].y,h.z=e[o].x*m,l.push(h.x,h.y,h.z),
// uv
d.x=a/t,d.y=o/(e.length-1),c.push(d.x,d.y)}
// indices
for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var g=i=o+a*e.length,v=i+e.length,y=i+e.length+1,b=i+1;
// faces
s.push(g,v,b),s.push(v,y,b)}
// build geometry
// if the geometry is closed, we need to average the normals along the seam.
// because the corresponding vertices are identical (but still have different UVs).
if(this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(c,2)),
// generate normals
this.computeVertexNormals(),r===2*Math.PI){var x=this.attributes.normal.array,_=new Vector3,w=new Vector3,M=new Vector3;for(
// this is the buffer offset for the last line of vertices
i=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)
// select the normal of the vertex in the first line
_.x=x[o+0],_.y=x[o+1],_.z=x[o+2],
// select the normal of the vertex in the last line
w.x=x[i+o+0],w.y=x[i+o+1],w.z=x[i+o+2],
// average normals
M.addVectors(_,w).normalize(),
// assign the new values to both normals
x[o+0]=x[i+o+0]=M.x,x[o+1]=x[i+o+1]=M.y,x[o+2]=x[i+o+2]=M.z}}
/**
 * @author jonobr1 / http://jonobr1.com
 * @author Mugen87 / https://github.com/Mugen87
 */
// ShapeGeometry
function ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}
// ShapeBufferGeometry
function ShapeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;
// buffers
var n=[],r=[],i=[],a=[],o=0,s=0;
// allow single and array values for "shapes" parameter
if(!1===Array.isArray(e))addShape(e);else for(var l=0;l<e.length;l++)addShape(e[l]),this.addGroup(o,s,l),// enables MultiMaterial support
o+=s,s=0;
// build geometry
// helper functions
function addShape(e){var o,l,c,u=r.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;
// check direction of vertices
if(!1===un.isClockWise(d))
// also check if holes are in the opposite direction
for(d=d.reverse(),o=0,l=p.length;o<l;o++)c=p[o],!0===un.isClockWise(c)&&(p[o]=c.reverse());var f=un.triangulateShape(d,p);
// join vertices of inner and outer paths to a single array
for(o=0,l=p.length;o<l;o++)c=p[o],d=d.concat(c);
// vertices, normals, uvs
for(o=0,l=d.length;o<l;o++){var m=d[o];r.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}
// incides
for(o=0,l=f.length;o<l;o++){var g=f[o],v=g[0]+u,y=g[1]+u,b=g[2]+u;n.push(v,y,b),s+=3}}this.setIndex(n),this.addAttribute("position",new Float32BufferAttribute(r,3)),this.addAttribute("normal",new Float32BufferAttribute(i,3)),this.addAttribute("uv",new Float32BufferAttribute(a,2))}
//
function toJSON$1(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}
/**
 * @author WestLangley / http://github.com/WestLangley
 * @author Mugen87 / https://github.com/Mugen87
 */function EdgesGeometry(e,t){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;
// buffer
var n,r,i,a,o=[],s=Math.cos(Nt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];
// helper variables
e.isBufferGeometry?(a=new Geometry).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();
// now create a data structure where each entry represents an edge with its adjoining faces
for(var h=a.vertices,d=a.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)n=m[u[g]],r=m[u[(g+1)%3]],l[0]=Math.min(n,r),l[1]=Math.max(n,r),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;
// generate vertices
for(i in c){var v=c[i];
// an edge is only rendered if the angle (in degrees) between the face normals of the adjoining faces exceeds this value. default = 1 degree.
if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=s){var y=h[v.index1];o.push(y.x,y.y,y.z),y=h[v.index2],o.push(y.x,y.y,y.z)}}
// build geometry
this.addAttribute("position",new Float32BufferAttribute(o,3))}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
// CylinderGeometry
function CylinderGeometry(e,t,n,r,i,a,o,s){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,n,r,i,a,o,s)),this.mergeVertices()}
// CylinderBufferGeometry
function CylinderBufferGeometry(e,t,n,r,i,a,o,s){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;
// buffers
var c=[],u=[],h=[],d=[],p=0,f=[],m=n/2,g=0;function generateCap(n){var i,a,f,v=new Vector2,y=new Vector3,b=0,x=!0===n?e:t,_=!0===n?1:-1;
// first we generate the center vertex data of the cap.
// because the geometry needs one set of uvs per face,
// we must generate a center vertex per face/segment
for(
// save the index of the first center vertex
a=p,i=1;i<=r;i++)
// vertex
u.push(0,m*_,0),
// normal
h.push(0,_,0),
// uv
d.push(.5,.5),
// increase index
p++;
// save the index of the last center vertex
// now we generate the surrounding vertices, normals and uvs
for(f=p,i=0;i<=r;i++){var w=i/r*s+o,M=Math.cos(w),E=Math.sin(w);
// vertex
y.x=x*E,y.y=m*_,y.z=x*M,u.push(y.x,y.y,y.z),
// normal
h.push(0,_,0),
// uv
v.x=.5*M+.5,v.y=.5*E*_+.5,d.push(v.x,v.y),
// increase index
p++}
// generate indices
for(i=0;i<r;i++){var S=a+i,L=f+i;!0===n?
// face top
c.push(L,L+1,S):
// face bottom
c.push(L+1,L,S),b+=3}
// add a group to the geometry. this will ensure multi material support
l.addGroup(g,b,!0===n?1:2),
// calculate new start value for groups
g+=b}
// generate geometry
!function generateTorso(){var a,v,y=new Vector3,b=new Vector3,x=0,_=(t-e)/n;
// generate vertices, normals and uvs
for(v=0;v<=i;v++){var w=[],M=v/i,E=M*(t-e)+e;for(a=0;a<=r;a++){var S=a/r,L=S*s+o,T=Math.sin(L),A=Math.cos(L);
// vertex
b.x=E*T,b.y=-M*n+m,b.z=E*A,u.push(b.x,b.y,b.z),
// normal
y.set(T,_,A).normalize(),h.push(y.x,y.y,y.z),
// uv
d.push(S,1-M),
// save index of vertex in respective row
w.push(p++)}
// now save vertices of the row in our index array
f.push(w)}
// generate indices
for(a=0;a<r;a++)for(v=0;v<i;v++){
// we use the index array to access the correct indices
var C=f[v][a],P=f[v+1][a],I=f[v+1][a+1],O=f[v][a+1];
// faces
c.push(C,P,O),c.push(P,I,O),
// update group counter
x+=6}
// add a group to the geometry. this will ensure multi material support
l.addGroup(g,x,0),
// calculate new start value for groups
g+=x}(),!1===a&&(e>0&&generateCap(!0),t>0&&generateCap(!1)),
// build geometry
this.setIndex(c),this.addAttribute("position",new Float32BufferAttribute(u,3)),this.addAttribute("normal",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(d,2))}
/**
 * @author abelnation / http://github.com/abelnation
 */
// ConeGeometry
function ConeGeometry(e,t,n,r,i,a,o){CylinderGeometry.call(this,0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}
// ConeBufferGeometry
function ConeBufferGeometry(e,t,n,r,i,a,o){CylinderBufferGeometry.call(this,0,e,t,n,r,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}
/**
 * @author benaadams / https://twitter.com/ben_a_adams
 * @author Mugen87 / https://github.com/Mugen87
 * @author hughes
 */
// CircleGeometry
function CircleGeometry(e,t,n,r){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new CircleBufferGeometry(e,t,n,r)),this.mergeVertices()}
// CircleBufferGeometry
function CircleBufferGeometry(e,t,n,r){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;
// buffers
var i,a,o=[],s=[],l=[],c=[],u=new Vector3,h=new Vector2;for(
// center point
s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var d=n+a/t*r;
// vertex
u.x=e*Math.cos(d),u.y=e*Math.sin(d),s.push(u.x,u.y,u.z),
// normal
l.push(0,0,1),
// uvs
h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,c.push(h.x,h.y)}
// indices
for(i=1;i<=t;i++)o.push(i,i+1,0);
// build geometry
this.setIndex(o),this.addAttribute("position",new Float32BufferAttribute(s,3)),this.addAttribute("normal",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(c,2))}TextGeometry.prototype=Object.create(Geometry.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,SphereGeometry.prototype=Object.create(Geometry.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry,RingGeometry.prototype=Object.create(Geometry.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,LatheGeometry.prototype=Object.create(Geometry.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,e)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,e)},EdgesGeometry.prototype=Object.create(BufferGeometry.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,CylinderGeometry.prototype=Object.create(Geometry.prototype),CylinderGeometry.prototype.constructor=CylinderGeometry,CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry,ConeGeometry.prototype=Object.create(CylinderGeometry.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,CircleGeometry.prototype=Object.create(Geometry.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var dn=/* */Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});
/**
 * @author mrdoob / http://mrdoob.com/
 *
 * parameters = {
 *  color: <THREE.Color>
 * }
 */function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}
/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *  color: <hex>,
 *  roughness: <float>,
 *  metalness: <float>,
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *  lightMapIntensity: <float>
 *
 *  aoMap: new THREE.Texture( <Image> ),
 *  aoMapIntensity: <float>
 *
 *  emissive: <hex>,
 *  emissiveIntensity: <float>
 *  emissiveMap: new THREE.Texture( <Image> ),
 *
 *  bumpMap: new THREE.Texture( <Image> ),
 *  bumpScale: <float>,
 *
 *  normalMap: new THREE.Texture( <Image> ),
 *  normalMapType: THREE.TangentSpaceNormalMap,
 *  normalScale: <Vector2>,
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>,
 *
 *  roughnessMap: new THREE.Texture( <Image> ),
 *
 *  metalnessMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),
 *  envMapIntensity: <float>
 *
 *  refractionRatio: <float>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */
function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),// diffuse
this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}
/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *  reflectivity: <float>
 * }
 */
function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,// maps to F0 = 0.04
this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  specular: <hex>,
 *  shininess: <float>,
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *  lightMapIntensity: <float>
 *
 *  aoMap: new THREE.Texture( <Image> ),
 *  aoMapIntensity: <float>
 *
 *  emissive: <hex>,
 *  emissiveIntensity: <float>
 *  emissiveMap: new THREE.Texture( <Image> ),
 *
 *  bumpMap: new THREE.Texture( <Image> ),
 *  bumpScale: <float>,
 *
 *  normalMap: new THREE.Texture( <Image> ),
 *  normalMapType: THREE.TangentSpaceNormalMap,
 *  normalScale: <Vector2>,
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>,
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */
function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),// diffuse
this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}
/**
 * @author takahirox / http://github.com/takahirox
 *
 * parameters = {
 *  gradientMap: new THREE.Texture( <Image> )
 * }
 */
function MeshToonMaterial(e){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *  opacity: <float>,
 *
 *  bumpMap: new THREE.Texture( <Image> ),
 *  bumpScale: <float>,
 *
 *  normalMap: new THREE.Texture( <Image> ),
 *  normalMapType: THREE.TangentSpaceNormalMap,
 *  normalScale: <Vector2>,
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */
function MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *  lightMapIntensity: <float>
 *
 *  aoMap: new THREE.Texture( <Image> ),
 *  aoMapIntensity: <float>
 *
 *  emissive: <hex>,
 *  emissiveIntensity: <float>
 *  emissiveMap: new THREE.Texture( <Image> ),
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */
function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),// diffuse
this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}
/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *
 *  matcap: new THREE.Texture( <Image> ),
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  bumpMap: new THREE.Texture( <Image> ),
 *  bumpScale: <float>,
 *
 *  normalMap: new THREE.Texture( <Image> ),
 *  normalMapType: THREE.TangentSpaceNormalMap,
 *  normalScale: <Vector2>,
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>,
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */
function MeshMatcapMaterial(e){
// a matcap is required
if(Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),// diffuse
this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e),null===this.matcap){var t=document.createElement("canvas");t.width=1,t.height=1;var n=t.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,1,1),this.matcap=new THREE.CanvasTexture(t)}}
/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *
 *  linewidth: <float>,
 *
 *  scale: <float>,
 *  dashSize: <float>,
 *  gapSize: <float>
 * }
 */
function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(e){return MeshPhongMaterial.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var pn=/* */Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),fn={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(
// console.log( 'THREE.Cache', 'Adding key:', key );
this.files[e]=t)},get:function(e){if(!1!==this.enabled)
// console.log( 'THREE.Cache', 'Checking key:', key );
return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};
/**
 * @author mrdoob / http://mrdoob.com/
 */
/**
 * @author mrdoob / http://mrdoob.com/
 */
function LoadingManager(e,t,n){var r=this,i=!1,a=0,o=0,s=void 0;
// Refer to #5689 for the reason why we don't set .onStart
// in the constructor
this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var mn=new LoadingManager,gn={};
/**
 * @author mrdoob / http://mrdoob.com/
 */function FileLoader(e){this.manager=void 0!==e?e:mn}
/**
 * @author mrdoob / http://mrdoob.com/
 *
 * Abstract Base class to block based textures loader (dds, pvr, ...)
 */
function CompressedTextureLoader(e){this.manager=void 0!==e?e:mn,
// override in sub classes
this._parser=null}
/**
 * @author Nikos M. / https://github.com/foo123/
 *
 * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)
 */
function DataTextureLoader(e){this.manager=void 0!==e?e:mn,
// override in sub classes
this._parser=null}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function ImageLoader(e){this.manager=void 0!==e?e:mn}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function CubeTextureLoader(e){this.manager=void 0!==e?e:mn}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function TextureLoader(e){this.manager=void 0!==e?e:mn}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * Extensible curve object
 *
 * Some common of curve methods:
 * .getPoint( t, optionalTarget ), .getTangent( t )
 * .getPointAt( u, optionalTarget ), .getTangentAt( u )
 * .getPoints(), .getSpacedPoints()
 * .getLength()
 * .updateArcLengths()
 *
 * This following curves inherit from THREE.Curve:
 *
 * -- 2D curves --
 * THREE.ArcCurve
 * THREE.CubicBezierCurve
 * THREE.EllipseCurve
 * THREE.LineCurve
 * THREE.QuadraticBezierCurve
 * THREE.SplineCurve
 *
 * -- 3D curves --
 * THREE.CatmullRomCurve3
 * THREE.CubicBezierCurve3
 * THREE.LineCurve3
 * THREE.QuadraticBezierCurve3
 *
 * A series of curves can be represented as a THREE.CurvePath.
 *
 **/
/**************************************************************
 *  Abstract Curve base class
 **************************************************************/
function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(e,t,n,r,i,a,o,s){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ArcCurve(e,t,n,r,i,a){EllipseCurve.call(this,e,t,n,n,r,i,a),this.type="ArcCurve"}
/**
 * @author zz85 https://github.com/zz85
 *
 * Centripetal CatmullRom Curve - which is useful for avoiding
 * cusps and self-intersections in non-uniform catmull rom curves.
 * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf
 *
 * curve.type accepts centripetal(default), chordal and catmullrom
 * curve.tension is used for catmullrom which defaults to 0.5
 */
/*
Based on an optimized c++ solution in
 - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/
 - http://ideone.com/NoEbVM

This CubicPoly class could be used for reusing some variables and calculations,
but for three.js curve use, it could be possible inlined and flatten into a single function call
which can be placed in CurveUtils.
*/
function CubicPoly(){var e=0,t=0,n=0,r=0;
/*
     * Compute coefficients for a cubic polynomial
     *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3
     * such that
     *   p(0) = x0, p(1) = x1
     *  and
     *   p'(0) = t0, p'(1) = t1.
     */function init(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,i){init(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,a,o){
// compute tangents when parameterized in [t1,t2]
var s=(t-e)/i-(n-e)/(i+a)+(n-t)/a,l=(n-t)/a-(r-t)/(a+o)+(r-n)/o;init(t,n,
// rescale tangents for parametrization in [0,1]
s*=a,l*=a)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}
//
Object.assign(FileLoader.prototype,{load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=fn.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;
// Check if request is duplicate
if(void 0===gn[e]){
// Check for data: URI
var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);
// Safari can not handle Data URIs through XMLHttpRequest so process manually
if(o){var s=o[1],l=!!o[2],c=o[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:// 'text' or other
u=c}
// Wait for next browser tick like standard XMLHttpRequest event dispatching does
window.setTimeout(function(){t&&t(u),i.manager.itemEnd(e)},0)}catch(t){
// Wait for next browser tick like standard XMLHttpRequest event dispatching does
window.setTimeout(function(){r&&r(t),i.manager.itemEnd(e),i.manager.itemError(e)},0)}}else{
// Initialise array for duplicate requests
gn[e]=[],gn[e].push({onLoad:t,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",function(t){var n=this.response;fn.add(e,n);var r=gn[e];if(delete gn[e],200===this.status||0===this.status){
// Some browsers return HTTP Status 0 when using non-http protocol
// e.g. 'file://' or 'data://'. Handle as success.
0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=r.length;a<o;a++){(s=r[a]).onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(a=0,o=r.length;a<o;a++){var s;(s=r[a]).onError&&s.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)}},!1),m.addEventListener("progress",function(t){for(var n=gn[e],r=0,i=n.length;r<i;r++){var a=n[r];a.onProgress&&a.onProgress(t)}},!1),m.addEventListener("error",function(t){var n=gn[e];delete gn[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)},!1),m.addEventListener("abort",function(t){var n=gn[e];delete gn[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return i.manager.itemStart(e),m}gn[e].push({onLoad:t,onProgress:n,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(CompressedTextureLoader.prototype,{load:function(e,t,n,r){var i=this,a=[],o=new CompressedTexture;o.image=a;var s=new FileLoader(this.manager);function loadTexture(c){s.load(e[c],function(e){var n=i._parser(e,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(o.minFilter=_e),o.format=n.format,o.needsUpdate=!0,t&&t(o))},n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,c=0,u=e.length;c<u;++c)loadTexture(c);else
// compressed cubemap texture stored in a single DDS file
s.load(e,function(e){var n=i._parser(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){a[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=_e),o.format=n.format,o.needsUpdate=!0,t&&t(o)},n,r);return o},setPath:function(e){return this.path=e,this}}),Object.assign(DataTextureLoader.prototype,{load:function(e,t,n,r){var i=this,a=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.load(e,function(e){var n=i._parser(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:ge,a.wrapT=void 0!==n.wrapT?n.wrapT:ge,a.magFilter=void 0!==n.magFilter?n.magFilter:_e,a.minFilter=void 0!==n.minFilter?n.minFilter:Me,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps),1===n.mipmapCount&&(a.minFilter=_e),a.needsUpdate=!0,t&&t(a,n))},n,r),a}}),Object.assign(ImageLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=fn.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function onImageLoad(){o.removeEventListener("load",onImageLoad,!1),o.removeEventListener("error",onImageError,!1),fn.add(e,this),t&&t(this),i.manager.itemEnd(e)}function onImageError(t){o.removeEventListener("load",onImageLoad,!1),o.removeEventListener("error",onImageError,!1),r&&r(t),i.manager.itemEnd(e),i.manager.itemError(e)}return o.addEventListener("load",onImageLoad,!1),o.addEventListener("error",onImageError,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(CubeTextureLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){var i=new CubeTexture,a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function loadTexture(n){a.load(e[n],function(e){i.images[n]=e,6===++o&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(var s=0;s<e.length;++s)loadTexture(s);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(TextureLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){var i=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(n){i.image=n;
// JPEGs can't have an alpha channel, so memory can be saved by storing them as RGB.
var r=e.search(/\.jpe?g$/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?Ve:Ne,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Curve.prototype,{
// Virtual base class method to overwrite and implement in subclasses
//  - t [0 .. 1]
getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},
// Get point at relative position in curve according to arc length
// - u [0 .. 1]
getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},
// Get sequence of points using getPoint( t )
getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},
// Get sequence of points using getPointAt( u )
getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},
// Get total curve arc length
getLength:function(){var e=this.getLengths();return e[e.length-1]},
// Get list of cumulative segment lengths
getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),a=0;for(r.push(0),n=1;n<=e;n++)a+=(t=this.getPoint(n/e)).distanceTo(i),r.push(a),i=t;return this.cacheArcLengths=r,r;// { sums: cache, sum: sum }; Sum is in the last element.
},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},
// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equidistant
getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;// The targeted u distance value to get
n=t||e*r[a-1];
// binary search for the index with largest value smaller than target u distance
for(var o,s=0,l=a-1;s<=l;)if((// less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats
o=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){l=i;break;
// DONE
}l=i-1}if(r[i=l]===n)return i/(a-1);
// we could get finer grain at lengths, or use simple interpolation between two points
var c=r[i];return(i+(n-c)/(r[i+1]-c))/(a-1)},
// Returns a unit vector tangent at t
// In case any sub curve does not implement its tangent derivation,
// 2 points a small delta apart will be used to find its gradient
// which seems to give a reasonable approximation
getTangent:function(e){var t=e-1e-4,n=e+1e-4;
// Capping in case of danger
t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){
// see http://www.cs.indiana.edu/pub/techreports/TR425.pdf
var n,r,i,a=new Vector3,o=[],s=[],l=[],c=new Vector3,u=new Matrix4;
// compute the tangent vectors for each segment on the curve
for(n=0;n<=e;n++)r=n/e,o[n]=this.getTangentAt(r),o[n].normalize();
// select an initial normal vector perpendicular to the first tangent vector,
// and in the direction of the minimum tangent xyz component
s[0]=new Vector3,l[0]=new Vector3;var h=Number.MAX_VALUE,d=Math.abs(o[0].x),p=Math.abs(o[0].y),f=Math.abs(o[0].z);
// compute the slowly-varying normal and binormal vectors for each segment on the curve
for(d<=h&&(h=d,a.set(1,0,0)),p<=h&&(h=p,a.set(0,1,0)),f<=h&&a.set(0,0,1),c.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],c),l[0].crossVectors(o[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),l[n]=l[n-1].clone(),c.crossVectors(o[n-1],o[n]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(Nt.clamp(o[n-1].dot(o[n]),-1,1)),// clamp for floating pt errors
s[n].applyMatrix4(u.makeRotationAxis(c,i))),l[n].crossVectors(o[n],s[n]);
// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same
if(!0===t)for(i=Math.acos(Nt.clamp(s[0].dot(s[e]),-1,1)),i/=e,o[0].dot(c.crossVectors(s[0],s[e]))>0&&(i=-i),n=1;n<=e;n++)
// twist a little...
s[n].applyMatrix4(u.makeRotationAxis(o[n],i*n)),l[n].crossVectors(o[n],s[n]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e,t){
// ensures that deltaAngle is 0 .. 2 PI
for(var n=t||new Vector2,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;
// Rotate the point about the center of the ellipse.
s=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return n.set(s,l)},EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var vn=new Vector3,yn=new CubicPoly,bn=new CubicPoly,xn=new CubicPoly;function CatmullRomCurve3(e,t,n,r){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Bezier Curves formulas obtained from
 * http://en.wikipedia.org/wiki/BÃ©zier_curve
 */
function CatmullRom(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}
//
function QuadraticBezier(e,t,n,r){return function QuadraticBezierP0(e,t){var n=1-e;return n*n*t}(e,t)+function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}(e,n)+function QuadraticBezierP2(e,t){return e*e*t}(e,r)}
//
function CubicBezier(e,t,n,r,i){return function CubicBezierP0(e,t){var n=1-e;return n*n*n*t}(e,t)+function CubicBezierP1(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}(e,r)+function CubicBezierP3(e,t){return e*e*e*t}(e,i)}function CubicBezierCurve(e,t,n,r){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=n||new Vector2,this.v3=r||new Vector2}function CubicBezierCurve3(e,t,n,r){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=n||new Vector3,this.v3=r||new Vector3}function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}function QuadraticBezierCurve(e,t,n){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=n||new Vector2}function QuadraticBezierCurve3(e,t,n){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=n||new Vector3}function SplineCurve(e/* array of Vector2 */){Curve.call(this),this.type="SplineCurve",this.points=e||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(e,t){var n,r,i,a,o=t||new Vector3,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),// 4 points
this.closed||u>0?n=s[(u-1)%l]:(
// extrapolate first point
vn.subVectors(s[0],s[1]).add(s[0]),n=vn),r=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?a=s[(u+2)%l]:(
// extrapolate last point
vn.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=vn),"centripetal"===this.curveType||"chordal"===this.curveType){
// init Centripetal / Chordal Catmull-Rom
var d="chordal"===this.curveType?.5:.25,p=Math.pow(n.distanceToSquared(r),d),f=Math.pow(r.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(a),d);
// safety check for repeated points
f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),yn.initNonuniformCatmullRom(n.x,r.x,i.x,a.x,p,f,m),bn.initNonuniformCatmullRom(n.y,r.y,i.y,a.y,p,f,m),xn.initNonuniformCatmullRom(n.z,r.z,i.z,a.z,p,f,m)}else"catmullrom"===this.curveType&&(yn.initCatmullRom(n.x,r.x,i.x,a.x,this.tension),bn.initCatmullRom(n.y,r.y,i.y,a.y,this.tension),xn.initCatmullRom(n.z,r.z,i.z,a.z,this.tension));return o.set(yn.calc(h),bn.calc(h),xn.calc(h)),o},CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Vector3).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(e,t){var n=t||new Vector2,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(CubicBezier(e,r.x,i.x,a.x,o.x),CubicBezier(e,r.y,i.y,a.y,o.y)),n},CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(e,t){var n=t||new Vector3,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(CubicBezier(e,r.x,i.x,a.x,o.x),CubicBezier(e,r.y,i.y,a.y,o.y),CubicBezier(e,r.z,i.z,a.z,o.z)),n},CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e,t){var n=t||new Vector2;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},
// Line curve is linear, so we can overwrite default getPointAt
LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(e,t){var n=t||new Vector3;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},
// Line curve is linear, so we can overwrite default getPointAt
LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(e,t){var n=t||new Vector2,r=this.v0,i=this.v1,a=this.v2;return n.set(QuadraticBezier(e,r.x,i.x,a.x),QuadraticBezier(e,r.y,i.y,a.y)),n},QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(e,t){var n=t||new Vector3,r=this.v0,i=this.v1,a=this.v2;return n.set(QuadraticBezier(e,r.x,i.x,a.x),QuadraticBezier(e,r.y,i.y,a.y),QuadraticBezier(e,r.z,i.z,a.z)),n},QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e,t){var n=t||new Vector2,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],l=r[a],c=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(CatmullRom(o,s.x,l.x,c.x,u.x),CatmullRom(o,s.y,l.y,c.y,u.y)),n},SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Vector2).fromArray(r))}return this};var _n=/* */Object.freeze({ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 **/
/**************************************************************
 *  Curved Path - a curve path is simply a array of connected
 *  curves, but retains the api of a curve
 **************************************************************/function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * Creates free form 2d path using series of points, lines or curves.
 **/
function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * Defines a 2d shape plane using paths.
 **/
// STEP 1 Create a path.
// STEP 2 Turn path into shape.
// STEP 3 ExtrudeGeometry takes in Shape/Shapes
// STEP 3a - Extract points from each shape, turn to vertices
// STEP 3b - Triangulate each shape, add faces.
function Shape(e){Path.call(this,e),this.uuid=Nt.generateUUID(),this.type="Shape",this.holes=[]}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */
function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function HemisphereLight(e,t,n){Light.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function SpotLight(e,t,n,r,i,a){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){
// intensity = power per solid angle.
// ref: equation (17) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
return this.intensity*Math.PI},set:function(e){
// intensity = power per solid angle.
// ref: equation (17) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,// for physically correct lights, should be 2.
this.shadow=new SpotLightShadow}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function PointLight(e,t,n,r){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){
// intensity = power per solid angle.
// ref: equation (15) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
return 4*this.intensity*Math.PI},set:function(e){
// intensity = power per solid angle.
// ref: equation (15) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,// for physically correct lights, should be 2.
this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author arose / http://github.com/arose
 */
function OrthographicCamera(e,t,n,r,i,a){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */
function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}
/**
 * @author abelnation / http://github.com/abelnation
 */
function RectAreaLight(e,t,n,r){Light.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){
// Add a line curve if start and end of lines are not connected
var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},
// To get accurate point with reference to
// entire path distance at time t,
// following has to be done:
// 1. Length of each sub path have to be known
// 2. Locate and identify type of curve
// 3. Get t for the curve
// 4. Return curve.getPointAt(t')
getPoint:function(e){
// To think about boundaries points.
for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,a=this.curves[r],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}r++}return null;
// loop where sum != 0, sum > d , sum+1 <d
},
// We cannot use the default THREE.Curve getPoint() with getLength() because in
// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath
// getPoint() depends on getLength
getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},
// cacheLengths must be recalculated.
updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},
// Compute lengths and cache them
// We cannot overwrite getLengths() because UtoT mapping uses it.
getCurveLengths:function(){
// We use cache values if curves and cache array are same length
if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;
// Get length of sub-curve
// Push sums into cached array
for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(// ensures no consecutive points are duplicates
n.push(c),t=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Curve.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new _n[r.type]).fromJSON(r))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t);// TODO consider referencing vectors instead of copying?
},lineTo:function(e,t){var n=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,r){var i=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(n,r));this.curves.push(i),this.currentPoint.set(n,r)},bezierCurveTo:function(e,t,n,r,i,a){var o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(n,r),new Vector2(i,a));this.curves.push(o),this.currentPoint.set(i,a)},splineThru:function(e/*Array of Vector*/){var t=new SplineCurve([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,n,r,i,a)},absarc:function(e,t,n,r,i,a){this.absellipse(e,t,n,n,r,i,a)},ellipse:function(e,t,n,r,i,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,n,r,i,a,o,s)},absellipse:function(e,t,n,r,i,a,o,s){var l=new EllipseCurve(e,t,n,r,i,a,o,s);if(this.curves.length>0){
// if a previous curve is present, attempt to join
var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},
// get points of shape and holes (keypoints based on segments parameter)
extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Path).fromJSON(r))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(LightShadow.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function(e){var t=this.camera,n=2*Nt.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;a=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(o-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});
/**
 * @author tschw
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 */
var wn={
// same as Array.prototype.slice, but also works on typed arrays
arraySlice:function(e,t,n){return wn.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},
// converts an array to a specific type
convertArray:function(e,t,n){return!e||// let 'undefined' and 'null' pass
!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},
// returns an array by which times and values can be sorted
getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort(function compareTime(t,n){return e[t]-e[n]}),n},
// uses the array previously returned by 'getKeyframeOrder' to sort data
sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},
// function for parsing AOS keyframe formats
flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){// no data
var o=a[r];if(void 0!==o)// no data
if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)
// ...assume THREE.Math-ish
do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else
// otherwise push as-is
do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}}};
/**
 * Abstract base class of interpolants over parametric samples.
 *
 * The parameter domain is one dimensional, typically the time or a path
 * along a curve defined by the data.
 *
 * The sample values can have any dimensionality and derived classes may
 * apply special interpretations to the data.
 *
 * This class provides the interval seek in a Template Method, deferring
 * the actual interpolation to derived classes.
 *
 * Time complexity is O(1) for linear access crossing at most two points
 * and O(log N) for random access, where N is the number of positions.
 *
 * References:
 *
 *      http://www.oodesign.com/template-method-pattern.html
 *
 * @author tschw
 */function Interpolant(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}
/**
 * Fast and simple cubic spline interpolant.
 *
 * It was derived from a Hermitian construction setting the first derivative
 * at each sample position to the linear slope between neighboring positions
 * over their parameter interval.
 *
 * @author tschw
 */
function CubicInterpolant(e,t,n,r){Interpolant.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}
/**
 * @author tschw
 */
function LinearInterpolant(e,t,n,r){Interpolant.call(this,e,t,n,r)}
/**
 *
 * Interpolant that evaluates to the sample value at the position preceeding
 * the parameter.
 *
 * @author tschw
 */
function DiscreteInterpolant(e,t,n,r){Interpolant.call(this,e,t,n,r)}
/**
 *
 * A timed sequence of keyframes for a specific property.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function KeyframeTrack(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=wn.convertArray(t,this.TimeBufferType),this.values=wn.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}
// Static methods
/**
 *
 * A Track of Boolean keyframe values.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function BooleanKeyframeTrack(e,t,n){KeyframeTrack.call(this,e,t,n)}
/**
 *
 * A Track of keyframe values that represent color.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function ColorKeyframeTrack(e,t,n,r){KeyframeTrack.call(this,e,t,n,r)}
/**
 *
 * A Track of numeric keyframe values.
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function NumberKeyframeTrack(e,t,n,r){KeyframeTrack.call(this,e,t,n,r)}
/**
 * Spherical linear unit quaternion interpolant.
 *
 * @author tschw
 */
function QuaternionLinearInterpolant(e,t,n,r){Interpolant.call(this,e,t,n,r)}
/**
 *
 * A Track of quaternion keyframe values.
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function QuaternionKeyframeTrack(e,t,n,r){KeyframeTrack.call(this,e,t,n,r)}
/**
 *
 * A Track that interpolates Strings
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function StringKeyframeTrack(e,t,n,r){KeyframeTrack.call(this,e,t,n,r)}
/**
 *
 * A Track of vectored keyframe values.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function VectorKeyframeTrack(e,t,n,r){KeyframeTrack.call(this,e,t,n,r)}
/**
 *
 * Reusable set of Tracks that represent an animation.
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 */
function AnimationClip(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Nt.generateUUID(),
// this means it should figure out its duration by scanning the tracks
this.duration<0&&this.resetDuration()}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];wn.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}
// derived classes can define a static parse method
return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function MaterialLoader(e){this.manager=void 0!==e?e:mn,this.textures={}}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function BufferGeometryLoader(e){this.manager=void 0!==e?e:mn}Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{
//- See http://jsperf.com/comparison-to-undefined/3
//- slower code:
//-
//-                 if ( t >= t1 || t1 === undefined ) {
r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;
// after end
return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;// this loop
if(i=r,e<(r=t[++n]))
// we have arrived at the sought interval
break t}
// prepare binary search on the right side of the index
a=t.length;break n}
//- slower code:
//-                 if ( t < t0 || t0 === undefined ) {
if(e>=i)
// the interval is valid
break e;
// looping?
var s=t[1];e<s&&(n=2,// + 1, using the scan for the details
i=s);
// linear reverse scan
for(o=n-2;;){if(void 0===i)
// before start
return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;// this loop
if(r=i,e>=(i=t[--n-1]))
// we have arrived at the sought interval
break t}
// prepare binary search on the left side of the index
a=n,n=0}// linear scan
// binary search
for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}
// check boundary cases, again
if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}// seek
this._cachedIndex=n,this.intervalChanged_(n,i,r)}// validate_interval
return this.interpolate_(n,i,e,r)},settings:null,// optional, subclass-specific settings structure
// Note: The indirection allows central control of many interpolants.
// --- Protected interface
DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(
// copies a sample value to the result buffer
var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t},
// Template methods for derived classes:
interpolate_:function(){throw new Error("call to abstract method");
// implementations shall return this.resultBuffer
},intervalChanged_:function(){
// empty
}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Interpolant.prototype,{
//( 0, t, t0 ), returns this.resultBuffer
beforeStart_:Interpolant.prototype.copySampleValue_,
//( N-1, tN-1, t ), returns this.resultBuffer
afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:xt,endingEnd:xt},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case _t:
// f'(t0) = 0
i=e,o=2*t-n;break;case wt:o=t+r[
// use the other end of the curve
i=r.length-2]-r[i+1];break;default:// ZeroCurvatureEnding
// f''(t0) = 0 a.k.a. Natural Spline
i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case _t:
// f'(tN) = 0
a=e,s=2*n-t;break;case wt:
// use the other end of the curve
a=1,s=n+r[1]-r[0];break;default:// ZeroCurvatureEnding
// f''(tN) = 0, a.k.a. Natural Spline
a=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c},interpolate_:function(e,t,n,r){
// combine data linearly
for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,x=0
// evaluate polynomials
;x!==o;++x)i[x]=g*a[c+x]+v*a[l+x]+y*a[s+x]+b*a[u+x];return i}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(r-t),u=1-c,h=0;h!==o;++h)i[h]=a[l+h]*u+a[s+h]*c;return i}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e/*, t0, t, t1 */){return this.copySampleValue_(e-1)}}),Object.assign(KeyframeTrack,{
// Serialization (in static context, because of constructor invocation
// and automatic invocation of .toJSON):
toJSON:function(e){var t,n=e.constructor;
// derived classes can define a static toJSON method
if(void 0!==n.toJSON)t=n.toJSON(e);else{
// by default, we assume the data can be serialized as-is
t={name:e.name,times:wn.convertArray(e.times,Array),values:wn.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}// mandatory
return t.type=e.ValueTypeName,t}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:yt,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case vt:t=this.InterpolantFactoryMethodDiscrete;break;case yt:t=this.InterpolantFactoryMethodLinear;break;case bt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){
// fall back to default, unless the default itself is messed up
if(e===this.DefaultInterpolation)throw new Error(n);// fatal, in this case
this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return vt;case this.InterpolantFactoryMethodLinear:return yt;case this.InterpolantFactoryMethodSmooth:return bt}},getValueSize:function(){return this.values.length/this.times.length},
// move all keyframes either forwards or backwards in time
shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},
// scale all keyframe times by a factor (useful for frame <-> seconds conversions)
scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},
// removes keyframes before and after animation without changing any values within the range [startTime, endTime].
// IMPORTANT: We do not shift around keys to the start of the track time, because for interpolated keys this will change their values
trim:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;// inclusive -> exclusive bound
if(++a,0!==i||a!==r){
// empty tracks are forbidden, so keep at least one keyframe
i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=wn.arraySlice(n,i,a),this.values=wn.arraySlice(this.values,i*o,a*o)}return this},
// ensure we do not get a GarbageInGarbageOut situation, make sure tracks are at least minimally viable
validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&wn.isTypedArray(r)){o=0;for(var l=r.length;o!==l;++o){var c=r[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}}return e},
// removes equivalent sequential keys as common in morph target sequences
// (0,0,0,0,1,1,1,0,0,0,0,0,0,0) --> (0,0,1,1,0,0)
optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),r=this.getInterpolation()===bt,i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o];
// remove adjacent keyframes scheduled at the same time
if(l!==e[o+1]&&(1!==o||l!==l[0]))if(r)s=!0;else for(
// remove unnecessary keyframes same as their neighbors
var c=o*n,u=c-n,h=c+n,d=0;d!==n;++d){var p=t[c+d];if(p!==t[u+d]||p!==t[h+d]){s=!0;break}}
// in-place compaction
if(s){if(o!==i){e[i]=e[o];var f=o*n,m=i*n;for(d=0;d!==n;++d)t[m+d]=t[f+d]}++i}}
// flush last keyframe (compaction looks ahead)
if(a>0){e[i]=e[a];for(f=a*n,m=i*n,d=0;d!==n;++d)t[m+d]=t[f+d];++i}return i!==e.length&&(this.times=wn.arraySlice(e,0,i),this.values=wn.arraySlice(t,0,i*n)),this}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:vt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(n-t)/(r-t),c=s+o;s!==c;s+=4)Quaternion.slerpFlat(i,0,a,s-o,a,s,l);return i}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",
// ValueBufferType is inherited
DefaultInterpolation:yt,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:vt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(parseKeyframeTrack(n[i]).scale(r));return new AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=n.length;i!==a;++i)t.push(KeyframeTrack.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var c=wn.getKeyframeOrder(s);s=wn.sortedArray(s,1,c),l=wn.sortedArray(l,1,c),
// if there is a key at the first frame, duplicate it as the
// last frame as well for perfect loop.
r||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new AnimationClip(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){
// sort morph target names into animation groups based
// patterns like Walk_001, Walk_002, Run_001, Run_002
for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length
// tested with https://regex101.com/ on trick sequences
// such flamingo_flyA_003, flamingo_run1_003, crdeath0059
;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var c=r[h=l[1]];c||(r[h]=c=[]),c.push(s)}}var u=[];for(var h in r)u.push(AnimationClip.CreateFromMorphTargetSequence(h,r[h],t,n));return u},
// parse the animation.hierarchy format
parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){
// only return track if there are actually keys.
if(0!==n.length){var a=[],o=[];wn.flattenJSON(n,a,o,r),
// empty keys are filtered out, so check again
0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;
// skip empty tracks
if(c&&0!==c.length)
// process morph targets
if(c[0].morphTargets){for(
// figure out all morph targets used in this track
var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;
// create a track for each morph target with all zero
// morphTargetInfluences except for the keys in which
// the morphTarget is named.
for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var g=c[h];f.push(g.time),m.push(g.morphTarget===p?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+p+"]",f,m))}a=u.length*(o||1)}else{
// ...assume skeletal animation
var v=".bones["+t[l].name+"]";n(VectorKeyframeTrack,v+".position",c,"pos",r),n(QuaternionKeyframeTrack,v+".quaternion",c,"rot",r),n(VectorKeyframeTrack,v+".scale",c,"scl",r)}}return 0===r.length?null:new AnimationClip(i,a,r)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(MaterialLoader.prototype,{load:function(e,t,n,r){var i=this;new FileLoader(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function getTexture(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new pn[e.type];
// Shader Material
if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var r in e.uniforms){var i=e.uniforms[r];switch(n.uniforms[r]={},i.type){case"t":n.uniforms[r].value=getTexture(i.value);break;case"c":n.uniforms[r].value=(new Color).setHex(i.value);break;case"v2":n.uniforms[r].value=(new Vector2).fromArray(i.value);break;case"v3":n.uniforms[r].value=(new Vector3).fromArray(i.value);break;case"v4":n.uniforms[r].value=(new Vector4).fromArray(i.value);break;case"m4":n.uniforms[r].value=(new Matrix4).fromArray(i.value);break;default:n.uniforms[r].value=i.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),
// Deprecated
void 0!==e.shading&&(n.flatShading=1===e.shading),// THREE.FlatShading
// for PointsMaterial
void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),
// maps
void 0!==e.map&&(n.map=getTexture(e.map)),void 0!==e.alphaMap&&(n.alphaMap=getTexture(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=getTexture(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=getTexture(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var a=e.normalScale;!1===Array.isArray(a)&&(
// Blender exporter used to export a scalar. See #7459
a=[a,a]),n.normalScale=(new Vector2).fromArray(a)}return void 0!==e.displacementMap&&(n.displacementMap=getTexture(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=getTexture(e.specularMap)),void 0!==e.envMap&&(n.envMap=getTexture(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.lightMap&&(n.lightMap=getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=getTexture(e.gradientMap)),n}}),Object.assign(BufferGeometryLoader.prototype,{load:function(e,t,n,r){var i=this;new FileLoader(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},parse:function(e){var t=new BufferGeometry,n=e.data.index;if(void 0!==n){var r=new Mn[n.type](n.array);t.setIndex(new BufferAttribute(r,1))}var i=e.data.attributes;for(var a in i){var o=i[a];r=new Mn[o.type](o.array);t.addAttribute(a,new BufferAttribute(r,o.itemSize,o.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var l=0,c=s.length;l!==c;++l){var u=s[l];t.addGroup(u.start,u.count,u.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var d=new Vector3;void 0!==h.center&&d.fromArray(h.center),t.boundingSphere=new Sphere(d,h.radius)}return t}});var Mn={Int8Array:Int8Array,Uint8Array:Uint8Array,
// Workaround for IE11 pre KB2929437. See #11440
Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};
/**
 * @author alteredq / http://alteredqualia.com/
 */function Loader(){}Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,r=t.length;n<r;n+=2){var i=t[n],a=t[n+1];if(i.test(e))return a}return null}},Object.assign(Loader.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,n){for(var r=[],i=0;i<e.length;++i)r[i]=this.createMaterial(e[i],t,n);return r},createMaterial:function(){var e={NoBlending:M,NormalBlending:E,AdditiveBlending:S,SubtractiveBlending:L,MultiplyBlending:T,CustomBlending:A},t=new Color,n=new TextureLoader,r=new MaterialLoader;return function createMaterial(i,a,o){
// convert from old material format
var s={};function loadTexture(e,t,r,i,l){var c,u=a+e,h=Loader.Handlers.get(u);null!==h?c=h.load(u):(n.setCrossOrigin(o),c=n.load(u)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=me),1!==t[1]&&(c.wrapT=me)),void 0!==r&&c.offset.fromArray(r),void 0!==i&&("repeat"===i[0]&&(c.wrapS=me),"mirror"===i[0]&&(c.wrapS=ve),"repeat"===i[1]&&(c.wrapT=me),"mirror"===i[1]&&(c.wrapT=ve)),void 0!==l&&(c.anisotropy=l);var d=Nt.generateUUID();return s[d]=c,d}
//
var l={uuid:Nt.generateUUID(),type:"MeshLambertMaterial"};for(var c in i){var u=i[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":l.name=u;break;case"blending":l.blending=e[u];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":l.color=t.fromArray(u).getHex();break;case"colorSpecular":l.specular=t.fromArray(u).getHex();break;case"colorEmissive":l.emissive=t.fromArray(u).getHex();break;case"specularCoef":l.shininess=u;break;case"shading":"basic"===u.toLowerCase()&&(l.type="MeshBasicMaterial"),"phong"===u.toLowerCase()&&(l.type="MeshPhongMaterial"),"standard"===u.toLowerCase()&&(l.type="MeshStandardMaterial");break;case"mapDiffuse":l.map=loadTexture(u,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":l.emissiveMap=loadTexture(u,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":l.lightMap=loadTexture(u,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":l.aoMap=loadTexture(u,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":l.bumpMap=loadTexture(u,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":l.bumpScale=u;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":l.normalMap=loadTexture(u,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":l.normalScale=u;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":l.specularMap=loadTexture(u,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":l.metalnessMap=loadTexture(u,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":l.roughnessMap=loadTexture(u,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":l.alphaMap=loadTexture(u,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":l.side=m;break;case"doubleSided":l.side=g;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),l.opacity=u;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":l[c]=u;break;case"vertexColors":!0===u&&(l.vertexColors=w),"face"===u&&(l.vertexColors=_);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,u)}}return"MeshBasicMaterial"===l.type&&delete l.emissive,"MeshPhongMaterial"!==l.type&&delete l.specular,l.opacity<1&&(l.transparent=!0),r.setTextures(s),r.parse(l)}}()});
/**
 * @author Don McCurdy / https://www.donmccurdy.com
 */
var En={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);
// Avoid the String.fromCharCode.apply(null, array) shortcut, which
// throws a "maximum call stack size exceeded" error for large arrays.
for(var t="",n=0,r=e.length;n<r;n++)
// Implicitly assumes little-endian.
t+=String.fromCharCode(e[n]);
// Merges multi-byte utf-8 characters.
return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */function JSONLoader(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:mn,this.withCredentials=!1}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function ObjectLoader(e){this.manager=void 0!==e?e:mn,this.texturePath=""}Object.assign(JSONLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){var i=this,a=void 0===this.path?En.extractUrlBase(e):this.path,o=new FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,function(n){var r=JSON.parse(n),o=r.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(r,a);t(l.geometry,l.materials)},n,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(){return function parse(e,t){void 0!==e.data&&(
// Geometry 4.0 spec
e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var n=new Geometry;return function parseModel(e,t){function isBitSet(e,t){return e&1<<t}var n,r,i,a,o,s,l,c,u,h,d,p,f,m,g,v,y,b,x,_,w,M,E,S,L,T=e.faces,A=e.vertices,C=e.normals,P=e.colors,I=e.scale,O=0;if(void 0!==e.uvs){
// disregard empty arrays
for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&O++;for(n=0;n<O;n++)t.faceVertexUvs[n]=[]}for(a=0,o=A.length;a<o;)(b=new Vector3).x=A[a++]*I,b.y=A[a++]*I,b.z=A[a++]*I,t.vertices.push(b);for(a=0,o=T.length;a<o;)
// console.log("type", type, "bits", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);
if(d=isBitSet(h=T[a++],0),p=isBitSet(h,1),f=isBitSet(h,3),m=isBitSet(h,4),g=isBitSet(h,5),v=isBitSet(h,6),y=isBitSet(h,7),d){if((_=new Face3).a=T[a],_.b=T[a+1],_.c=T[a+3],(w=new Face3).a=T[a+1],w.b=T[a+2],w.c=T[a+3],a+=4,p&&(u=T[a++],_.materialIndex=u,w.materialIndex=u),
// to get face <=> uv index correspondence
i=t.faces.length,f)for(n=0;n<O;n++)for(S=e.uvs[n],t.faceVertexUvs[n][i]=[],t.faceVertexUvs[n][i+1]=[],r=0;r<4;r++)L=new Vector2(S[2*(c=T[a++])],S[2*c+1]),2!==r&&t.faceVertexUvs[n][i].push(L),0!==r&&t.faceVertexUvs[n][i+1].push(L);if(m&&(l=3*T[a++],_.normal.set(C[l++],C[l++],C[l]),w.normal.copy(_.normal)),g)for(n=0;n<4;n++)l=3*T[a++],E=new Vector3(C[l++],C[l++],C[l]),2!==n&&_.vertexNormals.push(E),0!==n&&w.vertexNormals.push(E);if(v&&(M=P[s=T[a++]],_.color.setHex(M),w.color.setHex(M)),y)for(n=0;n<4;n++)M=P[s=T[a++]],2!==n&&_.vertexColors.push(new Color(M)),0!==n&&w.vertexColors.push(new Color(M));t.faces.push(_),t.faces.push(w)}else{if((x=new Face3).a=T[a++],x.b=T[a++],x.c=T[a++],p&&(u=T[a++],x.materialIndex=u),
// to get face <=> uv index correspondence
i=t.faces.length,f)for(n=0;n<O;n++)for(S=e.uvs[n],t.faceVertexUvs[n][i]=[],r=0;r<3;r++)L=new Vector2(S[2*(c=T[a++])],S[2*c+1]),t.faceVertexUvs[n][i].push(L);if(m&&(l=3*T[a++],x.normal.set(C[l++],C[l++],C[l])),g)for(n=0;n<3;n++)l=3*T[a++],E=new Vector3(C[l++],C[l++],C[l]),x.vertexNormals.push(E);if(v&&(s=T[a++],x.color.setHex(P[s])),y)for(n=0;n<3;n++)s=T[a++],x.vertexColors.push(new Color(P[s]));t.faces.push(x)}}(e,n),function parseSkin(e,t){var n=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;r<i;r+=n){var a=e.skinWeights[r],o=n>1?e.skinWeights[r+1]:0,s=n>2?e.skinWeights[r+2]:0,l=n>3?e.skinWeights[r+3]:0;t.skinWeights.push(new Vector4(a,o,s,l))}if(e.skinIndices)for(r=0,i=e.skinIndices.length;r<i;r+=n){var c=e.skinIndices[r],u=n>1?e.skinIndices[r+1]:0,h=n>2?e.skinIndices[r+2]:0,d=n>3?e.skinIndices[r+3]:0;t.skinIndices.push(new Vector4(c,u,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,n),function parseMorphing(e,t){var n=e.scale;if(void 0!==e.morphTargets)for(var r=0,i=e.morphTargets.length;r<i;r++){t.morphTargets[r]={},t.morphTargets[r].name=e.morphTargets[r].name,t.morphTargets[r].vertices=[];for(var a=t.morphTargets[r].vertices,o=e.morphTargets[r].vertices,s=0,l=o.length;s<l;s+=3){var c=new Vector3;c.x=o[s]*n,c.y=o[s+1]*n,c.z=o[s+2]*n,a.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=t.faces,h=e.morphColors[0].colors;for(r=0,i=u.length;r<i;r++)u[r].color.fromArray(h,3*r)}}(e,n),function parseAnimations(e,t){var n=[],r=[];
// parse old style Bone/Hierarchy animations
void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var i=0;i<r.length;i++){var a=AnimationClip.parseAnimation(r[i],t.bones);a&&n.push(a)}
// parse implicit morph animations
if(t.morphTargets){
// TODO: Figure out what an appropraite FPS is for morph target animations -- defaulting to 10, but really it is completely arbitrary.
var o=AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);n=n.concat(o)}n.length>0&&(t.animations=n)}(e,n),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:n}:{geometry:n,materials:Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}()}),Object.assign(ObjectLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this;new FileLoader(i.manager).load(e,function(n){var a=null;try{a=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")},n,r)},setTexturePath:function(e){return this.texturePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,r,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new Shape).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new JSONLoader,i=new BufferGeometryLoader,a=0,o=e.length;a<o;a++){var s,l=e[a];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new dn[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":// backwards compatible
s=new dn[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new dn[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new dn[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new dn[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new dn[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new dn[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new dn[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new dn[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new dn[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new dn[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new dn[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var c=[],u=0,h=l.shapes.length;u<h;u++){var d=t[l.shapes[u]];c.push(d)}s=new dn[l.type](c,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(c=[],u=0,h=l.shapes.length;u<h;u++){d=t[l.shapes[u]];c.push(d)}var p=l.options.extrudePath;void 0!==p&&(l.options.extrudePath=(new _n[p.type]).fromJSON(p)),s=new dn[l.type](c,l.options);break;case"BufferGeometry":s=i.parse(l);break;case"Geometry":s=r.parse(l,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}s.uuid=l.uuid,void 0!==l.name&&(s.name=l.name),!0===s.isBufferGeometry&&void 0!==l.userData&&(s.userData=l.userData),n[l.uuid]=s}return n},parseMaterials:function(e,t){var n={};if(void 0!==e){var r=new MaterialLoader;r.setTextures(t);for(var i=0,a=e.length;i<a;i++){var o=e[i];if("MultiMaterial"===o.type){for(
// Deprecated
var s=[],l=0;l<o.materials.length;l++)s.push(r.parse(o.materials[l]));n[o.uuid]=s}else n[o.uuid]=r.parse(o)}}return n},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=AnimationClip.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),t.push(i)}return t},parseImages:function(e,t){var n=this,r={};function loadImage(e){return n.manager.itemStart(e),i.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemEnd(e),n.manager.itemError(e)})}if(void 0!==e&&e.length>0){var i=new ImageLoader(new LoadingManager(t));i.setCrossOrigin(this.crossOrigin);for(var a=0,o=e.length;a<o;a++){var s=e[a],l=s.url;if(Array.isArray(l)){
// load array of images e.g CubeTexture
r[s.uuid]=[];for(var c=0,u=l.length;c<u;c++){var h=l[c],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.texturePath+h;r[s.uuid].push(loadImage(d))}}else{
// load single image
d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:n.texturePath+s.url;r[s.uuid]=loadImage(d)}}}return r},parseTextures:function(e,t){function parseConstant(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var r=0,i=e.length;r<i;r++){var a,o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),(a=Array.isArray(t[o.image])?new CubeTexture(t[o.image]):new Texture(t[o.image])).needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=parseConstant(o.mapping,Ln)),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=parseConstant(o.wrap[0],Tn),a.wrapT=parseConstant(o.wrap[1],Tn)),void 0!==o.format&&(a.format=o.format),void 0!==o.minFilter&&(a.minFilter=parseConstant(o.minFilter,An)),void 0!==o.magFilter&&(a.magFilter=parseConstant(o.magFilter,An)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),n[o.uuid]=a}return n},parseObject:function(e,t,n){var r;function getGeometry(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function getMaterial(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var a=e[r];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":r=new DirectionalLight(e.color,e.intensity);break;case"PointLight":r=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var i=getGeometry(e.geometry),a=getMaterial(e.material);r=i.bones&&i.bones.length>0?new SkinnedMesh(i,a):new Mesh(i,a);break;case"LOD":r=new LOD;break;case"Line":r=new Line(getGeometry(e.geometry),getMaterial(e.material),e.mode);break;case"LineLoop":r=new LineLoop(getGeometry(e.geometry),getMaterial(e.material));break;case"LineSegments":r=new LineSegments(getGeometry(e.geometry),getMaterial(e.material));break;case"PointCloud":case"Points":r=new Points(getGeometry(e.geometry),getMaterial(e.material));break;case"Sprite":r=new Sprite(getMaterial(e.material));break;case"Group":r=new Group;break;default:r=new Object3D}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var o=e.children,s=0;s<o.length;s++)r.add(this.parseObject(o[s],t,n));if("LOD"===e.type)for(var l=e.levels,c=0;c<l.length;c++){var u=l[c],h=r.getObjectByProperty("uuid",u.object);void 0!==h&&r.addLevel(h,u.distance)}return r}});var Sn,Ln={UVMapping:se,CubeReflectionMapping:le,CubeRefractionMapping:ce,EquirectangularReflectionMapping:ue,EquirectangularRefractionMapping:he,SphericalReflectionMapping:de,CubeUVReflectionMapping:pe,CubeUVRefractionMapping:fe},Tn={RepeatWrapping:me,ClampToEdgeWrapping:ge,MirroredRepeatWrapping:ve},An={NearestFilter:ye,NearestMipMapNearestFilter:be,NearestMipMapLinearFilter:xe,LinearFilter:_e,LinearMipMapNearestFilter:we,LinearMipMapLinearFilter:Me};
/**
 * @author thespite / http://clicktorelease.com/
 */
function ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:mn,this.options=void 0}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * minimal class for proxing functions to Path. Replaces old "extractSubpaths()"
 **/
function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}
/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author mrdoob / http://mrdoob.com/
 */
function Font(e){this.type="Font",this.data=e}function createPath(e,t,n,r,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,c,u,h,d,p,f=new ShapePath;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":// moveTo
o=m[g++]*t+n,s=m[g++]*t+r,f.moveTo(o,s);break;case"l":// lineTo
o=m[g++]*t+n,s=m[g++]*t+r,f.lineTo(o,s);break;case"q":// quadraticCurveTo
l=m[g++]*t+n,c=m[g++]*t+r,u=m[g++]*t+n,h=m[g++]*t+r,f.quadraticCurveTo(u,h,l,c);break;case"b":// bezierCurveTo
l=m[g++]*t+n,c=m[g++]*t+r,u=m[g++]*t+n,h=m[g++]*t+r,d=m[g++]*t+n,p=m[g++]*t+r,f.bezierCurveTo(u,h,d,p,l,c)}}return{offsetX:a.ha*t,path:f}}}
/**
 * @author mrdoob / http://mrdoob.com/
 */function FontLoader(e){this.manager=void 0!==e?e:mn}ImageBitmapLoader.prototype={constructor:ImageBitmapLoader,setOptions:function setOptions(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=fn.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(n){fn.add(e,n),t&&t(n),i.manager.itemEnd(e)}).catch(function(t){r&&r(t),i.manager.itemEnd(e),i.manager.itemError(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(ShapePath.prototype,{moveTo:function(e,t){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,r){this.currentPath.quadraticCurveTo(e,t,n,r)},bezierCurveTo:function(e,t,n,r,i,a){this.currentPath.bezierCurveTo(e,t,n,r,i,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function toShapesNoHoles(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=new Shape;a.curves=i.curves,t.push(a)}return t}function isPointInsidePolygon(e,t){for(var n=t.length,r=!1,i=n-1,a=0
// inPt on polygon contour => immediate success    or
// toggling of inside/outside at every single! intersection point of an edge
//  with the horizontal line through inPt, left of inPt
//  not counting lowerY endpoints of edges and whole edges on that line
;a<n;i=a++){var o=t[i],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(
// not parallel
c<0&&(o=t[a],l=-l,s=t[i],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0;// inPt is on contour ?
// continue;                // no intersection or edgeLowPt => doesn't count !!!
}else{var u=c*(e.x-o.x)-l*(e.y-o.y);if(0===u)return!0;// inPt is on contour ?
if(u<0)continue;r=!r}}else{
// parallel or collinear
if(e.y!==o.y)continue;// parallel
// edge lies on the same horizontal line as inPt
if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0;// inPt: Point on contour !
// continue;
}}return r}var n=un.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return toShapesNoHoles(r);var i,a,o,s=[];if(1===r.length)return a=r[0],(o=new Shape).curves=a.curves,s.push(o),s;var l=!n(r[0].getPoints());l=e?!l:l;
// console.log("Holes first", holesFirst);
var c,u,h=[],d=[],p=[],f=0;d[f]=void 0,p[f]=[];for(var m=0,g=r.length;m<g;m++)i=n(c=(a=r[m]).getPoints()),(i=e?!i:i)?(!l&&d[f]&&f++,d[f]={s:new Shape,p:c},d[f].s.curves=a.curves,l&&f++,p[f]=[]):p[f].push({h:a,p:c[0]});
// only Holes? -> probably all Shapes with wrong orientation
if(!d[0])return toShapesNoHoles(r);if(d.length>1){for(var v=!1,y=[],b=0,x=d.length;b<x;b++)h[b]=[];for(b=0,x=d.length;b<x;b++)for(var _=p[b],w=0;w<_.length;w++){for(var M=_[w],E=!0,S=0;S<d.length;S++)isPointInsidePolygon(M.p,d[S].p)&&(b!==S&&y.push({froms:b,tos:S,hole:w}),E?(E=!1,h[S].push(M)):v=!0);E&&h[b].push(M)}
// console.log("ambiguous: ", ambiguous);
y.length>0&&(
// console.log("to change: ", toChange);
v||(p=h))}m=0;for(var L=d.length;m<L;m++){o=d[m].s,s.push(o);for(var T=0,A=(u=p[m]).length;T<A;T++)o.holes.push(u[T].h)}
//console.log("shape", shapes);
return s}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],r=function createPaths(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[],s=0,l=0,c=0// see #13988
;c<r.length;c++){var u=r[c];if("\n"===u)s=0,l-=a;else{var h=createPath(u,i,s,l,n);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),i=0,a=r.length;i<a;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}),Object.assign(FontLoader.prototype,{load:function(e,t,n,r){var i=this,a=new FileLoader(this.manager);a.setPath(this.path),a.load(e,function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)},n,r)},parse:function(e){return new Font(e)},setPath:function(e){return this.path=e,this}});var Cn={getContext:function(){return void 0===Sn&&(Sn=new(window.AudioContext||window.webkitAudioContext)),Sn},setContext:function(e){Sn=e}};
/**
 * @author Reece Aaron Lecrivain / http://reecenotes.com/
 */function AudioLoader(e){this.manager=void 0!==e?e:mn}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}
/**
 * Camera for rendering cube maps
 *  - renders scene into axis-aligned cube
 *
 * @author alteredq / http://alteredqualia.com/
 */
function CubeCamera(e,t,n){Object3D.call(this),this.type="CubeCamera";var r=new PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new Vector3(1,0,0)),this.add(r);var i=new PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Vector3(-1,0,0)),this.add(i);var a=new PerspectiveCamera(90,1,e,t);a.up.set(0,0,1),a.lookAt(new Vector3(0,1,0)),this.add(a);var o=new PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new Vector3(0,-1,0)),this.add(o);var s=new PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new Vector3(0,0,1)),this.add(s);var l=new PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l);var c={format:Ve,magFilter:_e,minFilter:_e};this.renderTarget=new WebGLRenderTargetCube(n,n,c),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,a,n),n.activeCubeFace=3,e.render(t,o,n),n.activeCubeFace=4,e.render(t,s,n),n.texture.generateMipmaps=c,n.activeCubeFace=5,e.render(t,l,n),e.setRenderTarget(null)},this.clear=function(e,t,n,r){for(var i=this.renderTarget,a=0;a<6;a++)i.activeCubeFace=a,e.setRenderTarget(i),e.clear(t,n,r);e.setRenderTarget(null)}}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=Cn.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Reece Aaron Lecrivain / http://reecenotes.com/
 */
function Audio(e){Object3D.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function AudioAnalyser(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}
/**
 *
 * Buffered scene graph property that allows weighted accumulation.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function PropertyMixer(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),
// layout: [ incoming | accu0 | accu1 | orig ]
//
// interpolators can use .buffer as their .result
// the data then goes to 'incoming'
//
// 'accu0' and 'accu1' are used frame-interleaved for
// the cumulative result and are compared to detect
// changes
//
// 'orig' stores the original state of the property
this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(AudioLoader.prototype,{load:function(e,t,n,r){var i=new FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){
// Create a copy of the buffer. The `decodeAudioData` method
// detaches the buffer when complete, preventing reuse.
var n=e.slice(0);Cn.getContext().decodeAudioData(n,function(e){t(e)})},n,r)}}),Object.assign(StereoCamera.prototype,{update:function(){var e,t,n,r,i,a,o,s,l=new Matrix4,c=new Matrix4;return function update(u){if(e!==this||t!==u.focus||n!==u.fov||r!==u.aspect*this.aspect||i!==u.near||a!==u.far||o!==u.zoom||s!==this.eyeSep){e=this,t=u.focus,n=u.fov,r=u.aspect*this.aspect,i=u.near,a=u.far,o=u.zoom;
// Off-axis stereoscopic effect based on
// http://paulbourke.net/stereographics/stereorender/
var h,d,p=u.projectionMatrix.clone(),f=(s=this.eyeSep/2)*i/t,m=i*Math.tan(Nt.DEG2RAD*n*.5)/o;
// translate xOffset
c.elements[12]=-s,l.elements[12]=s,
// for left eye
h=-m*r+f,d=m*r+f,p.elements[0]=2*i/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),
// for right eye
h=-m*r-f,d=m*r-f,p.elements[0]=2*i/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()}),CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,n=new Vector3,r=new Vector3;return function updateMatrixWorld(i){Object3D.prototype.updateMatrixWorld.call(this,i);var a=this.context.listener,o=this.up;this.matrixWorld.decompose(e,t,n),r.set(0,0,-1).applyQuaternion(t),a.positionX?(a.positionX.setValueAtTime(e.x,this.context.currentTime),a.positionY.setValueAtTime(e.y,this.context.currentTime),a.positionZ.setValueAtTime(e.z,this.context.currentTime),a.forwardX.setValueAtTime(r.x,this.context.currentTime),a.forwardY.setValueAtTime(r.y,this.context.currentTime),a.forwardZ.setValueAtTime(r.z,this.context.currentTime),a.upX.setValueAtTime(o.x,this.context.currentTime),a.upY.setValueAtTime(o.y,this.context.currentTime),a.upZ.setValueAtTime(o.z,this.context.currentTime)):(a.setPosition(e.x,e.y,e.z),a.setOrientation(r.x,r.y,r.z,o.x,o.y,o.z))}}()}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,n=new Vector3,r=new Vector3;return function updateMatrixWorld(i){Object3D.prototype.updateMatrixWorld.call(this,i);var a=this.panner;this.matrixWorld.decompose(e,t,n),r.set(0,0,1).applyQuaternion(t),a.setPosition(e.x,e.y,e.z),a.setOrientation(r.x,r.y,r.z)}}()}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(PropertyMixer.prototype,{
// accumulate data in the 'incoming' region into 'accu<i>'
accumulate:function(e,t){
// note: happily accumulating nothing when weight = 0, the caller knows
// the weight and shouldn't have made the call in the first place
var n=this.buffer,r=this.valueSize,i=e*r+r,a=this.cumulativeWeight;if(0===a){
// accuN := incoming * weight
for(var o=0;o!==r;++o)n[i+o]=n[o];a=t}else{var s=t/(
// accuN := accuN + incoming * weight
a+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=a},
// apply the state of 'accu<i>' to the binding when accus differ
apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){
// accuN := accuN + original * ( 1 - cumulativeWeight )
var o=3*t;this._mixBufferRegion(n,r,o,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(n[s]!==n[s+t]){
// value has changed -> update scene graph
a.setValue(n,r);break}},
// remember the state of the bound property and copy it to both accus
saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);
// accu[0..1] := orig -- initially detect changes against the original
for(var i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},
// apply the state previously taken via 'saveOriginalState' to the binding
restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},
// mix functions
_select:function(e,t,n,r,i){if(r>=.5)for(var a=0;a!==i;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,r){Quaternion.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*r}}});
/**
 *
 * A reference to a real property in the scene graph.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
// Characters [].:/ are reserved for track binding syntax.
var Pn,In;function Composite(e,t,n){var r=n||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function PropertyBinding(e,t,n){this.path=t,this.parsedPath=n||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}
/**
 *
 * A group of objects that receives a shared animation state.
 *
 * Usage:
 *
 *  -   Add objects you would otherwise pass as 'root' to the
 *      constructor or the .clipAction method of AnimationMixer.
 *
 *  -   Instead pass this object as 'root'.
 *
 *  -   You can also add and remove objects later when the mixer
 *      is running.
 *
 * Note:
 *
 *      Objects of this class appear as one object to the mixer,
 *      so cache control of the individual objects must be done
 *      on the group.
 *
 * Limitation:
 *
 *  -   The animated properties must be compatible among the
 *      all objects in the group.
 *
 *  -   A single property can either be controlled through a
 *      target group or directly, but not both.
 *
 * @author tschw
 */
function AnimationObjectGroup(){this.uuid=Nt.generateUUID(),
// cached objects followed by the active ones
this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;// threshold
// note: read by PropertyBinding.Composite
var e={};this._indicesByUUID=e;// for bookkeeping
for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],// inside: string
this._parsedPaths=[],// inside: { we don't care, here }
this._bindings=[],// inside: Array< PropertyBinding >
this._bindingsIndicesByPath={};// inside: indices in these arrays
var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}
/**
 *
 * Action provided by AnimationMixer for scheduling clip playback on specific
 * objects.
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 *
 */
function AnimationAction(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,a=new Array(i),o={endingStart:xt,endingEnd:xt},s=0;s!==i;++s){var l=r[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,// bound by the mixer
// inside: PropertyMixer (managed by the mixer)
this._propertyBindings=new Array(i),this._cacheIndex=null,// for the memory manager
this._byClipCacheIndex=null,// for the memory manager
this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=mt,this._loopCount=-1,
// global mixer time when the action is to be started
// it's set back to 'null' upon start of the action
this._startTime=null,
// scaled local time of the action
// gets clamped or wrapped to 0..clip.duration according to loop
this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,// no. of repetitions when looping
this.paused=!1,// true -> zero effective time scale
this.enabled=!0,// false -> zero effective weight
this.clampWhenFinished=!1,// keep feeding the last frame?
this.zeroSlopeAtStart=!0,// for smooth interpolation w/o separate
this.zeroSlopeAtEnd=!0}
/**
 *
 * Player for AnimationClips.
 *
 *
 * @author Ben Houston / http://clara.io/
 * @author David Sarno / http://lighthaus.us/
 * @author tschw
 */
function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Uniform(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}
/**
 * @author benaadams / https://twitter.com/ben_a_adams
 */
function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}
/**
 * @author benaadams / https://twitter.com/ben_a_adams
 */
function InstancedInterleavedBuffer(e,t,n){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=n||1}
/**
 * @author benaadams / https://twitter.com/ben_a_adams
 */
function InstancedBufferAttribute(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,n),this.meshPerAttribute=r||1}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author bhouston / http://clara.io/
 * @author stephomi / http://stephaneginier.com/
 */
function Raycaster(e,t,n,r){this.ray=new Ray(e,t),
// direction is assumed to be normalized (for accurate distance calculations)
this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,a=0,o=i.length;a<o;a++)intersectObject(i[a],t,n,!0)}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function Clock(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}
/**
 * @author bhouston / http://clara.io
 * @author WestLangley / http://github.com/WestLangley
 *
 * Ref: https://en.wikipedia.org/wiki/Spherical_coordinate_system
 *
 * The polar angle (phi) is measured from the positive y-axis. The positive y-axis is up.
 * The azimuthal angle (theta) is measured from the positive z-axiz.
 */
function Spherical(e,t,n){// azimuthal angle
return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,// polar angle
this.theta=void 0!==n?n:0,this}
/**
 * @author Mugen87 / https://github.com/Mugen87
 *
 * Ref: https://en.wikipedia.org/wiki/Cylindrical_coordinate_system
 *
 */
function Cylindrical(e,t,n){// height above the x-z plane
return this.radius=void 0!==e?e:1,// distance from the origin to a point in the x-z plane
this.theta=void 0!==t?t:0,// counterclockwise angle in the x-z plane measured in radians from the positive z-axis
this.y=void 0!==n?n:0,this}
/**
 * @author bhouston / http://clara.io
 */
function Box2(e,t){this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}
/**
 * @author bhouston / http://clara.io
 */
function Line3(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}
/**
 * @author alteredq / http://alteredqualia.com/
 */
function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){}}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function VertexNormalsHelper(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==n?n:16711680,a=void 0!==r?r:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);
//
var l=new BufferGeometry,c=new Float32BufferAttribute(2*o*3,3);l.addAttribute("position",c),LineSegments.call(this,l,new LineBasicMaterial({color:i,linewidth:a})),
//
this.matrixAutoUpdate=!1,this.update()}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function SpotLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new BufferGeometry,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;r.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}n.addAttribute("position",new Float32BufferAttribute(r,3));var l=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(n,l),this.add(this.cone),this.update()}function SkeletonHelper(e){for(var t=
/**
 * @author Sean Griffin / http://twitter.com/sgrif
 * @author Michael Guerrero / http://realitymeltdown.com
 * @author mrdoob / http://mrdoob.com/
 * @author ikerr / http://verold.com
 * @author Mugen87 / https://github.com/Mugen87
 */
function getBoneList(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,getBoneList(e.children[n]));return t}(e),n=new BufferGeometry,r=[],i=[],a=new Color(0,0,1),o=new Color(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}n.addAttribute("position",new Float32BufferAttribute(r,3)),n.addAttribute("color",new Float32BufferAttribute(i,3));var c=new LineBasicMaterial({vertexColors:w,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,n,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */
function PointLightHelper(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var r=new SphereBufferGeometry(t,4,2),i=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}
/**
 * @author abelnation / http://github.com/abelnation
 * @author Mugen87 / http://github.com/Mugen87
 * @author WestLangley / http://github.com/WestLangley
 */
function RectAreaLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var n=new LineBasicMaterial({fog:!1}),r=new BufferGeometry;r.addAttribute("position",new BufferAttribute(new Float32Array(15),3)),this.line=new Line(r,n),this.add(this.line),this.update()}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
function HemisphereLightHelper(e,t,n){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new OctahedronBufferGeometry(t);r.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=w);var i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.addAttribute("color",new BufferAttribute(a,3)),this.add(new Mesh(r,this.material)),this.update()}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function GridHelper(e,t,n,r){e=e||10,t=t||10,n=new Color(void 0!==n?n:4473924),r=new Color(void 0!==r?r:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],c=0,u=0,h=-o;c<=t;c++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=c===i?n:r;d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3}var p=new BufferGeometry;p.addAttribute("position",new Float32BufferAttribute(s,3)),p.addAttribute("color",new Float32BufferAttribute(l,3));var f=new LineBasicMaterial({vertexColors:w});LineSegments.call(this,p,f)}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / http://github.com/Mugen87
 * @author Hectate / http://www.github.com/Hectate
 */
function PolarGridHelper(e,t,n,r,i,a){e=e||10,t=t||16,n=n||8,r=r||64,i=new Color(void 0!==i?i:4473924),a=new Color(void 0!==a?a:8947848);var o,s,l,c,u,h,d,p=[],f=[];
// create the radials
for(c=0;c<=t;c++)l=c/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,p.push(0,0,0),p.push(o,0,s),d=1&c?i:a,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);
// create the circles
for(c=0;c<=n;c++)for(d=1&c?i:a,h=e-e/n*c,u=0;u<r;u++)
// first vertex
l=u/r*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b),
// second vertex
l=(u+1)/r*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b);var m=new BufferGeometry;m.addAttribute("position",new Float32BufferAttribute(p,3)),m.addAttribute("color",new Float32BufferAttribute(f,3));var g=new LineBasicMaterial({vertexColors:w});LineSegments.call(this,m,g)}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function FaceNormalsHelper(e,t,n,r){
// FaceNormalsHelper only supports THREE.Geometry
this.object=e,this.size=void 0!==t?t:1;var i=void 0!==n?n:16776960,a=void 0!==r?r:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");
//
var l=new BufferGeometry,c=new Float32BufferAttribute(2*o*3,3);l.addAttribute("position",c),LineSegments.call(this,l,new LineBasicMaterial({color:i,linewidth:a})),
//
this.matrixAutoUpdate=!1,this.update()}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function DirectionalLightHelper(e,t,n){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var r=new BufferGeometry;r.addAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(r,i),this.add(this.lightPlane),(r=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(r,i),this.add(this.targetLine),this.update()}
/**
 * @author alteredq / http://alteredqualia.com/
 * @author Mugen87 / https://github.com/Mugen87
 *
 *  - shows frustum, line of sight and up of the camera
 *  - suitable for fast updates
 *  - based on frustum visualization in lightgl.js shadowmap example
 *      http://evanw.github.com/lightgl.js/tests/shadowmap.html
 */
function CameraHelper(e){var t=new BufferGeometry,n=new LineBasicMaterial({color:16777215,vertexColors:_}),r=[],i=[],a={},o=new Color(16755200),s=new Color(16711680),l=new Color(43775),c=new Color(16777215),u=new Color(3355443);function addLine(e,t,n){addPoint(e,n),addPoint(t,n)}function addPoint(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}
// near
addLine("n1","n2",o),addLine("n2","n4",o),addLine("n4","n3",o),addLine("n3","n1",o),
// far
addLine("f1","f2",o),addLine("f2","f4",o),addLine("f4","f3",o),addLine("f3","f1",o),
// sides
addLine("n1","f1",o),addLine("n2","f2",o),addLine("n3","f3",o),addLine("n4","f4",o),
// cone
addLine("p","n1",s),addLine("p","n2",s),addLine("p","n3",s),addLine("p","n4",s),
// up
addLine("u1","u2",l),addLine("u2","u3",l),addLine("u3","u1",l),
// target
addLine("c","t",c),addLine("p","c",u),
// cross
addLine("cn1","cn2",u),addLine("cn3","cn4",u),addLine("cf1","cf2",u),addLine("cf3","cf4",u),t.addAttribute("position",new Float32BufferAttribute(r,3)),t.addAttribute("color",new Float32BufferAttribute(i,3)),LineSegments.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / http://github.com/Mugen87
 */
function BoxHelper(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new BufferGeometry;i.setIndex(new BufferAttribute(n,1)),i.addAttribute("position",new BufferAttribute(r,3)),LineSegments.call(this,i,new LineBasicMaterial({color:t})),this.matrixAutoUpdate=!1,this.update()}
/**
 * @author WestLangley / http://github.com/WestLangley
 */
function Box3Helper(e,t){this.type="Box3Helper",this.box=e;var n=void 0!==t?t:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new BufferGeometry;i.setIndex(new BufferAttribute(r,1)),i.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,i,new LineBasicMaterial({color:n})),this.geometry.computeBoundingSphere()}
/**
 * @author WestLangley / http://github.com/WestLangley
 */
function PlaneHelper(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==n?n:16776960,i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Line.call(this,i,new LineBasicMaterial({color:r}));
//
var a=new BufferGeometry;a.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Mesh(a,new MeshBasicMaterial({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function ArrowHelper(e,t,n,r,i,a){
// dir is assumed to be normalized
Object3D.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===i&&(i=.2*n),void 0===a&&(a=.2*i),void 0===Pn&&((Pn=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(In=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Line(Pn,new LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(In,new MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}
/**
 * @author sroucheray / http://sroucheray.org/
 * @author mrdoob / http://mrdoob.com/
 */
function AxesHelper(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new BufferGeometry;n.addAttribute("position",new Float32BufferAttribute(t,3)),n.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new LineBasicMaterial({vertexColors:w});LineSegments.call(this,n,r)}
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Face4(e,t,n,r,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(e,t,n,i,a,o)}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();// bind all binding
var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];
// and only call .getValue on the first
void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,n):new PropertyBinding(e,t,n)},
/**
     * Replaces spaces with underscores and removes unsupported characters from
     * node names, to ensure compatibility with parseTrackName().
     *
     * @param  {string} name Node name to be sanitized.
     * @return {string}
     */
sanitizeNodeName:function(){var e=new RegExp("[\\[\\]\\.:\\/]","g");return function sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){
// Attempts to allow node names from any language. ES5's `\w` regexp matches
// only latin characters, and the unicode \p{L} is not yet supported. So
// instead, we exclude reserved characters and match everything else.
var e="[^\\[\\]\\.:\\/]",t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",n=/((?:WC+[\/:])*)/.source.replace("WC",e),r=/(WCOD+)?/.source.replace("WCOD",t),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),a=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),o=new RegExp("^"+n+r+i+a+"$"),s=["material","materials","bones"];return function parseTrackName(e){var t=o.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={
// directoryName: matches[ 1 ], // (tschw) currently unused
nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],// required
propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);
// Object names must be checked against a whitelist. Otherwise, there
// is no way to parse 'foo.bar.baz': 'baz' must be a property, but
// 'bar' could be the objectName, or part of a nodeName (which can
// include '.' characters).
-1!==s.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;
// search into skeleton bones.
if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}
// search into node subtree.
if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var a=r(i.children);if(a)return a}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(PropertyBinding.prototype,{// prototype, continued
// these are used to "bind" a nonexistent property
_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(e,t){e[t]=this.node[this.propertyName]},function getValue_array(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[
// Direct
function setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]},function setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[
// EntireArray
function setValue_array(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function setValue_array_setNeedsUpdate(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[
// ArrayElement
function setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[
// HasToFromArray
function setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)},function setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function getValue_unbound(e,t){this.bind(),this.getValue(e,t)},setValue:function getValue_unbound(e,t){this.bind(),this.setValue(e,t)},
// create getter / setter pair for a property in the scene graph
bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;
// ensure there is a value node
if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),
// set fail state so we can just 'return' on error
this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;
// special cases were we need to reach deeper into the hierarchy to get the face materials....
switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);
// potential future optimization: skip this if propertyIndex is already an integer
// and convert the integer string to a true integer.
e=e.skeleton.bones;
// support resolving morphTarget names into indices.
for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}
// resolve property
var s=e[r];if(void 0!==s){
// determine versioning scheme
var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?// material
l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(// node transform
l=this.Versioning.MatrixWorldNeedsUpdate);
// determine how the property gets bound
var c=this.BindingType.Direct;if(void 0!==i){
// access a sub element of the property array (only primitives are supported right now)
if("morphTargetInfluences"===r){
// potential optimization, skip this if propertyIndex is already an integer, and convert the integer string to a true integer.
// support resolving morphTarget names into indices.
if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(
// must use copy for Object3D.Euler/Quaternion
c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;
// select getter / setter
this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,
// back to the prototype version of getValue / setValue
// note: avoiding to mutate the shape of 'this' via 'delete'
this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(PropertyBinding.prototype,{
// initial state of these methods that calls 'bind'
_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=r[d];if(void 0===p){
// unknown object -> add it to the ACTIVE region
p=t++,r[d]=p,e.push(h);
// accounting is done, now do the same for all bindings
for(var f=0,m=s;f!==m;++f)o[f].push(new PropertyBinding(h,i[f],a[f]))}else if(p<n){l=e[p];
// move existing object to the ACTIVE region
var g=--n,v=e[g];r[v.uuid]=p,e[p]=v,r[d]=g,e[g]=h;
// accounting is done, now do the same for all bindings
for(f=0,m=s;f!==m;++f){var y=o[f],b=y[g],x=y[p];y[p]=b,void 0===x&&(
// since we do not bother to create new bindings
// for objects that are cached, the binding may
// or may not exist
x=new PropertyBinding(h,i[f],a[f])),y[g]=x}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.");// else the object is already where we want it to be
}// for arguments
this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=n[l];if(void 0!==c&&c>=t){
// move existing object into the CACHED region
var u=t++,h=e[u];n[h.uuid]=c,e[c]=h,n[l]=u,e[u]=s;
// accounting is done, now do the same for all bindings
for(var d=0,p=i;d!==p;++d){var f=r[d],m=f[u],g=f[c];f[c]=m,f[u]=g}}}// for arguments
this.nCachedObjects_=t},
// remove & forget
uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,c=r[l];if(void 0!==c)if(delete r[l],c<n){
// object is cached, shrink the CACHED region
var u=--n,h=e[u],d=e[v=--t];
// last cached object takes this object's place
r[h.uuid]=c,e[c]=h,
// last object goes to the activated slot and pop
r[d.uuid]=u,e[u]=d,e.pop();
// accounting is done, now do the same for all bindings
for(var p=0,f=a;p!==f;++p){var m=(y=i[p])[u],g=y[v];y[c]=m,y[u]=g,y.pop()}}else{
// object is active, just swap with the last and pop
var v;r[(d=e[v=--t]).uuid]=c,e[c]=d,e.pop();
// accounting is done, now do the same for all bindings
for(p=0,f=a;p!==f;++p){var y;(y=i[p])[c]=y[v],y.pop()}}// cached or active
// if object is known
}// for arguments
this.nCachedObjects_=n},
// Internal interface used by befriended PropertyBinding.Composite:
subscribe_:function(e,t){
// returns an array of bindings for the given path that is changed
// according to the contained objects in the group
var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,a.push(e),o.push(t),i.push(u);for(var h=c,d=s.length;h!==d;++h){var p=s[h];u[h]=new PropertyBinding(p,e,t)}return u},unsubscribe_:function(e){
// tells the group to forget about a property path and no longer
// update the array previously obtained with 'subscribe_'
var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}),Object.assign(AnimationAction.prototype,{
// State & Scheduling
play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){// forget scheduling
return this.paused=!1,this.enabled=!0,this.time=0,// restart clip
this._loopCount=-1,// forget previous loops
this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},
// return true when play has been called
isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},
// Weight
// set the weight stopping any scheduled fading
// although .enabled = false yields an effective weight of zero, this
// method does *not* change .enabled, because it would be confusing
setEffectiveWeight:function(e){return this.weight=e,
// note: same logic as when updated at runtime
this._effectiveWeight=this.enabled?e:0,this.stopFading()},
// return the weight considering fading and .enabled
getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,a=i/r,o=r/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},
// Time Scale Control
// set the time scale stopping any scheduled warping
// although .paused = true yields an effective time scale of zero, this
// method does *not* change .paused, because it would be confusing
setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},
// return the time scale considering warping and .paused
getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},
// Object Accessors
getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},
// Interna
_update:function(e,t,n,r){
// called by the mixer
if(this.enabled){var i=this._startTime;if(null!==i){
// check for scheduled start of action
var a=(e-i)*n;if(a<0||0===n)return;// yet to come / don't decide when delta = 0
// start
this._startTime=null,// unschedule
t=n*a}
// apply time scale and advance time
t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);
// note: _updateTime may disable the action resulting in
// an effective weight of 0
if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,s)}else
// call ._updateWeight() to update ._effectiveWeight
this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(
// faded out, disable
this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?
// motion has halted, pause
this.paused=!0:
// warp done - apply final time scale
this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,r=this.loop,i=this._loopCount,a=r===gt;if(0===e)return-1===i?t:a&&1==(1&i)?n-t:t;if(r===ft){-1===i&&(
// just started
this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(// repetitive Repeat or PingPong
-1===i&&(
// just started
e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):
// when looping in reverse direction, the initial
// transition through zero counts as a repetition,
// so leave loopCount at -1
this._setEndings(0===this.repetitions,!0,a)),t>=n||t<0){
// wrap around
var o=Math.floor(t/n);// signed
t-=n*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)
// have to stop (switch state, clamp time, fire event)
this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{
// keep running
if(1===s){
// entering the last round
var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&1==(1&i))
// invert time for the "pong round"
return this.time=t,n-t}return this.time=t,t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=_t,r.endingEnd=_t):(
// assuming for LoopOnce atStart == atEnd == true
r.endingStart=e?this.zeroSlopeAtStart?_t:xt:wt,r.endingEnd=t?this.zeroSlopeAtEnd?_t:xt:wt)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==i;++u){var h=r[u],d=h.name,p=c[d];if(void 0!==p)a[u]=p;else{if(void 0!==(p=a[u])){
// existing binding, make sure the cache knows
null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new PropertyMixer(PropertyBinding.create(n,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[u]=p}o[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){
// this action has been forgotten by the cache, but the user
// appears to be still using it -> rebind
var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}
// increment reference counts / sort out state
for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){
// decrement reference counts / sort out state
for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},
// Memory manager
_initMemoryManager:function(){this._actions=[],// 'nActiveActions' followed by inactive ones
this._nActiveActions=0,this._actionsByClip={},
// inside:
// {
//      knownActions: Array< AnimationAction >  - used as prototypes
//      actionByRoot: AnimationAction           - lookup
// }
this._bindings=[],// 'nActiveBindings' followed by inactive ones
this._nActiveBindings=0,this._bindingsByRootAndName={},// inside: Map< name, PropertyMixer >
this._controlInterpolants=[],// same game as above
this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},
// Memory management for AnimationAction objects
_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){
// [ active actions |  inactive actions  ]
// [  active actions >| inactive actions ]
//                 s        a
//                  <-swap->
//                 a        s
var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){
// [  active actions  | inactive actions ]
// [ active actions |< inactive actions  ]
//        a        s
//         <-swap->
//        s        a
var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},
// Memory management for PropertyMixer objects
_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],a=this._bindings;void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i];e:{for(var c in o)break e;// eslint-disable-line no-unused-vars
delete a[r]}},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},
// Memory management of Interpolants for weight and time scale
_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),
// return an action for a clip optionally using a custom root target
// object (this method allocates a lot of dynamic memory in case a
// previously unknown clip/root combination is specified)
clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?AnimationClip.findByName(n,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[r];if(void 0!==l)return l;
// we know the clip, so we don't have to parse all
// the bindings again but can just copy
s=o.knownActions[0],
// also, take the clip from the prototype action
null===i&&(i=s._clip)}
// clip must be known when specified via string
if(null===i)return null;
// allocate all resources required to run it
var c=new AnimationAction(this,i,t);return this._bindAction(c,s),
// and make the action known to the memory manager
this._addInactiveAction(c,a,r),c},
// get an existing action
existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?AnimationClip.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null},
// deactivates all previously scheduled actions
stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},
// advance the time and update apply the animation
update:function(e){e*=this.timeScale;
// run active actions
for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,i,a)}
// update scene graph
var s=this._bindings,l=this._nActiveBindings;for(o=0;o!==l;++o)s[o].apply(a);return this},
// return this mixer's root target object
getRoot:function(){return this._root},
// free all resources specific to a particular clip
uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(
// note: just calling _removeInactiveAction would mess up the
// iteration state and also require updating the state we can
// just throw away
var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},
// free all resources specific to a particular root target object
uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},
// remove a targeted clip from the cache
uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Raycaster.prototype,{linePrecision:1,set:function(e,t){
// direction is assumed to be normalized (for accurate distance calculations)
this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),// set origin in plane of camera
this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var r=n||[];return intersectObject(e,this,r,t),r.sort(ascSort),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,a=e.length;i<a;i++)intersectObject(e[i],this,r,t);return r.sort(ascSort),r}}),Object.assign(Clock.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),// see #10732
this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(Spherical.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},
// restrict phi to be betwee EPS and PI-EPS
makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Nt.clamp(t/this.radius,-1,1))),this}}),Object.assign(Cylindrical.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}}),Object.assign(Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector2;return function setFromCenterAndSize(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){
// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes
return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){
// This can potentially have a divide by zero if the box
// has a size dimension of 0.
return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){
// using 4 splitting planes to rule out intersections
return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector2;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new Vector3,t=new Vector3;return function closestPointToPointParameter(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),a=t.dot(e)/i;return r&&(a=Nt.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Vector3),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0,VertexNormalsHelper.prototype=Object.create(LineSegments.prototype),VertexNormalsHelper.prototype.constructor=VertexNormalsHelper,VertexNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,n=new Matrix3;return function update(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[r[p]]],g=d.vertexNormals[p];e.copy(m).applyMatrix4(i),t.copy(g).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1}else if(o&&o.isBufferGeometry){var v=o.attributes.position,y=o.attributes.normal;
// for simplicity, ignore index and drawcalls, and render every normal
for(c=0,p=0,f=v.count;p<f;p++)e.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1}a.needsUpdate=!0}}(),SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3;return function update(){this.light.updateMatrixWorld();var n=this.light.distance?this.light.distance:1e3,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(){var e=new Vector3,t=new Matrix4,n=new Matrix4;return function updateMatrixWorld(r){var i=this.bones,a=this.geometry,o=a.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<i.length;s++){var c=i[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(n,c.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(n,c.parent.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l+1,e.x,e.y,e.z),l+=2)}a.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,r)}}(),PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)
/*
    var d = this.light.distance;

    if ( d === 0.0 ) {

        this.lightDistance.visible = false;

    } else {

        this.lightDistance.visible = true;
        this.lightDistance.scale.set( d, d, d );

    }
    */},RectAreaLightHelper.prototype=Object.create(Object3D.prototype),RectAreaLightHelper.prototype.constructor=RectAreaLightHelper,RectAreaLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},RectAreaLightHelper.prototype.update=function(){
// calculate new dimensions of the helper
var e=.5*this.light.width,t=.5*this.light.height,n=this.line.geometry.attributes.position,r=n.array;
// update vertices
r[0]=e,r[1]=-t,r[2]=0,r[3]=e,r[4]=t,r[5]=0,r[6]=-e,r[7]=t,r[8]=0,r[9]=-e,r[10]=-t,r[11]=0,r[12]=e,r[13]=-t,r[14]=0,n.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var e=new Vector3,t=new Color,n=new Color;return function update(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=r.geometry.getAttribute("color");t.copy(this.light.color),n.copy(this.light.groundColor);for(var a=0,o=i.count;a<o;a++){var s=a<o/2?t:n;i.setXYZ(a,s.r,s.g,s.b)}i.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),GridHelper.prototype=Object.create(LineSegments.prototype),GridHelper.prototype.constructor=GridHelper,PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper,FaceNormalsHelper.prototype=Object.create(LineSegments.prototype),FaceNormalsHelper.prototype.constructor=FaceNormalsHelper,FaceNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,n=new Matrix3;return function update(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,i=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],d=h.normal;e.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(r),t.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function update(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(n),this.targetLine.scale.z=n.length()}}(),CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var e,t,n=new Vector3,r=new Camera;function setPoint(i,a,o,s){n.set(a,o,s).unproject(r);var l=t[i];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],n.x,n.y,n.z)}return function update(){e=this.geometry,t=this.pointMap;
// we need just camera projection matrix
// world matrix must be identity
r.projectionMatrix.copy(this.camera.projectionMatrix),
// center / target
setPoint("c",0,0,-1),setPoint("t",0,0,1),
// near
setPoint("n1",-1,-1,-1),setPoint("n2",1,-1,-1),setPoint("n3",-1,1,-1),setPoint("n4",1,1,-1),
// far
setPoint("f1",-1,-1,1),setPoint("f2",1,-1,1),setPoint("f3",-1,1,1),setPoint("f4",1,1,1),
// up
setPoint("u1",.7,1.1,-1),setPoint("u2",-.7,1.1,-1),setPoint("u3",0,2,-1),
// cross
setPoint("cf1",-1,0,1),setPoint("cf2",1,0,1),setPoint("cf3",0,-1,1),setPoint("cf4",0,1,1),setPoint("cn1",-1,0,-1),setPoint("cn2",1,0,-1),setPoint("cn3",0,-1,-1),setPoint("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(){var e=new Box3;return function update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var n=e.min,r=e.max,i=this.geometry.attributes.position,a=i.array;a[0]=r.x,a[1]=r.y,a[2]=r.z,a[3]=n.x,a[4]=r.y,a[5]=r.z,a[6]=n.x,a[7]=n.y,a[8]=r.z,a[9]=r.x,a[10]=n.y,a[11]=r.z,a[12]=r.x,a[13]=r.y,a[14]=n.z,a[15]=n.x,a[16]=r.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=r.x,a[22]=n.y,a[23]=n.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),BoxHelper.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,e))},PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),// sign does not matter
this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?m:f,// renderer flips side when determinant < 0; flipping not wanted here
this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,e)},ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=function(){var e,t=new Vector3;return function setDirection(n){
// dir is assumed to be normalized
n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper;var On=0,Bn=1;function MeshFaceMaterial(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function MultiMaterial(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function PointCloud(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)}function Particle(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)}function ParticleSystem(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)}function PointCloudMaterial(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleBasicMaterial(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleSystemMaterial(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function Vertex(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,n)}
//
function DynamicBufferAttribute(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new BufferAttribute(e,t).setDynamic(!0)}function Int8Attribute(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)}function Uint8Attribute(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)}function Uint8ClampedAttribute(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)}function Int16Attribute(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)}function Uint16Attribute(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)}function Int32Attribute(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)}function Uint32Attribute(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)}function Float32Attribute(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)}function Float64Attribute(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)}
//
//
function ClosedSplineCurve3(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom",this.closed=!0}
//
function SplineCurve3(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}
//
function Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}
//
function AxisHelper(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function BoundingBoxHelper(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function EdgesHelper(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function WireframeHelper(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}
//
function XHRLoader(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)}function BinaryTextureLoader(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(e)}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},
//
Object.assign(CurvePath.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");
// generate geometry from path points (for Line or Points objects)
var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");
// generate geometry from equidistant sampling along the path
var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Geometry,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new Vector3(i.x,i.y,i.z||0))}return t}}),
//
Object.assign(Path.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),En.extractUrlBase(e)}}),Object.assign(JSONLoader.prototype,{setTexturePath:function(e){return console.warn("THREE.JSONLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),
//
Object.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Nt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Nt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Nt.ceilPowerOfTwo(e)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e/*, offset, length */){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function getPosition(){return void 0===e&&(e=new Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e/*, offset, length */){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,a)}}),Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Triangle,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,n,r)}}),Object.assign(Shape.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}}),Object.assign(Vector2.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),
//
Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),
//
PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},
//
Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),
//
Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),
//
Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),
//
Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),
//
Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===y}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),
//
Object.assign(WebGLRenderer.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),
//
Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),
//
Object.defineProperties(WebVRManager.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),
//
Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new AudioLoader).load(e,function(e){t.setBuffer(e)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},
//
CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};
//
var Rn={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};
//
function Projector(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}
//
function CanvasRenderer(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}
//
Ut.crossOrigin=void 0,Ut.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new TextureLoader;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},Ut.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new CubeTextureLoader;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},Ut.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ut.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Gn={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};
//
function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}
/***/},
/* 2 */
/***/function(e,t,n){"use strict";
/* harmony export (binding) */n.d(t,"B",function(){return r}),
/* harmony export (binding) */n.d(t,"k",function(){return i}),
/* harmony export (binding) */n.d(t,"s",function(){return a}),
/* harmony export (binding) */n.d(t,"p",function(){return o}),
/* harmony export (binding) */n.d(t,"q",function(){return s}),
/* harmony export (binding) */n.d(t,"w",function(){return l}),
/* harmony export (binding) */n.d(t,"E",function(){return c}),
/* harmony export (binding) */n.d(t,"F",function(){return u}),
/* harmony export (binding) */n.d(t,"A",function(){return h}),
/* harmony export (binding) */n.d(t,"z",function(){return d}),
/* harmony export (binding) */n.d(t,"j",function(){return p}),
/* harmony export (binding) */n.d(t,"c",function(){return f}),
/* harmony export (binding) */n.d(t,"b",function(){return m}),
/* harmony export (binding) */n.d(t,"t",function(){return g}),
/* harmony export (binding) */n.d(t,"x",function(){return v}),
/* harmony export (binding) */n.d(t,"r",function(){return y}),
/* harmony export (binding) */n.d(t,"y",function(){return b}),
/* harmony export (binding) */n.d(t,"o",function(){return x}),
/* harmony export (binding) */n.d(t,"g",function(){return _}),
/* harmony export (binding) */n.d(t,"i",function(){return w}),
/* harmony export (binding) */n.d(t,"C",function(){return M}),
/* harmony export (binding) */n.d(t,"d",function(){return E}),
/* harmony export (binding) */n.d(t,"D",function(){return S}),
/* harmony export (binding) */n.d(t,"a",function(){return L}),
/* harmony export (binding) */n.d(t,"u",function(){return T}),
/* harmony export (binding) */n.d(t,"v",function(){return A}),
/* harmony export (binding) */n.d(t,"l",function(){return C}),
/* harmony export (binding) */n.d(t,"m",function(){return P}),
/* harmony export (binding) */n.d(t,"n",function(){return I}),
/* harmony export (binding) */n.d(t,"h",function(){return O}),
/* harmony export (binding) */n.d(t,"e",function(){return B}),
/* harmony export (binding) */n.d(t,"f",function(){return R});var r={TEXT:0,IMAGE:1},i={Layer1:1,Layer2:2,Layer3:3},a={Precise:0,Imprecise:1},o={None:0,Radius:1,Distance:2,Length:3,Angle:4,Volume:5,Area:6,Curvature:7,BoundingBox:8,PointDistance:9},s={None:"None",Radius:"Radius",MinorRadius:"Minor Radius",MajorRadius:"Major Radius",MinimumRadius:"Minimum Radius",Distance:"Distance",MinimumDistance:"Minimum Distance",Length:"Length",Angle:"Angle",Volume:"Volume",Area:"Area",Curvature:"Curvature",BoundingBox:"Bounding Box",BBoxMinimum:"Minimum Bounding Box",BBoxMaximum:"Maximum Bounding Box",BBoxCenter:"Center Bounding Box",PointDistance:"Point-to-Point Distance"},l={VISIBILITY:"visibilityChanged",SELECTION:"selectionChanged"},c={UNKNOWN:0,MICROMETER:1,MILLIMETER:2,CENTIMETER:3,DECIMETER:4,METER:5,KILOMETER:6,INCH:7,FEET:8,YARD:9,MILE:10,MIL:11},u={UNKNOWN:"",MICROMETER:"Î¼m",MILLIMETER:"mm",CENTIMETER:"cm",DECIMETER:"dm",METER:"m",KILOMETER:"km",INCH:"in",FEET:"ft",YARD:"yd",MILE:"mi",MIL:"mil"},h={Points:0,Line:1,LineSegments:2,LineStrip:3,Mesh:4,Container:5,WideLine:6},d={OFF:0,POSITIVE:1,NEGATIVE:2,BOTH:3},p={Distance:0,Volume:1,Radial:2},f={PERSPECTIVE:0,ORTHOGRAPHIC:1},m={PRE:0,POST:1,BOTH:2},g={CONTEXT:0,ROTATE:1,PAN:2,ZOOM:3,ZOOMAREA:4},v={FREE:0,PART:1,FACE:2,EDGE:4,VERTEX:8,PMI:16,BODY:32,DIMENSION:64,POINT:128},y={Radius:6,Distance:14,Length:4,Angle:6,Volume:33,Area:2,BoundingBox:33,Point:128},b={PART:0,PMI:1},x={ShinyMetal:0,DullMetal:1,ShinyPlastic:2,DullPlastic:3,Crystal:4},_={Shaded:0,Outline:1,Visible:2,Hidden:3,Wireframe:4},w={Selection:"Selection",Highlighting:"Highlighting",pickingOverride:"pickingOverride",visibilityChanged:"visibilityChanged",loadChanged:"loadChanged",MouseDown:"MouseDown",MouseMove:"MouseMove",MouseUp:"MouseUp",cameraChanged:"cameraChanged"},M={NEGATIVE_X:0,X:1,NEGATIVE_Y:2,Y:3,NEGATIVE_Z:4,Z:5,NEGATIVE_ISOMETRIC:6,ISOMETRIC:7,TRIMETRIC:8,ISOMETRIC_2:9,ISOMETRIC_3:10,ISOMETRIC_4:11},E={Off:0,Positive:1,Negative:2,Both:3},S={None:0,Some:1,All:2},L={UNITS:1,BOUNDING_BOX:2,LOCAL_MATRIX:3,WORLD_MATRIX:4,VISIBILITY:5,SELECTION:6,PMI_ASSOCIATIONS:7,GEOMETRY_COUNT:8,MATERIALS:9},T={ROTATE:0,PAN:1,ZOOM:2,ZOOMAREA:5,FITALL:6},A={LMB:1,MMB:2,RMB:4,ALT:8,CTRL:16,SHIFT:32,DBLCLK:64},C={Select:0,Line:1,Freehand:2,Ellipse:3,Rect:4,Text:5,AnchoredText:6,None:99},P={SelectColor:1,EditColor:2,LineColor:3,LineWidth:5,LineOpacity:6,FreehandColor:7,FreehandWidth:9,FreehandOpacity:10,FillColor:11,FillOpacity:13,EdgeColor:14,EdgeWidth:16,EdgeOpacity:17,FontColor:18,FontName:20,FontSize:21},I={Selected:0,Deselected:1,Editing:2},O={Viewer:0,Navigation:1,AreaSelect:2};const B={unknown:-1,isLoading:0,visibleAndLoaded:1,hiddenAndLoaded:2,unloaded:3},R=Object.freeze({setDirty:1,dataRequest:2,init:3,dataResponse:4,assignLayers:5,doneDirtyObjects:6})},
/* 3 */
/***/function(e,t,n){"use strict";
/* harmony export (binding) */n.d(t,"a",function(){return c});
/* harmony import */var r=n(140),i=n(4),a=/* */n.n(i),o=a()("PLMVisWeb:debug:StringTable"),s=a()("PLMVisWeb:error:StringTable");s.enabled=!0;var l=a()("PLMVisWeb:warning:StringTable"),c={EN:"EN",DE:"DE"},u=c.EN,h="localization/",d=r,p=function(){};p.prototype={constructor:p,getStringByName:function(e){return d[e]}},Object.defineProperties(p.prototype,{stringsByLabel:{enumerable:!0,get:function(){return d}}}),p.prototype.clearStringTable=function(){for(var e=Object.keys(d),t=0,n=e.length;t<n;++t)delete d[e[t]]},p.prototype.setLocale=function(e,t,n){t=t||function(){},n=void 0===n||n,c.hasOwnProperty(e)&&(u=e,n&&this.loadStringTable(t))},p.prototype.setLocalePath=function(e,t,n){n=void 0===n||n,h=e+("/"!==e.charAt(e.length-1)?"/":""),n&&this.loadStringTable(t)},p.prototype.loadStringTable=function(e){e=e||function(){};var t=h+"plmvisweb_{locale}.json".replace("{locale}",u),n=new XMLHttpRequest;n.open("GET",t),n.responseType="text",n.onload=function(){void 0!==n.response?null==n.response||0===n.response.length||200!==n.status&&0!==n.status?(l("Failed to retreive localization file. (%d)",n.status),e(!1)):(this.clearStringTable(),d=JSON.parse(n.response),n=null,e(!0)):(l("Failed to retrieve localization file. (%d)",n.status),e(!1))}.bind(this),n.onerror=function(){s("Failed to retrieve localization file. (%d)",n.status),e(!1)},n.send(null)};var f=new p;o("_stringTable",f),/* harmony default export */t.b=f},
/* 4 */
/***/function(e,t,n){
/* WEBPACK VAR INJECTION */(function(r){/* eslint-env browser */
/**
 * This is the web browser implementation of `debug()`.
 */
t.log=
/**
 * Invokes `console.log()` when available.
 * No-op when `console.log` is not a "function".
 *
 * @api public
 */
function log(...e){
// This hackery is required for IE8/9, where
// the `console.log` function doesn't have 'apply'
return"object"==typeof console&&console.log&&console.log(...e)}
/**
 * Save `namespaces`.
 *
 * @param {String} namespaces
 * @api private
 */,t.formatArgs=
/**
 * Colorize log arguments if enabled.
 *
 * @api public
 */
function formatArgs(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");
// The final "%c" is somewhat tricky, because there could be other
// arguments passed either before or after the %c, so we need to
// figure out the correct index to insert the CSS into
let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&"%c"===e&&(
// We only are interested in the *last* %c
// (the user may have provided their own)
i=++r)}),t.splice(i,0,n)},t.save=function save(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){
// Swallow
// XXX (@Qix-) should we be logging these?
}}
/**
 * Load `namespaces`.
 *
 * @return {String} returns the previously persisted debug modes
 * @api private
 */,t.load=function load(){let e;try{e=t.storage.getItem("debug")}catch(e){
// Swallow
// XXX (@Qix-) should we be logging these?
}
// If debug isn't set in LS, and we're in Electron, try to load $DEBUG
!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e}
/**
 * Localstorage attempts to return the localstorage.
 *
 * This is necessary because safari throws
 * when a user disables cookies/localstorage
 * and you attempt to access it.
 *
 * @return {LocalStorage}
 * @api private
 */,t.useColors=
/**
 * Currently only WebKit-based Web Inspectors, Firefox >= v31,
 * and the Firebug extension (any Firefox version) are known
 * to support "%c" CSS customizations.
 *
 * TODO: add a `localStorage` variable to explicitly enable/disable colors
 */
// eslint-disable-next-line complexity
function useColors(){
// NB: In an Electron preload script, document will be defined but not fully
// initialized. Since we know we're in Chrome, we'll just detect this case
// explicitly
if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;
// Internet Explorer and Edge do not support colors.
if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;
// Is webkit? http://stackoverflow.com/a/16459606/376773
// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632
return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||
// Is firebug? http://stackoverflow.com/a/398120/376773
"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||
// Is firefox >= v31?
// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages
"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||
// Double check webkit in userAgent just in case we are in a worker
"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function localstorage(){try{
// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context
// The Browser also has localStorage in the global context.
return localStorage}catch(e){
// Swallow
// XXX (@Qix-) should we be logging these?
}}(),
/**
 * Colors.
 */
t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(144)(t);const{formatters:i}=e.exports;
/**
 * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.
 */i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(145))
/***/},
/* 5 */
/***/function(e,t,n){"use strict";
/* unused harmony export UniformsLib */
/* harmony export (binding) */n.d(t,"a",function(){return i}),
/* harmony export (binding) */n.d(t,"c",function(){return a});
/* harmony import */var r=n(1);
/* harmony reexport (safe) */n.d(t,"b",function(){return r.ShaderChunk});new r.Color(0),new r.Color(1118481),new r.Vector3(1,1,1);r.ShaderChunk.PLMVisWeb_common_pars_vertex=["#if defined( INSTANCING )","   attribute vec4 instanceModelMatrixColumn0;","   attribute vec4 instanceModelMatrixColumn1;","   attribute vec4 instanceModelMatrixColumn2;","   attribute vec4 instanceModelMatrixColumn3;","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_color_pars_vertex=["#if defined( INSTANCING )","   #if defined( USE_COLOR )","       attribute vec3 vertexColor;","       attribute float overrideColor;","   #else","       attribute vec3 aColor;","       varying vec3 diffuse;","   #endif","#else","   #if defined( USE_COLOR )","       uniform vec3 vertexColor;","       uniform float overrideColor;","   #endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_colors_pars_vertex=["#if defined( INSTANCING )","   #if defined( USE_COLOR )","       attribute vec3 vertexColor;","       attribute float overrideColor;","   #else","       attribute vec3 aDiffuse;","       attribute vec3 aEmissive;","       attribute vec3 aSpecular;","       attribute float aShininess;","       attribute float aOpacity;","       attribute float aUseMap;","       varying vec3 diffuse;","       varying vec3 emissive;","       varying vec3 specular;","       varying float shininess;","       varying float opacity;","       varying float useMap;","   #endif","#else","   #if defined( USE_COLOR )","       uniform vec3 vertexColor;","       uniform float overrideColor;","   #endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_common_pars_fragment=["#if defined ( USE_COLOR)","   uniform vec3 diffuse;","   uniform vec3 emissive;","   uniform vec3 specular;","   uniform float shininess;","   uniform float opacity;","#else","   #if defined( INSTANCING )","       varying vec3 diffuse;","       varying vec3 emissive;","       varying vec3 specular;","       varying float shininess;","       varying float opacity;","       varying float useMap;","   #else","       uniform vec3 diffuse;","       uniform vec3 emissive;","       uniform vec3 specular;","       uniform float shininess;","       uniform float opacity;","   #endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_phong=["varying vec3 diffuse;","varying vec3 emissive;","varying vec3 specular;","varying float shininess;","varying float opacity;"].join("\n"),r.ShaderChunk.PLMVisWeb_instance_matrix=["#if defined( INSTANCING )","   mat4 instanceModelMatrix = mat4(instanceModelMatrixColumn0, instanceModelMatrixColumn1, instanceModelMatrixColumn2, instanceModelMatrixColumn3);","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_clipping_planes_pars_fragment=["#if NUM_CLIPPING_PLANES > 0","#if ! defined( PHYSICAL ) && ! defined( PHONG )","varying vec3 vViewPosition;","varying vec3 projectedPositions[ NUM_CLIPPING_PLANES ];","#endif","uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];","uniform float clippingSides[ NUM_CLIPPING_PLANES ];","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_clipping_planes_fragment=["#if NUM_CLIPPING_PLANES > 0","for (int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {","   vec4 plane = clippingPlanes[ i ];","   float side = clippingSides[ i ];","   if ( side == 1.0 ) {","       if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;","   }","   if ( side == 2.0 ) {","       if ( dot( vViewPosition, plane.xyz ) < plane.w ) discard;","   }","}","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_beginnormal_vertex=["#if defined( INSTANCING )","   vec4 tempNormal = instanceModelMatrix * vec4( normal, 0);","   vec3 objectNormal = tempNormal.xyz;","#else","   vec3 objectNormal = vec3(normal);","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_pass_colors=["#ifndef USE_COLOR","   #if defined( INSTANCING )","       diffuse = aDiffuse;","       emissive = aEmissive;","       specular = aSpecular;","       shininess = aShininess;","       opacity = aOpacity;","       useMap = aUseMap;","   #endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_pass_color=["#if defined( INSTANCING ) && !defined( USE_COLOR )","   diffuse = aColor;","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_begin_vertex=["#if defined( INSTANCING )","   vec4 tempPosition = instanceModelMatrix * vec4(position, 1);","   vec3 transformed = tempPosition.xyz;","#else","   vec3 transformed = vec3(position);","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_line_project_vertex=["#ifdef USE_SKINNING","   vec4 mPosition = modelMatrix * skinned;","#else","   vec4 mPosition = modelMatrix * vec4( transformed, 1.0 );","#endif","vec3 mcNormal = normalize( cameraPosition - mPosition.xyz );","vec4 mNormal = modelMatrix * vec4( objectNormal, 0.0 );","float offsetDist = dot( mNormal.xyz, mcNormal );","offsetDist = offsetDist == 0.0 ? pixelTolerance : pixelTolerance * abs(offsetDist) / offsetDist;","vec4 mvPosition = viewMatrix * vec4( mPosition.xyz + mcNormal * pixelTolerance, 1.0 );","gl_Position = projectionMatrix * mvPosition;"].join("\n"),r.ShaderChunk.PLMVisWeb_map_fragment=["#ifdef USE_MAP","#ifdef INSTANCING","if(useMap > 0.0) {","vec4 texelColor = texture2D( map, vUv );","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","}","#else","vec4 texelColor = texture2D( map, vUv );","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_color_vertex=["#ifdef USE_COLOR","if (overrideColor < 1.0) {","vColor.xyz = color.xyz;","} else {","vColor.xyz = vertexColor.xyz;","}","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_meshphong_vert=["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif","#include <PLMVisWeb_common_pars_vertex>","#include <PLMVisWeb_colors_pars_vertex>","#include <common>","#include <uv_pars_vertex>","#include <uv2_pars_vertex>","#include <displacementmap_pars_vertex>","#include <PLMVisWeb_envmap_pars_vertex>","#include <color_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","void main() {","#include <PLMVisWeb_pass_envmap>","#include <PLMVisWeb_instance_matrix>","#include <uv_vertex>","#include <uv2_vertex>","#include <PLMVisWeb_color_vertex>","#include <PLMVisWeb_beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","   vNormal = normalize( transformedNormal );","#endif","#include <PLMVisWeb_pass_colors>","#include <PLMVisWeb_begin_vertex>","#include <displacementmap_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","   vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <PLMVisWeb_envmap_vertex>","#include <shadowmap_vertex>","}"].join("\n"),r.ShaderChunk.PLMVisWeb_pass_envmap=["#if defined( INSTANCING ) && defined( USE_ENVMAP )","   hasEnvMap = aHasEnvMap;","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_envmap_pars_fragment=["#if defined( USE_ENVMAP ) || defined( PHYSICAL )","\tuniform float reflectivity;","\tuniform float envMapIntenstiy;","#endif","#if defined( USE_ENVMAP )","#if defined( INSTANCING )","   varying float hasEnvMap;","#endif","\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )","\t\tvarying vec3 vWorldPosition;","\t#endif","\t#ifdef ENVMAP_TYPE_CUBE","\t\tuniform samplerCube envMap;","\t#else","\t\tuniform sampler2D envMap;","\t#endif","\tuniform float flipEnvMap;","\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )","\t\tuniform float refractionRatio;","\t#else","\t\tvarying vec3 vReflect;","\t#endif","\t#if defined( ENVMAP_TYPE_CUBE ) || defined( ENVMAP_TYPE_EQUIRECT ) || defined( ENVMAP_TYPE_SPHERE )","\t\tuniform vec4 blendColor;","\t#endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_envmap_fragment=["#if defined( USE_ENVMAP )","#if defined( INSTANCING )","if (hasEnvMap > 0.0){","#endif","\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )","\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","\t\t// Transforming Normal Vectors with the Inverse Transformation","\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\t\t#ifdef ENVMAP_MODE_REFLECTION","\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );","\t\t#else","\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );","\t\t#endif","\t#else","\t\tvec3 reflectVec = vReflect;","\t#endif","\t#ifdef DOUBLE_SIDED","\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\t#else","\t\tfloat flipNormal = 1.0;","\t#endif","\t#ifdef ENVMAP_TYPE_CUBE","\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","\t#elif defined( ENVMAP_TYPE_EQUIREC )","\t\tvec2 sampleUV;","\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );","\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;","\t\tvec4 envColor = texture2D( envMap, sampleUV );","\t#elif defined( ENVMAP_TYPE_SPHERE )","\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));","\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );","\t#endif","\tenvColor = envMapTexelToLinear( envColor );","\t#ifdef ENVMAP_BLENDING_DM_NONE","\t\t//outgoingLight += envColor.xyz * specularStrength * reflectivity;","\t#elif defined( ENVMAP_BLENDING_DM_DECAL )","\t\toutgoingLight.rgb = mix(outgoingLight.rgb, envColor.rgb, envColor.a);","\t#elif defined( ENVMAP_BLENDING_DM_MODULATE )","\t\toutgoingLight = outgoingLight * envColor.rgb;","\t#elif defined( ENVMAP_BLENDING_DM_REPLACE )","\t\toutgoingLight = envColor.rgb;","\t#elif defined( ENVMAP_BLENDING_DM_BLEND )","\t\toutgoingLight = mix( outgoingLight.rgb, blendColor.rgb, envColor.rgb );","\t#elif defined( ENVMAP_BLENDING_DM_ADD )","\t\toutgoingLight.rgb = outgoingLight.rgb + envColor.rgb;","\t#elif defined( ENVMAP_BLENDING_DM_COMBINE )","\t\toutgoingLight += envColor.xyz * reflectivity;","\t#elif defined( ENVMAP_BLENDING_MULTIPLY )","\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );","\t#elif defined( ENVMAP_BLENDING_MIX )","\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );","\t#elif defined( ENVMAP_BLENDING_ADD )","\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;","\t#endif","#if defined( INSTANCING )","}","#endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_envmap_pars_vertex=["#if defined( USE_ENVMAP )","#if defined( INSTANCING )","attribute float aHasEnvMap;","varying float hasEnvMap;","#endif","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )","varying vec3 vWorldPosition;","#else","varying vec3 vReflect;","uniform float refractionRatio;","#endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_envmap_vertex=["#ifdef USE_ENVMAP","\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )","\t\tvWorldPosition = worldPosition.xyz;","\t#else","\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );","\t\t#ifdef ENVMAP_MODE_REFLECTION","\t\t\tvReflect = reflect( cameraToVertex, worldNormal );","\t\t#else","\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );","\t\t#endif","\t#endif","#endif"].join("\n"),r.ShaderChunk.PLMVisWeb_meshphong_frag=["#define PHONG","#include <PLMVisWeb_common_pars_fragment>","#include <common>","#include <packing>","#include <color_pars_fragment>","#include <uv_pars_fragment>","#include <uv2_pars_fragment>","#include <map_pars_fragment>","#include <alphamap_pars_fragment>","#include <aomap_pars_fragment>","#include <lightmap_pars_fragment>","#include <emissivemap_pars_fragment>","#include <PLMVisWeb_envmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>","#include <specularmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <PLMVisWeb_clipping_planes_pars_fragment>","void main() {","#include <PLMVisWeb_clipping_planes_fragment>","   vec4 diffuseColor = vec4( diffuse, opacity );","   ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","   vec3 totalEmissiveRadiance = emissive;","#include <logdepthbuf_fragment>","#include <PLMVisWeb_map_fragment>","#include <color_fragment>","#include <alphamap_fragment>","#include <alphatest_fragment>","#include <specularmap_fragment>","#include <normal_fragment_begin>","#include <normal_fragment_maps>","#include <emissivemap_fragment>","#include <lights_phong_fragment>","#include <lights_fragment_begin>","#include <lights_fragment_maps>","#include <lights_fragment_end>","#include <aomap_fragment>","   vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;","#include <PLMVisWeb_envmap_fragment>","   gl_FragColor = vec4( outgoingLight, diffuseColor.a );","#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","}"].join("\n"),r.ShaderChunk.PLMVisWeb_meshbasic_vert=["#include <PLMVisWeb_common_pars_vertex>","#include <PLMVisWeb_color_pars_vertex>","#include <common>","#include <uv_pars_vertex>","#include <uv2_pars_vertex>","#include <PLMVisWeb_envmap_pars_vertex>","#include <color_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float pixelTolerance;","void main() {","\t#include <PLMVisWeb_pass_envmap>","   #include <PLMVisWeb_instance_matrix>","   #include <uv_vertex>","   #include <uv2_vertex>","   #include <PLMVisWeb_color_vertex>","   #include <PLMVisWeb_beginnormal_vertex>","   #include <skinbase_vertex>","   #ifdef USE_ENVMAP","   #include <beginnormal_vertex>","   #include <morphnormal_vertex>","   #include <skinnormal_vertex>","   #include <defaultnormal_vertex>","   #endif","   #include <PLMVisWeb_pass_color>","   #include <PLMVisWeb_begin_vertex>","   #include <morphtarget_vertex>","   #include <skinning_vertex>","   #include <PLMVisWeb_line_project_vertex>","   #include <logdepthbuf_vertex>","   #include <worldpos_vertex>","   #include <clipping_planes_vertex>","   #include <PLMVisWeb_envmap_vertex>","}"].join("\n"),r.ShaderChunk.PLMVisWeb_meshbasic_frag=["#if defined( INSTANCING )","   varying vec3 diffuse;","#else","   uniform vec3 diffuse;","#endif","   uniform float opacity;","#ifndef FLAT_SHADED","   varying vec3 vNormal;","#endif","#include <common>","#include <color_pars_fragment>","#include <uv_pars_fragment>","#include <uv2_pars_fragment>","#include <map_pars_fragment>","#include <alphamap_pars_fragment>","#include <aomap_pars_fragment>","#include <PLMVisWeb_envmap_pars_fragment>","#include <fog_pars_fragment>","#include <specularmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <PLMVisWeb_clipping_planes_pars_fragment>","void main() {","\tif ( distance(diffuse.rgb, vec3(-1.0, -1.0, -1.0)) < 0.000001 ) {","\t\tdiscard;","\t}"," \telse {","   \t#include <PLMVisWeb_clipping_planes_fragment>","       vec4 diffuseColor = vec4( diffuse, opacity );","   \t#include <logdepthbuf_fragment>","   \t#include <map_fragment>","   \t#include <color_fragment>","   \t#include <alphamap_fragment>","   \t#include <alphatest_fragment>","   \t#include <specularmap_fragment>","       \tReflectedLight reflectedLight;","       \treflectedLight.directDiffuse = vec3( 0.0 );","       \treflectedLight.directSpecular = vec3( 0.0 );","       \treflectedLight.indirectDiffuse = diffuseColor.rgb;","       \treflectedLight.indirectSpecular = vec3( 0.0 );","   \t#include <aomap_fragment>","       \tvec3 outgoingLight = reflectedLight.indirectDiffuse;","   \t#include <PLMVisWeb_envmap_fragment>","\t\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","   \t#include <premultiplied_alpha_fragment>","   \t#include <tonemapping_fragment>","   \t#include <encodings_fragment>","   \t#include <fog_fragment>","\t}","}"].join("\n"),r.ShaderChunk.PLMVisWeb_hiddenLine_vert=["#include <PLMVisWeb_common_pars_vertex>","#include <common>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float pixelTolerance;","void main() {","   #include <PLMVisWeb_instance_matrix>","   #include <PLMVisWeb_beginnormal_vertex>","   #include <PLMVisWeb_begin_vertex>","   #include <PLMVisWeb_line_project_vertex>","   #include <logdepthbuf_vertex>","   #include <worldpos_vertex>","   #include <clipping_planes_vertex>","}"].join("\n"),r.ShaderChunk.PLMVisWeb_hiddenLine_frag=["#include <common>","#include <logdepthbuf_pars_fragment>","#include <PLMVisWeb_clipping_planes_pars_fragment>","uniform float opacity;","void main() {","   #include <PLMVisWeb_clipping_planes_fragment>","   #include <logdepthbuf_fragment>","   #include <alphamap_fragment>","   #include <alphatest_fragment>","\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity );","   #include <premultiplied_alpha_fragment>","   #include <encodings_fragment>","}"].join("\n"),r.ShaderChunk.PLMVisWeb_points_vert=["uniform float size;","uniform float scale;","uniform float offset;","#include <PLMVisWeb_common_pars_vertex>","#include <PLMVisWeb_color_pars_vertex>","#include <common>","#include <color_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","void main() {","\t#include <PLMVisWeb_instance_matrix>","\t#include <PLMVisWeb_pass_color>","\t#include <PLMVisWeb_beginnormal_vertex>","\t#include <PLMVisWeb_begin_vertex>","\t#if defined( INSTANCING )","\t\tvec4 mvPosition = modelViewMatrix  * ( instanceModelMatrix * vec4( position, 1 ) );","\t\tif ( normal.z >= 0.0 || normal.z <= 0.0 ) {","\t\t\tvec4 mvPos;","\t\t\tvec4 mvNeg;","\t\t\tfloat cameraDepth = ( modelViewMatrix * ( instanceModelMatrix * vec4( position, 1 ) ) ).z;","\t\t\tmvPos = modelViewMatrix  * ( instanceModelMatrix * vec4( position + normal * -cameraDepth * offset, 1 ) );","\t\t\tmvNeg = modelViewMatrix  * ( instanceModelMatrix * vec4( position + normal * -cameraDepth * -offset, 1 ) );","\t\t\tif ( ( cameraDepth - mvPos.z ) - ( cameraDepth - mvNeg.z ) <= 0.0 ) {","\t\t\t\tmvPosition = mvPos;","\t\t\t}","\t\t\telse{","\t\t\t\tmvPosition = mvNeg;","\t\t\t}","\t\t}","\t#else","\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1 );","\t\tif ( normal.z >= 0.0  || normal.z <= 0.0 ) {","\t\t\tvec4 mvPos;","\t\t\tvec4 mvNeg;","\t\t\tfloat cameraDepth = ( modelViewMatrix * vec4( position, 1 ) ).z;","\t\t\tmvPos = modelViewMatrix * vec4( position + normal * -cameraDepth * offset, 1 );","\t\t\tmvNeg = modelViewMatrix * vec4( position + normal * -cameraDepth * -offset, 1 );","\t\t\tif ( ( cameraDepth - mvPos.z ) - ( cameraDepth - mvNeg.z ) <= 0.0 ) {","\t\t\t\tmvPosition = mvPos;","\t\t\t}","\t\t\telse{","\t\t\t\tmvPosition = mvNeg;","\t\t\t}","\t\t}","\t#endif","\t#ifdef USE_SIZEATTENUATION","\t   gl_PointSize = size * ( scale / - mvPosition.z );","\t#else","\t   gl_PointSize = size;","\t#endif","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),r.ShaderChunk.PLMVisWeb_points_frag=["float edgeFactor( ) {","   float d = length( gl_PointCoord - vec2( 0.5, 0.5 ) );","   return 1.0 - smoothstep( 0.5, 0.55, d );","}","#if defined( INSTANCING )","   varying vec3 diffuse;","#else","   uniform vec3 diffuse;","#endif","uniform float opacity;","#include <common>","#include <map_particle_pars_fragment>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <PLMVisWeb_clipping_planes_pars_fragment>","void main() {","\tif ( distance(diffuse.rgb, vec3(-1.0, -1.0, -1.0)) < 0.000001 ) {","\t\tdiscard;","\t}"," \telse {","\t\t#include <PLMVisWeb_clipping_planes_fragment>","\t\tvec4 diffuseColor = vec4( diffuse, opacity * edgeFactor() );","\t\tvec3 outgoingLight = vec3( 0.0 );","\t\t#include <logdepthbuf_fragment>","\t\t#include <map_particle_fragment>","\t\t#include <alphatest_fragment>","\t\toutgoingLight = diffuseColor.rgb;","\t\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","\t\t#include <premultiplied_alpha_fragment>","\t\t#include <tonemapping_fragment>","\t\t#include <encodings_fragment>","\t\t#include <fog_fragment>","\t}","}"].join("\n"),r.ShaderChunk.PLMVisWeb_outline_vert=["#include <PLMVisWeb_common_pars_vertex>","#include <PLMVisWeb_colors_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float offset;","void main() {","\t#include <PLMVisWeb_instance_matrix>","\t#include <PLMVisWeb_beginnormal_vertex>","\t#include <PLMVisWeb_pass_colors>","\t#include <PLMVisWeb_begin_vertex>","\t#if defined( INSTANCING )","\t\tfloat cameraDepth = -( modelViewMatrix * (instanceModelMatrix * vec4(position, 1)) ).z;","\t\tvec4 mvPosition = modelViewMatrix  * (instanceModelMatrix * vec4(position + normal * cameraDepth * offset, 1));","\t#else","\t\tfloat cameraDepth = -(modelViewMatrix * vec4(position, 1)).z;","\t\tvec4 mvPosition = modelViewMatrix * vec4(position + normal * cameraDepth * offset, 1 );","\t#endif","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <worldpos_vertex>","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),r.ShaderChunk.PLMVisWeb_outline_frag=["#include <PLMVisWeb_common_pars_fragment>","#include <alphamap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <PLMVisWeb_clipping_planes_pars_fragment>","void main() {","\t#include <PLMVisWeb_clipping_planes_fragment>","\t#include <logdepthbuf_fragment>","\t#include <alphamap_fragment>","\t#include <alphatest_fragment>","   gl_FragColor = vec4( diffuse, opacity );","\t#include <premultiplied_alpha_fragment>","\t#include <encodings_fragment>","}"].join("\n");var i=Object.freeze({None:0,Decal:1,Modulate:2,Replace:3,Blend:4,Add:5,Combine:6}),a={};a.pmiPoints={uniforms:r.UniformsUtils.merge([{color:{type:"c",value:new r.Color(16777215)},selectionColor:{type:"c",value:new r.Color(4456703)},opacity:{type:"f",value:1},selectionOpacity:{type:"f",value:1}}]),vertexShader:["precision highp float;","precision highp int;","#define SHADER_NAME PmiPointShader","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","attribute float visible;","attribute float selected;","varying float iVisible;","varying float iSelected;","void main() {","iVisible = visible;","iSelected = selected;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = 5.0;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["precision highp float;","precision highp int;","uniform vec3 color;","uniform vec3 selectionColor;","uniform float opacity;","uniform float selectionOpacity;","varying float iVisible;","varying float iSelected;","void main() {","if(iVisible == 0.0){","discard;","}","else{","gl_FragColor = vec4( ((iSelected == 0.0)? color : selectionColor), ((iSelected == 0.0)? opacity : selectionOpacity) );","}","}"].join("\n")},a.phongSection={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.envmap,r.UniformsLib.aomap,r.UniformsLib.lightmap,r.UniformsLib.emissivemap,r.UniformsLib.bumpmap,r.UniformsLib.normalmap,r.UniformsLib.displacementmap,r.UniformsLib.fog,r.UniformsLib.ambient,r.UniformsLib.lights,{emissive:{type:"c",value:new r.Color(0)},specular:{type:"c",value:new r.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:r.ShaderChunk.PLMVisWeb_meshphong_vert,fragmentShader:r.ShaderChunk.PLMVisWeb_meshphong_frag},a.lineSection={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.aomap,r.UniformsLib.fog,{selectionColor:{type:"c",value:new r.Color(0)},highlightColor:{type:"c",value:new r.Color(0)},color:{type:"c",value:new r.Color(0)}}]),vertexShader:r.ShaderChunk.PLMVisWeb_meshbasic_vert,fragmentShader:r.ShaderChunk.PLMVisWeb_meshbasic_frag},a.hiddenLineSection={uniforms:r.UniformsUtils.merge([r.UniformsLib.common]),vertexShader:r.ShaderChunk.PLMVisWeb_hiddenLine_vert,fragmentShader:r.ShaderChunk.PLMVisWeb_hiddenLine_frag},a.outlineSection={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,{offset:{type:"f",value:5e-4}}]),vertexShader:r.ShaderChunk.PLMVisWeb_outline_vert,fragmentShader:r.ShaderChunk.PLMVisWeb_outline_frag},a.points={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.points,r.UniformsLib.fog,{selectionColor:{type:"c",value:new r.Color(0)},highlightColor:{type:"c",value:new r.Color(0)},color:{type:"c",value:new r.Color(0)},size:{type:"1f",value:1},scale:{type:"1f",value:1},offset:{type:"f",value:.0015}}]),vertexShader:r.ShaderChunk.PLMVisWeb_points_vert,fragmentShader:r.ShaderChunk.PLMVisWeb_points_frag}},
/* 6 */
/***/function(e,t,n){"use strict";
/* harmony export (binding) */n.d(t,"a",function(){return Raycaster});
/* harmony import */var r=n(1),i=n(3),a=n(4),o=/* */n.n(a),s=o()("PLMVisWeb:debug:ThreeExtensions/Raycaster"),l=o()("PLMVisWeb:verbose:ThreeExtensions/Raycaster");
/* harmony import */function Raycaster(e,t,n,i){this.ray=new r.Ray(e,t),
// direction is assumed to be normalized (for accurate distance calculations)
this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}}}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,n,i,a){if((!n.spriteOnly||e instanceof r.Sprite)&&(!n.sectionOnly||"SectionPlane"===e.type)&&(function isVisible(e){for(var t=e,n=t.visible;n&&(t=t.parent);)n=t.visible;return n}(e)||"EdgeShape"===e.type||"VertexShape"===e.type)&&("VertexShape"!==e.type||e.parent.visible)&&"OutlineShape"!==e.type)
// Do not check outline for intersects
{
// Hide all individual edges
if("EdgeShape"===e.type){
// Do not check wireframe for intersects, D-51634
if("WireFrame"===e.edge.edgeId)return;
// Do not check individial edge for intersects if parent is not visible
if(!e.parent.visible)return}if("function"==typeof e.raycastOverride?e.raycastOverride(t,n,i):"function"==typeof e.raycast&&e.raycast(t,i),!0===a&&e.children)for(var o=e.children,s=0,l=o.length;s<l;s++)intersectObject(o[s],t,n,i,!0)}}function intersectOctreeObject(e,t,n,r,i){intersectObject(e.object,t,n,r,i)}Object.assign(Raycaster.prototype,{constructor:Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){
// direction is assumed to be normalized (for accurate distance calculations)
this.ray.set(e,t)},setFromCamera:function(e,t){if(t&&t.isPerspectiveCamera)this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize();else if(t&&t.isOrthographicCamera){var n=(t.near+t.far)/(t.near-t.far);this.ray.origin.set(e.x,e.y,t.near<n?t.near:n).unproject(t),// set origin in plane of camera, use near place if negative
this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)}else l("setFromCamera",i.b.stringsByLabel.SCENEGRAPH_LOGGER_threeErr)},intersectObject:function(e,t,n,r){var i=r||[];return intersectObject(e,this,t,i,n),i.sort(ascSort),i},intersectObjects:function(e,t,n,r){var a=r||[];if(!1===Array.isArray(e))return s("intersectObjects",i.b.stringsByLabel.SCENEGRAPH_LOGGER_threeWarn),a;for(var o=0,l=e.length;o<l;o++)intersectObject(e[o],this,t,a,n);return a.sort(ascSort),a},intersectOctreeObject:function(e,t,n){var r=[];return intersectOctreeObject(e,this,t,r,n),r.sort(ascSort),r},intersectOctreeObjects:function(e,t,n){for(var r=[],i=0,a=e.length;i<a;i++)intersectOctreeObject(e[i],this,t,r,n);return r.sort(ascSort),r}})},
/* 7 */
/***/function(e,t,n){"use strict";
/* harmony export (binding) */n.d(t,"b",function(){return r}),
/* harmony export (binding) */n.d(t,"a",function(){return a});var r=function(e,t,n){var r=0;if(e)e=function(e){for(var t=2;t<e;)t<<=1;return t}(e=Math.ceil(e));else e=128;for(var i=e-1,a=.8*e,o=[],s=0;s<e;s++)o[s]=void 0;for(var l=[],c=0;c<e;c++)l[c]=void 0;var u=function(e){return t?t.hash(e):e},h=function(e,t){return n?n.equals(e,t):e===t},d=function(){i=(e<<=1)-1,a=.8*e;for(var t=[],n=0;n<e;n++)t[n]=void 0;for(var r=[],s=0;s<e;s++)r[s]=void 0;for(var c=0,h=l.length;c<h;c++){var d=l[c];if(d){for(var p=o[c],f=u(p)&i;r[f];)f=++f&i;t[f]=p,r[f]=d}}o=t,l=r};Object.defineProperties(this,{size:{enumerable:!0,get:function(){return r}},capacity:{get:function(){return e}},keys:{get:function(){return o}},values:{get:function(){return l}}}),this.tryPut=function(e,t){for(var n=u(e)&i,s=void 0,c=o[n];void 0!==c;){if(h(e,c)){s=l[n];break}n=++n&i,c=o[n]}return void 0===s&&(o[n]=e,r++,l[n]=t,r>a&&d()),s},this.put=function(e,t){for(var n=u(e)&i,s=void 0,c=o[n];void 0!==c;){if(h(e,c)){s=l[n];break}n=++n&i,c=o[n]}return void 0===s&&(o[n]=e,r++),l[n]=t,r>a&&d(),s},this.get=function(e){for(var t=u(e)&i,n=void 0,r=o[t];void 0!==r;){if(h(e,r)){n=l[t];break}t=++t&i,r=o[t]}return n},this.containsKey=function(e){for(var t=u(e)&i,n=void 0,r=o[t];void 0!==r;){if(h(e,r)){n=l[t];break}t=++t&i,r=o[t]}return void 0!==n}},i=new Float32Array,a=function(e){(void 0===e||null===e||e<128)&&(e=128);var t=new Float32Array(e),n=null,r=0;Object.defineProperties(this,{size:{get:function(){return r}},values:{get:function(){return 0===r?i:t.subarray(0,r)}}});this.push=function(e){!function(){if(r>=t.length-1){var e=new Float32Array(2*t.length);e.set(t,0),t=e,n=null}}(),t[r]=e,r++},this.get=function(e){if(e>=0&&e<r)return t[e]},this.getInt32=function(e){if(e>=0&&e<r)return null===n&&(n=new Int32Array(t.buffer)),n[e]}}},
/* 8 */
/***/function(e,t,n){var r;
/*!@preserve
* svg.js - A lightweight library for manipulating and animating SVG.
* @version 2.6.3
* https://svgdotjs.github.io/
*
* @copyright Wout Fierens <wout@mick-wout.com>
* @license MIT
*
* BUILT: Fri Jul 21 2017 14:50:37 GMT+0200 (Mitteleuropï¿½ische Sommerzeit)
*
* 2018.11.26 - Rob hofford <robert.hofford@siemens.com>     Changed a referece to "this" to be "self" to avoid issues when webpacked. See comments tagged "RJH".
*                                                           Adding Siemens copyright, applying to this and other noted modifications.
* @copyright SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
*/!function(i,a){void 0===(r=function(){return function(e,t){
// The main wrapping element
// RJH: Original line:
//var SVG = this.SVG = function(element) {
// RJH: Replacing this with self:
var n=self.SVG=function(e){if(n.supported)return e=new n.Doc(e),n.parser.draw||n.prepare(),e}
// Default namespaces;
// Don't bother to continue if SVG is not supported
if(n.ns="http://www.w3.org/2000/svg",n.xmlns="http://www.w3.org/2000/xmlns/",n.xlink="http://www.w3.org/1999/xlink",n.svgjs="http://svgjs.com/svgjs",
// Svg support test
n.supported=!!t.createElementNS&&!!t.createElementNS(n.ns,"svg").createSVGRect,!n.supported)return!1;
// Element id sequence
n.did=1e3,
// Get next named element id
n.eid=function(e){return"Svgjs"+capitalize(e)+n.did++}
// Method for element creation
,n.create=function(e){
// create element
var n=t.createElementNS(this.ns,e);
// apply unique id
return n.setAttribute("id",this.eid(e)),n}
// Method for extending objects
,n.extend=function(){var e,t,r,i;
// Get list of modules
for(e=[].slice.call(arguments),
// Get object with extensions
t=e.pop(),i=e.length-1;i>=0;i--)if(e[i])for(r in t)e[i].prototype[r]=t[r];
// Make sure SVG.Set inherits any newly added methods
n.Set&&n.Set.inherit&&n.Set.inherit()}
// Invent new element
,n.invent=function(e){
// Create element initializer
var t="function"==typeof e.create?e.create:function(){this.constructor.call(this,n.create(e.create))}
// Inherit prototype;
return e.inherit&&(t.prototype=new e.inherit),
// Extend with methods
e.extend&&n.extend(t,e.extend),
// Attach construct method to parent
e.construct&&n.extend(e.parent||n.Container,e.construct),t}
// Adopt existing svg elements
,n.adopt=function(t){
// check for presence of node
return t?
// make sure a node isn't already adopted
t.instance?t.instance:(
// adopt with element-specific settings
// ensure references
(r="svg"==t.nodeName?t.parentNode instanceof e.SVGElement?new n.Nested:new n.Doc:"linearGradient"==t.nodeName?new n.Gradient("linear"):"radialGradient"==t.nodeName?new n.Gradient("radial"):n[capitalize(t.nodeName)]?new(n[capitalize(t.nodeName)]):new n.Element(t)).type=t.nodeName,r.node=t,t.instance=r,
// SVG.Class specific preparations
r instanceof n.Doc&&r.namespace().defs(),
// pull svgjs data from the dom (getAttributeNS doesn't work in html5)
r.setData(JSON.parse(t.getAttribute("svgjs:data"))||{}),r):null;
// initialize variables
var r}
// Initialize parsing element
,n.prepare=function(){
// Select document body and create invisible svg element
var e=t.getElementsByTagName("body")[0],r=(e?new n.Doc(e):n.adopt(t.documentElement).nested()).size(2,0);
// Create parser object
n.parser={body:e||t.documentElement,draw:r.style("opacity:0;position:absolute;left:-100%;top:-100%;overflow:hidden").node,poly:r.polyline().node,path:r.path().node,native:n.create("svg")}},n.parser={native:n.create("svg")},t.addEventListener("DOMContentLoaded",function(){n.parser.draw||n.prepare()},!1),
// Storage for regular expressions
n.regex={
// Parse unit value
numberAndUnit:/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,transforms:/\)\s*,?\s*/,whitespace:/\s/g,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,delimiter:/[\s,]+/,hyphen:/([^e])\-/gi,pathLetters:/[MLHVCSQTAZ]/gi,isPathLetter:/[MLHVCSQTAZ]/i,numbersWithDots:/((\d?\.\d+(?:e[+-]?\d+)?)((?:\.\d+(?:e[+-]?\d+)?)+))+/gi,dots:/\./g},n.utils={
// Map function
map:function(e,t){var n,r=e.length,i=[];for(n=0;n<r;n++)i.push(t(e[n]));return i}
// Filter function
,filter:function(e,t){var n,r=e.length,i=[];for(n=0;n<r;n++)t(e[n])&&i.push(e[n]);return i}
// Degrees to radians
,radians:function(e){return e%360*Math.PI/180}
// Radians to degrees
,degrees:function(e){return 180*e/Math.PI%360},filterSVGElements:function(t){return this.filter(t,function(t){return t instanceof e.SVGElement})}},n.defaults={
// Default attribute values
attrs:{
// fill and stroke
"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","font-size":16,"font-family":"Helvetica, Arial, sans-serif","text-anchor":"start"}},
// Module for color convertions
n.Color=function(e){var t;
// initialize defaults
this.r=0,this.g=0,this.b=0,e&&(
// parse color
"string"==typeof e?n.regex.isRgb.test(e)?(
// get rgb values
t=n.regex.rgb.exec(e.replace(n.regex.whitespace,"")),
// parse numeric values
this.r=parseInt(t[1]),this.g=parseInt(t[2]),this.b=parseInt(t[3])):n.regex.isHex.test(e)&&(
// get hex values
t=n.regex.hex.exec(
// Ensure to six-based hex
function fullHex(e){return 4==e.length?["#",e.substring(1,2),e.substring(1,2),e.substring(2,3),e.substring(2,3),e.substring(3,4),e.substring(3,4)].join(""):e}
// Component to hex value
(e)),
// parse numeric values
this.r=parseInt(t[1],16),this.g=parseInt(t[2],16),this.b=parseInt(t[3],16)):"object"==typeof e&&(this.r=e.r,this.g=e.g,this.b=e.b))},n.extend(n.Color,{
// Default to hex conversion
toString:function(){return this.toHex()}
// Build hex value
,toHex:function(){return"#"+compToHex(this.r)+compToHex(this.g)+compToHex(this.b)}
// Build rgb value
,toRgb:function(){return"rgb("+[this.r,this.g,this.b].join()+")"}
// Calculate true brightness
,brightness:function(){return this.r/255*.3+this.g/255*.59+this.b/255*.11}
// Make color morphable
,morph:function(e){return this.destination=new n.Color(e),this}
// Get morphed color at given position
,at:function(e){
// make sure a destination is defined
return this.destination?(
// normalise pos
e=e<0?0:e>1?1:e,new n.Color({r:~~(this.r+(this.destination.r-this.r)*e),g:~~(this.g+(this.destination.g-this.g)*e),b:~~(this.b+(this.destination.b-this.b)*e)})):this}}),
// Testers
// Test if given value is a color string
n.Color.test=function(e){return e+="",n.regex.isHex.test(e)||n.regex.isRgb.test(e)}
// Test if given value is a rgb object
,n.Color.isRgb=function(e){return e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b}
// Test if given value is a color
,n.Color.isColor=function(e){return n.Color.isRgb(e)||n.Color.test(e)}
// Module for array conversion
,n.Array=function(e,t){
// if array is empty and fallback is provided, use fallback
0==(e=(e||[]).valueOf()).length&&t&&(e=t.valueOf()),
// parse array
this.value=this.parse(e)},n.extend(n.Array,{
// Make array morphable
morph:function(e){
// normalize length of arrays
if(this.destination=this.parse(e),this.value.length!=this.destination.length){for(var t=this.value[this.value.length-1],n=this.destination[this.destination.length-1];this.value.length>this.destination.length;)this.destination.push(n);for(;this.value.length<this.destination.length;)this.value.push(t)}return this}
// Clean up any duplicate points
,settle:function(){
// find all unique values
for(var e=0,t=this.value.length,n=[];e<t;e++)-1==n.indexOf(this.value[e])&&n.push(this.value[e]);
// set new value
return this.value=n}
// Get morphed array at given position
,at:function(e){
// make sure a destination is defined
if(!this.destination)return this;
// generate morphed array
for(var t=0,r=this.value.length,i=[];t<r;t++)i.push(this.value[t]+(this.destination[t]-this.value[t])*e);return new n.Array(i)}
// Convert array to string
,toString:function(){return this.value.join(" ")}
// Real value
,valueOf:function(){return this.value}
// Parse whitespace separated string
,parse:function(e){
// if already is an array, no need to parse it
return e=e.valueOf(),Array.isArray(e)?e:this.split(e)}
// Strip unnecessary whitespace
,split:function(e){return e.trim().split(n.regex.delimiter).map(parseFloat)}
// Reverse array
,reverse:function(){return this.value.reverse(),this},clone:function(){var e=new this.constructor;return e.value=
// creates deep clone of array
function array_clone(e){var t=e.slice(0);for(var n=t.length;n--;)Array.isArray(t[n])&&(t[n]=array_clone(t[n]));return t}
// tests if a given element is instance of an object
(this.value),e}}),
// Poly points array
n.PointArray=function(e,t){n.Array.call(this,e,t||[[0,0]])}
// Inherit from SVG.Array
,n.PointArray.prototype=new n.Array,n.PointArray.prototype.constructor=n.PointArray,n.extend(n.PointArray,{
// Convert array to string
toString:function(){
// convert to a poly point string
for(var e=0,t=this.value.length,n=[];e<t;e++)n.push(this.value[e].join(","));return n.join(" ")}
// Convert array to line object
,toLine:function(){return{x1:this.value[0][0],y1:this.value[0][1],x2:this.value[1][0],y2:this.value[1][1]}}
// Get morphed array at given position
,at:function(e){
// make sure a destination is defined
if(!this.destination)return this;
// generate morphed point string
for(var t=0,r=this.value.length,i=[];t<r;t++)i.push([this.value[t][0]+(this.destination[t][0]-this.value[t][0])*e,this.value[t][1]+(this.destination[t][1]-this.value[t][1])*e]);return new n.PointArray(i)}
// Parse point string and flat array
,parse:function(e){var t=[];
// if it is an array
if(e=e.valueOf(),Array.isArray(e)){
// and it is not flat, there is no need to parse it
if(Array.isArray(e[0]))return e}else// Else, it is considered as a string
// parse points
e=e.trim().split(n.regex.delimiter).map(parseFloat);
// validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints
// Odd number of coordinates is an error. In such cases, drop the last odd coordinate.
e.length%2!=0&&e.pop();
// wrap points in two-tuples and parse points as floats
for(var r=0,i=e.length;r<i;r+=2)t.push([e[r],e[r+1]]);return t}
// Move point string
,move:function(e,t){var n=this.bbox();
// get relative offset
// move every point
if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(var r=this.value.length-1;r>=0;r--)this.value[r]=[this.value[r][0]+e,this.value[r][1]+t];return this}
// Resize poly string
,size:function(e,t){var n,r=this.bbox();
// recalculate position of all points according to new size
for(n=this.value.length-1;n>=0;n--)r.width&&(this.value[n][0]=(this.value[n][0]-r.x)*e/r.width+r.x),r.height&&(this.value[n][1]=(this.value[n][1]-r.y)*t/r.height+r.y);return this}
// Get bounding box of points
,bbox:function(){return n.parser.poly.setAttribute("points",this.toString()),n.parser.poly.getBBox()}});for(var r={M:function(e,t,n){return t.x=n.x=e[0],t.y=n.y=e[1],["M",t.x,t.y]},L:function(e,t){return t.x=e[0],t.y=e[1],["L",e[0],e[1]]},H:function(e,t){return t.x=e[0],["H",e[0]]},V:function(e,t){return t.y=e[0],["V",e[0]]},C:function(e,t){return t.x=e[4],t.y=e[5],["C",e[0],e[1],e[2],e[3],e[4],e[5]]},S:function(e,t){return t.x=e[2],t.y=e[3],["S",e[0],e[1],e[2],e[3]]},Q:function(e,t){return t.x=e[2],t.y=e[3],["Q",e[0],e[1],e[2],e[3]]},T:function(e,t){return t.x=e[0],t.y=e[1],["T",e[0],e[1]]},Z:function(e,t,n){return t.x=n.x,t.y=n.y,["Z"]},A:function(e,t){return t.x=e[5],t.y=e[6],["A",e[0],e[1],e[2],e[3],e[4],e[5],e[6]]}},i="mlhvqtcsaz".split(""),a=0,o=i.length;a<o;++a)r[i[a]]=function(e){return function(t,n,i){if("H"==e)t[0]=t[0]+n.x;else if("V"==e)t[0]=t[0]+n.y;else if("A"==e)t[5]=t[5]+n.x,t[6]=t[6]+n.y;else for(var a=0,o=t.length;a<o;++a)t[a]=t[a]+(a%2?n.y:n.x);return r[e](t,n,i)}}(i[a].toUpperCase());
// Path points array
n.PathArray=function(e,t){n.Array.call(this,e,t||[["M",0,0]])}
// Inherit from SVG.Array
,n.PathArray.prototype=new n.Array,n.PathArray.prototype.constructor=n.PathArray,n.extend(n.PathArray,{
// Convert array to string
toString:function(){
// PathArray Helpers
return function arrayToString(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t][0],null!=e[t][1]&&(r+=e[t][1],null!=e[t][2]&&(r+=" ",r+=e[t][2],null!=e[t][3]&&(r+=" ",r+=e[t][3],r+=" ",r+=e[t][4],null!=e[t][5]&&(r+=" ",r+=e[t][5],r+=" ",r+=e[t][6],null!=e[t][7]&&(r+=" ",r+=e[t][7])))));return r+" "}
// Deep new id assignment
(this.value)}
// Move path string
,move:function(e,t){
// get bounding box of current situation
var n=this.bbox();
// get relative offset
if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))
// move every point
for(var r,i=this.value.length-1;i>=0;i--)"M"==(r=this.value[i][0])||"L"==r||"T"==r?(this.value[i][1]+=e,this.value[i][2]+=t):"H"==r?this.value[i][1]+=e:"V"==r?this.value[i][1]+=t:"C"==r||"S"==r||"Q"==r?(this.value[i][1]+=e,this.value[i][2]+=t,this.value[i][3]+=e,this.value[i][4]+=t,"C"==r&&(this.value[i][5]+=e,this.value[i][6]+=t)):"A"==r&&(this.value[i][6]+=e,this.value[i][7]+=t);return this}
// Resize path string
,size:function(e,t){
// get bounding box of current situation
var n,r,i=this.bbox();
// recalculate position of all points according to new size
for(n=this.value.length-1;n>=0;n--)"M"==(r=this.value[n][0])||"L"==r||"T"==r?(this.value[n][1]=(this.value[n][1]-i.x)*e/i.width+i.x,this.value[n][2]=(this.value[n][2]-i.y)*t/i.height+i.y):"H"==r?this.value[n][1]=(this.value[n][1]-i.x)*e/i.width+i.x:"V"==r?this.value[n][1]=(this.value[n][1]-i.y)*t/i.height+i.y:"C"==r||"S"==r||"Q"==r?(this.value[n][1]=(this.value[n][1]-i.x)*e/i.width+i.x,this.value[n][2]=(this.value[n][2]-i.y)*t/i.height+i.y,this.value[n][3]=(this.value[n][3]-i.x)*e/i.width+i.x,this.value[n][4]=(this.value[n][4]-i.y)*t/i.height+i.y,"C"==r&&(this.value[n][5]=(this.value[n][5]-i.x)*e/i.width+i.x,this.value[n][6]=(this.value[n][6]-i.y)*t/i.height+i.y)):"A"==r&&(
// resize radii
this.value[n][1]=this.value[n][1]*e/i.width,this.value[n][2]=this.value[n][2]*t/i.height,
// move position values
this.value[n][6]=(this.value[n][6]-i.x)*e/i.width+i.x,this.value[n][7]=(this.value[n][7]-i.y)*t/i.height+i.y);return this}
// Test if the passed path array use the same path data commands as this path array
,equalCommands:function(e){var t,r,i;for(e=new n.PathArray(e),i=this.value.length===e.value.length,t=0,r=this.value.length;i&&t<r;t++)i=this.value[t][0]===e.value[t][0];return i}
// Make path array morphable
,morph:function(e){return e=new n.PathArray(e),this.equalCommands(e)?this.destination=e:this.destination=null,this}
// Get morphed path array at given position
,at:function(e){
// make sure a destination is defined
if(!this.destination)return this;var t,r,i,a,o=this.value,s=this.destination.value,l=[],c=new n.PathArray;
// Animate has specified in the SVG spec
// See: https://www.w3.org/TR/SVG11/paths.html#PathElement
for(t=0,r=o.length;t<r;t++){for(l[t]=[o[t][0]],i=1,a=o[t].length;i<a;i++)l[t][i]=o[t][i]+(s[t][i]-o[t][i])*e;
// For the two flags of the elliptical arc command, the SVG spec say:
// Flags and booleans are interpolated as fractions between zero and one, with any non-zero value considered to be a value of one/true
// Elliptical arc command as an array followed by corresponding indexes:
// ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]
//   0    1   2        3                 4             5      6  7
"A"===l[t][0]&&(l[t][4]=+(0!=l[t][4]),l[t][5]=+(0!=l[t][5]))}
// Directly modify the value of a path array, this is done this way for performance
return c.value=l,c}
// Absolutize and parse path to array
,parse:function(e){
// if it's already a patharray, no need to parse it
if(e instanceof n.PathArray)return e.valueOf();
// prepare for parsing
var t,i={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0};e="string"==typeof e?e.replace(n.regex.numbersWithDots,pathRegReplace).replace(n.regex.pathLetters," {{{VIEWERDEPENDS}}} ").replace(n.regex.hyphen,"$1 -").trim().split(n.regex.delimiter):e.reduce(function(e,t){return[].concat.call(e,t)},[]);
// array now is an array containing all parts of a path e.g. ['M', '0', '0', 'L', '30', '30' ...]
var a=[],o=new n.Point,s=new n.Point,l=0,c=e.length;do{
// Test if we have a path letter
n.regex.isPathLetter.test(e[l])?(t=e[l],++l):"M"==t?t="L":"m"==t&&(t="l"),a.push(r[t].call(null,e.slice(l,l+=i[t.toUpperCase()]).map(parseFloat),o,s))}while(c>l);return a}
// Get bounding box of path
,bbox:function(){return n.parser.path.setAttribute("d",this.toString()),n.parser.path.getBBox()}}),
// Module for unit convertions
n.Number=n.invent({
// Initialize
create:function(e,t){
// initialize defaults
this.value=0,this.unit=t||"",
// parse value
"number"==typeof e?
// ensure a valid numeric value
this.value=isNaN(e)?0:isFinite(e)?e:e<0?-3.4e38:3.4e38:"string"==typeof e?(t=e.match(n.regex.numberAndUnit))&&(
// make value numeric
this.value=parseFloat(t[1]),
// normalize
"%"==t[5]?this.value/=100:"s"==t[5]&&(this.value*=1e3),
// store unit
this.unit=t[5]):e instanceof n.Number&&(this.value=e.valueOf(),this.unit=e.unit)}
// Add methods
,extend:{
// Stringalize
toString:function(){return("%"==this.unit?~~(1e8*this.value)/1e6:"s"==this.unit?this.value/1e3:this.value)+this.unit},toJSON:function(){return this.toString()},// Convert to primitive
valueOf:function(){return this.value}
// Add number
,plus:function(e){return e=new n.Number(e),new n.Number(this+e,this.unit||e.unit)}
// Subtract number
,minus:function(e){return e=new n.Number(e),new n.Number(this-e,this.unit||e.unit)}
// Multiply number
,times:function(e){return e=new n.Number(e),new n.Number(this*e,this.unit||e.unit)}
// Divide number
,divide:function(e){return e=new n.Number(e),new n.Number(this/e,this.unit||e.unit)}
// Convert to different unit
,to:function(e){var t=new n.Number(this);return"string"==typeof e&&(t.unit=e),t}
// Make number morphable
,morph:function(e){return this.destination=new n.Number(e),e.relative&&(this.destination.value+=this.value),this}
// Get morphed number at given position
,at:function(e){
// Make sure a destination is defined
return this.destination?new n.Number(this.destination).minus(this).times(e).plus(this):this;
// Generate new morphed number
}}}),n.Element=n.invent({
// Initialize node
create:function(e){
// make stroke value accessible dynamically
this._stroke=n.defaults.attrs.stroke,this._event=null,
// initialize data object
this.dom={},
// create circular reference
(this.node=e)&&(this.type=e.nodeName,this.node.instance=this,
// store current attribute value
this._stroke=e.getAttribute("stroke")||this._stroke)}
// Add class methods
,extend:{
// Move over x-axis
x:function(e){return this.attr("x",e)}
// Move over y-axis
,y:function(e){return this.attr("y",e)}
// Move by center over x-axis
,cx:function(e){return null==e?this.x()+this.width()/2:this.x(e-this.width()/2)}
// Move by center over y-axis
,cy:function(e){return null==e?this.y()+this.height()/2:this.y(e-this.height()/2)}
// Move element to given x and y values
,move:function(e,t){return this.x(e).y(t)}
// Move element by its center
,center:function(e,t){return this.cx(e).cy(t)}
// Set width of element
,width:function(e){return this.attr("width",e)}
// Set height of element
,height:function(e){return this.attr("height",e)}
// Set element size to given width and height
,size:function(e,t){var r=proportionalSize(this,e,t);return this.width(new n.Number(r.width)).height(new n.Number(r.height))}
// Clone element
,clone:function(t,r){
// write dom data to the dom so the clone can pickup the data
this.writeDataToDom();
// clone element and assign new id
var i=function assignNewId(t){
// do the same for SVG child nodes as well
for(var r=t.childNodes.length-1;r>=0;r--)t.childNodes[r]instanceof e.SVGElement&&assignNewId(t.childNodes[r]);return n.adopt(t).id(n.eid(t.nodeName))}
// Add more bounding box properties
(this.node.cloneNode(!0));
// insert the clone in the given parent or after myself
return t?t.add(i):this.after(i),i}
// Remove element
,remove:function(){return this.parent()&&this.parent().removeElement(this),this}
// Replace element
,replace:function(e){return this.after(e).remove(),e}
// Add element to given container and return self
,addTo:function(e){return e.put(this)}
// Add element to given container and return container
,putIn:function(e){return e.add(this)}
// Get / set id
,id:function(e){return this.attr("id",e)}
// Checks whether the given point inside the bounding box of the element
,inside:function(e,t){var n=this.bbox();return e>n.x&&t>n.y&&e<n.x+n.width&&t<n.y+n.height}
// Show element
,show:function(){return this.style("display","")}
// Hide element
,hide:function(){return this.style("display","none")}
// Is element visible?
,visible:function(){return"none"!=this.style("display")}
// Return id on string conversion
,toString:function(){return this.attr("id")}
// Return array of classes on the node
,classes:function(){var e=this.attr("class");return null==e?[]:e.trim().split(n.regex.delimiter)}
// Return true if class exists on the node, false otherwise
,hasClass:function(e){return-1!=this.classes().indexOf(e)}
// Add class to the node
,addClass:function(e){if(!this.hasClass(e)){var t=this.classes();t.push(e),this.attr("class",t.join(" "))}return this}
// Remove class from the node
,removeClass:function(e){return this.hasClass(e)&&this.attr("class",this.classes().filter(function(t){return t!=e}).join(" ")),this}
// Toggle the presence of a class on the node
,toggleClass:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e)}
// Get referenced element form attribute value
,reference:function(e){return n.get(this.attr(e))}
// Returns the parent element instance
,parent:function(t){var r=this;
// check for parent
if(!r.node.parentNode)return null;
// get parent element
if(r=n.adopt(r.node.parentNode),!t)return r;
// loop trough ancestors if type is given
for(;r&&r.node instanceof e.SVGElement;){if("string"==typeof t?r.matches(t):r instanceof t)return r;if("#document"==r.node.parentNode.nodeName)return null;// #720
r=n.adopt(r.node.parentNode)}}
// Get parent document
,doc:function(){return this instanceof n.Doc?this:this.parent(n.Doc)}
// return array of all ancestors of given type up to the root svg
,parents:function(e){var t=[],n=this;do{if(!(n=n.parent(e))||!n.node)break;t.push(n)}while(n.parent);return t}
// matches the element vs a css selector
,matches:function(e){
// tests if a given selector matches an element
return function matches(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)}
// Convert dash-separated-string to camelCase
(this.node,e)}
// Returns the svg node to call native svg methods on it
,native:function(){return this.node}
// Import raw svg
,svg:function(e){
// create temporary holder
var r=t.createElement("svg");
// act as a setter if svg is given
if(!(e&&this instanceof n.Parent))
// return target element
// create a wrapping svg element in case of partial content
return r.appendChild(e=t.createElement("svg")),
// write svgjs data to the dom
this.writeDataToDom(),
// insert a copy of this node
e.appendChild(this.node.cloneNode(!0)),r.innerHTML.replace(/^<svg>/,"").replace(/<\/svg>$/,"");
// dump raw svg
r.innerHTML="<svg>"+e.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2></$1>")+"</svg>";
// transplant nodes
for(var i=0,a=r.firstChild.childNodes.length;i<a;i++)this.node.appendChild(r.firstChild.firstChild);
// otherwise act as a getter
return this}
// write svgjs data to the dom
,writeDataToDom:function(){
// dump variables recursively
if(this.each||this.lines){var e=this.each?this:this.lines();e.each(function(){this.writeDataToDom()})}
// remove previously set data
// see #428
return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),this}
// set given data to the elements data property
,setData:function(e){return this.dom=e,this},is:function(e){return function is(e,t){return e instanceof t}(this,e)}}}),n.easing={"-":function(e){return e},"<>":function(e){return-Math.cos(e*Math.PI)/2+.5},">":function(e){return Math.sin(e*Math.PI/2)},"<":function(e){return 1-Math.cos(e*Math.PI/2)}},n.morph=function(e){return function(t,r){return new n.MorphObj(t,r).at(e)}},n.Situation=n.invent({create:function(e){this.init=!1,this.reversed=!1,this.reversing=!1,this.duration=new n.Number(e.duration).valueOf(),this.delay=new n.Number(e.delay).valueOf(),this.start=+new Date+this.delay,this.finish=this.start+this.duration,this.ease=e.ease,
// this.loop is incremented from 0 to this.loops
// it is also incremented when in an infinite loop (when this.loops is true)
this.loop=0,this.loops=!1,this.animations={},this.attrs={},this.styles={},this.transforms=[],this.once={}}}),n.FX=n.invent({create:function(e){this._target=e,this.situations=[],this.active=!1,this.situation=null,this.paused=!1,this.lastPos=0,this.pos=0,
// The absolute position of an animation is its position in the context of its complete duration (including delay and loops)
// When performing a delay, absPos is below 0 and when performing a loop, its value is above 1
this.absPos=0,this._speed=1},extend:{
/**
     * sets or returns the target of this animation
     * @param o object || number In case of Object it holds all parameters. In case of number its the duration of the animation
     * @param ease function || string Function which should be used for easing or easing keyword
     * @param delay Number indicating the delay before the animation starts
     * @return target || this
     */
animate:function(e,t,r){"object"==typeof e&&(t=e.ease,r=e.delay,e=e.duration);var i=new n.Situation({duration:e||1e3,delay:r||0,ease:n.easing[t||"-"]||t});return this.queue(i),this}
/**
     * sets a delay before the next element of the queue is called
     * @param delay Duration of delay in milliseconds
     * @return this.target()
     */,delay:function(e){
// The delay is performed by an empty situation with its duration
// attribute set to the duration of the delay
var t=new n.Situation({duration:e,delay:0,ease:n.easing["-"]});return this.queue(t)}
/**
     * sets or returns the target of this animation
     * @param null || target SVG.Element which should be set as new target
     * @return target || this
     */,target:function(e){return e&&e instanceof n.Element?(this._target=e,this):this._target}
// returns the absolute position at a given time
,timeToAbsPos:function(e){return(e-this.situation.start)/(this.situation.duration/this._speed)}
// returns the timestamp from a given absolute positon
,absPosToTime:function(e){return this.situation.duration/this._speed*e+this.situation.start}
// starts the animationloop
,startAnimFrame:function(){this.stopAnimFrame(),this.animationFrame=e.requestAnimationFrame(function(){this.step()}.bind(this))}
// cancels the animationframe
,stopAnimFrame:function(){e.cancelAnimationFrame(this.animationFrame)}
// kicks off the animation - only does something when the queue is currently not active and at least one situation is set
,start:function(){
// dont start if already started
return!this.active&&this.situation&&(this.active=!0,this.startCurrent()),this}
// start the current situation
,startCurrent:function(){return this.situation.start=+new Date+this.situation.delay/this._speed,this.situation.finish=this.situation.start+this.situation.duration/this._speed,this.initAnimations().step()}
/**
     * adds a function / Situation to the animation queue
     * @param fn function / situation to add
     * @return this
     */,queue:function(e){return("function"==typeof e||e instanceof n.Situation)&&this.situations.push(e),this.situation||(this.situation=this.situations.shift()),this}
/**
     * pulls next element from the queue and execute it
     * @return this
     */,dequeue:function(){
// stop current animation
return this.stop(),
// get next animation from queue
this.situation=this.situations.shift(),this.situation&&(this.situation instanceof n.Situation?this.start():
// If it is not a SVG.Situation, then it is a function, we execute it
this.situation.call(this)),this}
// updates all animations to the current state of the element
// this is important when one property could be changed from another property
,initAnimations:function(){var e,t,r,i=this.situation;if(i.init)return this;for(e in i.animations)
//if(s.animations[i].length > source.length) {
//  source.concat = source.concat(s.animations[i].slice(source.length, s.animations[i].length))
//}
for(r=this.target()[e](),Array.isArray(r)||(r=[r]),Array.isArray(i.animations[e])||(i.animations[e]=[i.animations[e]]),t=r.length;t--;)
// The condition is because some methods return a normal number instead
// of a SVG.Number
i.animations[e][t]instanceof n.Number&&(r[t]=new n.Number(r[t])),i.animations[e][t]=r[t].morph(i.animations[e][t]);for(e in i.attrs)i.attrs[e]=new n.MorphObj(this.target().attr(e),i.attrs[e]);for(e in i.styles)i.styles[e]=new n.MorphObj(this.target().style(e),i.styles[e]);return i.initialTransformation=this.target().matrixify(),i.init=!0,this},clearQueue:function(){return this.situations=[],this},clearCurrent:function(){return this.situation=null,this}
/** stops the animation immediately
     * @param jumpToEnd A Boolean indicating whether to complete the current animation immediately.
     * @param clearQueue A Boolean indicating whether to remove queued animation as well.
     * @return this
     */,stop:function(e,t){var n=this.active;return this.active=!1,t&&this.clearQueue(),e&&this.situation&&(
// initialize the situation if it was not
!n&&this.startCurrent(),this.atEnd()),this.stopAnimFrame(),this.clearCurrent()}
/** resets the element to the state where the current element has started
     * @return this
     */,reset:function(){if(this.situation){var e=this.situation;this.stop(),this.situation=e,this.atStart()}return this}
// Stop the currently-running animation, remove all queued animations, and complete all animations for the element.
,finish:function(){for(this.stop(!0,!1);this.dequeue().situation&&this.stop(!0,!1););return this.clearQueue().clearCurrent(),this}
// set the internal animation pointer at the start position, before any loops, and updates the visualisation
,atStart:function(){return this.at(0,!0)}
// set the internal animation pointer at the end position, after all the loops, and updates the visualisation
,atEnd:function(){return!0===this.situation.loops&&(
// If in a infinite loop, we end the current iteration
this.situation.loops=this.situation.loop+1),"number"==typeof this.situation.loops?this.at(this.situation.loops,!0):this.at(1,!0)}
// set the internal animation pointer to the specified position and updates the visualisation
// if isAbsPos is true, pos is treated as an absolute position
,at:function(e,t){var n=this.situation.duration/this._speed;return this.absPos=e,
// If pos is not an absolute position, we convert it into one
t||(this.situation.reversed&&(this.absPos=1-this.absPos),this.absPos+=this.situation.loop),this.situation.start=+new Date-this.absPos*n,this.situation.finish=this.situation.start+n,this.step(!0)}
/**
     * sets or returns the speed of the animations
     * @param speed null || Number The new speed of the animations
     * @return Number || this
     */,speed:function(e){return 0===e?this.pause():e?(this._speed=e,this.at(this.absPos,!0)):this._speed}
// Make loopable
,loop:function(e,t){var n=this.last();
// store total loops
return n.loops=null==e||e,n.loop=0,t&&(n.reversing=!0),this}
// pauses the animation
,pause:function(){return this.paused=!0,this.stopAnimFrame(),this}
// unpause the animation
,play:function(){return this.paused?(this.paused=!1,this.at(this.absPos,!0)):this}
/**
     * toggle or set the direction of the animation
     * true sets direction to backwards while false sets it to forwards
     * @param reversed Boolean indicating whether to reverse the animation or not (default: toggle the reverse status)
     * @return this
     */,reverse:function(e){var t=this.last();return t.reversed=void 0===e?!t.reversed:e,this}
/**
     * returns a float from 0-1 indicating the progress of the current animation
     * @param eased Boolean indicating whether the returned position should be eased or not
     * @return number
     */,progress:function(e){return e?this.situation.ease(this.pos):this.pos}
/**
     * adds a callback function which is called when the current animation is finished
     * @param fn Function which should be executed as callback
     * @return number
     */,after:function(e){var t=this.last();return this.target().on("finished.fx",function wrapper(n){n.detail.situation==t&&(e.call(this,t),this.off("finished.fx",wrapper))}),this._callStart()}
// adds a callback which is called whenever one animation step is performed
,during:function(e){var t=this.last(),r=function(r){r.detail.situation==t&&e.call(this,r.detail.pos,n.morph(r.detail.pos),r.detail.eased,t)}
// see above;
return this.target().off("during.fx",r).on("during.fx",r),this.after(function(){this.off("during.fx",r)}),this._callStart()}
// calls after ALL animations in the queue are finished
,afterAll:function(e){var t=function wrapper(t){e.call(this),this.off("allfinished.fx",wrapper)}
// see above;
return this.target().off("allfinished.fx",t).on("allfinished.fx",t),this._callStart()}
// calls on every animation step for all animations
,duringAll:function(e){var t=function(t){e.call(this,t.detail.pos,n.morph(t.detail.pos),t.detail.eased,t.detail.situation)};return this.target().off("during.fx",t).on("during.fx",t),this.afterAll(function(){this.off("during.fx",t)}),this._callStart()},last:function(){return this.situations.length?this.situations[this.situations.length-1]:this.situation}
// adds one property to the animations
,add:function(e,t,n){return this.last()[n||"animations"][e]=t,this._callStart()}
/** perform one step of the animation
     *  @param ignoreTime Boolean indicating whether to ignore time and use position directly or recalculate position based on time
     *  @return this
     */,step:function(e){var t,n,r;
// If the absolute position is below 0, we just treat it as if it was 0
// This part convert an absolute position to a position
(
// convert current time to an absolute position
e||(this.absPos=this.timeToAbsPos(+new Date)),!1!==this.situation.loops)?(t=Math.max(this.absPos,0),n=Math.floor(t),!0===this.situation.loops||n<this.situation.loops?(this.pos=t-n,r=this.situation.loop,this.situation.loop=n):(this.absPos=this.situation.loops,this.pos=1,
// The -1 here is because we don't want to toggle reversed when all the loops have been completed
r=this.situation.loop-1,this.situation.loop=this.situation.loops),this.situation.reversing&&(
// Toggle reversed if an odd number of loops as occured since the last call of step
this.situation.reversed=this.situation.reversed!=Boolean((this.situation.loop-r)%2))):(
// If there are no loop, the absolute position must not be above 1
this.absPos=Math.min(this.absPos,1),this.pos=this.absPos);
// while the absolute position can be below 0, the position must not be below 0
this.pos<0&&(this.pos=0),this.situation.reversed&&(this.pos=1-this.pos);
// apply easing
var i=this.situation.ease(this.pos);
// call once-callbacks
for(var a in this.situation.once)a>this.lastPos&&a<=i&&(this.situation.once[a].call(this.target(),this.pos,i),delete this.situation.once[a]);
// fire during callback with position, eased position and current situation as parameter
// the user may call stop or finish in the during callback
// so make sure that we still have a valid situation
return this.active&&this.target().fire("during",{pos:this.pos,eased:i,fx:this,situation:this.situation}),this.situation?(
// apply the actual animation to every property
this.eachAt(),
// do final code when situation is finished
1==this.pos&&!this.situation.reversed||this.situation.reversed&&0==this.pos?(
// stop animation callback
this.stopAnimFrame(),
// fire finished callback with current situation as parameter
this.target().fire("finished",{fx:this,situation:this.situation}),this.situations.length||(this.target().fire("allfinished"),
// Recheck the length since the user may call animate in the afterAll callback
this.situations.length||(this.target().off(".fx"),// there shouldnt be any binding left, but to make sure...
this.active=!1)),
// start next animation
this.active?this.dequeue():this.clearCurrent()):!this.paused&&this.active&&
// we continue animating when we are not at the end
this.startAnimFrame(),
// save last eased position for once callback triggering
this.lastPos=i,this):this}
// calculates the step for every property and calls block with it
,eachAt:function(){var e,t,r,i=this,a=this.target(),o=this.situation;
// apply animations which can be called trough a method
for(e in o.animations)r=[].concat(o.animations[e]).map(function(e){return"string"!=typeof e&&e.at?e.at(o.ease(i.pos),i.pos):e}),a[e].apply(a,r);
// apply animation which has to be applied with attr()
for(e in o.attrs)r=[e].concat(o.attrs[e]).map(function(e){return"string"!=typeof e&&e.at?e.at(o.ease(i.pos),i.pos):e}),a.attr.apply(a,r);
// apply animation which has to be applied with style()
for(e in o.styles)r=[e].concat(o.styles[e]).map(function(e){return"string"!=typeof e&&e.at?e.at(o.ease(i.pos),i.pos):e}),a.style.apply(a,r);
// animate initialTransformation which has to be chained
if(o.transforms.length){for(
// get initial initialTransformation
r=o.initialTransformation,e=0,t=o.transforms.length;e<t;e++){
// get next transformation in chain
var s=o.transforms[e];
// multiply matrix directly
s instanceof n.Matrix?r=s.relative?r.multiply((new n.Matrix).morph(s).at(o.ease(this.pos))):r.morph(s).at(o.ease(this.pos)):(
// when transformation is absolute we have to reset the needed transformation first
s.relative||s.undo(r.extract()),
// and reapply it after
r=r.multiply(s.at(o.ease(this.pos))))}
// set new matrix on element
a.matrix(r)}return this}
// adds an once-callback which is called at a specific position and never again
,once:function(e,t,n){var r=this.last();return n||(e=r.ease(e)),r.once[e]=t,this},_callStart:function(){return setTimeout(function(){this.start()}.bind(this),0),this}},parent:n.Element,construct:{
// Get fx module or create a new one, then animate with given duration and ease
animate:function(e,t,r){return(this.fx||(this.fx=new n.FX(this))).animate(e,t,r)},delay:function(e){return(this.fx||(this.fx=new n.FX(this))).delay(e)},stop:function(e,t){return this.fx&&this.fx.stop(e,t),this},finish:function(){return this.fx&&this.fx.finish(),this}
// Pause current animation
,pause:function(){return this.fx&&this.fx.pause(),this}
// Play paused current animation
,play:function(){return this.fx&&this.fx.play(),this}
// Set/Get the speed of the animations
,speed:function(e){if(this.fx){if(null==e)return this.fx.speed();this.fx.speed(e)}return this}}}),
// MorphObj is used whenever no morphable object is given
n.MorphObj=n.invent({create:function(e,t){
// prepare color for morphing
return n.Color.isColor(t)?new n.Color(e).morph(t):
// prepare value list for morphing
n.regex.delimiter.test(e)?new n.Array(e).morph(t):
// prepare number for morphing
n.regex.numberAndUnit.test(t)?new n.Number(e).morph(t):(
// prepare for plain morphing
this.value=e,void(this.destination=t))},extend:{at:function(e,t){return t<1?this.value:this.destination},valueOf:function(){return this.value}}}),n.extend(n.FX,{
// Add animatable attributes
attr:function(e,t,n){
// apply attributes individually
if("object"==typeof e)for(var r in e)this.attr(r,e[r]);else this.add(e,t,"attrs");return this}
// Add animatable styles
,style:function(e,t){if("object"==typeof e)for(var n in e)this.style(n,e[n]);else this.add(e,t,"styles");return this}
// Animatable x-axis
,x:function(e,t){if(this.target()instanceof n.G)return this.transform({x:e},t),this;var r=new n.Number(e);return r.relative=t,this.add("x",r)}
// Animatable y-axis
,y:function(e,t){if(this.target()instanceof n.G)return this.transform({y:e},t),this;var r=new n.Number(e);return r.relative=t,this.add("y",r)}
// Animatable center x-axis
,cx:function(e){return this.add("cx",new n.Number(e))}
// Animatable center y-axis
,cy:function(e){return this.add("cy",new n.Number(e))}
// Add animatable move
,move:function(e,t){return this.x(e).y(t)}
// Add animatable center
,center:function(e,t){return this.cx(e).cy(t)}
// Add animatable size
,size:function(e,t){
// animate bbox based size for all other elements
var r;this.target()instanceof n.Text?
// animate font size for Text elements
this.attr("font-size",e):(e&&t||(r=this.target().bbox()),e||(e=r.width/r.height*t),t||(t=r.height/r.width*e),this.add("width",new n.Number(e)).add("height",new n.Number(t)));return this}
// Add animatable width
,width:function(e){return this.add("width",new n.Number(e))}
// Add animatable height
,height:function(e){return this.add("height",new n.Number(e))}
// Add animatable plot
,plot:function(e,t,n,r){
// Lines can be plotted with 4 arguments
return 4==arguments.length?this.plot([e,t,n,r]):this.add("plot",new(this.target().morphArray)(e))}
// Add leading method
,leading:function(e){return this.target().leading?this.add("leading",new n.Number(e)):this}
// Add animatable viewbox
,viewbox:function(e,t,r,i){return this.target()instanceof n.Container&&this.add("viewbox",new n.ViewBox(e,t,r,i)),this},update:function(e){if(this.target()instanceof n.Stop){if("number"==typeof e||e instanceof n.Number)return this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]});null!=e.opacity&&this.attr("stop-opacity",e.opacity),null!=e.color&&this.attr("stop-color",e.color),null!=e.offset&&this.attr("offset",e.offset)}return this}}),n.Box=n.invent({create:function(e,t,r,i){if(!("object"!=typeof e||e instanceof n.Element))
// chromes getBoundingClientRect has no x and y property
return n.Box.call(this,null!=e.left?e.left:e.x,null!=e.top?e.top:e.y,e.width,e.height);
// add center, right, bottom...
4==arguments.length&&(this.x=e,this.y=t,this.width=r,this.height=i),fullBox(this)},extend:{
// Merge rect box with another, return a new instance
merge:function(e){var t=new this.constructor;
// merge boxes
return t.x=Math.min(this.x,e.x),t.y=Math.min(this.y,e.y),t.width=Math.max(this.x+this.width,e.x+e.width)-t.x,t.height=Math.max(this.y+this.height,e.y+e.height)-t.y,fullBox(t)},transform:function(e){var t,r=1/0,i=-1/0,a=1/0,o=-1/0,s=[new n.Point(this.x,this.y),new n.Point(this.x2,this.y),new n.Point(this.x,this.y2),new n.Point(this.x2,this.y2)];return s.forEach(function(t){t=t.transform(e),r=Math.min(r,t.x),i=Math.max(i,t.x),a=Math.min(a,t.y),o=Math.max(o,t.y)}),(t=new this.constructor).x=r,t.width=i-r,t.y=a,t.height=o-a,fullBox(t),t}}}),n.BBox=n.invent({
// Initialize
create:function(e){
// get values if element is given
if(n.Box.apply(this,[].slice.call(arguments)),e instanceof n.Element){var r;
// yes this is ugly, but Firefox can be a pain when it comes to elements that are not yet rendered
try{if(t.documentElement.contains){
// the element is NOT in the dom, throw error
if(!t.documentElement.contains(e.node))throw new Exception("Element not in the dom")}else{for(
// This is IE - it does not support contains() for top-level SVGs
var i=e.node;i.parentNode;)i=i.parentNode;if(i!=t)throw new Exception("Element not in the dom")}
// find native bbox
r=e.node.getBBox()}catch(t){if(e instanceof n.Shape){var a=e.clone(n.parser.draw.instance).show();r=a.node.getBBox(),a.remove()}else r={x:e.node.clientLeft,y:e.node.clientTop,width:e.node.clientWidth,height:e.node.clientHeight}}n.Box.call(this,r)}}
// Define ancestor
,inherit:n.Box,parent:n.Element,construct:{
// Get bounding box
bbox:function(){return new n.BBox(this)}}}),n.BBox.prototype.constructor=n.BBox,n.extend(n.Element,{tbox:function(){return console.warn("Use of TBox is deprecated and mapped to RBox. Use .rbox() instead."),this.rbox(this.doc())}}),n.RBox=n.invent({
// Initialize
create:function(e){n.Box.apply(this,[].slice.call(arguments)),e instanceof n.Element&&n.Box.call(this,e.node.getBoundingClientRect())},inherit:n.Box,parent:n.Element,extend:{addOffset:function(){
// offset by window scroll position, because getBoundingClientRect changes when window is scrolled
return this.x+=e.pageXOffset,this.y+=e.pageYOffset,this}},construct:{
// Get rect box
rbox:function(e){return e?new n.RBox(this).transform(e.screenCTM().inverse()):new n.RBox(this).addOffset()}}}),n.RBox.prototype.constructor=n.RBox,n.Matrix=n.invent({
// Initialize
create:function(e){var t,r=arrayToMatrix([1,0,0,1,0,0]);
// ensure source as object
// merge source
for(e=e instanceof n.Element?e.matrixify():"string"==typeof e?arrayToMatrix(e.split(n.regex.delimiter).map(parseFloat)):6==arguments.length?arrayToMatrix([].slice.call(arguments)):Array.isArray(e)?arrayToMatrix(e):"object"==typeof e?e:r,t=l.length-1;t>=0;--t)this[l[t]]=null!=e[l[t]]?e[l[t]]:r[l[t]]}
// Add methods
,extend:{
// Extract individual transformations
extract:function(){
// find delta transform points
var e=deltaTransformPoint(this,0,1),t=deltaTransformPoint(this,1,0),r=180/Math.PI*Math.atan2(e.y,e.x)-90;return{
// translation
x:this.e,y:this.f,transformedX:(this.e*Math.cos(r*Math.PI/180)+this.f*Math.sin(r*Math.PI/180))/Math.sqrt(this.a*this.a+this.b*this.b),transformedY:(this.f*Math.cos(r*Math.PI/180)+this.e*Math.sin(-r*Math.PI/180))/Math.sqrt(this.c*this.c+this.d*this.d),skewX:-r,skewY:180/Math.PI*Math.atan2(t.y,t.x),scaleX:Math.sqrt(this.a*this.a+this.b*this.b),scaleY:Math.sqrt(this.c*this.c+this.d*this.d),rotation:r,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f,matrix:new n.Matrix(this)}}
// Clone matrix
,clone:function(){return new n.Matrix(this)}
// Morph one matrix into another
,morph:function(e){
// store new destination
return this.destination=new n.Matrix(e),this}
// Get morphed matrix at a given position
,at:function(e){
// make sure a destination is defined
if(!this.destination)return this;
// calculate morphed matrix at a given position
var t=new n.Matrix({a:this.a+(this.destination.a-this.a)*e,b:this.b+(this.destination.b-this.b)*e,c:this.c+(this.destination.c-this.c)*e,d:this.d+(this.destination.d-this.d)*e,e:this.e+(this.destination.e-this.e)*e,f:this.f+(this.destination.f-this.f)*e});return t}
// Multiplies by given matrix
,multiply:function(e){return new n.Matrix(this.native().multiply(
// Parse matrix if required
function parseMatrix(e){e instanceof n.Matrix||(e=new n.Matrix(e));return e}
// Add centre point to transform object
(e).native()))}
// Inverses matrix
,inverse:function(){return new n.Matrix(this.native().inverse())}
// Translate matrix
,translate:function(e,t){return new n.Matrix(this.native().translate(e||0,t||0))}
// Scale matrix
,scale:function(e,t,r,i){
// support uniformal scale
return 1==arguments.length?t=e:3==arguments.length&&(i=r,r=t,t=e),this.around(r,i,new n.Matrix(e,0,0,t,0,0))}
// Rotate matrix
,rotate:function(e,t,r){
// convert degrees to radians
return e=n.utils.radians(e),this.around(t,r,new n.Matrix(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0))}
// Flip matrix on x or y, at a given offset
,flip:function(e,t){return"x"==e?this.scale(-1,1,t,0):"y"==e?this.scale(1,-1,0,t):this.scale(-1,-1,e,null!=t?t:e)}
// Skew
,skew:function(e,t,r,i){
// support uniformal skew
return 1==arguments.length?t=e:3==arguments.length&&(i=r,r=t,t=e),
// convert degrees to radians
e=n.utils.radians(e),t=n.utils.radians(t),this.around(r,i,new n.Matrix(1,Math.tan(t),Math.tan(e),1,0,0))}
// SkewX
,skewX:function(e,t,n){return this.skew(e,0,t,n)}
// SkewY
,skewY:function(e,t,n){return this.skew(0,e,t,n)}
// Transform around a center point
,around:function(e,t,r){return this.multiply(new n.Matrix(1,0,0,1,e||0,t||0)).multiply(r).multiply(new n.Matrix(1,0,0,1,-e||0,-t||0))}
// Convert to native SVGMatrix
,native:function(){
// update with current values
for(
// create new matrix
var e=n.parser.native.createSVGMatrix(),t=l.length-1;t>=0;t--)e[l[t]]=this[l[t]];return e}
// Convert matrix to string
,toString:function(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}},parent:n.Element,construct:{
// Get current matrix
ctm:function(){return new n.Matrix(this.node.getCTM())},
// Get current screen matrix
screenCTM:function(){
/* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537
         This is needed because FF does not return the transformation matrix
         for the inner coordinate system when getScreenCTM() is called on nested svgs.
         However all other Browsers do that */
if(this instanceof n.Nested){var e=this.rect(1,1),t=e.node.getScreenCTM();return e.remove(),new n.Matrix(t)}return new n.Matrix(this.node.getScreenCTM())}}}),n.Point=n.invent({
// Initialize
create:function(e,t){var n;
// ensure source as object
n=Array.isArray(e)?{x:e[0],y:e[1]}:"object"==typeof e?{x:e.x,y:e.y}:null!=e?{x:e,y:null!=t?t:e}:{x:0,y:0},// If y has no value, then x is used has its value
// merge source
this.x=n.x,this.y=n.y}
// Add methods
,extend:{
// Clone point
clone:function(){return new n.Point(this)}
// Morph one point into another
,morph:function(e,t){
// store new destination
return this.destination=new n.Point(e,t),this}
// Get morphed point at a given position
,at:function(e){
// make sure a destination is defined
if(!this.destination)return this;
// calculate morphed matrix at a given position
var t=new n.Point({x:this.x+(this.destination.x-this.x)*e,y:this.y+(this.destination.y-this.y)*e});return t}
// Convert to native SVGPoint
,native:function(){
// create new point
var e=n.parser.native.createSVGPoint();
// update with current values
return e.x=this.x,e.y=this.y,e}
// transform point with matrix
,transform:function(e){return new n.Point(this.native().matrixTransform(e.native()))}}}),n.extend(n.Element,{
// Get point
point:function(e,t){return new n.Point(e,t).transform(this.screenCTM().inverse())}}),n.extend(n.Element,{
// Set svg element attribute
attr:function(e,t,r){
// act as full getter
if(null==e){for(
// get an object of attributes
e={},t=this.node.attributes,r=t.length-1;r>=0;r--)e[t[r].nodeName]=n.regex.isNumber.test(t[r].nodeValue)?parseFloat(t[r].nodeValue):t[r].nodeValue;return e}if("object"==typeof e)
// apply every attribute individually if an object is passed
for(t in e)this.attr(t,e[t]);else if(null===t)
// remove value
this.node.removeAttribute(e);else{if(null==t)return null==(
// act as a getter if the first and only argument is not an object
t=this.node.getAttribute(e))?n.defaults.attrs[e]:n.regex.isNumber.test(t)?parseFloat(t):t;
// BUG FIX: some browsers will render a stroke if a color is given even though stroke width is 0
"stroke-width"==e?this.attr("stroke",parseFloat(t)>0?this._stroke:null):"stroke"==e&&(this._stroke=t),
// convert image fill and stroke to patterns
"fill"!=e&&"stroke"!=e||(n.regex.isImage.test(t)&&(t=this.doc().defs().image(t,0,0)),t instanceof n.Image&&(t=this.doc().defs().pattern(0,0,function(){this.add(t)}))),
// ensure correct numeric values (also accepts NaN and Infinity)
"number"==typeof t?t=new n.Number(t):n.Color.isColor(t)?t=new n.Color(t):Array.isArray(t)&&(t=new n.Array(t)),
// if the passed attribute is leading...
"leading"==e?
// ... call the leading method instead
this.leading&&this.leading(t):
// set given attribute on node
"string"==typeof r?this.node.setAttributeNS(r,e,t.toString()):this.node.setAttribute(e,t.toString()),
// rebuild if required
!this.rebuild||"font-size"!=e&&"x"!=e||this.rebuild(e,t)}return this}}),n.extend(n.Element,{
// Add transformations
transform:function(e,t){
// get target in case of the fx module, otherwise reference this
var r,i;
// act as a getter
if("object"!=typeof e)
// get current matrix
return r=new n.Matrix(this).extract(),"string"==typeof e?r[e]:r;
// get current matrix
// act on matrix
if(r=new n.Matrix(this),
// ensure relative flag
t=!!t||!!e.relative,null!=e.a)r=t?
// relative
r.multiply(new n.Matrix(e)):
// absolute
new n.Matrix(e);
// act on rotation
else if(null!=e.rotation)
// ensure centre point
ensureCentre(e,this),
// apply transformation
r=t?
// relative
r.rotate(e.rotation,e.cx,e.cy):
// absolute
r.rotate(e.rotation-r.extract().rotation,e.cx,e.cy);else if(null!=e.scale||null!=e.scaleX||null!=e.scaleY){if(
// ensure centre point
ensureCentre(e,this),
// ensure scale values on both axes
e.scaleX=null!=e.scale?e.scale:null!=e.scaleX?e.scaleX:1,e.scaleY=null!=e.scale?e.scale:null!=e.scaleY?e.scaleY:1,!t){
// absolute; multiply inversed values
var a=r.extract();e.scaleX=1*e.scaleX/a.scaleX,e.scaleY=1*e.scaleY/a.scaleY}r=r.scale(e.scaleX,e.scaleY,e.cx,e.cy);
// act on skew
}else if(null!=e.skew||null!=e.skewX||null!=e.skewY){if(
// ensure centre point
ensureCentre(e,this),
// ensure skew values on both axes
e.skewX=null!=e.skew?e.skew:null!=e.skewX?e.skewX:0,e.skewY=null!=e.skew?e.skew:null!=e.skewY?e.skewY:0,!t){
// absolute; reset skew values
var a=r.extract();r=r.multiply((new n.Matrix).skew(a.skewX,a.skewY,e.cx,e.cy).inverse())}r=r.skew(e.skewX,e.skewY,e.cx,e.cy);
// act on flip
}else e.flip?("x"==e.flip||"y"==e.flip?e.offset=null==e.offset?this.bbox()["c"+e.flip]:e.offset:null==e.offset?(i=this.bbox(),e.flip=i.cx,e.offset=i.cy):e.flip=e.offset,r=(new n.Matrix).flip(e.flip,e.offset)):null==e.x&&null==e.y||(t?
// relative
r=r.translate(e.x,e.y):(
// absolute
null!=e.x&&(r.e=e.x),null!=e.y&&(r.f=e.y)));return this.attr("transform",r)}}),n.extend(n.FX,{transform:function(e,t){
// get target in case of the fx module, otherwise reference this
var r,i,a=this.target();
// act as a getter
return"object"!=typeof e?(
// get current matrix
r=new n.Matrix(a).extract(),"string"==typeof e?r[e]:r):(
// ensure relative flag
t=!!t||!!e.relative,
// act on matrix
null!=e.a?r=new n.Matrix(e):null!=e.rotation?(
// ensure centre point
ensureCentre(e,a),
// apply transformation
r=new n.Rotate(e.rotation,e.cx,e.cy)):null!=e.scale||null!=e.scaleX||null!=e.scaleY?(
// ensure centre point
ensureCentre(e,a),
// ensure scale values on both axes
e.scaleX=null!=e.scale?e.scale:null!=e.scaleX?e.scaleX:1,e.scaleY=null!=e.scale?e.scale:null!=e.scaleY?e.scaleY:1,r=new n.Scale(e.scaleX,e.scaleY,e.cx,e.cy)):null!=e.skewX||null!=e.skewY?(
// ensure centre point
ensureCentre(e,a),
// ensure skew values on both axes
e.skewX=null!=e.skewX?e.skewX:0,e.skewY=null!=e.skewY?e.skewY:0,r=new n.Skew(e.skewX,e.skewY,e.cx,e.cy)):e.flip?("x"==e.flip||"y"==e.flip?e.offset=null==e.offset?a.bbox()["c"+e.flip]:e.offset:null==e.offset?(i=a.bbox(),e.flip=i.cx,e.offset=i.cy):e.flip=e.offset,r=(new n.Matrix).flip(e.flip,e.offset)):null==e.x&&null==e.y||(r=new n.Translate(e.x,e.y)),r?(r.relative=t,this.last().transforms.push(r),this._callStart()):this)}}),n.extend(n.Element,{
// Reset all transformations
untransform:function(){return this.attr("transform",null)},
// merge the whole transformation chain into one matrix and returns it
matrixify:function(){var e=(this.attr("transform")||"").split(n.regex.transforms).slice(0,-1).map(function(e){
// generate key => value pairs
var t=e.trim().split("(");return[t[0],t[1].split(n.regex.delimiter).map(function(e){return parseFloat(e)})]}).reduce(function(e,t){return"matrix"==t[0]?e.multiply(arrayToMatrix(t[1])):e[t[0]].apply(e,t[1])},new n.Matrix);return e},
// add an element to another parent without changing the visual representation on the screen
toParent:function(e){if(this==e)return this;var t=this.screenCTM(),n=e.screenCTM().inverse();return this.addTo(e).untransform().transform(n.multiply(t)),this},
// same as above with parent equals root-svg
toDoc:function(){return this.toParent(this.doc())}}),n.Transformation=n.invent({create:function(e,t){if(arguments.length>1&&"boolean"!=typeof t)return this.constructor.call(this,[].slice.call(arguments));if(Array.isArray(e))for(var n=0,r=this.arguments.length;n<r;++n)this[this.arguments[n]]=e[n];else if("object"==typeof e)for(var n=0,r=this.arguments.length;n<r;++n)this[this.arguments[n]]=e[this.arguments[n]];this.inversed=!1,!0===t&&(this.inversed=!0)},extend:{arguments:[],method:"",at:function(e){for(var t=[],r=0,i=this.arguments.length;r<i;++r)t.push(this[this.arguments[r]]);var a=this._undo||new n.Matrix;return a=(new n.Matrix).morph(n.Matrix.prototype[this.method].apply(a,t)).at(e),this.inversed?a.inverse():a},undo:function(e){for(var t=0,r=this.arguments.length;t<r;++t)e[this.arguments[t]]=void 0===this[this.arguments[t]]?0:e[this.arguments[t]];
// The method SVG.Matrix.extract which was used before calling this
// method to obtain a value for the parameter o doesn't return a cx and
// a cy so we use the ones that were provided to this object at its creation
return e.cx=this.cx,e.cy=this.cy,this._undo=new(n[capitalize(this.method)])(e,!0).at(1),this}}}),n.Translate=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["transformedX","transformedY"],method:"translate"}}),n.Rotate=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["rotation","cx","cy"],method:"rotate",at:function(e){var t=(new n.Matrix).rotate((new n.Number).morph(this.rotation-(this._undo?this._undo.rotation:0)).at(e),this.cx,this.cy);return this.inversed?t.inverse():t},undo:function(e){return this._undo=e,this}}}),n.Scale=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["scaleX","scaleY","cx","cy"],method:"scale"}}),n.Skew=n.invent({parent:n.Matrix,inherit:n.Transformation,create:function(e,t){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:["skewX","skewY","cx","cy"],method:"skew"}}),n.extend(n.Element,{
// Dynamic style generator
style:function(e,t){if(0==arguments.length)
// get full style
return this.node.style.cssText||"";if(arguments.length<2)
// apply every style individually if an object is passed
if("object"==typeof e)for(t in e)this.style(t,e[t]);else{if(!n.regex.isCss.test(e))
// act as a getter if the first and only argument is not an object
return this.node.style[camelCase(e)];
// apply every definition individually
for(
// parse css string
e=e.split(/\s*;\s*/).filter(function(e){return!!e}).map(function(e){return e.split(/\s*:\s*/)});t=e.pop();)this.style(t[0],t[1])}else this.node.style[camelCase(e)]=null===t||n.regex.isBlank.test(t)?"":t;return this}}),n.Parent=n.invent({
// Initialize node
create:function(e){this.constructor.call(this,e)}
// Inherit from
,inherit:n.Element,extend:{
// Returns all child elements
children:function(){return n.utils.map(n.utils.filterSVGElements(this.node.childNodes),function(e){return n.adopt(e)})}
// Add given element at a position
,add:function(e,t){return null==t?this.node.appendChild(e.node):e.node!=this.node.childNodes[t]&&this.node.insertBefore(e.node,this.node.childNodes[t]),this}
// Basically does the same as `add()` but returns the added element instead
,put:function(e,t){return this.add(e,t),e}
// Checks if the given element is a child
,has:function(e){return this.index(e)>=0}
// Gets index of given element
,index:function(e){return[].slice.call(this.node.childNodes).indexOf(e.node)}
// Get a element at the given index
,get:function(e){return n.adopt(this.node.childNodes[e])}
// Get first child
,first:function(){return this.get(0)}
// Get the last child
,last:function(){return this.get(this.node.childNodes.length-1)}
// Iterates over all children and invokes a given block
,each:function(e,t){var r,i,a=this.children();for(r=0,i=a.length;r<i;r++)a[r]instanceof n.Element&&e.apply(a[r],[r,a]),t&&a[r]instanceof n.Container&&a[r].each(e,t);return this}
// Remove a given child
,removeElement:function(e){return this.node.removeChild(e.node),this}
// Remove all elements in this container
,clear:function(){
// remove children
for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);
// remove defs reference
return delete this._defs,this},// Get defs
defs:function(){return this.doc().defs()}}}),n.extend(n.Parent,{ungroup:function(e,t){return 0===t||this instanceof n.Defs||this.node==n.parser.draw?this:(e=e||(this instanceof n.Doc?this:this.parent(n.Parent)),t=t||1/0,this.each(function(){return this instanceof n.Defs?this:this instanceof n.Parent?this.ungroup(e,t-1):this.toParent(e)}),this.node.firstChild||this.remove(),this)},flatten:function(e,t){return this.ungroup(e,t)}}),n.Container=n.invent({
// Initialize node
create:function(e){this.constructor.call(this,e)}
// Inherit from
,inherit:n.Parent}),n.ViewBox=n.invent({create:function(e){var t,r,i,a,o,s,l,c=1,u=1,h=/[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?/gi;if(e instanceof n.Element){
// find nearest non-percentual dimensions
for(s=e,l=e,o=(e.attr("viewBox")||"").match(h),e.bbox,
// get dimensions of current node
i=new n.Number(e.width()),a=new n.Number(e.height());"%"==i.unit;)c*=i.value,i=new n.Number(s instanceof n.Doc?s.parent().offsetWidth:s.parent().width()),s=s.parent();for(;"%"==a.unit;)u*=a.value,a=new n.Number(l instanceof n.Doc?l.parent().offsetHeight:l.parent().height()),l=l.parent();
// ensure defaults
this.x=0,this.y=0,this.width=i*c,this.height=a*u,this.zoom=1,o&&(
// get width and height from viewbox
t=parseFloat(o[0]),r=parseFloat(o[1]),i=parseFloat(o[2]),a=parseFloat(o[3]),
// calculate zoom accoring to viewbox
this.zoom=this.width/this.height>i/a?this.height/a:this.width/i,
// calculate real pixel dimensions on parent SVG.Doc element
this.x=t,this.y=r,this.width=i,this.height=a)}else
// ensure source as object
e="string"==typeof e?e.match(h).map(function(e){return parseFloat(e)}):Array.isArray(e)?e:"object"==typeof e?[e.x,e.y,e.width,e.height]:4==arguments.length?[].slice.call(arguments):[0,0,0,0],this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},extend:{toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},morph:function(e,t,r,i){return this.destination=new n.ViewBox(e,t,r,i),this},at:function(e){return this.destination?new n.ViewBox([this.x+(this.destination.x-this.x)*e,this.y+(this.destination.y-this.y)*e,this.width+(this.destination.width-this.width)*e,this.height+(this.destination.height-this.height)*e]):this}},parent:n.Container,construct:{
// get/set viewbox
viewbox:function(e,t,r,i){return 0==arguments.length?new n.ViewBox(this):this.attr("viewBox",new n.ViewBox(e,t,r,i));
// otherwise act as a setter
}}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","touchstart","touchmove","touchleave","touchend","touchcancel"].forEach(function(e){
// add event to SVG.Element
n.Element.prototype[e]=function(t){
// bind event to element rather than element node
return n.on(this.node,e,t),this}}),
// Initialize listeners stack
n.listeners=[],n.handlerMap=[],n.listenerId=0,
// Add event binder in the SVG namespace
n.on=function(e,t,r,i,a){
// create listener, get object-index
var o=r.bind(i||e.instance||e),s=(n.handlerMap.indexOf(e)+1||n.handlerMap.push(e))-1,l=t.split(".")[0],c=t.split(".")[1]||"*";
// ensure valid object
n.listeners[s]=n.listeners[s]||{},n.listeners[s][l]=n.listeners[s][l]||{},n.listeners[s][l][c]=n.listeners[s][l][c]||{},r._svgjsListenerId||(r._svgjsListenerId=++n.listenerId),
// reference listener
n.listeners[s][l][c][r._svgjsListenerId]=o,
// add listener
e.addEventListener(l,o,a||!1)}
// Add event unbinder in the SVG namespace
,n.off=function(e,t,r){var i=n.handlerMap.indexOf(e),a=t&&t.split(".")[0],o=t&&t.split(".")[1],s="";if(-1!=i)if(r){if("function"==typeof r&&(r=r._svgjsListenerId),!r)return;
// remove listener reference
n.listeners[i][a]&&n.listeners[i][a][o||"*"]&&(
// remove listener
e.removeEventListener(a,n.listeners[i][a][o||"*"][r],!1),delete n.listeners[i][a][o||"*"][r])}else if(o&&a){
// remove all listeners for a namespaced event
if(n.listeners[i][a]&&n.listeners[i][a][o]){for(r in n.listeners[i][a][o])n.off(e,[a,o].join("."),r);delete n.listeners[i][a][o]}}else if(o)
// remove all listeners for a specific namespace
for(t in n.listeners[i])for(s in n.listeners[i][t])o===s&&n.off(e,[t,o].join("."));else if(a){
// remove all listeners for the event
if(n.listeners[i][a]){for(s in n.listeners[i][a])n.off(e,[a,s].join("."));delete n.listeners[i][a]}}else{
// remove all listeners on a given node
for(t in n.listeners[i])n.off(e,t);delete n.listeners[i],delete n.handlerMap[i]}}
//
,n.extend(n.Element,{
// Bind given event to listener
on:function(e,t,r,i){return n.on(this.node,e,t,r,i),this}
// Unbind event from listener
,off:function(e,t){return n.off(this.node,e,t),this}
// Fire given event
,fire:function(t,n){
// Dispatch event
return t instanceof e.Event?this.node.dispatchEvent(t):this.node.dispatchEvent(t=new e.CustomEvent(t,{detail:n,cancelable:!0})),this._event=t,this},event:function(){return this._event}}),n.Defs=n.invent({
// Initialize node
create:"defs",inherit:n.Container}),n.G=n.invent({
// Initialize node
create:"g",inherit:n.Container,extend:{
// Move over x-axis
x:function(e){return null==e?this.transform("x"):this.transform({x:e-this.x()},!0)}
// Move over y-axis
,y:function(e){return null==e?this.transform("y"):this.transform({y:e-this.y()},!0)}
// Move by center over x-axis
,cx:function(e){return null==e?this.gbox().cx:this.x(e-this.gbox().width/2)}
// Move by center over y-axis
,cy:function(e){return null==e?this.gbox().cy:this.y(e-this.gbox().height/2)},gbox:function(){var e=this.bbox(),t=this.transform();return e.x+=t.x,e.x2+=t.x,e.cx+=t.x,e.y+=t.y,e.y2+=t.y,e.cy+=t.y,e}},construct:{
// Create a group element
group:function(){return this.put(new n.G)}}}),
// ### This module adds backward / forward functionality to elements.
//
n.extend(n.Element,{
// Get all siblings, including myself
siblings:function(){return this.parent().children()}
// Get the curent position siblings
,position:function(){return this.parent().index(this)}
// Get the next element (will return null if there is none)
,next:function(){return this.siblings()[this.position()+1]}
// Get the next element (will return null if there is none)
,previous:function(){return this.siblings()[this.position()-1]}
// Send given element one step forward
,forward:function(){var e=this.position()+1,t=this.parent();
// move node one step forward
return t.removeElement(this).add(this,e),
// make sure defs node is always at the top
t instanceof n.Doc&&t.node.appendChild(t.defs().node),this}
// Send given element one step backward
,backward:function(){var e=this.position();return e>0&&this.parent().removeElement(this).add(this,e-1),this}
// Send given element all the way to the front
,front:function(){var e=this.parent();
// Move node forward
return e.node.appendChild(this.node),
// Make sure defs node is always at the top
e instanceof n.Doc&&e.node.appendChild(e.defs().node),this}
// Send given element all the way to the back
,back:function(){return this.position()>0&&this.parent().removeElement(this).add(this,0),this}
// Inserts a given element before the targeted element
,before:function(e){e.remove();var t=this.position();return this.parent().add(e,t),this}
// Insters a given element after the targeted element
,after:function(e){e.remove();var t=this.position();return this.parent().add(e,t+1),this}}),n.Mask=n.invent({
// Initialize node
create:function(){this.constructor.call(this,n.create("mask")),
// keep references to masked elements
this.targets=[]}
// Inherit from
,inherit:n.Container,extend:{
// Unmask all masked elements and remove itself
remove:function(){
// unmask all targets
for(var e=this.targets.length-1;e>=0;e--)this.targets[e]&&this.targets[e].unmask();return this.targets=[],
// remove mask from parent
this.parent().removeElement(this),this}},construct:{
// Create masking element
mask:function(){return this.defs().put(new n.Mask)}}}),n.extend(n.Element,{
// Distribute mask to svg element
maskWith:function(e){
// apply mask
// use given mask or create a new one
return this.masker=e instanceof n.Mask?e:this.parent().mask().add(e),
// store reverence on self in mask
this.masker.targets.push(this),this.attr("mask",'url("#'+this.masker.attr("id")+'")')}
// Unmask element
,unmask:function(){return delete this.masker,this.attr("mask",null)}}),n.ClipPath=n.invent({
// Initialize node
create:function(){this.constructor.call(this,n.create("clipPath")),
// keep references to clipped elements
this.targets=[]}
// Inherit from
,inherit:n.Container,extend:{
// Unclip all clipped elements and remove itself
remove:function(){
// unclip all targets
for(var e=this.targets.length-1;e>=0;e--)this.targets[e]&&this.targets[e].unclip();return this.targets=[],
// remove clipPath from parent
this.parent().removeElement(this),this}},construct:{
// Create clipping element
clip:function(){return this.defs().put(new n.ClipPath)}}}),
//
n.extend(n.Element,{
// Distribute clipPath to svg element
clipWith:function(e){
// apply mask
// use given clip or create a new one
return this.clipper=e instanceof n.ClipPath?e:this.parent().clip().add(e),
// store reverence on self in mask
this.clipper.targets.push(this),this.attr("clip-path",'url("#'+this.clipper.attr("id")+'")')}
// Unclip element
,unclip:function(){return delete this.clipper,this.attr("clip-path",null)}}),n.Gradient=n.invent({
// Initialize node
create:function(e){this.constructor.call(this,n.create(e+"Gradient")),
// store type
this.type=e}
// Inherit from
,inherit:n.Container,extend:{
// Add a color stop
at:function(e,t,r){return this.put(new n.Stop).update(e,t,r)}
// Update gradient
,update:function(e){
// remove all stops
return this.clear(),
// invoke passed block
"function"==typeof e&&e.call(this,this),this}
// Return the fill id
,fill:function(){return"url(#"+this.id()+")"}
// Alias string convertion to fill
,toString:function(){return this.fill()}
// custom attr to handle transform
,attr:function(e,t,r){return"transform"==e&&(e="gradientTransform"),n.Container.prototype.attr.call(this,e,t,r)}},construct:{
// Create gradient element in defs
gradient:function(e,t){return this.defs().gradient(e,t)}}}),
// Add animatable methods to both gradient and fx module
n.extend(n.Gradient,n.FX,{
// From position
from:function(e,t){return"radial"==(this._target||this).type?this.attr({fx:new n.Number(e),fy:new n.Number(t)}):this.attr({x1:new n.Number(e),y1:new n.Number(t)})}
// To position
,to:function(e,t){return"radial"==(this._target||this).type?this.attr({cx:new n.Number(e),cy:new n.Number(t)}):this.attr({x2:new n.Number(e),y2:new n.Number(t)})}}),
// Base gradient generation
n.extend(n.Defs,{
// define gradient
gradient:function(e,t){return this.put(new n.Gradient(e)).update(t)}}),n.Stop=n.invent({
// Initialize node
create:"stop",inherit:n.Element,extend:{
// add color stops
update:function(e){return("number"==typeof e||e instanceof n.Number)&&(e={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),
// set attributes
null!=e.opacity&&this.attr("stop-opacity",e.opacity),null!=e.color&&this.attr("stop-color",e.color),null!=e.offset&&this.attr("offset",new n.Number(e.offset)),this}}}),n.Pattern=n.invent({
// Initialize node
create:"pattern",inherit:n.Container,extend:{
// Return the fill id
fill:function(){return"url(#"+this.id()+")"}
// Update pattern by rebuilding
,update:function(e){
// remove content
return this.clear(),
// invoke passed block
"function"==typeof e&&e.call(this,this),this}
// Alias string convertion to fill
,toString:function(){return this.fill()}
// custom attr to handle transform
,attr:function(e,t,r){return"transform"==e&&(e="patternTransform"),n.Container.prototype.attr.call(this,e,t,r)}},construct:{
// Create pattern element in defs
pattern:function(e,t,n){return this.defs().pattern(e,t,n)}}}),n.extend(n.Defs,{
// Define gradient
pattern:function(e,t,r){return this.put(new n.Pattern).update(r).attr({x:0,y:0,width:e,height:t,patternUnits:"userSpaceOnUse"})}}),n.Doc=n.invent({
// Initialize node
create:function(e){e&&(
// ensure the presence of a dom element
// If the target is an svg element, use that element as the main wrapper.
// This allows svg.js to work with svg documents as well.
"svg"==(e="string"==typeof e?t.getElementById(e):e).nodeName?this.constructor.call(this,e):(this.constructor.call(this,n.create("svg")),e.appendChild(this.node),this.size("100%","100%")),
// set svg element attributes and ensure defs node
this.namespace().defs())}
// Inherit from
,inherit:n.Container,extend:{
// Add namespaces
namespace:function(){return this.attr({xmlns:n.ns,version:"1.1"}).attr("xmlns:xlink",n.xlink,n.xmlns).attr("xmlns:svgjs",n.svgjs,n.xmlns)}
// Creates and returns defs element
,defs:function(){var e;
// Find or create a defs element in this instance
this._defs||((e=this.node.getElementsByTagName("defs")[0])?this._defs=n.adopt(e):this._defs=new n.Defs,
// Make sure the defs node is at the end of the stack
this.node.appendChild(this._defs.node));return this._defs}
// custom parent method
,parent:function(){return"#document"==this.node.parentNode.nodeName?null:this.node.parentNode}
// Fix for possible sub-pixel offset. See:
// https://bugzilla.mozilla.org/show_bug.cgi?id=608812
,spof:function(){var e=this.node.getScreenCTM();return e&&this.style("left",-e.e%1+"px").style("top",-e.f%1+"px"),this}
// Removes the doc from the DOM
,remove:function(){return this.parent()&&this.parent().removeChild(this.node),this},clear:function(){
// remove children
for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);
// remove defs reference
return delete this._defs,
// add back parser
n.parser.draw.parentNode||this.node.appendChild(n.parser.draw),this}}}),n.Shape=n.invent({
// Initialize node
create:function(e){this.constructor.call(this,e)}
// Inherit from
,inherit:n.Element}),n.Bare=n.invent({
// Initialize
create:function(e,t){
// inherit custom methods
if(
// construct element
this.constructor.call(this,n.create(e)),t)for(var r in t.prototype)"function"==typeof t.prototype[r]&&(this[r]=t.prototype[r])}
// Inherit from
,inherit:n.Element,extend:{
// Insert some plain text
words:function(e){
// remove contents
for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);
// create text node
return this.node.appendChild(t.createTextNode(e)),this}}}),n.extend(n.Parent,{
// Create an element that is not described by SVG.js
element:function(e,t){return this.put(new n.Bare(e,t))}}),n.Symbol=n.invent({
// Initialize node
create:"symbol",inherit:n.Container,construct:{
// create symbol
symbol:function(){return this.put(new n.Symbol)}}}),n.Use=n.invent({
// Initialize node
create:"use",inherit:n.Shape,extend:{
// Use element as a reference
element:function(e,t){
// Set lined element
return this.attr("href",(t||"")+"#"+e,n.xlink)}},construct:{
// Create a use element
use:function(e,t){return this.put(new n.Use).element(e,t)}}}),n.Rect=n.invent({
// Initialize node
create:"rect",inherit:n.Shape,construct:{
// Create a rect element
rect:function(e,t){return this.put(new n.Rect).size(e,t)}}}),n.Circle=n.invent({
// Initialize node
create:"circle",inherit:n.Shape,construct:{
// Create circle element, based on ellipse
circle:function(e){return this.put(new n.Circle).rx(new n.Number(e).divide(2)).move(0,0)}}}),n.extend(n.Circle,n.FX,{
// Radius x value
rx:function(e){return this.attr("r",e)}
// Alias radius x value
,ry:function(e){return this.rx(e)}}),n.Ellipse=n.invent({
// Initialize node
create:"ellipse",inherit:n.Shape,construct:{
// Create an ellipse
ellipse:function(e,t){return this.put(new n.Ellipse).size(e,t).move(0,0)}}}),n.extend(n.Ellipse,n.Rect,n.FX,{
// Radius x value
rx:function(e){return this.attr("rx",e)}
// Radius y value
,ry:function(e){return this.attr("ry",e)}}),
// Add common method
n.extend(n.Circle,n.Ellipse,{
// Move over x-axis
x:function(e){return null==e?this.cx()-this.rx():this.cx(e+this.rx())}
// Move over y-axis
,y:function(e){return null==e?this.cy()-this.ry():this.cy(e+this.ry())}
// Move by center over x-axis
,cx:function(e){return null==e?this.attr("cx"):this.attr("cx",e)}
// Move by center over y-axis
,cy:function(e){return null==e?this.attr("cy"):this.attr("cy",e)}
// Set width of element
,width:function(e){return null==e?2*this.rx():this.rx(new n.Number(e).divide(2))}
// Set height of element
,height:function(e){return null==e?2*this.ry():this.ry(new n.Number(e).divide(2))}
// Custom size function
,size:function(e,t){var r=proportionalSize(this,e,t);return this.rx(new n.Number(r.width).divide(2)).ry(new n.Number(r.height).divide(2))}}),n.Line=n.invent({
// Initialize node
create:"line",inherit:n.Shape,extend:{
// Get array
array:function(){return new n.PointArray([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])}
// Overwrite native plot() method
,plot:function(e,t,r,i){return null==e?this.array():(e=void 0!==t?{x1:e,y1:t,x2:r,y2:i}:new n.PointArray(e).toLine(),this.attr(e))}
// Move by left top corner
,move:function(e,t){return this.attr(this.array().move(e,t).toLine())}
// Set element size to given width and height
,size:function(e,t){var n=proportionalSize(this,e,t);return this.attr(this.array().size(n.width,n.height).toLine())}},construct:{
// Create a line element
line:function(e,t,r,i){
// make sure plot is called as a setter
// x1 is not necessarily a number, it can also be an array, a string and a SVG.PointArray
return n.Line.prototype.plot.apply(this.put(new n.Line),null!=e?[e,t,r,i]:[0,0,0,0])}}}),n.Polyline=n.invent({
// Initialize node
create:"polyline",inherit:n.Shape,construct:{
// Create a wrapped polyline element
polyline:function(e){
// make sure plot is called as a setter
return this.put(new n.Polyline).plot(e||new n.PointArray)}}}),n.Polygon=n.invent({
// Initialize node
create:"polygon",inherit:n.Shape,construct:{
// Create a wrapped polygon element
polygon:function(e){
// make sure plot is called as a setter
return this.put(new n.Polygon).plot(e||new n.PointArray)}}}),
// Add polygon-specific functions
n.extend(n.Polyline,n.Polygon,{
// Get array
array:function(){return this._array||(this._array=new n.PointArray(this.attr("points")))}
// Plot new path
,plot:function(e){return null==e?this.array():this.clear().attr("points","string"==typeof e?e:this._array=new n.PointArray(e))}
// Clear array cache
,clear:function(){return delete this._array,this}
// Move by left top corner
,move:function(e,t){return this.attr("points",this.array().move(e,t))}
// Set element size to given width and height
,size:function(e,t){var n=proportionalSize(this,e,t);return this.attr("points",this.array().size(n.width,n.height))}}),
// unify all point to point elements
n.extend(n.Line,n.Polyline,n.Polygon,{
// Define morphable array
morphArray:n.PointArray,x:function(e){return null==e?this.bbox().x:this.move(e,this.bbox().y)}
// Move by left top corner over y-axis
,y:function(e){return null==e?this.bbox().y:this.move(this.bbox().x,e)}
// Set width of element
,width:function(e){var t=this.bbox();return null==e?t.width:this.size(e,t.height)}
// Set height of element
,height:function(e){var t=this.bbox();return null==e?t.height:this.size(t.width,e)}}),n.Path=n.invent({
// Initialize node
create:"path",inherit:n.Shape,extend:{
// Define morphable array
morphArray:n.PathArray,array:function(){return this._array||(this._array=new n.PathArray(this.attr("d")))}
// Plot new path
,plot:function(e){return null==e?this.array():this.clear().attr("d","string"==typeof e?e:this._array=new n.PathArray(e))}
// Clear array cache
,clear:function(){return delete this._array,this}
// Move by left top corner
,move:function(e,t){return this.attr("d",this.array().move(e,t))}
// Move by left top corner over x-axis
,x:function(e){return null==e?this.bbox().x:this.move(e,this.bbox().y)}
// Move by left top corner over y-axis
,y:function(e){return null==e?this.bbox().y:this.move(this.bbox().x,e)}
// Set element size to given width and height
,size:function(e,t){var n=proportionalSize(this,e,t);return this.attr("d",this.array().size(n.width,n.height))}
// Set width of element
,width:function(e){return null==e?this.bbox().width:this.size(e,this.bbox().height)}
// Set height of element
,height:function(e){return null==e?this.bbox().height:this.size(this.bbox().width,e)}},construct:{
// Create a wrapped path element
path:function(e){
// make sure plot is called as a setter
return this.put(new n.Path).plot(e||new n.PathArray)}}}),n.Image=n.invent({
// Initialize node
create:"image",inherit:n.Shape,extend:{
// (re)load image
load:function(t){if(!t)return this;var r=this,i=new e.Image;
// preload image
return n.on(i,"load",function(){var e=r.parent(n.Pattern);null!==e&&(
// ensure image size
0==r.width()&&0==r.height()&&r.size(i.width,i.height),
// ensure pattern size if not set
e&&0==e.width()&&0==e.height()&&e.size(r.width(),r.height()),
// callback
"function"==typeof r._loaded&&r._loaded.call(r,{width:i.width,height:i.height,ratio:i.width/i.height,url:t}))}),n.on(i,"error",function(e){"function"==typeof r._error&&r._error.call(r,e)}),this.attr("href",i.src=this.src=t,n.xlink)}
// Add loaded callback
,loaded:function(e){return this._loaded=e,this},error:function(e){return this._error=e,this}},construct:{
// create image element, load image and set its size
image:function(e,t,r){return this.put(new n.Image).load(e).size(t||0,r||t||0)}}}),n.Text=n.invent({
// Initialize node
create:function(){this.constructor.call(this,n.create("text")),this.dom.leading=new n.Number(1.3),// store leading value for rebuilding
this._rebuild=!0,// enable automatic updating of dy values
this._build=!1,// disable build mode for adding multiple lines
// set default font
this.attr("font-family",n.defaults.attrs["font-family"])}
// Inherit from
,inherit:n.Shape,extend:{
// Move over x-axis
x:function(e){
// act as getter
return null==e?this.attr("x"):this.attr("x",e)}
// Move over y-axis
,y:function(e){var t=this.attr("y"),n="number"==typeof t?t-this.bbox().y:0;
// act as getter
return null==e?"number"==typeof t?t-n:t:this.attr("y","number"==typeof e?e+n:e)}
// Move center over x-axis
,cx:function(e){return null==e?this.bbox().cx:this.x(e-this.bbox().width/2)}
// Move center over y-axis
,cy:function(e){return null==e?this.bbox().cy:this.y(e-this.bbox().height/2)}
// Set the text content
,text:function(e){
// act as getter
if(void 0===e){for(var e="",t=this.node.childNodes,r=0,i=t.length;r<i;++r)
// add newline if its not the first child and newLined is set to true
0!=r&&3!=t[r].nodeType&&1==n.adopt(t[r]).dom.newLined&&(e+="\n"),
// add content of this node
e+=t[r].textContent;return e}
// remove existing content
if(this.clear().build(!0),"function"==typeof e)
// call block
e.call(this,this);else
// build new lines
for(var r=0,a=(
// store text and make sure text is not blank
e=e.split("\n")).length;r<a;r++)this.tspan(e[r]).newLine();
// disable build mode and rebuild lines
return this.build(!1).rebuild()}
// Set font size
,size:function(e){return this.attr("font-size",e).rebuild()}
// Set / get leading
,leading:function(e){
// act as getter
return null==e?this.dom.leading:(
// act as setter
this.dom.leading=new n.Number(e),this.rebuild())}
// Get all the first level lines
,lines:function(){var e=(this.textPath&&this.textPath()||this).node,t=n.utils.map(n.utils.filterSVGElements(e.childNodes),function(e){return n.adopt(e)});
// filter tspans and map them to SVG.js instances
// return an instance of SVG.set
return new n.Set(t)}
// Rebuild appearance type
,rebuild:function(e){
// define position of all lines
if(
// store new rebuild flag if given
"boolean"==typeof e&&(this._rebuild=e),this._rebuild){var t=this,r=0,i=this.dom.leading*new n.Number(this.attr("font-size"));this.lines().each(function(){this.dom.newLined&&(t.textPath()||this.attr("x",t.attr("x")),"\n"==this.text()?r+=i:(this.attr("dy",i+r),r=0))}),this.fire("rebuild")}return this}
// Enable / disable build mode
,build:function(e){return this._build=!!e,this}
// overwrite method from parent to set data properly
,setData:function(e){return this.dom=e,this.dom.leading=new n.Number(e.leading||1.3),this}},construct:{
// Create text element
text:function(e){return this.put(new n.Text).text(e)}
// Create plain text element
,plain:function(e){return this.put(new n.Text).plain(e)}}}),n.Tspan=n.invent({
// Initialize node
create:"tspan",inherit:n.Shape,extend:{
// Set text content
text:function(e){return null==e?this.node.textContent+(this.dom.newLined?"\n":""):("function"==typeof e?e.call(this,this):this.plain(e),this)}
// Shortcut dx
,dx:function(e){return this.attr("dx",e)}
// Shortcut dy
,dy:function(e){return this.attr("dy",e)}
// Create new line
,newLine:function(){
// fetch text parent
var e=this.parent(n.Text);
// mark new line
// apply new hyï¿½n
return this.dom.newLined=!0,this.dy(e.dom.leading*e.attr("font-size")).attr("x",e.x())}}}),n.extend(n.Text,n.Tspan,{
// Create plain text node
plain:function(e){
// clear if build mode is disabled
return!1===this._build&&this.clear(),
// create text node
this.node.appendChild(t.createTextNode(e)),this}
// Create a tspan
,tspan:function(e){var t=(this.textPath&&this.textPath()||this).node,r=new n.Tspan;
// clear if build mode is disabled
return!1===this._build&&this.clear(),
// add new tspan
t.appendChild(r.node),r.text(e)}
// Clear all lines
,clear:function(){
// remove existing child nodes
for(var e=(this.textPath&&this.textPath()||this).node;e.hasChildNodes();)e.removeChild(e.lastChild);return this}
// Get length of text element
,length:function(){return this.node.getComputedTextLength()}}),n.TextPath=n.invent({
// Initialize node
create:"textPath",inherit:n.Parent,parent:n.Text,construct:{morphArray:n.PathArray,path:function(e){
// move lines to textpath
for(
// create textPath element
var t=new n.TextPath,r=this.doc().defs().path(e);this.node.hasChildNodes();)t.node.appendChild(this.node.firstChild);
// add textPath element as child node
return this.node.appendChild(t.node),
// link textPath to path and add content
t.attr("href","#"+r,n.xlink),this}
// return the array of the path track element
,array:function(){var e=this.track();return e?e.array():null}
// Plot path if any
,plot:function(e){var t=this.track(),n=null;return t&&(n=t.plot(e)),null==e?n:this}
// Get the path track element
,track:function(){var e=this.textPath();if(e)return e.reference("href")}
// Get the textPath child
,textPath:function(){if(this.node.firstChild&&"textPath"==this.node.firstChild.nodeName)return n.adopt(this.node.firstChild)}}}),n.Nested=n.invent({
// Initialize node
create:function(){this.constructor.call(this,n.create("svg")),this.style("overflow","visible")}
// Inherit from
,inherit:n.Container,construct:{
// Create nested svg document
nested:function(){return this.put(new n.Nested)}}}),n.A=n.invent({
// Initialize node
create:"a",inherit:n.Container,extend:{
// Link url
to:function(e){return this.attr("href",e,n.xlink)}
// Link show attribute
,show:function(e){return this.attr("show",e,n.xlink)}
// Link target attribute
,target:function(e){return this.attr("target",e)}},construct:{
// Create a hyperlink element
link:function(e){return this.put(new n.A).to(e)}}}),n.extend(n.Element,{
// Create a hyperlink element
linkTo:function(e){var t=new n.A;return"function"==typeof e?e.call(t,t):t.to(e),this.parent().put(t).put(this)}}),n.Marker=n.invent({
// Initialize node
create:"marker",inherit:n.Container,extend:{
// Set width of element
width:function(e){return this.attr("markerWidth",e)}
// Set height of element
,height:function(e){return this.attr("markerHeight",e)}
// Set marker refX and refY
,ref:function(e,t){return this.attr("refX",e).attr("refY",t)}
// Update marker
,update:function(e){
// remove all content
return this.clear(),
// invoke passed block
"function"==typeof e&&e.call(this,this),this}
// Return the fill id
,toString:function(){return"url(#"+this.id()+")"}},construct:{marker:function(e,t,n){
// Create marker element in defs
return this.defs().marker(e,t,n)}}}),n.extend(n.Defs,{
// Create marker
marker:function(e,t,r){
// Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto
return this.put(new n.Marker).size(e,t).ref(e/2,t/2).viewbox(0,0,e,t).attr("orient","auto").update(r)}}),n.extend(n.Line,n.Polyline,n.Polygon,n.Path,{
// Create and attach markers
marker:function(e,t,r,i){var a=["marker"];
// Build attribute name
return"all"!=e&&a.push(e),a=a.join("-"),
// Set marker attribute
e=arguments[1]instanceof n.Marker?arguments[1]:this.doc().marker(t,r,i),this.attr(a,e)}});
// Define list of available attributes for stroke and fill
var s={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(e,t){return"color"==t?e:e+"-"+t}};function pathRegReplace(e,t,r,i){return r+i.replace(n.regex.dots," .")}function camelCase(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})}
// Capitalize first letter of a string
function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function compToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}
// Calculate proportional width and height values when necessary
function proportionalSize(e,t,n){if(null==t||null==n){var r=e.bbox();null==t?t=r.width/r.height*n:null==n&&(n=r.height/r.width*t)}return{width:t,height:n}}
// Delta transform point
function deltaTransformPoint(e,t,n){return{x:t*e.a+n*e.c+0,y:t*e.b+n*e.d+0}}
// Map matrix array to object
function arrayToMatrix(e){return{a:e[0],b:e[1],c:e[2],d:e[3],e:e[4],f:e[5]}}function ensureCentre(e,t){e.cx=null==e.cx?t.bbox().cx:e.cx,e.cy=null==e.cy?t.bbox().cy:e.cy}function fullBox(e){return null==e.x&&(e.x=0,e.y=0,e.width=0,e.height=0),e.w=e.width,e.h=e.height,e.x2=e.x+e.width,e.y2=e.y+e.height,e.cx=e.x+e.width/2,e.cy=e.y+e.height/2,e}
// Get id from reference string
["fill","stroke"].forEach(function(e){var t,r={};r[e]=function(r){if(void 0===r)return this;if("string"==typeof r||n.Color.isRgb(r)||r&&"function"==typeof r.fill)this.attr(e,r);else
// set all attributes from sugar.fill and sugar.stroke list
for(t=s[e].length-1;t>=0;t--)null!=r[s[e][t]]&&this.attr(s.prefix(e,s[e][t]),r[s[e][t]]);return this},n.extend(n.Element,n.FX,r)}),n.extend(n.Element,n.FX,{
// Map rotation to transform
rotate:function(e,t,n){return this.transform({rotation:e,cx:t,cy:n})}
// Map skew to transform
,skew:function(e,t,n,r){return 1==arguments.length||3==arguments.length?this.transform({skew:e,cx:t,cy:n}):this.transform({skewX:e,skewY:t,cx:n,cy:r})}
// Map scale to transform
,scale:function(e,t,n,r){return 1==arguments.length||3==arguments.length?this.transform({scale:e,cx:t,cy:n}):this.transform({scaleX:e,scaleY:t,cx:n,cy:r})}
// Map translate to transform
,translate:function(e,t){return this.transform({x:e,y:t})}
// Map flip to transform
,flip:function(e,t){return t="number"==typeof e?e:t,this.transform({flip:e||"both",offset:t})}
// Map matrix to transform
,matrix:function(e){return this.attr("transform",new n.Matrix(6==arguments.length?[].slice.call(arguments):e))}
// Opacity
,opacity:function(e){return this.attr("opacity",e)}
// Relative move over x axis
,dx:function(e){return this.x(new n.Number(e).plus(this instanceof n.FX?0:this.x()),!0)}
// Relative move over y axis
,dy:function(e){return this.y(new n.Number(e).plus(this instanceof n.FX?0:this.y()),!0)}
// Relative move over x and y axes
,dmove:function(e,t){return this.dx(e).dy(t)}}),n.extend(n.Rect,n.Ellipse,n.Circle,n.Gradient,n.FX,{
// Add x and y radius
radius:function(e,t){var r=(this._target||this).type;return"radial"==r||"circle"==r?this.attr("r",new n.Number(e)):this.rx(e).ry(null==t?e:t)}}),n.extend(n.Path,{
// Get path length
length:function(){return this.node.getTotalLength()}
// Get point at length
,pointAt:function(e){return this.node.getPointAtLength(e)}}),n.extend(n.Parent,n.Text,n.Tspan,n.FX,{
// Set font
font:function(e,t){if("object"==typeof e)for(t in e)this.font(t,e[t]);return"leading"==e?this.leading(t):"anchor"==e?this.attr("text-anchor",t):"size"==e||"family"==e||"weight"==e||"stretch"==e||"variant"==e||"style"==e?this.attr("font-"+e,t):this.attr(e,t)}}),n.Set=n.invent({
// Initialize
create:function(e){
// Set initial state
Array.isArray(e)?this.members=e:this.clear()}
// Add class methods
,extend:{
// Add element to set
add:function(){var e,t,n=[].slice.call(arguments);for(e=0,t=n.length;e<t;e++)this.members.push(n[e]);return this}
// Remove element from set
,remove:function(e){var t=this.index(e);
// remove given child
return t>-1&&this.members.splice(t,1),this}
// Iterate over all members
,each:function(e){for(var t=0,n=this.members.length;t<n;t++)e.apply(this.members[t],[t,this.members]);return this}
// Restore to defaults
,clear:function(){
// initialize store
return this.members=[],this}
// Get the length of a set
,length:function(){return this.members.length}
// Checks if a given element is present in set
,has:function(e){return this.index(e)>=0}
// retuns index of given element in set
,index:function(e){return this.members.indexOf(e)}
// Get member at given index
,get:function(e){return this.members[e]}
// Get first member
,first:function(){return this.get(0)}
// Get last member
,last:function(){return this.get(this.members.length-1)}
// Default value
,valueOf:function(){return this.members}
// Get the bounding box of all members included or empty box if set has no items
,bbox:function(){
// return an empty box of there are no members
if(0==this.members.length)return new n.RBox;
// get the first rbox and update the target bbox
var e=this.members[0].rbox(this.members[0].doc());return this.each(function(){
// user rbox for correct position and visual representation
e=e.merge(this.rbox(this.doc()))}),e}},construct:{
// Create a new set
set:function(e){return new n.Set(e)}}}),n.FX.Set=n.invent({
// Initialize node
create:function(e){
// store reference to set
this.set=e}}),
// Alias methods
n.Set.inherit=function(){var e=[];
// gather shape methods
for(var t in n.Shape.prototype)"function"==typeof n.Shape.prototype[t]&&"function"!=typeof n.Set.prototype[t]&&e.push(t);
// apply shape aliasses
// gather fx methods
for(var t in e.forEach(function(e){n.Set.prototype[e]=function(){for(var t=0,r=this.members.length;t<r;t++)this.members[t]&&"function"==typeof this.members[t][e]&&this.members[t][e].apply(this.members[t],arguments);return"animate"==e?this.fx||(this.fx=new n.FX.Set(this)):this}}),
// clear methods for the next round
e=[],n.FX.prototype)"function"==typeof n.FX.prototype[t]&&"function"!=typeof n.FX.Set.prototype[t]&&e.push(t);
// apply fx aliasses
e.forEach(function(e){n.FX.Set.prototype[e]=function(){for(var t=0,n=this.set.members.length;t<n;t++)this.set.members[t].fx[e].apply(this.set.members[t].fx,arguments);return this}})},n.extend(n.Element,{
// Store data values on svg nodes
data:function(e,t,n){if("object"==typeof e)for(t in e)this.data(t,e[t]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+e))}catch(t){return this.attr("data-"+e)}else this.attr("data-"+e,null===t?null:!0===n||"string"==typeof t||"number"==typeof t?t:JSON.stringify(t));return this}}),n.extend(n.Element,{
// Remember arbitrary data
remember:function(e,t){
// remember every item in an object individually
if("object"==typeof arguments[0])for(var t in e)this.remember(t,e[t]);
// retrieve memory
else{if(1==arguments.length)return this.memory()[e];
// store memory
this.memory()[e]=t}return this}
// Erase a given memory
,forget:function(){if(0==arguments.length)this._memory={};else for(var e=arguments.length-1;e>=0;e--)delete this.memory()[arguments[e]];return this}
// Initialize or return local memory object
,memory:function(){return this._memory||(this._memory={})}}),
// Method for getting an element by id
n.get=function(e){var r=t.getElementById(function idFromReference(e){var t=e.toString().match(n.regex.reference);if(t)return t[1]}
// Create matrix array for looping
(e)||e);return n.adopt(r)}
// Select elements by query string
,n.select=function(e,r){return new n.Set(n.utils.map((r||t).querySelectorAll(e),function(e){return n.adopt(e)}))},n.extend(n.Parent,{
// Scoped select method
select:function(e){return n.select(e,this.node)}});var l="abcdef".split("");
// Add CustomEvent to IE9 and IE10
if("function"!=typeof e.CustomEvent){
// Code from: https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent
var c=function(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var r=t.createEvent("CustomEvent");return r.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),r};c.prototype=e.Event.prototype,e.CustomEvent=c}
// requestAnimationFrame / cancelAnimationFrame Polyfill with fallback based on Paul Irish
// requestAnimationFrame / cancelAnimationFrame Polyfill with fallback based on Paul Irish
return function(t){for(var n=0,r=["moz","webkit"],i=0;i<r.length&&!e.requestAnimationFrame;++i)t.requestAnimationFrame=t[r[i]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[r[i]+"CancelAnimationFrame"]||t[r[i]+"CancelRequestAnimationFrame"];t.requestAnimationFrame=t.requestAnimationFrame||function(e){var r=(new Date).getTime(),i=Math.max(0,16-(r-n)),a=t.setTimeout(function(){e(r+i)},i);return n=r+i,a},t.cancelAnimationFrame=t.cancelAnimationFrame||t.clearTimeout}(e),n}(i,i.document)}.call(t,n,t,e))||(e.exports=r)}("undefined"!=typeof window?window:this)},
/* 9 */
/***/function(e,t,n){"use strict";
/* harmony import */var r=n(1),i=function(e){r.ShaderMaterial.call(this,e),this.type="InstancedShaderMaterial",this.defines||(this.defines={}),this.uniforms.envMap&&this.uniforms.envMap.value?(this.envMap=this.uniforms.envMap.value,this.hasEnvMap=1):(this.envMap=null,this.hasEnvMap=0),this.isInstanced=!0};(i.prototype=Object.create(r.ShaderMaterial.prototype)).constructor=i,Object.defineProperties(i.prototype,{isInstanced:{get:function(){return""===this.defines.INSTANCING},set:function(e){e?this.defines.INSTANCING="":delete this.defines.INSTANCING}},useMap:{get:function(){return null!==this.defines.USE_MAP&&void 0!==this.defines.USE_MAP}},useColor:{get:function(){return null!==this.defines.USE_COLOR&&void 0!==this.defines.USE_COLOR}}}),i.prototype.clone=function(){return(new i).shallowCopy(this)},i.prototype.shallowCopy=function(e){for(var t in r.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=e.uniforms,this.clipping=e.clipping,this.clipShadows=e.clipShadows,this.clippingPlanes=e.clippingPlanes,this.combine=e.combine,this.envMap=e.envMap||!1,this.hasEnvMap=e.hasEnvMap,this.defines={},e.defines)this.defines[t]=e.defines[t];return this.flatShading=e.flatShading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},/* harmony default export */t.a=i},
/* 10 */
/***/function(e,t,n){"use strict";
/* harmony import */var r=n(1);
/**
 * @preserve
 * @author WestLangley / http://github.com/WestLangley
 * @author Mark Doud   / https://www.siemens.com/plm
 *
 * Change Log:
 *
 * 2018-09-26   Mark Doud           ES6ified the file.
 *
 *
 * parameters = {
 *  color: <hex>,
 *  linewidth: <float>,
 *  dashed: <boolean>,
 *  dashScale: <float>,
 *  dashSize: <float>,
 *  gapSize: <float>,
 *  resolution: <Vector2>, // to be set by renderer
 * }
 */r.UniformsLib.line={linewidth:{value:1},resolution:{value:new r.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},r.ShaderLib.line={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var i=function(e){r.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:r.UniformsUtils.clone(r.ShaderLib.line.uniforms),vertexShader:r.ShaderLib.line.vertexShader,fragmentShader:r.ShaderLib.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};(i.prototype=Object.create(r.ShaderMaterial.prototype)).constructor=i,i.prototype.isLineMaterial=!0,i.prototype.copy=function(e){
// todo
return r.ShaderMaterial.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.resolution=e.resolution,this},
/* harmony default export */t.a=i},
/* 11 */
/***/function(e,t,n){"use strict";
/* unused harmony export BodReader */
/* harmony export (binding) */n.d(t,"a",function(){return h});
/* harmony import */var r=n(4),i=/* */n.n(r),a=i()("PLMVisWeb:error:BodWorker");
/* harmony import */a.enabled=!0;var o=i()("PLMVisWeb:warning:BodWorker"),s={normalize:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},cross:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},subtract:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},add:function(e,t,n){return void 0===n?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:[e[0]+t[0]+n[0],e[1]+t[1]+n[1],e[2]+t[2]+n[2]]},scale:function(e,t){return[e[0]*t,e[1]*t,e[2]*t]},interpolate:function(e,t,n,r,i,a){return this.add(this.scale(e,r),this.scale(t,i),this.scale(n,a))},product:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},norm:function(e){return Math.sqrt(this.product(e,e))},angle:function(e,t){var n=this.product(e,t),r=this.norm(e),i=this.norm(t);return 180*Math.acos(n/(r*i))/Math.PI}};function _finalizeResults(e,t){e&&(t.push(e.controlPointIndex.buffer),t.push(e.controlPointBuffer.buffer),t.push(e.normalIndex.buffer),t.push(e.normalBuffer.buffer),t.push(e.vertexIndex.buffer),t.push(e.vertexBuffer.buffer),t.push(e.groupCountBuffer.buffer),t.push(e.groupStartBuffer.buffer))}var l=1/255;function _getXTBody(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].bodyId===t)return e[n];var i={bodyId:t,faces:[]};return e.push(i),i}function _processCurvedTrianglesFlat(e,t){var n,r=e.dv,i=e.results.buffers[e.results.buffers.length-1],a=0,o=i.numGroups,s=0,l=0,c=0,u=0,h=null,d=null,p=null,f=null,m=0,g=null,v=null,y=null;i.vertexBuffer=[],i.normalBuffer=[],i.indexBuffer=[],i.groupStartBuffer=[],i.groupCountBuffer=[],i.materialIndexBuffer=[],t&&(y=[],[],i.xtBodies=y),h=i.vertexBuffer,d=i.normalBuffer,p=i.indexBuffer,f=i.groupStartBuffer,g=i.groupCountBuffer,v=i.materialIndexBuffer,i.hasVertexColors?(i.vertexColorBuffer=[],i.vertexColorBuffer):i.hasTextureUVs&&(i.uvCoordinatesBuffer=[],i.uvCoordinatesBuffer);var b=[];for(a=0;a<o;++a){var x=null;if(t){(x={}).faceId=r.getInt32(e.byteOffset,!0),e.byteOffset+=4;var _=r.getUint16(e.byteOffset,!0);e.byteOffset+=2,x.bodyId=_,_getXTBody(y,_).faces.push(x)}c=r.getInt32(e.byteOffset,!0),e.byteOffset+=4,v.push(c),s=r.getUint32(e.byteOffset,!0),e.byteOffset+=4,x&&(x.start=p.length,x.groupIndex=f.length),f.push(p.length),m=0;for(var w=0;w<s;++w)p.push(r.getUint32(e.byteOffset,!0)/3),e.byteOffset+=4,e.byteOffset+=4,b.push(r.getUint32(e.byteOffset,!0)/3),e.byteOffset+=4,m++,u++;x&&(x.count=m),g.push(m)}for(n=r.getUint32(e.byteOffset,!0),e.byteOffset+=4,l=0;l<n;++l)h.push(r.getFloat32(e.byteOffset,!0)),h.push(r.getFloat32(e.byteOffset+4,!0)),h.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var M=r.getUint32(e.byteOffset,!0);e.byteOffset+=4,e.byteOffset+=12*M;var E=r.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var S=[],L=0;L<E;++L)S.push(r.getFloat32(e.byteOffset,!0)),S.push(r.getFloat32(e.byteOffset+4,!0)),S.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var T=p.length;d[h.length-1]=void 0;for(var A=0;A<T;++A)void 0===d[3*p[A]]?(d[3*p[A]]=S[3*b[A]],d[3*p[A]+1]=S[3*b[A]+1],d[3*p[A]+2]=S[3*b[A]+2]):(h.push(h[3*p[A]]),h.push(h[3*p[A]+1]),h.push(h[3*p[A]+2]),d.push(S[3*b[A]]),d.push(S[3*b[A]+1]),d.push(S[3*b[A]+2]),p[A]=h.length/3-1);return i.maxIdx=u,i}function _processCurvedTriangles(e,t){var n=6;(function isNumeric(e){return!isNaN(e)&&isFinite(e)})(e.lod)&&(n=e.lod);var r=e.dv,i=e.results.buffers[e.results.buffers.length-1];e.curvedBuffers={controlPointIndex:[],controlPointBuffer:[],normalIndex:[],normalBuffer:[],vertexIndex:[],vertexBuffer:[],groupCountBuffer:[],groupStartBuffer:[],lod:n};var a,o=e.curvedBuffers,s=0,l=i.numGroups,c=0,u=0,h=0,d=0,p=null,f=null,m=null,g=null,v=0,y=null,b=null,x=null;i.vertexBuffer=[],i.normalBuffer=[],i.indexBuffer=[],i.groupStartBuffer=[],i.groupCountBuffer=[],i.materialIndexBuffer=[],t&&(x=[],[],i.xtBodies=x),p=i.vertexBuffer,f=i.normalBuffer,m=i.indexBuffer,g=i.groupStartBuffer,y=i.groupCountBuffer,b=i.materialIndexBuffer,o.groupCountBuffer=y,o.groupStartBuffer=g,i.hasVertexColors?(i.vertexColorBuffer=[],i.vertexColorBuffer):i.hasTextureUVs&&(i.uvCoordinatesBuffer=[],i.uvCoordinatesBuffer);var _=o.controlPointIndex,w=o.normalIndex,M=o.vertexIndex;for(s=0;s<l;++s){var E=null;if(t){(E={}).faceId=r.getInt32(e.byteOffset,!0),e.byteOffset+=4;var S=r.getUint16(e.byteOffset,!0);e.byteOffset+=2,E.bodyId=S,_getXTBody(x,S).faces.push(E)}h=r.getInt32(e.byteOffset,!0),e.byteOffset+=4,b.push(h),c=r.getUint32(e.byteOffset,!0),e.byteOffset+=4,E&&(E.start=M.length*(n+1)*(n+1),E.groupIndex=g.length),g.push(M.length*(n+1)*(n+1)),v=0;for(var L=0;L<c;++L)M.push(r.getUint32(e.byteOffset,!0)/3),_.push(r.getUint32(e.byteOffset+4,!0)/3),e.byteOffset+=8,i.curvedUseNormal&&(w.push(r.getUint32(e.byteOffset,!0)/3),e.byteOffset+=4),v+=(n+1)*(n+1),d+=(n+1)*(n+1);E&&(E.count=v),y.push(v)}a=r.getUint32(e.byteOffset,!0),e.byteOffset+=4;var T=o.vertexBuffer;for(u=0;u<a;++u)T.push(r.getFloat32(e.byteOffset,!0)),T.push(r.getFloat32(e.byteOffset+4,!0)),T.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var A=r.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var C=o.controlPointBuffer,P=0;P<A;++P)C.push(r.getFloat32(e.byteOffset,!0)),C.push(r.getFloat32(e.byteOffset+4,!0)),C.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var I=o.normalBuffer;if(i.curvedUseNormal){var O=r.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var B=0;B<O;++B)I.push(r.getFloat32(e.byteOffset,!0)),I.push(r.getFloat32(e.byteOffset+4,!0)),I.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12}i.maxIdx=d,o.maxIdx=d;var R={};R.curvedBuffers=o,_refine(R,n);for(var G=0,D=R.indices.length;G<D;++G)m.push(R.indices[G]);for(G=0,D=R.positions.length;G<D;++G)p.push(R.positions[G]),f.push(R.normals[G]);return i}function _processV8TriStrips(e,t){var n,r=e.dv,i=e.results.buffers[e.results.buffers.length-1],a=0,o=i.numGroups,s=0,c=0,u=0,h=0,d=0,p=0,f=null,m=null,g=null,v=0,y=null,b=null,x=null,_=0,w=null,M=0,E=[0,0,0],S=null;for(i.vertexBuffer=[],i.normalBuffer=[],i.indexBuffer=[],i.groupStartBuffer=[],i.groupCountBuffer=[],i.materialIndexBuffer=[],t&&(S=[],[],i.xtBodies=S),f=i.vertexBuffer,m=i.normalBuffer,n=i.indexBuffer,g=i.groupStartBuffer,y=i.groupCountBuffer,b=i.materialIndexBuffer,i.hasVertexColors?(i.vertexColorBuffer=[],w=i.vertexColorBuffer):i.hasTextureUVs&&(i.uvCoordinatesBuffer=[],x=i.uvCoordinatesBuffer),a=0;a<o;++a){var L,T=null;if(t)(T={}).faceId=r.getInt32(e.byteOffset,!0),e.byteOffset+=4,i.useBodyIDs?(L=r.getUint32(e.byteOffset,!0),e.byteOffset+=4):(L=r.getUint16(e.byteOffset,!0),e.byteOffset+=2),T.bodyId=L,_getXTBody(S,L).faces.push(T);for(d=r.getInt32(e.byteOffset,!0),e.byteOffset+=4,b.push(d),c=r.getUint32(e.byteOffset,!0),e.byteOffset+=4,T&&(T.start=n.length,T.groupIndex=g.length),g.push(n.length),v=0,s=0;s<c;++s)for(u=r.getUint16(e.byteOffset,!0),e.byteOffset+=2,h=0;h<u;++h){var A=0;if(i.usesPooling){var C=h%8;0===C&&(M=r.getUint8(e.byteOffset,!0),e.byteOffset+=1),(A=0==(M&1<<C))?E[h>1?2:h%3]=p++:(E[h>2?2:h%3]=r.getUint32(e.byteOffset,!0),e.byteOffset+=4)}else E[h>1?2:h%3]=p++;h>1&&(h%2==1&&E.reverse(),Array.prototype.push.apply(n,E),v+=3,h%2==1&&E.reverse(),E[0]=E[1],E[1]=E[2]),(!i.usesPooling||i.usesPooling&&A)&&(f.push(r.getFloat32(e.byteOffset,!0)),f.push(r.getFloat32(e.byteOffset+4,!0)),f.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12,m.push(r.getFloat32(e.byteOffset,!0)),m.push(r.getFloat32(e.byteOffset+4,!0)),m.push(r.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12,i.hasVertexColors?(_=r.getUint32(e.byteOffset,!0)>>8,e.byteOffset+=4,w.push(((16711680&_)>>16)*l),w.push(((65280&_)>>8)*l),w.push((255&_)*l)):i.hasTextureUVs&&(x.push(r.getFloat32(e.byteOffset,!0)),x.push(r.getFloat32(e.byteOffset+4,!0)),e.byteOffset+=8))}T&&(T.count=v),y.push(v)}return i.maxIdx=p,i}function _processV8LineStrips(e){var t=e.dv,n=e.results.buffers[e.results.buffers.length-1],r=0,i=n.numGroups,a=0,o=0,s=0,c=0,u=0,h=0,d=null,p=null,f=null,m=0,g=null,v=null,y=0,b=null,x=0;for(n.vertexBuffer=[],n.indexBuffer=[],n.groupStartBuffer=[],n.groupCountBuffer=[],n.materialIndexBuffer=[],d=n.vertexBuffer,p=n.indexBuffer,f=n.groupStartBuffer,g=n.groupCountBuffer,v=n.materialIndexBuffer,n.hasVertexColors&&(n.vertexColorBuffer=[],b=n.vertexColorBuffer),r=0;r<i;++r){for(u=t.getInt32(e.byteOffset,!0),e.byteOffset+=4,v.push(u),o=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,f.push(p.length),m=0,a=0;a<o;++a)for(h+(a>0||r>0?1:0),s=t.getUint16(e.byteOffset,!0),e.byteOffset+=2,c=0;c<s;++c){c>1&&(p.push(p[p.length-1]),m++);var _=0;if(n.usesPooling){var w=c%8;0===w&&(x=t.getUint8(e.byteOffset,!0),e.byteOffset+=1),(_=0==(x&1<<w))?p.push(h++):(p.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4)}else p.push(h++);m++,(!n.usesPooling||n.usesPooling&&_)&&(d.push(t.getFloat32(e.byteOffset,!0)),d.push(t.getFloat32(e.byteOffset+4,!0)),d.push(t.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12,n.hasVertexColors&&(y=t.getUint32(e.byteOffset,!0)>>8,e.byteOffset+=4,b.push(((16711680&y)>>16)*l),b.push(((65280&y)>>8)*l),b.push((255&y)*l)))}g.push(m)}n.maxIdx=h}function _processV8BinaryData(e){var t=e.dv,n=e.results;n.numMaterials=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,n.numBuffers=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,n.numMaterials>0&&function _processV8Materials(e){var t=e.dv,n=e.results;n.materials={};var r=n.materials,i=0,a=n.numMaterials,o=null,s=0,l=0,c=null,u=0,h=[],d=-1;for(i=0;i<a;++i){switch(s=t.getUint8(e.byteOffset,!0),e.byteOffset+=1,h[i]={type:s,internalIndex:-1},s){case 0:void 0===r.phong&&(r.phong={index:[],diffuse:[],emissive:[],specular:[],shininess:[]}),(o=r.phong).diffuse.push(t.getUint32(e.byteOffset,!0)),o.emissive.push(t.getUint32(e.byteOffset+4,!0)),o.specular.push(t.getUint32(e.byteOffset+8,!0)),o.shininess.push(t.getFloat32(e.byteOffset+12,!0)),e.byteOffset+=16;break;case 1:void 0===r.flat&&(r.flat={index:[],diffuse:[]}),(o=r.flat).diffuse.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4;break;case 3:void 0===r.line&&(r.line={index:[],color:[]}),(o=r.line).color.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4;break;case 2:void 0===r.texture&&(r.texture={index:[],texB64Data:[]}),o=r.texture,l=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,c=new Uint8Array(t.buffer),o.texB64Data.push(c.subarray(e.byteOffset,e.byteOffset+l)),e.byteOffset+=l;break;case 4:void 0===r.spheremap&&(r.spheremap={blendType:[],blendColor:[],index:[],texB64Data:[]}),(o=r.spheremap).blendType.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.blendColor.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,l=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,c=new Uint8Array(t.buffer),o.texB64Data.push(c.subarray(e.byteOffset,e.byteOffset+l)),e.byteOffset+=l;break;case 5:for(void 0===r.cubemap&&(r.cubemap={blendType:[],blendColor:[],index:[],texB64Data:[]}),(o=r.cubemap).blendType.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.blendColor.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,u=0;u<6;++u)l=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,c=new Uint8Array(t.buffer),o.texB64Data.push(c.subarray(e.byteOffset,e.byteOffset+l)),e.byteOffset+=l;break;case 6:void 0===r.texpair&&(r.texpair={baseMaterialType:[],baseMaterialIndex:[],textureMaterialType:[],textureMaterialIndex:[],index:[]}),(o=r.texpair).baseMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.textureMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,d=o.baseMaterialIndex.length-1,o.baseMaterialType.push(4294967295===o.baseMaterialIndex[d]?-1:h[o.baseMaterialIndex[d]].type),o.textureMaterialType.push(4294967295===o.textureMaterialIndex[d]?-1:h[o.textureMaterialIndex[d]].type),4294967295!==o.baseMaterialIndex[d]&&(o.baseMaterialIndex[d]=h[o.baseMaterialIndex[d]].internalIndex),4294967295!==o.textureMaterialIndex[d]&&(o.textureMaterialIndex[d]=h[o.textureMaterialIndex[d]].internalIndex);break;case 7:void 0===r.textriplet&&(r.textriplet={baseMaterialType:[],baseMaterialIndex:[],uvMaterialIndex:[],envMaterialType:[],envMaterialIndex:[],index:[]}),(o=r.textriplet).baseMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.uvMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.envMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,d=o.baseMaterialIndex.length-1,o.baseMaterialType.push(4294967295===o.baseMaterialIndex[d]?-1:h[o.baseMaterialIndex[d]].type),o.envMaterialType.push(4294967295===o.envMaterialIndex[d]?-1:h[o.envMaterialIndex[d]].type),4294967295!==o.baseMaterialIndex[d]&&(o.baseMaterialIndex[d]=h[o.baseMaterialIndex[d]].internalIndex),4294967295!==o.uvMaterialIndex[d]&&(o.uvMaterialIndex[d]=h[o.uvMaterialIndex[d]].internalIndex),4294967295!==o.envMaterialIndex[d]&&(o.envMaterialIndex[d]=h[o.envMaterialIndex[d]].internalIndex);break;default:throw{name:"BOD material processing error",message:"Unsupported material type: "+s.toString()}}o.index.push(i),h[i].internalIndex=o.index.length-1}}(e);var r=null;n.numBuffers>0&&(r=function _processV8Buffers(e){var t=null,n=e.dv,r=e.results;r.buffers=[];var i=r.buffers,a=null,o=0,s=r.numBuffers,l=0;for(o=0;o<s;++o){switch(i.push({}),a=i[o],l=n.getUint8(e.byteOffset,!0),e.byteOffset+=1,a.geometryType=3&l,a.curvedUseNormal=(32&l)>0,a.curvedFlat=(64&l)>0,l&=252,a.usesPooling=(4&l)>0,a.hasTextureUVs=(8&l)>0,a.hasVertexColors=(16&l)>0,a.useBodyIDs=(32&l)>0,a.numGroups=n.getUint16(e.byteOffset,!0,e.lod),e.byteOffset+=2,a.geometryType){case 0:_processV8TriStrips(e,!1);break;case 1:_processV8LineStrips(e);break;case 2:t=_processV8TriStrips(e,!0);break;case 3:t=a.curvedFlat?_processCurvedTrianglesFlat(e,!0):_processCurvedTriangles(e,!0);break;default:throw{name:"BOD processing error",message:"Invalid thisBuffer type: "+a.geometryType.toString()}}delete a.usesPooling}return t}(e)),r&&function _processXTEdgeMap(e,t){var n=e.byteOffset,r=e.dv,i=r.getUint16(n,!0);if(n+=2,i>0){for(var a=[],o=0,s=e.results.buffers.length;o<s;o++)for(var l=0,c=e.results.buffers[o].xtBodies.length;l<c;l++)a.push(e.results.buffers[o].xtBodies[l]);for(var u=0;u<i;u++){var h=_getXTBody(a,r.getInt32(n,!0));n+=4;var d=r.getUint16(n,!0);if(n+=2,d>0){for(var p={},f={},m=0,g=0,v=0;v<d;v++){var y=r.getInt32(n,!0);n+=4;var b=r.getInt32(n,!0);n+=4;var x=r.getInt32(n,!0);n+=4,b<0||x<0?(p[y]=Math.max(b,x),g++):b>0&&x>0&&(f[y]={f1:b,f2:x},m++)}h&&(g>0&&(h.nonManifoldEdgeMap=p,h.nonManifoldEdgeMapSize=g),m>0&&(h.manifoldEdgeMap=f,h.manifoldEdgeMapSize=m))}}}e.byteOffset=n}(e),function _finalizeV8Data(e){var t,n=e.results.materials,r=e.results.buffers,i=null,a=0,o=e.ports;if(n){if(n.phong&&(n.phong.index=new Uint32Array(n.phong.index),o.push(n.phong.index.buffer),n.phong.diffuse=new Uint32Array(n.phong.diffuse),o.push(n.phong.diffuse.buffer),n.phong.emissive=new Uint32Array(n.phong.emissive),o.push(n.phong.emissive.buffer),n.phong.specular=new Uint32Array(n.phong.specular),o.push(n.phong.specular.buffer),n.phong.shininess=new Float32Array(n.phong.shininess),o.push(n.phong.shininess.buffer)),n.flat&&(n.flat.index=new Uint32Array(n.flat.index),o.push(n.flat.index.buffer),n.flat.diffuse=new Uint32Array(n.flat.diffuse),o.push(n.flat.diffuse.buffer)),n.texture){n.texture.index=new Uint32Array(n.texture.index),o.push(n.texture.index.buffer);for(var s=0,l=n.texture.index.length;s<l;++s)n.texture.texB64Data[s]=new Uint8Array(n.texture.texB64Data[s]),o.push(n.texture.texB64Data[s].buffer)}if(n.spheremap)for(n.spheremap.index=new Uint32Array(n.spheremap.index),o.push(n.spheremap.index.buffer),n.spheremap.blendType=new Uint32Array(n.spheremap.blendType),o.push(n.spheremap.blendType.buffer),n.spheremap.blendColor=new Uint32Array(n.spheremap.blendColor),o.push(n.spheremap.blendColor.buffer),s=0,l=n.spheremap.index.length;s<l;++s)n.spheremap.texB64Data[s]=new Uint8Array(n.spheremap.texB64Data[s]),o.push(n.spheremap.texB64Data[s].buffer);if(n.cubemap)for(n.cubemap.index=new Uint32Array(n.cubemap.index),o.push(n.cubemap.index.buffer),n.cubemap.blendType=new Uint32Array(n.cubemap.blendType),o.push(n.cubemap.blendType.buffer),n.cubemap.blendColor=new Uint32Array(n.cubemap.blendColor),o.push(n.cubemap.blendColor.buffer),s=0,l=n.cubemap.texB64Data.length;s<l;++s)n.cubemap.texB64Data[s]=new Uint8Array(n.cubemap.texB64Data[s]),o.push(n.cubemap.texB64Data[s].buffer);n.texpair&&(n.texpair.index=new Uint32Array(n.texpair.index),o.push(n.texpair.index.buffer),n.texpair.baseMaterialIndex=new Uint32Array(n.texpair.baseMaterialIndex),o.push(n.texpair.baseMaterialIndex.buffer),n.texpair.baseMaterialType=new Uint32Array(n.texpair.baseMaterialType),o.push(n.texpair.baseMaterialType.buffer),n.texpair.textureMaterialIndex=new Uint32Array(n.texpair.textureMaterialIndex),o.push(n.texpair.textureMaterialIndex.buffer),n.texpair.textureMaterialType=new Uint32Array(n.texpair.textureMaterialType),o.push(n.texpair.textureMaterialType.buffer)),n.textriplet&&(n.textriplet.index=new Uint32Array(n.textriplet.index),o.push(n.textriplet.index.buffer),n.textriplet.baseMaterialIndex=new Uint32Array(n.textriplet.baseMaterialIndex),o.push(n.textriplet.baseMaterialIndex.buffer),n.textriplet.baseMaterialType=new Uint32Array(n.textriplet.baseMaterialType),o.push(n.textriplet.baseMaterialType.buffer),n.textriplet.uvMaterialIndex=new Uint32Array(n.textriplet.uvMaterialIndex),o.push(n.textriplet.uvMaterialIndex.buffer),n.textriplet.envMaterialIndex=new Uint32Array(n.textriplet.envMaterialIndex),o.push(n.textriplet.envMaterialIndex.buffer),n.textriplet.envMaterialType=new Uint32Array(n.textriplet.envMaterialType),o.push(n.textriplet.envMaterialType.buffer))}for(a=0,t=e.results.numBuffers;a<t;++a)(i=r[a]).vertexBuffer=new Float32Array(i.vertexBuffer),o.push(i.vertexBuffer.buffer),i.maxIdx<65536?i.indexBuffer=new Uint16Array(i.indexBuffer):i.indexBuffer=new Uint32Array(i.indexBuffer),o.push(i.indexBuffer.buffer),i.groupStartBuffer=new Uint32Array(i.groupStartBuffer),o.push(i.groupStartBuffer.buffer),i.groupCountBuffer=new Uint32Array(i.groupCountBuffer),o.push(i.groupCountBuffer.buffer),i.normalBuffer&&(i.normalBuffer=new Float32Array(i.normalBuffer),o.push(i.normalBuffer.buffer)),i.vertexColorBuffer?(i.vertexColorBuffer=new Float32Array(i.vertexColorBuffer),o.push(i.vertexColorBuffer.buffer)):i.materialIndexBuffer&&(i.materialIndexBuffer=new Int32Array(i.materialIndexBuffer),o.push(i.materialIndexBuffer.buffer)),i.uvCoordinatesBuffer&&(i.uvCoordinatesBuffer=new Float32Array(i.uvCoordinatesBuffer),o.push(i.uvCoordinatesBuffer.buffer));delete e.byteOffset}(e)}function _refine(e,t){var n=e.curvedBuffers,r=(t+1)*(t+1),i=(e.curvedBuffers.lod+1)*(e.curvedBuffers.lod+1);e.groupCountBuffer=new Int32Array(e.curvedBuffers.groupCountBuffer.length),e.groupStartBuffer=new Int32Array(e.curvedBuffers.groupStartBuffer.length);var a=(t*t+5*t+6)/2;e.positions=new Float32Array(a*n.vertexIndex.length),e.normals=new Float32Array(a*n.vertexIndex.length),e.indices=new Uint32Array(r*n.vertexIndex.length);for(var o=0,l=n.groupCountBuffer.length;o<l;++o)e.groupCountBuffer[o]=e.curvedBuffers.groupCountBuffer[o]*r/i;for(o=0,l=n.groupStartBuffer.length;o<l;++o)e.groupStartBuffer[o]=e.curvedBuffers.groupStartBuffer[o]*r/i;e.maxIdx=e.curvedBuffers.maxIdx*r/i;var c=[],u=[],h=[],d=t+1,p=1/d;for(o=0;o<d+1;o++)for(var f=0;f<o+1;f++)c.push(1-p*o),h.push(p*f),u.push(p*o-p*f);for(var m=c.length,g=[],v=[],y=[],b=[],x=[],_=[],w=0;w<m;w++)g.push(c[w]*c[w]),v.push(u[w]*u[w]),y.push(h[w]*h[w]),b.push(c[w]*u[w]),x.push(c[w]*h[w]),_.push(u[w]*h[w]);var M=[0,1,2];for(o=1;o<d;o++){var E=2*o+1,S=.5*o*(o+1),L=o+1,T=[S,S+L,S+L+1],A=[S,S+L+1,S+1];M.push(T[0]),M.push(T[1]),M.push(T[2]),M.push(A[0]),M.push(A[1]),M.push(A[2]);var C=!0,P=1;for(f=2;f<E;f++)if(C){C=!1;var I=s.add(T,[P,P,P]);M.push(I[0]),M.push(I[1]),M.push(I[2])}else{C=!0;I=s.add(A,[P,P,P]);M.push(I[0]),M.push(I[1]),M.push(I[2]),P++}}var O=M.length;function getAVertex(e){return[n.vertexBuffer[3*e],n.vertexBuffer[3*e+1],n.vertexBuffer[3*e+2]]}function getControlPoint(e){return[n.controlPointBuffer[3*e],n.controlPointBuffer[3*e+1],n.controlPointBuffer[3*e+2]]}function getNormal(e){return[n.normalBuffer[3*e],n.normalBuffer[3*e+1],n.normalBuffer[3*e+2]]}var B=n.vertexIndex.length/3,R=0,G=0;for(o=0;o<B;++o){var D,V,N,U=R/3,F=getAVertex(n.vertexIndex[3*o]),z=getAVertex(n.vertexIndex[3*o+1]),k=getAVertex(n.vertexIndex[3*o+2]),j=getControlPoint(n.controlPointIndex[3*o+1]),H=getControlPoint(n.controlPointIndex[3*o+2]),W=getControlPoint(n.controlPointIndex[3*o]),X=!1;D=getNormal(n.normalIndex[3*o]),V=getNormal(n.normalIndex[3*o+1]),N=getNormal(n.normalIndex[3*o+2]),n.normalIndex[3*o]===n.normalIndex[3*o+1]&&n.normalIndex[3*o+1]===n.normalIndex[3*o+2]&&(X=!0);var q=s.normalize(s.add(D,V)),Y=s.normalize(s.add(V,N)),Z=s.normalize(s.add(D,N));for(f=0;f<m;f++){var J,Q;J=s.add(s.interpolate(F,z,k,g[f],v[f],y[f]),s.interpolate(j,H,W,2*b[f],2*_[f],2*x[f])),Q=X?D:s.add(s.interpolate(D,V,N,g[f],v[f],y[f]),s.interpolate(q,Y,Z,2*b[f],2*_[f],2*x[f])),e.positions[R]=J[0],e.positions[R+1]=J[1],e.positions[R+2]=J[2],e.normals[R]=Q[0],e.normals[R+1]=Q[1],e.normals[R+2]=Q[2],R+=3}if(X)for(ie=0;ie<O;ie+=3){var K=[e.normals[3*(U+M[ie])],e.normals[3*(U+M[ie])+1],e.normals[3*(U+M[ie])+2]],$=[e.positions[3*(U+M[ie])],e.positions[3*(U+M[ie])+1],e.positions[3*(U+M[ie])+2]],ee=[e.positions[3*(U+M[ie+1])],e.positions[3*(U+M[ie+1])+1],e.positions[3*(U+M[ie+1])+2]],te=[e.positions[3*(U+M[ie+2])],e.positions[3*(U+M[ie+2])+1],e.positions[3*(U+M[ie+2])+2]],ne=s.subtract($,te),re=s.subtract(ee,$);u=s.cross(ne,re);s.product(u,K)<0?(e.indices[G]=U+M[ie+1],e.indices[G+1]=U+M[ie],e.indices[G+2]=U+M[ie+2]):(e.indices[G]=U+M[ie],e.indices[G+1]=U+M[ie+1],e.indices[G+2]=U+M[ie+2]),G+=3}else for(var ie=0;ie<O;ie++)e.indices[G]=U+M[ie],G++}}var c=function(){};c.prototype.processBinaryData=function _processBinaryData(e){var t=e.dv;e.byteOffset+=6;var n=t.getUint16(e.byteOffset,!0);e.byteOffset+=2;var r=null;n>=8&&(r=t.getUint32(e.byteOffset,!0),e.byteOffset+=4);var i=t.getUint32(e.byteOffset,!0);switch(e.byteOffset+=4,i>0&&function _processDelta(e){var t=e.dv,n=t.getUint32(e.byteOffset,!0);if(e.byteOffset+=4,n>0){var r={};e.results.delta=r;for(var i=0;i<n;i++){var a={created:[],modified:[],deleted:[]},o=t.getUint32(e.byteOffset,!0);e.byteOffset+=4,r[o]=a,a.bodyId=o;var s=t.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var l=0;l<s;l++){var c=t.getUint32(e.byteOffset,!0);e.byteOffset+=4;var u=t.getUint8(e.byteOffset,!0);e.byteOffset+=1;for(var h=0;h<c;h++){var d=t.getUint32(e.byteOffset,!0);switch(e.byteOffset+=4,u){case 1:a.created.push(d);break;case 2:a.modified.push(d);break;case 3:a.deleted.push(d)}}}}}}(e),n){case 8:_processV8BinaryData(e);break;default:throw{name:"BOD processing error",message:"Unsupported BOD version: "+n.toString()+(null!==r?"."+r:"")}}var a=e.curvedBuffers;a&&(a.controlPointIndex=new Uint32Array(a.controlPointIndex),a.controlPointBuffer=new Float32Array(a.controlPointBuffer),a.normalIndex=new Uint32Array(a.normalIndex),a.normalBuffer=new Float32Array(a.normalBuffer),a.vertexIndex=new Uint32Array(a.vertexIndex),a.vertexBuffer=new Float32Array(a.vertexBuffer),a.groupCountBuffer=new Uint32Array(a.groupCountBuffer),a.groupStartBuffer=new Uint32Array(a.groupStartBuffer),e.results.curvedBuffers=a,_finalizeResults(a,e.ports))},c.prototype.refine=_refine;var u=new c,h={processMessage:function(e,t){var n={dv:null,lod:e.lod,results:{},ports:[],byteOffset:0,url:e.url||"base64"};if(e.shape){var r=e.shape,i=[];u.refine(r,e.lod),_finalizeResults(r.curvedBuffers,i),i.push(r.groupCountBuffer.buffer),i.push(r.groupStartBuffer.buffer),r.positions&&i.push(r.positions.buffer),r.normals&&i.push(r.normals.buffer),r.indices&&i.push(r.indices.buffer),t(r,i)}else if(e.binaryData)try{n.dv=new DataView(e.binaryData),u.processBinaryData(n),n.results.index=e.index,t(n.results,n.ports)}catch(e){a("%s - %s",e.name,e.message),t()}else if(e.url){var s=e.url,l=e.method||"GET",c=this.networkManager.createHttpRequest(l,s);c.responseType="arraybuffer",e.arguments&&e.arguments.contentType?c.setContentType(e.arguments.contentType):c.setContentType("text/plain"),c.onprogress=function(e){if(e.lengthComputable){var n={url:s,loaded:e.loaded};t({isProgressEvent:!0,progressEvent:n},null,!0)}},c.onsuccess=function(){if(c.response)if(c.response.byteLength>0){var e=new DataView(c.response);n.dv=e,n.results.index=0;var r=function(e){var t={byteOffset:0,offsets:[]};if("PLMBOD"==""+String.fromCharCode(e.getUint8(t.byteOffset,!0))+String.fromCharCode(e.getUint8(t.byteOffset+1,!0))+String.fromCharCode(e.getUint8(t.byteOffset+2,!0))+String.fromCharCode(e.getUint8(t.byteOffset+3,!0))+String.fromCharCode(e.getUint8(t.byteOffset+4,!0))+String.fromCharCode(e.getUint8(t.byteOffset+5,!0)))return t;var n=e.getUint32(t.byteOffset,!0);t.byteOffset+=4;var r=0;if(n>0)for(var i=0;i<n;i++){var a=e.getUint32(t.byteOffset,!0);t.byteOffset+=4,t.offsets.push({start:r,length:a}),r+=a}return t}(e);if(0===r.offsets.length)u.processBinaryData(n),t(n.results,n.ports);else for(var i=0,a=r.offsets.length;i<a;i++){var l=r.offsets[i];n.dv=e,n.byteOffset=l.start+r.byteOffset,n.results={},n.ports.length=0,n.results.index=i,u.processBinaryData(n),t(n.results,n.ports,i<a-1)}}else t(null,null);else o("Failed to receive HttpRequest data!",s),t()},c.onerror=function(){a("Failed to retrieve."+e.url),t()};var h=null;e.arguments&&(h=JSON.stringify(e.arguments)),c.send(h)}else if(e.base64Data)try{var d={b64Str:function _ab2str(e){for(var t=new Uint16Array(e),n="",r=0,i=t.length;r<i;r+=65535)n+=r+65535>i?String.fromCharCode.apply(null,t.subarray(r,r+(i-r))):String.fromCharCode.apply(null,t.subarray(r,r+65535));return n}(e.base64Data,e.url)};delete e.base64Data,n.dv=new DataView(function _decodeBase64ToBinaryBuffer(e){if(void 0!==e.b64Str){for(var t=atob(e.b64Str),n=[],r=0,i=t.length;r<i;++r)n.push(t.charCodeAt(r));t=null,e.binData=new Uint8Array(n).buffer}else e.binData=void 0}(d,e.url)),u.processBinaryData(n),t(n.results,n.ports)}catch(e){a("%s - %s",e.name,e.message),t()}}}},
/* 12 */
/***/function(e,t,n){"use strict";
// http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string
var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),n=n.getBlob()}catch(t){
// The proposed API
n=new Blob([e])}return new Worker(r.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},
/* 13 */
/***/function(e,t,n){"use strict";
/* WEBPACK VAR INJECTION */
/* WEBPACK VAR INJECTION */(function(e){
/**
 * A collection of shims that provide minimal functionality of the ES6 collections.
 *
 * These implementations are not meant to be used outside of the ResizeObserver
 * modules as they cover only a limited range of use cases.
 */
/* eslint-disable require-jsdoc, valid-jsdoc */
var n=function(){if("undefined"!=typeof Map)return Map;
/**
     * Returns index in provided array that matches the specified key.
     *
     * @param {Array<Array>} arr
     * @param {*} key
     * @returns {number}
     */function getIndex(e,t){var n=-1;return e.some(function(e,r){return e[0]===t&&(n=r,!0)}),n}return/** @class */function(){function class_1(){this.__entries__=[]}return Object.defineProperty(class_1.prototype,"size",{
/**
             * @returns {boolean}
             */
get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),
/**
         * @param {*} key
         * @returns {*}
         */
class_1.prototype.get=function(e){var t=getIndex(this.__entries__,e),n=this.__entries__[t];return n&&n[1]},
/**
         * @param {*} key
         * @param {*} value
         * @returns {void}
         */
class_1.prototype.set=function(e,t){var n=getIndex(this.__entries__,e);~n?this.__entries__[n][1]=t:this.__entries__.push([e,t])},
/**
         * @param {*} key
         * @returns {void}
         */
class_1.prototype.delete=function(e){var t=this.__entries__,n=getIndex(t,e);~n&&t.splice(n,1)},
/**
         * @param {*} key
         * @returns {void}
         */
class_1.prototype.has=function(e){return!!~getIndex(this.__entries__,e)},
/**
         * @returns {void}
         */
class_1.prototype.clear=function(){this.__entries__.splice(0)},
/**
         * @param {Function} callback
         * @param {*} [ctx=null]
         * @returns {void}
         */
class_1.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,r=this.__entries__;n<r.length;n++){var i=r[n];e.call(t,i[1],i[0])}},class_1}()}(),r="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,i=void 0!==e&&e.Math===Math?e:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),a="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(i):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)},o=2;
/**
 * Detects whether window and document objects are available in current environment.
 */
// Minimum delay before invoking the update of observers.
var s=20,l=["top","right","bottom","left","width","height","size","weight"],c="undefined"!=typeof MutationObserver,u=/** @class */function(){
/**
     * Creates a new instance of ResizeObserverController.
     *
     * @private
     */
function ResizeObserverController(){
/**
         * Indicates whether DOM listeners have been added.
         *
         * @private {boolean}
         */
this.connected_=!1,
/**
         * Tells that controller has subscribed for Mutation Events.
         *
         * @private {boolean}
         */
this.mutationEventsAdded_=!1,
/**
         * Keeps reference to the instance of MutationObserver.
         *
         * @private {MutationObserver}
         */
this.mutationsObserver_=null,
/**
         * A list of connected observers.
         *
         * @private {Array<ResizeObserverSPI>}
         */
this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=
/**
 * Creates a wrapper function which ensures that provided callback will be
 * invoked only once during the specified delay period.
 *
 * @param {Function} callback - Function to be invoked after the delay period.
 * @param {number} delay - Delay after which to invoke callback.
 * @returns {Function}
 */
function throttle(e,t){var n=!1,r=!1,i=0;
/**
     * Invokes the original callback function and schedules new invocation if
     * the "proxy" was called during current request.
     *
     * @returns {void}
     */function resolvePending(){n&&(n=!1,e()),r&&proxy()}
/**
     * Callback invoked after the specified delay. It will further postpone
     * invocation of the original function delegating it to the
     * requestAnimationFrame.
     *
     * @returns {void}
     */function timeoutCallback(){a(resolvePending)}
/**
     * Schedules invocation of the original function.
     *
     * @returns {void}
     */function proxy(){var e=Date.now();if(n){
// Reject immediately following calls.
if(e-i<o)return;
// Schedule new call to be in invoked when the pending one is resolved.
// This is important for "transitions" which never actually start
// immediately so there is a chance that we might miss one if change
// happens amids the pending invocation.
r=!0}else n=!0,r=!1,setTimeout(timeoutCallback,t);i=e}return proxy}(this.refresh.bind(this),s)}
/**
     * Adds observer to observers list.
     *
     * @param {ResizeObserverSPI} observer - Observer to be added.
     * @returns {void}
     */return ResizeObserverController.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),
// Add listeners if they haven't been added yet.
this.connected_||this.connect_()},
/**
     * Removes observer from observers list.
     *
     * @param {ResizeObserverSPI} observer - Observer to be removed.
     * @returns {void}
     */
ResizeObserverController.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);
// Remove observer if it's present in registry.
~n&&t.splice(n,1),
// Remove listeners if controller has no connected observers.
!t.length&&this.connected_&&this.disconnect_()},
/**
     * Invokes the update of observers. It will continue running updates insofar
     * it detects changes.
     *
     * @returns {void}
     */
ResizeObserverController.prototype.refresh=function(){
// Continue running updates if changes have been detected as there might
// be future ones caused by CSS transitions.
this.updateObservers_()&&this.refresh()},
/**
     * Updates every observer from observers list and notifies them of queued
     * entries.
     *
     * @private
     * @returns {boolean} Returns "true" if any observer has detected changes in
     *      dimensions of it's elements.
     */
ResizeObserverController.prototype.updateObservers_=function(){
// Collect observers that have active observations.
var e=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});
// Deliver notifications in a separate cycle in order to avoid any
// collisions between observers, e.g. when multiple instances of
// ResizeObserver are tracking the same element and the callback of one
// of them changes content dimensions of the observed target. Sometimes
// this may result in notifications being blocked for the rest of observers.
return e.forEach(function(e){return e.broadcastActive()}),e.length>0},
/**
     * Initializes DOM listeners.
     *
     * @private
     * @returns {void}
     */
ResizeObserverController.prototype.connect_=function(){
// Do nothing if running in a non-browser environment or if listeners
// have been already added.
r&&!this.connected_&&(
// Subscription to the "Transitionend" event is used as a workaround for
// delayed transitions. This way it's possible to capture at least the
// final state of an element.
document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),c?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},
/**
     * Removes DOM listeners.
     *
     * @private
     * @returns {void}
     */
ResizeObserverController.prototype.disconnect_=function(){
// Do nothing if running in a non-browser environment or if listeners
// have been already removed.
r&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},
/**
     * "Transitionend" event handler.
     *
     * @private
     * @param {TransitionEvent} event
     * @returns {void}
     */
ResizeObserverController.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;
// Detect whether transition may affect dimensions of an element.
l.some(function(e){return!!~n.indexOf(e)})&&this.refresh()},
/**
     * Returns instance of the ResizeObserverController.
     *
     * @returns {ResizeObserverController}
     */
ResizeObserverController.getInstance=function(){return this.instance_||(this.instance_=new ResizeObserverController),this.instance_},
/**
     * Holds reference to the controller's instance.
     *
     * @private {ResizeObserverController}
     */
ResizeObserverController.instance_=null,ResizeObserverController}(),h=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},d=function(e){
// Return the local global object if it's not possible extract one from
// provided element.
return e&&e.ownerDocument&&e.ownerDocument.defaultView||i},p=createRectInit(0,0,0,0);
// A list of substrings of CSS properties used to find transition events that
// might affect dimensions of observed elements.
/**
 * Converts provided string to a number.
 *
 * @param {number|string} value
 * @returns {number}
 */
function toFloat(e){return parseFloat(e)||0}
/**
 * Extracts borders size from provided styles.
 *
 * @param {CSSStyleDeclaration} styles
 * @param {...string} positions - Borders positions (top, right, ...)
 * @returns {number}
 */function getBordersSize(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(t,n){return t+toFloat(e["border-"+n+"-width"])},0)}
/**
 * Extracts paddings sizes from provided styles.
 *
 * @param {CSSStyleDeclaration} styles
 * @returns {Object} Paddings box.
 */
/**
 * Calculates content rectangle of provided HTMLElement.
 *
 * @param {HTMLElement} target - Element for which to calculate the content rectangle.
 * @returns {DOMRectInit}
 */
function getHTMLElementContentRect(e){
// Client width & height properties can't be
// used exclusively as they provide rounded values.
var t=e.clientWidth,n=e.clientHeight;
// By this condition we can catch all non-replaced inline, hidden and
// detached elements. Though elements with width & height properties less
// than 0.5 will be discarded as well.
//
// Without it we would need to implement separate methods for each of
// those cases and it's not possible to perform a precise and performance
// effective test for hidden elements. E.g. even jQuery's ':visible' filter
// gives wrong results for elements with width & height less than 0.5.
if(!t&&!n)return p;var r=d(e).getComputedStyle(e),i=function getPaddings(e){for(var t={},n=0,r=["top","right","bottom","left"];n<r.length;n++){var i=r[n],a=e["padding-"+i];t[i]=toFloat(a)}return t}
/**
 * Calculates content rectangle of provided SVG element.
 *
 * @param {SVGGraphicsElement} target - Element content rectangle of which needs
 *      to be calculated.
 * @returns {DOMRectInit}
 */(r),a=i.left+i.right,o=i.top+i.bottom,s=toFloat(r.width),l=toFloat(r.height);
// Following steps can't be applied to the document's root element as its
// client[Width/Height] properties represent viewport area of the window.
// Besides, it's as well not necessary as the <html> itself neither has
// rendered scroll bars nor it can be clipped.
if(
// Width & height include paddings and borders when the 'border-box' box
// model is applied (except for IE).
"border-box"===r.boxSizing&&(
// Following conditions are required to handle Internet Explorer which
// doesn't include paddings and borders to computed CSS dimensions.
//
// We can say that if CSS dimensions + paddings are equal to the "client"
// properties then it's either IE, and thus we don't need to subtract
// anything, or an element merely doesn't have paddings/borders styles.
Math.round(s+a)!==t&&(s-=getBordersSize(r,"left","right")+a),Math.round(l+o)!==n&&(l-=getBordersSize(r,"top","bottom")+o)),!
/**
 * Checks whether provided element is a document element (<html>).
 *
 * @param {Element} target - Element to be checked.
 * @returns {boolean}
 */
function isDocumentElement(e){return e===d(e).document.documentElement}
/**
 * Calculates an appropriate content rectangle for provided html or svg element.
 *
 * @param {Element} target - Element content rectangle of which needs to be calculated.
 * @returns {DOMRectInit}
 */(e)){
// In some browsers (only in Firefox, actually) CSS width & height
// include scroll bars size which can be removed at this step as scroll
// bars are the only difference between rounded dimensions + paddings
// and "client" properties, though that is not always true in Chrome.
var c=Math.round(s+a)-t,u=Math.round(l+o)-n;
// Chrome has a rather weird rounding of "client" properties.
// E.g. for an element with content width of 314.2px it sometimes gives
// the client width of 315px and for the width of 314.7px it may give
// 314px. And it doesn't happen all the time. So just ignore this delta
// as a non-relevant.
1!==Math.abs(c)&&(s-=c),1!==Math.abs(u)&&(l-=u)}return createRectInit(i.left,i.top,s,l)}
/**
 * Checks whether provided element is an instance of the SVGGraphicsElement.
 *
 * @param {Element} target - Element to be checked.
 * @returns {boolean}
 */var f=
// Some browsers, namely IE and Edge, don't have the SVGGraphicsElement
// interface.
"undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof d(e).SVGGraphicsElement}:function(e){return e instanceof d(e).SVGElement&&"function"==typeof e.getBBox};function getContentRect(e){return r?f(e)?function getSVGContentRect(e){var t=e.getBBox();return createRectInit(0,0,t.width,t.height)}(e):getHTMLElementContentRect(e):p}
/**
 * Creates rectangle with an interface of the DOMRectReadOnly.
 * Spec: https://drafts.fxtf.org/geometry/#domrectreadonly
 *
 * @param {DOMRectInit} rectInit - Object with rectangle's x/y coordinates and dimensions.
 * @returns {DOMRectReadOnly}
 */
/**
 * Creates DOMRectInit object based on the provided dimensions and the x/y coordinates.
 * Spec: https://drafts.fxtf.org/geometry/#dictdef-domrectinit
 *
 * @param {number} x - X coordinate.
 * @param {number} y - Y coordinate.
 * @param {number} width - Rectangle's width.
 * @param {number} height - Rectangle's height.
 * @returns {DOMRectInit}
 */
function createRectInit(e,t,n,r){return{x:e,y:t,width:n,height:r}}
/**
 * Class that is responsible for computations of the content rectangle of
 * provided DOM element and for keeping track of it's changes.
 */var m=/** @class */function(){
/**
     * Creates an instance of ResizeObservation.
     *
     * @param {Element} target - Element to be observed.
     */
function ResizeObservation(e){
/**
         * Broadcasted width of content rectangle.
         *
         * @type {number}
         */
this.broadcastWidth=0,
/**
         * Broadcasted height of content rectangle.
         *
         * @type {number}
         */
this.broadcastHeight=0,
/**
         * Reference to the last observed content rectangle.
         *
         * @private {DOMRectInit}
         */
this.contentRect_=createRectInit(0,0,0,0),this.target=e}
/**
     * Updates content rectangle and tells whether it's width or height properties
     * have changed since the last broadcast.
     *
     * @returns {boolean}
     */return ResizeObservation.prototype.isActive=function(){var e=getContentRect(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},
/**
     * Updates 'broadcastWidth' and 'broadcastHeight' properties with a data
     * from the corresponding properties of the last observed content rectangle.
     *
     * @returns {DOMRectInit} Last observed content rectangle.
     */
ResizeObservation.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},ResizeObservation}(),g=/** @class */function(){
/**
     * Creates an instance of ResizeObserverEntry.
     *
     * @param {Element} target - Element that is being observed.
     * @param {DOMRectInit} rectInit - Data of the element's content rectangle.
     */
return function ResizeObserverEntry(e,t){var n=function createReadOnlyRect(e){var t=e.x,n=e.y,r=e.width,i=e.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,o=Object.create(a.prototype);
// If DOMRectReadOnly is available use it as a prototype for the rectangle.
// Rectangle's properties are not writable and non-enumerable.
return h(o,{x:t,y:n,width:r,height:i,top:n,right:t+r,bottom:i+n,left:t}),o}(t);
// According to the specification following properties are not writable
// and are also not enumerable in the native implementation.
//
// Property accessors are not being used as they'd require to define a
// private WeakMap storage which may cause memory leaks in browsers that
// don't support this type of collections.
h(this,{target:e,contentRect:n})}}(),v=/** @class */function(){
/**
     * Creates a new instance of ResizeObserver.
     *
     * @param {ResizeObserverCallback} callback - Callback function that is invoked
     *      when one of the observed elements changes it's content dimensions.
     * @param {ResizeObserverController} controller - Controller instance which
     *      is responsible for the updates of observer.
     * @param {ResizeObserver} callbackCtx - Reference to the public
     *      ResizeObserver instance which will be passed to callback function.
     */
function ResizeObserverSPI(e,t,r){if(
/**
         * Collection of resize observations that have detected changes in dimensions
         * of elements.
         *
         * @private {Array<ResizeObservation>}
         */
this.activeObservations_=[],
/**
         * Registry of the ResizeObservation instances.
         *
         * @private {Map<Element, ResizeObservation>}
         */
this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=r}
/**
     * Starts observing provided element.
     *
     * @param {Element} target - Element to be observed.
     * @returns {void}
     */return ResizeObserverSPI.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");
// Do nothing if current environment doesn't have the Element interface.
if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;
// Do nothing if element is already being observed.
t.has(e)||(t.set(e,new m(e)),this.controller_.addObserver(this),
// Force the update of observations.
this.controller_.refresh())}},
/**
     * Stops observing provided element.
     *
     * @param {Element} target - Element to stop observing.
     * @returns {void}
     */
ResizeObserverSPI.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");
// Do nothing if current environment doesn't have the Element interface.
if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;
// Do nothing if element is not being observed.
t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},
/**
     * Stops observing all elements.
     *
     * @returns {void}
     */
ResizeObserverSPI.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},
/**
     * Collects observation instances the associated element of which has changed
     * it's content rectangle.
     *
     * @returns {void}
     */
ResizeObserverSPI.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},
/**
     * Invokes initial callback function with a list of ResizeObserverEntry
     * instances collected from active resize observations.
     *
     * @returns {void}
     */
ResizeObserverSPI.prototype.broadcastActive=function(){
// Do nothing if observer doesn't have active observations.
if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(e){return new g(e.target,e.broadcastRect())});
// Create ResizeObserverEntry instance for every active observation.
this.callback_.call(e,t,e),this.clearActive()}},
/**
     * Clears the collection of active observations.
     *
     * @returns {void}
     */
ResizeObserverSPI.prototype.clearActive=function(){this.activeObservations_.splice(0)},
/**
     * Tells whether observer has active observations.
     *
     * @returns {boolean}
     */
ResizeObserverSPI.prototype.hasActive=function(){return this.activeObservations_.length>0},ResizeObserverSPI}(),y="undefined"!=typeof WeakMap?new WeakMap:new n,b=/** @class */function(){
/**
     * Creates a new instance of ResizeObserver.
     *
     * @param {ResizeObserverCallback} callback - Callback that is invoked when
     *      dimensions of the observed elements change.
     */
return function ResizeObserver(e){if(!(this instanceof ResizeObserver))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=u.getInstance(),n=new v(e,t,this);y.set(this,n)}}();
// Expose public methods of ResizeObserver.
["observe","unobserve","disconnect"].forEach(function(e){b.prototype[e]=function(){var t;return(t=y.get(this))[e].apply(t,arguments)}});var x=
// Export existing implementation if available.
void 0!==i.ResizeObserver?i.ResizeObserver:b;
/* harmony default export */t.a=x}).call(this,n(142))
/***/},
/* 14 */
/***/function(e,t){e.exports="uniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 15 */
/***/function(e,t){e.exports="uniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n"
/***/},
/* 16 */
/***/function(e,t){e.exports="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 17 */
/***/function(e,t){e.exports="uniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <fog_fragment>\n\n}\n"
/***/},
/* 18 */
/***/function(e,t){e.exports="uniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 19 */
/***/function(e,t){e.exports="uniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n"
/***/},
/* 20 */
/***/function(e,t){e.exports="#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n"
/***/},
/* 21 */
/***/function(e,t){e.exports="#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvoid main() {\n\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n"
/***/},
/* 22 */
/***/function(e,t){e.exports="#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 23 */
/***/function(e,t){e.exports="#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n"
/***/},
/* 24 */
/***/function(e,t){e.exports="#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 25 */
/***/function(e,t){e.exports="#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n"
/***/},
/* 26 */
/***/function(e,t){e.exports="#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n"
/***/},
/* 27 */
/***/function(e,t){e.exports="#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\tvec4 matcapColor = texture2D( matcap, uv );\n\n\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n"
/***/},
/* 28 */
/***/function(e,t){e.exports="#define LAMBERT\n\nvarying vec3 vLightFront;\n\n#ifdef DOUBLE_SIDED\n\n\tvarying vec3 vLightBack;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 29 */
/***/function(e,t){e.exports="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\n\n#ifdef DOUBLE_SIDED\n\n\tvarying vec3 vLightBack;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n"
/***/},
/* 30 */
/***/function(e,t){e.exports="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 31 */
/***/function(e,t){e.exports="uniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n"
/***/},
/* 32 */
/***/function(e,t){e.exports="uniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\n\tvLineDistance = scale * lineDistance;\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"
/***/},
/* 33 */
/***/function(e,t){e.exports="uniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n"
/***/},
/* 34 */
/***/function(e,t){e.exports="varying vec3 vWorldPosition;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n"
/***/},
/* 35 */
/***/function(e,t){e.exports="uniform sampler2D tEquirect;\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldPosition );\n\n\tvec2 sampleUV;\n\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n}\n"
/***/},
/* 36 */
/***/function(e,t){e.exports="#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n"
/***/},
/* 37 */
/***/function(e,t){e.exports="#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n"
/***/},
/* 38 */
/***/function(e,t){e.exports="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n}\n"
/***/},
/* 39 */
/***/function(e,t){e.exports="#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\n\t#endif\n\n}\n"
/***/},
/* 40 */
/***/function(e,t){e.exports="varying vec3 vWorldPosition;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n"
/***/},
/* 41 */
/***/function(e,t){e.exports="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\n\nvarying vec3 vWorldPosition;\n\nvoid main() {\n\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n\n}\n"
/***/},
/* 42 */
/***/function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n\n\tvUv = uv;\n\n\tgl_Position = vec4( position, 1.0 );\n\tgl_Position.z = 1.0;\n\n}\n"
/***/},
/* 43 */
/***/function(e,t){e.exports="uniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tgl_FragColor = texture2D( t2D, vUv );\n\n}\n"
/***/},
/* 44 */
/***/function(e,t){e.exports="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n#endif\n"
/***/},
/* 45 */
/***/function(e,t){e.exports="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif"
/***/},
/* 46 */
/***/function(e,t){e.exports="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif"
/***/},
/* 47 */
/***/function(e,t){e.exports="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif"
/***/},
/* 48 */
/***/function(e,t){e.exports="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif"
/***/},
/* 49 */
/***/function(e,t){e.exports="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n\n#endif\n"
/***/},
/* 50 */
/***/function(e,t){e.exports="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\n#endif"
/***/},
/* 51 */
/***/function(e,t){e.exports="#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n"
/***/},
/* 52 */
/***/function(e,t){e.exports="#if defined( TONE_MAPPING )\n\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n"
/***/},
/* 53 */
/***/function(e,t){e.exports="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif"
/***/},
/* 54 */
/***/function(e,t){e.exports="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif"
/***/},
/* 55 */
/***/function(e,t){e.exports="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n"
/***/},
/* 56 */
/***/function(e,t){e.exports="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n"
/***/},
/* 57 */
/***/function(e,t){e.exports="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n"
/***/},
/* 58 */
/***/function(e,t){e.exports="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif"
/***/},
/* 59 */
/***/function(e,t){e.exports="float getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n"
/***/},
/* 60 */
/***/function(e,t){e.exports="#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n"
/***/},
/* 61 */
/***/function(e,t){e.exports="#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n"
/***/},
/* 62 */
/***/function(e,t){e.exports="#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\n\t\tvec2 f = fract( uv * size + 0.5 );\n\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\n\t\treturn c;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n"
/***/},
/* 63 */
/***/function(e,t){e.exports="#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif"
/***/},
/* 64 */
/***/function(e,t){e.exports="float roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n"
/***/},
/* 65 */
/***/function(e,t){e.exports="#if defined( DITHERING )\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n"
/***/},
/* 66 */
/***/function(e,t){e.exports="#if defined( DITHERING )\n\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n"
/***/},
/* 67 */
/***/function(e,t){e.exports="vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\ngl_Position = projectionMatrix * mvPosition;\n"
/***/},
/* 68 */
/***/function(e,t){e.exports="#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n"
/***/},
/* 69 */
/***/function(e,t){e.exports="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n"
/***/},
/* 70 */
/***/function(e,t){e.exports="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t#ifdef OBJECTSPACE_NORMALMAP\n\n\t\tuniform mat3 normalMatrix;\n\n\t#else\n\n\t\t// Per-Pixel Tangent Space Normal Mapping\n\t\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t\treturn normalize( tsn * mapN );\n\n\t\t}\n\n\t#endif\n\n#endif\n"
/***/},
/* 71 */
/***/function(e,t){e.exports="#ifdef USE_NORMALMAP\n\n\t#ifdef OBJECTSPACE_NORMALMAP\n\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t\t#ifdef FLIP_SIDED\n\n\t\t\tnormal = - normal;\n\n\t\t#endif\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tnormal = normalize( normalMatrix * normal );\n\n\t#else // tangent-space normal map\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n"
/***/},
/* 72 */
/***/function(e,t){e.exports="#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n#endif\n"
/***/},
/* 73 */
/***/function(e,t){e.exports="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n"
/***/},
/* 74 */
/***/function(e,t){e.exports="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif"
/***/},
/* 75 */
/***/function(e,t){e.exports="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n"
/***/},
/* 76 */
/***/function(e,t){e.exports="#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif"
/***/},
/* 77 */
/***/function(e,t){e.exports="float metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n"
/***/},
/* 78 */
/***/function(e,t){e.exports="#ifdef USE_MAP\n\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n\n#endif\n"
/***/},
/* 79 */
/***/function(e,t){e.exports="#ifdef USE_MAP\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n"
/***/},
/* 80 */
/***/function(e,t){e.exports="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n"
/***/},
/* 81 */
/***/function(e,t){e.exports="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n"
/***/},
/* 82 */
/***/function(e,t){e.exports="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n\t#else\n\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\tgl_Position.z *= gl_Position.w;\n\n\t#endif\n\n#endif\n"
/***/},
/* 83 */
/***/function(e,t){e.exports="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n"
/***/},
/* 84 */
/***/function(e,t){e.exports="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\n#endif\n"
/***/},
/* 85 */
/***/function(e,t){e.exports="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif"
/***/},
/* 86 */
/***/function(e,t){e.exports="#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n\n#endif\n"
/***/},
/* 87 */
/***/function(e,t){e.exports="#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tirradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n\n#endif\n"
/***/},
/* 88 */
/***/function(e,t){e.exports="/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n\n#endif\n"
/***/},
/* 89 */
/***/function(e,t){e.exports="struct PhysicalMaterial {\n\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight; // counterclockwise\n\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\t#ifndef STANDARD\n\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\n\t#endif\n\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\n\t#ifndef STANDARD\n\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\n\t#endif\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n"
/***/},
/* 90 */
/***/function(e,t){e.exports="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat ); // Burley clearcoat model\n\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n"
/***/},
/* 91 */
/***/function(e,t){e.exports="varying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t#ifdef TOON\n\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#else\n\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\n\t#endif\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n"
/***/},
/* 92 */
/***/function(e,t){e.exports="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n"
/***/},
/* 93 */
/***/function(e,t){e.exports="#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n\t\t//float envMapWidth = pow( 2.0, maxMIPLevelScalar );\n\t\t//float desiredMIPLevel = log2( envMapWidth * sqrt( 3.0 ) ) - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n"
/***/},
/* 94 */
/***/function(e,t){e.exports="uniform vec3 ambientLightColor;\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n"
/***/},
/* 95 */
/***/function(e,t){e.exports="vec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\n#endif\n"
/***/},
/* 96 */
/***/function(e,t){e.exports="#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif"
/***/},
/* 97 */
/***/function(e,t){e.exports="#ifdef USE_LIGHTMAP\n\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n"
/***/},
/* 98 */
/***/function(e,t){e.exports="#ifdef TOON\n\n\tuniform sampler2D gradientMap;\n\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t\t// dotNL will be from -1.0 to 1.0\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t\t#ifdef USE_GRADIENTMAP\n\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t\t#else\n\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t\t#endif\n\n\n\t}\n\n#endif\n"
/***/},
/* 99 */
/***/function(e,t){e.exports="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n"
/***/},
/* 100 */
/***/function(e,t){e.exports="#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n"
/***/},
/* 101 */
/***/function(e,t){e.exports="#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n"
/***/},
/* 102 */
/***/function(e,t){e.exports="#ifdef USE_FOG\n\n\tfogDepth = -mvPosition.z;\n\n#endif\n"
/***/},
/* 103 */
/***/function(e,t){e.exports="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n"
/***/},
/* 104 */
/***/function(e,t){e.exports="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n"
/***/},
/* 105 */
/***/function(e,t){e.exports="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n\n#ifdef USE_ENVMAP\n\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n"
/***/},
/* 106 */
/***/function(e,t){e.exports="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\tenvColor = envMapTexelToLinear( envColor );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n"
/***/},
/* 107 */
/***/function(e,t){e.exports="// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n"
/***/},
/* 108 */
/***/function(e,t){e.exports="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n"
/***/},
/* 109 */
/***/function(e,t){e.exports="#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n"
/***/},
/* 110 */
/***/function(e,t){e.exports="#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n"
/***/},
/* 111 */
/***/function(e,t){e.exports="#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n"
/***/},
/* 112 */
/***/function(e,t){e.exports="#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n"
/***/},
/* 113 */
/***/function(e,t){e.exports="vec3 transformedNormal = normalMatrix * objectNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n"
/***/},
/* 114 */
/***/function(e,t){e.exports="#ifdef ENVMAP_TYPE_CUBE_UV\n\n#define cubeUV_textureSize (1024.0)\n\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\n\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\t// Clamp the value to the max mip level counts. hard coded to 6 mips\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\n\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\t// float powScale = exp2(roughnessLevel + mipLevel);\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\t// float scale =  1.0 / exp2(roughnessLevel + 2.0 + mipLevel);\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\t// float mipOffset = 0.75*(1.0 - 1.0/exp2(mipLevel))/exp2(roughnessLevel);\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\n\tfloat rcpPowScale = 1.0 / powScale;\n\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\n\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\n\t// round to nearest mipmap if we are not interpolating.\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\n\t// Tri linear interpolation.\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\n\tvec4 result = mix(color10, color20, t);\n\n\treturn vec4(result.rgb, 1.0);\n}\n\n#endif\n"
/***/},
/* 115 */
/***/function(e,t){e.exports="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n"
/***/},
/* 116 */
/***/function(e,t){e.exports="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif"
/***/},
/* 117 */
/***/function(e,t){e.exports="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif"
/***/},
/* 118 */
/***/function(e,t){e.exports="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n"
/***/},
/* 119 */
/***/function(e,t){e.exports="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif"
/***/},
/* 120 */
/***/function(e,t){e.exports="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n\n"
/***/},
/* 121 */
/***/function(e,t){e.exports="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif\n"
/***/},
/* 122 */
/***/function(e,t){e.exports="#if NUM_CLIPPING_PLANES > 0\n\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n"
/***/},
/* 123 */
/***/function(e,t){e.exports="#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n"
/***/},
/* 124 */
/***/function(e,t){e.exports="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n"
/***/},
/* 125 */
/***/function(e,t){e.exports='float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneyâs reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)âG(v) / 4(nâl)(nâv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneyâs reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n\treturn specularColor * AB.x + AB.y;\n\n} // validated\n\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n'
/***/},
/* 126 */
/***/function(e,t){e.exports="\nvec3 objectNormal = vec3( normal );\n"
/***/},
/* 127 */
/***/function(e,t){e.exports="\nvec3 transformed = vec3( position );\n"
/***/},
/* 128 */
/***/function(e,t){e.exports="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif"
/***/},
/* 129 */
/***/function(e,t){e.exports="#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n"
/***/},
/* 130 */
/***/function(e,t){e.exports="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n"
/***/},
/* 131 */
/***/function(e,t){e.exports="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n"
/***/},
/* 132 */
/***/function(e,t){e.exports="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n"
/***/},
/* 133 */
/***/function(e,t,n){e.exports=function(){return n(12)('//Â© 2016 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC\n/******/!function(e){// webpackBootstrap\n/******/ // The module cache\n/******/var t={};\n/******/\n/******/ // The require function\n/******/function __webpack_require__(r){\n/******/\n/******/ // Check if module is in cache\n/******/if(t[r])\n/******/return t[r].exports;\n/******/\n/******/ // Create a new module (and put it into the cache)\n/******/var i=t[r]={\n/******/i:r,\n/******/l:!1,\n/******/exports:{}\n/******/};\n/******/\n/******/ // Execute the module function\n/******/\n/******/\n/******/ // Return the exports of the module\n/******/return e[r].call(i.exports,i,i.exports,__webpack_require__),\n/******/\n/******/ // Flag the module as loaded\n/******/i.l=!0,i.exports;\n/******/}\n/******/\n/******/\n/******/ // expose the modules object (__webpack_modules__)\n/******/\n/******/\n/******/\n/******/ // Load entry module and return exports\n/******/__webpack_require__.m=e,\n/******/\n/******/ // expose the module cache\n/******/__webpack_require__.c=t,\n/******/\n/******/ // define getter function for harmony exports\n/******/__webpack_require__.d=function(e,t,r){\n/******/__webpack_require__.o(e,t)||\n/******/Object.defineProperty(e,t,{\n/******/configurable:!1,\n/******/enumerable:!0,\n/******/get:r\n/******/})\n/******/},\n/******/\n/******/ // define __esModule on exports\n/******/__webpack_require__.r=function(e){\n/******/Object.defineProperty(e,"__esModule",{value:!0});\n/******/},\n/******/\n/******/ // getDefaultExport function for compatibility with non-harmony modules\n/******/__webpack_require__.n=function(e){\n/******/var t=e&&e.__esModule?\n/******/function getDefault(){return e.default}:\n/******/function getModuleExports(){return e};\n/******/\n/******/return __webpack_require__.d(t,"a",t),t;\n/******/},\n/******/\n/******/ // Object.prototype.hasOwnProperty.call\n/******/__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},\n/******/\n/******/ // __webpack_public_path__\n/******/__webpack_require__.p="./",__webpack_require__(__webpack_require__.s=0);\n/******/}\n/************************************************************************/\n/******/([\n/* 0 */\n/***/function(e,t,r){"use strict";\n/**\n * https://github.com/mrdoob/eventdispatcher.js/\n */\nfunction EventDispatcher(){}r.r(t),\n// CONCATENATED MODULE: ./node_modules/three/build/three.module.js\n// Polyfills\nvoid 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(\n// Missing in IE\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\nNumber.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),\n//\nvoid 0===Math.sign&&(\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\nMath.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&\n// Missing in IE\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name\nObject.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\\s*function\\s*([^\\(\\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(void 0!==i&&null!==i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}),Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}}}});var i="97",n=0,a=1,o=2,s=1,c=2,l=0,h=1,u=2,p=0,d=1,f=2,m=0,g=1,y=2,x=3,b=4,_=5,M=100,w=101,T=102,E=103,S=104,L=200,A=201,C=202,P=203,R=204,B=205,O=206,I=207,D=208,G=209,V=210,N=0,U=1,F=2,z=3,H=4,k=5,j=6,W=7,X=0,q=1,Y=2,J=0,Z=1,Q=2,K=3,$=4,ee=301,te=302,re=303,ie=304,ne=305,ae=306,oe=307,se=1e3,ce=1001,le=1002,he=1003,ue=1004,pe=1005,de=1006,fe=1007,me=1008,ge=1009,ve=1010,ye=1011,xe=1012,be=1013,_e=1014,Me=1015,we=1016,Te=1017,Ee=1018,Se=1019,Le=1020,Ae=1021,Ce=1022,Pe=1023,Re=1024,Be=1025,Oe=1026,Ie=1027,De=1028,Ge=33776,Ve=33777,Ne=33778,Ue=33779,Fe=35840,ze=35841,He=35842,ke=35843,je=36196,We=37808,Xe=37809,qe=37810,Ye=37811,Je=37812,Ze=37813,Qe=37814,Ke=37815,$e=37816,et=37817,tt=37818,rt=37819,it=37820,nt=37821,at=2201,ot=2400,st=0,ct=1,lt=2,ht=3e3,ut=3001,pt=3007,dt=3002,ft=3004,mt=3005,gt=3006,vt=3200,yt=3201,xt=0,bt=1,_t={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136\nvar e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function generateUUID(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;\n// .toUpperCase() here flattens concatenated strings to save heap memory space.\nreturn(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]).toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},\n// compute euclidian modulo of m % n\n// https://en.wikipedia.org/wiki/Modulo_operation\neuclideanModulo:function(e,t){return(e%t+t)%t},\n// Linear mapping from range <a1, a2> to range <b1, b2>\nmapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},\n// https://en.wikipedia.org/wiki/Linear_interpolation\nlerp:function(e,t,r){return(1-r)*e+r*t},\n// http://en.wikipedia.org/wiki/Smoothstep\nsmoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},\n// Random integer from <low, high> interval\nrandInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},\n// Random float from <low, high> interval\nrandFloat:function(e,t){return e+Math.random()*(t-e)},\n// Random float from <-range/2, range/2> interval\nrandFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*_t.DEG2RAD},radToDeg:function(e){return e*_t.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author philogb / http://blog.thejit.org/\n * @author egraether / http://egraether.com/\n * @author zz85 / http://www.lab4games.net/zz85/blog\n */\nfunction Vector2(e,t){this.x=e||0,this.y=t||0}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author supereggbert / http://www.paulbrunt.co.uk/\n * @author philogb / http://blog.thejit.org/\n * @author jordi_ros / http://plattsoft.com\n * @author D1plo1d / http://github.com/D1plo1d\n * @author alteredq / http://alteredqualia.com/\n * @author mikael emtinger / http://gomo.se/\n * @author timknip / http://www.floorplanner.com/\n * @author bhouston / http://clara.io\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}\n/**\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author bhouston / http://clara.io\n */\nfunction Quaternion(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author kile / http://kile.stravaganza.org/\n * @author philogb / http://blog.thejit.org/\n * @author mikael emtinger / http://gomo.se/\n * @author egraether / http://egraether.com/\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction Vector3(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author bhouston / http://clara.io\n * @author tschw\n */\nfunction Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){\n// assumes min < max, componentwise\nreturn this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Vector2,t=new Vector2;return function clampScalar(r,i){return e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){\n// computes the angle in radians with respect to the positive x-axis\nvar e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*r-a*i+e.x,this.y=n*i+a*r+e.y,this}}),Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(e,t,r,i,n,a,o,s,c,l,h,u,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=c,g[6]=l,g[10]=h,g[14]=u,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new Vector3;return function extractRotation(t){\n// this method does not support reflection matrices\nvar r=this.elements,i=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[3]=0,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[7]=0,r[8]=i[8]*o,r[9]=i[9]*o,r[10]=i[10]*o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(i),c=Math.sin(i),l=Math.cos(n),h=Math.sin(n);if("XYZ"===e.order){var u=a*l,p=a*h,d=o*l,f=o*h;t[0]=s*l,t[4]=-s*h,t[8]=c,t[1]=p+d*c,t[5]=u-f*c,t[9]=-o*s,t[2]=f-u*c,t[6]=d+p*c,t[10]=a*s}else if("YXZ"===e.order){var m=s*l,g=s*h,v=c*l,y=c*h;t[0]=m+y*o,t[4]=v*o-g,t[8]=a*c,t[1]=a*h,t[5]=a*l,t[9]=-o,t[2]=g*o-v,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){m=s*l,g=s*h,v=c*l,y=c*h;t[0]=m-y*o,t[4]=-a*h,t[8]=v+g*o,t[1]=g+v*o,t[5]=a*l,t[9]=y-m*o,t[2]=-a*c,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){u=a*l,p=a*h,d=o*l,f=o*h;t[0]=s*l,t[4]=d*c-p,t[8]=u*c+f,t[1]=s*h,t[5]=f*c+u,t[9]=p*c-d,t[2]=-c,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var x=a*s,b=a*c,_=o*s,M=o*c;t[0]=s*l,t[4]=M-x*h,t[8]=_*h+b,t[1]=h,t[5]=a*l,t[9]=-o*l,t[2]=-c*l,t[6]=b*h+_,t[10]=x-M*h}else if("XZY"===e.order){x=a*s,b=a*c,_=o*s,M=o*c;t[0]=s*l,t[4]=-h,t[8]=c*l,t[1]=x*h+M,t[5]=a*l,t[9]=b*h-_,t[2]=_*h-b,t[6]=o*l,t[10]=M*h+x}\n// bottom row\nreturn t[3]=0,t[7]=0,t[11]=0,\n// last column\nt[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new Vector3(0,0,0),t=new Vector3(1,1,1);return function makeRotationFromQuaternion(r){return this.compose(e,r,t)}}(),lookAt:function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function lookAt(i,n,a){var o=this.elements;return r.subVectors(i,n),0===r.lengthSq()&&(\n// eye and target are in the same position\nr.z=1),r.normalize(),e.crossVectors(a,r),0===e.lengthSq()&&(\n// up and z are parallel\n1===Math.abs(a.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),e.crossVectors(a,r)),e.normalize(),t.crossVectors(r,e),o[0]=e.x,o[4]=t.x,o[8]=r.x,o[1]=e.y,o[5]=t.y,o[9]=r.y,o[2]=e.z,o[6]=t.z,o[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[4],s=r[8],c=r[12],l=r[1],h=r[5],u=r[9],p=r[13],d=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],b=r[15],_=i[0],M=i[4],w=i[8],T=i[12],E=i[1],S=i[5],L=i[9],A=i[13],C=i[2],P=i[6],R=i[10],B=i[14],O=i[3],I=i[7],D=i[11],G=i[15];return n[0]=a*_+o*E+s*C+c*O,n[4]=a*M+o*S+s*P+c*I,n[8]=a*w+o*L+s*R+c*D,n[12]=a*T+o*A+s*B+c*G,n[1]=l*_+h*E+u*C+p*O,n[5]=l*M+h*S+u*P+p*I,n[9]=l*w+h*L+u*R+p*D,n[13]=l*T+h*A+u*B+p*G,n[2]=d*_+f*E+m*C+g*O,n[6]=d*M+f*S+m*P+g*I,n[10]=d*w+f*L+m*R+g*D,n[14]=d*T+f*A+m*B+g*G,n[3]=v*_+y*E+x*C+b*O,n[7]=v*M+y*S+x*P+b*I,n[11]=v*w+y*L+x*R+b*D,n[15]=v*T+y*A+x*B+b*G,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var r=0,i=t.count;r<i;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],o=e[5],s=e[9],c=e[13],l=e[2],h=e[6],u=e[10],p=e[14];\n//TODO: make this more efficient\n//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\nreturn e[3]*(+n*s*h-i*c*h-n*o*u+r*c*u+i*o*p-r*s*p)+e[7]*(+t*s*p-t*c*u+n*a*u-i*a*p+i*c*l-n*s*l)+e[11]*(+t*c*h-t*o*p-n*a*h+r*a*p+n*o*l-r*c*l)+e[15]*(-i*o*l-t*s*h+t*o*u+i*a*h-r*a*u+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){\n// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\nvar r=this.elements,i=e.elements,n=i[0],a=i[1],o=i[2],s=i[3],c=i[4],l=i[5],h=i[6],u=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],x=i[15],b=d*y*u-v*f*u+v*h*m-l*y*m-d*h*x+l*f*x,_=g*f*u-p*y*u-g*h*m+c*y*m+p*h*x-c*f*x,M=p*v*u-g*d*u+g*l*m-c*v*m-p*l*x+c*d*x,w=g*d*h-p*v*h-g*l*f+c*v*f+p*l*y-c*d*y,T=n*b+a*_+o*M+s*w;if(0===T){var E="THREE.Matrix4: .getInverse() can\'t invert matrix, determinant is 0";if(!0===t)throw new Error(E);return console.warn(E),this.identity()}var S=1/T;return r[0]=b*S,r[1]=(v*f*s-d*y*s-v*o*m+a*y*m+d*o*x-a*f*x)*S,r[2]=(l*y*s-v*h*s+v*o*u-a*y*u-l*o*x+a*h*x)*S,r[3]=(d*h*s-l*f*s-d*o*u+a*f*u+l*o*m-a*h*m)*S,r[4]=_*S,r[5]=(p*y*s-g*f*s+g*o*m-n*y*m-p*o*x+n*f*x)*S,r[6]=(g*h*s-c*y*s-g*o*u+n*y*u+c*o*x-n*h*x)*S,r[7]=(c*f*s-p*h*s+p*o*u-n*f*u-c*o*m+n*h*m)*S,r[8]=M*S,r[9]=(g*d*s-p*v*s-g*a*m+n*v*m+p*a*x-n*d*x)*S,r[10]=(c*v*s-g*l*s+g*a*u-n*v*u-c*a*x+n*l*x)*S,r[11]=(p*l*s-c*d*s-p*a*u+n*d*u+c*a*m-n*l*m)*S,r[12]=w*S,r[13]=(p*v*o-g*d*o+g*a*f-n*v*f-p*a*y+n*d*y)*S,r[14]=(g*l*o-c*v*o-g*a*h+n*v*h+c*a*y-n*l*y)*S,r[15]=(c*d*o-p*l*o+p*a*h-n*d*h-c*a*f+n*l*f)*S,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){\n// Based on http://www.gamedev.net/reference/articles/article1199.asp\nvar r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,o=e.y,s=e.z,c=n*a,l=n*o;return this.set(c*a+r,c*o-i*s,c*s+i*o,0,c*o+i*s,l*o+r,l*s-i*a,0,c*s-i*o,l*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var i=this.elements,n=t._x,a=t._y,o=t._z,s=t._w,c=n+n,l=a+a,h=o+o,u=n*c,p=n*l,d=n*h,f=a*l,m=a*h,g=o*h,v=s*c,y=s*l,x=s*h,b=r.x,_=r.y,M=r.z;return i[0]=(1-(f+g))*b,i[1]=(p+x)*b,i[2]=(d-y)*b,i[3]=0,i[4]=(p-x)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(d+y)*M,i[9]=(m-v)*M,i[10]=(1-(u+f))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(){var e=new Vector3,t=new Matrix4;return function decompose(r,i,n){var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),c=e.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),r.x=a[12],r.y=a[13],r.z=a[14],\n// scale the rotation part\nt.copy(this);var l=1/o,h=1/s,u=1/c;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,i.setFromRotationMatrix(t),n.x=o,n.y=s,n.z=c,this}}(),makePerspective:function(e,t,r,i,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*n/(t-e),c=2*n/(r-i),l=(t+e)/(t-e),h=(r+i)/(r-i),u=-(a+n)/(a-n),p=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements,s=1/(t-e),c=1/(r-i),l=1/(a-n),h=(t+e)*s,u=(r+i)*c,p=(a+n)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(Quaternion,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,n,a,o){\n// fuzz-free, array-based Quaternion SLERP operation\nvar s=r[i+0],c=r[i+1],l=r[i+2],h=r[i+3],u=n[a+0],p=n[a+1],d=n[a+2],f=n[a+3];if(h!==f||s!==u||c!==p||l!==d){var m=1-o,g=s*u+c*p+l*d+h*f,v=g>=0?1:-1,y=1-g*g;\n// Skip the Slerp for tiny steps to avoid numeric problems:\nif(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,g*v);m=Math.sin(m*b)/x,o=Math.sin(o*b)/x}var _=o*v;\n// Normalize in case we just did a lerp:\nif(s=s*m+u*_,c=c*m+p*_,l=l*m+d*_,h=h*m+f*_,m===1-o){var M=1/Math.sqrt(s*s+c*c+l*l+h*h);s*=M,c*=M,l*=M,h*=M}}e[t]=s,e[t+1]=c,e[t+2]=l,e[t+3]=h}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,n=e._z,a=e.order,o=Math.cos,s=Math.sin,c=o(r/2),l=o(i/2),h=o(n/2),u=s(r/2),p=s(i/2),d=s(n/2);\n// http://www.mathworks.com/matlabcentral/fileexchange/\n// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\n//\tcontent/SpinCalc.m\nreturn"XYZ"===a?(this._x=u*l*h+c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h-u*p*d):"YXZ"===a?(this._x=u*l*h+c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h+u*p*d):"ZXY"===a?(this._x=u*l*h-c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h-u*p*d):"ZYX"===a?(this._x=u*l*h-c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h+u*p*d):"YZX"===a?(this._x=u*l*h+c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h-u*p*d):"XZY"===a&&(this._x=u*l*h-c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h+u*p*d),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\n// assumes axis is normalized\nvar r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\nvar t,r=e.elements,i=r[0],n=r[4],a=r[8],o=r[1],s=r[5],c=r[9],l=r[2],h=r[6],u=r[10],p=i+s+u;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(h-c)*t,this._y=(a-l)*t,this._z=(o-n)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this._w=(h-c)/t,this._x=.25*t,this._y=(n+o)/t,this._z=(a+l)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this._w=(a-l)/t,this._x=(n+o)/t,this._y=.25*t,this._z=(c+h)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(o-n)/t,this._x=(a+l)/t,this._y=(c+h)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){\n// assumes direction vectors vFrom and vTo are normalized\nvar e,t=new Vector3;return function setFromUnitVectors(r,i){return void 0===t&&(t=new Vector3),(e=r.dot(i)+1)<1e-6?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,i),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(_t.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this},inverse:function(){\n// quaternion is assumed to have unit length\nreturn this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){\n// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\nvar r=e._x,i=e._y,n=e._z,a=e._w,o=t._x,s=t._y,c=t._z,l=t._w;return this._x=r*l+a*o+i*c-n*s,this._y=i*l+a*s+n*o-r*c,this._z=n*l+a*c+r*s-i*o,this._w=a*l-r*o-i*s-n*c,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w,o=a*e._w+r*e._x+i*e._y+n*e._z;\n// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\nif(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;var s=1-o*o;if(s<=Number.EPSILON){var c=1-t;return this._w=c*a+t*this._w,this._x=c*r+t*this._x,this._y=c*i+t*this._y,this._z=c*n+t*this._z,this.normalize()}var l=Math.sqrt(s),h=Math.atan2(l,o),u=Math.sin((1-t)*h)/l,p=Math.sin(t*h)/l;return this._w=a*u+this._w*p,this._x=r*u+this._x*p,this._y=i*u+this._y*p,this._z=n*u+this._z*p,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Vector3.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new Quaternion;return function applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new Quaternion;return function applyAxisAngle(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,o=e.z,s=e.w,c=s*t+a*i-o*r,l=s*r+o*t-n*i,h=s*i+n*r-a*t,u=-n*t-a*r-o*i;\n// calculate result * inverse quat\nreturn this.x=c*s+u*-n+l*-o-h*-a,this.y=l*s+u*-a+h*-n-c*-o,this.z=h*s+u*-o+c*-a-l*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new Matrix4;return function unproject(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){\n// input: THREE.Matrix4 affine matrix\n// vector interpreted as a direction\nvar t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){\n// assumes min < max, componentwise\nreturn this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Vector3,t=new Vector3;return function clampScalar(r,i){return e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},\n// TODO lengthSquared?\nlengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*a-r*s,this.z=r*o-i*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Vector3;return function projectOnPlane(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){\n// reflect incident vector off plane orthogonal to normal\n// normal is assumed to have unit length\nvar e=new Vector3;return function reflect(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());\n// clamp, to handle numerical problems\nreturn Math.acos(_t.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(e,t,r,i,n,a,o,s,c){var l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=n,l[5]=s,l[6]=r,l[7]=a,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var r=0,i=t.count;r<i;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[3],s=r[6],c=r[1],l=r[4],h=r[7],u=r[2],p=r[5],d=r[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],_=i[5],M=i[8];return n[0]=a*f+o*v+s*b,n[3]=a*m+o*y+s*_,n[6]=a*g+o*x+s*M,n[1]=c*f+l*v+h*b,n[4]=c*m+l*y+h*_,n[7]=c*g+l*x+h*M,n[2]=u*f+p*v+d*b,n[5]=u*m+p*y+d*_,n[8]=u*g+p*x+d*M,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8];return t*a*l-t*o*c-r*n*l+r*o*s+i*n*c-i*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,n=r[0],a=r[1],o=r[2],s=r[3],c=r[4],l=r[5],h=r[6],u=r[7],p=r[8],d=p*c-l*u,f=l*h-p*s,m=u*s-c*h,g=n*d+a*f+o*m;if(0===g){var v="THREE.Matrix3: .getInverse() can\'t invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return i[0]=d*y,i[1]=(o*u-p*a)*y,i[2]=(l*a-o*c)*y,i[3]=f*y,i[4]=(p*n-o*h)*y,i[5]=(o*s-l*n)*y,i[6]=m*y,i[7]=(a*h-u*n)*y,i[8]=(c*n-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,i,n,a,o){var s=Math.cos(n),c=Math.sin(n);this.set(r*s,r*c,-r*(s*a+c*o)+a+e,-i*c,i*s,-i*(-c*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=this.elements,n=i[0],a=i[3],o=i[6],s=i[1],c=i[4],l=i[7];return i[0]=t*n+r*s,i[3]=t*a+r*c,i[6]=t*o+r*l,i[1]=-r*n+t*s,i[4]=-r*a+t*c,i[7]=-r*o+t*l,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author szimek / https://github.com/szimek/\n */\nvar Mt={getDataURL:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},wt=0;\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author szimek / https://github.com/szimek/\n */function Texture(e,t,r,i,n,a,o,s,c,l){Object.defineProperty(this,"id",{value:wt++}),this.uuid=_t.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:ce,this.wrapT=void 0!==i?i:ce,this.magFilter=void 0!==n?n:de,this.minFilter=void 0!==a?a:me,this.anisotropy=void 0!==c?c:1,this.format=void 0!==o?o:Pe,this.type=void 0!==s?s:ge,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\n// Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.\n//\n// Also changing the encoding after already used by a Material will not automatically make the Material\n// update.  You need to explicitly call Material.needsUpdate to trigger it to recompile.\nthis.encoding=void 0!==l?l:ht,this.version=0,this.onUpdate=null}\n/**\n * @author supereggbert / http://www.paulbrunt.co.uk/\n * @author philogb / http://blog.thejit.org/\n * @author mikael emtinger / http://gomo.se/\n * @author egraether / http://egraether.com/\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction Vector4(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1}\n/**\n * @author szimek / https://github.com/szimek/\n * @author alteredq / http://alteredqualia.com/\n * @author Marius Kintel / https://github.com/kintel\n */\n/*\n In options, we can specify:\n * Texture parameters for an auto-generated target texture\n * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers\n*/\nfunction WebGLRenderTarget(e,t,r){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),void 0===(r=r||{}).minFilter&&(r.minFilter=de),this.texture=new Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0===r.generateMipmaps||r.generateMipmaps,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}\n/**\n * @author alteredq / http://alteredqualia.com\n */\nfunction WebGLRenderTargetCube(e,t,r){WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0,// PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\nthis.activeMipMapLevel=0}\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction DataTexture(e,t,r,i,n,a,o,s,c,l,h,u){Texture.call(this,null,a,o,s,c,l,i,n,h,u),this.image={data:e,width:t,height:r},this.magFilter=void 0!==c?c:he,this.minFilter=void 0!==l?l:he,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}\n/**\n * @author bhouston / http://clara.io\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}\n/**\n * @author bhouston / http://clara.io\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}\n/**\n * @author bhouston / http://clara.io\n */\nfunction Plane(e,t){\n// normal is assumed to be normalized\nthis.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author bhouston / http://clara.io\n */\nfunction Frustum(e,t,r,i,n,a){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==r?r:new Plane,void 0!==i?i:new Plane,void 0!==n?n:new Plane,void 0!==a?a:new Plane]}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){\n// TODO: Move to THREE.Image\nvar i=this.image;if(void 0===i.uuid&&(i.uuid=_t.generateUUID()),!t&&void 0===e.images[i.uuid]){var n;if(Array.isArray(i)){\n// process array of images e.g. CubeTexture\nn=[];for(var a=0,o=i.length;a<o;a++)n.push(Mt.getDataURL(i[a]))}else\n// process single image\nn=Mt.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case se:e.x=e.x-Math.floor(e.x);break;case ce:e.x=e.x<0?0:1;break;case le:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case se:e.y=e.y-Math.floor(e.y);break;case ce:e.y=e.y<0?0:1;break;case le:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\n// q is assumed to be normalized\nthis.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){\n// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\nvar t,r,i,n,// margin to distinguish between 0 and 180 degrees\na=e.elements,o=a[0],s=a[4],c=a[8],l=a[1],h=a[5],u=a[9],p=a[2],d=a[6],f=a[10];if(Math.abs(s-l)<.01&&Math.abs(c-p)<.01&&Math.abs(u-d)<.01){\n// singularity found\n// first check for identity matrix which must have +1 for all terms\n// in leading diagonal and zero in other terms\nif(Math.abs(s+l)<.1&&Math.abs(c+p)<.1&&Math.abs(u+d)<.1&&Math.abs(o+h+f-3)<.1)\n// this singularity is identity matrix so angle = 0\nreturn this.set(1,0,0,0),this;// zero angle, arbitrary axis\n// otherwise this singularity is angle = 180\nt=Math.PI;var m=(o+1)/2,g=(h+1)/2,v=(f+1)/2,y=(s+l)/4,x=(c+p)/4,b=(u+d)/4;return m>g&&m>v?\n// m11 is the largest diagonal term\nm<.01?(r=0,i=.707106781,n=.707106781):(i=y/(r=Math.sqrt(m)),n=x/r):g>v?\n// m22 is the largest diagonal term\ng<.01?(r=.707106781,i=0,n=.707106781):(r=y/(i=Math.sqrt(g)),n=b/i):\n// m33 is the largest diagonal term so base result on this\nv<.01?(r=.707106781,i=.707106781,n=0):(r=x/(n=Math.sqrt(v)),i=b/n),this.set(r,i,n,t),this;// return 180 deg rotation\n}\n// as we have reached here there are no singularities so we can handle normally\nvar _=Math.sqrt((d-u)*(d-u)+(c-p)*(c-p)+(l-s)*(l-s));// used to normalize\nreturn Math.abs(_)<.001&&(_=1),\n// prevent divide by zero, should not happen if matrix is orthogonal and should be\n// caught by singularity test above, but I\'ve left it in just in case\nthis.x=(d-u)/_,this.y=(c-p)/_,this.z=(l-s)/_,this.w=Math.acos((o+h+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){\n// assumes min < max, componentwise\nreturn this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function clampScalar(r,i){return void 0===e&&(e=new Vector4,t=new Vector4),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype),WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube,WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0,DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0,Object.assign(Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,c=e.length;s<c;s+=3){var l=e[s],h=e[s+1],u=e[s+2];l<t&&(t=l),h<r&&(r=h),u<i&&(i=u),l>n&&(n=l),h>a&&(a=h),u>o&&(o=u)}return this.min.set(t,r,i),this.max.set(n,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,c=e.count;s<c;s++){var l=e.getX(s),h=e.getY(s),u=e.getZ(s);l<t&&(t=l),h<r&&(r=h),u<i&&(i=u),l>n&&(n=l),h>a&&(a=h),u>o&&(o=u)}return this.min.set(t,r,i),this.max.set(n,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector3;return function setFromCenterAndSize(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){\n// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\nreturn this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){\n// Computes the world-axis-aligned bounding box of an object (including its children),\n// accounting for both the object\'s, and children\'s, world transforms\nvar e,t,r,i=new Vector3;function traverse(n){var a=n.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)i.copy(o[t]),i.applyMatrix4(n.matrixWorld),e.expandByPoint(i)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,r=s.count;t<r;t++)i.fromBufferAttribute(s,t).applyMatrix4(n.matrixWorld),e.expandByPoint(i)}}return function expandByObject(t){return e=this,t.updateMatrixWorld(!0),t.traverse(traverse),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){\n// This can potentially have a divide by zero if the box\n// has a size dimension of 0.\nreturn void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){\n// using 6 splitting planes to rule out intersections.\nreturn!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new Vector3;return function intersectsSphere(t){\n// If that point is inside the sphere, the AABB and sphere intersect.\n// Find the point on the AABB closest to the sphere center.\nreturn this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){\n// We compute the minimum and maximum dot product values. If those values\n// are on the same side (back or front) of the plane, then there is no intersection.\nvar t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){\n// triangle centered vertices\nvar e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector3,n=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,c=new Vector3,l=new Vector3;function satForAxes(i){var n,a;for(n=0,a=i.length-3;n<=a;n+=3){o.fromArray(i,n);\n// project the aabb onto the seperating axis\nvar s=c.x*Math.abs(o.x)+c.y*Math.abs(o.y)+c.z*Math.abs(o.z),l=e.dot(o),h=t.dot(o),u=r.dot(o);\n// project all 3 vertices of the triangle onto the seperating axis\n// actual test, basically see if either of the most extreme of the triangle points intersects r\nif(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>s)\n// points of the projected triangle are outside the projected half-length of the aabb\n// the axis is seperating and we can exit\nreturn!1}return!0}return function intersectsTriangle(o){if(this.isEmpty())return!1;\n// compute box center and extents\nthis.getCenter(s),c.subVectors(this.max,s),\n// translate triangle to aabb origin\ne.subVectors(o.a,s),t.subVectors(o.b,s),r.subVectors(o.c,s),\n// compute edge vectors for triangle\ni.subVectors(t,e),n.subVectors(r,t),a.subVectors(e,r);\n// test against axes that are given by cross product combinations of the edges of the triangle and the edges of the aabb\n// make an axis testing of each of the 3 sides of the aabb against each of the 3 sides of the triangle = 9 axis of separation\n// axis_ij = u_i x f_j (u0, u1, u2 = face normals of aabb = x,y,z axes vectors since aabb is axis aligned)\nvar h=[0,-i.z,i.y,0,-n.z,n.y,0,-a.z,a.y,i.z,0,-i.x,n.z,0,-n.x,a.z,0,-a.x,-i.y,i.x,0,-n.y,n.x,0,-a.y,a.x,0];return!!satForAxes(h)&&(!!satForAxes(\n// test 3 face normals from the aabb\nh=[1,0,0,0,1,0,0,0,1])&&(\n// finally testing the face normal of the triangle\n// use already existing triangle edge vectors here\nl.crossVectors(i,n),satForAxes(h=[l.x,l.y,l.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector3;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Vector3;return function getBoundingSphere(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Sphere),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),\n// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.\nthis.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3];return function applyMatrix4(t){\n// transform of empty box is an empty box.\nreturn this.isEmpty()?this:(\n// NOTE: I am using a binary pattern to specify all 2^3 combinations below\ne[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),// 000\ne[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),// 001\ne[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),// 010\ne[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),// 011\ne[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),// 100\ne[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),// 101\ne[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),// 110\ne[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),// 111\nthis.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Box3;return function setFromPoints(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).getCenter(i);for(var n=0,a=0,o=t.length;a<o;a++)n=Math.max(n,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(Plane.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Vector3,t=new Vector3;return function setFromCoplanarPoints(r,i,n){var a=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();\n// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\nreturn this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){\n// Note: will lead to a divide by zero if the plane is invalid.\nvar e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Vector3;return function intersectLine(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Vector3);var i=t.delta(e),n=this.normal.dot(i);if(0===n)\n// line is coplanar, return origin\nreturn 0===this.distanceToPoint(t.start)?r.copy(t.start):\n// Unsure if this is the correct method to handle this case.\nvoid 0;var a=-(t.start.dot(this.normal)+this.constant)/n;return a<0||a>1?void 0:r.copy(i).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){\n// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\nvar t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Vector3,t=new Matrix3;return function applyMatrix4(r,i){var n=i||t.getNormalMatrix(r),a=this.coplanarPoint(e).applyMatrix4(r),o=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Frustum.prototype,{set:function(e,t,r,i,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],c=r[5],l=r[6],h=r[7],u=r[8],p=r[9],d=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(o-i,h-s,f-u,y-m).normalize(),t[1].setComponents(o+i,h+s,f+u,y+m).normalize(),t[2].setComponents(o+n,h+c,f+p,y+g).normalize(),t[3].setComponents(o-n,h-c,f-p,y-g).normalize(),t[4].setComponents(o-a,h-l,f-d,y-v).normalize(),t[5].setComponents(o+a,h+l,f+d,y+v).normalize(),this},intersectsObject:function(){var e=new Sphere;return function intersectsObject(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Sphere;return function intersectsSprite(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){for(var r=this.planes,i=0;i<6;i++){var n=r[i];\n// corner at max distance\nif(e.x=n.normal.x>0?t.max.x:t.min.x,e.y=n.normal.y>0?t.max.y:t.min.y,e.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(e)<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var Tt={alphamap_fragment:"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\\n",alphatest_fragment:"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\\n",aomap_fragment:"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\\n",aomap_pars_fragment:"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif",begin_vertex:"\\nvec3 transformed = vec3( position );\\n",beginnormal_vertex:"\\nvec3 objectNormal = vec3( normal );\\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\tif( cutoffDistance > 0.0 ) {\\n\\t\\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t}\\n\\treturn distanceFalloff;\\n#else\\n\\tif( cutoffDistance > 0.0 ) {\\n\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\t}\\n\\treturn 1.0;\\n#endif\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\\n\\tconst float LUT_SIZE  = 64.0;\\n\\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\\n\\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\\n\\tfloat dotNV = saturate( dot( N, V ) );\\n\\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\\n\\tuv = uv * LUT_SCALE + LUT_BIAS;\\n\\treturn uv;\\n}\\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\\n\\tfloat l = length( f );\\n\\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\\n}\\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\\n\\tfloat x = dot( v1, v2 );\\n\\tfloat y = abs( x );\\n\\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\\n\\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\\n\\tfloat v = a / b;\\n\\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\\n\\treturn cross( v1, v2 ) * theta_sintheta;\\n}\\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\\n\\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\\n\\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\\n\\tvec3 lightNormal = cross( v1, v2 );\\n\\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\\n\\tvec3 T1, T2;\\n\\tT1 = normalize( V - N * dot( V, N ) );\\n\\tT2 = - cross( N, T1 );\\n\\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\\n\\tvec3 coords[ 4 ];\\n\\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\\n\\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\\n\\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\\n\\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\\n\\tcoords[ 0 ] = normalize( coords[ 0 ] );\\n\\tcoords[ 1 ] = normalize( coords[ 1 ] );\\n\\tcoords[ 2 ] = normalize( coords[ 2 ] );\\n\\tcoords[ 3 ] = normalize( coords[ 3 ] );\\n\\tvec3 vectorFormFactor = vec3( 0.0 );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\\n\\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\\n\\treturn vec3( result );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\t\\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\\n\\t\\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 );\\n\\t\\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\\n\\tvec4 plane;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\\n\\t\\tplane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n\\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\\n\\t\\tbool clipped = true;\\n\\t\\t#pragma unroll_loop\\n\\t\\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\\n\\t\\t\\tplane = clippingPlanes[ i ];\\n\\t\\t\\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\\n\\t\\t}\\n\\t\\tif ( clipped ) discard;\\n\\t#endif\\n#endif\\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\\n\\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\\n\\t\\tvarying vec3 vViewPosition;\\n\\t#endif\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n",color_fragment:"#ifdef USE_COLOR\\n\\tdiffuseColor.rgb *= vColor;\\n#endif",color_pars_fragment:"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\\n",color_pars_vertex:"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif",color_vertex:"#ifdef USE_COLOR\\n\\tvColor.xyz = color.xyz;\\n#endif",common:"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define PI_HALF 1.5707963267949\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\nmat3 transposeMat3( const in mat3 m ) {\\n\\tmat3 tmp;\\n\\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\\n\\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\\n\\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\\n\\treturn tmp;\\n}\\nfloat linearToRelativeLuminance( const in vec3 color ) {\\n\\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\\n\\treturn dot( weights, color.rgb );\\n}\\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\\n#define cubeUV_textureSize (1024.0)\\nint getFaceFromDirection(vec3 direction) {\\n\\tvec3 absDirection = abs(direction);\\n\\tint face = -1;\\n\\tif( absDirection.x > absDirection.z ) {\\n\\t\\tif(absDirection.x > absDirection.y )\\n\\t\\t\\tface = direction.x > 0.0 ? 0 : 3;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\telse {\\n\\t\\tif(absDirection.z > absDirection.y )\\n\\t\\t\\tface = direction.z > 0.0 ? 2 : 5;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\treturn face;\\n}\\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\\tfloat dxRoughness = dFdx(roughness);\\n\\tfloat dyRoughness = dFdy(roughness);\\n\\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\\tfloat mipLevel = 0.5 * log2(d);\\n\\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\\tbool bRes = mipLevel == 0.0;\\n\\tscale =  bRes && (scale < a) ? a : scale;\\n\\tvec3 r;\\n\\tvec2 offset;\\n\\tint face = getFaceFromDirection(direction);\\n\\tfloat rcpPowScale = 1.0 / powScale;\\n\\tif( face == 0) {\\n\\t\\tr = vec3(direction.x, -direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\\n\\t}\\n\\telse if( face == 1) {\\n\\t\\tr = vec3(direction.y, direction.x, direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\\n\\t}\\n\\telse if( face == 2) {\\n\\t\\tr = vec3(direction.z, direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\\n\\t}\\n\\telse if( face == 3) {\\n\\t\\tr = vec3(direction.x, direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\\n\\t}\\n\\telse if( face == 4) {\\n\\t\\tr = vec3(direction.y, direction.x, -direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\\n\\t}\\n\\telse {\\n\\t\\tr = vec3(direction.z, -direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\\n\\t}\\n\\tr = normalize(r);\\n\\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\\tvec2 base = offset + vec2( texelOffset );\\n\\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\\n\\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\\tfloat r1 = floor(roughnessVal);\\n\\tfloat r2 = r1 + 1.0;\\n\\tfloat t = fract(roughnessVal);\\n\\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\\tfloat s = mipInfo.y;\\n\\tfloat level0 = mipInfo.x;\\n\\tfloat level1 = level0 + 1.0;\\n\\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\\tvec4 result = mix(color10, color20, t);\\n\\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\\n#ifdef FLIP_SIDED\\n\\ttransformedNormal = - transformedNormal;\\n#endif\\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\\n",encodings_pars_fragment:"\\nvec4 LinearToLinear( in vec4 value ) {\\n\\treturn value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n\\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n\\tfloat maxComponent = max( max( value.r, value.g ), value.b );\\n\\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n\\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n\\tM = ceil( M * 255.0 ) / 255.0;\\n\\treturn vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat D = max( maxRange / maxRGB, 1.0 );\\n\\tD = min( floor( D ) / 255.0, 1.0 );\\n\\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n\\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n\\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\\n\\tvec4 vResult;\\n\\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n\\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n\\tvResult.w = fract( Le );\\n\\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\\n\\treturn vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n\\tfloat Le = value.z * 255.0 + value.w;\\n\\tvec3 Xp_Y_XYZp;\\n\\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\\n\\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n\\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n\\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n\\treturn vec4( max( vRGB, 0.0 ), 1.0 );\\n}\\n",envmap_fragment:"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\tvec2 sampleUV;\\n\\t\\treflectVec = normalize( reflectVec );\\n\\t\\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\t\\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\treflectVec = normalize( reflectVec );\\n\\t\\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\\n\\t\\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\\t#else\\n\\t\\tvec4 envColor = vec4( 0.0 );\\n\\t#endif\\n\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\\tuniform float reflectivity;\\n\\tuniform float envMapIntensity;\\n#endif\\n#ifdef USE_ENVMAP\\n\\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\tuniform float flipEnvMap;\\n\\tuniform int maxMipLevel;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\\n",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\\n\\t\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\t\\tvec2 sampleUV;\\n\\t\\t\\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\t\\t\\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\t\\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\\n",envmap_vertex:"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\n",fog_vertex:"#ifdef USE_FOG\\n\\tfogDepth = -mvPosition.z;\\n#endif\\n",fog_pars_vertex:"#ifdef USE_FOG\\n\\tvarying float fogDepth;\\n#endif\\n",fog_fragment:"#ifdef USE_FOG\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\\n",fog_pars_fragment:"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\tvarying float fogDepth;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\\n",gradientmap_pars_fragment:"#ifdef TOON\\n\\tuniform sampler2D gradientMap;\\n\\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\\n\\t\\tfloat dotNL = dot( normal, lightDirection );\\n\\t\\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\\n\\t\\t#ifdef USE_GRADIENTMAP\\n\\t\\t\\treturn texture2D( gradientMap, coord ).rgb;\\n\\t\\t#else\\n\\t\\t\\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\\n\\t\\t#endif\\n\\t}\\n#endif\\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\\n\\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n#endif\\n",lights_pars_begin:"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t\\tfloat shadowCameraNear;\\n\\t\\tfloat shadowCameraFar;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tdirectLight.color = pointLight.color;\\n\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( angleCos > spotLight.coneCos ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tstruct RectAreaLight {\\n\\t\\tvec3 color;\\n\\t\\tvec3 position;\\n\\t\\tvec3 halfWidth;\\n\\t\\tvec3 halfHeight;\\n\\t};\\n\\tuniform sampler2D ltc_1;\\tuniform sampler2D ltc_2;\\n\\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\\n",lights_phong_fragment:"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tvec3\\tspecularColor;\\n\\tfloat\\tspecularShininess;\\n\\tfloat\\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t#ifdef TOON\\n\\t\\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\\n\\t#else\\n\\t\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\t\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#endif\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\\n",lights_physical_fragment:"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.clearCoat = saturate( clearCoat );\\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\\n#endif\\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tfloat\\tspecularRoughness;\\n\\tvec3\\tspecularColor;\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoat;\\n\\t\\tfloat clearCoatRoughness;\\n\\t#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\\n\\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\\n}\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t\\tvec3 normal = geometry.normal;\\n\\t\\tvec3 viewDir = geometry.viewDir;\\n\\t\\tvec3 position = geometry.position;\\n\\t\\tvec3 lightPos = rectAreaLight.position;\\n\\t\\tvec3 halfWidth = rectAreaLight.halfWidth;\\n\\t\\tvec3 halfHeight = rectAreaLight.halfHeight;\\n\\t\\tvec3 lightColor = rectAreaLight.color;\\n\\t\\tfloat roughness = material.specularRoughness;\\n\\t\\tvec3 rectCoords[ 4 ];\\n\\t\\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\\t\\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\\n\\t\\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\\n\\t\\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\\n\\t\\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\\n\\t\\tvec4 t1 = texture2D( ltc_1, uv );\\n\\t\\tvec4 t2 = texture2D( ltc_2, uv );\\n\\t\\tmat3 mInv = mat3(\\n\\t\\t\\tvec3( t1.x, 0, t1.y ),\\n\\t\\t\\tvec3(    0, 1,    0 ),\\n\\t\\t\\tvec3( t1.z, 0, t1.w )\\n\\t\\t);\\n\\t\\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\\n\\t\\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\\n\\t\\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\\n\\t}\\n#endif\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\\n\\t#else\\n\\t\\tfloat clearCoatDHR = 0.0;\\n\\t#endif\\n\\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n\\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t#ifndef STANDARD\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\tfloat dotNL = dotNV;\\n\\t\\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\\n\\t#else\\n\\t\\tfloat clearCoatDHR = 0.0;\\n\\t#endif\\n\\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_Direct_RectArea\\t\\tRE_Direct_RectArea_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\\n",lights_fragment_begin:"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\\n\\tRectAreaLight rectAreaLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\\n\\t\\trectAreaLight = rectAreaLights[ i ];\\n\\t\\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\t#pragma unroll_loop\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t#endif\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tvec3 radiance = vec3( 0.0 );\\n\\tvec3 clearCoatRadiance = vec3( 0.0 );\\n#endif\\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\\n\\t#endif\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\\n\\t#ifndef STANDARD\\n\\t\\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\\n\\t#endif\\n#endif\\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\\n#endif\\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tuniform float logDepthBufFC;\\n\\tvarying float vFragDepth;\\n#endif\\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#else\\n\\t\\tuniform float logDepthBufFC;\\n\\t#endif\\n#endif\\n",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t#else\\n\\t\\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\\n\\t\\tgl_Position.z *= gl_Position.w;\\n\\t#endif\\n#endif\\n",map_fragment:"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\\n",map_pars_fragment:"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n",map_particle_fragment:"#ifdef USE_MAP\\n\\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\\n\\tvec4 mapTexel = texture2D( map, uv );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n",map_particle_pars_fragment:"#ifdef USE_MAP\\n\\tuniform mat3 uvTransform;\\n\\tuniform sampler2D map;\\n#endif\\n",metalnessmap_fragment:"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.b;\\n#endif\\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\\n\\t#ifndef USE_MORPHNORMALS\\n\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\\n\\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\\n",normal_fragment_begin:"#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t#endif\\n#endif\\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\\n\\t#ifdef OBJECTSPACE_NORMALMAP\\n\\t\\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\t#ifdef FLIP_SIDED\\n\\t\\t\\tnormal = - normal;\\n\\t\\t#endif\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t\\t#endif\\n\\t\\tnormal = normalize( normalMatrix * normal );\\n\\t#else\\n\\t\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\t#endif\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\t#ifdef OBJECTSPACE_NORMALMAP\\n\\t\\tuniform mat3 normalMatrix;\\n\\t#else\\n\\t\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\t\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\t\\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\\n\\t\\t\\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\\n\\t\\t\\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\\n\\t\\t\\tvec3 N = normalize( surf_norm );\\n\\t\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\t\\tmapN.xy *= normalScale;\\n\\t\\t\\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t\\t\\treturn normalize( tsn * mapN );\\n\\t\\t}\\n\\t#endif\\n#endif\\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\\n\\treturn normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n\\treturn 2.0 * rgb.xyz - 1.0;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n\\treturn linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n\\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\ngl_Position = projectionMatrix * mvPosition;\\n",dithering_fragment:"#if defined( DITHERING )\\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\\n#endif\\n",dithering_pars_fragment:"#if defined( DITHERING )\\n\\tvec3 dithering( vec3 color ) {\\n\\t\\tfloat grid_position = rand( gl_FragCoord.xy );\\n\\t\\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\\n\\t\\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\\n\\t\\treturn color + dither_shift_RGB;\\n\\t}\\n#endif\\n",roughnessmap_fragment:"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.g;\\n#endif\\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\\t\\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\\t\\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\\t\\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\\t\\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\\t\\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\\t\\tvec2 f = fract( uv * size + 0.5 );\\n\\t\\tfloat a = mix( lb, lt, f.y );\\n\\t\\tfloat b = mix( rb, rt, f.y );\\n\\t\\tfloat c = mix( a, b, f.x );\\n\\t\\treturn c;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tfloat shadow = 1.0;\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn shadow;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\\t\\tdp += shadowBias;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n#endif\\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n#endif\\n",shadowmask_pars_fragment:"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tDirectionalLight directionalLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tSpotLight spotLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tPointLight pointLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\\n",skinbase_vertex:"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform sampler2D boneTexture;\\n\\t\\tuniform int boneTextureSize;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureSize ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureSize ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureSize );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureSize );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\\n",skinning_vertex:"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\ttransformed = ( bindMatrixInverse * skinned ).xyz;\\n#endif\\n",skinnormal_vertex:"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\\n",specularmap_fragment:"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\\n",tonemapping_pars_fragment:"#ifndef saturate\\n\\t#define saturate(a) clamp( a, 0.0, 1.0 )\\n#endif\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n\\treturn toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\tcolor = max( vec3( 0.0 ), color - 0.004 );\\n\\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n\\tuniform mat3 uvTransform;\\n#endif\\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = uv2;\\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\\n\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n#endif\\n",background_frag:"uniform sampler2D t2D;\\nvarying vec2 vUv;\\nvoid main() {\\n\\tgl_FragColor = texture2D( t2D, vUv );\\n}\\n",background_vert:"varying vec2 vUv;\\nvoid main() {\\n\\tvUv = uv;\\n\\tgl_Position = vec4( position, 1.0 );\\n\\tgl_Position.z = 1.0;\\n}\\n",cube_frag:"uniform samplerCube tCube;\\nuniform float tFlip;\\nuniform float opacity;\\nvarying vec3 vWorldPosition;\\nvoid main() {\\n\\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\\n\\tgl_FragColor.a *= opacity;\\n}\\n",cube_vert:"varying vec3 vWorldPosition;\\n#include <common>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\tgl_Position.z = gl_Position.w;\\n}\\n",depth_frag:"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\\t#endif\\n}\\n",depth_vert:"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n",distanceRGBA_frag:"#define DISTANCE\\nuniform vec3 referencePosition;\\nuniform float nearDistance;\\nuniform float farDistance;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\tfloat dist = length( vWorldPosition - referencePosition );\\n\\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\\n\\tdist = saturate( dist );\\n\\tgl_FragColor = packDepthToRGBA( dist );\\n}\\n",distanceRGBA_vert:"#define DISTANCE\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition.xyz;\\n}\\n",equirect_frag:"uniform sampler2D tEquirect;\\nvarying vec3 vWorldPosition;\\n#include <common>\\nvoid main() {\\n\\tvec3 direction = normalize( vWorldPosition );\\n\\tvec2 sampleUV;\\n\\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n}\\n",equirect_vert:"varying vec3 vWorldPosition;\\n#include <common>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n}\\n",linedashed_frag:"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n",linedashed_vert:"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\tvLineDistance = scale * lineDistance;\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\\n",meshbasic_frag:"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vec3( 1.0 );\\n\\t#endif\\n\\t#include <aomap_fragment>\\n\\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n",meshbasic_vert:"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <fog_vertex>\\n}\\n",meshlambert_frag:"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\\n",meshlambert_vert:"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\\n",meshmatcap_frag:"#define MATCAP\\nuniform vec3 diffuse;\\nuniform float opacity;\\nuniform sampler2D matcap;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tvec3 viewDir = normalize( vViewPosition );\\n\\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\\n\\tvec3 y = cross( viewDir, x );\\n\\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\\n\\tvec4 matcapColor = texture2D( matcap, uv );\\n\\tmatcapColor = matcapTexelToLinear( matcapColor );\\n\\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n",meshmatcap_vert:"#define MATCAP\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#ifndef FLAT_SHADED\\n\\t\\tvNormal = normalize( transformedNormal );\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n}\\n",meshphong_frag:"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <gradientmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\\n",meshphong_vert:"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\\n",meshphysical_frag:"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <envmap_pars_fragment>\\n#include <envmap_physical_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <lights_pars_begin>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\\n",meshphysical_vert:"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\\n",normal_frag:"#define NORMAL\\nuniform float opacity;\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\nvoid main() {\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\\n}\\n",normal_vert:"#define NORMAL\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n}\\n",points_frag:"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n",points_vert:"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\tgl_PointSize = size;\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\\n\\t\\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <fog_vertex>\\n}\\n",shadow_frag:"uniform vec3 color;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\\n\\t#include <fog_fragment>\\n}\\n",shadow_vert:"#include <fog_pars_vertex>\\n#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\\n",sprite_frag:"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n",sprite_vert:"uniform float rotation;\\nuniform vec2 center;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\tvec2 scale;\\n\\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\\n\\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\\n\\t#ifndef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\\n\\t\\tif ( isPerspective ) scale *= - mvPosition.z;\\n\\t#endif\\n\\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\\n\\tvec2 rotatedPosition;\\n\\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n\\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n\\tmvPosition.xy += rotatedPosition;\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\\n"},Et={merge:function(e){for(var t={},r=0;r<e.length;r++){var i=this.clone(e[r]);for(var n in i)t[n]=i[n]}return t},clone:function(e){var t={};for(var r in e)for(var i in t[r]={},e[r]){var n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}return t}},St={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Color(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function setHSL(e,t,r){if(\n// h,s,l ranges are in 0.0 - 1.0\ne=_t.euclideanModulo(e,1),t=_t.clamp(t,0,1),r=_t.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=hue2rgb(n,i,e+1/3),this.g=hue2rgb(n,i,e),this.b=hue2rgb(n,i,e-1/3)}return this}}(),setStyle:function(e){function handleAlpha(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var t;if(t=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(e)){\n// rgb / hsl\nvar r,i=t[1],n=t[2];switch(i){case"rgb":case"rgba":if(r=/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(n))\n// rgb(255,0,0) rgba(255,0,0,0.5)\nreturn this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,handleAlpha(r[5]),this;if(r=/^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(n))\n// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)\nreturn this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,handleAlpha(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(n)){\n// hsl(120,50%,50%) hsla(120,50%,50%,0.5)\nvar a=parseFloat(r[1])/360,o=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;return handleAlpha(r[5]),this.setHSL(a,o,s)}}}else if(t=/^\\#([A-Fa-f0-9]+)$/.exec(e)){\n// hex color\nvar c,l=(c=t[1]).length;if(3===l)\n// #ff0\nreturn this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)\n// #ff0000\nreturn this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(c=St[e])?\n// red\nthis.setHex(c):\n// unknown color\nconsole.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}}(),copyLinearToSRGB:function(){function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){\n// h,s,l ranges are in 0.0 - 1.0\nvoid 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,i=this.r,n=this.g,a=this.b,o=Math.max(i,n,a),s=Math.min(i,n,a),c=(s+o)/2;if(s===o)t=0,r=0;else{var l=o-s;switch(r=c<=.5?l/(o+s):l/(2-o-s),o){case i:t=(n-a)/l+(n<a?6:0);break;case n:t=(a-i)/l+2;break;case a:t=(i-n)/l+4}t/=6}return e.h=t,e.s=r,e.l=c,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,r,i){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=i,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function lerpHSL(r,i){this.getHSL(e),r.getHSL(t);var n=_t.lerp(e.h,t.h,i),a=_t.lerp(e.s,t.s,i),o=_t.lerp(e.l,t.l,i);return this.setHSL(n,a,o),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});\n/**\n * Uniforms library for shared webgl shaders\n */\nvar Lt={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},\n// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src\nrectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Matrix3}}},At={basic:{uniforms:Et.merge([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.fog]),vertexShader:Tt.meshbasic_vert,fragmentShader:Tt.meshbasic_frag},lambert:{uniforms:Et.merge([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.fog,Lt.lights,{emissive:{value:new Color(0)}}]),vertexShader:Tt.meshlambert_vert,fragmentShader:Tt.meshlambert_frag},phong:{uniforms:Et.merge([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.gradientmap,Lt.fog,Lt.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Tt.meshphong_vert,fragmentShader:Tt.meshphong_frag},standard:{uniforms:Et.merge([Lt.common,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.roughnessmap,Lt.metalnessmap,Lt.fog,Lt.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag},matcap:{uniforms:Et.merge([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,{matcap:{value:null}}]),vertexShader:Tt.meshmatcap_vert,fragmentShader:Tt.meshmatcap_frag},points:{uniforms:Et.merge([Lt.points,Lt.fog]),vertexShader:Tt.points_vert,fragmentShader:Tt.points_frag},dashed:{uniforms:Et.merge([Lt.common,Lt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tt.linedashed_vert,fragmentShader:Tt.linedashed_frag},depth:{uniforms:Et.merge([Lt.common,Lt.displacementmap]),vertexShader:Tt.depth_vert,fragmentShader:Tt.depth_frag},normal:{uniforms:Et.merge([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,{opacity:{value:1}}]),vertexShader:Tt.normal_vert,fragmentShader:Tt.normal_frag},sprite:{uniforms:Et.merge([Lt.sprite,Lt.fog]),vertexShader:Tt.sprite_vert,fragmentShader:Tt.sprite_frag},background:{uniforms:{t2D:{value:null}},vertexShader:Tt.background_vert,fragmentShader:Tt.background_frag},\n/* -------------------------------------------------------------------------\n\t//\tCube map shader\n\t ------------------------------------------------------------------------- */\ncube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Tt.cube_vert,fragmentShader:Tt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tt.equirect_vert,fragmentShader:Tt.equirect_frag},distanceRGBA:{uniforms:Et.merge([Lt.common,Lt.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tt.distanceRGBA_vert,fragmentShader:Tt.distanceRGBA_frag},shadow:{uniforms:Et.merge([Lt.lights,Lt.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Tt.shadow_vert,fragmentShader:Tt.shadow_frag}};\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n * @author mikael emtinger / http://gomo.se/\n */\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebGLAnimation(){var e=null,t=!1,r=null;function onAnimationFrame(i,n){!1!==t&&(r(i,n),e.requestAnimationFrame(onAnimationFrame))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(onAnimationFrame),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */function WebGLAttributes(e){var t=new WeakMap;return{get:\n//\nfunction get(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function remove(r){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);i&&(e.deleteBuffer(i.buffer),t.delete(r))},update:function update(r,i){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);void 0===n?t.set(r,function createBuffer(t,r){var i=t.array,n=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,i,n),t.onUploadCallback();var o=e.FLOAT;return i instanceof Float32Array?o=e.FLOAT:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=e.UNSIGNED_SHORT:i instanceof Int16Array?o=e.SHORT:i instanceof Uint32Array?o=e.UNSIGNED_INT:i instanceof Int32Array?o=e.INT:i instanceof Int8Array?o=e.BYTE:i instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(r,i)):n.version<r.version&&(function updateBuffer(t,r,i){var n=r.array,a=r.updateRange;e.bindBuffer(i,t),!1===r.dynamic?e.bufferData(i,n,e.STATIC_DRAW):-1===a.count?\n// Not using update ranges\ne.bufferSubData(i,0,n):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,a.offset*n.BYTES_PER_ELEMENT,n.subarray(a.offset,a.offset+a.count)),a.count=-1)}(n.buffer,r,i),n.version=r.version)}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */function Face3(e,t,r,i,n,a){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author bhouston / http://clara.io\n */\nfunction Euler(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||Euler.DefaultOrder}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Layers(){this.mask=1}At.physical={uniforms:Et.merge([At.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag},Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=_t.clamp,n=e.elements,a=n[0],o=n[4],s=n[8],c=n[1],l=n[5],h=n[9],u=n[2],p=n[6],d=n[10];\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\nreturn"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(p,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-u,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,a))):"ZYX"===t?(this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(p,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-h,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Matrix4;return function setFromQuaternion(t,r,i){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){\n// WARNING: this discards revolution information -bhouston\nvar e=new Quaternion;return function reorder(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author elephantatwork / www.elephantatwork.ch\n */\nvar Ct=0;function Object3D(){Object.defineProperty(this,"id",{value:Ct++}),this.uuid=_t.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,r=new Quaternion,i=new Vector3(1,1,1);t.onChange(function onRotationChange(){r.setFromEuler(t,!1)}),r.onChange(function onQuaternionChange(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){\n// assumes axis is normalized\nthis.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){\n// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\nthis.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){\n// assumes q is normalized\nthis.quaternion.copy(e)},rotateOnAxis:function(){\n// rotate object on axis in object space\n// axis is assumed to be normalized\nvar e=new Quaternion;return function rotateOnAxis(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){\n// rotate object on axis in world space\n// axis is assumed to be normalized\n// method assumes no rotated parent\nvar e=new Quaternion;return function rotateOnWorldAxis(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Vector3(1,0,0);return function rotateX(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Vector3(0,1,0);return function rotateY(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Vector3(0,0,1);return function rotateZ(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){\n// translate object by distance along axis in object space\n// axis is assumed to be normalized\nvar e=new Vector3;return function translateOnAxis(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new Vector3(1,0,0);return function translateX(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Vector3(0,1,0);return function translateY(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Vector3(0,0,1);return function translateZ(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Matrix4;return function worldToLocal(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){\n// This method does not support objects having non-uniformly-scaled parent(s)\nvar e=new Quaternion,t=new Matrix4,r=new Vector3,i=new Vector3;return function lookAt(n,a,o){n.isVector3?r.copy(n):r.set(n,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(i,r,this.up):t.lookAt(r,i,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can\'t be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new Vector3,t=new Vector3;return function getWorldQuaternion(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),r=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldScale:function(){var e=new Vector3,t=new Quaternion;return function getWorldScale(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(\n// update children\nvar t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;\n// update children\nif(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,n=0,a=i.length;n<a;n++)i[n].updateWorldMatrix(!1,!0)},toJSON:function(e){\n// meta is a string when called from JSON.stringify\nvar t=void 0===e||"string"==typeof e,r={};\n// meta is a hash used to collect geometries, materials.\n// not providing it implies that this is the root object\n// being serialized.\nt&&(\n// initialize meta obj\ne={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});\n// standard Object3D serialization\nvar i={};\n//\nfunction serialize(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){i.geometry=serialize(e.geometries,this.geometry);var n=this.geometry.parameters;if(void 0!==n&&void 0!==n.shapes){var a=n.shapes;if(Array.isArray(a))for(var o=0,s=a.length;o<s;o++){var c=a[o];serialize(e.shapes,c)}else serialize(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var l=[];for(o=0,s=this.material.length;o<s;o++)l.push(serialize(e.materials,this.material[o]));i.material=l}else i.material=serialize(e.materials,this.material);\n//\nif(this.children.length>0){i.children=[];for(o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(t){var h=extractFromCache(e.geometries),u=extractFromCache(e.materials),p=extractFromCache(e.textures),d=extractFromCache(e.images);a=extractFromCache(e.shapes);h.length>0&&(r.geometries=h),u.length>0&&(r.materials=u),p.length>0&&(r.textures=p),d.length>0&&(r.images=d),a.length>0&&(r.shapes=a)}return r.object=i,r;\n// extract data from the cache hash\n// remove metadata on each item\n// and return as array\nfunction extractFromCache(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}});\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author kile / http://kile.stravaganza.org/\n * @author alteredq / http://alteredqualia.com/\n * @author mikael emtinger / http://gomo.se/\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * @author bhouston / http://clara.io\n */\nvar Pt=0;// Geometry uses even numbers as Id\nfunction Geometry(){Object.defineProperty(this,"id",{value:Pt+=2}),this.uuid=_t.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,\n// update flags\nthis.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction BufferAttribute(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}\n//\nfunction Int8BufferAttribute(e,t,r){BufferAttribute.call(this,new Int8Array(e),t,r)}function Uint8BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8Array(e),t,r)}function Uint8ClampedBufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8ClampedArray(e),t,r)}function Int16BufferAttribute(e,t,r){BufferAttribute.call(this,new Int16Array(e),t,r)}function Uint16BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint16Array(e),t,r)}function Int32BufferAttribute(e,t,r){BufferAttribute.call(this,new Int32Array(e),t,r)}function Uint32BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint32Array(e),t,r)}function Float32BufferAttribute(e,t,r){BufferAttribute.call(this,new Float32Array(e),t,r)}function Float64BufferAttribute(e,t,r){BufferAttribute.call(this,new Float64Array(e),t,r)}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],\n// this.lineDistances = [];\nthis.boundingBox=null,this.boundingSphere=null,\n// update flags\nthis.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function(e){for(var t=(new Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(e)}for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(var a=0,o=n.vertexNormals.length;a<o;a++)n.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){\n// rotate geometry around world x-axis\nvar e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){\n// rotate geometry around world y-axis\nvar e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){\n// rotate geometry around world z-axis\nvar e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){\n// translate geometry\nvar e=new Matrix4;return function translate(t,r,i){return e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){\n// scale geometry\nvar e=new Matrix4;return function scale(t,r,i){return e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,i=e.attributes,n=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,o=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,c=void 0!==i.uv2?i.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var l=[],h=[],u=[],p=0,d=0;p<n.length;p+=3,d+=2)t.vertices.push(new Vector3(n[p],n[p+1],n[p+2])),void 0!==a&&l.push(new Vector3(a[p],a[p+1],a[p+2])),void 0!==o&&t.colors.push(new Color(o[p],o[p+1],o[p+2])),void 0!==s&&h.push(new Vector2(s[d],s[d+1])),void 0!==c&&u.push(new Vector2(c[d],c[d+1]));function addFace(e,r,i,n){var p=new Face3(e,r,i,void 0!==a?[l[e].clone(),l[r].clone(),l[i].clone()]:[],void 0!==o?[t.colors[e].clone(),t.colors[r].clone(),t.colors[i].clone()]:[],n);t.faces.push(p),void 0!==s&&t.faceVertexUvs[0].push([h[e].clone(),h[r].clone(),h[i].clone()]),void 0!==c&&t.faceVertexUvs[1].push([u[e].clone(),u[r].clone(),u[i].clone()])}var f=e.groups;if(f.length>0)for(p=0;p<f.length;p++)for(var m=f[p],g=m.start,v=(d=g,g+m.count);d<v;d+=3)void 0!==r?addFace(r[d],r[d+1],r[d+2],m.materialIndex):addFace(d,d+1,d+2,m.materialIndex);else if(void 0!==r)for(p=0;p<r.length;p+=3)addFace(r[p],r[p+1],r[p+2]);else for(p=0;p<n.length/3;p+=3)addFace(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,i=new Matrix4;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],a=this.vertices[n.a],o=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)o[t]=new Vector3;if(e){\n// vertex normals weighted by triangle areas\n// http://www.iquilezles.org/www/articles/normals/normals.htm\nvar s,c,l,h=new Vector3,u=new Vector3;for(i=0,n=this.faces.length;i<n;i++)a=this.faces[i],s=this.vertices[a.a],c=this.vertices[a.b],l=this.vertices[a.c],h.subVectors(l,c),u.subVectors(s,c),h.cross(u),o[a.a].add(h),o[a.b].add(h),o[a.c].add(h)}else for(this.computeFaceNormals(),i=0,n=this.faces.length;i<n;i++)o[(a=this.faces[i]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)o[t].normalize();for(i=0,n=this.faces.length;i<n;i++){var p=(a=this.faces[i]).vertexNormals;3===p.length?(p[0].copy(o[a.a]),p[1].copy(o[a.b]),p[2].copy(o[a.c])):(p[0]=o[a.a].clone(),p[1]=o[a.b].clone(),p[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(r=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,n;\n// save original normals\n// - create temp variables on first access\n//   otherwise just copy (for faster repeated calls)\nfor(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();\n// use temp geometry to compute face and vertex normals for each morph\nvar a=new Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){\n// create on first access\nif(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)c=new Vector3,l={a:new Vector3,b:new Vector3,c:new Vector3},o.push(c),s.push(l)}var c,l,h=this.morphNormals[e];\n// set vertices to morph target\nfor(a.vertices=this.morphTargets[e].vertices,\n// compute morph normals\na.computeFaceNormals(),a.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],c=h.faceNormals[r],l=h.vertexNormals[r],c.copy(n.normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}\n// restore original normals\nfor(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var i,n=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,c=e.faces,l=this.faceVertexUvs[0],h=e.faceVertexUvs[0],u=this.colors,p=e.colors;void 0===r&&(r=0),void 0!==t&&(i=(new Matrix3).getNormalMatrix(t));\n// vertices\nfor(var d=0,f=o.length;d<f;d++){var m=o[d].clone();void 0!==t&&m.applyMatrix4(t),a.push(m)}\n// colors\nfor(d=0,f=p.length;d<f;d++)u.push(p[d].clone());\n// faces\nfor(d=0,f=c.length;d<f;d++){var g,v,y,x=c[d],b=x.vertexNormals,_=x.vertexColors;(g=new Face3(x.a+n,x.b+n,x.c+n)).normal.copy(x.normal),void 0!==i&&g.normal.applyMatrix3(i).normalize();for(var M=0,w=b.length;M<w;M++)v=b[M].clone(),void 0!==i&&v.applyMatrix3(i).normalize(),g.vertexNormals.push(v);g.color.copy(x.color);for(M=0,w=_.length;M<w;M++)y=_[M],g.vertexColors.push(y.clone());g.materialIndex=x.materialIndex+r,s.push(g)}\n// uvs\nfor(d=0,f=h.length;d<f;d++){var T=h[d],E=[];if(void 0!==T){for(M=0,w=T.length;M<w;M++)E.push(T[M].clone());l.push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},\n/*\n\t * Checks for duplicate vertices with hashmap.\n\t * Duplicated vertices are removed\n\t * and faces\' vertices are updated.\n\t */\nmergeVertices:function(){var e,t,r,i,n,a,o,s,c={},l=[],h=[],u=Math.pow(10,4);// Hashmap for looking up vertices by position coordinates (and making sure they are unique)\nfor(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],void 0===c[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(c[t]=r,l.push(this.vertices[r]),h[r]=l.length-1):\n//console.log(\'Duplicate vertex found. \', i, \' could be using \', verticesMap[key]);\nh[r]=h[c[t]];\n// if faces are completely degenerate after merging vertices, we\n// have to remove them from the geometry.\nvar p=[];for(r=0,i=this.faces.length;r<i;r++){(n=this.faces[r]).a=h[n.a],n.b=h[n.b],n.c=h[n.c],a=[n.a,n.b,n.c];\n// if any duplicate vertices are found in a Face3\n// we have to remove the face as nothing can be saved\nfor(var d=0;d<3;d++)if(a[d]===a[(d+1)%3]){p.push(r);break}}for(r=p.length-1;r>=0;r--){var f=p[r];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}\n// Use unique set of vertices\nvar m=this.vertices.length-l.length;return this.vertices=l,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var i=e[t];this.vertices.push(new Vector3(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){\n// tag faces\nfor(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;\n// sort faces\ne.sort(function materialIndexSort(e,t){return e.materialIndex-t.materialIndex});\n// sort uvs\nvar i,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(i=[]),o&&o.length===t&&(n=[]);for(r=0;r<t;r++){var s=e[r]._id;i&&i.push(a[s]),n&&n.push(o[s])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};\n// standard Geometry serialization\nif(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var i=[],n=0;n<this.vertices.length;n++){var a=this.vertices[n];i.push(a.x,a.y,a.z)}var o=[],s=[],c={},l=[],h={},u=[],p={};for(n=0;n<this.faces.length;n++){var d=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=d.normal.length()>0,g=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,x=0;if(x=setBit(x=setBit(x=setBit(x=setBit(x=setBit(x=setBit(// isQuad\nx=setBit(x=setBit(x,0,0),1,!0),2,!1),3,f),4,m),5,g),6,v),7,y),o.push(x),o.push(d.a,d.b,d.c),o.push(d.materialIndex),f){var b=this.faceVertexUvs[0][n];o.push(getUvIndex(b[0]),getUvIndex(b[1]),getUvIndex(b[2]))}if(m&&o.push(getNormalIndex(d.normal)),g){var _=d.vertexNormals;o.push(getNormalIndex(_[0]),getNormalIndex(_[1]),getNormalIndex(_[2]))}if(v&&o.push(getColorIndex(d.color)),y){var M=d.vertexColors;o.push(getColorIndex(M[0]),getColorIndex(M[1]),getColorIndex(M[2]))}}function setBit(e,t,r){return r?e|1<<t:e&~(1<<t)}function getNormalIndex(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]?c[t]:(c[t]=s.length/3,s.push(e.x,e.y,e.z),c[t])}function getColorIndex(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]?h[t]:(h[t]=l.length,l.push(e.getHex()),h[t])}function getUvIndex(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=u.length/2,u.push(e.x,e.y),p[t])}return e.data={},e.data.vertices=i,e.data.normals=s,l.length>0&&(e.data.colors=l),u.length>0&&(e.data.uvs=[u]),// temporal backward compatibility\ne.data.faces=o,e},clone:function(){\n/*\n\t\t // Handle primitives\n\n\t\t var parameters = this.parameters;\n\n\t\t if ( parameters !== undefined ) {\n\n\t\t var values = [];\n\n\t\t for ( var key in parameters ) {\n\n\t\t values.push( parameters[ key ] );\n\n\t\t }\n\n\t\t var geometry = Object.create( this.constructor.prototype );\n\t\t this.constructor.apply( geometry, values );\n\t\t return geometry;\n\n\t\t }\n\n\t\t return new this.constructor().copy( this );\n\t\t */\nreturn(new Geometry).copy(this)},copy:function(e){var t,r,i,n,a,o;\n// reset\nthis.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,\n// name\nthis.name=e.name;\n// vertices\nvar s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());\n// colors\nvar c=e.colors;for(t=0,r=c.length;t<r;t++)this.colors.push(c[t].clone());\n// faces\nvar l=e.faces;for(t=0,r=l.length;t<r;t++)this.faces.push(l[t].clone());\n// face vertex uvs\nfor(t=0,r=e.faceVertexUvs.length;t<r;t++){var h=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,n=h.length;i<n;i++){var u=h[i],p=[];for(a=0,o=u.length;a<o;a++){var d=u[a];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}\n// morph targets\nvar f=e.morphTargets;for(t=0,r=f.length;t<r;t++){var m={};\n// vertices\nif(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],i=0,n=f[t].vertices.length;i<n;i++)m.vertices.push(f[t].vertices[i].clone());\n// normals\nif(void 0!==f[t].normals)for(m.normals=[],i=0,n=f[t].normals.length;i<n;i++)m.normals.push(f[t].normals[i].clone());this.morphTargets.push(m)}\n// morph normals\nvar g=e.morphNormals;for(t=0,r=g.length;t<r;t++){var v={};\n// vertex normals\nif(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],i=0,n=g[t].vertexNormals.length;i<n;i++){var y=g[t].vertexNormals[i],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),v.vertexNormals.push(x)}\n// face normals\nif(void 0!==g[t].faceNormals)for(v.faceNormals=[],i=0,n=g[t].faceNormals.length;i<n;i++)v.faceNormals.push(g[t].faceNormals[i].clone());this.morphNormals.push(v)}\n// skin weights\nvar b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());\n// skin indices\nvar _=e.skinIndices;for(t=0,r=_.length;t<r;t++)this.skinIndices.push(_[t].clone());\n// line distances\nvar M=e.lineDistances;for(t=0,r=M.length;t<r;t++)this.lineDistances.push(M[t]);\n// bounding box\nvar w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());\n// bounding sphere\nvar T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),\n// update flags\nthis.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Color),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Vector2),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new Vector3),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new Vector4),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,r=[],i=void 0,n=e.faces,a=0;a<n.length;a++){var o=n[a];\n// materials\no.materialIndex!==i&&(i=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:i})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,i=e.vertices,n=e.faceVertexUvs,a=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=e.morphTargets,c=s.length;if(c>0){t=[];for(var l=0;l<c;l++)t[l]={name:s[l].name,data:[]};this.morphTargets.position=t}var h,u=e.morphNormals,p=u.length;if(p>0){h=[];for(l=0;l<p;l++)h[l]={name:u[l].name,data:[]};this.morphTargets.normal=h}\n// skins\nvar d=e.skinIndices,f=e.skinWeights,m=d.length===i.length,g=f.length===i.length;\n//\ni.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(l=0;l<r.length;l++){var v=r[l];this.vertices.push(i[v.a],i[v.b],i[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=v.normal;this.normals.push(x,x,x)}var b,_=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var M=v.color;this.colors.push(M,M,M)}if(!0===a)void 0!==(b=n[0][l])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===o)void 0!==(b=n[1][l])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new Vector2,new Vector2,new Vector2));\n// morphs\nfor(var w=0;w<c;w++){var T=s[w].vertices;t[w].data.push(T[v.a],T[v.b],T[v.c])}for(w=0;w<p;w++){var E=u[w].vertexNormals[l];h[w].data.push(E.a,E.b,E.c)}\n// skins\nm&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Rt=1;// BufferGeometry uses odd numbers as Id\nfunction BufferGeometry(){Object.defineProperty(this,"id",{value:Rt+=2}),this.uuid=_t.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n// BoxGeometry\nfunction BoxGeometry(e,t,r,i,n,a){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a},this.fromBufferGeometry(new BoxBufferGeometry(e,t,r,i,n,a)),this.mergeVertices()}\n// BoxBufferGeometry\nfunction BoxBufferGeometry(e,t,r,i,n,a){BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};var o=this;e=e||1,t=t||1,r=r||1,\n// segments\ni=Math.floor(i)||1,n=Math.floor(n)||1;\n// buffers\nvar s=[],c=[],l=[],h=[],u=0,p=0;function buildPlane(e,t,r,i,n,a,d,f,m,g,v){var y,x,b=a/m,_=d/g,M=a/2,w=d/2,T=f/2,E=m+1,S=g+1,L=0,A=0,C=new Vector3;\n// generate vertices, normals and uvs\nfor(x=0;x<S;x++){var P=x*_-w;for(y=0;y<E;y++){var R=y*b-M;\n// set values to correct vector component\nC[e]=R*i,C[t]=P*n,C[r]=T,\n// now apply vector to vertex buffer\nc.push(C.x,C.y,C.z),\n// set values to correct vector component\nC[e]=0,C[t]=0,C[r]=f>0?1:-1,\n// now apply vector to normal buffer\nl.push(C.x,C.y,C.z),\n// uvs\nh.push(y/m),h.push(1-x/g),\n// counters\nL+=1}}\n// indices\n// 1. you need three indices to draw a single face\n// 2. a single segment consists of two faces\n// 3. so we need to generate six (2*3) indices per segment\nfor(x=0;x<g;x++)for(y=0;y<m;y++){var B=u+y+E*x,O=u+y+E*(x+1),I=u+(y+1)+E*(x+1),D=u+(y+1)+E*x;\n// faces\ns.push(B,O,D),s.push(O,I,D),\n// increase counter\nA+=6}\n// add a group to the geometry. this will ensure multi material support\no.addGroup(p,A,v),\n// calculate new start value for groups\np+=A,\n// update total number of vertices\nu+=L}\n// build each side of the box geometry\nbuildPlane("z","y","x",-1,-1,r,t,e,a=Math.floor(a)||1,n,0),// px\nbuildPlane("z","y","x",1,-1,r,t,-e,a,n,1),// nx\nbuildPlane("x","z","y",1,1,e,r,t,i,a,2),// py\nbuildPlane("x","z","y",1,-1,e,r,-t,i,a,3),// ny\nbuildPlane("x","y","z",1,-1,e,t,r,i,n,4),// pz\nbuildPlane("x","y","z",-1,-1,e,t,-r,i,n,5),// nz\n// build geometry\nthis.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("normal",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(h,2))}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n// PlaneGeometry\nfunction PlaneGeometry(e,t,r,i){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,r,i)),this.mergeVertices()}\n// PlaneBufferGeometry\nfunction PlaneBufferGeometry(e,t,r,i){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var n,a,o=(e=e||1)/2,s=(t=t||1)/2,c=Math.floor(r)||1,l=Math.floor(i)||1,h=c+1,u=l+1,p=e/c,d=t/l,f=[],m=[],g=[],v=[];\n// generate vertices, normals and uvs\nfor(a=0;a<u;a++){var y=a*d-s;for(n=0;n<h;n++){var x=n*p-o;m.push(x,-y,0),g.push(0,0,1),v.push(n/c),v.push(1-a/l)}}\n// indices\nfor(a=0;a<l;a++)for(n=0;n<c;n++){var b=n+h*a,_=n+h*(a+1),M=n+1+h*(a+1),w=n+1+h*a;\n// faces\nf.push(b,_,w),f.push(_,M,w)}\n// build geometry\nthis.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(v,2))}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Matrix3).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){\n// rotate geometry around world x-axis\nvar e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){\n// rotate geometry around world y-axis\nvar e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){\n// rotate geometry around world z-axis\nvar e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){\n// translate geometry\nvar e=new Matrix4;return function translate(t,r,i){return e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){\n// scale geometry\nvar e=new Matrix4;return function scale(t,r,i){return e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){\n// console.log( \'THREE.BufferGeometry.setFromObject(). Converting\', object, this );\nvar t=e.geometry;if(e.isPoints||e.isLine){var r=new Float32BufferAttribute(3*t.vertices.length,3),i=new Float32BufferAttribute(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Float32BufferAttribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var i=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(i=void 0,r.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new BufferAttribute(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new BufferAttribute(a,2).copyVector2sArray(e.uvs2))}\n// groups\n// morphs\nfor(var o in this.groups=e.groups,e.morphTargets){for(var s=[],c=e.morphTargets[o],l=0,h=c.length;l<h;l++){var u=c[l],p=new Float32BufferAttribute(3*u.data.length,3);p.name=u.name,s.push(p.copyVector3sArray(u.data))}this.morphAttributes[o]=s}\n// skinning\nif(e.skinIndices.length>0){var d=new Float32BufferAttribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Float32BufferAttribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}\n//\nreturn null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error(\'THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.\',this)},computeBoundingSphere:function(){var e=new Box3,t=new Vector3;return function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var r=this.attributes.position;if(r){var i=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(i);for(\n// hoping to find a boundingSphere with a radius smaller than the\n// boundingSphere of the boundingBox: sqrt(3) smaller in the best case\nvar n=0,a=0,o=r.count;a<o;a++)t.x=r.getX(a),t.y=r.getY(a),t.z=r.getZ(a),n=Math.max(n,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error(\'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.\',this)}}}(),computeFaceNormals:function(){\n// backwards compatibility\n},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(r.length),3));else for(\n// reset existing normals to zero\nvar i=t.normal.array,n=0,a=i.length;n<a;n++)i[n]=0;var o,s,c,l=t.normal.array,h=new Vector3,u=new Vector3,p=new Vector3,d=new Vector3,f=new Vector3;\n// indexed elements\nif(e){var m=e.array;for(n=0,a=e.count;n<a;n+=3)o=3*m[n+0],s=3*m[n+1],c=3*m[n+2],h.fromArray(r,o),u.fromArray(r,s),p.fromArray(r,c),d.subVectors(p,u),f.subVectors(h,u),d.cross(f),l[o]+=d.x,l[o+1]+=d.y,l[o+2]+=d.z,l[s]+=d.x,l[s+1]+=d.y,l[s+2]+=d.z,l[c]+=d.x,l[c+1]+=d.y,l[c+2]+=d.z}else\n// non-indexed elements (unconnected triangle soup)\nfor(n=0,a=r.length;n<a;n+=9)h.fromArray(r,n),u.fromArray(r,n+3),p.fromArray(r,n+6),d.subVectors(p,u),f.subVectors(h,u),d.cross(f),l[n]=d.x,l[n+1]=d.y,l[n+2]=d.z,l[n+3]=d.x,l[n+4]=d.y,l[n+5]=d.z,l[n+6]=d.x,l[n+7]=d.y,l[n+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var n=r[i].array,a=e.attributes[i],o=a.array,s=0,c=a.itemSize*t;s<o.length;s++,c++)n[c]=o[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Vector3;return function normalizeNormals(){for(var t=this.attributes.normal,r=0,i=t.count;r<i;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new BufferGeometry,t=this.index.array,r=this.attributes;for(var i in r){for(var n=r[i],a=n.array,o=n.itemSize,s=new a.constructor(t.length*o),c=0,l=0,h=0,u=t.length;h<u;h++){c=t[h]*o;for(var p=0;p<o;p++)s[l++]=a[c++]}e.addAttribute(i,new BufferAttribute(s,o))}var d=this.groups;for(h=0,u=d.length;h<u;h++){var f=d[h];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};\n// standard BufferGeometry serialization\nif(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){var n=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:n}}var a=this.attributes;for(var r in a){var o=a[r];n=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:n,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var c=this.boundingSphere;return null!==c&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e},clone:function(){\n/*\n\t\t // Handle primitives\n\n\t\t var parameters = this.parameters;\n\n\t\t if ( parameters !== undefined ) {\n\n\t\t var values = [];\n\n\t\t for ( var key in parameters ) {\n\n\t\t values.push( parameters[ key ] );\n\n\t\t }\n\n\t\t var geometry = Object.create( this.constructor.prototype );\n\t\t this.constructor.apply( geometry, values );\n\t\t return geometry;\n\n\t\t }\n\n\t\t return new this.constructor().copy( this );\n\t\t */\nreturn(new BufferGeometry).copy(this)},copy:function(e){var t,r,i;\n// reset\nthis.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,\n// name\nthis.name=e.name;\n// index\nvar n=e.index;null!==n&&this.setIndex(n.clone());\n// attributes\nvar a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}\n// morph attributes\nvar s=e.morphAttributes;for(t in s){var c=[],l=s[t];// morphAttribute: array of Float32BufferAttributes\nfor(r=0,i=l.length;r<i;r++)c.push(l[r].clone());this.morphAttributes[t]=c}\n// groups\nvar h=e.groups;for(r=0,i=h.length;r<i;r++){var u=h[r];this.addGroup(u.start,u.count,u.materialIndex)}\n// bounding box\nvar p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());\n// bounding sphere\nvar d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),\n// draw range\nthis.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,\n// user data\nthis.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),BoxGeometry.prototype=Object.create(Geometry.prototype),BoxGeometry.prototype.constructor=BoxGeometry,BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype),BoxBufferGeometry.prototype.constructor=BoxBufferGeometry,PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\nvar Bt=0;function Material(){Object.defineProperty(this,"id",{value:Bt++}),this.uuid=_t.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=g,this.side=l,this.flatShading=!1,this.vertexColors=p,// THREE.NoColors, THREE.VertexColors, THREE.FaceColors\nthis.opacity=1,this.transparent=!1,this.blendSrc=R,this.blendDst=B,this.blendEquation=M,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=z,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,// override the renderer\'s default precision for this material\nthis.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,// Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\nthis.visible=!0,this.userData={},this.needsUpdate=!0}\n/**\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  defines: { "label" : "value" },\n *  uniforms: { "parameter1": { value: 1.0 }, "parameter2": { value2: 2 } },\n *\n *  fragmentShader: <string>,\n *  vertexShader: <string>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  lights: <bool>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\nfunction ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}",this.fragmentShader="void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,// set to use scene fog\nthis.lights=!1,// set to use scene lights\nthis.clipping=!1,// set to use user-defined clipping planes\nthis.skinning=!1,// set to use skinning attribute streams\nthis.morphTargets=!1,// set to use morph targets\nthis.morphNormals=!1,// set to use morph normals\nthis.extensions={derivatives:!1,// set to use derivatives\nfragDepth:!1,// set to use fragment depth values\ndrawBuffers:!1,// set to use draw buffers\nshaderTextureLOD:!1},\n// When rendered geometry doesn\'t include these attributes but the material does,\n// use these default values in WebGL. This avoids errors when buffer data is missing.\nthis.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}\n/**\n * @author bhouston / http://clara.io\n */\nfunction Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3}\n/**\n * @author bhouston / http://clara.io\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Triangle(e,t,r){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==r?r:new Vector3}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *  map: new THREE.Texture( <Image> ),\n *\n *  lightMap: new THREE.Texture( <Image> ),\n *  lightMapIntensity: <float>\n *\n *  aoMap: new THREE.Texture( <Image> ),\n *  aoMapIntensity: <float>\n *\n *  specularMap: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\n *  combine: THREE.Multiply,\n *  reflectivity: <float>,\n *  refractionRatio: <float>,\n *\n *  depthTest: <bool>,\n *  depthWrite: <bool>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>\n * }\n */\nfunction MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),// emissive\nthis.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author mikael emtinger / http://gomo.se/\n * @author jonobr1 / http://jonobr1.com/\n */\nfunction Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=st,this.updateMorphTargets()}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction CubeTexture(e,t,r,i,n,a,o,s,c,l){e=void 0!==e?e:[],t=void 0!==t?t:ee,Texture.call(this,e,t,r,i,n,a,o,s,c,l),this.flipY=!1}\n/**\n * @author Artur Trzesiok\n */\nfunction DataTexture3D(e,t,r,i){\n// We\'re going to add .setXXX() methods for setting properties later.\n// Users can still set in DataTexture3D directly.\n//\n//\tvar texture = new THREE.DataTexture3D( data, width, height, depth );\n// \ttexture.anisotropy = 16;\n//\n// See #14839\nTexture.call(this,null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=he,this.minFilter=he,this.generateMipmaps=!1,this.flipY=!1}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)\n// for backward compatability if shading is set in the constructor\nif("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):\n// ensure overdraw is backwards-compatible with legacy boolean type\nthis[t]="overdraw"===t?Number(r):r:console.warn("THREE."+this.type+": \'"+t+"\' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: \'"+t+"\' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};\n// standard Material serialization\n// TODO: Copied from Object3D.toJSON\nfunction extractFromCache(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,// Scale behind envMap\nvoid 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==g&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==l&&(r.side=this.side),this.vertexColors!==p&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,\n// rotation (SpriteMaterial)\n0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=extractFromCache(e.textures),n=extractFromCache(e.images);i.length>0&&(r.textures=i),n.length>0&&(r.images=n)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var i=t.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Et.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var i=this.uniforms[r].value;i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}return Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Vector3;return function recast(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Vector3;return function distanceSqToPoint(t){var r=e.subVectors(t,this.origin).dot(this.direction);\n// point behind the ray\nreturn r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function distanceSqToSegment(i,n,a,o){\n// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteDistRaySegment.h\n// It returns the min distance between the ray and the segment\n// defined by v0 and v1\n// It can also set two optional targets :\n// - The closest point on the ray\n// - The closest point on the segment\ne.copy(i).add(n).multiplyScalar(.5),t.copy(n).sub(i).normalize(),r.copy(this.origin).sub(e);var s,c,l,h,u=.5*i.distanceTo(n),p=-this.direction.dot(t),d=r.dot(this.direction),f=-r.dot(t),m=r.lengthSq(),g=Math.abs(1-p*p);if(g>0)if(\n// The ray and segment are not parallel.\nc=p*d-f,h=u*g,(s=p*f-d)>=0)if(c>=-h)if(c<=h){\n// region 0\n// Minimum at interior points of ray and segment.\nvar v=1/g;l=(s*=v)*(s+p*(c*=v)+2*d)+c*(p*s+c+2*f)+m}else\n// region 1\nc=u,l=-(s=Math.max(0,-(p*c+d)))*s+c*(c+2*f)+m;else\n// region 5\nc=-u,l=-(s=Math.max(0,-(p*c+d)))*s+c*(c+2*f)+m;else c<=-h?l=-(\n// region 4\ns=Math.max(0,-(-p*u+d)))*s+(c=s>0?-u:Math.min(Math.max(-u,-f),u))*(c+2*f)+m:c<=h?(\n// region 3\ns=0,l=(c=Math.min(Math.max(-u,-f),u))*(c+2*f)+m):l=-(\n// region 2\ns=Math.max(0,-(p*u+d)))*s+(c=s>0?u:Math.min(Math.max(-u,-f),u))*(c+2*f)+m;else\n// Ray and segment are parallel.\nc=p>0?-u:u,l=-(s=Math.max(0,-(p*c+d)))*s+c*(c+2*f)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(c).add(e),l}}(),intersectSphere:function(){var e=new Vector3;return function intersectSphere(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),n=e.dot(e)-i*i,a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=i-o,c=i+o;\n// t0 = first intersect point - entrance on front of sphere\n// test to see if both t0 and t1 are behind the ray - if so, return null\nreturn s<0&&c<0?null:\n// test to see if t0 is behind the ray:\n// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\n// in order to always return an intersect point that is in front of the ray.\ns<0?this.at(c,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)\n// line is coplanar, return origin\nreturn 0===e.distanceToPoint(this.origin)?0:null;\n// Null is preferable to undefined since undefined means.... it is undefined\nvar r=-(this.origin.dot(e.normal)+e.constant)/t;\n// Return if the ray never intersects the plane\nreturn r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){\n// check if the ray lies on the plane first\nvar t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,i,n,a,o,s,c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(r=(e.min.x-u.x)*c,i=(e.max.x-u.x)*c):(r=(e.max.x-u.x)*c,i=(e.min.x-u.x)*c),l>=0?(n=(e.min.y-u.y)*l,a=(e.max.y-u.y)*l):(n=(e.max.y-u.y)*l,a=(e.min.y-u.y)*l),r>a||n>i?null:(\n// These lines also handle the case where tmin or tmax is NaN\n// (result of 0 * Infinity). x !== x returns true if x is NaN\n(n>r||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),h>=0?(o=(e.min.z-u.z)*h,s=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,s=(e.min.z-u.z)*h),r>s||o>i?null:((o>r||r!=r)&&(r=o),(s<i||i!=i)&&(i=s),\n//return point closest to the ray (positive side)\ni<0?null:this.at(r>=0?r:i,t)))},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){\n// Compute the offset origin, edges, and normal.\nvar e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector3;return function intersectTriangle(n,a,o,s,c){\n// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h\nt.subVectors(a,n),r.subVectors(o,n),i.crossVectors(t,r);\n// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\n// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\n//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\n//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\n//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\nvar l,h=this.direction.dot(i);if(h>0){if(s)return null;l=1}else{if(!(h<0))return null;l=-1,h=-h}e.subVectors(this.origin,n);var u=l*this.direction.dot(r.crossVectors(e,r));\n// b1 < 0, no intersection\nif(u<0)return null;var p=l*this.direction.dot(t.cross(e));\n// b2 < 0, no intersection\nif(p<0)return null;\n// b1+b2 > 1, no intersection\nif(u+p>h)return null;\n// Line intersects triangle, check if ray does.\nvar d=-l*e.dot(i);\n// t < 0, no intersection\nreturn d<0?null:this.at(d/h,c);\n// Ray intersects triangle.\n}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Triangle,{getNormal:function(){var e=new Vector3;return function getNormal(t,r,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3),n.subVectors(i,r),e.subVectors(t,r),n.cross(e);var a=n.lengthSq();return a>0?n.multiplyScalar(1/Math.sqrt(a)):n.set(0,0,0)}}(),\n// static/instance method to calculate barycentric coordinates\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\ngetBarycoord:function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function getBarycoord(i,n,a,o,s){e.subVectors(o,n),t.subVectors(a,n),r.subVectors(i,n);var c=e.dot(e),l=e.dot(t),h=e.dot(r),u=t.dot(t),p=t.dot(r),d=c*u-l*l;\n// collinear or singular triangle\nif(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),0===d)\n// arbitrary location outside of triangle?\n// not sure if this is the best idea, maybe should be returning undefined\nreturn s.set(-2,-1,-1);var f=1/d,m=(u*h-l*p)*f,g=(c*p-l*h)*f;\n// barycentric coordinates must always sum to 1\nreturn s.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new Vector3;return function containsPoint(t,r,i,n){return Triangle.getBarycoord(t,r,i,n,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:function(){var e=new Vector3;return function getUV(t,r,i,n,a,o,s,c){return this.getBarycoord(t,r,i,n,e),c.set(0,0),c.addScaledVector(a,e.x),c.addScaledVector(o,e.y),c.addScaledVector(s,e.z),c}}()}),Object.assign(Triangle.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Vector3,t=new Vector3;return function getArea(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Vector3),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,r,i,n){return Triangle.getUV(e,this.a,this.b,this.c,t,r,i,n)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector3,n=new Vector3,a=new Vector3;return function closestPointToPoint(o,s){void 0===s&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),s=new Vector3);var c,l,h=this.a,u=this.b,p=this.c;\n// algorithm thanks to Real-Time Collision Detection by Christer Ericson,\n// published by Morgan Kaufmann Publishers, (c) 2005 Elsevier Inc.,\n// under the accompanying license; see chapter 5.1.5 for detailed explanation.\n// basically, we\'re distinguishing which of the voronoi regions of the triangle\n// the point lies in with the minimum amount of redundant computation.\ne.subVectors(u,h),t.subVectors(p,h),i.subVectors(o,h);var d=e.dot(i),f=t.dot(i);if(d<=0&&f<=0)\n// vertex region of A; barycentric coords (1, 0, 0)\nreturn s.copy(h);n.subVectors(o,u);var m=e.dot(n),g=t.dot(n);if(m>=0&&g<=m)\n// vertex region of B; barycentric coords (0, 1, 0)\nreturn s.copy(u);var v=d*g-m*f;if(v<=0&&d>=0&&m<=0)\n// edge region of AB; barycentric coords (1-v, v, 0)\nreturn c=d/(d-m),s.copy(h).addScaledVector(e,c);a.subVectors(o,p);var y=e.dot(a),x=t.dot(a);if(x>=0&&y<=x)\n// vertex region of C; barycentric coords (0, 0, 1)\nreturn s.copy(p);var b=y*f-d*x;if(b<=0&&f>=0&&x<=0)\n// edge region of AC; barycentric coords (1-w, 0, w)\nreturn l=f/(f-x),s.copy(h).addScaledVector(t,l);var _=m*x-y*g;if(_<=0&&g-m>=0&&y-x>=0)\n// edge region of BC; barycentric coords (0, 1-w, w)\nreturn r.subVectors(p,u),l=(g-m)/(g-m+(y-x)),s.copy(u).addScaledVector(r,l);// edge region of BC\n// face region\nvar M=1/(_+b+v);\n// u = va * denom\nreturn c=b*M,l=v*M,s.copy(h).addScaledVector(e,c).addScaledVector(t,l)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var n=i.morphAttributes,a=Object.keys(n);if(a.length>0){var o=n[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=i.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)r=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},raycast:function(){var e=new Matrix4,t=new Ray,r=new Sphere,i=new Vector3,n=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,c=new Vector3,l=new Vector2,p=new Vector2,d=new Vector2,f=new Vector3,m=new Vector3;function checkIntersection(e,t,r,i,n,a,o,s){if(null===(t.side===h?i.intersectTriangle(o,a,n,!0,s):i.intersectTriangle(n,a,o,t.side!==u,s)))return null;m.copy(s),m.applyMatrix4(e.matrixWorld);var c=r.ray.origin.distanceTo(m);return c<r.near||c>r.far?null:{distance:c,point:m.clone(),object:e}}function checkBufferGeometryIntersection(e,t,r,o,s,c,h,u,m){i.fromBufferAttribute(s,h),n.fromBufferAttribute(s,u),a.fromBufferAttribute(s,m);var g=checkIntersection(e,t,r,o,i,n,a,f);if(g){c&&(l.fromBufferAttribute(c,h),p.fromBufferAttribute(c,u),d.fromBufferAttribute(c,m),g.uv=Triangle.getUV(f,i,n,a,l,p,d,new Vector2));var v=new Face3(h,u,m);Triangle.getNormal(i,n,a,v.normal),g.face=v}return g}return function raycast(h,u){var m,g=this.geometry,v=this.material,y=this.matrixWorld;if(void 0!==v&&(\n// Checking boundingSphere distance to ray\nnull===g.boundingSphere&&g.computeBoundingSphere(),r.copy(g.boundingSphere),r.applyMatrix4(y),!1!==h.ray.intersectsSphere(r)&&(\n//\ne.getInverse(y),t.copy(h.ray).applyMatrix4(e),null===g.boundingBox||!1!==t.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var x,b,_,M,w,T,E,S,L,A=g.index,C=g.attributes.position,P=g.attributes.uv,R=g.groups,B=g.drawRange;if(null!==A)\n// indexed buffer geometry\nif(Array.isArray(v))for(M=0,T=R.length;M<T;M++)for(L=v[(S=R[M]).materialIndex],w=Math.max(S.start,B.start),E=Math.min(S.start+S.count,B.start+B.count);w<E;w+=3)x=A.getX(w),b=A.getX(w+1),_=A.getX(w+2),(m=checkBufferGeometryIntersection(this,L,h,t,C,P,x,b,_))&&(m.faceIndex=Math.floor(w/3),// triangle number in indexed buffer semantics\nu.push(m));else for(M=Math.max(0,B.start),T=Math.min(A.count,B.start+B.count);M<T;M+=3)x=A.getX(M),b=A.getX(M+1),_=A.getX(M+2),(m=checkBufferGeometryIntersection(this,v,h,t,C,P,x,b,_))&&(m.faceIndex=Math.floor(M/3),// triangle number in indexed buffer semantics\nu.push(m));else if(void 0!==C)\n// non-indexed buffer geometry\nif(Array.isArray(v))for(M=0,T=R.length;M<T;M++)for(L=v[(S=R[M]).materialIndex],w=Math.max(S.start,B.start),E=Math.min(S.start+S.count,B.start+B.count);w<E;w+=3)(m=checkBufferGeometryIntersection(this,L,h,t,C,P,x=w,b=w+1,_=w+2))&&(m.faceIndex=Math.floor(w/3),// triangle number in non-indexed buffer semantics\nu.push(m));else for(M=Math.max(0,B.start),T=Math.min(C.count,B.start+B.count);M<T;M+=3)(m=checkBufferGeometryIntersection(this,v,h,t,C,P,x=M,b=M+1,_=M+2))&&(m.faceIndex=Math.floor(M/3),// triangle number in non-indexed buffer semantics\nu.push(m))}else if(g.isGeometry){var O,I,D,G,V=Array.isArray(v),N=g.vertices,U=g.faces,F=g.faceVertexUvs[0];F.length>0&&(G=F);for(var z=0,H=U.length;z<H;z++){var k=U[z],j=V?v[k.materialIndex]:v;if(void 0!==j){if(O=N[k.a],I=N[k.b],D=N[k.c],!0===j.morphTargets){var W=g.morphTargets,X=this.morphTargetInfluences;i.set(0,0,0),n.set(0,0,0),a.set(0,0,0);for(var q=0,Y=W.length;q<Y;q++){var J=X[q];if(0!==J){var Z=W[q].vertices;i.addScaledVector(o.subVectors(Z[k.a],O),J),n.addScaledVector(s.subVectors(Z[k.b],I),J),a.addScaledVector(c.subVectors(Z[k.c],D),J)}}i.add(O),n.add(I),a.add(D),O=i,I=n,D=a}if(m=checkIntersection(this,j,h,t,O,I,D,f)){if(G&&G[z]){var Q=G[z];l.copy(Q[0]),p.copy(Q[1]),d.copy(Q[2]),m.uv=Triangle.getUV(f,O,I,D,l,p,d,new Vector2)}m.face=k,m.faceIndex=z,u.push(m)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;\n/**\n * @author tschw\n * @author Mugen87 / https://github.com/Mugen87\n * @author mrdoob / http://mrdoob.com/\n *\n * Uniforms of a program.\n * Those form a tree structure with a special top-level container for the root,\n * which you get by calling \'new WebGLUniforms( gl, program, renderer )\'.\n *\n *\n * Properties of inner nodes including the top-level container:\n *\n * .seq - array of nested uniforms\n * .map - nested uniforms by name\n *\n *\n * Methods of all nodes except the top-level container:\n *\n * .setValue( gl, value, [renderer] )\n *\n * \t\tuploads a uniform value(s)\n *  \tthe \'renderer\' parameter is needed for sampler uniforms\n *\n *\n * Static methods of the top-level container (renderer factorizations):\n *\n * .upload( gl, seq, values, renderer )\n *\n * \t\tsets uniforms in \'seq\' to \'values[id].value\'\n *\n * .seqWithValue( seq, values ) : filteredSeq\n *\n * \t\tfilters \'seq\' entries with corresponding entry in values\n *\n *\n * Methods of the top-level container (renderer factorizations):\n *\n * .setValue( gl, name, value )\n *\n * \t\tsets uniform with  name \'name\' to \'value\'\n *\n * .set( gl, obj, prop )\n *\n * \t\tsets uniform from object and property with same name than uniform\n *\n * .setOptional( gl, obj, prop )\n *\n * \t\tlike .set for an optional property of the object\n *\n */\nvar Ot=new Texture,It=new DataTexture3D,Dt=new CubeTexture;\n// --- Base for inner nodes (including the root) ---\nfunction UniformContainer(){this.seq=[],this.map={}}\n// --- Utilities ---\n// Array Caches (provide typed arrays for temporary by size)\nvar Gt=[],Vt=[],Nt=new Float32Array(16),Ut=new Float32Array(9),Ft=new Float32Array(4);\n// Flattening for arrays of vectors and matrices\nfunction flatten(e,t,r){var i=e[0];if(i<=0||i>0)return e;\n// unoptimized: ! isNaN( firstElem )\n// see http://jacksondunstan.com/articles/983\nvar n=t*r,a=Gt[n];if(void 0===a&&(a=new Float32Array(n),Gt[n]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function copyArray(e,t){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]}\n// Texture unit allocation\nfunction allocTexUnits(e,t){var r=Vt[t];void 0===r&&(r=new Int32Array(t),Vt[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocTextureUnit();return r}\n// --- Setters ---\n// Note: Defining these methods externally, because they come in a bunch\n// and this way their names minify.\n// Single scalar\nfunction setValue1f(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValue1i(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}\n// Single float vector (from flat array or THREE.VectorN)\nfunction setValue2fv(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(arraysEqual(r,t))return;e.uniform2fv(this.addr,t),copyArray(r,t)}}function setValue3fv(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(arraysEqual(r,t))return;e.uniform3fv(this.addr,t),copyArray(r,t)}}function setValue4fv(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(arraysEqual(r,t))return;e.uniform4fv(this.addr,t),copyArray(r,t)}}\n// Single matrix (from flat array or MatrixN)\nfunction setValue2fm(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(arraysEqual(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,i))return;Ft.set(i),e.uniformMatrix2fv(this.addr,!1,Ft),copyArray(r,i)}}function setValue3fm(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(arraysEqual(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,i))return;Ut.set(i),e.uniformMatrix3fv(this.addr,!1,Ut),copyArray(r,i)}}function setValue4fm(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(arraysEqual(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,i))return;Nt.set(i),e.uniformMatrix4fv(this.addr,!1,Nt),copyArray(r,i)}}\n// Single texture (2D / Cube)\nfunction setValueT1(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||Ot,n)}function setValueT3D1(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||It,n)}function setValueT6(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||Dt,n)}\n// Integer / Boolean vectors or arrays thereof (always flat arrays)\nfunction setValue2iv(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2iv(this.addr,t),copyArray(r,t))}function setValue3iv(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3iv(this.addr,t),copyArray(r,t))}function setValue4iv(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4iv(this.addr,t),copyArray(r,t))}\n// Helper to pick the right setter for the singular case\n// Array of scalars\nfunction setValue1fv(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform1fv(this.addr,t),copyArray(r,t))}function setValue1iv(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform1iv(this.addr,t),copyArray(r,t))}\n// Array of vectors (flat or from THREE classes)\nfunction setValueV2a(e,t){var r=this.cache,i=flatten(t,this.size,2);arraysEqual(r,i)||(e.uniform2fv(this.addr,i),this.updateCache(i))}function setValueV3a(e,t){var r=this.cache,i=flatten(t,this.size,3);arraysEqual(r,i)||(e.uniform3fv(this.addr,i),this.updateCache(i))}function setValueV4a(e,t){var r=this.cache,i=flatten(t,this.size,4);arraysEqual(r,i)||(e.uniform4fv(this.addr,i),this.updateCache(i))}\n// Array of matrices (flat or from THREE clases)\nfunction setValueM2a(e,t){var r=this.cache,i=flatten(t,this.size,4);arraysEqual(r,i)||(e.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function setValueM3a(e,t){var r=this.cache,i=flatten(t,this.size,9);arraysEqual(r,i)||(e.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function setValueM4a(e,t){var r=this.cache,i=flatten(t,this.size,16);arraysEqual(r,i)||(e.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}\n// Array of textures (2D / Cube)\nfunction setValueT1a(e,t,r){var i=this.cache,n=t.length,a=allocTexUnits(r,n);!1===arraysEqual(i,a)&&(e.uniform1iv(this.addr,a),copyArray(i,a));for(var o=0;o!==n;++o)r.setTexture2D(t[o]||Ot,a[o])}function setValueT6a(e,t,r){var i=this.cache,n=t.length,a=allocTexUnits(r,n);!1===arraysEqual(i,a)&&(e.uniform1iv(this.addr,a),copyArray(i,a));for(var o=0;o!==n;++o)r.setTextureCube(t[o]||Dt,a[o])}\n// Helper to pick the right setter for a pure (bottom-level) array\n// --- Uniform Classes ---\nfunction SingleUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function getSingularSetter(e){switch(e){case 5126:return setValue1f;// FLOAT\ncase 35664:return setValue2fv;// _VEC2\ncase 35665:return setValue3fv;// _VEC3\ncase 35666:return setValue4fv;// _VEC4\ncase 35674:return setValue2fm;// _MAT2\ncase 35675:return setValue3fm;// _MAT3\ncase 35676:return setValue4fm;// _MAT4\ncase 35678:case 36198:return setValueT1;// SAMPLER_2D, SAMPLER_EXTERNAL_OES\ncase 35679:return setValueT3D1;// SAMPLER_3D\ncase 35680:return setValueT6;// SAMPLER_CUBE\ncase 5124:case 35670:return setValue1i;// INT, BOOL\ncase 35667:case 35671:return setValue2iv;// _VEC2\ncase 35668:case 35672:return setValue3iv;// _VEC3\ncase 35669:case 35673:return setValue4iv;// _VEC4\n}}(t.type)}function PureArrayUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function getPureArraySetter(e){switch(e){case 5126:return setValue1fv;// FLOAT\ncase 35664:return setValueV2a;// _VEC2\ncase 35665:return setValueV3a;// _VEC3\ncase 35666:return setValueV4a;// _VEC4\ncase 35674:return setValueM2a;// _MAT2\ncase 35675:return setValueM3a;// _MAT3\ncase 35676:return setValueM4a;// _MAT4\ncase 35678:return setValueT1a;// SAMPLER_2D\ncase 35680:return setValueT6a;// SAMPLER_CUBE\ncase 5124:case 35670:return setValue1iv;// INT, BOOL\ncase 35667:case 35671:return setValue2iv;// _VEC2\ncase 35668:case 35672:return setValue3iv;// _VEC3\ncase 35669:case 35673:return setValue4iv;// _VEC4\n}}(t.type)}function StructuredUniform(e){this.id=e,UniformContainer.call(this)}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(e,t,r){for(var i=this.seq,n=0,a=i.length;n!==a;++n){var o=i[n];o.setValue(e,t[o.id],r)}};\n// --- Top-level ---\n// Parser - builds up the property tree from the path strings\nvar zt=/([\\w\\d_]+)(\\])?(\\[|\\.)?/g;\n// extracts\n// \t- the identifier (member name or array index)\n//  - followed by an optional right bracket (found when array index)\n//  - followed by an optional left bracket or dot (type of subscript)\n//\n// Note: These portions can be read in a non-overlapping fashion and\n// allow straightforward parsing of the hierarchy that WebGL encodes\n// in the uniform names.\nfunction addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,r){var i=e.name,n=i.length;\n// reset RegExp object, because of the early exit of a previous run\nfor(zt.lastIndex=0;;){var a=zt.exec(i),o=zt.lastIndex,s=a[1],c="]"===a[2],l=a[3];// convert to integer\nif(c&&(s|=0),void 0===l||"["===l&&o+2===n){\n// bare name or "pure" bottom-level array "[0]" suffix\naddUniform(r,void 0===l?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}\n// step into inner node / create it in case it doesn\'t exist\nvar h=r.map[s];void 0===h&&addUniform(r,h=new StructuredUniform(s)),r=h}}\n// Root Container\nfunction WebGLUniforms(e,t,r){UniformContainer.call(this),this.renderer=r;for(var i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<i;++n){var a=e.getActiveUniform(t,n);parseUniform(a,e.getUniformLocation(t,a.name),this)}}function WebGLShader(e,t,r){var i=e.createShader(t);\n// --enable-privileged-webgl-extension\n// console.log( type, gl.getExtension( \'WEBGL_debug_shaders\' ).getTranslatedShaderSource( shader ) );\nreturn e.shaderSource(i,r),e.compileShader(i),!1===e.getShaderParameter(i,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn\'t compile."),""!==e.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(i),\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction addLineNumbers(e){for(var t=e.split("\\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\\n")}(r)),i}\n/**\n * @author mrdoob / http://mrdoob.com/\n */WebGLUniforms.prototype.setValue=function(e,t,r){var i=this.map[t];void 0!==i&&i.setValue(e,r,this.renderer)},WebGLUniforms.prototype.setOptional=function(e,t,r){var i=t[r];void 0!==i&&this.setValue(e,r,i)},\n// Static interface\nWebGLUniforms.upload=function(e,t,r,i){for(var n=0,a=t.length;n!==a;++n){var o=t[n],s=r[o.id];!1!==s.needsUpdate&&\n// note: always updating when .needsUpdate is undefined\no.setValue(e,s.value,i)}},WebGLUniforms.seqWithValue=function(e,t){for(var r=[],i=0,n=e.length;i!==n;++i){var a=e[i];a.id in t&&r.push(a)}return r};var Ht=0;function getEncodingComponents(e){switch(e){case ht:return["Linear","( value )"];case ut:return["sRGB","( value )"];case dt:return["RGBE","( value )"];case ft:return["RGBM","( value, 7.0 )"];case mt:return["RGBM","( value, 16.0 )"];case gt:return["RGBD","( value, 256.0 )"];case pt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function getTexelDecodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function parseIncludes(e){return e.replace(/^[ \\t]*#include +<([\\w\\d./]+)>/gm,function replace(e,t){var r=Tt[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return parseIncludes(r)})}function unrollLoops(e){return e.replace(/#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,function replace(e,t,r,i){for(var n="",a=parseInt(t);a<parseInt(r);a++)n+=i.replace(/\\[ i \\]/g,"[ "+a+" ]");return n})}function WebGLProgram(e,t,r,i,n,a,o){var l=e.context,h=i.defines,u=n.vertexShader,p=n.fragmentShader,d="SHADOWMAP_TYPE_BASIC";a.shadowMapType===s?d="SHADOWMAP_TYPE_PCF":a.shadowMapType===c&&(d="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",g="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(i.envMap.mapping){case ee:case te:f="ENVMAP_TYPE_CUBE";break;case ae:case oe:f="ENVMAP_TYPE_CUBE_UV";break;case re:case ie:f="ENVMAP_TYPE_EQUIREC";break;case ne:f="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case te:case ie:m="ENVMAP_MODE_REFRACTION"}switch(i.combine){case X:g="ENVMAP_BLENDING_MULTIPLY";break;case q:g="ENVMAP_BLENDING_MIX";break;case Y:g="ENVMAP_BLENDING_ADD"}}var v,y,x=e.gammaFactor>0?e.gammaFactor:1,b=o.isWebGL2?"":function generateExtensions(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\\n")}(i.extensions,a,t),_=function generateDefines(e){var t=[];for(var r in e){var i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\\n")}(h),M=l.createProgram();\n// console.log( \'building new program \' );\n//\nif(i.isRawShaderMaterial?((v=[_].filter(filterEmptyLine).join("\\n")).length>0&&(v+="\\n"),(y=[b,_].filter(filterEmptyLine).join("\\n")).length>0&&(y+="\\n")):(v=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,_,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+d:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\\tattribute vec3 morphTarget0;","\\tattribute vec3 morphTarget1;","\\tattribute vec3 morphTarget2;","\\tattribute vec3 morphTarget3;","\\t#ifdef USE_MORPHNORMALS","\\t\\tattribute vec3 morphNormal0;","\\t\\tattribute vec3 morphNormal1;","\\t\\tattribute vec3 morphNormal2;","\\t\\tattribute vec3 morphNormal3;","\\t#else","\\t\\tattribute vec3 morphTarget4;","\\t\\tattribute vec3 morphTarget5;","\\t\\tattribute vec3 morphTarget6;","\\t\\tattribute vec3 morphTarget7;","\\t#endif","#endif","#ifdef USE_SKINNING","\\tattribute vec4 skinIndex;","\\tattribute vec4 skinWeight;","#endif","\\n"].filter(filterEmptyLine).join("\\n"),y=[b,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,_,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"",// add \'.0\' if integer\n"#define GAMMA_FACTOR "+x,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.envMap?"#define "+m:"",a.envMap?"#define "+g:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+d:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==J?"#define TONE_MAPPING":"",a.toneMapping!==J?Tt.tonemapping_pars_fragment:"",// this code is required here because it is used by the toneMapping() function defined below\na.toneMapping!==J?function getToneMappingFunction(e,t){var r;switch(t){case Z:r="Linear";break;case Q:r="Reinhard";break;case K:r="Uncharted2";break;case $:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Tt.encodings_pars_fragment:"",// this code is required here because it is used by the various encoding/decoding function defined below\na.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?function getTexelEncodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\\n"].filter(filterEmptyLine).join("\\n")),u=replaceClippingPlaneNums(u=replaceLightNums(u=parseIncludes(u),a),a),p=replaceClippingPlaneNums(p=replaceLightNums(p=parseIncludes(p),a),a),u=unrollLoops(u),p=unrollLoops(p),o.isWebGL2&&!i.isRawShaderMaterial){var w=!1,T=/^\\s*#version\\s+300\\s+es\\s*\\n/;i.isShaderMaterial&&null!==u.match(T)&&null!==p.match(T)&&(w=!0,u=u.replace(T,""),p=p.replace(T,"")),\n// GLSL 3.0 conversion\nv=["#version 300 es\\n","#define attribute in","#define varying out","#define texture2D texture"].join("\\n")+"\\n"+v,y=["#version 300 es\\n","#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\\n")+"\\n"+y}var E=v+u,S=y+p,L=WebGLShader(l,l.VERTEX_SHADER,E),A=WebGLShader(l,l.FRAGMENT_SHADER,S);l.attachShader(M,L),l.attachShader(M,A),\n// Force a particular attribute to index 0.\nvoid 0!==i.index0AttributeName?l.bindAttribLocation(M,0,i.index0AttributeName):!0===a.morphTargets&&\n// programs with morphTargets displace position out of attribute 0\nl.bindAttribLocation(M,0,"position"),l.linkProgram(M);var C,P,R=l.getProgramInfoLog(M).trim(),B=l.getShaderInfoLog(L).trim(),O=l.getShaderInfoLog(A).trim(),I=!0,D=!0;\n// console.log( \'**VERTEX**\', gl.getExtension( \'WEBGL_debug_shaders\' ).getTranslatedShaderSource( glVertexShader ) );\n// console.log( \'**FRAGMENT**\', gl.getExtension( \'WEBGL_debug_shaders\' ).getTranslatedShaderSource( glFragmentShader ) );\nreturn!1===l.getProgramParameter(M,l.LINK_STATUS)?(I=!1,console.error("THREE.WebGLProgram: shader error: ",l.getError(),"gl.VALIDATE_STATUS",l.getProgramParameter(M,l.VALIDATE_STATUS),"gl.getProgramInfoLog",R,B,O)):""!==R?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",R):""!==B&&""!==O||(D=!1),D&&(this.diagnostics={runnable:I,material:i,programLog:R,vertexShader:{log:B,prefix:v},fragmentShader:{log:O,prefix:y}}),\n// clean up\nl.deleteShader(L),l.deleteShader(A),this.getUniforms=function(){return void 0===C&&(C=new WebGLUniforms(l,M,e)),C},this.getAttributes=function(){return void 0===P&&(P=function fetchAttributeLocations(e,t){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var a=e.getActiveAttrib(t,n).name;\n// console.log( \'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:\', name, i );\nr[a]=e.getAttribLocation(t,a)}return r}(l,M)),P},\n// free resource\nthis.destroy=function(){l.deleteProgram(M),this.program=void 0},\n// DEPRECATED\nObject.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),\n//\nthis.name=n.name,this.id=Ht++,this.code=r,this.usedTimes=1,this.program=M,this.vertexShader=L,this.fragmentShader=A,this}\n/**\n * @author mrdoob / http://mrdoob.com/\n */function WebGLPrograms(e,t,r){var i=[],n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function getTextureEncodingFromMap(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don\'t use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=ht,\n// add backwards compatibility for WebGLRenderer.gammaInput/gammaOutput parameter, should probably be removed at some point.\nr===ht&&t&&(r=pt),r}this.getParameters=function(t,i,a,o,s,c,l){var p=n[t.type],d=l.isSkinnedMesh?function allocateBones(e){var t=e.skeleton.bones;if(r.floatVertexTextures)return 1024;\n// default for when object is not specified\n// ( for example when prebuilding shader to be used with multiple objects )\n//\n//  - leave some extra space for other uniforms\n//  - limit here is ANGLE\'s 254 max uniform vectors\n//    (up to 54 should be safe)\nvar i=r.maxVertexUniforms,n=Math.floor((i-20)/4),a=Math.min(n,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(l):0,f=r.precision;\n// heuristics to create shader parameters according to lights in the scene\n// (not to blow over maxLights budget)\nnull!==t.precision&&(f=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead.");var m=e.getRenderTarget();return{shaderID:p,precision:f,supportsVertexTextures:r.vertexTextures,outputEncoding:getTextureEncodingFromMap(m?m.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:getTextureEncodingFromMap(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:getTextureEncodingFromMap(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===ae||t.envMap.mapping===oe),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===bt,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!o,useFog:t.fog,fogExp:o&&o.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numClippingPlanes:s,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===u,flipSided:t.side===h,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,r){var i=[];if(r.shaderID?i.push(r.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)i.push(n),i.push(t.defines[n]);for(var o=0;o<a.length;o++)i.push(r[a[o]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.join()},this.acquireProgram=function(n,a,o,s){\n// Check if code has been already compiled\nfor(var c,l=0,h=i.length;l<h;l++){var u=i[l];if(u.code===s){++(c=u).usedTimes;break}}return void 0===c&&(c=new WebGLProgram(e,t,s,n,a,o,r),i.push(c)),c},this.releaseProgram=function(e){if(0==--e.usedTimes){\n// Remove from unordered set\nvar t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),\n// Free WebGL resources\ne.destroy()}},\n// Exposed for resource monitoring & error feedback via renderer.info:\nthis.programs=i}\n/**\n * @author fordacious / fordacious.github.io\n */\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction painterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderLists(){var e={};return{get:function get(t,r){var i=t.id+","+r.id,n=e[i];return void 0===n&&(\n// console.log( \'THREE.WebGLRenderLists:\', hash );\nn=new function WebGLRenderList(){var e=[],t=0,r=[],i=[];return{opaque:r,transparent:i,init:function init(){t=0,r.length=0,i.length=0},push:function push(n,a,o,s,c){var l=e[t];void 0===l?(l={id:n.id,object:n,geometry:a,material:o,program:o.program,renderOrder:n.renderOrder,z:s,group:c},e[t]=l):(l.id=n.id,l.object=n,l.geometry=a,l.material=o,l.program=o.program,l.renderOrder=n.renderOrder,l.z=s,l.group=c),(!0===o.transparent?i:r).push(l),t++},sort:function sort(){r.length>1&&r.sort(painterSortStable),i.length>1&&i.sort(reversePainterSortStable)}}},e[i]=n),n},dispose:function dispose(){e={}}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */var kt,jt=0;function WebGLLights(){var e=new function UniformsCache(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":r={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":r={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":r={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=r,r}}},t={id:jt++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new Vector3,i=new Matrix4,n=new Matrix4;return{setup:function setup(a,o,s){for(var c=0,l=0,h=0,u=0,p=0,d=0,f=0,m=0,g=s.matrixWorldInverse,v=0,y=a.length;v<y;v++){var x=a[v],b=x.color,_=x.intensity,M=x.distance,w=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)c+=b.r*_,l+=b.g*_,h+=b.b*_;else if(x.isDirectionalLight){if((E=e.get(x)).color.copy(x.color).multiplyScalar(x.intensity),E.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(g),E.shadow=x.castShadow,x.castShadow){var T=x.shadow;E.shadowBias=T.bias,E.shadowRadius=T.radius,E.shadowMapSize=T.mapSize}t.directionalShadowMap[u]=w,t.directionalShadowMatrix[u]=x.shadow.matrix,t.directional[u]=E,u++}else if(x.isSpotLight)(E=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),E.position.applyMatrix4(g),E.color.copy(b).multiplyScalar(_),E.distance=M,E.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(g),E.coneCos=Math.cos(x.angle),E.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),E.decay=x.decay,E.shadow=x.castShadow,x.castShadow&&(T=x.shadow,E.shadowBias=T.bias,E.shadowRadius=T.radius,E.shadowMapSize=T.mapSize),t.spotShadowMap[d]=w,t.spotShadowMatrix[d]=x.shadow.matrix,t.spot[d]=E,d++;else if(x.isRectAreaLight)\n// (a) intensity is the total visible light emitted\n//uniforms.color.copy( color ).multiplyScalar( intensity / ( light.width * light.height * Math.PI ) );\n// (b) intensity is the brightness of the light\n(E=e.get(x)).color.copy(b).multiplyScalar(_),E.position.setFromMatrixPosition(x.matrixWorld),E.position.applyMatrix4(g),\n// extract local rotation of light to derive width/height half vectors\nn.identity(),i.copy(x.matrixWorld),i.premultiply(g),n.extractRotation(i),E.halfWidth.set(.5*x.width,0,0),E.halfHeight.set(0,.5*x.height,0),E.halfWidth.applyMatrix4(n),E.halfHeight.applyMatrix4(n),\n// TODO (abelnation): RectAreaLight distance?\n// uniforms.distance = distance;\nt.rectArea[f]=E,f++;else if(x.isPointLight)(E=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),E.position.applyMatrix4(g),E.color.copy(x.color).multiplyScalar(x.intensity),E.distance=x.distance,E.decay=x.decay,E.shadow=x.castShadow,x.castShadow&&(T=x.shadow,E.shadowBias=T.bias,E.shadowRadius=T.radius,E.shadowMapSize=T.mapSize,E.shadowCameraNear=T.camera.near,E.shadowCameraFar=T.camera.far),t.pointShadowMap[p]=w,t.pointShadowMatrix[p]=x.shadow.matrix,t.point[p]=E,p++;else if(x.isHemisphereLight){var E;(E=e.get(x)).direction.setFromMatrixPosition(x.matrixWorld),E.direction.transformDirection(g),E.direction.normalize(),E.skyColor.copy(x.color).multiplyScalar(_),E.groundColor.copy(x.groundColor).multiplyScalar(_),t.hemi[m]=E,m++}}t.ambient[0]=c,t.ambient[1]=l,t.ambient[2]=h,t.directional.length=u,t.spot.length=d,t.rectArea.length=f,t.point.length=p,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=u,t.hash.pointLength=p,t.hash.spotLength=d,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}\n/**\n * @author Mugen87 / https://github.com/Mugen87\n */function WebGLRenderState(){var e=new WebGLLights,t=[],r=[];return{init:function init(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function setupLights(i){e.setup(t,r,i)},pushLight:function pushLight(e){t.push(e)},pushShadow:function pushShadow(e){r.push(e)}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author bhouston / https://clara.io\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *\n *  opacity: <float>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>\n * }\n */\nfunction MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=vt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}\n/**\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *\n *  referencePosition: <float>,\n *  nearDistance: <float>,\n *  farDistance: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>\n *\n * }\n */\nfunction MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebGLShadowMap(e,t,r){\n// init\nfor(var i=new Frustum,n=new Matrix4,a=new Vector2,o=new Vector2(r,r),c=new Vector3,p=new Vector3,d=1,f=2,m=1+(d|f),g=new Array(m),v=new Array(m),y={},x={0:h,1:l,2:u},b=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],_=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],M=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],w=0;w!==m;++w){var T=0!=(w&d),E=0!=(w&f),S=new MeshDepthMaterial({depthPacking:yt,morphTargets:T,skinning:E});g[w]=S;\n//\nvar L=new MeshDistanceMaterial({morphTargets:T,skinning:E});v[w]=L}\n//\nvar A=this;function getDepthMaterial(t,r,i,n,a,o){var s=t.geometry,c=null,l=g,h=t.customDepthMaterial;if(i&&(l=v,h=t.customDistanceMaterial),h)c=h;else{var u=!1;r.morphTargets&&(s&&s.isBufferGeometry?u=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(u=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var p=t.isSkinnedMesh&&r.skinning,m=0;u&&(m|=d),p&&(m|=f),c=l[m]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){\n// in this case we need a unique material instance reflecting the\n// appropriate state\nvar b=c.uuid,_=r.uuid,M=y[b];void 0===M&&(M={},y[b]=M);var w=M[_];void 0===w&&(w=c.clone(),M[_]=w),c=w}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=null!=r.shadowSide?r.shadowSide:x[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,i&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(n),c.nearDistance=a,c.farDistance=o),c}function renderObject(r,n,a,o){if(!1!==r.visible){if(r.layers.test(n.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||i.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var s=t.update(r),c=r.material;if(Array.isArray(c))for(var l=s.groups,h=0,u=l.length;h<u;h++){var d=l[h],f=c[d.materialIndex];if(f&&f.visible){var m=getDepthMaterial(r,f,o,p,a.near,a.far);e.renderBufferDirect(a,null,s,m,r,d)}}else if(c.visible){m=getDepthMaterial(r,c,o,p,a.near,a.far);e.renderBufferDirect(a,null,s,m,r,null)}}for(var g=r.children,v=0,y=g.length;v<y;v++)renderObject(g[v],n,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=s,this.render=function(t,r,s){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){\n// TODO Clean up (needed in case of contextlost)\nvar l,h=e.context,u=e.state;\n// Set GL state for depth map.\nu.disable(h.BLEND),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(var d=0,f=t.length;d<f;d++){var m=t[d],g=m.shadow,v=m&&m.isPointLight;if(void 0!==g){var y=g.camera;if(a.copy(g.mapSize),a.min(o),v){var x=a.x,w=a.y;\n// These viewports map a cube-map onto a 2D texture with the\n// following orientation:\n//\n//  xzXZ\n//   y Y\n//\n// X - Positive x direction\n// x - Negative x direction\n// Y - Positive y direction\n// y - Negative y direction\n// Z - Positive z direction\n// z - Negative z direction\n// positive X\nM[0].set(2*x,w,x,w),\n// negative X\nM[1].set(0,w,x,w),\n// positive Z\nM[2].set(3*x,w,x,w),\n// negative Z\nM[3].set(x,w,x,w),\n// positive Y\nM[4].set(3*x,0,x,w),\n// negative Y\nM[5].set(x,0,x,w),a.x*=4,a.y*=2}if(null===g.map){var T={minFilter:he,magFilter:he,format:Pe};g.map=new WebGLRenderTarget(a.x,a.y,T),g.map.texture.name=m.name+".shadowMap",y.updateProjectionMatrix()}g.isSpotLightShadow&&g.update(m);var E=g.map,S=g.matrix;p.setFromMatrixPosition(m.matrixWorld),y.position.copy(p),v?(l=6,\n// for point lights we set the shadow matrix to be a translation-only matrix\n// equal to inverse of the light\'s position\nS.makeTranslation(-p.x,-p.y,-p.z)):(l=1,c.setFromMatrixPosition(m.target.matrixWorld),y.lookAt(c),y.updateMatrixWorld(),\n// compute shadow matrix\nS.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(y.projectionMatrix),S.multiply(y.matrixWorldInverse)),e.setRenderTarget(E),e.clear();\n// render shadow map for each cube face (if omni-directional) or\n// run a single pass if not\nfor(var L=0;L<l;L++){if(v){c.copy(y.position),c.add(b[L]),y.up.copy(_[L]),y.lookAt(c),y.updateMatrixWorld();var C=M[L];u.viewport(C)}\n// update camera matrices and frustum\nn.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),i.setFromMatrix(n),\n// set object matrices & frustum culling\nrenderObject(r,s,y,v)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}A.needsUpdate=!1}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebGLTextures(e,t,r,i,n,a,o){var s,c={};\n//\nfunction clampToMaxSize(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");\n// Warning: Scaling through the canvas will only work with images that use\n// premultiplied alpha.\nvar r=t/Math.max(e.width,e.height),i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.width=Math.floor(e.width*r),i.height=Math.floor(e.height*r),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height),i}return e}function isPowerOfTwo(e){return _t.isPowerOfTwo(e.width)&&_t.isPowerOfTwo(e.height)}function textureNeedsGenerateMipmaps(e,t){return e.generateMipmaps&&t&&e.minFilter!==he&&e.minFilter!==de}function generateMipmap(t,r,n,a){e.generateMipmap(t),\n// Note: Math.log( x ) * Math.LOG2E used instead of Math.log2( x ) which is not supported by IE11\ni.get(r).__maxMipLevel=Math.log(Math.max(n,a))*Math.LOG2E}function getInternalFormat(t,r){if(!n.isWebGL2)return t;if(t===e.RED){if(r===e.FLOAT)return e.R32F;if(r===e.HALF_FLOAT)return e.R16F;if(r===e.UNSIGNED_BYTE)return e.R8}if(t===e.RGB){if(r===e.FLOAT)return e.RGB32F;if(r===e.HALF_FLOAT)return e.RGB16F;if(r===e.UNSIGNED_BYTE)return e.RGB8}if(t===e.RGBA){if(r===e.FLOAT)return e.RGBA32F;if(r===e.HALF_FLOAT)return e.RGBA16F;if(r===e.UNSIGNED_BYTE)return e.RGBA8}return t}\n// Fallback filters for non-power-of-2 textures\nfunction filterFallback(t){return t===he||t===ue||t===pe?e.NEAREST:e.LINEAR}\n//\nfunction onTextureDispose(t){var r=t.target;r.removeEventListener("dispose",onTextureDispose),\n//\nfunction deallocateTexture(t){var r=i.get(t);if(t.image&&r.__image__webglTextureCube)\n// cube texture\ne.deleteTexture(r.__image__webglTextureCube);else{\n// 2D texture\nif(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture)}\n// remove all webgl properties\ni.remove(t)}(r),r.isVideoTexture&&delete c[r.id],o.memory.textures--}function onRenderTargetDispose(t){var r=t.target;r.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(t){var r=i.get(t),n=i.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[a]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);i.remove(t.texture),i.remove(t)}\n//\n(r),o.memory.textures--}function setTexture2D(t,n){var a=i.get(t);if(t.isVideoTexture&&function updateVideoTexture(e){var t=e.id,r=o.render.frame;\n// Check the last frame we updated the VideoTexture\nc[t]!==r&&(c[t]=r,e.update())}(t),t.version>0&&a.__version!==t.version){var s=t.image;if(void 0===s)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==s.complete)return void uploadTexture(a,t,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(e.TEXTURE0+n),r.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function setTextureParameters(r,o,s){var c;if(s?(e.texParameteri(r,e.TEXTURE_WRAP_S,a.convert(o.wrapS)),e.texParameteri(r,e.TEXTURE_WRAP_T,a.convert(o.wrapT)),e.texParameteri(r,e.TEXTURE_MAG_FILTER,a.convert(o.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,a.convert(o.minFilter))):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o.wrapS===ce&&o.wrapT===ce||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,e.TEXTURE_MAG_FILTER,filterFallback(o.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,filterFallback(o.minFilter)),o.minFilter!==he&&o.minFilter!==de&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),c=t.get("EXT_texture_filter_anisotropic")){if(o.type===Me&&null===t.get("OES_texture_float_linear"))return;if(o.type===we&&null===(n.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(r,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function uploadTexture(t,i,c){var l;l=i.isDataTexture3D?e.TEXTURE_3D:e.TEXTURE_2D,void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",onTextureDispose),t.__webglTexture=e.createTexture(),o.memory.textures++),r.activeTexture(e.TEXTURE0+c),r.bindTexture(l,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment);var h=clampToMaxSize(i.image,n.maxTextureSize);(function textureNeedsPowerOfTwo(e){return!n.isWebGL2&&(e.wrapS!==ce||e.wrapT!==ce||e.minFilter!==he&&e.minFilter!==de)})(i)&&!1===isPowerOfTwo(h)&&(h=function makePowerOfTwo(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=_t.floorPowerOfTwo(e.width),s.height=_t.floorPowerOfTwo(e.height),s.getContext("2d").drawImage(e,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+s.width+"x"+s.height),s):e}(h));var u=isPowerOfTwo(h),p=a.convert(i.format),d=a.convert(i.type),f=getInternalFormat(p,d);setTextureParameters(l,i,u);var m,g=i.mipmaps;if(i.isDepthTexture){if(\n// populate depth texture with dummy data\nf=e.DEPTH_COMPONENT,i.type===Me){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");f=e.DEPTH_COMPONENT32F}else n.isWebGL2&&(\n// WebGL 2.0 requires signed internalformat for glTexImage2D\nf=e.DEPTH_COMPONENT16);i.format===Oe&&f===e.DEPTH_COMPONENT&&i.type!==xe&&i.type!==_e&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=xe,d=a.convert(i.type)),\n// Depth stencil textures need the DEPTH_STENCIL internal format\n// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\ni.format===Ie&&(f=e.DEPTH_STENCIL,\n// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\n// DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.\n// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\ni.type!==Le&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Le,d=a.convert(i.type))),r.texImage2D(e.TEXTURE_2D,0,f,h.width,h.height,0,p,d,null)}else if(i.isDataTexture)\n// use manually created mipmaps if available\n// if there are no manual mipmaps\n// set 0 level mipmap and then use GL to generate other mipmap levels\nif(g.length>0&&u){for(var v=0,y=g.length;v<y;v++)m=g[v],r.texImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,p,d,m.data);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else r.texImage2D(e.TEXTURE_2D,0,f,h.width,h.height,0,p,d,h.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(v=0,y=g.length;v<y;v++)m=g[v],i.format!==Pe&&i.format!==Ce?r.getCompressedTextureFormats().indexOf(p)>-1?r.compressedTexImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,p,d,m.data);t.__maxMipLevel=g.length-1}else if(i.isDataTexture3D)r.texImage3D(e.TEXTURE_3D,0,f,h.width,h.height,h.depth,0,p,d,h.data),t.__maxMipLevel=0;else\n// regular Texture (image, video, canvas)\n// use manually created mipmaps if available\n// if there are no manual mipmaps\n// set 0 level mipmap and then use GL to generate other mipmap levels\nif(g.length>0&&u){for(v=0,y=g.length;v<y;v++)m=g[v],r.texImage2D(e.TEXTURE_2D,v,f,p,d,m);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else r.texImage2D(e.TEXTURE_2D,0,f,p,d,h),t.__maxMipLevel=0;textureNeedsGenerateMipmaps(i,u)&&generateMipmap(e.TEXTURE_2D,i,h.width,h.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}\n// Render targets\n// Setup storage for target texture and bind it to correct framebuffer\nfunction setupFrameBufferTexture(t,n,o,s){var c=a.convert(n.texture.format),l=a.convert(n.texture.type),h=getInternalFormat(c,l);r.texImage2D(s,0,h,n.width,n.height,0,c,l,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,s,i.get(n.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}\n// Setup storage for internal depth/stencil buffers and bind to correct framebuffer\nfunction setupRenderBufferStorage(t,r){e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):r.depthBuffer&&r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):\n// FIXME: We don\'t support !depth !stencil\ne.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,r.width,r.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}\n// Setup resources for a Depth Texture for a FBO (needs an extension)\n// Setup GL resources for a non-texture depth buffer\nfunction setupDepthRenderbuffer(t){var r=i.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");\n// upload an empty depth texture with framebuffer size\ni.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),setTexture2D(r.depthTexture,0);var n=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Oe)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else{if(r.depthTexture.format!==Ie)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0)}}(r.__webglFramebuffer,t)}else if(n){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=e.createRenderbuffer(),setupRenderBufferStorage(r.__webglDepthbuffer[a],t)}else e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),setupRenderBufferStorage(r.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}\n// Set up GL resources for the render target\nthis.setTexture2D=setTexture2D,this.setTexture3D=function setTexture3D(t,n){var a=i.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,n):(r.activeTexture(e.TEXTURE0+n),r.bindTexture(e.TEXTURE_3D,a.__webglTexture))},this.setTextureCube=function setTextureCube(t,s){var c=i.get(t);if(6===t.image.length)if(t.version>0&&c.__version!==t.version){c.__image__webglTextureCube||(t.addEventListener("dispose",onTextureDispose),c.__image__webglTextureCube=e.createTexture(),o.memory.textures++),r.activeTexture(e.TEXTURE0+s),r.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var l=t&&t.isCompressedTexture,h=t.image[0]&&t.image[0].isDataTexture,u=[],p=0;p<6;p++)u[p]=l||h?h?t.image[p].image:t.image[p]:clampToMaxSize(t.image[p],n.maxCubemapSize);var d=u[0],f=isPowerOfTwo(d),m=a.convert(t.format),g=a.convert(t.type),v=getInternalFormat(m,g);for(setTextureParameters(e.TEXTURE_CUBE_MAP,t,f),p=0;p<6;p++)if(l)for(var y,x=u[p].mipmaps,b=0,_=x.length;b<_;b++)y=x[b],t.format!==Pe&&t.format!==Ce?r.getCompressedTextureFormats().indexOf(m)>-1?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,b,v,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,b,v,y.width,y.height,0,m,g,y.data);else h?r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,v,u[p].width,u[p].height,0,m,g,u[p].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,v,m,g,u[p]);c.__maxMipLevel=l?x.length-1:0,textureNeedsGenerateMipmaps(t,f)&&\n// We assume images for cube map have the same size.\ngenerateMipmap(e.TEXTURE_CUBE_MAP,t,d.width,d.height),c.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(e.TEXTURE0+s),r.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)},this.setTextureCubeDynamic=function setTextureCubeDynamic(t,n){r.activeTexture(e.TEXTURE0+n),r.bindTexture(e.TEXTURE_CUBE_MAP,i.get(t).__webglTexture)},this.setupRenderTarget=function setupRenderTarget(t){var n=i.get(t),a=i.get(t.texture);t.addEventListener("dispose",onRenderTargetDispose),a.__webglTexture=e.createTexture(),o.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,c=isPowerOfTwo(t);\n// Setup framebuffer\nif(s){n.__webglFramebuffer=[];for(var l=0;l<6;l++)n.__webglFramebuffer[l]=e.createFramebuffer()}else n.__webglFramebuffer=e.createFramebuffer();\n// Setup color buffer\nif(s){for(r.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture),setTextureParameters(e.TEXTURE_CUBE_MAP,t.texture,c),l=0;l<6;l++)setupFrameBufferTexture(n.__webglFramebuffer[l],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+l);textureNeedsGenerateMipmaps(t.texture,c)&&generateMipmap(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else r.bindTexture(e.TEXTURE_2D,a.__webglTexture),setTextureParameters(e.TEXTURE_2D,t.texture,c),setupFrameBufferTexture(n.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),textureNeedsGenerateMipmaps(t.texture,c)&&generateMipmap(e.TEXTURE_2D,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_2D,null);\n// Setup depth and stencil buffers\nt.depthBuffer&&setupDepthRenderbuffer(t)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){var n=t.texture;if(textureNeedsGenerateMipmaps(n,isPowerOfTwo(t))){var a=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(n).__webglTexture;r.bindTexture(a,o),generateMipmap(a,n,t.width,t.height),r.bindTexture(a,null)}}}\n/**\n * @author thespite / http://www.twitter.com/thespite\n */\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Group(){Object3D.call(this),this.type="Group"}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author mikael emtinger / http://gomo.se/\n * @author WestLangley / http://github.com/WestLangley\n*/\nfunction Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author greggman / http://games.greggman.com/\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * @author tschw\n */\nfunction PerspectiveCamera(e,t,r,i){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,// width of the film (default in millimeters)\nthis.filmOffset=0,// horizontal film offset (same unit as gauge)\nthis.updateProjectionMatrix()}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebVRManager(e){var t=this,r=null,i=null,n=null,a=[],o=new Matrix4,s=new Matrix4,c="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(i=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",onVRDisplayPresentChange,!1));var l=new Matrix4,h=new Quaternion,u=new Vector3,p=new PerspectiveCamera;p.bounds=new Vector4(0,0,.5,1),p.layers.enable(1);var d=new PerspectiveCamera;d.bounds=new Vector4(.5,0,.5,1),d.layers.enable(2);var f,m,g=new ArrayCamera([p,d]);\n//\nfunction isPresenting(){return null!==r&&!0===r.isPresenting}function onVRDisplayPresentChange(){if(isPresenting()){var i=r.getEyeParameters("left"),n=i.renderWidth,a=i.renderHeight;m=e.getPixelRatio(),f=e.getSize(),e.setDrawingBufferSize(2*n,a,1),y.start()}else t.enabled&&e.setDrawingBufferSize(f.width,f.height,m),y.stop()}\n//\ng.layers.enable(1),g.layers.enable(2);var v=[];function findGamepad(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,i=0,n=t.length;r<n;r++){var a=t[r];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(i===e)return a;i++}}}\n//\nthis.enabled=!1,this.getController=function(e){var t=a[e];return void 0===t&&((t=new Group).matrixAutoUpdate=!1,t.visible=!1,a[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),y.setContext(e)},this.setFrameOfReferenceType=function(e){c=e},this.setPoseTarget=function(e){void 0!==e&&(n=e)},this.getCamera=function(e){var t="stage"===c?1.6:0;if(null===r)return e.position.set(0,t,0),e;\n//\nif(r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(i),"stage"===c){var f=r.stageParameters;f?o.fromArray(f.sittingToStandingTransform):o.makeTranslation(0,t,0)}var m=i.pose,y=null!==n?n:e;if(\n// We want to manipulate poseObject by its position and quaternion components since users may rely on them.\ny.matrix.copy(o),y.matrix.decompose(y.position,y.quaternion,y.scale),null!==m.orientation&&(h.fromArray(m.orientation),y.quaternion.multiply(h)),null!==m.position&&(h.setFromRotationMatrix(o),u.fromArray(m.position),u.applyQuaternion(h),y.position.add(u)),y.updateMatrixWorld(),!1===r.isPresenting)return e;\n//\np.near=e.near,d.near=e.near,p.far=e.far,d.far=e.far,g.matrixWorld.copy(e.matrixWorld),g.matrixWorldInverse.copy(e.matrixWorldInverse),p.matrixWorldInverse.fromArray(i.leftViewMatrix),d.matrixWorldInverse.fromArray(i.rightViewMatrix),\n// TODO (mrdoob) Double check this code\ns.getInverse(o),"stage"===c&&(p.matrixWorldInverse.multiply(s),d.matrixWorldInverse.multiply(s));var x=y.parent;null!==x&&(l.getInverse(x.matrixWorld),p.matrixWorldInverse.multiply(l),d.matrixWorldInverse.multiply(l)),\n// envMap and Mirror needs camera.matrixWorld\np.matrixWorld.getInverse(p.matrixWorldInverse),d.matrixWorld.getInverse(d.matrixWorldInverse),p.projectionMatrix.fromArray(i.leftProjectionMatrix),d.projectionMatrix.fromArray(i.rightProjectionMatrix),\n// HACK (mrdoob)\n// https://github.com/w3c/webvr/issues/203\ng.projectionMatrix.copy(p.projectionMatrix);\n//\nvar b=r.getLayers();if(b.length){var _=b[0];null!==_.leftBounds&&4===_.leftBounds.length&&p.bounds.fromArray(_.leftBounds),null!==_.rightBounds&&4===_.rightBounds.length&&d.bounds.fromArray(_.rightBounds)}return function updateControllers(){for(var e=0;e<a.length;e++){var t=a[e],r=findGamepad(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;\n//  Pose\nvar i=r.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(o),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;\n//  Trigger\nvar n="Daydream Controller"===r.id?0:1;v[e]!==r.buttons[n].pressed&&(v[e]=r.buttons[n].pressed,!0===v[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return o},this.isPresenting=isPresenting;\n// Animation Loop\nvar y=new WebGLAnimation;this.setAnimationLoop=function(e){y.setAnimationLoop(e)},this.submitFrame=function(){isPresenting()&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",onVRDisplayPresentChange)}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n/**\n * @author supereggbert / http://www.paulbrunt.co.uk/\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author szimek / https://github.com/szimek/\n * @author tschw\n */\nfunction WebGLRenderer(e){console.log("THREE.WebGLRenderer",i);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,s=void 0!==e.alpha&&e.alpha,c=void 0===e.depth||e.depth,p=void 0===e.stencil||e.stencil,d=void 0!==e.antialias&&e.antialias,f=void 0===e.premultipliedAlpha||e.premultipliedAlpha,v=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,X=void 0!==e.powerPreference?e.powerPreference:"default",q=null,Y=null;\n// public properties\nthis.domElement=t,this.context=null,\n// clearing\nthis.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,\n// scene graph\nthis.sortObjects=!0,\n// user-defined clipping\nthis.clippingPlanes=[],this.localClippingEnabled=!1,\n// physically based shading\nthis.gammaFactor=2,// for backwards compatibility\nthis.gammaInput=!1,this.gammaOutput=!1,\n// physical lights\nthis.physicallyCorrectLights=!1,\n// tone mapping\nthis.toneMapping=Z,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,\n// morphs\nthis.maxMorphTargets=8,this.maxMorphNormals=4;\n// internal properties\nvar J,Q,K,$,ee,te,re,ie,ne,ae,oe,at,ot,ht,ut,pt,dt,ft,mt=this,gt=!1,\n// internal state cache\nvt=null,yt=null,xt=null,bt=-1,\n// geometry and program caching\nMt={geometry:null,program:null,wireframe:!1},wt=null,Tt=null,St=new Vector4,Ct=new Vector4,Pt=null,\n//\nRt=0,\n//\nBt=t.width,Ot=t.height,It=1,Dt=new Vector4(0,0,Bt,Ot),Gt=new Vector4(0,0,Bt,Ot),Vt=!1,\n// frustum\nNt=new Frustum,\n// clipping\nUt=new\n/**\n * @author tschw\n */\nfunction WebGLClipping(){var e=this,t=null,r=0,i=!1,n=!1,a=new Plane,o=new Matrix3,s={value:null,needsUpdate:!1};function resetGlobalState(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function projectPlanes(t,r,i,n){var c=null!==t?t.length:0,l=null;if(0!==c){if(l=s.value,!0!==n||null===l){var h=i+4*c,u=r.matrixWorldInverse;o.getNormalMatrix(u),(null===l||l.length<h)&&(l=new Float32Array(h));for(var p=0,d=i;p!==c;++p,d+=4)a.copy(t[p]).applyMatrix4(u,o),a.normal.toArray(l,d),l[d+3]=a.constant}s.value=l,s.needsUpdate=!0}return e.numPlanes=c,l}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,a){var o=0!==e.length||n||\n// enable state of previous frame - the clipping code has to\n// run another frame in order to reset the state:\n0!==r||i;return i=n,t=projectPlanes(e,a,0),r=e.length,o},this.beginShadows=function(){n=!0,projectPlanes(null)},this.endShadows=function(){n=!1,resetGlobalState()},this.setState=function(e,a,o,c,l,h){if(!i||null===e||0===e.length||n&&!o)\n// there\'s no local clipping\nn?\n// there\'s no global clipping\nprojectPlanes(null):resetGlobalState();else{var u=n?0:r,p=4*u,d=l.clippingState||null;s.value=d,// ensure unique state\nd=projectPlanes(e,c,p,h);for(var f=0;f!==p;++f)d[f]=t[f];l.clippingState=d,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=u}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */,Ft=!1,zt=!1,\n// camera matrices cache\nHt=new Matrix4,kt=new Vector3;function getTargetPixelRatio(){return null===yt?It:1}\n// initialize\ntry{var jt={alpha:s,depth:c,stencil:p,antialias:d,premultipliedAlpha:f,preserveDrawingBuffer:v,powerPreference:X};\n// event listeners must be registered before WebGL context is created, see #12753\nif(t.addEventListener("webglcontextlost",onContextLost,!1),t.addEventListener("webglcontextrestored",onContextRestore,!1),null===(J=r||t.getContext("webgl",jt)||t.getContext("experimental-webgl",jt)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");\n// Some experimental-webgl implementations do not have getShaderPrecisionFormat\nvoid 0===J.getShaderPrecisionFormat&&(J.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function initGLContext(){Q=new function WebGLExtensions(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */(J),(K=new\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebGLCapabilities(e,t,r){var i;function getMaxPrecision(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var n="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==r.precision?r.precision:"highp",o=getMaxPrecision(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);var s=!0===r.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),l=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),d=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=l>0,v=n||!!t.get("OES_texture_float");return{isWebGL2:n,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==i)return i;var r=t.get("EXT_texture_filter_anisotropic");return i=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:a,logarithmicDepthBuffer:s,maxTextures:c,maxVertexTextures:l,maxTextureSize:h,maxCubemapSize:u,maxAttributes:p,maxVertexUniforms:d,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v}}(J,Q,e)).isWebGL2||(Q.get("WEBGL_depth_texture"),Q.get("OES_texture_float"),Q.get("OES_texture_half_float"),Q.get("OES_texture_half_float_linear"),Q.get("OES_standard_derivatives"),Q.get("OES_element_index_uint"),Q.get("ANGLE_instanced_arrays")),Q.get("OES_texture_float_linear"),ft=new function WebGLUtils(e,t,r){return{convert:function convert(i){var n;if(i===se)return e.REPEAT;if(i===ce)return e.CLAMP_TO_EDGE;if(i===le)return e.MIRRORED_REPEAT;if(i===he)return e.NEAREST;if(i===ue)return e.NEAREST_MIPMAP_NEAREST;if(i===pe)return e.NEAREST_MIPMAP_LINEAR;if(i===de)return e.LINEAR;if(i===fe)return e.LINEAR_MIPMAP_NEAREST;if(i===me)return e.LINEAR_MIPMAP_LINEAR;if(i===ge)return e.UNSIGNED_BYTE;if(i===Te)return e.UNSIGNED_SHORT_4_4_4_4;if(i===Ee)return e.UNSIGNED_SHORT_5_5_5_1;if(i===Se)return e.UNSIGNED_SHORT_5_6_5;if(i===ve)return e.BYTE;if(i===ye)return e.SHORT;if(i===xe)return e.UNSIGNED_SHORT;if(i===be)return e.INT;if(i===_e)return e.UNSIGNED_INT;if(i===Me)return e.FLOAT;if(i===we){if(r.isWebGL2)return e.HALF_FLOAT;if(null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES}if(i===Ae)return e.ALPHA;if(i===Ce)return e.RGB;if(i===Pe)return e.RGBA;if(i===Re)return e.LUMINANCE;if(i===Be)return e.LUMINANCE_ALPHA;if(i===Oe)return e.DEPTH_COMPONENT;if(i===Ie)return e.DEPTH_STENCIL;if(i===De)return e.RED;if(i===M)return e.FUNC_ADD;if(i===w)return e.FUNC_SUBTRACT;if(i===T)return e.FUNC_REVERSE_SUBTRACT;if(i===L)return e.ZERO;if(i===A)return e.ONE;if(i===C)return e.SRC_COLOR;if(i===P)return e.ONE_MINUS_SRC_COLOR;if(i===R)return e.SRC_ALPHA;if(i===B)return e.ONE_MINUS_SRC_ALPHA;if(i===O)return e.DST_ALPHA;if(i===I)return e.ONE_MINUS_DST_ALPHA;if(i===D)return e.DST_COLOR;if(i===G)return e.ONE_MINUS_DST_COLOR;if(i===V)return e.SRC_ALPHA_SATURATE;if((i===Ge||i===Ve||i===Ne||i===Ue)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(i===Ge)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Ve)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Ne)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ue)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((i===Fe||i===ze||i===He||i===ke)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(i===Fe)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===ze)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===He)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===ke)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===je&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((i===We||i===Xe||i===qe||i===Ye||i===Je||i===Ze||i===Qe||i===Ke||i===$e||i===et||i===tt||i===rt||i===it||i===nt)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return i;if(i===E||i===S){if(r.isWebGL2){if(i===E)return e.MIN;if(i===S)return e.MAX}if(null!==(n=t.get("EXT_blend_minmax"))){if(i===E)return n.MIN_EXT;if(i===S)return n.MAX_EXT}}if(i===Le){if(r.isWebGL2)return e.UNSIGNED_INT_24_8;if(null!==(n=t.get("WEBGL_depth_texture")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}(J,Q,K),($=new function WebGLState(e,t,r,i){\n//\nvar s=new function ColorBuffer(){var t=!1,r=new Vector4,i=null,n=new Vector4(0,0,0,0);return{setMask:function(r){i===r||t||(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),r.set(t,i,a,o),!1===n.equals(r)&&(e.clearColor(t,i,a,o),n.copy(r))},reset:function(){t=!1,i=null,n.set(-1,0,0,0)}}},c=new function DepthBuffer(){var t=!1,r=null,i=null,n=null;return{setTest:function(t){t?enable(e.DEPTH_TEST):disable(e.DEPTH_TEST)},setMask:function(i){r===i||t||(e.depthMask(i),r=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case N:e.depthFunc(e.NEVER);break;case U:e.depthFunc(e.ALWAYS);break;case F:e.depthFunc(e.LESS);break;case z:e.depthFunc(e.LEQUAL);break;case H:e.depthFunc(e.EQUAL);break;case k:e.depthFunc(e.GEQUAL);break;case j:e.depthFunc(e.GREATER);break;case W:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);i=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,r=null,i=null,n=null}}},l=new function StencilBuffer(){var t=!1,r=null,i=null,n=null,a=null,o=null,s=null,c=null,l=null;return{setTest:function(t){t?enable(e.STENCIL_TEST):disable(e.STENCIL_TEST)},setMask:function(i){r===i||t||(e.stencilMask(i),r=i)},setFunc:function(t,r,o){i===t&&n===r&&a===o||(e.stencilFunc(t,r,o),i=t,n=r,a=o)},setOp:function(t,r,i){o===t&&s===r&&c===i||(e.stencilOp(t,r,i),o=t,s=r,c=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,r=null,i=null,n=null,a=null,o=null,s=null,c=null,l=null}}},p=e.getParameter(e.MAX_VERTEX_ATTRIBS),d=new Uint8Array(p),f=new Uint8Array(p),v=new Uint8Array(p),w={},T=null,E=null,S=null,L=null,A=null,C=null,P=null,R=null,B=null,O=null,I=!1,D=null,G=null,V=null,X=null,q=null,Y=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),J=!1,Z=0,Q=e.getParameter(e.VERSION);-1!==Q.indexOf("WebGL")?(Z=parseFloat(/^WebGL\\ ([0-9])/.exec(Q)[1]),J=Z>=1):-1!==Q.indexOf("OpenGL ES")&&(Z=parseFloat(/^OpenGL\\ ES\\ ([0-9])/.exec(Q)[1]),J=Z>=2);var K=null,$={},ee=new Vector4,te=new Vector4;function createTexture(t,r,i){var n=new Uint8Array(4),a=e.createTexture();// 4 is required to match default unpack alignment of 4.\ne.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<i;o++)e.texImage2D(r+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n);return a}var re={};function enableAttributeAndDivisor(r,n){d[r]=1,0===f[r]&&(e.enableVertexAttribArray(r),f[r]=1),v[r]!==n&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),v[r]=n)}function enable(t){!0!==w[t]&&(e.enable(t),w[t]=!0)}function disable(t){!1!==w[t]&&(e.disable(t),w[t]=!1)}function setBlending(t,i,n,a,o,s,c,l){if(t!==m){if(S||(enable(e.BLEND),S=!0),t===_)\n// custom blending\no=o||i,s=s||n,c=c||a,i===A&&o===R||(e.blendEquationSeparate(r.convert(i),r.convert(o)),A=i,R=o),n===C&&a===P&&s===B&&c===O||(e.blendFuncSeparate(r.convert(n),r.convert(a),r.convert(s),r.convert(c)),C=n,P=a,B=s,O=c),L=t,I=null;else if(t!==L||l!==I){if(A===M&&R===M||(e.blendEquation(e.FUNC_ADD),A=M,R=M),l)switch(t){case g:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case y:e.blendFunc(e.ONE,e.ONE);break;case x:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case b:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case g:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case y:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case x:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case b:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}C=null,P=null,B=null,O=null,L=t,I=l}}else S&&(disable(e.BLEND),S=!1)}\n//\nfunction setFlipSided(t){D!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),D=t)}function setCullFace(t){t!==n?(enable(e.CULL_FACE),t!==G&&(t===a?e.cullFace(e.BACK):t===o?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):disable(e.CULL_FACE),G=t}function setPolygonOffset(t,r,i){t?(enable(e.POLYGON_OFFSET_FILL),X===r&&q===i||(e.polygonOffset(r,i),X=r,q=i)):disable(e.POLYGON_OFFSET_FILL)}\n// texture\nfunction activeTexture(t){void 0===t&&(t=e.TEXTURE0+Y-1),K!==t&&(e.activeTexture(t),K=t)}return re[e.TEXTURE_2D]=createTexture(e.TEXTURE_2D,e.TEXTURE_2D,1),re[e.TEXTURE_CUBE_MAP]=createTexture(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),\n// init\ns.setClear(0,0,0,1),c.setClear(1),l.setClear(0),enable(e.DEPTH_TEST),c.setFunc(z),setFlipSided(!1),setCullFace(a),enable(e.CULL_FACE),setBlending(m),{buffers:{color:s,depth:c,stencil:l},initAttributes:\n//\nfunction initAttributes(){for(var e=0,t=d.length;e<t;e++)d[e]=0},enableAttribute:function enableAttribute(e){enableAttributeAndDivisor(e,0)},enableAttributeAndDivisor:enableAttributeAndDivisor,disableUnusedAttributes:function disableUnusedAttributes(){for(var t=0,r=f.length;t!==r;++t)f[t]!==d[t]&&(e.disableVertexAttribArray(t),f[t]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function getCompressedTextureFormats(){if(null===T&&(T=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),i=0;i<r.length;i++)T.push(r[i]);return T},useProgram:function useProgram(t){return E!==t&&(e.useProgram(t),E=t,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,r){t.side===u?disable(e.CULL_FACE):enable(e.CULL_FACE);var i=t.side===h;r&&(i=!i),setFlipSided(i),t.blending===g&&!1===t.transparent?setBlending(m):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),c.setFunc(t.depthFunc),c.setTest(t.depthTest),c.setMask(t.depthWrite),s.setMask(t.colorWrite),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(t){t!==V&&(J&&e.lineWidth(t),V=t)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(e.SCISSOR_TEST):disable(e.SCISSOR_TEST)},activeTexture:activeTexture,bindTexture:function bindTexture(t,r){null===K&&activeTexture();var i=$[K];void 0===i&&(i={type:void 0,texture:void 0},$[K]=i),i.type===t&&i.texture===r||(e.bindTexture(t,r||re[t]),i.type=t,i.texture=r)},compressedTexImage2D:function compressedTexImage2D(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function texImage2D(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function texImage3D(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}\n//\n,scissor:function scissor(t){!1===ee.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ee.copy(t))},viewport:function viewport(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))}\n//\n,reset:function reset(){for(var t=0;t<f.length;t++)1===f[t]&&(e.disableVertexAttribArray(t),f[t]=0);w={},T=null,K=null,$={},E=null,L=null,D=null,G=null,s.reset(),c.reset(),l.reset()}}}(J,Q,ft,K)).scissor(Ct.copy(Gt).multiplyScalar(It)),$.viewport(St.copy(Dt).multiplyScalar(It)),ee=new\n/**\n * @author Mugen87 / https://github.com/Mugen87\n */\nfunction WebGLInfo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function reset(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function update(r,i,n){switch(n=n||1,t.calls++,i){case e.TRIANGLES:t.triangles+=n*(r/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=n*(r-2);break;case e.LINES:t.lines+=n*(r/2);break;case e.LINE_STRIP:t.lines+=n*(r-1);break;case e.LINE_LOOP:t.lines+=n*r;break;case e.POINTS:t.points+=n*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}(J),te=new function WebGLProperties(){var e=new WeakMap;return{get:function get(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function remove(t){e.delete(t)},update:function update(t,r,i){e.get(t)[r]=i},dispose:function dispose(){e=new WeakMap}}},re=new WebGLTextures(J,Q,$,te,K,ft,ee),ie=new WebGLAttributes(J),ne=new function WebGLGeometries(e,t,r){var i={},n={};function onGeometryDispose(e){var a=e.target,o=i[a.id];for(var s in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[s]);a.removeEventListener("dispose",onGeometryDispose),delete i[a.id];var c=n[o.id];c&&(t.remove(c),delete n[o.id]),\n//\nr.memory.geometries--}return{get:function get(e,t){var n=i[t.id];return n||(t.addEventListener("dispose",onGeometryDispose),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry).setFromObject(e)),n=t._bufferGeometry),i[t.id]=n,r.memory.geometries++,n)},update:function update(r){var i=r.index,n=r.attributes;for(var a in null!==i&&t.update(i,e.ELEMENT_ARRAY_BUFFER),n)t.update(n[a],e.ARRAY_BUFFER);\n// morph targets\nvar o=r.morphAttributes;for(var a in o)for(var s=o[a],c=0,l=s.length;c<l;c++)t.update(s[c],e.ARRAY_BUFFER)},getWireframeAttribute:function getWireframeAttribute(r){var i=n[r.id];if(i)return i;var a,o=[],s=r.index,c=r.attributes;\n// console.time( \'wireframe\' );\nif(null!==s)for(var l=0,h=(a=s.array).length;l<h;l+=3){var u=a[l+0],p=a[l+1],d=a[l+2];o.push(u,p,p,d,d,u)}else for(l=0,h=(a=c.position.array).length/3-1;l<h;l+=3)u=l+0,p=l+1,d=l+2,o.push(u,p,p,d,d,u);\n// console.timeEnd( \'wireframe\' );\nreturn i=new(arrayMax(o)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(o,1),t.update(i,e.ELEMENT_ARRAY_BUFFER),n[r.id]=i,i}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */(J,ie,ee),ae=new\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebGLObjects(e,t){var r={};return{update:function update(i){var n=t.render.frame,a=i.geometry,o=e.get(i,a);\n// Update once per frame\nreturn r[o.id]!==n&&(a.isGeometry&&o.updateFromObject(i),e.update(o),r[o.id]=n),o},dispose:function dispose(){r={}}}}(ne,ee),ut=new function WebGLMorphtargets(e){var t={},r=new Float32Array(8);return{update:function update(i,n,a,o){var s=i.morphTargetInfluences,c=s.length,l=t[n.id];if(void 0===l){\n// initialise list\nl=[];for(var h=0;h<c;h++)l[h]=[h,0];t[n.id]=l}var u=a.morphTargets&&n.morphAttributes.position,p=a.morphNormals&&n.morphAttributes.normal;\n// Remove current morphAttributes\nfor(h=0;h<c;h++)0!==(d=l[h])[1]&&(u&&n.removeAttribute("morphTarget"+h),p&&n.removeAttribute("morphNormal"+h));\n// Collect influences\nfor(h=0;h<c;h++)(d=l[h])[0]=h,d[1]=s[h];\n// Add morphAttributes\nfor(l.sort(absNumericalSort),h=0;h<8;h++){var d;if(d=l[h]){var f=d[0],m=d[1];if(m){u&&n.addAttribute("morphTarget"+h,u[f]),p&&n.addAttribute("morphNormal"+h,p[f]),r[h]=m;continue}}r[h]=0}o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}(J),oe=new WebGLPrograms(mt,Q,K),at=new WebGLRenderLists,ot=new function WebGLRenderStates(){var e={};return{get:function get(t,r){var i;return void 0===e[t.id]?(i=new WebGLRenderState,e[t.id]={},e[t.id][r.id]=i):void 0===e[t.id][r.id]?(i=new WebGLRenderState,e[t.id][r.id]=i):i=e[t.id][r.id],i},dispose:function dispose(){e={}}}},ht=new\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction WebGLBackground(e,t,r,i){var n,a,o=new Color(0),s=0;function setClear(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,i)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),setClear(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){setClear(o,s=e)},render:function render(t,i,c,u){var p=i.background;null===p?setClear(o,s):p&&p.isColor&&(setClear(p,1),u=!0),(e.autoClear||u)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&p.isCubeTexture?(void 0===a&&((a=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({uniforms:Et.clone(At.cube.uniforms),vertexShader:At.cube.vertexShader,fragmentShader:At.cube.fragmentShader,side:h,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},r.update(a)),a.material.uniforms.tCube.value=p,t.push(a,a.geometry,a.material,0,null)):p&&p.isTexture&&(void 0===n&&((n=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({uniforms:Et.clone(At.background.uniforms),vertexShader:At.background.vertexShader,fragmentShader:At.background.fragmentShader,side:l,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),r.update(n)),n.material.uniforms.t2D.value=p,t.push(n,n.geometry,n.material,0,null))}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */(mt,$,ae,f),pt=new function WebGLBufferRenderer(e,t,r,i){var n;\n//\nthis.setMode=function setMode(e){n=e},this.render=function render(t,i){e.drawArrays(n,t,i),r.update(i,n)},this.renderInstances=function renderInstances(a,o,s){var c;if(i.isWebGL2)c=e;else if(null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,o,s,a.maxInstancedCount),r.update(s,n,a.maxInstancedCount)}}(J,Q,ee,K),dt=new function WebGLIndexedBufferRenderer(e,t,r,i){var n,a,o;\n//\nthis.setMode=function setMode(e){n=e},this.setIndex=function setIndex(e){a=e.type,o=e.bytesPerElement},this.render=function render(t,i){e.drawElements(n,i,a,t*o),r.update(i,n)},this.renderInstances=function renderInstances(s,c,l){var h;if(i.isWebGL2)h=e;else if(null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,l,a,c*o,s.maxInstancedCount),r.update(l,n,s.maxInstancedCount)}}(J,Q,ee,K),ee.programs=oe.programs,mt.context=J,mt.capabilities=K,mt.extensions=Q,mt.properties=te,mt.renderLists=at,mt.state=$,mt.info=ee}initGLContext();\n// vr\nvar Wt=null;"undefined"!=typeof navigator&&(Wt="xr"in navigator?new function WebXRManager(e){var t=e.context,r=null,i=null,n=null,a="stage",o=null,s=[],c=[];function isPresenting(){return null!==i&&null!==n}\n//\nvar l=new PerspectiveCamera;l.layers.enable(1),l.viewport=new Vector4;var h=new PerspectiveCamera;h.layers.enable(2),h.viewport=new Vector4;var u=new ArrayCamera([l,h]);\n//\nfunction onSessionEvent(e){var t=s[c.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function onSessionEnd(){e.setFramebuffer(null),d.stop()}function updateCamera(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}u.layers.enable(1),u.layers.enable(2),\n//\nthis.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new Group).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),e instanceof XRDevice&&t.setCompatibleXRDevice(e)},this.setFrameOfReferenceType=function(e){a=e},this.setSession=function(r){null!==(i=r)&&(i.addEventListener("select",onSessionEvent),i.addEventListener("selectstart",onSessionEvent),i.addEventListener("selectend",onSessionEvent),i.addEventListener("end",onSessionEnd),i.baseLayer=new XRWebGLLayer(i,t),i.requestFrameOfReference(a).then(function(t){n=t,e.setFramebuffer(i.baseLayer.framebuffer),d.setContext(i),d.start()}),\n//\nc=i.getInputSources(),i.addEventListener("inputsourceschange",function(){c=i.getInputSources(),console.log(c)}))},this.getCamera=function(e){if(isPresenting()){var t=e.parent,r=u.cameras;\n// apply camera.parent to cameraVR\nupdateCamera(u,t);for(var i=0;i<r.length;i++)updateCamera(r[i],t);\n// update camera and its children\ne.matrixWorld.copy(u.matrixWorld);for(var n=e.children,a=(i=0,n.length);i<a;i++)n[i].updateMatrixWorld(!0);return u}return e},this.isPresenting=isPresenting;\n// Animation Loop\nvar p=null,d=new WebGLAnimation;d.setAnimationLoop(function onAnimationFrame(e,t){if(null!==(o=t.getDevicePose(n)))for(var r=i.baseLayer,a=t.views,l=0;l<a.length;l++){var h=a[l],d=r.getViewport(h),f=o.getViewMatrix(h),m=u.cameras[l];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(d.x,d.y,d.width,d.height),0===l&&(u.matrix.copy(m.matrix),\n// HACK (mrdoob)\n// https://github.com/w3c/webvr/issues/203\nu.projectionMatrix.copy(m.projectionMatrix))}\n//\nfor(l=0;l<s.length;l++){var g=s[l],v=c[l];if(v){var y=t.getInputPose(v,n);if(null!==y){"targetRay"in y?g.matrix.elements=y.targetRay.transformMatrix:"pointerMatrix"in y&&(\n// DEPRECATED\ng.matrix.elements=y.pointerMatrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.visible=!0;continue}}g.visible=!1}p&&p(e)}),this.setAnimationLoop=function(e){p=e},this.dispose=function(){},\n// DEPRECATED\nthis.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}(mt):new WebVRManager(mt)),this.vr=Wt;\n// shadow map\nvar Xt=new WebGLShadowMap(mt,ae,K.maxTextureSize);\n// Events\nfunction onContextLost(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),gt=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),gt=!1,initGLContext()}function onMaterialDispose(e){var t=e.target;t.removeEventListener("dispose",onMaterialDispose),\n// Buffer deallocation\nfunction deallocateMaterial(e){releaseMaterialProgramReference(e),te.remove(e)}(t)}function releaseMaterialProgramReference(e){var t=te.get(e).program;e.program=void 0,void 0!==t&&oe.releaseProgram(t)}\n// Buffer rendering\nthis.shadowMap=Xt,\n// API\nthis.getContext=function(){return J},this.getContextAttributes=function(){return J.getContextAttributes()},this.forceContextLoss=function(){var e=Q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=Q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return It},this.setPixelRatio=function(e){void 0!==e&&(It=e,this.setSize(Bt,Ot,!1))},this.getSize=function(){return{width:Bt,height:Ot}},this.setSize=function(e,r,i){Wt.isPresenting()?console.warn("THREE.WebGLRenderer: Can\'t change size while VR device is presenting."):(Bt=e,Ot=r,t.width=e*It,t.height=r*It,!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(){return{width:Bt*It,height:Ot*It}},this.setDrawingBufferSize=function(e,r,i){Bt=e,Ot=r,It=i,t.width=e*i,t.height=r*i,this.setViewport(0,0,e,r)},this.getCurrentViewport=function(){return St},this.setViewport=function(e,t,r,i){Dt.set(e,Ot-t-i,r,i),$.viewport(St.copy(Dt).multiplyScalar(It))},this.setScissor=function(e,t,r,i){Gt.set(e,Ot-t-i,r,i),$.scissor(Ct.copy(Gt).multiplyScalar(It))},this.setScissorTest=function(e){$.setScissorTest(Vt=e)},\n// Clearing\nthis.getClearColor=function(){return ht.getClearColor()},this.setClearColor=function(){ht.setClearColor.apply(ht,arguments)},this.getClearAlpha=function(){return ht.getClearAlpha()},this.setClearAlpha=function(){ht.setClearAlpha.apply(ht,arguments)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=J.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=J.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=J.STENCIL_BUFFER_BIT),J.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},\n//\nthis.dispose=function(){t.removeEventListener("webglcontextlost",onContextLost,!1),t.removeEventListener("webglcontextrestored",onContextRestore,!1),at.dispose(),ot.dispose(),te.dispose(),ae.dispose(),Wt.dispose(),Yt.stop()},this.renderBufferImmediate=function(e,t){$.initAttributes();var r=te.get(e);e.hasPositions&&!r.position&&(r.position=J.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=J.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=J.createBuffer()),e.hasColors&&!r.color&&(r.color=J.createBuffer());var i=t.getAttributes();e.hasPositions&&(J.bindBuffer(J.ARRAY_BUFFER,r.position),J.bufferData(J.ARRAY_BUFFER,e.positionArray,J.DYNAMIC_DRAW),$.enableAttribute(i.position),J.vertexAttribPointer(i.position,3,J.FLOAT,!1,0,0)),e.hasNormals&&(J.bindBuffer(J.ARRAY_BUFFER,r.normal),J.bufferData(J.ARRAY_BUFFER,e.normalArray,J.DYNAMIC_DRAW),$.enableAttribute(i.normal),J.vertexAttribPointer(i.normal,3,J.FLOAT,!1,0,0)),e.hasUvs&&(J.bindBuffer(J.ARRAY_BUFFER,r.uv),J.bufferData(J.ARRAY_BUFFER,e.uvArray,J.DYNAMIC_DRAW),$.enableAttribute(i.uv),J.vertexAttribPointer(i.uv,2,J.FLOAT,!1,0,0)),e.hasColors&&(J.bindBuffer(J.ARRAY_BUFFER,r.color),J.bufferData(J.ARRAY_BUFFER,e.colorArray,J.DYNAMIC_DRAW),$.enableAttribute(i.color),J.vertexAttribPointer(i.color,3,J.FLOAT,!1,0,0)),$.disableUnusedAttributes(),J.drawArrays(J.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,a){var o=n.isMesh&&n.normalMatrix.determinant()<0;$.setMaterial(i,o);var s=setProgram(e,t,i,n),c=!1;Mt.geometry===r.id&&Mt.program===s.id&&Mt.wireframe===(!0===i.wireframe)||(Mt.geometry=r.id,Mt.program=s.id,Mt.wireframe=!0===i.wireframe,c=!0),n.morphTargetInfluences&&(ut.update(n,r,i,s),c=!0);\n//\nvar l,h=r.index,u=r.attributes.position,p=1;!0===i.wireframe&&(h=ne.getWireframeAttribute(r),p=2);var d=pt;null!==h&&(l=ie.get(h),(d=dt).setIndex(l)),c&&(!function setupVertexAttributes(e,t,r){if(r&&r.isInstancedBufferGeometry&!K.isWebGL2&&null===Q.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");$.initAttributes();var i=r.attributes,n=t.getAttributes(),a=e.defaultAttributeValues;for(var o in n){var s=n[o];if(s>=0){var c=i[o];if(void 0!==c){var l=c.normalized,h=c.itemSize,u=ie.get(c);\n// TODO Attribute may not be available on context restore\nif(void 0===u)continue;var p=u.buffer,d=u.type,f=u.bytesPerElement;if(c.isInterleavedBufferAttribute){var m=c.data,g=m.stride,v=c.offset;m&&m.isInstancedInterleavedBuffer?($.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):$.enableAttribute(s),J.bindBuffer(J.ARRAY_BUFFER,p),J.vertexAttribPointer(s,h,d,l,g*f,v*f)}else c.isInstancedBufferAttribute?($.enableAttributeAndDivisor(s,c.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=c.meshPerAttribute*c.count)):$.enableAttribute(s),J.bindBuffer(J.ARRAY_BUFFER,p),J.vertexAttribPointer(s,h,d,l,0,0)}else if(void 0!==a){var y=a[o];if(void 0!==y)switch(y.length){case 2:J.vertexAttrib2fv(s,y);break;case 3:J.vertexAttrib3fv(s,y);break;case 4:J.vertexAttrib4fv(s,y);break;default:J.vertexAttrib1fv(s,y)}}}}$.disableUnusedAttributes()}\n// Compile\n(i,s,r),null!==h&&J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,l.buffer));\n//\nvar f=1/0;null!==h?f=h.count:void 0!==u&&(f=u.count);var m=r.drawRange.start*p,g=r.drawRange.count*p,v=null!==a?a.start*p:0,y=null!==a?a.count*p:1/0,x=Math.max(m,v),b=Math.min(f,m+g,v+y)-1,_=Math.max(0,b-x+1);if(0!==_){\n//\nif(n.isMesh)if(!0===i.wireframe)$.setLineWidth(i.wireframeLinewidth*getTargetPixelRatio()),d.setMode(J.LINES);else switch(n.drawMode){case st:d.setMode(J.TRIANGLES);break;case ct:d.setMode(J.TRIANGLE_STRIP);break;case lt:d.setMode(J.TRIANGLE_FAN)}else if(n.isLine){var M=i.linewidth;void 0===M&&(M=1),// Not using Line*Material\n$.setLineWidth(M*getTargetPixelRatio()),n.isLineSegments?d.setMode(J.LINES):n.isLineLoop?d.setMode(J.LINE_LOOP):d.setMode(J.LINE_STRIP)}else n.isPoints?d.setMode(J.POINTS):n.isSprite&&d.setMode(J.TRIANGLES);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&d.renderInstances(r,x,_):d.render(x,_)}},this.compile=function(e,t){(Y=ot.get(e,t)).init(),e.traverse(function(e){e.isLight&&(Y.pushLight(e),e.castShadow&&Y.pushShadow(e))}),Y.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)initMaterial(t.material[r],e.fog,t);else initMaterial(t.material,e.fog,t)})};\n// Animation Loop\nvar qt=null;var Yt=new WebGLAnimation;function renderObjects(e,t,r,i){for(var n=0,a=e.length;n<a;n++){var o=e[n],s=o.object,c=o.geometry,l=void 0===i?o.material:i,h=o.group;if(r.isArrayCamera){Tt=r;for(var u=r.cameras,p=0,d=u.length;p<d;p++){var f=u[p];if(s.layers.test(f.layers)){if("viewport"in f)// XR\n$.viewport(St.copy(f.viewport));else{var m=f.bounds,g=m.x*Bt,v=m.y*Ot,y=m.z*Bt,x=m.w*Ot;$.viewport(St.set(g,v,y,x).multiplyScalar(It))}Y.setupLights(f),renderObject(s,t,f,c,l,h)}}}else Tt=null,renderObject(s,t,r,c,l,h)}}function renderObject(e,t,r,i,n,a){if(e.onBeforeRender(mt,t,r,i,n,a),Y=ot.get(t,Tt||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){$.setMaterial(n);var o=setProgram(r,t.fog,n,e);Mt.geometry=null,Mt.program=null,Mt.wireframe=!1,function renderObjectImmediate(e,t){e.render(function(e){mt.renderBufferImmediate(e,t)})}(e,o)}else mt.renderBufferDirect(r,t.fog,i,n,e,a);e.onAfterRender(mt,t,r,i,n,a),Y=ot.get(t,Tt||r)}function initMaterial(e,t,r){var i=te.get(e),n=Y.state.lights,a=Y.state.shadowsArray,o=i.lightsHash,s=n.state.hash,c=oe.getParameters(e,n.state,a,t,Ut.numPlanes,Ut.numIntersection,r),l=oe.getProgramCode(e,c),h=i.program,u=!0;if(void 0===h)\n// new material\ne.addEventListener("dispose",onMaterialDispose);else if(h.code!==l)\n// changed glsl or parameters\nreleaseMaterialProgramReference(e);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,u=!1;else{if(void 0!==c.shaderID)\n// same glsl and uniform list\nreturn;\n// only rebuild uniform list\nu=!1}if(u){if(c.shaderID){var p=At[c.shaderID];i.shader={name:e.type,uniforms:Et.clone(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,mt),\n// Computing code again as onBeforeCompile may have changed the shaders\nl=oe.getProgramCode(e,c),h=oe.acquireProgram(e,i.shader,c,l),i.program=h,e.program=h}var d=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<mt.maxMorphTargets;f++)d["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<mt.maxMorphNormals;f++)d["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var m=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=Ut.numPlanes,i.numIntersection=Ut.numIntersection,m.clippingPlanes=Ut.uniform),i.fog=t,\n// store the light setup it was created for\nvoid 0===o&&(i.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(\n// wire up the material to this renderer\'s lighting state\nm.ambientLightColor.value=n.state.ambient,m.directionalLights.value=n.state.directional,m.spotLights.value=n.state.spot,m.rectAreaLights.value=n.state.rectArea,m.pointLights.value=n.state.point,m.hemisphereLights.value=n.state.hemi,m.directionalShadowMap.value=n.state.directionalShadowMap,m.directionalShadowMatrix.value=n.state.directionalShadowMatrix,m.spotShadowMap.value=n.state.spotShadowMap,m.spotShadowMatrix.value=n.state.spotShadowMatrix,m.pointShadowMap.value=n.state.pointShadowMap,m.pointShadowMatrix.value=n.state.pointShadowMatrix);var g=i.program.getUniforms(),v=WebGLUniforms.seqWithValue(g.seq,m);i.uniformsList=v}function setProgram(e,t,r,i){Rt=0;var n=te.get(r),a=Y.state.lights,o=n.lightsHash,s=a.state.hash;if(Ft&&(zt||e!==wt)){var c=e===wt&&r.id===bt;\n// we might want to call this function with some ClippingGroup\n// object instead of the material, once it becomes feasible\n// (#8465, #8379)\nUt.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,n,c)}!1===r.needsUpdate&&(void 0===n.program?r.needsUpdate=!0:r.fog&&n.fog!==t?r.needsUpdate=!0:(!r.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===n.numClippingPlanes||n.numClippingPlanes===Ut.numPlanes&&n.numIntersection===Ut.numIntersection)||(r.needsUpdate=!0)),r.needsUpdate&&(initMaterial(r,t,i),r.needsUpdate=!1);var l=!1,u=!1,p=!1,d=n.program,f=d.getUniforms(),m=n.shader.uniforms;if($.useProgram(d.program)&&(l=!0,u=!0,p=!0),r.id!==bt&&(bt=r.id,u=!0),l||wt!==e){\n// load material specific uniforms\n// (shader material also gets them for the sake of genericity)\nif(f.setValue(J,"projectionMatrix",e.projectionMatrix),K.logarithmicDepthBuffer&&f.setValue(J,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),wt!==e&&(wt=e,\n// lighting uniforms depend on the camera so enforce an update\n// now, in case this material supports lights - or later, when\n// the next material that does gets activated:\nu=!0,// set to true on material change\np=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var g=f.map.cameraPosition;void 0!==g&&g.setValue(J,kt.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&f.setValue(J,"viewMatrix",e.matrixWorldInverse)}\n// skinning uniforms must be set even if material didn\'t change\n// auto-setting of texture unit for bone texture must go before other textures\n// not sure why, but otherwise weird things happen\nif(r.skinning){f.setOptional(J,i,"bindMatrix"),f.setOptional(J,i,"bindMatrixInverse");var v=i.skeleton;if(v){var y=v.bones;if(K.floatVertexTextures){if(void 0===v.boneTexture){\n// layout (1 matrix = 4 pixels)\n//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\n//  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)\n//       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)\n//       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)\n//       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)\nvar x=Math.sqrt(4*y.length);// 4 pixels needed for 1 matrix\nx=_t.ceilPowerOfTwo(x),x=Math.max(x,4);var b=new Float32Array(x*x*4);// 4 floats per RGBA pixel\nb.set(v.boneMatrices);// copy current values\nvar _=new DataTexture(b,x,x,Pe,Me);_.needsUpdate=!0,v.boneMatrices=b,v.boneTexture=_,v.boneTextureSize=x}f.setValue(J,"boneTexture",v.boneTexture),f.setValue(J,"boneTextureSize",v.boneTextureSize)}else f.setOptional(J,v,"boneMatrices")}}return u&&(f.setValue(J,"toneMappingExposure",mt.toneMappingExposure),f.setValue(J,"toneMappingWhitePoint",mt.toneMappingWhitePoint),r.lights&&\n// the current material requires lighting info\n// note: all lighting uniforms are always set correctly\n// they simply reference the renderer\'s state for their\n// values\n//\n// use the current material\'s .needsUpdate flags to set\n// the GL state when required\n// If uniforms are marked as clean, they don\'t need to be loaded to the GPU.\nfunction markUniformsLightsNeedsUpdate(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}\n// Textures\n(m,p),\n// refresh uniforms common to several materials\nt&&r.fog&&function refreshUniformsFog(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(m,t),r.isMeshBasicMaterial?refreshUniformsCommon(m,r):r.isMeshLambertMaterial?(refreshUniformsCommon(m,r),function refreshUniformsLambert(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(m,r)):r.isMeshPhongMaterial?(refreshUniformsCommon(m,r),r.isMeshToonMaterial?function refreshUniformsToon(e,t){refreshUniformsPhong(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(m,r):refreshUniformsPhong(m,r)):r.isMeshStandardMaterial?(refreshUniformsCommon(m,r),r.isMeshPhysicalMaterial?function refreshUniformsPhysical(e,t){refreshUniformsStandard(e,t),e.reflectivity.value=t.reflectivity,// also part of uniforms common\ne.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(m,r):refreshUniformsStandard(m,r)):r.isMeshMatcapMaterial?(refreshUniformsCommon(m,r),function refreshUniformsMatcap(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,r)):r.isMeshDepthMaterial?(refreshUniformsCommon(m,r),function refreshUniformsDepth(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,r)):r.isMeshDistanceMaterial?(refreshUniformsCommon(m,r),function refreshUniformsDistance(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(m,r)):r.isMeshNormalMaterial?(refreshUniformsCommon(m,r),function refreshUniformsNormal(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,r)):r.isLineBasicMaterial?(!function refreshUniformsLine(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(m,r),r.isLineDashedMaterial&&function refreshUniformsDash(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(m,r)):r.isPointsMaterial?function refreshUniformsPoints(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*It,e.scale.value=.5*Ot,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(m,r):r.isSpriteMaterial?function refreshUniformsSprites(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(m,r):r.isShadowMaterial&&(m.color.value=r.color,m.opacity.value=r.opacity),\n// RectAreaLight Texture\n// TODO (mrdoob): Find a nicer implementation\nvoid 0!==m.ltc_1&&(m.ltc_1.value=Lt.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=Lt.LTC_2),WebGLUniforms.upload(J,n.uniformsList,m,mt)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(WebGLUniforms.upload(J,n.uniformsList,m,mt),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&f.setValue(J,"center",i.center),\n// common matrices\nf.setValue(J,"modelViewMatrix",i.modelViewMatrix),f.setValue(J,"normalMatrix",i.normalMatrix),f.setValue(J,"modelMatrix",i.matrixWorld),d}\n// Uniforms (refresh uniforms objects)\nfunction refreshUniformsCommon(e,t){\n// uv repeat and offset setting priorities\n// 1. color map\n// 2. specular map\n// 3. normal map\n// 4. bump map\n// 5. alpha map\n// 6. emissive map\nvar r;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,\n// don\'t flip CubeTexture envMaps, flip everything else:\n//  WebGLRenderTargetCube will be flipped for backwards compatibility\n//  WebGLRenderTargetCube.texture will be flipped because it\'s a Texture and NOT a CubeTexture\n// this check must be handled differently, or removed entirely, if WebGLRenderTargetCube uses a CubeTexture in the future\ne.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=te.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(\n// backwards compatibility\nr.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function refreshUniformsPhong(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),// to prevent pow( 0.0, 0.0 )\nt.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function refreshUniformsStandard(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(\n//uniforms.envMap.value = material.envMap; // part of uniforms common\ne.envMapIntensity.value=t.envMapIntensity)}Yt.setAnimationLoop(function onAnimationFrame(e){Wt.isPresenting()||qt&&qt(e)}),"undefined"!=typeof window&&Yt.setContext(window),this.setAnimationLoop=function(e){qt=e,Wt.setAnimationLoop(e),Yt.start()},\n// Rendering\nthis.render=function(e,t,r,i){if(t&&t.isCamera){if(!gt){\n// reset caching for this frame\nMt.geometry=null,Mt.program=null,Mt.wireframe=!1,bt=-1,wt=null,\n// update scene graph\n!0===e.autoUpdate&&e.updateMatrixWorld(),\n// update camera matrices and frustum\nnull===t.parent&&t.updateMatrixWorld(),Wt.enabled&&(t=Wt.getCamera(t)),(\n//\nY=ot.get(e,t)).init(),e.onBeforeRender(mt,e,t,r),Ht.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Nt.setFromMatrix(Ht),zt=this.localClippingEnabled,Ft=Ut.init(this.clippingPlanes,zt,t),(q=at.get(e,t)).init(),\n/*\n\t// TODO Duplicated code (Frustum)\n\n\tvar _sphere = new Sphere();\n\n\tfunction isObjectViewable( object ) {\n\n\t\tvar geometry = object.geometry;\n\n\t\tif ( geometry.boundingSphere === null )\n\t\t\tgeometry.computeBoundingSphere();\n\n\t\t_sphere.copy( geometry.boundingSphere ).\n\t\tapplyMatrix4( object.matrixWorld );\n\n\t\treturn isSphereViewable( _sphere );\n\n\t}\n\n\tfunction isSpriteViewable( sprite ) {\n\n\t\t_sphere.center.set( 0, 0, 0 );\n\t\t_sphere.radius = 0.7071067811865476;\n\t\t_sphere.applyMatrix4( sprite.matrixWorld );\n\n\t\treturn isSphereViewable( _sphere );\n\n\t}\n\n\tfunction isSphereViewable( sphere ) {\n\n\t\tif ( ! _frustum.intersectsSphere( sphere ) ) return false;\n\n\t\tvar numPlanes = _clipping.numPlanes;\n\n\t\tif ( numPlanes === 0 ) return true;\n\n\t\tvar planes = _this.clippingPlanes,\n\n\t\t\tcenter = sphere.center,\n\t\t\tnegRad = - sphere.radius,\n\t\t\ti = 0;\n\n\t\tdo {\n\n\t\t\t// out when deeper than radius in the negative halfspace\n\t\t\tif ( planes[ i ].distanceToPoint( center ) < negRad ) return false;\n\n\t\t} while ( ++ i !== numPlanes );\n\n\t\treturn true;\n\n\t}\n\t*/\nfunction projectObject(e,t,r){if(!1===e.visible)return;var i=e.layers.test(t.layers);if(i)if(e.isLight)Y.pushLight(e),e.castShadow&&Y.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Nt.intersectsSprite(e)){r&&kt.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ht);var n=ae.update(e),a=e.material;q.push(e,n,a,kt.z,null)}}else if(e.isImmediateRenderObject)r&&kt.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ht),q.push(e,null,e.material,kt.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||Nt.intersectsObject(e))){r&&kt.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ht);var n=ae.update(e),a=e.material;if(Array.isArray(a))for(var o=n.groups,s=0,c=o.length;s<c;s++){var l=o[s],h=a[l.materialIndex];h&&h.visible&&q.push(e,n,h,kt.z,l)}else a.visible&&q.push(e,n,a,kt.z,null)}var u=e.children;for(var s=0,c=u.length;s<c;s++)projectObject(u[s],t,r)}(e,t,mt.sortObjects),!0===mt.sortObjects&&q.sort(),\n//\nFt&&Ut.beginShadows();var n=Y.state.shadowsArray;Xt.render(n,e,t),Y.setupLights(t),Ft&&Ut.endShadows(),\n//\nthis.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),\n//\nht.render(q,e,t,i);\n// render scene\nvar a=q.opaque,o=q.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&renderObjects(a,e,t,s),o.length&&renderObjects(o,e,t,s)}else\n// opaque pass (front-to-back order)\na.length&&renderObjects(a,e,t),\n// transparent pass (back-to-front order)\no.length&&renderObjects(o,e,t);\n// Generate mipmap if we\'re using any kind of mipmap filtering\nr&&re.updateRenderTargetMipmap(r),\n// Ensure depth buffer writing is enabled so it can be cleared on next render\n$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1),e.onAfterRender(mt,e,t),Wt.enabled&&Wt.submitFrame(),\n// _gl.finish();\nq=null,Y=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function allocTextureUnit(){var e=Rt;return e>=K.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+K.maxTextures),Rt+=1,e},\n// this.setTexture2D = setTexture2D;\nthis.setTexture2D=function(){var e=!1;\n// backwards compatibility: peel texture.texture\nreturn function setTexture2D(t,r){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don\'t use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),re.setTexture2D(t,r)}}(),this.setTexture3D=function setTexture3D(e,t){re.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function setTexture(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),re.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function setTextureCube(t,r){\n// backwards compatibility: peel texture.texture\nt&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don\'t use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),\n// currently relying on the fact that WebGLRenderTargetCube.texture is a Texture and NOT a CubeTexture\n// TODO: unify these code paths\nt&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?\n// CompressedTexture can have Array in image :/\n// this function alone should take care of cube textures\nre.setTextureCube(t,r):\n// assumed: texture property of THREE.WebGLRenderTargetCube\nre.setTextureCubeDynamic(t,r)}}(),\n//\nthis.setFramebuffer=function(e){vt=e},this.getRenderTarget=function(){return yt},this.setRenderTarget=function(e){yt=e,e&&void 0===te.get(e).__webglFramebuffer&&re.setupRenderTarget(e);var t=vt,r=!1;if(e){var i=te.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=i[e.activeCubeFace],r=!0):t=i,St.copy(e.viewport),Ct.copy(e.scissor),Pt=e.scissorTest}else St.copy(Dt).multiplyScalar(It),Ct.copy(Gt).multiplyScalar(It),Pt=Vt;if(xt!==t&&(J.bindFramebuffer(J.FRAMEBUFFER,t),xt=t),$.viewport(St),$.scissor(Ct),$.setScissorTest(Pt),r){var n=te.get(e.texture);J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,i,n,a){if(e&&e.isWebGLRenderTarget){var o=te.get(e).__webglFramebuffer;if(o){var s=!1;o!==xt&&(J.bindFramebuffer(J.FRAMEBUFFER,o),s=!0);try{var c=e.texture,l=c.format,h=c.type;if(l!==Pe&&ft.convert(l)!==J.getParameter(J.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===ge||ft.convert(h)===J.getParameter(J.IMPLEMENTATION_COLOR_READ_TYPE)||h===Me&&(K.isWebGL2||Q.get("OES_texture_float")||Q.get("WEBGL_color_buffer_float"))||h===we&&(K.isWebGL2?Q.get("EXT_color_buffer_float"):Q.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");J.checkFramebufferStatus(J.FRAMEBUFFER)===J.FRAMEBUFFER_COMPLETE?\n// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)\nt>=0&&t<=e.width-i&&r>=0&&r<=e.height-n&&J.readPixels(t,r,i,n,ft.convert(l),ft.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&J.bindFramebuffer(J.FRAMEBUFFER,xt)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var i=t.image.width,n=t.image.height,a=ft.convert(t.format);this.setTexture2D(t,0),J.copyTexImage2D(J.TEXTURE_2D,r||0,a,e.x,e.y,i,n,0)},this.copyTextureToTexture=function(e,t,r,i){var n=t.image.width,a=t.image.height,o=ft.convert(r.format),s=ft.convert(r.type);this.setTexture2D(r,0),t.isDataTexture?J.texSubImage2D(J.TEXTURE_2D,i||0,e.x,e.y,n,a,o,s,t.image.data):J.texSubImage2D(J.TEXTURE_2D,i||0,e.x,e.y,o,s,t.image)}}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\nfunction Fog(e,t,r){this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}\n/**\n * @author benaadams / https://twitter.com/ben_a_adams\n */\nfunction InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}\n/**\n * @author benaadams / https://twitter.com/ben_a_adams\n */\nfunction InterleavedBufferAttribute(e,t,r,i){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}\n/**\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  map: new THREE.Texture( <Image> ),\n *  rotation: <float>,\n *  sizeAttenuation: <bool>\n * }\n */\nfunction SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Sprite(e){if(Object3D.call(this),this.type="Sprite",void 0===kt){kt=new BufferGeometry;var t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);kt.setIndex([0,1,2,0,2,3]),kt.addAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),kt.addAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=kt,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}\n/**\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */\nfunction LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}\n/**\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author michael guerrero / http://realitymeltdown.com\n * @author ikerr / http://verold.com\n */\nfunction Skeleton(e,t){\n// use the supplied bone inverses or calculate the inverses\nif(\n// copy the bone array\ne=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new Matrix4)}}\n/**\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author ikerr / http://verold.com\n */\nfunction Bone(){Object3D.call(this),this.type="Bone"}\n/**\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author ikerr / http://verold.com\n */\nfunction SkinnedMesh(e,t){Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4;var r=new Skeleton(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *\n *  linewidth: <float>,\n *  linecap: "round",\n *  linejoin: "round"\n * }\n */\nfunction LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Line(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial({color:16777215*Math.random()})}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}\n/**\n * @author mgreter / http://github.com/mgreter\n */\nfunction LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *  map: new THREE.Texture( <Image> ),\n *\n *  size: <float>,\n *  sizeAttenuation: <bool>\n *\n *  morphTargets: <bool>\n * }\n */\nfunction PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial({color:16777215*Math.random()})}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction VideoTexture(e,t,r,i,n,a,o,s,c){Texture.call(this,e,t,r,i,n,a,o,s,c),this.generateMipmaps=!1}\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction CompressedTexture(e,t,r,i,n,a,o,s,c,l,h,u){Texture.call(this,null,a,o,s,c,l,i,n,h,u),this.image={width:t,height:r},this.mipmaps=e,\n// no flipping for cube textures\n// (also flipping doesn\'t work for compressed textures )\nthis.flipY=!1,\n// can\'t generate mipmaps for compressed textures\n// mips must be embedded in DDS files\nthis.generateMipmaps=!1}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction CanvasTexture(e,t,r,i,n,a,o,s,c){Texture.call(this,e,t,r,i,n,a,o,s,c),this.needsUpdate=!0}\n/**\n * @author Matt DesLauriers / @mattdesl\n * @author atix / arthursilber.de\n */\nfunction DepthTexture(e,t,r,i,n,a,o,s,c,l){if((l=void 0!==l?l:Oe)!==Oe&&l!==Ie)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&l===Oe&&(r=xe),void 0===r&&l===Ie&&(r=Le),Texture.call(this,null,i,n,a,o,s,l,r,c),this.image={width:e,height:t},this.magFilter=void 0!==o?o:he,this.minFilter=void 0!==s?s:he,this.flipY=!1,this.generateMipmaps=!1}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\nfunction WireframeGeometry(e){BufferGeometry.call(this),this.type="WireframeGeometry";\n// buffer\nvar t,r,i,n,a,o,s,c,l,h,u=[],p=[0,0],d={},f=["a","b","c"];\n// helper variables\n// different logic for Geometry and BufferGeometry\nif(e&&e.isGeometry){\n// create a data structure that contains all edges without duplicates\nvar m=e.faces;for(t=0,i=m.length;t<i;t++){var g=m[t];for(r=0;r<3;r++)s=g[f[r]],c=g[f[(r+1)%3]],p[0]=Math.min(s,c),// sorting prevents duplicates\np[1]=Math.max(s,c),void 0===d[l=p[0]+","+p[1]]&&(d[l]={index1:p[0],index2:p[1]})}\n// generate vertices\nfor(l in d)o=d[l],h=e.vertices[o.index1],u.push(h.x,h.y,h.z),h=e.vertices[o.index2],u.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var v,y,x,b,_,M,w;if(h=new Vector3,null!==e.index){\n// create a data structure that contains all eges without duplicates\nfor(\n// indexed BufferGeometry\nv=e.attributes.position,y=e.index,0===(x=e.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),n=0,a=x.length;n<a;++n)for(t=_=(b=x[n]).start,i=_+b.count;t<i;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),c=y.getX(t+(r+1)%3),p[0]=Math.min(s,c),// sorting prevents duplicates\np[1]=Math.max(s,c),void 0===d[l=p[0]+","+p[1]]&&(d[l]={index1:p[0],index2:p[1]});\n// generate vertices\nfor(l in d)o=d[l],h.fromBufferAttribute(v,o.index1),u.push(h.x,h.y,h.z),h.fromBufferAttribute(v,o.index2),u.push(h.x,h.y,h.z)}else for(\n// non-indexed BufferGeometry\nt=0,i=(v=e.attributes.position).count/3;t<i;t++)for(r=0;r<3;r++)\n// three edges per triangle, an edge is represented as (index1, index2)\n// e.g. the first triangle has the following edges: (0,1),(1,2),(2,0)\nM=3*t+r,h.fromBufferAttribute(v,M),u.push(h.x,h.y,h.z),w=3*t+(r+1)%3,h.fromBufferAttribute(v,w),u.push(h.x,h.y,h.z)}\n// build geometry\nthis.addAttribute("position",new Float32BufferAttribute(u,3))}\n/**\n * @author zz85 / https://github.com/zz85\n * @author Mugen87 / https://github.com/Mugen87\n *\n * Parametric Surfaces Geometry\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\n */\n// ParametricGeometry\nfunction ParametricGeometry(e,t,r){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,r)),this.mergeVertices()}\n// ParametricBufferGeometry\nfunction ParametricBufferGeometry(e,t,r){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};\n// buffers\nvar i,n,a=[],o=[],s=[],c=[],l=new Vector3,h=new Vector3,u=new Vector3,p=new Vector3,d=new Vector3;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");\n// generate vertices, normals and uvs\nvar f=t+1;for(i=0;i<=r;i++){var m=i/r;for(n=0;n<=t;n++){var g=n/t;\n// vertex\ne(g,m,h),o.push(h.x,h.y,h.z),\n// normal\n// approximate tangent vectors via finite differences\ng-1e-5>=0?(e(g-1e-5,m,u),p.subVectors(h,u)):(e(g+1e-5,m,u),p.subVectors(u,h)),m-1e-5>=0?(e(g,m-1e-5,u),d.subVectors(h,u)):(e(g,m+1e-5,u),d.subVectors(u,h)),\n// cross product of tangent vectors returns surface normal\nl.crossVectors(p,d).normalize(),s.push(l.x,l.y,l.z),\n// uv\nc.push(g,m)}}\n// generate indices\nfor(i=0;i<r;i++)for(n=0;n<t;n++){var v=i*f+n,y=i*f+n+1,x=(i+1)*f+n+1,b=(i+1)*f+n;\n// faces one and two\na.push(v,y,b),a.push(y,x,b)}\n// build geometry\nthis.setIndex(a),this.addAttribute("position",new Float32BufferAttribute(o,3)),this.addAttribute("normal",new Float32BufferAttribute(s,3)),this.addAttribute("uv",new Float32BufferAttribute(c,2))}\n/**\n * @author clockworkgeek / https://github.com/clockworkgeek\n * @author timothypratley / https://github.com/timothypratley\n * @author WestLangley / http://github.com/WestLangley\n * @author Mugen87 / https://github.com/Mugen87\n */\n// PolyhedronGeometry\nfunction PolyhedronGeometry(e,t,r,i){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,r,i)),this.mergeVertices()}\n// PolyhedronBufferGeometry\nfunction PolyhedronBufferGeometry(e,t,r,i){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1;\n// default buffer data\nvar n=[],a=[];function subdivideFace(e,t,r,i){var n,a,o=Math.pow(2,i),s=[];\n// we use this multidimensional array as a data structure for creating the subdivision\n// construct all of the vertices for this subdivision\nfor(n=0;n<=o;n++){s[n]=[];var c=e.clone().lerp(r,n/o),l=t.clone().lerp(r,n/o),h=o-n;for(a=0;a<=h;a++)s[n][a]=0===a&&n===o?c:c.clone().lerp(l,a/h)}\n// construct all of the faces\nfor(n=0;n<o;n++)for(a=0;a<2*(o-n)-1;a++){var u=Math.floor(a/2);a%2==0?(pushVertex(s[n][u+1]),pushVertex(s[n+1][u]),pushVertex(s[n][u])):(pushVertex(s[n][u+1]),pushVertex(s[n+1][u+1]),pushVertex(s[n+1][u]))}}function pushVertex(e){n.push(e.x,e.y,e.z)}function getVertexByIndex(t,r){var i=3*t;r.x=e[i+0],r.y=e[i+1],r.z=e[i+2]}function correctUV(e,t,r,i){i<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=i/2/Math.PI+.5)}\n// Angle around the Y axis, counter-clockwise when looking from above.\nfunction azimuth(e){return Math.atan2(e.z,-e.x)}\n// Angle above the XZ plane.\nfunction inclination(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}\n// the subdivision creates the vertex buffer data\n!\n// helper functions\nfunction subdivide(e){\n// iterate over all faces and apply a subdivison with the given detail value\nfor(var r=new Vector3,i=new Vector3,n=new Vector3,a=0;a<t.length;a+=3)\n// get the vertices of the face\ngetVertexByIndex(t[a+0],r),getVertexByIndex(t[a+1],i),getVertexByIndex(t[a+2],n),\n// perform subdivision\nsubdivideFace(r,i,n,e)}(i=i||0),\n// all vertices should lie on a conceptual sphere with a given radius\nfunction appplyRadius(e){\n// iterate over the entire buffer and apply the radius to each vertex\nfor(var t=new Vector3,r=0;r<n.length;r+=3)t.x=n[r+0],t.y=n[r+1],t.z=n[r+2],t.normalize().multiplyScalar(e),n[r+0]=t.x,n[r+1]=t.y,n[r+2]=t.z}(r),\n// finally, create the uv data\nfunction generateUVs(){for(var e=new Vector3,t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];var r=azimuth(e)/2/Math.PI+.5,i=inclination(e)/Math.PI+.5;a.push(r,1-i)}(function correctUVs(){for(var e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector3,o=new Vector2,s=new Vector2,c=new Vector2,l=0,h=0;l<n.length;l+=9,h+=6){e.set(n[l+0],n[l+1],n[l+2]),t.set(n[l+3],n[l+4],n[l+5]),r.set(n[l+6],n[l+7],n[l+8]),o.set(a[h+0],a[h+1]),s.set(a[h+2],a[h+3]),c.set(a[h+4],a[h+5]),i.copy(e).add(t).add(r).divideScalar(3);var u=azimuth(i);correctUV(o,h+0,e,u),correctUV(s,h+2,t,u),correctUV(c,h+4,r,u)}})(),function correctSeam(){\n// handle case when face straddles the seam, see #3269\nfor(var e=0;e<a.length;e+=6){\n// uv data of a single face\nvar t=a[e+0],r=a[e+2],i=a[e+4],n=Math.max(t,r,i),o=Math.min(t,r,i);\n// 0.9 is somewhat arbitrary\nn>.9&&o<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),i<.2&&(a[e+4]+=1))}}()}(),\n// build non-indexed geometry\nthis.addAttribute("position",new Float32BufferAttribute(n,3)),this.addAttribute("normal",new Float32BufferAttribute(n.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}\n/**\n * @author timothypratley / https://github.com/timothypratley\n * @author Mugen87 / https://github.com/Mugen87\n */\n// TetrahedronGeometry\nfunction TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}\n// TetrahedronBufferGeometry\nfunction TetrahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}\n/**\n * @author timothypratley / https://github.com/timothypratley\n * @author Mugen87 / https://github.com/Mugen87\n */\n// OctahedronGeometry\nfunction OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}\n// OctahedronBufferGeometry\nfunction OctahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}\n/**\n * @author timothypratley / https://github.com/timothypratley\n * @author Mugen87 / https://github.com/Mugen87\n */\n// IcosahedronGeometry\nfunction IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}\n// IcosahedronBufferGeometry\nfunction IcosahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];PolyhedronBufferGeometry.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}\n/**\n * @author Abe Pazos / https://hamoid.com\n * @author Mugen87 / https://github.com/Mugen87\n */\n// DodecahedronGeometry\nfunction DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}\n// DodecahedronBufferGeometry\nfunction DodecahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,n=[\n// (Â±1, Â±1, Â±1)\n-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,\n// (0, Â±1/Ï, Â±Ï)\n0,-i,-r,0,-i,r,0,i,-r,0,i,r,\n// (Â±1/Ï, Â±Ï, 0)\n-i,-r,0,-i,r,0,i,-r,0,i,r,0,\n// (Â±Ï, 0, Â±1/Ï)\n-r,0,-i,r,0,-i,-r,0,i,r,0,i];PolyhedronBufferGeometry.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}\n/**\n * @author oosmoxiecode / https://github.com/oosmoxiecode\n * @author WestLangley / https://github.com/WestLangley\n * @author zz85 / https://github.com/zz85\n * @author miningold / https://github.com/miningold\n * @author jonobr1 / https://github.com/jonobr1\n * @author Mugen87 / https://github.com/Mugen87\n *\n */\n// TubeGeometry\nfunction TubeGeometry(e,t,r,i,n,a){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new TubeBufferGeometry(e,t,r,i,n);\n// expose internals\nthis.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,\n// create geometry\nthis.fromBufferGeometry(o),this.mergeVertices()}\n// TubeBufferGeometry\nfunction TubeBufferGeometry(e,t,r,i,n){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n},t=t||64,r=r||1,i=i||8,n=n||!1;var a=e.computeFrenetFrames(t,n);\n// expose internals\nthis.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;\n// helper variables\nvar o,s,c=new Vector3,l=new Vector3,h=new Vector2,u=new Vector3,p=[],d=[],f=[],m=[];function generateSegment(n){\n// we use getPointAt to sample evenly distributed points from the given path\nu=e.getPointAt(n/t,u);\n// retrieve corresponding normal and binormal\nvar o=a.normals[n],h=a.binormals[n];\n// generate normals and vertices for the current segment\nfor(s=0;s<=i;s++){var f=s/i*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);\n// normal\nl.x=g*o.x+m*h.x,l.y=g*o.y+m*h.y,l.z=g*o.z+m*h.z,l.normalize(),d.push(l.x,l.y,l.z),\n// vertex\nc.x=u.x+r*l.x,c.y=u.y+r*l.y,c.z=u.z+r*l.z,p.push(c.x,c.y,c.z)}}\n// create buffer data\n!\n// functions\nfunction generateBufferData(){for(o=0;o<t;o++)generateSegment(o);\n// if the geometry is not closed, generate the last row of vertices and normals\n// at the regular position on the given path\n//\n// if the geometry is closed, duplicate the first row of vertices and normals (uvs will differ)\ngenerateSegment(!1===n?t:0),\n// uvs are generated in a separate function.\n// this makes it easy compute correct values for closed geometries\nfunction generateUVs(){for(o=0;o<=t;o++)for(s=0;s<=i;s++)h.x=o/t,h.y=s/i,f.push(h.x,h.y)}(),\n// finally create faces\nfunction generateIndices(){for(s=1;s<=t;s++)for(o=1;o<=i;o++){var e=(i+1)*(s-1)+(o-1),r=(i+1)*s+(o-1),n=(i+1)*s+o,a=(i+1)*(s-1)+o;\n// faces\nm.push(e,r,a),m.push(r,n,a)}}()}(),\n// build geometry\nthis.setIndex(m),this.addAttribute("position",new Float32BufferAttribute(p,3)),this.addAttribute("normal",new Float32BufferAttribute(d,3)),this.addAttribute("uv",new Float32BufferAttribute(f,2))}\n/**\n * @author oosmoxiecode\n * @author Mugen87 / https://github.com/Mugen87\n *\n * based on http://www.blackpawn.com/texts/pqtorus/\n */\n// TorusKnotGeometry\nfunction TorusKnotGeometry(e,t,r,i,n,a,o){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,r,i,n,a)),this.mergeVertices()}\n// TorusKnotBufferGeometry\nfunction TorusKnotBufferGeometry(e,t,r,i,n,a){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,n=n||2,a=a||3;\n// buffers\nvar o,s,c=[],l=[],h=[],u=[],p=new Vector3,d=new Vector3,f=new Vector3,m=new Vector3,g=new Vector3,v=new Vector3,y=new Vector3;\n// generate vertices, normals and uvs\nfor(o=0;o<=r;++o){\n// the radian "u" is used to calculate the position on the torus curve of the current tubular segement\nvar x=o/r*n*Math.PI*2;\n// now we calculate two points. P1 is our current position on the curve, P2 is a little farther ahead.\n// these points are used to create a special "coordinate space", which is necessary to calculate the correct vertex positions\nfor(calculatePositionOnCurve(x,n,a,e,f),calculatePositionOnCurve(x+.01,n,a,e,m),\n// calculate orthonormal basis\nv.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),\n// normalize B, N. T can be ignored, we don\'t use it\ng.normalize(),y.normalize(),s=0;s<=i;++s){\n// now calculate the vertices. they are nothing more than an extrusion of the torus curve.\n// because we extrude a shape in the xy-plane, there is no need to calculate a z-value.\nvar b=s/i*Math.PI*2,_=-t*Math.cos(b),M=t*Math.sin(b);\n// now calculate the final vertex position.\n// first we orient the extrusion with our basis vectos, then we add it to the current position on the curve\np.x=f.x+(_*y.x+M*g.x),p.y=f.y+(_*y.y+M*g.y),p.z=f.z+(_*y.z+M*g.z),l.push(p.x,p.y,p.z),\n// normal (P1 is always the center/origin of the extrusion, thus we can use it to calculate the normal)\nd.subVectors(p,f).normalize(),h.push(d.x,d.y,d.z),\n// uv\nu.push(o/r),u.push(s/i)}}\n// generate indices\nfor(s=1;s<=r;s++)for(o=1;o<=i;o++){\n// indices\nvar w=(i+1)*(s-1)+(o-1),T=(i+1)*s+(o-1),E=(i+1)*s+o,S=(i+1)*(s-1)+o;\n// faces\nc.push(w,T,S),c.push(T,E,S)}\n// build geometry\n// this function calculates the current position on the torus curve\nfunction calculatePositionOnCurve(e,t,r,i,n){var a=Math.cos(e),o=Math.sin(e),s=r/t*e,c=Math.cos(s);n.x=i*(2+c)*.5*a,n.y=i*(2+c)*o*.5,n.z=i*Math.sin(s)*.5}this.setIndex(c),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2))}\n/**\n * @author oosmoxiecode\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n// TorusGeometry\nfunction TorusGeometry(e,t,r,i,n){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},this.fromBufferGeometry(new TorusBufferGeometry(e,t,r,i,n)),this.mergeVertices()}\n// TorusBufferGeometry\nfunction TorusBufferGeometry(e,t,r,i,n){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||1,t=t||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,n=n||2*Math.PI;\n// buffers\nvar a,o,s=[],c=[],l=[],h=[],u=new Vector3,p=new Vector3,d=new Vector3;\n// generate vertices, normals and uvs\nfor(a=0;a<=r;a++)for(o=0;o<=i;o++){var f=o/i*n,m=a/r*Math.PI*2;\n// vertex\np.x=(e+t*Math.cos(m))*Math.cos(f),p.y=(e+t*Math.cos(m))*Math.sin(f),p.z=t*Math.sin(m),c.push(p.x,p.y,p.z),\n// normal\nu.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(p,u).normalize(),l.push(d.x,d.y,d.z),\n// uv\nh.push(o/i),h.push(a/r)}\n// generate indices\nfor(a=1;a<=r;a++)for(o=1;o<=i;o++){\n// indices\nvar g=(i+1)*a+o-1,v=(i+1)*(a-1)+o-1,y=(i+1)*(a-1)+o,x=(i+1)*a+o;\n// faces\ns.push(g,v,x),s.push(v,y,x)}\n// build geometry\nthis.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("normal",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(h,2))}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},\n/**\n\t * Sets the FOV by focal length in respect to the current .filmGauge.\n\t *\n\t * The default film gauge is 35, so that the focal length can be specified for\n\t * a 35mm (full frame) camera.\n\t *\n\t * Values for focal length and film gauge must have the same unit.\n\t */\nsetFocalLength:function(e){\n// see http://www.bobatkins.com/photography/technical/field_of_view.html\nvar t=.5*this.getFilmHeight()/e;this.fov=2*_t.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},\n/**\n\t * Calculates the focal length from the current .fov and .filmGauge.\n\t */\ngetFocalLength:function(){var e=Math.tan(.5*_t.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*_t.RAD2DEG*Math.atan(Math.tan(.5*_t.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){\n// film not completely covered in portrait format (aspect < 1)\nreturn this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){\n// film not completely covered in landscape format (aspect > 1)\nreturn this.filmGauge/Math.max(this.aspect,1)},\n/**\n\t * Sets an offset in a larger frustum. This is useful for multi-window or\n\t * multi-monitor/multi-machine setups.\n\t *\n\t * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\n\t * the monitors are in grid like this\n\t *\n\t *   +---+---+---+\n\t *   | A | B | C |\n\t *   +---+---+---+\n\t *   | D | E | F |\n\t *   +---+---+---+\n\t *\n\t * then for each monitor you would call it like this\n\t *\n\t *   var w = 1920;\n\t *   var h = 1080;\n\t *   var fullWidth = w * 3;\n\t *   var fullHeight = h * 2;\n\t *\n\t *   --A--\n\t *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\n\t *   --B--\n\t *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\n\t *   --C--\n\t *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\n\t *   --D--\n\t *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\n\t *   --E--\n\t *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\n\t *   --F--\n\t *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\n\t *\n\t *   Note there is no reason monitors have to be the same size or in a grid.\n\t */\nsetViewOffset:function(e,t,r,i,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*_t.DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*i/o,t-=a.offsetY*r/s,i*=a.width/o,r*=a.height/s}var c=this.filmOffset;0!==c&&(n+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),FogExp2.prototype.isFogExp2=!0,FogExp2.prototype.clone=function(){return new FogExp2(this.color,this.density)},FogExp2.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Fog.prototype.isFog=!0,Fog.prototype.clone=function(){return new Fog(this.color,this.near,this.far)},Fog.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(){var e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector2,n=new Vector2,a=new Matrix4,o=new Vector3,s=new Vector3,c=new Vector3,l=new Vector2,h=new Vector2,u=new Vector2;function transformVertex(e,t,r,o,s,c){\n// compute position in camera space\ni.subVectors(e,r).addScalar(.5).multiply(o),\n// to check if rotation is not zero\nvoid 0!==s?(n.x=c*i.x-s*i.y,n.y=s*i.x+c*i.y):n.copy(i),e.copy(t),e.x+=n.x,e.y+=n.y,\n// transform to world space\ne.applyMatrix4(a)}return function raycast(i,n){t.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix);var p,d,f=this.material.rotation;0!==f&&(d=Math.cos(f),p=Math.sin(f));var m=this.center;transformVertex(o.set(-.5,-.5,0),r,m,t,p,d),transformVertex(s.set(.5,-.5,0),r,m,t,p,d),transformVertex(c.set(.5,.5,0),r,m,t,p,d),l.set(0,0),h.set(1,0),u.set(1,1);\n// check first triangle\nvar g=i.ray.intersectTriangle(o,s,c,!1,e);if(null!==g||(\n// check second triangle\ntransformVertex(s.set(-.5,.5,0),r,m,t,p,d),h.set(0,1),null!==(g=i.ray.intersectTriangle(o,c,s,!1,e)))){var v=i.ray.origin.distanceTo(e);v<i.near||v>i.far||n.push({distance:v,point:e.clone(),uv:Triangle.getUV(e,o,s,c,l,h,u,new Vector2),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Object3D.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var n=t[r];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new Vector3;return function raycast(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}(),update:function(){var e=new Vector3,t=new Vector3;return function update(r){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);i[0].object.visible=!0;for(var a=1,o=i.length;a<o&&n>=i[a].distance;a++)i[a-1].object.visible=!1,i[a].object.visible=!0;for(;a<o;a++)i[a].object.visible=!1}}}(),toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var a=r[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;\n// recover the bind-time world matrices\nfor(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);\n// compute the local matrices, positions, rotations and scales\nfor(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new Matrix4,t=new Matrix4;return function update(){\n// flatten bone matrices to array\nfor(var r=this.bones,i=this.boneInverses,n=this.boneMatrices,a=this.boneTexture,o=0,s=r.length;o<s;o++){\n// compute the offset between the current and the original transform\nvar c=r[o]?r[o].matrixWorld:t;e.multiplyMatrices(c,i[o]),e.toArray(n,16*o)}void 0!==a&&(a.needsUpdate=!0)}}(),clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t];if(i.name===e)return i}}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,initBones:function(){var e,t,r,i,n=[];if(this.geometry&&void 0!==this.geometry.bones){\n// first, create array of \'Bone\' objects from geometry data\nfor(r=0,i=this.geometry.bones.length;r<i;r++)t=this.geometry.bones[r],\n// create new \'Bone\' object\ne=new Bone,n.push(e),\n// apply values\ne.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);\n// second, create bone hierarchy\nfor(r=0,i=this.geometry.bones.length;r<i;r++)-1!==(t=this.geometry.bones[r]).parent&&null!==t.parent&&void 0!==n[t.parent]?\n// subsequent bones in the hierarchy\nn[t.parent].add(n[r]):\n// topmost bone, immediate child of the skinned mesh\nthis.add(n[r])}\n// now the bones are part of the scene graph and children of the skinned mesh.\n// let\'s update the corresponding matrices\nreturn this.updateMatrixWorld(!0),n},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var r=this.geometry.skinWeights[t];(e=1/r.manhattanLength())!==1/0?r.multiplyScalar(e):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var i=new Vector4,n=this.geometry.attributes.skinWeight;for(t=0;t<n.count;t++)i.x=n.getX(t),i.y=n.getY(t),i.z=n.getZ(t),i.w=n.getW(t),(e=1/i.manhattanLength())!==1/0?i.multiplyScalar(e):i.set(1,0,0,0),n.setXYZW(t,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function computeLineDistances(){var r=this.geometry;if(r.isBufferGeometry)\n// we assume non-indexed geometry\nif(null===r.index){for(var i=r.attributes.position,n=[0],a=1,o=i.count;a<o;a++)e.fromBufferAttribute(i,a-1),t.fromBufferAttribute(i,a),n[a]=n[a-1],n[a]+=e.distanceTo(t);r.addAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;(n=r.lineDistances)[0]=0;for(a=1,o=s.length;a<o;a++)n[a]=n[a-1],n[a]+=s[a-1].distanceTo(s[a])}return this}}(),raycast:function(){var e=new Matrix4,t=new Ray,r=new Sphere;return function raycast(i,n){var a=i.linePrecision,o=this.geometry,s=this.matrixWorld;if(\n// Checking boundingSphere distance to ray\nnull===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=a,!1!==i.ray.intersectsSphere(r)){\n//\ne.getInverse(s),t.copy(i.ray).applyMatrix4(e);var c=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c,h=new Vector3,u=new Vector3,p=new Vector3,d=new Vector3,f=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,g=o.attributes.position.array;if(null!==m)for(var v=m.array,y=0,x=v.length-1;y<x;y+=f){var b=v[y],_=v[y+1];if(h.fromArray(g,3*b),u.fromArray(g,3*_),!(t.distanceSqToSegment(h,u,d,p)>l))d.applyMatrix4(this.matrixWorld),(T=i.ray.origin.distanceTo(d))<i.near||T>i.far||n.push({distance:T,\n// What do we want? intersection point on the ray or on the segment??\n// point: raycaster.ray.at( distance ),\npoint:p.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(y=0,x=g.length/3-1;y<x;y+=f){if(h.fromArray(g,3*y),u.fromArray(g,3*y+3),!(t.distanceSqToSegment(h,u,d,p)>l))d.applyMatrix4(this.matrixWorld),(T=i.ray.origin.distanceTo(d))<i.near||T>i.far||n.push({distance:T,\n// What do we want? intersection point on the ray or on the segment??\n// point: raycaster.ray.at( distance ),\npoint:p.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(o.isGeometry){var M=o.vertices,w=M.length;for(y=0;y<w-1;y+=f){var T;if(!(t.distanceSqToSegment(M[y],M[y+1],d,p)>l))d.applyMatrix4(this.matrixWorld),(T=i.ray.origin.distanceTo(d))<i.near||T>i.far||n.push({distance:T,\n// What do we want? intersection point on the ray or on the segment??\n// point: raycaster.ray.at( distance ),\npoint:p.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function computeLineDistances(){var r=this.geometry;if(r.isBufferGeometry)\n// we assume non-indexed geometry\nif(null===r.index){for(var i=r.attributes.position,n=[],a=0,o=i.count;a<o;a+=2)e.fromBufferAttribute(i,a),t.fromBufferAttribute(i,a+1),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+e.distanceTo(t);r.addAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(n=r.lineDistances,a=0,o=s.length;a<o;a+=2)e.copy(s[a]),t.copy(s[a+1]),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+e.distanceTo(t)}return this}}()}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var e=new Matrix4,t=new Ray,r=new Sphere;return function raycast(i,n){var a=this,o=this.geometry,s=this.matrixWorld,c=i.params.Points.threshold;if(\n// Checking boundingSphere distance to ray\nnull===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=c,!1!==i.ray.intersectsSphere(r)){\n//\ne.getInverse(s),t.copy(i.ray).applyMatrix4(e);var l=c/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=new Vector3,p=new Vector3;if(o.isBufferGeometry){var d=o.index,f=o.attributes.position.array;if(null!==d)for(var m=d.array,g=0,v=m.length;g<v;g++){var y=m[g];u.fromArray(f,3*y),testPoint(u,y)}else{g=0;for(var x=f.length/3;g<x;g++)u.fromArray(f,3*g),testPoint(u,g)}}else{var b=o.vertices;for(g=0,x=b.length;g<x;g++)testPoint(b[g],g)}}function testPoint(e,r){var o=t.distanceSqToPoint(e);if(o<h){t.closestPointToPoint(e,p),p.applyMatrix4(s);var c=i.ray.origin.distanceTo(p);if(c<i.near||c>i.far)return;n.push({distance:c,distanceToRay:Math.sqrt(o),point:p.clone(),index:r,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0,WireframeGeometry.prototype=Object.create(BufferGeometry.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,TetrahedronGeometry.prototype=Object.create(Geometry.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,IcosahedronGeometry.prototype=Object.create(Geometry.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,TubeGeometry.prototype=Object.create(Geometry.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TorusKnotGeometry.prototype=Object.create(Geometry.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TorusGeometry.prototype=Object.create(Geometry.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;\n/**\n * @author Mugen87 / https://github.com/Mugen87\n * Port from https://github.com/mapbox/earcut (v2.1.2)\n */\nvar Wt=function(e,t,r){r=r||2;var i,n,a,o,s,c,l,h=t&&t.length,u=h?t[0]*r:e.length,p=linkedList(e,0,u,r,!0),d=[];if(!p)return d;\n// if the shape is not too simple, we\'ll use z-order curve hash later; calculate polygon bbox\nif(h&&(p=\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(e,t,r,i){var n,a,o,s,c,l=[];for(n=0,a=t.length;n<a;n++)o=t[n]*i,s=n<a-1?t[n+1]*i:e.length,(c=linkedList(e,o,s,i,!1))===c.next&&(c.steiner=!0),l.push(getLeftmost(c));\n// process holes from left to right\nfor(l.sort(compareX),n=0;n<l.length;n++)eliminateHole(l[n],r),r=filterPoints(r,r.next);return r}(e,t,p,r)),e.length>80*r){i=a=e[0],n=o=e[1];for(var f=r;f<u;f+=r)s=e[f],c=e[f+1],s<i&&(i=s),c<n&&(n=c),s>a&&(a=s),c>o&&(o=c);\n// minX, minY and invSize are later used to transform coords into integers for z-order calculation\nl=0!==(l=Math.max(a-i,o-n))?1/l:0}return earcutLinked(p,d,r,i,n,l),d};\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(e,t,r,i,n){var a,o;if(n===function signedArea(e,t,r,i){for(var n=0,a=t,o=r-i;a<r;a+=i)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n */(e,t,r,i)>0)for(a=t;a<r;a+=i)o=insertNode(a,e[a],e[a+1],o);else for(a=r-i;a>=t;a-=i)o=insertNode(a,e[a],e[a+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}\n// eliminate colinear or duplicate points\nfunction filterPoints(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!equals(i,i.next)&&0!==three_module_area(i.prev,i,i.next))i=i.next;else{if(removeNode(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(e,t,r,i,n,a,o){if(e){\n// interlink polygon nodes in z-order\n!o&&a&&\n// interlink polygon nodes in z-order\nfunction indexCurve(e,t,r,i){var n=e;do{null===n.z&&(n.z=zOrder(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,\n// Simon Tatham\'s linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(e){var t,r,i,n,a,o,s,c,l=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,i=r,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(c=l;s>0||c>0&&i;)0!==s&&(0===c||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,l*=2}while(o>1);return e}\n// z-order of a point given coords and inverse of the longer side of data bbox\n(n)}(e,i,n,a);\n// iterate through ears, slicing them one by one\nfor(var s,c,l=e;e.prev!==e.next;)if(s=e.prev,c=e.next,a?isEarHashed(e,i,n,a):isEar(e))\n// cut off the triangle\nt.push(s.i/r),t.push(e.i/r),t.push(c.i/r),removeNode(e),\n// skipping the next vertice leads to less sliver triangles\ne=c.next,l=c.next;else\n// if we looped through the whole remaining polygon and can\'t find any more ears\nif((e=c)===l){\n// try filtering points and slicing again\no?1===o?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,i,n,a,2):2===o&&splitEarcut(e,t,r,i,n,a):earcutLinked(filterPoints(e),t,r,i,n,a,1);break}}}\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(e){var t=e.prev,r=e,i=e.next;if(three_module_area(t,r,i)>=0)return!1;// reflex, can\'t be an ear\n// now make sure we don\'t have other points inside the potential ear\nfor(var n=e.next.next;n!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&three_module_area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function isEarHashed(e,t,r,i){var n=e.prev,a=e,o=e.next;if(three_module_area(n,a,o)>=0)return!1;// reflex, can\'t be an ear\n// triangle bbox; min & max are calculated like this for speed\nfor(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,c=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,l=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,h=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,u=zOrder(s,c,t,r,i),p=zOrder(l,h,t,r,i),d=e.nextZ\n// z-order range for the current triangle bbox;\n;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&three_module_area(d.prev,d,d.next)>=0)return!1;d=d.nextZ}\n// then look for points in decreasing z-order\nfor(d=e.prevZ;d&&d.z>=u;){if(d!==e.prev&&d!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&three_module_area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;!equals(n,a)&&intersects(n,i,i.next,a)&&locallyInside(n,a)&&locallyInside(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),\n// remove two nodes involved\nremoveNode(i),removeNode(i.next),i=e=a),i=i.next}while(i!==e);return i}\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(e,t,r,i,n,a){\n// look for a valid diagonal that divides the polygon into two\nvar o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){\n// split the polygon in two by the diagonal\nvar c=splitPolygon(o,s);\n// filter colinear points around the cuts\nreturn o=filterPoints(o,o.next),c=filterPoints(c,c.next),\n// run earcut on each half\nearcutLinked(o,t,r,i,n,a),void earcutLinked(c,t,r,i,n,a)}s=s.next}o=o.next}while(o!==e)}function compareX(e,t){return e.x-t.x}\n// find a bridge between vertices that connects hole with an outer ring and and link it\nfunction eliminateHole(e,t){if(t=\n// David Eberly\'s algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(e,t){var r,i=t,n=e.x,a=e.y,o=-1/0;\n// find a segment intersected by a ray from the hole\'s leftmost point to the left;\n// segment\'s endpoint with lesser x will be potential connection point\ndo{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r.prev;// hole touches outer segment; pick lower endpoint\n// look for points inside the triangle of hole point, segment intersection and endpoint;\n// if there are no points found, we have a valid connection;\n// otherwise choose the point of the minimum angle with the ray as connection point\nvar c,l=r,h=r.x,u=r.y,p=1/0;i=r.next;for(;i!==l;)n>=i.x&&i.x>=h&&n!==i.x&&pointInTriangle(a<u?n:o,a,h,u,a<u?o:n,a,i.x,i.y)&&((c=Math.abs(a-i.y)/(n-i.x))<p||c===p&&i.x>r.x)&&locallyInside(i,e)&&(r=i,p=c),i=i.next;return r}(e,t)){var r=splitPolygon(t,e);filterPoints(r,r.next)}}function zOrder(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((\n// coords are transformed into non-negative 15-bit integer range\ne=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}\n// find the leftmost node of a polygon ring\nfunction getLeftmost(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}\n// check if a point lies within a convex triangle\nfunction pointInTriangle(e,t,r,i,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}\n// check if a polygon diagonal is locally inside the polygon\n(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\n(e,t)}\n// signed area of a triangle\nfunction three_module_area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}\n// check if two points are equal\nfunction equals(e,t){return e.x===t.x&&e.y===t.y}\n// check if two segments intersect\nfunction intersects(e,t,r,i){return!!(equals(e,t)&&equals(r,i)||equals(e,i)&&equals(r,t))||three_module_area(e,t,r)>0!=three_module_area(e,t,i)>0&&three_module_area(r,i,e)>0!=three_module_area(r,i,t)>0}function locallyInside(e,t){return three_module_area(e.prev,e,e.next)<0?three_module_area(e,t,e.next)>=0&&three_module_area(e,e.prev,t)>=0:three_module_area(e,t,e.prev)<0||three_module_area(e,e.next,t)<0}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),i=new Node(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(e,t,r,i){var n=new Node(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){\n// vertice index in coordinates array\nthis.i=e,\n// vertex coordinates\nthis.x=t,this.y=r,\n// previous and next vertice nodes in a polygon ring\nthis.prev=null,this.next=null,\n// z-order curve value\nthis.z=null,\n// previous and next nodes in z-order\nthis.prevZ=null,this.nextZ=null,\n// indicates whether this is a steiner point\nthis.steiner=!1}var Xt={\n// calculate area of the contour polygon\narea:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},isClockWise:function(e){return Xt.area(e)<0},triangulateShape:function(e,t){var r=[],i=[],n=[];// flat array of vertices like [ x0,y0, x1,y1, x2,y2, ... ]\n// final array of vertex indices like [ [ a,b,d ], [ b,c,d ] ]\nremoveDupEndPts(e),addContour(r,e);\n//\nvar a=e.length;t.forEach(removeDupEndPts);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,addContour(r,t[o]);\n//\nvar s=Wt(r,i);\n//\nfor(o=0;o<s.length;o+=3)n.push(s.slice(o,o+3));return n}};function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n *\n * Creates extruded geometry from a path shape.\n *\n * parameters = {\n *\n *  curveSegments: <int>, // number of points on the curves\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segments of extrude spline too\n *  depth: <float>, // Depth to extrude the shape\n *\n *  bevelEnabled: <bool>, // turn on bevel\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\n *  bevelSize: <float>, // how far from shape outline is bevel\n *  bevelSegments: <int>, // number of bevel layers\n *\n *  extrudePath: <THREE.Curve> // curve to extrude shape along\n *\n *  UVGenerator: <Object> // object that provides UV generator functions\n *\n * }\n */\n// ExtrudeGeometry\nfunction ExtrudeGeometry(e,t){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}\n// ExtrudeBufferGeometry\nfunction ExtrudeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var r=this,i=[],n=[],a=0,o=(e=Array.isArray(e)?e:[e]).length;a<o;a++){addShape(e[a])}\n// build geometry\n// functions\nfunction addShape(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,c=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,u=void 0!==t.bevelSize?t.bevelSize:h-2,p=void 0!==t.bevelSegments?t.bevelSegments:3,d=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:qt;\n// options\n// deprecated options\nvoid 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);\n//\nvar m,g,y,x,b,_,M,w,T=!1;d&&(m=d.getSpacedPoints(s),T=!0,l=!1,// bevels not supported for path extrusion\n// SETUP TNB variables\n// TODO1 - have a .isClosed in spline?\ng=d.computeFrenetFrames(s,!1),\n// console.log(splineTube, \'splineTube\', splineTube.normals.length, \'steps\', steps, \'extrudePts\', extrudePts.length);\ny=new Vector3,x=new Vector3,b=new Vector3),\n// Safeguards if bevels are not enabled\nl||(p=0,h=0,u=0);// looping of holes\nvar E=e.extractPoints(o),S=E.shape,L=E.holes;if(!Xt.isClockWise(S))\n// Maybe we should also check if holes are in the opposite direction, just to be safe ...\nfor(S=S.reverse(),M=0,w=L.length;M<w;M++)_=L[M],Xt.isClockWise(_)&&(L[M]=_.reverse());var A=Xt.triangulateShape(S,L),C=S;\n/* Vertices */ // vertices has all points but contour has only points of circumference\nfor(M=0,w=L.length;M<w;M++)_=L[M],S=S.concat(_);function scalePt2(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var P,R,B,O,I,D,G=S.length,V=A.length;\n// Find directions for point movement\nfunction getBevelVec(e,t,r){\n// computes for inPt the corresponding point inPt\' on a new contour\n//   shifted by 1 unit (length of normalized vector) to the left\n// if we walk along contour clockwise, this new contour is outside the old one\n//\n// inPt\' is the intersection of the two lines parallel to the two\n//  adjacent edges of inPt at a distance of 1 unit on the left side.\nvar i,n,a,o=e.x-t.x,s=e.y-t.y,c=r.x-e.x,l=r.y-e.y,h=o*o+s*s,u=o*l-s*c;// resulting translation vector for inPt\n// good reading for geometry algorithms (here: line-line intersection)\n// http://geomalgorithms.com/a05-_intersect-1.html\nif(Math.abs(u)>Number.EPSILON){\n// not collinear\n// length of vectors for normalizing\nvar p=Math.sqrt(h),d=Math.sqrt(c*c+l*l),f=t.x-s/p,m=t.y+o/p,g=((r.x-l/d-f)*l-(r.y+c/d-m)*c)/(o*l-s*c),v=(\n// vector from inPt to intersection point\ni=f+o*g-e.x)*i+(n=m+s*g-e.y)*n;if(v<=2)return new Vector2(i,n);a=Math.sqrt(v/2)}else{\n// handle special case of collinear edges\nvar y=!1;// assumes: opposite\no>Number.EPSILON?c>Number.EPSILON&&(y=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(\n// console.log("Warning: lines are a straight sequence");\ni=-s,n=o,a=Math.sqrt(h)):(\n// console.log("Warning: lines are a straight spike");\ni=o,n=s,a=Math.sqrt(h/2))}return new Vector2(i/a,n/a)}for(var N=[],U=0,F=C.length,z=F-1,H=U+1;U<F;U++,z++,H++)z===F&&(z=0),H===F&&(H=0),\n//  (j)---(i)---(k)\n// console.log(\'i,j,k\', i, j , k)\nN[U]=getBevelVec(C[U],C[z],C[H]);var k,j,W=[],X=N.concat();for(M=0,w=L.length;M<w;M++){for(_=L[M],k=[],U=0,z=(F=_.length)-1,H=U+1;U<F;U++,z++,H++)z===F&&(z=0),H===F&&(H=0),\n//  (j)---(i)---(k)\nk[U]=getBevelVec(_[U],_[z],_[H]);W.push(k),X=X.concat(k)}\n// Loop bevelSegments, 1 for the front, 1 for the back\nfor(P=0;P<p;P++){\n// contract shape\nfor(\n//for ( b = bevelSegments; b > 0; b -- ) {\nB=P/p,O=h*Math.cos(B*Math.PI/2),R=u*Math.sin(B*Math.PI/2),U=0,F=C.length;U<F;U++)v((I=scalePt2(C[U],N[U],R)).x,I.y,-O);\n// expand holes\nfor(M=0,w=L.length;M<w;M++)for(_=L[M],k=W[M],U=0,F=_.length;U<F;U++)v((I=scalePt2(_[U],k[U],R)).x,I.y,-O)}\n// Back facing vertices\nfor(R=u,U=0;U<G;U++)I=l?scalePt2(S[U],X[U],R):S[U],T?(\n// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\nx.copy(g.normals[0]).multiplyScalar(I.x),y.copy(g.binormals[0]).multiplyScalar(I.y),b.copy(m[0]).add(x).add(y),v(b.x,b.y,b.z)):v(I.x,I.y,0);\n// Add stepped vertices...\n// Including front facing vertices\nfor(j=1;j<=s;j++)for(U=0;U<G;U++)I=l?scalePt2(S[U],X[U],R):S[U],T?(\n// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\nx.copy(g.normals[j]).multiplyScalar(I.x),y.copy(g.binormals[j]).multiplyScalar(I.y),b.copy(m[j]).add(x).add(y),v(b.x,b.y,b.z)):v(I.x,I.y,c/s*j);\n// Add bevel segments planes\n//for ( b = 1; b <= bevelSegments; b ++ ) {\nfor(P=p-1;P>=0;P--){\n// contract shape\nfor(B=P/p,O=h*Math.cos(B*Math.PI/2),R=u*Math.sin(B*Math.PI/2),U=0,F=C.length;U<F;U++)v((I=scalePt2(C[U],N[U],R)).x,I.y,c+O);\n// expand holes\nfor(M=0,w=L.length;M<w;M++)for(_=L[M],k=W[M],U=0,F=_.length;U<F;U++)I=scalePt2(_[U],k[U],R),T?v(I.x,I.y+m[s-1].y,m[s-1].x+O):v(I.x,I.y,c+O)}\n/* Faces */\n// Top and bottom faces\nfunction sidewalls(e,t){var r,i;for(U=e.length;--U>=0;){r=U,(i=U-1)<0&&(i=e.length-1);\n//console.log(\'b\', i,j, i-1, k,vertices.length);\nvar n=0,a=s+2*p;for(n=0;n<a;n++){var o=G*n,c=G*(n+1);f4(t+r+o,t+i+o,t+i+c,t+r+c)}}}function v(e,t,r){a.push(e),a.push(t),a.push(r)}function f3(e,t,n){addVertex(e),addVertex(t),addVertex(n);var a=i.length/3,o=f.generateTopUV(r,i,a-3,a-2,a-1);addUV(o[0]),addUV(o[1]),addUV(o[2])}function f4(e,t,n,a){addVertex(e),addVertex(t),addVertex(a),addVertex(t),addVertex(n),addVertex(a);var o=i.length/3,s=f.generateSideWallUV(r,i,o-6,o-3,o-2,o-1);addUV(s[0]),addUV(s[1]),addUV(s[3]),addUV(s[1]),addUV(s[2]),addUV(s[3])}function addVertex(e){i.push(a[3*e+0]),i.push(a[3*e+1]),i.push(a[3*e+2])}function addUV(e){n.push(e.x),n.push(e.y)}!\n/////  Internal functions\nfunction buildLidFaces(){var e=i.length/3;if(l){var t=0,n=G*t;// steps + 1\n// Bottom faces\nfor(U=0;U<V;U++)f3((D=A[U])[2]+n,D[1]+n,D[0]+n);\n// Top faces\nfor(n=G*(t=s+2*p),U=0;U<V;U++)f3((D=A[U])[0]+n,D[1]+n,D[2]+n)}else{\n// Bottom faces\nfor(U=0;U<V;U++)f3((D=A[U])[2],D[1],D[0]);\n// Top faces\nfor(U=0;U<V;U++)f3((D=A[U])[0]+G*s,D[1]+G*s,D[2]+G*s)}r.addGroup(e,i.length/3-e,0)}\n// Create faces for the z-sides of the shape\n(),\n// Sides faces\nfunction buildSideFaces(){var e=i.length/3,t=0;for(sidewalls(C,t),t+=C.length,M=0,w=L.length;M<w;M++)sidewalls(_=L[M],t),\n//, true\nt+=_.length;r.addGroup(e,i.length/3-e,1)}()}this.addAttribute("position",new Float32BufferAttribute(i,3)),this.addAttribute("uv",new Float32BufferAttribute(n,2)),this.computeVertexNormals()}ExtrudeGeometry.prototype=Object.create(Geometry.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,e)},ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,e)};\n//\nvar qt={generateTopUV:function(e,t,r,i,n){var a=t[3*r],o=t[3*r+1],s=t[3*i],c=t[3*i+1],l=t[3*n],h=t[3*n+1];return[new Vector2(a,o),new Vector2(s,c),new Vector2(l,h)]},generateSideWallUV:function(e,t,r,i,n,a){var o=t[3*r],s=t[3*r+1],c=t[3*r+2],l=t[3*i],h=t[3*i+1],u=t[3*i+2],p=t[3*n],d=t[3*n+1],f=t[3*n+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-h)<.01?[new Vector2(o,1-c),new Vector2(l,1-u),new Vector2(p,1-f),new Vector2(m,1-v)]:[new Vector2(s,1-c),new Vector2(h,1-u),new Vector2(d,1-f),new Vector2(g,1-v)]}};function toJSON(e,t,r){if(\n//\nr.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++){var a=e[i];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);\n//\nreturn void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * @author alteredq / http://alteredqualia.com/\n *\n * Text = 3D Text\n *\n * parameters = {\n *  font: <THREE.Font>, // font\n *\n *  size: <float>, // size of the text\n *  height: <float>, // thickness to extrude text\n *  curveSegments: <int>, // number of points on the curves\n *\n *  bevelEnabled: <bool>, // turn on bevel\n *  bevelThickness: <float>, // how deep into text bevel goes\n *  bevelSize: <float> // how far from text outline is bevel\n * }\n */\n// TextGeometry\nfunction TextGeometry(e,t){Geometry.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new TextBufferGeometry(e,t)),this.mergeVertices()}\n// TextBufferGeometry\nfunction TextBufferGeometry(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var i=r.generateShapes(e,t.size);\n// translate parameters to ExtrudeGeometry API\nt.depth=void 0!==t.height?t.height:50,\n// defaults\nvoid 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,i,t),this.type="TextBufferGeometry"}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author benaadams / https://twitter.com/ben_a_adams\n * @author Mugen87 / https://github.com/Mugen87\n */\n// SphereGeometry\nfunction SphereGeometry(e,t,r,i,n,a,o){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new SphereBufferGeometry(e,t,r,i,n,a,o)),this.mergeVertices()}\n// SphereBufferGeometry\nfunction SphereBufferGeometry(e,t,r,i,n,a,o){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var s,c,l=(a=void 0!==a?a:0)+(o=void 0!==o?o:Math.PI),h=0,u=[],p=new Vector3,d=new Vector3,f=[],m=[],g=[],v=[];\n// generate vertices, normals and uvs\nfor(c=0;c<=r;c++){var y=[],x=c/r;for(s=0;s<=t;s++){var b=s/t;\n// vertex\np.x=-e*Math.cos(i+b*n)*Math.sin(a+x*o),p.y=e*Math.cos(a+x*o),p.z=e*Math.sin(i+b*n)*Math.sin(a+x*o),m.push(p.x,p.y,p.z),\n// normal\nd.set(p.x,p.y,p.z).normalize(),g.push(d.x,d.y,d.z),\n// uv\nv.push(b,1-x),y.push(h++)}u.push(y)}\n// indices\nfor(c=0;c<r;c++)for(s=0;s<t;s++){var _=u[c][s+1],M=u[c][s],w=u[c+1][s],T=u[c+1][s+1];(0!==c||a>0)&&f.push(_,M,T),(c!==r-1||l<Math.PI)&&f.push(M,w,T)}\n// build geometry\nthis.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(v,2))}\n/**\n * @author Kaleb Murphy\n * @author Mugen87 / https://github.com/Mugen87\n */\n// RingGeometry\nfunction RingGeometry(e,t,r,i,n,a){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new RingBufferGeometry(e,t,r,i,n,a)),this.mergeVertices()}\n// RingBufferGeometry\nfunction RingBufferGeometry(e,t,r,i,n,a){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},e=e||.5,t=t||1,n=void 0!==n?n:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;\n// buffers\nvar o,s,c,l=[],h=[],u=[],p=[],d=e,f=(t-e)/(i=void 0!==i?Math.max(1,i):1),m=new Vector3,g=new Vector2;\n// generate vertices, normals and uvs\nfor(s=0;s<=i;s++){for(c=0;c<=r;c++)\n// values are generate from the inside of the ring to the outside\no=n+c/r*a,\n// vertex\nm.x=d*Math.cos(o),m.y=d*Math.sin(o),h.push(m.x,m.y,m.z),\n// normal\nu.push(0,0,1),\n// uv\ng.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,p.push(g.x,g.y);\n// increase the radius for next row of vertices\nd+=f}\n// indices\nfor(s=0;s<i;s++){var v=s*(r+1);for(c=0;c<r;c++){var y=o=c+v,x=o+r+1,b=o+r+2,_=o+1;\n// faces\nl.push(y,x,_),l.push(x,b,_)}}\n// build geometry\nthis.setIndex(l),this.addAttribute("position",new Float32BufferAttribute(h,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(p,2))}\n/**\n * @author zz85 / https://github.com/zz85\n * @author bhouston / http://clara.io\n * @author Mugen87 / https://github.com/Mugen87\n */\n// LatheGeometry\nfunction LatheGeometry(e,t,r,i){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new LatheBufferGeometry(e,t,r,i)),this.mergeVertices()}\n// LatheBufferGeometry\nfunction LatheBufferGeometry(e,t,r,i){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t)||12,r=r||0,i=i||2*Math.PI,\n// clamp phiLength so it\'s in range of [ 0, 2PI ]\ni=_t.clamp(i,0,2*Math.PI);\n// buffers\nvar n,a,o,s=[],c=[],l=[],h=1/t,u=new Vector3,p=new Vector2;\n// generate vertices and uvs\nfor(a=0;a<=t;a++){var d=r+a*h*i,f=Math.sin(d),m=Math.cos(d);for(o=0;o<=e.length-1;o++)\n// vertex\nu.x=e[o].x*f,u.y=e[o].y,u.z=e[o].x*m,c.push(u.x,u.y,u.z),\n// uv\np.x=a/t,p.y=o/(e.length-1),l.push(p.x,p.y)}\n// indices\nfor(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var g=n=o+a*e.length,v=n+e.length,y=n+e.length+1,x=n+1;\n// faces\ns.push(g,v,x),s.push(v,y,x)}\n// build geometry\n// if the geometry is closed, we need to average the normals along the seam.\n// because the corresponding vertices are identical (but still have different UVs).\nif(this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(l,2)),\n// generate normals\nthis.computeVertexNormals(),i===2*Math.PI){var b=this.attributes.normal.array,_=new Vector3,M=new Vector3,w=new Vector3;for(\n// this is the buffer offset for the last line of vertices\nn=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)\n// select the normal of the vertex in the first line\n_.x=b[o+0],_.y=b[o+1],_.z=b[o+2],\n// select the normal of the vertex in the last line\nM.x=b[n+o+0],M.y=b[n+o+1],M.z=b[n+o+2],\n// average normals\nw.addVectors(_,M).normalize(),\n// assign the new values to both normals\nb[o+0]=b[n+o+0]=w.x,b[o+1]=b[n+o+1]=w.y,b[o+2]=b[n+o+2]=w.z}}\n/**\n * @author jonobr1 / http://jonobr1.com\n * @author Mugen87 / https://github.com/Mugen87\n */\n// ShapeGeometry\nfunction ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}\n// ShapeBufferGeometry\nfunction ShapeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;\n// buffers\nvar r=[],i=[],n=[],a=[],o=0,s=0;\n// allow single and array values for "shapes" parameter\nif(!1===Array.isArray(e))addShape(e);else for(var c=0;c<e.length;c++)addShape(e[c]),this.addGroup(o,s,c),// enables MultiMaterial support\no+=s,s=0;\n// build geometry\n// helper functions\nfunction addShape(e){var o,c,l,h=i.length/3,u=e.extractPoints(t),p=u.shape,d=u.holes;\n// check direction of vertices\nif(!1===Xt.isClockWise(p))\n// also check if holes are in the opposite direction\nfor(p=p.reverse(),o=0,c=d.length;o<c;o++)l=d[o],!0===Xt.isClockWise(l)&&(d[o]=l.reverse());var f=Xt.triangulateShape(p,d);\n// join vertices of inner and outer paths to a single array\nfor(o=0,c=d.length;o<c;o++)l=d[o],p=p.concat(l);\n// vertices, normals, uvs\nfor(o=0,c=p.length;o<c;o++){var m=p[o];i.push(m.x,m.y,0),n.push(0,0,1),a.push(m.x,m.y)}\n// incides\nfor(o=0,c=f.length;o<c;o++){var g=f[o],v=g[0]+h,y=g[1]+h,x=g[2]+h;r.push(v,y,x),s+=3}}this.setIndex(r),this.addAttribute("position",new Float32BufferAttribute(i,3)),this.addAttribute("normal",new Float32BufferAttribute(n,3)),this.addAttribute("uv",new Float32BufferAttribute(a,2))}\n//\nfunction toJSON$1(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var n=e[r];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}\n/**\n * @author WestLangley / http://github.com/WestLangley\n * @author Mugen87 / https://github.com/Mugen87\n */function EdgesGeometry(e,t){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;\n// buffer\nvar r,i,n,a,o=[],s=Math.cos(_t.DEG2RAD*t),c=[0,0],l={},h=["a","b","c"];\n// helper variables\ne.isBufferGeometry?(a=new Geometry).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();\n// now create a data structure where each entry represents an edge with its adjoining faces\nfor(var u=a.vertices,p=a.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)r=m[h[g]],i=m[h[(g+1)%3]],c[0]=Math.min(r,i),c[1]=Math.max(r,i),void 0===l[n=c[0]+","+c[1]]?l[n]={index1:c[0],index2:c[1],face1:d,face2:void 0}:l[n].face2=d;\n// generate vertices\nfor(n in l){var v=l[n];\n// an edge is only rendered if the angle (in degrees) between the face normals of the adjoining faces exceeds this value. default = 1 degree.\nif(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=u[v.index1];o.push(y.x,y.y,y.z),y=u[v.index2],o.push(y.x,y.y,y.z)}}\n// build geometry\nthis.addAttribute("position",new Float32BufferAttribute(o,3))}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n// CylinderGeometry\nfunction CylinderGeometry(e,t,r,i,n,a,o,s){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,r,i,n,a,o,s)),this.mergeVertices()}\n// CylinderBufferGeometry\nfunction CylinderBufferGeometry(e,t,r,i,n,a,o,s){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};var c=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,i=Math.floor(i)||8,n=Math.floor(n)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;\n// buffers\nvar l=[],h=[],u=[],p=[],d=0,f=[],m=r/2,g=0;function generateCap(r){var n,a,f,v=new Vector2,y=new Vector3,x=0,b=!0===r?e:t,_=!0===r?1:-1;\n// first we generate the center vertex data of the cap.\n// because the geometry needs one set of uvs per face,\n// we must generate a center vertex per face/segment\nfor(\n// save the index of the first center vertex\na=d,n=1;n<=i;n++)\n// vertex\nh.push(0,m*_,0),\n// normal\nu.push(0,_,0),\n// uv\np.push(.5,.5),\n// increase index\nd++;\n// save the index of the last center vertex\n// now we generate the surrounding vertices, normals and uvs\nfor(f=d,n=0;n<=i;n++){var M=n/i*s+o,w=Math.cos(M),T=Math.sin(M);\n// vertex\ny.x=b*T,y.y=m*_,y.z=b*w,h.push(y.x,y.y,y.z),\n// normal\nu.push(0,_,0),\n// uv\nv.x=.5*w+.5,v.y=.5*T*_+.5,p.push(v.x,v.y),\n// increase index\nd++}\n// generate indices\nfor(n=0;n<i;n++){var E=a+n,S=f+n;!0===r?\n// face top\nl.push(S,S+1,E):\n// face bottom\nl.push(S+1,S,E),x+=3}\n// add a group to the geometry. this will ensure multi material support\nc.addGroup(g,x,!0===r?1:2),\n// calculate new start value for groups\ng+=x}\n// generate geometry\n!function generateTorso(){var a,v,y=new Vector3,x=new Vector3,b=0,_=(t-e)/r;\n// generate vertices, normals and uvs\nfor(v=0;v<=n;v++){var M=[],w=v/n,T=w*(t-e)+e;for(a=0;a<=i;a++){var E=a/i,S=E*s+o,L=Math.sin(S),A=Math.cos(S);\n// vertex\nx.x=T*L,x.y=-w*r+m,x.z=T*A,h.push(x.x,x.y,x.z),\n// normal\ny.set(L,_,A).normalize(),u.push(y.x,y.y,y.z),\n// uv\np.push(E,1-w),\n// save index of vertex in respective row\nM.push(d++)}\n// now save vertices of the row in our index array\nf.push(M)}\n// generate indices\nfor(a=0;a<i;a++)for(v=0;v<n;v++){\n// we use the index array to access the correct indices\nvar C=f[v][a],P=f[v+1][a],R=f[v+1][a+1],B=f[v][a+1];\n// faces\nl.push(C,P,B),l.push(P,R,B),\n// update group counter\nb+=6}\n// add a group to the geometry. this will ensure multi material support\nc.addGroup(g,b,0),\n// calculate new start value for groups\ng+=b}(),!1===a&&(e>0&&generateCap(!0),t>0&&generateCap(!1)),\n// build geometry\nthis.setIndex(l),this.addAttribute("position",new Float32BufferAttribute(h,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(p,2))}\n/**\n * @author abelnation / http://github.com/abelnation\n */\n// ConeGeometry\nfunction ConeGeometry(e,t,r,i,n,a,o){CylinderGeometry.call(this,0,e,t,r,i,n,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}\n// ConeBufferGeometry\nfunction ConeBufferGeometry(e,t,r,i,n,a,o){CylinderBufferGeometry.call(this,0,e,t,r,i,n,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}\n/**\n * @author benaadams / https://twitter.com/ben_a_adams\n * @author Mugen87 / https://github.com/Mugen87\n * @author hughes\n */\n// CircleGeometry\nfunction CircleGeometry(e,t,r,i){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new CircleBufferGeometry(e,t,r,i)),this.mergeVertices()}\n// CircleBufferGeometry\nfunction CircleBufferGeometry(e,t,r,i){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;\n// buffers\nvar n,a,o=[],s=[],c=[],l=[],h=new Vector3,u=new Vector2;for(\n// center point\ns.push(0,0,0),c.push(0,0,1),l.push(.5,.5),a=0,n=3;a<=t;a++,n+=3){var p=r+a/t*i;\n// vertex\nh.x=e*Math.cos(p),h.y=e*Math.sin(p),s.push(h.x,h.y,h.z),\n// normal\nc.push(0,0,1),\n// uvs\nu.x=(s[n]/e+1)/2,u.y=(s[n+1]/e+1)/2,l.push(u.x,u.y)}\n// indices\nfor(n=1;n<=t;n++)o.push(n,n+1,0);\n// build geometry\nthis.setIndex(o),this.addAttribute("position",new Float32BufferAttribute(s,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(l,2))}TextGeometry.prototype=Object.create(Geometry.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,SphereGeometry.prototype=Object.create(Geometry.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry,RingGeometry.prototype=Object.create(Geometry.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,LatheGeometry.prototype=Object.create(Geometry.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,e)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,e)},EdgesGeometry.prototype=Object.create(BufferGeometry.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,CylinderGeometry.prototype=Object.create(Geometry.prototype),CylinderGeometry.prototype.constructor=CylinderGeometry,CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry,ConeGeometry.prototype=Object.create(CylinderGeometry.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,CircleGeometry.prototype=Object.create(Geometry.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var Yt=/* */Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});\n/**\n * @author mrdoob / http://mrdoob.com/\n *\n * parameters = {\n *  color: <THREE.Color>\n * }\n */function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}\n/**\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *  color: <hex>,\n *  roughness: <float>,\n *  metalness: <float>,\n *  opacity: <float>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  lightMap: new THREE.Texture( <Image> ),\n *  lightMapIntensity: <float>\n *\n *  aoMap: new THREE.Texture( <Image> ),\n *  aoMapIntensity: <float>\n *\n *  emissive: <hex>,\n *  emissiveIntensity: <float>\n *  emissiveMap: new THREE.Texture( <Image> ),\n *\n *  bumpMap: new THREE.Texture( <Image> ),\n *  bumpScale: <float>,\n *\n *  normalMap: new THREE.Texture( <Image> ),\n *  normalMapType: THREE.TangentSpaceNormalMap,\n *  normalScale: <Vector2>,\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>,\n *\n *  roughnessMap: new THREE.Texture( <Image> ),\n *\n *  metalnessMap: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\n *  envMapIntensity: <float>\n *\n *  refractionRatio: <float>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\nfunction MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),// diffuse\nthis.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}\n/**\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *  reflectivity: <float>\n * }\n */\nfunction MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,// maps to F0 = 0.04\nthis.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  specular: <hex>,\n *  shininess: <float>,\n *  opacity: <float>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  lightMap: new THREE.Texture( <Image> ),\n *  lightMapIntensity: <float>\n *\n *  aoMap: new THREE.Texture( <Image> ),\n *  aoMapIntensity: <float>\n *\n *  emissive: <hex>,\n *  emissiveIntensity: <float>\n *  emissiveMap: new THREE.Texture( <Image> ),\n *\n *  bumpMap: new THREE.Texture( <Image> ),\n *  bumpScale: <float>,\n *\n *  normalMap: new THREE.Texture( <Image> ),\n *  normalMapType: THREE.TangentSpaceNormalMap,\n *  normalScale: <Vector2>,\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>,\n *\n *  specularMap: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\n *  combine: THREE.Multiply,\n *  reflectivity: <float>,\n *  refractionRatio: <float>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\nfunction MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),// diffuse\nthis.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}\n/**\n * @author takahirox / http://github.com/takahirox\n *\n * parameters = {\n *  gradientMap: new THREE.Texture( <Image> )\n * }\n */\nfunction MeshToonMaterial(e){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *  opacity: <float>,\n *\n *  bumpMap: new THREE.Texture( <Image> ),\n *  bumpScale: <float>,\n *\n *  normalMap: new THREE.Texture( <Image> ),\n *  normalMapType: THREE.TangentSpaceNormalMap,\n *  normalScale: <Vector2>,\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\nfunction MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  lightMap: new THREE.Texture( <Image> ),\n *  lightMapIntensity: <float>\n *\n *  aoMap: new THREE.Texture( <Image> ),\n *  aoMapIntensity: <float>\n *\n *  emissive: <hex>,\n *  emissiveIntensity: <float>\n *  emissiveMap: new THREE.Texture( <Image> ),\n *\n *  specularMap: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\n *  combine: THREE.Multiply,\n *  reflectivity: <float>,\n *  refractionRatio: <float>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\nfunction MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),// diffuse\nthis.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}\n/**\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *\n *  matcap: new THREE.Texture( <Image> ),\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  bumpMap: new THREE.Texture( <Image> ),\n *  bumpScale: <float>,\n *\n *  normalMap: new THREE.Texture( <Image> ),\n *  normalMapType: THREE.TangentSpaceNormalMap,\n *  normalScale: <Vector2>,\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>,\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\nfunction MeshMatcapMaterial(e){\n// a matcap is required\nif(Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),// diffuse\nthis.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xt,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e),null===this.matcap){var t=document.createElement("canvas");t.width=1,t.height=1;var r=t.getContext("2d");r.fillStyle="#fff",r.fillRect(0,0,1,1),this.matcap=new THREE.CanvasTexture(t)}}\n/**\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *\n *  linewidth: <float>,\n *\n *  scale: <float>,\n *  dashSize: <float>,\n *  gapSize: <float>\n * }\n */\nfunction LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(e){return MeshPhongMaterial.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Jt=/* */Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),Zt={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(\n// console.log( \'THREE.Cache\', \'Adding key:\', key );\nthis.files[e]=t)},get:function(e){if(!1!==this.enabled)\n// console.log( \'THREE.Cache\', \'Checking key:\', key );\nreturn this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction LoadingManager(e,t,r){var i=this,n=!1,a=0,o=0,s=void 0;\n// Refer to #5689 for the reason why we don\'t set .onStart\n// in the constructor\nthis.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===n&&void 0!==i.onStart&&i.onStart(e,a,o),n=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Qt=new LoadingManager,Kt={};\n/**\n * @author mrdoob / http://mrdoob.com/\n */function FileLoader(e){this.manager=void 0!==e?e:Qt}\n/**\n * @author Nikos M. / https://github.com/foo123/\n *\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\n */\nfunction DataTextureLoader(e){this.manager=void 0!==e?e:Qt,\n// override in sub classes\nthis._parser=null}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction ImageLoader(e){this.manager=void 0!==e?e:Qt}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction CubeTextureLoader(e){this.manager=void 0!==e?e:Qt}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction TextureLoader(e){this.manager=void 0!==e?e:Qt}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * Extensible curve object\n *\n * Some common of curve methods:\n * .getPoint( t, optionalTarget ), .getTangent( t )\n * .getPointAt( u, optionalTarget ), .getTangentAt( u )\n * .getPoints(), .getSpacedPoints()\n * .getLength()\n * .updateArcLengths()\n *\n * This following curves inherit from THREE.Curve:\n *\n * -- 2D curves --\n * THREE.ArcCurve\n * THREE.CubicBezierCurve\n * THREE.EllipseCurve\n * THREE.LineCurve\n * THREE.QuadraticBezierCurve\n * THREE.SplineCurve\n *\n * -- 3D curves --\n * THREE.CatmullRomCurve3\n * THREE.CubicBezierCurve3\n * THREE.LineCurve3\n * THREE.QuadraticBezierCurve3\n *\n * A series of curves can be represented as a THREE.CurvePath.\n *\n **/\n/**************************************************************\n *\tAbstract Curve base class\n **************************************************************/\nfunction Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(e,t,r,i,n,a,o,s){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ArcCurve(e,t,r,i,n,a){EllipseCurve.call(this,e,t,r,r,i,n,a),this.type="ArcCurve"}\n/**\n * @author zz85 https://github.com/zz85\n *\n * Centripetal CatmullRom Curve - which is useful for avoiding\n * cusps and self-intersections in non-uniform catmull rom curves.\n * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\n *\n * curve.type accepts centripetal(default), chordal and catmullrom\n * curve.tension is used for catmullrom which defaults to 0.5\n */\n/*\nBased on an optimized c++ solution in\n - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/\n - http://ideone.com/NoEbVM\n\nThis CubicPoly class could be used for reusing some variables and calculations,\nbut for three.js curve use, it could be possible inlined and flatten into a single function call\nwhich can be placed in CurveUtils.\n*/\nfunction CubicPoly(){var e=0,t=0,r=0,i=0;\n/*\n\t * Compute coefficients for a cubic polynomial\n\t *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3\n\t * such that\n\t *   p(0) = x0, p(1) = x1\n\t *  and\n\t *   p\'(0) = t0, p\'(1) = t1.\n\t */function init(n,a,o,s){e=n,t=o,r=-3*n+3*a-2*o-s,i=2*n-2*a+o+s}return{initCatmullRom:function(e,t,r,i,n){init(t,r,n*(r-e),n*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,n,a,o){\n// compute tangents when parameterized in [t1,t2]\nvar s=(t-e)/n-(r-e)/(n+a)+(r-t)/a,c=(r-t)/a-(i-t)/(a+o)+(i-r)/o;init(t,r,\n// rescale tangents for parametrization in [0,1]\ns*=a,c*=a)},calc:function(n){var a=n*n;return e+t*n+r*a+i*(a*n)}}}\n//\nObject.assign(FileLoader.prototype,{load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,a=Zt.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout(function(){t&&t(a),n.manager.itemEnd(e)},0),a;\n// Check if request is duplicate\nif(void 0===Kt[e]){\n// Check for data: URI\nvar o=e.match(/^data:(.*?)(;base64)?,(.*)$/);\n// Safari can not handle Data URIs through XMLHttpRequest so process manually\nif(o){var s=o[1],c=!!o[2],l=o[3];l=window.decodeURIComponent(l),c&&(l=window.atob(l));try{var h,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var p=new Uint8Array(l.length),d=0;d<l.length;d++)p[d]=l.charCodeAt(d);h="blob"===u?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;h=f.parseFromString(l,s);break;case"json":h=JSON.parse(l);break;default:// \'text\' or other\nh=l}\n// Wait for next browser tick like standard XMLHttpRequest event dispatching does\nwindow.setTimeout(function(){t&&t(h),n.manager.itemEnd(e)},0)}catch(t){\n// Wait for next browser tick like standard XMLHttpRequest event dispatching does\nwindow.setTimeout(function(){i&&i(t),n.manager.itemEnd(e),n.manager.itemError(e)},0)}}else{\n// Initialise array for duplicate requests\nKt[e]=[],Kt[e].push({onLoad:t,onProgress:r,onError:i});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;Zt.add(e,r);var i=Kt[e];if(delete Kt[e],200===this.status||0===this.status){\n// Some browsers return HTTP Status 0 when using non-http protocol\n// e.g. \'file://\' or \'data://\'. Handle as success.\n0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=i.length;a<o;a++){(s=i[a]).onLoad&&s.onLoad(r)}n.manager.itemEnd(e)}else{for(a=0,o=i.length;a<o;a++){var s;(s=i[a]).onError&&s.onError(t)}n.manager.itemEnd(e),n.manager.itemError(e)}},!1),m.addEventListener("progress",function(t){for(var r=Kt[e],i=0,n=r.length;i<n;i++){var a=r[i];a.onProgress&&a.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Kt[e];delete Kt[e];for(var i=0,a=r.length;i<a;i++){var o=r[i];o.onError&&o.onError(t)}n.manager.itemEnd(e),n.manager.itemError(e)},!1),m.addEventListener("abort",function(t){var r=Kt[e];delete Kt[e];for(var i=0,a=r.length;i<a;i++){var o=r[i];o.onError&&o.onError(t)}n.manager.itemEnd(e),n.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return n.manager.itemStart(e),m}Kt[e].push({onLoad:t,onProgress:r,onError:i})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(\n/**\n * @author mrdoob / http://mrdoob.com/\n *\n * Abstract Base class to block based textures loader (dds, pvr, ...)\n */\nfunction CompressedTextureLoader(e){this.manager=void 0!==e?e:Qt,\n// override in sub classes\nthis._parser=null}.prototype,{load:function(e,t,r,i){var n=this,a=[],o=new CompressedTexture;o.image=a;var s=new FileLoader(this.manager);function loadTexture(l){s.load(e[l],function(e){var r=n._parser(e,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(o.minFilter=de),o.format=r.format,o.needsUpdate=!0,t&&t(o))},r,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,l=0,h=e.length;l<h;++l)loadTexture(l);else\n// compressed cubemap texture stored in a single DDS file\ns.load(e,function(e){var r=n._parser(e,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var c=0;c<r.mipmapCount;c++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+c]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=de),o.format=r.format,o.needsUpdate=!0,t&&t(o)},r,i);return o},setPath:function(e){return this.path=e,this}}),Object.assign(DataTextureLoader.prototype,{load:function(e,t,r,i){var n=this,a=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.load(e,function(e){var r=n._parser(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:ce,a.wrapT=void 0!==r.wrapT?r.wrapT:ce,a.magFilter=void 0!==r.magFilter?r.magFilter:de,a.minFilter=void 0!==r.minFilter?r.minFilter:me,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=de),a.needsUpdate=!0,t&&t(a,r))},r,i),a}}),Object.assign(ImageLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,a=Zt.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout(function(){t&&t(a),n.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function onImageLoad(){o.removeEventListener("load",onImageLoad,!1),o.removeEventListener("error",onImageError,!1),Zt.add(e,this),t&&t(this),n.manager.itemEnd(e)}function onImageError(t){o.removeEventListener("load",onImageLoad,!1),o.removeEventListener("error",onImageError,!1),i&&i(t),n.manager.itemEnd(e),n.manager.itemError(e)}return o.addEventListener("load",onImageLoad,!1),o.addEventListener("error",onImageError,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(CubeTextureLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=new CubeTexture,a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function loadTexture(r){a.load(e[r],function(e){n.images[r]=e,6===++o&&(n.needsUpdate=!0,t&&t(n))},void 0,i)}for(var s=0;s<e.length;++s)loadTexture(s);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(TextureLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(r){n.image=r;\n// JPEGs can\'t have an alpha channel, so memory can be saved by storing them as RGB.\nvar i=e.search(/\\.jpe?g$/i)>0||0===e.search(/^data\\:image\\/jpeg/);n.format=i?Ce:Pe,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Curve.prototype,{\n// Virtual base class method to overwrite and implement in subclasses\n//\t- t [0 .. 1]\ngetPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},\n// Get point at relative position in curve according to arc length\n// - u [0 .. 1]\ngetPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},\n// Get sequence of points using getPoint( t )\ngetPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},\n// Get sequence of points using getPointAt( u )\ngetSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},\n// Get total curve arc length\ngetLength:function(){var e=this.getLengths();return e[e.length-1]},\n// Get list of cumulative segment lengths\ngetLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),a=0;for(i.push(0),r=1;r<=e;r++)a+=(t=this.getPoint(r/e)).distanceTo(n),i.push(a),n=t;return this.cacheArcLengths=i,i;// { sums: cache, sum: sum }; Sum is in the last element.\n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equidistant\ngetUtoTmapping:function(e,t){var r,i=this.getLengths(),n=0,a=i.length;// The targeted u distance value to get\nr=t||e*i[a-1];\n// binary search for the index with largest value smaller than target u distance\nfor(var o,s=0,c=a-1;s<=c;)if((// less likely to overflow, though probably not issue here, JS doesn\'t really have integers, all numbers are floats\no=i[n=Math.floor(s+(c-s)/2)]-r)<0)s=n+1;else{if(!(o>0)){c=n;break;\n// DONE\n}c=n-1}if(i[n=c]===r)return n/(a-1);\n// we could get finer grain at lengths, or use simple interpolation between two points\nvar l=i[n];return(n+(r-l)/(i[n+1]-l))/(a-1)},\n// Returns a unit vector tangent at t\n// In case any sub curve does not implement its tangent derivation,\n// 2 points a small delta apart will be used to find its gradient\n// which seems to give a reasonable approximation\ngetTangent:function(e){var t=e-1e-4,r=e+1e-4;\n// Capping in case of danger\nt<0&&(t=0),r>1&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){\n// see http://www.cs.indiana.edu/pub/techreports/TR425.pdf\nvar r,i,n,a=new Vector3,o=[],s=[],c=[],l=new Vector3,h=new Matrix4;\n// compute the tangent vectors for each segment on the curve\nfor(r=0;r<=e;r++)i=r/e,o[r]=this.getTangentAt(i),o[r].normalize();\n// select an initial normal vector perpendicular to the first tangent vector,\n// and in the direction of the minimum tangent xyz component\ns[0]=new Vector3,c[0]=new Vector3;var u=Number.MAX_VALUE,p=Math.abs(o[0].x),d=Math.abs(o[0].y),f=Math.abs(o[0].z);\n// compute the slowly-varying normal and binormal vectors for each segment on the curve\nfor(p<=u&&(u=p,a.set(1,0,0)),d<=u&&(u=d,a.set(0,1,0)),f<=u&&a.set(0,0,1),l.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],l),c[0].crossVectors(o[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),c[r]=c[r-1].clone(),l.crossVectors(o[r-1],o[r]),l.length()>Number.EPSILON&&(l.normalize(),n=Math.acos(_t.clamp(o[r-1].dot(o[r]),-1,1)),// clamp for floating pt errors\ns[r].applyMatrix4(h.makeRotationAxis(l,n))),c[r].crossVectors(o[r],s[r]);\n// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\nif(!0===t)for(n=Math.acos(_t.clamp(s[0].dot(s[e]),-1,1)),n/=e,o[0].dot(l.crossVectors(s[0],s[e]))>0&&(n=-n),r=1;r<=e;r++)\n// twist a little...\ns[r].applyMatrix4(h.makeRotationAxis(o[r],n*r)),c[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e,t){\n// ensures that deltaAngle is 0 .. 2 PI\nfor(var r=t||new Vector2,i=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=a?0:i),!0!==this.aClockwise||a||(n===i?n=-i:n-=i);var o=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=s-this.aX,p=c-this.aY;\n// Rotate the point about the center of the ellipse.\ns=u*l-p*h+this.aX,c=u*h+p*l+this.aY}return r.set(s,c)},EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var $t=new Vector3,er=new CubicPoly,tr=new CubicPoly,rr=new CubicPoly;function CatmullRomCurve3(e,t,r,i){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=i||.5}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n *\n * Bezier Curves formulas obtained from\n * http://en.wikipedia.org/wiki/BÃ©zier_curve\n */\nfunction CatmullRom(e,t,r,i,n){var a=.5*(i-t),o=.5*(n-r),s=e*e;return(2*r-2*i+a+o)*(e*s)+(-3*r+3*i-2*a-o)*s+a*e+r}\n//\nfunction QuadraticBezier(e,t,r,i){return function QuadraticBezierP0(e,t){var r=1-e;return r*r*t}(e,t)+function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}(e,r)+function QuadraticBezierP2(e,t){return e*e*t}(e,i)}\n//\nfunction CubicBezier(e,t,r,i,n){return function CubicBezierP0(e,t){var r=1-e;return r*r*r*t}(e,t)+function CubicBezierP1(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}(e,i)+function CubicBezierP3(e,t){return e*e*e*t}(e,n)}function CubicBezierCurve(e,t,r,i){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2,this.v3=i||new Vector2}function CubicBezierCurve3(e,t,r,i){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3,this.v3=i||new Vector3}function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}function QuadraticBezierCurve(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2}function QuadraticBezierCurve3(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3}function SplineCurve(e/* array of Vector2 */){Curve.call(this),this.type="SplineCurve",this.points=e||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(e,t){var r,i,n,a,o=t||new Vector3,s=this.points,c=s.length,l=(c-(this.closed?0:1))*e,h=Math.floor(l),u=l-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/c)+1)*c:0===u&&h===c-1&&(h=c-2,u=1),// 4 points\nthis.closed||h>0?r=s[(h-1)%c]:(\n// extrapolate first point\n$t.subVectors(s[0],s[1]).add(s[0]),r=$t),i=s[h%c],n=s[(h+1)%c],this.closed||h+2<c?a=s[(h+2)%c]:(\n// extrapolate last point\n$t.subVectors(s[c-1],s[c-2]).add(s[c-1]),a=$t),"centripetal"===this.curveType||"chordal"===this.curveType){\n// init Centripetal / Chordal Catmull-Rom\nvar p="chordal"===this.curveType?.5:.25,d=Math.pow(r.distanceToSquared(i),p),f=Math.pow(i.distanceToSquared(n),p),m=Math.pow(n.distanceToSquared(a),p);\n// safety check for repeated points\nf<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),er.initNonuniformCatmullRom(r.x,i.x,n.x,a.x,d,f,m),tr.initNonuniformCatmullRom(r.y,i.y,n.y,a.y,d,f,m),rr.initNonuniformCatmullRom(r.z,i.z,n.z,a.z,d,f,m)}else"catmullrom"===this.curveType&&(er.initCatmullRom(r.x,i.x,n.x,a.x,this.tension),tr.initCatmullRom(r.y,i.y,n.y,a.y,this.tension),rr.initCatmullRom(r.z,i.z,n.z,a.z,this.tension));return o.set(er.calc(u),tr.calc(u),rr.calc(u)),o},CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new Vector3).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(CubicBezier(e,i.x,n.x,a.x,o.x),CubicBezier(e,i.y,n.y,a.y,o.y)),r},CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(CubicBezier(e,i.x,n.x,a.x,o.x),CubicBezier(e,i.y,n.y,a.y,o.y),CubicBezier(e,i.z,n.z,a.z,o.z)),r},CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},\n// Line curve is linear, so we can overwrite default getPointAt\nLineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},\n// Line curve is linear, so we can overwrite default getPointAt\nLineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,i=this.v0,n=this.v1,a=this.v2;return r.set(QuadraticBezier(e,i.x,n.x,a.x),QuadraticBezier(e,i.y,n.y,a.y)),r},QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,i=this.v0,n=this.v1,a=this.v2;return r.set(QuadraticBezier(e,i.x,n.x,a.x),QuadraticBezier(e,i.y,n.y,a.y),QuadraticBezier(e,i.z,n.z,a.z)),r},QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,i=this.points,n=(i.length-1)*e,a=Math.floor(n),o=n-a,s=i[0===a?a:a-1],c=i[a],l=i[a>i.length-2?i.length-1:a+1],h=i[a>i.length-3?i.length-1:a+2];return r.set(CatmullRom(o,s.x,c.x,l.x,h.x),CatmullRom(o,s.y,c.y,l.y,h.y)),r},SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this},SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e},SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new Vector2).fromArray(i))}return this};var ir=/* */Object.freeze({ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n *\n **/\n/**************************************************************\n *\tCurved Path - a curve path is simply a array of connected\n *  curves, but retains the api of a curve\n **************************************************************/function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * Creates free form 2d path using series of points, lines or curves.\n **/\nfunction Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * Defines a 2d shape plane using paths.\n **/\n// STEP 1 Create a path.\n// STEP 2 Turn path into shape.\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\n// STEP 3a - Extract points from each shape, turn to vertices\n// STEP 3b - Triangulate each shape, add faces.\nfunction Shape(e){Path.call(this,e),this.uuid=_t.generateUUID(),this.type="Shape",this.holes=[]}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\nfunction Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction HemisphereLight(e,t,r){Light.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction SpotLight(e,t,r,i,n,a){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){\n// intensity = power per solid angle.\n// ref: equation (17) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nreturn this.intensity*Math.PI},set:function(e){\n// intensity = power per solid angle.\n// ref: equation (17) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nthis.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==a?a:1,// for physically correct lights, should be 2.\nthis.shadow=new SpotLightShadow}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction PointLight(e,t,r,i){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){\n// intensity = power per solid angle.\n// ref: equation (15) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nreturn 4*this.intensity*Math.PI},set:function(e){\n// intensity = power per solid angle.\n// ref: equation (15) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nthis.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,// for physically correct lights, should be 2.\nthis.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author arose / http://github.com/arose\n */\nfunction OrthographicCamera(e,t,r,i,n,a){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\nfunction DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}\n/**\n * @author abelnation / http://github.com/abelnation\n */\nfunction RectAreaLight(e,t,r,i){Light.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==i?i:10}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){\n// Add a line curve if start and end of lines are not connected\nvar e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},\n// To get accurate point with reference to\n// entire path distance at time t,\n// following has to be done:\n// 1. Length of each sub path have to be known\n// 2. Locate and identify type of curve\n// 3. Get t for the curve\n// 4. Return curve.getPointAt(t\')\ngetPoint:function(e){\n// To think about boundaries points.\nfor(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,a=this.curves[i],o=a.getLength(),s=0===o?0:1-n/o;return a.getPointAt(s)}i++}return null;\n// loop where sum != 0, sum > d , sum+1 <d\n},\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\n// getPoint() depends on getLength\ngetLength:function(){var e=this.getCurveLengths();return e[e.length-1]},\n// cacheLengths must be recalculated.\nupdateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},\n// Compute lengths and cache them\n// We cannot overwrite getLengths() because UtoT mapping uses it.\ngetCurveLengths:function(){\n// We use cache values if curves and cache array are same length\nif(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;\n// Get length of sub-curve\n// Push sums into cached array\nfor(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],i=0,n=this.curves;i<n.length;i++)for(var a=n[i],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),c=0;c<s.length;c++){var l=s[c];t&&t.equals(l)||(// ensures no consecutive points are duplicates\nr.push(l),t=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Curve.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push((new ir[i.type]).fromJSON(i))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t);// TODO consider referencing vectors instead of copying?\n},lineTo:function(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,i){var n=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,i));this.curves.push(n),this.currentPoint.set(r,i)},bezierCurveTo:function(e,t,r,i,n,a){var o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,i),new Vector2(n,a));this.curves.push(o),this.currentPoint.set(n,a)},splineThru:function(e/*Array of Vector*/){var t=new SplineCurve([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,i,n,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,r,i,n,a)},absarc:function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)},ellipse:function(e,t,r,i,n,a,o,s){var c=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(e+c,t+l,r,i,n,a,o,s)},absellipse:function(e,t,r,i,n,a,o,s){var c=new EllipseCurve(e,t,r,i,n,a,o,s);if(this.curves.length>0){\n// if a previous curve is present, attempt to join\nvar l=c.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(c);var h=c.getPoint(1);this.currentPoint.copy(h)},copy:function(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},\n// get points of shape and holes (keypoints based on segments parameter)\nextractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push((new Path).fromJSON(i))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(LightShadow.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*_t.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,a=r+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;a=(n+=h*(this.view.offsetX/c))+h*(this.view.width/c),s=(o-=u*(this.view.offsetY/l))-u*(this.view.height/l)}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});\n/**\n * @author tschw\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n */\nvar nr={\n// same as Array.prototype.slice, but also works on typed arrays\narraySlice:function(e,t,r){return nr.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},\n// converts an array to a specific type\nconvertArray:function(e,t,r){return!e||// let \'undefined\' and \'null\' pass\n!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},\n// returns an array by which times and values can be sorted\ngetKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),i=0;i!==t;++i)r[i]=i;return r.sort(function compareTime(t,r){return e[t]-e[r]}),r},\n// uses the array previously returned by \'getKeyframeOrder\' to sort data\nsortedArray:function(e,t,r){for(var i=e.length,n=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=r[a]*t,c=0;c!==t;++c)n[o++]=e[s+c];return n},\n// function for parsing AOS keyframe formats\nflattenJSON:function(e,t,r,i){for(var n=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[n++];if(void 0!==a){// no data\nvar o=a[i];if(void 0!==o)// no data\nif(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),r.push.apply(r,o)),a=e[n++]}while(void 0!==a);else if(void 0!==o.toArray)\n// ...assume THREE.Math-ish\ndo{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(r,r.length)),a=e[n++]}while(void 0!==a);else\n// otherwise push as-is\ndo{void 0!==(o=a[i])&&(t.push(a.time),r.push(o)),a=e[n++]}while(void 0!==a)}}};\n/**\n * Abstract base class of interpolants over parametric samples.\n *\n * The parameter domain is one dimensional, typically the time or a path\n * along a curve defined by the data.\n *\n * The sample values can have any dimensionality and derived classes may\n * apply special interpretations to the data.\n *\n * This class provides the interval seek in a Template Method, deferring\n * the actual interpolation to derived classes.\n *\n * Time complexity is O(1) for linear access crossing at most two points\n * and O(log N) for random access, where N is the number of positions.\n *\n * References:\n *\n * \t\thttp://www.oodesign.com/template-method-pattern.html\n *\n * @author tschw\n */function Interpolant(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r}\n/**\n * Fast and simple cubic spline interpolant.\n *\n * It was derived from a Hermitian construction setting the first derivative\n * at each sample position to the linear slope between neighboring positions\n * over their parameter interval.\n *\n * @author tschw\n */\nfunction CubicInterpolant(e,t,r,i){Interpolant.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}\n/**\n * @author tschw\n */\nfunction LinearInterpolant(e,t,r,i){Interpolant.call(this,e,t,r,i)}\n/**\n *\n * Interpolant that evaluates to the sample value at the position preceeding\n * the parameter.\n *\n * @author tschw\n */\nfunction DiscreteInterpolant(e,t,r,i){Interpolant.call(this,e,t,r,i)}\n/**\n *\n * A timed sequence of keyframes for a specific property.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction KeyframeTrack(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=nr.convertArray(t,this.TimeBufferType),this.values=nr.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}\n// Static methods\n/**\n *\n * A Track of Boolean keyframe values.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction BooleanKeyframeTrack(e,t,r){KeyframeTrack.call(this,e,t,r)}\n/**\n *\n * A Track of keyframe values that represent color.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction ColorKeyframeTrack(e,t,r,i){KeyframeTrack.call(this,e,t,r,i)}\n/**\n *\n * A Track of numeric keyframe values.\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction NumberKeyframeTrack(e,t,r,i){KeyframeTrack.call(this,e,t,r,i)}\n/**\n * Spherical linear unit quaternion interpolant.\n *\n * @author tschw\n */\nfunction QuaternionLinearInterpolant(e,t,r,i){Interpolant.call(this,e,t,r,i)}\n/**\n *\n * A Track of quaternion keyframe values.\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction QuaternionKeyframeTrack(e,t,r,i){KeyframeTrack.call(this,e,t,r,i)}\n/**\n *\n * A Track that interpolates Strings\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction StringKeyframeTrack(e,t,r,i){KeyframeTrack.call(this,e,t,r,i)}\n/**\n *\n * A Track of vectored keyframe values.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction VectorKeyframeTrack(e,t,r,i){KeyframeTrack.call(this,e,t,r,i)}\n/**\n *\n * Reusable set of Tracks that represent an animation.\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n */\nfunction AnimationClip(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=_t.generateUUID(),\n// this means it should figure out its duration by scanning the tracks\nthis.duration<0&&this.resetDuration()}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],i=[];nr.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}\n// derived classes can define a static parse method\nreturn void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction MaterialLoader(e){this.manager=void 0!==e?e:Qt,this.textures={}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction BufferGeometryLoader(e){this.manager=void 0!==e?e:Qt}Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{var a;r:{\n//- See http://jsperf.com/comparison-to-undefined/3\n//- slower code:\n//-\n//- \t\t\t\tif ( t >= t1 || t1 === undefined ) {\ni:if(!(e<i)){for(var o=r+2;;){if(void 0===i){if(e<n)break i;\n// after end\nreturn r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,n)}if(r===o)break;// this loop\nif(n=i,e<(i=t[++r]))\n// we have arrived at the sought interval\nbreak t}\n// prepare binary search on the right side of the index\na=t.length;break r}\n//- slower code:\n//-\t\t\t\t\tif ( t < t0 || t0 === undefined ) {\nif(e>=n)\n// the interval is valid\nbreak e;\n// looping?\nvar s=t[1];e<s&&(r=2,// + 1, using the scan for the details\nn=s);\n// linear reverse scan\nfor(o=r-2;;){if(void 0===n)\n// before start\nreturn this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===o)break;// this loop\nif(i=n,e>=(n=t[--r-1]))\n// we have arrived at the sought interval\nbreak t}\n// prepare binary search on the left side of the index\na=r,r=0}// linear scan\n// binary search\nfor(;r<a;){var c=r+a>>>1;e<t[c]?a=c:r=c+1}\n// check boundary cases, again\nif(i=t[r],void 0===(n=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,n,e)}// seek\nthis._cachedIndex=r,this.intervalChanged_(r,n,i)}// validate_interval\nreturn this.interpolate_(r,n,e,i)},settings:null,// optional, subclass-specific settings structure\n// Note: The indirection allows central control of many interpolants.\n// --- Protected interface\nDefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(\n// copies a sample value to the result buffer\nvar t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i,a=0;a!==i;++a)t[a]=r[n+a];return t},\n// Template methods for derived classes:\ninterpolate_:function(){throw new Error("call to abstract method");\n// implementations shall return this.resultBuffer\n},intervalChanged_:function(){\n// empty\n}}),\n//!\\ DECLARE ALIAS AFTER assign prototype !\nObject.assign(Interpolant.prototype,{\n//( 0, t, t0 ), returns this.resultBuffer\nbeforeStart_:Interpolant.prototype.copySampleValue_,\n//( N-1, tN-1, t ), returns this.resultBuffer\nafterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ot,endingEnd:ot},intervalChanged_:function(e,t,r){var i=this.parameterPositions,n=e-2,a=e+1,o=i[n],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:\n// f\'(t0) = 0\nn=e,o=2*t-r;break;case 2402:o=t+i[\n// use the other end of the curve\nn=i.length-2]-i[n+1];break;default:// ZeroCurvatureEnding\n// f\'\'(t0) = 0 a.k.a. Natural Spline\nn=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:\n// f\'(tN) = 0\na=e,s=2*r-t;break;case 2402:\n// use the other end of the curve\na=1,s=r+i[1]-i[0];break;default:// ZeroCurvatureEnding\n// f\'\'(tN) = 0, a.k.a. Natural Spline\na=e-1,s=t}var c=.5*(r-t),l=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(s-r),this._offsetPrev=n*l,this._offsetNext=a*l},interpolate_:function(e,t,r,i){\n// combine data linearly\nfor(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(r-t)/(i-t),f=d*d,m=f*d,g=-u*m+2*u*f-u*d,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,x=p*m-p*f,b=0\n// evaluate polynomials\n;b!==o;++b)n[b]=g*a[l+b]+v*a[c+b]+y*a[s+b]+x*a[h+b];return n}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,l=(r-t)/(i-t),h=1-l,u=0;u!==o;++u)n[u]=a[c+u]*h+a[s+u]*l;return n}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e/*, t0, t, t1 */){return this.copySampleValue_(e-1)}}),Object.assign(KeyframeTrack,{\n// Serialization (in static context, because of constructor invocation\n// and automatic invocation of .toJSON):\ntoJSON:function(e){var t,r=e.constructor;\n// derived classes can define a static toJSON method\nif(void 0!==r.toJSON)t=r.toJSON(e);else{\n// by default, we assume the data can be serialized as-is\nt={name:e.name,times:nr.convertArray(e.times,Array),values:nr.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}// mandatory\nreturn t.type=e.ValueTypeName,t}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){\n// fall back to default, unless the default itself is messed up\nif(e===this.DefaultInterpolation)throw new Error(r);// fatal, in this case\nthis.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},\n// move all keyframes either forwards or backwards in time\nshift:function(e){if(0!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},\n// scale all keyframe times by a factor (useful for frame <-> seconds conversions)\nscale:function(e){if(1!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},\n// removes keyframes before and after animation without changing any values within the range [startTime, endTime].\n// IMPORTANT: We do not shift around keys to the start of the track time, because for interpolated keys this will change their values\ntrim:function(e,t){for(var r=this.times,i=r.length,n=0,a=i-1;n!==i&&r[n]<e;)++n;for(;-1!==a&&r[a]>t;)--a;// inclusive -> exclusive bound\nif(++a,0!==n||a!==i){\n// empty tracks are forbidden, so keep at least one keyframe\nn>=a&&(n=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=nr.arraySlice(r,n,a),this.values=nr.arraySlice(this.values,n*o,a*o)}return this},\n// ensure we do not get a GarbageInGarbageOut situation, make sure tracks are at least minimally viable\nvalidate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==n;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&nr.isTypedArray(i)){o=0;for(var c=i.length;o!==c;++o){var l=i[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),e=!1;break}}}return e},\n// removes equivalent sequential keys as common in morph target sequences\n// (0,0,0,0,1,1,1,0,0,0,0,0,0,0) --\x3e (0,0,1,1,0,0)\noptimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=2302===this.getInterpolation(),n=1,a=e.length-1,o=1;o<a;++o){var s=!1,c=e[o];\n// remove adjacent keyframes scheduled at the same time\nif(c!==e[o+1]&&(1!==o||c!==c[0]))if(i)s=!0;else for(\n// remove unnecessary keyframes same as their neighbors\nvar l=o*r,h=l-r,u=l+r,p=0;p!==r;++p){var d=t[l+p];if(d!==t[h+p]||d!==t[u+p]){s=!0;break}}\n// in-place compaction\nif(s){if(o!==n){e[n]=e[o];var f=o*r,m=n*r;for(p=0;p!==r;++p)t[m+p]=t[f+p]}++n}}\n// flush last keyframe (compaction looks ahead)\nif(a>0){e[n]=e[a];for(f=a*r,m=n*r,p=0;p!==r;++p)t[m+p]=t[f+p];++n}return n!==e.length&&(this.times=nr.arraySlice(e,0,n),this.values=nr.arraySlice(t,0,n*r)),this}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=(r-t)/(i-t),l=s+o;s!==l;s+=4)Quaternion.slerpFlat(n,0,a,s-o,a,s,c);return n}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",\n// ValueBufferType is inherited\nDefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),n=0,a=r.length;n!==a;++n)t.push(parseKeyframeTrack(r[n]).scale(i));return new AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,a=r.length;n!==a;++n)t.push(KeyframeTrack.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var n=t.length,a=[],o=0;o<n;o++){var s=[],c=[];s.push((o+n-1)%n,o,(o+1)%n),c.push(0,1,0);var l=nr.getKeyframeOrder(s);s=nr.sortedArray(s,1,l),c=nr.sortedArray(c,1,l),\n// if there is a key at the first frame, duplicate it as the\n// last frame as well for perfect loop.\ni||0!==s[0]||(s.push(n),c.push(c[0])),a.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",s,c).scale(1/r))}return new AnimationClip(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var i=e;r=i.geometry&&i.geometry.animations||i.animations}for(var n=0;n<r.length;n++)if(r[n].name===t)return r[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){\n// sort morph target names into animation groups based\n// patterns like Walk_001, Walk_002, Run_001, Run_002\nfor(var i={},n=/^([\\w-]*?)([\\d]+)$/,a=0,o=e.length\n// tested with https://regex101.com/ on trick sequences\n// such flamingo_flyA_003, flamingo_run1_003, crdeath0059\n;a<o;a++){var s=e[a],c=s.name.match(n);if(c&&c.length>1){var l=i[u=c[1]];l||(i[u]=l=[]),l.push(s)}}var h=[];for(var u in i)h.push(AnimationClip.CreateFromMorphTargetSequence(u,i[u],t,r));return h},\n// parse the animation.hierarchy format\nparseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,i,n){\n// only return track if there are actually keys.\nif(0!==r.length){var a=[],o=[];nr.flattenJSON(r,a,o,i),\n// empty keys are filtered out, so check again\n0!==a.length&&n.push(new e(t,a,o))}},i=[],n=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],c=0;c<s.length;c++){var l=s[c].keys;\n// skip empty tracks\nif(l&&0!==l.length)\n// process morph targets\nif(l[0].morphTargets){for(\n// figure out all morph targets used in this track\nvar h={},u=0;u<l.length;u++)if(l[u].morphTargets)for(var p=0;p<l[u].morphTargets.length;p++)h[l[u].morphTargets[p]]=-1;\n// create a track for each morph target with all zero\n// morphTargetInfluences except for the keys in which\n// the morphTarget is named.\nfor(var d in h){var f=[],m=[];for(p=0;p!==l[u].morphTargets.length;++p){var g=l[u];f.push(g.time),m.push(g.morphTarget===d?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+d+"]",f,m))}a=h.length*(o||1)}else{\n// ...assume skeletal animation\nvar v=".bones["+t[c].name+"]";r(VectorKeyframeTrack,v+".position",l,"pos",i),r(QuaternionKeyframeTrack,v+".quaternion",l,"rot",i),r(VectorKeyframeTrack,v+".scale",l,"scl",i)}}return 0===i.length?null:new AnimationClip(n,a,i)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(MaterialLoader.prototype,{load:function(e,t,r,i){var n=this;new FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function getTexture(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Jt[e.type];\n// Shader Material\nif(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var n=e.uniforms[i];switch(r.uniforms[i]={},n.type){case"t":r.uniforms[i].value=getTexture(n.value);break;case"c":r.uniforms[i].value=(new Color).setHex(n.value);break;case"v2":r.uniforms[i].value=(new Vector2).fromArray(n.value);break;case"v3":r.uniforms[i].value=(new Vector3).fromArray(n.value);break;case"v4":r.uniforms[i].value=(new Vector4).fromArray(n.value);break;case"m4":r.uniforms[i].value=(new Matrix4).fromArray(n.value);break;default:r.uniforms[i].value=n.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),\n// Deprecated\nvoid 0!==e.shading&&(r.flatShading=1===e.shading),// THREE.FlatShading\n// for PointsMaterial\nvoid 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),\n// maps\nvoid 0!==e.map&&(r.map=getTexture(e.map)),void 0!==e.alphaMap&&(r.alphaMap=getTexture(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=getTexture(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=getTexture(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var a=e.normalScale;!1===Array.isArray(a)&&(\n// Blender exporter used to export a scalar. See #7459\na=[a,a]),r.normalScale=(new Vector2).fromArray(a)}return void 0!==e.displacementMap&&(r.displacementMap=getTexture(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=getTexture(e.specularMap)),void 0!==e.envMap&&(r.envMap=getTexture(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=getTexture(e.gradientMap)),r}}),Object.assign(BufferGeometryLoader.prototype,{load:function(e,t,r,i){var n=this;new FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=new BufferGeometry,r=e.data.index;if(void 0!==r){var i=new ar[r.type](r.array);t.setIndex(new BufferAttribute(i,1))}var n=e.data.attributes;for(var a in n){var o=n[a];i=new ar[o.type](o.array);t.addAttribute(a,new BufferAttribute(i,o.itemSize,o.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var c=0,l=s.length;c!==l;++c){var h=s[c];t.addGroup(h.start,h.count,h.materialIndex)}var u=e.data.boundingSphere;if(void 0!==u){var p=new Vector3;void 0!==u.center&&p.fromArray(u.center),t.boundingSphere=new Sphere(p,u.radius)}return t}});var ar={Int8Array:Int8Array,Uint8Array:Uint8Array,\n// Workaround for IE11 pre KB2929437. See #11440\nUint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};\n/**\n * @author alteredq / http://alteredqualia.com/\n */function Loader(){}Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;r<i;r+=2){var n=t[r],a=t[r+1];if(n.test(e))return a}return null}},Object.assign(Loader.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t,r);return i},createMaterial:function(){var e={NoBlending:m,NormalBlending:g,AdditiveBlending:y,SubtractiveBlending:x,MultiplyBlending:b,CustomBlending:_},t=new Color,r=new TextureLoader,i=new MaterialLoader;return function createMaterial(n,a,o){\n// convert from old material format\nvar s={};function loadTexture(e,t,i,n,c){var l,h=a+e,u=Loader.Handlers.get(h);null!==u?l=u.load(h):(r.setCrossOrigin(o),l=r.load(h)),void 0!==t&&(l.repeat.fromArray(t),1!==t[0]&&(l.wrapS=se),1!==t[1]&&(l.wrapT=se)),void 0!==i&&l.offset.fromArray(i),void 0!==n&&("repeat"===n[0]&&(l.wrapS=se),"mirror"===n[0]&&(l.wrapS=le),"repeat"===n[1]&&(l.wrapT=se),"mirror"===n[1]&&(l.wrapT=le)),void 0!==c&&(l.anisotropy=c);var p=_t.generateUUID();return s[p]=l,p}\n//\nvar c={uuid:_t.generateUUID(),type:"MeshLambertMaterial"};for(var l in n){var p=n[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=p;break;case"blending":c.blending=e[p];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(p).getHex();break;case"colorSpecular":c.specular=t.fromArray(p).getHex();break;case"colorEmissive":c.emissive=t.fromArray(p).getHex();break;case"specularCoef":c.shininess=p;break;case"shading":"basic"===p.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===p.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===p.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=loadTexture(p,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=loadTexture(p,n.mapEmissiveRepeat,n.mapEmissiveOffset,n.mapEmissiveWrap,n.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=loadTexture(p,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=loadTexture(p,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=loadTexture(p,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=p;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=loadTexture(p,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=p;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=loadTexture(p,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=loadTexture(p,n.mapMetalnessRepeat,n.mapMetalnessOffset,n.mapMetalnessWrap,n.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=loadTexture(p,n.mapRoughnessRepeat,n.mapRoughnessOffset,n.mapRoughnessWrap,n.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=loadTexture(p,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=h;break;case"doubleSided":c.side=u;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=p;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[l]=p;break;case"vertexColors":!0===p&&(c.vertexColors=f),"face"===p&&(c.vertexColors=d);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,p)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),i.setTextures(s),i.parse(c)}}()});\n/**\n * @author Don McCurdy / https://www.donmccurdy.com\n */\nvar or=function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)};\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */function JSONLoader(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Qt,this.withCredentials=!1}Object.assign(JSONLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=this,a=void 0===this.path?or(e):this.path,o=new FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,function(r){var i=JSON.parse(r),o=i.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var c=n.parse(i,a);t(c.geometry,c.materials)},r,i)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(){return function parse(e,t){void 0!==e.data&&(\n// Geometry 4.0 spec\ne=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new Geometry;return function parseModel(e,t){function isBitSet(e,t){return e&1<<t}var r,i,n,a,o,s,c,l,h,u,p,d,f,m,g,v,y,x,b,_,M,w,T,E,S,L=e.faces,A=e.vertices,C=e.normals,P=e.colors,R=e.scale,B=0;if(void 0!==e.uvs){\n// disregard empty arrays\nfor(r=0;r<e.uvs.length;r++)e.uvs[r].length&&B++;for(r=0;r<B;r++)t.faceVertexUvs[r]=[]}for(a=0,o=A.length;a<o;)(x=new Vector3).x=A[a++]*R,x.y=A[a++]*R,x.z=A[a++]*R,t.vertices.push(x);for(a=0,o=L.length;a<o;)\n// console.log("type", type, "bits", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\nif(p=isBitSet(u=L[a++],0),d=isBitSet(u,1),f=isBitSet(u,3),m=isBitSet(u,4),g=isBitSet(u,5),v=isBitSet(u,6),y=isBitSet(u,7),p){if((_=new Face3).a=L[a],_.b=L[a+1],_.c=L[a+3],(M=new Face3).a=L[a+1],M.b=L[a+2],M.c=L[a+3],a+=4,d&&(h=L[a++],_.materialIndex=h,M.materialIndex=h),\n// to get face <=> uv index correspondence\nn=t.faces.length,f)for(r=0;r<B;r++)for(E=e.uvs[r],t.faceVertexUvs[r][n]=[],t.faceVertexUvs[r][n+1]=[],i=0;i<4;i++)S=new Vector2(E[2*(l=L[a++])],E[2*l+1]),2!==i&&t.faceVertexUvs[r][n].push(S),0!==i&&t.faceVertexUvs[r][n+1].push(S);if(m&&(c=3*L[a++],_.normal.set(C[c++],C[c++],C[c]),M.normal.copy(_.normal)),g)for(r=0;r<4;r++)c=3*L[a++],T=new Vector3(C[c++],C[c++],C[c]),2!==r&&_.vertexNormals.push(T),0!==r&&M.vertexNormals.push(T);if(v&&(w=P[s=L[a++]],_.color.setHex(w),M.color.setHex(w)),y)for(r=0;r<4;r++)w=P[s=L[a++]],2!==r&&_.vertexColors.push(new Color(w)),0!==r&&M.vertexColors.push(new Color(w));t.faces.push(_),t.faces.push(M)}else{if((b=new Face3).a=L[a++],b.b=L[a++],b.c=L[a++],d&&(h=L[a++],b.materialIndex=h),\n// to get face <=> uv index correspondence\nn=t.faces.length,f)for(r=0;r<B;r++)for(E=e.uvs[r],t.faceVertexUvs[r][n]=[],i=0;i<3;i++)S=new Vector2(E[2*(l=L[a++])],E[2*l+1]),t.faceVertexUvs[r][n].push(S);if(m&&(c=3*L[a++],b.normal.set(C[c++],C[c++],C[c])),g)for(r=0;r<3;r++)c=3*L[a++],T=new Vector3(C[c++],C[c++],C[c]),b.vertexNormals.push(T);if(v&&(s=L[a++],b.color.setHex(P[s])),y)for(r=0;r<3;r++)s=L[a++],b.vertexColors.push(new Color(P[s]));t.faces.push(b)}}(e,r),function parseSkin(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var i=0,n=e.skinWeights.length;i<n;i+=r){var a=e.skinWeights[i],o=r>1?e.skinWeights[i+1]:0,s=r>2?e.skinWeights[i+2]:0,c=r>3?e.skinWeights[i+3]:0;t.skinWeights.push(new Vector4(a,o,s,c))}if(e.skinIndices)for(i=0,n=e.skinIndices.length;i<n;i+=r){var l=e.skinIndices[i],h=r>1?e.skinIndices[i+1]:0,u=r>2?e.skinIndices[i+2]:0,p=r>3?e.skinIndices[i+3]:0;t.skinIndices.push(new Vector4(l,h,u,p))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function parseMorphing(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var i=0,n=e.morphTargets.length;i<n;i++){t.morphTargets[i]={},t.morphTargets[i].name=e.morphTargets[i].name,t.morphTargets[i].vertices=[];for(var a=t.morphTargets[i].vertices,o=e.morphTargets[i].vertices,s=0,c=o.length;s<c;s+=3){var l=new Vector3;l.x=o[s]*r,l.y=o[s+1]*r,l.z=o[s+2]*r,a.push(l)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn(\'THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.\');var h=t.faces,u=e.morphColors[0].colors;for(i=0,n=h.length;i<n;i++)h[i].color.fromArray(u,3*i)}}(e,r),function parseAnimations(e,t){var r=[],i=[];\n// parse old style Bone/Hierarchy animations\nvoid 0!==e.animation&&i.push(e.animation),void 0!==e.animations&&(e.animations.length?i=i.concat(e.animations):i.push(e.animations));for(var n=0;n<i.length;n++){var a=AnimationClip.parseAnimation(i[n],t.bones);a&&r.push(a)}\n// parse implicit morph animations\nif(t.morphTargets){\n// TODO: Figure out what an appropraite FPS is for morph target animations -- defaulting to 10, but really it is completely arbitrary.\nvar o=AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(o)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}()}),Object.assign(\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction ObjectLoader(e){this.manager=void 0!==e?e:Qt,this.texturePath=""}.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this;new FileLoader(n.manager).load(e,function(r){var a=null;try{a=JSON.parse(r)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can\'t parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?n.parse(a,t):console.error("THREE.ObjectLoader: Can\'t load "+e+". Use THREE.JSONLoader instead.")},r,i)},setTexturePath:function(e){return this.texturePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,r),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,i,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,i=e.length;r<i;r++){var n=(new Shape).fromJSON(e[r]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var i=new JSONLoader,n=new BufferGeometryLoader,a=0,o=e.length;a<o;a++){var s,c=e[a];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Yt[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":// backwards compatible\ns=new Yt[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Yt[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Yt[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Yt[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Yt[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Yt[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Yt[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Yt[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Yt[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Yt[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Yt[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],h=0,u=c.shapes.length;h<u;h++){var p=t[c.shapes[h]];l.push(p)}s=new Yt[c.type](l,c.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],h=0,u=c.shapes.length;h<u;h++){p=t[c.shapes[h]];l.push(p)}var d=c.options.extrudePath;void 0!==d&&(c.options.extrudePath=(new ir[d.type]).fromJSON(d)),s=new Yt[c.type](l,c.options);break;case"BufferGeometry":s=n.parse(c);break;case"Geometry":s=i.parse(c,this.texturePath).geometry;break;default:console.warn(\'THREE.ObjectLoader: Unsupported geometry type "\'+c.type+\'"\');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),!0===s.isBufferGeometry&&void 0!==c.userData&&(s.userData=c.userData),r[c.uuid]=s}return r},parseMaterials:function(e,t){var r={};if(void 0!==e){var i=new MaterialLoader;i.setTextures(t);for(var n=0,a=e.length;n<a;n++){var o=e[n];if("MultiMaterial"===o.type){for(\n// Deprecated\nvar s=[],c=0;c<o.materials.length;c++)s.push(i.parse(o.materials[c]));r[o.uuid]=s}else r[o.uuid]=i.parse(o)}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=AnimationClip.parse(i);void 0!==i.uuid&&(n.uuid=i.uuid),t.push(n)}return t},parseImages:function(e,t){var r=this,i={};function loadImage(e){return r.manager.itemStart(e),n.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemEnd(e),r.manager.itemError(e)})}if(void 0!==e&&e.length>0){var n=new ImageLoader(new LoadingManager(t));n.setCrossOrigin(this.crossOrigin);for(var a=0,o=e.length;a<o;a++){var s=e[a],c=s.url;if(Array.isArray(c)){\n// load array of images e.g CubeTexture\ni[s.uuid]=[];for(var l=0,h=c.length;l<h;l++){var u=c[l],p=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(u)?u:r.texturePath+u;i[s.uuid].push(loadImage(p))}}else{\n// load single image\np=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(s.url)?s.url:r.texturePath+s.url;i[s.uuid]=loadImage(p)}}}return i},parseTextures:function(e,t){function parseConstant(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var a,o=e[i];void 0===o.image&&console.warn(\'THREE.ObjectLoader: No "image" specified for\',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),(a=Array.isArray(t[o.image])?new CubeTexture(t[o.image]):new Texture(t[o.image])).needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=parseConstant(o.mapping,cr)),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=parseConstant(o.wrap[0],lr),a.wrapT=parseConstant(o.wrap[1],lr)),void 0!==o.format&&(a.format=o.format),void 0!==o.minFilter&&(a.minFilter=parseConstant(o.minFilter,hr)),void 0!==o.magFilter&&(a.magFilter=parseConstant(o.magFilter,hr)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),r[o.uuid]=a}return r},parseObject:function(e,t,r){var i;function getGeometry(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function getMaterial(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,n=e.length;i<n;i++){var a=e[i];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(r[a])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":i=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":i=new DirectionalLight(e.color,e.intensity);break;case"PointLight":i=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var n=getGeometry(e.geometry),a=getMaterial(e.material);i=n.bones&&n.bones.length>0?new SkinnedMesh(n,a):new Mesh(n,a);break;case"LOD":i=new LOD;break;case"Line":i=new Line(getGeometry(e.geometry),getMaterial(e.material),e.mode);break;case"LineLoop":i=new LineLoop(getGeometry(e.geometry),getMaterial(e.material));break;case"LineSegments":i=new LineSegments(getGeometry(e.geometry),getMaterial(e.material));break;case"PointCloud":case"Points":i=new Points(getGeometry(e.geometry),getMaterial(e.material));break;case"Sprite":i=new Sprite(getMaterial(e.material));break;case"Group":i=new Group;break;default:i=new Object3D}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var o=e.children,s=0;s<o.length;s++)i.add(this.parseObject(o[s],t,r));if("LOD"===e.type)for(var c=e.levels,l=0;l<c.length;l++){var h=c[l],u=i.getObjectByProperty("uuid",h.object);void 0!==u&&i.addLevel(u,h.distance)}return i}});var sr,cr={UVMapping:300,CubeReflectionMapping:ee,CubeRefractionMapping:te,EquirectangularReflectionMapping:re,EquirectangularRefractionMapping:ie,SphericalReflectionMapping:ne,CubeUVReflectionMapping:ae,CubeUVRefractionMapping:oe},lr={RepeatWrapping:se,ClampToEdgeWrapping:ce,MirroredRepeatWrapping:le},hr={NearestFilter:he,NearestMipMapNearestFilter:ue,NearestMipMapLinearFilter:pe,LinearFilter:de,LinearMipMapNearestFilter:fe,LinearMipMapLinearFilter:me};\n/**\n * @author thespite / http://clicktorelease.com/\n */\nfunction ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Qt,this.options=void 0}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * minimal class for proxing functions to Path. Replaces old "extractSubpaths()"\n **/\nfunction ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}\n/**\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Font(e){this.type="Font",this.data=e}function createPath(e,t,r,i,n){var a=n.glyphs[e]||n.glyphs["?"];if(a){var o,s,c,l,h,u,p,d,f=new ShapePath;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":// moveTo\no=m[g++]*t+r,s=m[g++]*t+i,f.moveTo(o,s);break;case"l":// lineTo\no=m[g++]*t+r,s=m[g++]*t+i,f.lineTo(o,s);break;case"q":// quadraticCurveTo\nc=m[g++]*t+r,l=m[g++]*t+i,h=m[g++]*t+r,u=m[g++]*t+i,f.quadraticCurveTo(h,u,c,l);break;case"b":// bezierCurveTo\nc=m[g++]*t+r,l=m[g++]*t+i,h=m[g++]*t+r,u=m[g++]*t+i,p=m[g++]*t+r,d=m[g++]*t+i,f.bezierCurveTo(h,u,p,d,c,l)}}return{offsetX:a.ha*t,path:f}}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */ImageBitmapLoader.prototype={constructor:ImageBitmapLoader,setOptions:function setOptions(e){return this.options=e,this},load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,a=Zt.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout(function(){t&&t(a),n.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,n.options)}).then(function(r){Zt.add(e,r),t&&t(r),n.manager.itemEnd(e)}).catch(function(t){i&&i(t),n.manager.itemEnd(e),n.manager.itemError(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(ShapePath.prototype,{moveTo:function(e,t){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,i){this.currentPath.quadraticCurveTo(e,t,r,i)},bezierCurveTo:function(e,t,r,i,n,a){this.currentPath.bezierCurveTo(e,t,r,i,n,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function toShapesNoHoles(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r],a=new Shape;a.curves=n.curves,t.push(a)}return t}function isPointInsidePolygon(e,t){for(var r=t.length,i=!1,n=r-1,a=0\n// inPt on polygon contour => immediate success    or\n// toggling of inside/outside at every single! intersection point of an edge\n//  with the horizontal line through inPt, left of inPt\n//  not counting lowerY endpoints of edges and whole edges on that line\n;a<r;n=a++){var o=t[n],s=t[a],c=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(\n// not parallel\nl<0&&(o=t[a],c=-c,s=t[n],l=-l),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0;// inPt is on contour ?\n// continue;\t\t\t\t// no intersection or edgeLowPt => doesn\'t count !!!\n}else{var h=l*(e.x-o.x)-c*(e.y-o.y);if(0===h)return!0;// inPt is on contour ?\nif(h<0)continue;i=!i}}else{\n// parallel or collinear\nif(e.y!==o.y)continue;// parallel\n// edge lies on the same horizontal line as inPt\nif(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0;// inPt: Point on contour !\n// continue;\n}}return i}var r=Xt.isClockWise,i=this.subPaths;if(0===i.length)return[];if(!0===t)return toShapesNoHoles(i);var n,a,o,s=[];if(1===i.length)return a=i[0],(o=new Shape).curves=a.curves,s.push(o),s;var c=!r(i[0].getPoints());c=e?!c:c;\n// console.log("Holes first", holesFirst);\nvar l,h,u=[],p=[],d=[],f=0;p[f]=void 0,d[f]=[];for(var m=0,g=i.length;m<g;m++)n=r(l=(a=i[m]).getPoints()),(n=e?!n:n)?(!c&&p[f]&&f++,p[f]={s:new Shape,p:l},p[f].s.curves=a.curves,c&&f++,d[f]=[]):d[f].push({h:a,p:l[0]});\n// only Holes? -> probably all Shapes with wrong orientation\nif(!p[0])return toShapesNoHoles(i);if(p.length>1){for(var v=!1,y=[],x=0,b=p.length;x<b;x++)u[x]=[];for(x=0,b=p.length;x<b;x++)for(var _=d[x],M=0;M<_.length;M++){for(var w=_[M],T=!0,E=0;E<p.length;E++)isPointInsidePolygon(w.p,p[E].p)&&(x!==E&&y.push({froms:x,tos:E,hole:M}),T?(T=!1,u[E].push(w)):v=!0);T&&u[x].push(w)}\n// console.log("ambiguous: ", ambiguous);\ny.length>0&&(\n// console.log("to change: ", toChange);\nv||(d=u))}m=0;for(var S=p.length;m<S;m++){o=p[m].s,s.push(o);for(var L=0,A=(h=d[m]).length;L<A;L++)o.holes.push(h[L].h)}\n//console.log("shape", shapes);\nreturn s}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],i=function createPaths(e,t,r){for(var i=Array.from?Array.from(e):String(e).split(""),n=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,o=[],s=0,c=0,l=0// see #13988\n;l<i.length;l++){var h=i[l];if("\\n"===h)s=0,c-=a;else{var u=createPath(h,n,s,c,r);s+=u.offsetX,o.push(u.path)}}return o}(e,t,this.data),n=0,a=i.length;n<a;n++)Array.prototype.push.apply(r,i[n].toShapes());return r}}),Object.assign(function FontLoader(e){this.manager=void 0!==e?e:Qt}.prototype,{load:function(e,t,r,i){var n=this,a=new FileLoader(this.manager);a.setPath(this.path),a.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var i=n.parse(r);t&&t(i)},r,i)},parse:function(e){return new Font(e)},setPath:function(e){return this.path=e,this}});var ur={getContext:function(){return void 0===sr&&(sr=new(window.AudioContext||window.webkitAudioContext)),sr},setContext:function(e){sr=e}};\n/**\n * @author Reece Aaron Lecrivain / http://reecenotes.com/\n */function AudioLoader(e){this.manager=void 0!==e?e:Qt}\n/**\n * Camera for rendering cube maps\n *\t- renders scene into axis-aligned cube\n *\n * @author alteredq / http://alteredqualia.com/\n */\nfunction CubeCamera(e,t,r){Object3D.call(this),this.type="CubeCamera";var i=new PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Vector3(1,0,0)),this.add(i);var n=new PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Vector3(-1,0,0)),this.add(n);var a=new PerspectiveCamera(90,1,e,t);a.up.set(0,0,1),a.lookAt(new Vector3(0,1,0)),this.add(a);var o=new PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new Vector3(0,-1,0)),this.add(o);var s=new PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new Vector3(0,0,1)),this.add(s);var c=new PerspectiveCamera(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new Vector3(0,0,-1)),this.add(c);var l={format:Ce,magFilter:de,minFilter:de};this.renderTarget=new WebGLRenderTargetCube(r,r,l),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,l=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,i,r),r.activeCubeFace=1,e.render(t,n,r),r.activeCubeFace=2,e.render(t,a,r),r.activeCubeFace=3,e.render(t,o,r),r.activeCubeFace=4,e.render(t,s,r),r.texture.generateMipmaps=l,r.activeCubeFace=5,e.render(t,c,r),e.setRenderTarget(null)},this.clear=function(e,t,r,i){for(var n=this.renderTarget,a=0;a<6;a++)n.activeCubeFace=a,e.setRenderTarget(n),e.clear(t,r,i);e.setRenderTarget(null)}}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=ur.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Reece Aaron Lecrivain / http://reecenotes.com/\n */\nfunction Audio(e){Object3D.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction AudioAnalyser(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}\n/**\n *\n * Buffered scene graph property that allows weighted accumulation.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction PropertyMixer(e,t,r){this.binding=e,this.valueSize=r;var i,n=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":n=Array,i=this._select;break;default:i=this._lerp}this.buffer=new n(4*r),\n// layout: [ incoming | accu0 | accu1 | orig ]\n//\n// interpolators can use .buffer as their .result\n// the data then goes to \'incoming\'\n//\n// \'accu0\' and \'accu1\' are used frame-interleaved for\n// the cumulative result and are compared to detect\n// changes\n//\n// \'orig\' stores the original state of the property\nthis._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(AudioLoader.prototype,{load:function(e,t,r,i){var n=new FileLoader(this.manager);n.setResponseType("arraybuffer"),n.load(e,function(e){\n// Create a copy of the buffer. The `decodeAudioData` method\n// detaches the buffer when complete, preventing reuse.\nvar r=e.slice(0);ur.getContext().decodeAudioData(r,function(e){t(e)})},r,i)}}),Object.assign(\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}.prototype,{update:function(){var e,t,r,i,n,a,o,s,c=new Matrix4,l=new Matrix4;return function update(h){if(e!==this||t!==h.focus||r!==h.fov||i!==h.aspect*this.aspect||n!==h.near||a!==h.far||o!==h.zoom||s!==this.eyeSep){e=this,t=h.focus,r=h.fov,i=h.aspect*this.aspect,n=h.near,a=h.far,o=h.zoom;\n// Off-axis stereoscopic effect based on\n// http://paulbourke.net/stereographics/stereorender/\nvar u,p,d=h.projectionMatrix.clone(),f=(s=this.eyeSep/2)*n/t,m=n*Math.tan(_t.DEG2RAD*r*.5)/o;\n// translate xOffset\nl.elements[12]=-s,c.elements[12]=s,\n// for left eye\nu=-m*i+f,p=m*i+f,d.elements[0]=2*n/(p-u),d.elements[8]=(p+u)/(p-u),this.cameraL.projectionMatrix.copy(d),\n// for right eye\nu=-m*i-f,p=m*i-f,d.elements[0]=2*n/(p-u),d.elements[8]=(p+u)/(p-u),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(l),this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(c)}}()}),CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,r=new Vector3,i=new Vector3;return function updateMatrixWorld(n){Object3D.prototype.updateMatrixWorld.call(this,n);var a=this.context.listener,o=this.up;this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),a.positionX?(a.positionX.setValueAtTime(e.x,this.context.currentTime),a.positionY.setValueAtTime(e.y,this.context.currentTime),a.positionZ.setValueAtTime(e.z,this.context.currentTime),a.forwardX.setValueAtTime(i.x,this.context.currentTime),a.forwardY.setValueAtTime(i.y,this.context.currentTime),a.forwardZ.setValueAtTime(i.z,this.context.currentTime),a.upX.setValueAtTime(o.x,this.context.currentTime),a.upY.setValueAtTime(o.y,this.context.currentTime),a.upZ.setValueAtTime(o.z,this.context.currentTime)):(a.setPosition(e.x,e.y,e.z),a.setOrientation(i.x,i.y,i.z,o.x,o.y,o.z))}}()}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,r=new Vector3,i=new Vector3;return function updateMatrixWorld(n){Object3D.prototype.updateMatrixWorld.call(this,n);var a=this.panner;this.matrixWorld.decompose(e,t,r),i.set(0,0,1).applyQuaternion(t),a.setPosition(e.x,e.y,e.z),a.setOrientation(i.x,i.y,i.z)}}()}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(PropertyMixer.prototype,{\n// accumulate data in the \'incoming\' region into \'accu<i>\'\naccumulate:function(e,t){\n// note: happily accumulating nothing when weight = 0, the caller knows\n// the weight and shouldn\'t have made the call in the first place\nvar r=this.buffer,i=this.valueSize,n=e*i+i,a=this.cumulativeWeight;if(0===a){\n// accuN := incoming * weight\nfor(var o=0;o!==i;++o)r[n+o]=r[o];a=t}else{var s=t/(\n// accuN := accuN + incoming * weight\na+=t);this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=a},\n// apply the state of \'accu<i>\' to the binding when accus differ\napply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,n<1){\n// accuN := accuN + original * ( 1 - cumulativeWeight )\nvar o=3*t;this._mixBufferRegion(r,i,o,1-n,t)}for(var s=t,c=t+t;s!==c;++s)if(r[s]!==r[s+t]){\n// value has changed -> update scene graph\na.setValue(r,i);break}},\n// remember the state of the bound property and copy it to both accus\nsaveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=3*r;e.getValue(t,i);\n// accu[0..1] := orig -- initially detect changes against the original\nfor(var n=r,a=i;n!==a;++n)t[n]=t[i+n%r];this.cumulativeWeight=0},\n// apply the state previously taken via \'saveOriginalState\' to the binding\nrestoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},\n// mix functions\n_select:function(e,t,r,i,n){if(i>=.5)for(var a=0;a!==n;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,i){Quaternion.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,n){for(var a=1-i,o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*i}}});\n/**\n *\n * A reference to a real property in the scene graph.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\n// Characters [].:/ are reserved for track binding syntax.\nvar pr,dr;function Composite(e,t,r){var i=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function PropertyBinding(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}\n/**\n *\n * Action provided by AnimationMixer for scheduling clip playback on specific\n * objects.\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n *\n */\nfunction AnimationAction(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,n=i.length,a=new Array(n),o={endingStart:ot,endingEnd:ot},s=0;s!==n;++s){var c=i[s].createInterpolant(null);a[s]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,// bound by the mixer\n// inside: PropertyMixer (managed by the mixer)\nthis._propertyBindings=new Array(n),this._cacheIndex=null,// for the memory manager\nthis._byClipCacheIndex=null,// for the memory manager\nthis._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=at,this._loopCount=-1,\n// global mixer time when the action is to be started\n// it\'s set back to \'null\' upon start of the action\nthis._startTime=null,\n// scaled local time of the action\n// gets clamped or wrapped to 0..clip.duration according to loop\nthis.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,// no. of repetitions when looping\nthis.paused=!1,// true -> zero effective time scale\nthis.enabled=!0,// false -> zero effective weight\nthis.clampWhenFinished=!1,// keep feeding the last frame?\nthis.zeroSlopeAtStart=!0,// for smooth interpolation w/o separate\nthis.zeroSlopeAtEnd=!0}\n/**\n *\n * Player for AnimationClips.\n *\n *\n * @author Ben Houston / http://clara.io/\n * @author David Sarno / http://lighthaus.us/\n * @author tschw\n */\nfunction AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction Uniform(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}\n/**\n * @author benaadams / https://twitter.com/ben_a_adams\n */\nfunction InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}\n/**\n * @author benaadams / https://twitter.com/ben_a_adams\n */\nfunction InstancedInterleavedBuffer(e,t,r){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1}\n/**\n * @author benaadams / https://twitter.com/ben_a_adams\n */\nfunction InstancedBufferAttribute(e,t,r,i){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,r),this.meshPerAttribute=i||1}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,r,i){if(!1!==e.visible&&(e.raycast(t,r),!0===i))for(var n=e.children,a=0,o=n.length;a<o;a++)intersectObject(n[a],t,r,!0)}\n/**\n * @author bhouston / http://clara.io\n */\nfunction Box2(e,t){this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}\n/**\n * @author bhouston / http://clara.io\n */\nfunction Line3(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){}}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction VertexNormalsHelper(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);\n//\nvar c=new BufferGeometry,l=new Float32BufferAttribute(2*o*3,3);c.addAttribute("position",l),LineSegments.call(this,c,new LineBasicMaterial({color:n,linewidth:a})),\n//\nthis.matrixAutoUpdate=!1,this.update()}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction SpotLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new BufferGeometry,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,a=1;n<32;n++,a++){var o=n/32*Math.PI*2,s=a/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new Float32BufferAttribute(i,3));var c=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(r,c),this.add(this.cone),this.update()}function SkeletonHelper(e){for(var t=\n/**\n * @author Sean Griffin / http://twitter.com/sgrif\n * @author Michael Guerrero / http://realitymeltdown.com\n * @author mrdoob / http://mrdoob.com/\n * @author ikerr / http://verold.com\n * @author Mugen87 / https://github.com/Mugen87\n */\nfunction getBoneList(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,getBoneList(e.children[r]));return t}(e),r=new BufferGeometry,i=[],n=[],a=new Color(0,0,1),o=new Color(0,1,0),s=0;s<t.length;s++){var c=t[s];c.parent&&c.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}r.addAttribute("position",new Float32BufferAttribute(i,3)),r.addAttribute("color",new Float32BufferAttribute(n,3));var l=new LineBasicMaterial({vertexColors:f,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,r,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */\nfunction PointLightHelper(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var i=new SphereBufferGeometry(t,4,2),n=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}\n/**\n * @author abelnation / http://github.com/abelnation\n * @author Mugen87 / http://github.com/Mugen87\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction RectAreaLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new LineBasicMaterial({fog:!1}),i=new BufferGeometry;i.addAttribute("position",new BufferAttribute(new Float32Array(15),3)),this.line=new Line(i,r),this.add(this.line),this.update()}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\nfunction HemisphereLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new OctahedronBufferGeometry(t);i.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=f);var n=i.getAttribute("position"),a=new Float32Array(3*n.count);i.addAttribute("color",new BufferAttribute(a,3)),this.add(new Mesh(i,this.material)),this.update()}\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nfunction GridHelper(e,t,r,i){e=e||10,t=t||10,r=new Color(void 0!==r?r:4473924),i=new Color(void 0!==i?i:8947848);for(var n=t/2,a=e/t,o=e/2,s=[],c=[],l=0,h=0,u=-o;l<=t;l++,u+=a){s.push(-o,0,u,o,0,u),s.push(u,0,-o,u,0,o);var p=l===n?r:i;p.toArray(c,h),h+=3,p.toArray(c,h),h+=3,p.toArray(c,h),h+=3,p.toArray(c,h),h+=3}var d=new BufferGeometry;d.addAttribute("position",new Float32BufferAttribute(s,3)),d.addAttribute("color",new Float32BufferAttribute(c,3));var m=new LineBasicMaterial({vertexColors:f});LineSegments.call(this,d,m)}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / http://github.com/Mugen87\n * @author Hectate / http://www.github.com/Hectate\n */\nfunction PolarGridHelper(e,t,r,i,n,a){e=e||10,t=t||16,r=r||8,i=i||64,n=new Color(void 0!==n?n:4473924),a=new Color(void 0!==a?a:8947848);var o,s,c,l,h,u,p,d=[],m=[];\n// create the radials\nfor(l=0;l<=t;l++)c=l/t*(2*Math.PI),o=Math.sin(c)*e,s=Math.cos(c)*e,d.push(0,0,0),d.push(o,0,s),p=1&l?n:a,m.push(p.r,p.g,p.b),m.push(p.r,p.g,p.b);\n// create the circles\nfor(l=0;l<=r;l++)for(p=1&l?n:a,u=e-e/r*l,h=0;h<i;h++)\n// first vertex\nc=h/i*(2*Math.PI),o=Math.sin(c)*u,s=Math.cos(c)*u,d.push(o,0,s),m.push(p.r,p.g,p.b),\n// second vertex\nc=(h+1)/i*(2*Math.PI),o=Math.sin(c)*u,s=Math.cos(c)*u,d.push(o,0,s),m.push(p.r,p.g,p.b);var g=new BufferGeometry;g.addAttribute("position",new Float32BufferAttribute(d,3)),g.addAttribute("color",new Float32BufferAttribute(m,3));var v=new LineBasicMaterial({vertexColors:f});LineSegments.call(this,g,v)}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction FaceNormalsHelper(e,t,r,i){\n// FaceNormalsHelper only supports THREE.Geometry\nthis.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");\n//\nvar c=new BufferGeometry,l=new Float32BufferAttribute(2*o*3,3);c.addAttribute("position",l),LineSegments.call(this,c,new LineBasicMaterial({color:n,linewidth:a})),\n//\nthis.matrixAutoUpdate=!1,this.update()}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction DirectionalLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(i,n),this.add(this.lightPlane),(i=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(i,n),this.add(this.targetLine),this.update()}\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author Mugen87 / https://github.com/Mugen87\n *\n *\t- shows frustum, line of sight and up of the camera\n *\t- suitable for fast updates\n * \t- based on frustum visualization in lightgl.js shadowmap example\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\n */\nfunction CameraHelper(e){var t=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:d}),i=[],n=[],a={},o=new Color(16755200),s=new Color(16711680),c=new Color(43775),l=new Color(16777215),h=new Color(3355443);function addLine(e,t,r){addPoint(e,r),addPoint(t,r)}function addPoint(e,t){i.push(0,0,0),n.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}\n// near\naddLine("n1","n2",o),addLine("n2","n4",o),addLine("n4","n3",o),addLine("n3","n1",o),\n// far\naddLine("f1","f2",o),addLine("f2","f4",o),addLine("f4","f3",o),addLine("f3","f1",o),\n// sides\naddLine("n1","f1",o),addLine("n2","f2",o),addLine("n3","f3",o),addLine("n4","f4",o),\n// cone\naddLine("p","n1",s),addLine("p","n2",s),addLine("p","n3",s),addLine("p","n4",s),\n// up\naddLine("u1","u2",c),addLine("u2","u3",c),addLine("u3","u1",c),\n// target\naddLine("c","t",l),addLine("p","c",h),\n// cross\naddLine("cn1","cn2",h),addLine("cn3","cn4",h),addLine("cf1","cf2",h),addLine("cf3","cf4",h),t.addAttribute("position",new Float32BufferAttribute(i,3)),t.addAttribute("color",new Float32BufferAttribute(n,3)),LineSegments.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / http://github.com/Mugen87\n */\nfunction BoxHelper(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(r,1)),n.addAttribute("position",new BufferAttribute(i,3)),LineSegments.call(this,n,new LineBasicMaterial({color:t})),this.matrixAutoUpdate=!1,this.update()}\n/**\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction Box3Helper(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,n,new LineBasicMaterial({color:r})),this.geometry.computeBoundingSphere()}\n/**\n * @author WestLangley / http://github.com/WestLangley\n */\nfunction PlaneHelper(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==r?r:16776960,n=new BufferGeometry;n.addAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),Line.call(this,n,new LineBasicMaterial({color:i}));\n//\nvar a=new BufferGeometry;a.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Mesh(a,new MeshBasicMaterial({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function ArrowHelper(e,t,r,i,n,a){\n// dir is assumed to be normalized\nObject3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),void 0===n&&(n=.2*r),void 0===a&&(a=.2*n),void 0===pr&&((pr=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(dr=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Line(pr,new LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(dr,new MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}\n/**\n * @author sroucheray / http://sroucheray.org/\n * @author mrdoob / http://mrdoob.com/\n */\nfunction AxesHelper(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new BufferGeometry;r.addAttribute("position",new Float32BufferAttribute(t,3)),r.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new LineBasicMaterial({vertexColors:f});LineSegments.call(this,r,i)}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();// bind all binding\nvar r=this._targetGroup.nCachedObjects_,i=this._bindings[r];\n// and only call .getValue on the first\nvoid 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,r):new PropertyBinding(e,t,r)},\n/**\n\t * Replaces spaces with underscores and removes unsupported characters from\n\t * node names, to ensure compatibility with parseTrackName().\n\t *\n\t * @param  {string} name Node name to be sanitized.\n\t * @return {string}\n\t */\nsanitizeNodeName:function(){var e=new RegExp("[\\\\[\\\\]\\\\.:\\\\/]","g");return function sanitizeNodeName(t){return t.replace(/\\s/g,"_").replace(e,"")}}(),parseTrackName:function(){\n// Attempts to allow node names from any language. ES5\'s `\\w` regexp matches\n// only latin characters, and the unicode \\p{L} is not yet supported. So\n// instead, we exclude reserved characters and match everything else.\nvar e="[^\\\\[\\\\]\\\\.:\\\\/]",t="[^"+"\\\\[\\\\]\\\\.:\\\\/".replace("\\\\.","")+"]",r=/((?:WC+[\\/:])*)/.source.replace("WC",e),i=/(WCOD+)?/.source.replace("WCOD",t),n=/(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace("WC",e),a=/\\.(WC+)(?:\\[(.+)\\])?/.source.replace("WC",e),o=new RegExp("^"+r+i+n+a+"$"),s=["material","materials","bones"];return function parseTrackName(e){var t=o.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={\n// directoryName: matches[ 1 ], // (tschw) currently unused\nnodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],// required\npropertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=r.nodeName.substring(i+1);\n// Object names must be checked against a whitelist. Otherwise, there\n// is no way to parse \'foo.bar.baz\': \'baz\' must be a property, but\n// \'bar\' could be the objectName, or part of a nodeName (which can\n// include \'.\' characters).\n-1!==s.indexOf(n)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;\n// search into skeleton bones.\nif(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}\n// search into node subtree.\nif(e.children){var i=function(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.name===t||n.uuid===t)return n;var a=i(n.children);if(a)return a}return null},n=i(e.children);if(n)return n}return null}}),Object.assign(PropertyBinding.prototype,{// prototype, continued\n// these are used to "bind" a nonexistent property\n_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(e,t){e[t]=this.node[this.propertyName]},function getValue_array(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)e[t++]=r[i]},function getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[\n// Direct\nfunction setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]},function setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[\n// EntireArray\nfunction setValue_array(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++]},function setValue_array_setNeedsUpdate(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[\n// ArrayElement\nfunction setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[\n// HasToFromArray\nfunction setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)},function setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function getValue_unbound(e,t){this.bind(),this.getValue(e,t)},setValue:function getValue_unbound(e,t){this.bind(),this.setValue(e,t)},\n// create getter / setter pair for a property in the scene graph\nbind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;\n// ensure there is a value node\nif(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),\n// set fail state so we can just \'return\' on error\nthis.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=t.objectIndex;\n// special cases were we need to reach deeper into the hierarchy to get the face materials....\nswitch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);\n// potential future optimization: skip this if propertyIndex is already an integer\n// and convert the integer string to a true integer.\ne=e.skeleton.bones;\n// support resolving morphTarget names into indices.\nfor(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}\n// resolve property\nvar s=e[i];if(void 0!==s){\n// determine versioning scheme\nvar c=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?// material\nc=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(// node transform\nc=this.Versioning.MatrixWorldNeedsUpdate);\n// determine how the property gets bound\nvar l=this.BindingType.Direct;if(void 0!==n){\n// access a sub element of the property array (only primitives are supported right now)\nif("morphTargetInfluences"===i){\n// potential optimization, skip this if propertyIndex is already an integer, and convert the integer string to a true integer.\n// support resolving morphTarget names into indices.\nif(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===n){n=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===n){n=o;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(\n// must use copy for Object3D.Euler/Quaternion\nl=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;\n// select getter / setter\nthis.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var h=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn\'t found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn\'t found.")},unbind:function(){this.node=null,\n// back to the prototype version of getValue / setValue\n// note: avoiding to mutate the shape of \'this\' via \'delete\'\nthis.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),\n//!\\ DECLARE ALIAS AFTER assign prototype !\nObject.assign(PropertyBinding.prototype,{\n// initial state of these methods that calls \'bind\'\n_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(\n/**\n *\n * A group of objects that receives a shared animation state.\n *\n * Usage:\n *\n * \t-\tAdd objects you would otherwise pass as \'root\' to the\n * \t\tconstructor or the .clipAction method of AnimationMixer.\n *\n * \t-\tInstead pass this object as \'root\'.\n *\n * \t-\tYou can also add and remove objects later when the mixer\n * \t\tis running.\n *\n * Note:\n *\n *  \tObjects of this class appear as one object to the mixer,\n *  \tso cache control of the individual objects must be done\n *  \ton the group.\n *\n * Limitation:\n *\n * \t- \tThe animated properties must be compatible among the\n * \t\tall objects in the group.\n *\n *  -\tA single property can either be controlled through a\n *  \ttarget group or directly, but not both.\n *\n * @author tschw\n */\nfunction AnimationObjectGroup(){this.uuid=_t.generateUUID(),\n// cached objects followed by the active ones\nthis._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;// threshold\n// note: read by PropertyBinding.Composite\nvar e={};this._indicesByUUID=e;// for bookkeeping\nfor(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],// inside: string\nthis._parsedPaths=[],// inside: { we don\'t care, here }\nthis._bindings=[],// inside: Array< PropertyBinding >\nthis._bindingsIndicesByPath={};// inside: indices in these arrays\nvar i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,c=void 0,l=0,h=arguments.length;l!==h;++l){var u=arguments[l],p=u.uuid,d=i[p];if(void 0===d){\n// unknown object -> add it to the ACTIVE region\nd=t++,i[p]=d,e.push(u);\n// accounting is done, now do the same for all bindings\nfor(var f=0,m=s;f!==m;++f)o[f].push(new PropertyBinding(u,n[f],a[f]))}else if(d<r){c=e[d];\n// move existing object to the ACTIVE region\nvar g=--r,v=e[g];i[v.uuid]=d,e[d]=v,i[p]=g,e[g]=u;\n// accounting is done, now do the same for all bindings\nfor(f=0,m=s;f!==m;++f){var y=o[f],x=y[g],b=y[d];y[d]=x,void 0===b&&(\n// since we do not bother to create new bindings\n// for objects that are cached, the binding may\n// or may not exist\nb=new PropertyBinding(u,n[f],a[f])),y[g]=b}}else e[d]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.");// else the object is already where we want it to be\n}// for arguments\nthis.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,n=i.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],c=s.uuid,l=r[c];if(void 0!==l&&l>=t){\n// move existing object into the CACHED region\nvar h=t++,u=e[h];r[u.uuid]=l,e[l]=u,r[c]=h,e[h]=s;\n// accounting is done, now do the same for all bindings\nfor(var p=0,d=n;p!==d;++p){var f=i[p],m=f[h],g=f[l];f[l]=m,f[h]=g}}}// for arguments\nthis.nCachedObjects_=t},\n// remove & forget\nuncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o].uuid,l=i[c];if(void 0!==l)if(delete i[c],l<r){\n// object is cached, shrink the CACHED region\nvar h=--r,u=e[h],p=e[v=--t];\n// last cached object takes this object\'s place\ni[u.uuid]=l,e[l]=u,\n// last object goes to the activated slot and pop\ni[p.uuid]=h,e[h]=p,e.pop();\n// accounting is done, now do the same for all bindings\nfor(var d=0,f=a;d!==f;++d){var m=(y=n[d])[h],g=y[v];y[l]=m,y[h]=g,y.pop()}}else{\n// object is active, just swap with the last and pop\nvar v;i[(p=e[v=--t]).uuid]=l,e[l]=p,e.pop();\n// accounting is done, now do the same for all bindings\nfor(d=0,f=a;d!==f;++d){var y;(y=n[d])[l]=y[v],y.pop()}}// cached or active\n// if object is known\n}// for arguments\nthis.nCachedObjects_=r},\n// Internal interface used by befriended PropertyBinding.Composite:\nsubscribe_:function(e,t){\n// returns an array of bindings for the given path that is changed\n// according to the contained objects in the group\nvar r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(void 0!==i)return n[i];var a=this._paths,o=this._parsedPaths,s=this._objects,c=s.length,l=this.nCachedObjects_,h=new Array(c);i=n.length,r[e]=i,a.push(e),o.push(t),n.push(h);for(var u=l,p=s.length;u!==p;++u){var d=s[u];h[u]=new PropertyBinding(d,e,t)}return h},unsubscribe_:function(e){\n// tells the group to forget about a property path and no longer\n// update the array previously obtained with \'subscribe_\'\nvar t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var i=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=r,a[r]=s,a.pop(),n[r]=n[o],n.pop(),i[r]=i[o],i.pop()}}}),Object.assign(AnimationAction.prototype,{\n// State & Scheduling\nplay:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){// forget scheduling\nreturn this.paused=!1,this.enabled=!0,this.time=0,// restart clip\nthis._loopCount=-1,// forget previous loops\nthis._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},\n// return true when play has been called\nisScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},\n// Weight\n// set the weight stopping any scheduled fading\n// although .enabled = false yields an effective weight of zero, this\n// method does *not* change .enabled, because it would be confusing\nsetEffectiveWeight:function(e){return this.weight=e,\n// note: same logic as when updated at runtime\nthis._effectiveWeight=this.enabled?e:0,this.stopFading()},\n// return the weight considering fading and .enabled\ngetEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,n=e._clip.duration,a=n/i,o=i/n;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},\n// Time Scale Control\n// set the time scale stopping any scheduled warping\n// although .paused = true yields an effective time scale of zero, this\n// method does *not* change .paused, because it would be confusing\nsetEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},\n// return the time scale considering warping and .paused\ngetEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,n=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,c=a.sampleValues;return s[0]=n,s[1]=n+r,c[0]=e/o,c[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},\n// Object Accessors\ngetMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},\n// Interna\n_update:function(e,t,r,i){\n// called by the mixer\nif(this.enabled){var n=this._startTime;if(null!==n){\n// check for scheduled start of action\nvar a=(e-n)*r;if(a<0||0===r)return;// yet to come / don\'t decide when delta = 0\n// start\nthis._startTime=null,// unschedule\nt=r*a}\n// apply time scale and advance time\nt*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);\n// note: _updateTime may disable the action resulting in\n// an effective weight of 0\nif(s>0)for(var c=this._interpolants,l=this._propertyBindings,h=0,u=c.length;h!==u;++h)c[h].evaluate(o),l[h].accumulate(i,s)}else\n// call ._updateWeight() to update ._effectiveWeight\nthis._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(\n// faded out, disable\nthis.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?\n// motion has halted, pause\nthis.paused=!0:\n// warp done - apply final time scale\nthis.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,i=this.loop,n=this._loopCount,a=2202===i;if(0===e)return-1===n?t:a&&1==(1&n)?r-t:t;if(2200===i){-1===n&&(\n// just started\nthis._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(// repetitive Repeat or PingPong\n-1===n&&(\n// just started\ne>=0?(n=0,this._setEndings(!0,0===this.repetitions,a)):\n// when looping in reverse direction, the initial\n// transition through zero counts as a repetition,\n// so leave loopCount at -1\nthis._setEndings(0===this.repetitions,!0,a)),t>=r||t<0){\n// wrap around\nvar o=Math.floor(t/r);// signed\nt-=r*o,n+=Math.abs(o);var s=this.repetitions-n;if(s<=0)\n// have to stop (switch state, clamp time, fire event)\nthis.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{\n// keep running\nif(1===s){\n// entering the last round\nvar c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&1==(1&n))\n// invert time for the "pong round"\nreturn this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=2401,i.endingEnd=2401):(\n// assuming for LoopOnce atStart == atEnd == true\ni.endingStart=e?this.zeroSlopeAtStart?2401:ot:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:ot:2402)},_scheduleFading:function(e,t,r){var i=this._mixer,n=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=t,o[1]=n+e,s[1]=r,this}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,c=this._bindingsByRootAndName,l=c[s];void 0===l&&(l={},c[s]=l);for(var h=0;h!==n;++h){var u=i[h],p=u.name,d=l[p];if(void 0!==d)a[h]=d;else{if(void 0!==(d=a[h])){\n// existing binding, make sure the cache knows\nnull===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=t&&t._propertyBindings[h].binding.parsedPath;++(d=new PropertyMixer(PropertyBinding.create(r,p,f),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),a[h]=d}o[h].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){\n// this action has been forgotten by the cache, but the user\n// appears to be still using it -> rebind\nvar t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}\n// increment reference counts / sort out state\nfor(var n=e._propertyBindings,a=0,o=n.length;a!==o;++a){var s=n[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){\n// decrement reference counts / sort out state\nfor(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},\n// Memory manager\n_initMemoryManager:function(){this._actions=[],// \'nActiveActions\' followed by inactive ones\nthis._nActiveActions=0,this._actionsByClip={},\n// inside:\n// {\n// \t\tknownActions: Array< AnimationAction >\t- used as prototypes\n// \t\tactionByRoot: AnimationAction\t\t\t- lookup\n// }\nthis._bindings=[],// \'nActiveBindings\' followed by inactive ones\nthis._nActiveBindings=0,this._bindingsByRootAndName={},// inside: Map< name, PropertyMixer >\nthis._controlInterpolants=[],// same game as above\nthis._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},\n// Memory management for AnimationAction objects\n_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,n=this._actionsByClip,a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,c=s[s.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,s[l]=c,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){\n// [ active actions |  inactive actions  ]\n// [  active actions >| inactive actions ]\n//                 s        a\n//                  <-swap->\n//                 a        s\nvar t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackAction:function(e){\n// [  active actions  | inactive actions ]\n// [ active actions |< inactive actions  ]\n//        a        s\n//         <-swap->\n//        s        a\nvar t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},\n// Memory management for PropertyMixer objects\n_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,n=i[t],a=this._bindings;void 0===n&&(n={},i[t]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete o[n];e:{for(var l in o)break e;// eslint-disable-line no-unused-vars\ndelete a[i]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},\n// Memory management of Interpolants for weight and time scale\n_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n},_controlInterpolantsResultBuffer:new Float32Array(1),\n// return an action for a clip optionally using a custom root target\n// object (this method allocates a lot of dynamic memory in case a\n// previously unknown clip/root combination is specified)\nclipAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?AnimationClip.findByName(r,e):e,a=null!==n?n.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var c=o.actionByRoot[i];if(void 0!==c)return c;\n// we know the clip, so we don\'t have to parse all\n// the bindings again but can just copy\ns=o.knownActions[0],\n// also, take the clip from the prototype action\nnull===n&&(n=s._clip)}\n// clip must be known when specified via string\nif(null===n)return null;\n// allocate all resources required to run it\nvar l=new AnimationAction(this,n,t);return this._bindAction(l,s),\n// and make the action known to the memory manager\nthis._addInactiveAction(l,a,i),l},\n// get an existing action\nexistingAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?AnimationClip.findByName(r,e):e,a=n?n.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null},\n// deactivates all previously scheduled actions\nstopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(n=0;n!==i;++n)r[n].useCount=0;return this},\n// advance the time and update apply the animation\nupdate:function(e){e*=this.timeScale;\n// run active actions\nfor(var t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o){t[o]._update(i,e,n,a)}\n// update scene graph\nvar s=this._bindings,c=this._nActiveBindings;for(o=0;o!==c;++o)s[o].apply(a);return this},\n// return this mixer\'s root target object\ngetRoot:function(){return this._root},\n// free all resources specific to a particular clip\nuncacheClip:function(e){var t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){for(\n// note: just calling _removeInactiveAction would mess up the\n// iteration state and also require updating the state we can\n// just throw away\nvar a=n.knownActions,o=0,s=a.length;o!==s;++o){var c=a[o];this._deactivateAction(c);var l=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=l,t[l]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[r]}},\n// free all resources specific to a particular root target object\nuncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var n=r[i].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},\n// remove a targeted clip from the cache\nuncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author bhouston / http://clara.io/\n * @author stephomi / http://stephaneginier.com/\n */\nfunction Raycaster(e,t,r,i){this.ray=new Ray(e,t),\n// direction is assumed to be normalized (for accurate distance calculations)\nthis.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}.prototype,{linePrecision:1,set:function(e,t){\n// direction is assumed to be normalized (for accurate distance calculations)\nthis.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),// set origin in plane of camera\nthis.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var i=r||[];return intersectObject(e,this,i,t),i.sort(ascSort),i},intersectObjects:function(e,t,r){var i=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,a=e.length;n<a;n++)intersectObject(e[n],this,i,t);return i.sort(ascSort),i}}),Object.assign(\n/**\n * @author alteredq / http://alteredqualia.com/\n */\nfunction Clock(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),// see #10732\nthis.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(\n/**\n * @author bhouston / http://clara.io\n * @author WestLangley / http://github.com/WestLangley\n *\n * Ref: https://en.wikipedia.org/wiki/Spherical_coordinate_system\n *\n * The polar angle (phi) is measured from the positive y-axis. The positive y-axis is up.\n * The azimuthal angle (theta) is measured from the positive z-axiz.\n */\nfunction Spherical(e,t,r){// azimuthal angle\nreturn this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,// polar angle\nthis.theta=void 0!==r?r:0,this}.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},\n// restrict phi to be betwee EPS and PI-EPS\nmakeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(_t.clamp(t/this.radius,-1,1))),this}}),Object.assign(\n/**\n * @author Mugen87 / https://github.com/Mugen87\n *\n * Ref: https://en.wikipedia.org/wiki/Cylindrical_coordinate_system\n *\n */\nfunction Cylindrical(e,t,r){// height above the x-z plane\nreturn this.radius=void 0!==e?e:1,// distance from the origin to a point in the x-z plane\nthis.theta=void 0!==t?t:0,// counterclockwise angle in the x-z plane measured in radians from the positive z-axis\nthis.y=void 0!==r?r:0,this}.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector2;return function setFromCenterAndSize(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){\n// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\nreturn this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){\n// This can potentially have a divide by zero if the box\n// has a size dimension of 0.\nreturn void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){\n// using 4 splitting planes to rule out intersections\nreturn!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector2;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new Vector3,t=new Vector3;return function closestPointToPointParameter(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),a=t.dot(e)/n;return i&&(a=_t.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0,VertexNormalsHelper.prototype=Object.create(LineSegments.prototype),VertexNormalsHelper.prototype.constructor=VertexNormalsHelper,VertexNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,r=new Matrix3;return function update(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,c=o.faces,l=0,h=0,u=c.length;h<u;h++)for(var p=c[h],d=0,f=p.vertexNormals.length;d<f;d++){var m=s[p[i[d]]],g=p.vertexNormals[d];e.copy(m).applyMatrix4(n),t.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(l,e.x,e.y,e.z),l+=1,a.setXYZ(l,t.x,t.y,t.z),l+=1}else if(o&&o.isBufferGeometry){var v=o.attributes.position,y=o.attributes.normal;\n// for simplicity, ignore index and drawcalls, and render every normal\nfor(l=0,d=0,f=v.count;d<f;d++)e.set(v.getX(d),v.getY(d),v.getZ(d)).applyMatrix4(n),t.set(y.getX(d),y.getY(d),y.getZ(d)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(l,e.x,e.y,e.z),l+=1,a.setXYZ(l,t.x,t.y,t.z),l+=1}a.needsUpdate=!0}}(),SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3;return function update(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(){var e=new Vector3,t=new Matrix4,r=new Matrix4;return function updateMatrixWorld(i){var n=this.bones,a=this.geometry,o=a.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,c=0;s<n.length;s++){var l=n[s];l.parent&&l.parent.isBone&&(t.multiplyMatrices(r,l.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(c,e.x,e.y,e.z),t.multiplyMatrices(r,l.parent.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(c+1,e.x,e.y,e.z),c+=2)}a.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,i)}}(),PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)\n/*\n\tvar d = this.light.distance;\n\n\tif ( d === 0.0 ) {\n\n\t\tthis.lightDistance.visible = false;\n\n\t} else {\n\n\t\tthis.lightDistance.visible = true;\n\t\tthis.lightDistance.scale.set( d, d, d );\n\n\t}\n\t*/},RectAreaLightHelper.prototype=Object.create(Object3D.prototype),RectAreaLightHelper.prototype.constructor=RectAreaLightHelper,RectAreaLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},RectAreaLightHelper.prototype.update=function(){\n// calculate new dimensions of the helper\nvar e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,i=r.array;\n// update vertices\ni[0]=e,i[1]=-t,i[2]=0,i[3]=e,i[4]=t,i[5]=0,i[6]=-e,i[7]=t,i[8]=0,i[9]=-e,i[10]=-t,i[11]=0,i[12]=e,i[13]=-t,i[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var e=new Vector3,t=new Color,r=new Color;return function update(){var i=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=i.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var a=0,o=n.count;a<o;a++){var s=a<o/2?t:r;n.setXYZ(a,s.r,s.g,s.b)}n.needsUpdate=!0}i.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),GridHelper.prototype=Object.create(LineSegments.prototype),GridHelper.prototype.constructor=GridHelper,PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper,FaceNormalsHelper.prototype=Object.create(LineSegments.prototype),FaceNormalsHelper.prototype.constructor=FaceNormalsHelper,FaceNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,r=new Matrix3;return function update(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,n=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,c=0,l=0,h=s.length;l<h;l++){var u=s[l],p=u.normal;e.copy(o[u.a]).add(o[u.b]).add(o[u.c]).divideScalar(3).applyMatrix4(i),t.copy(p).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),n.setXYZ(c,e.x,e.y,e.z),c+=1,n.setXYZ(c,t.x,t.y,t.z),c+=1}n.needsUpdate=!0}}(),DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function update(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var e,t,r=new Vector3,i=new Camera;function setPoint(n,a,o,s){r.set(a,o,s).unproject(i);var c=t[n];if(void 0!==c)for(var l=e.getAttribute("position"),h=0,u=c.length;h<u;h++)l.setXYZ(c[h],r.x,r.y,r.z)}return function update(){e=this.geometry,t=this.pointMap;\n// we need just camera projection matrix\n// world matrix must be identity\ni.projectionMatrix.copy(this.camera.projectionMatrix),\n// center / target\nsetPoint("c",0,0,-1),setPoint("t",0,0,1),\n// near\nsetPoint("n1",-1,-1,-1),setPoint("n2",1,-1,-1),setPoint("n3",-1,1,-1),setPoint("n4",1,1,-1),\n// far\nsetPoint("f1",-1,-1,1),setPoint("f2",1,-1,1),setPoint("f3",-1,1,1),setPoint("f4",1,1,1),\n// up\nsetPoint("u1",.7,1.1,-1),setPoint("u2",-.7,1.1,-1),setPoint("u3",0,2,-1),\n// cross\nsetPoint("cf1",-1,0,1),setPoint("cf2",1,0,1),setPoint("cf3",0,-1,1),setPoint("cf4",0,1,1),setPoint("cn1",-1,0,-1),setPoint("cn2",1,0,-1),setPoint("cn3",0,-1,-1),setPoint("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(){var e=new Box3;return function update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,i=e.max,n=this.geometry.attributes.position,a=n.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=r.x,a[4]=i.y,a[5]=i.z,a[6]=r.x,a[7]=r.y,a[8]=i.z,a[9]=i.x,a[10]=r.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=r.z,a[15]=r.x,a[16]=i.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=i.x,a[22]=r.y,a[23]=r.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),BoxHelper.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,e))},PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),// sign does not matter\nthis.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?h:l,// renderer flips side when determinant < 0; flipping not wanted here\nthis.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,e)},ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=function(){var e,t=new Vector3;return function setDirection(r){\n// dir is assumed to be normalized\nr.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper;\n//\nfunction Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}\n//\nCurve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},\n//\nObject.assign(CurvePath.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");\n// generate geometry from path points (for Line or Points objects)\nvar t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");\n// generate geometry from equidistant sampling along the path\nvar t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Geometry,r=0,i=e.length;r<i;r++){var n=e[r];t.vertices.push(new Vector3(n.x,n.y,n.z||0))}return t}}),\n//\nObject.assign(Path.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(CatmullRomCurve3.prototype),Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},\n//\nObject.assign(Loader.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),or(e)}}),Object.assign(JSONLoader.prototype,{setTexturePath:function(e){return console.warn("THREE.JSONLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),\n//\nObject.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(_t,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),_t.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),_t.ceilPowerOfTwo(e)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e/*, offset, length */){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function getPosition(){return void 0===e&&(e=new Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e/*, offset, length */){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,i,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,n,a)}}),Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Triangle,{barycoordFromPoint:function(e,t,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,r,i,n)},normal:function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,r,i)}}),Object.assign(Shape.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}}),Object.assign(Vector2.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),\n//\nObject.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),\n//\nPerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},\n//\nObject.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),\n//\nObject.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),\n//\nObject.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),\n//\nObject.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),\n//\nObject.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),\n//\nObject.assign(WebGLRenderer.prototype,{clearTarget:function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( \'OES_texture_float\' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( \'OES_texture_half_float\' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( \'OES_standard_derivatives\' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( \'WEBGL_compressed_texture_s3tc\' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( \'WEBGL_compressed_texture_pvrtc\' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( \'EXT_blend_minmax\' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( \'ANGLE_instanced_arrays\' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),\n//\nObject.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),\n//\nObject.defineProperties(WebVRManager.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),\n//\nAudio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new AudioLoader).load(e,function(e){t.setBuffer(e)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},\n//\nCubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};Mt.crossOrigin=void 0,Mt.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new TextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a},Mt.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a},Mt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Mt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const fr={unknown:-1,isLoading:0,visibleAndLoaded:1,hiddenAndLoaded:2,unloaded:3},mr=Object.freeze({setDirty:1,dataRequest:2,init:3,dataResponse:4,assignLayers:5,doneDirtyObjects:6});\n// CONCATENATED MODULE: ./staging/CullingCore.js\nvar gr,vr,yr=function(e,t,r){const i=e,n=t,a=r;var o,s,c,l,h,u=0,p=u,d=0;const f=Math.PI/180;function computeLayer(e,t,r,i,n,a,o,s){e.applyMatrix4(t);const c=e.radius/(Math.tan(n*f/2)*i.distanceTo(e.center))*r;return s&&c<o?fr.unloaded:c<a?fr.hiddenAndLoaded:fr.visibleAndLoaded}const m=function(){};function maybeRequestNextDataBatch(){const e=p-u;e>0?(d++,i(u,e,handleResponseData)):a()}function handleResponseData(e,t,r,i){d--;const a=new Vector3(e[0],e[1],e[2]),f=[];var m;for(m=0;m<i;m++){const e=r[m],i=new Matrix4;i.elements=e.worldMatrix;const n=computeLayer(new Sphere(new Vector3(e.boundingSphere.x,e.boundingSphere.y,e.boundingSphere.z),e.boundingSphere.radius),i,l,a,t,s,c,h);n!==e.currentLayer&&f.push({psid:e.psid,newLayer:n})}f.length>0&&n(f),(u+=i)>=o&&(u%=o,p%=o),maybeRequestNextDataBatch()}return m.prototype.setDirty=function(e,t,r,i,n){s=e,c=t,p=u+r,o=r,l=i,h=n,d<=0&&maybeRequestNextDataBatch()},new m};/* harmony default export */function CullingWorker_requestNextBatch(e,t,r){gr=r,self.postMessage({type:mr.dataRequest,startIndex:e,numDirtyObjsRemaining:t})}function CullingWorker_assignLayers(e){self.postMessage({type:mr.assignLayers,newLayers:e})}function CullingWorker_doneDirtyObjects(){self.postMessage({type:mr.doneDirtyObjects})}\n// CONCATENATED MODULE: ./staging/CullingWorker.js\nself.addEventListener("error",function(e){throw e}),self.addEventListener("message",function(e){const t=e.data;t.type===mr.init?vr=new yr(CullingWorker_requestNextBatch,CullingWorker_assignLayers,CullingWorker_doneDirtyObjects):t.type===mr.setDirty?vr.setDirty(t.boundarySize1Px,t.boundarySize2Px,t.numObjs,t.screenHeightPx,t.allowUnloading):t.type===mr.dataResponse&&(gr(t.cameraPosition,t.cameraFov,t.data,t.dataUsedLength),self.requestNextBatchCallback=null)})}\n/******/]);\n//# sourceMappingURL=plmvisweb.worker.min.js.map',null)};
/***/},
/* 134 */
/***/function(e,t,n){e.exports=function(){return n(12)('//Â© 2016 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC\n/******/!function(e){// webpackBootstrap\n/******/ // The module cache\n/******/var t={};\n/******/\n/******/ // The require function\n/******/function __webpack_require__(r){\n/******/\n/******/ // Check if module is in cache\n/******/if(t[r])\n/******/return t[r].exports;\n/******/\n/******/ // Create a new module (and put it into the cache)\n/******/var n=t[r]={\n/******/i:r,\n/******/l:!1,\n/******/exports:{}\n/******/};\n/******/\n/******/ // Execute the module function\n/******/\n/******/\n/******/ // Return the exports of the module\n/******/return e[r].call(n.exports,n,n.exports,__webpack_require__),\n/******/\n/******/ // Flag the module as loaded\n/******/n.l=!0,n.exports;\n/******/}\n/******/\n/******/\n/******/ // expose the modules object (__webpack_modules__)\n/******/\n/******/\n/******/\n/******/ // Load entry module and return exports\n/******/__webpack_require__.m=e,\n/******/\n/******/ // expose the module cache\n/******/__webpack_require__.c=t,\n/******/\n/******/ // define getter function for harmony exports\n/******/__webpack_require__.d=function(e,t,r){\n/******/__webpack_require__.o(e,t)||\n/******/Object.defineProperty(e,t,{\n/******/configurable:!1,\n/******/enumerable:!0,\n/******/get:r\n/******/})\n/******/},\n/******/\n/******/ // define __esModule on exports\n/******/__webpack_require__.r=function(e){\n/******/Object.defineProperty(e,"__esModule",{value:!0});\n/******/},\n/******/\n/******/ // getDefaultExport function for compatibility with non-harmony modules\n/******/__webpack_require__.n=function(e){\n/******/var t=e&&e.__esModule?\n/******/function getDefault(){return e.default}:\n/******/function getModuleExports(){return e};\n/******/\n/******/return __webpack_require__.d(t,"a",t),t;\n/******/},\n/******/\n/******/ // Object.prototype.hasOwnProperty.call\n/******/__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},\n/******/\n/******/ // __webpack_public_path__\n/******/__webpack_require__.p="./",__webpack_require__(__webpack_require__.s=1);\n/******/}\n/************************************************************************/\n/******/([\n/* 0 */\n/***/function(e,t,r){\n/* WEBPACK VAR INJECTION */(function(n){/* eslint-env browser */\n/**\n * This is the web browser implementation of `debug()`.\n */\nt.log=\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a "function".\n *\n * @api public\n */\nfunction log(...e){\n// This hackery is required for IE8/9, where\n// the `console.log` function doesn\'t have \'apply\'\nreturn"object"==typeof console&&console.log&&console.log(...e)}\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */,t.formatArgs=\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\nfunction formatArgs(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");\n// The final "%c" is somewhat tricky, because there could be other\n// arguments passed either before or after the %c, so we need to\n// figure out the correct index to insert the CSS into\nlet n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&"%c"===e&&(\n// We only are interested in the *last* %c\n// (the user may have provided their own)\ns=++n)}),t.splice(s,0,r)},t.save=function save(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){\n// Swallow\n// XXX (@Qix-) should we be logging these?\n}}\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */,t.load=function load(){let e;try{e=t.storage.getItem("debug")}catch(e){\n// Swallow\n// XXX (@Qix-) should we be logging these?\n}\n// If debug isn\'t set in LS, and we\'re in Electron, try to load $DEBUG\n!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e}\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */,t.useColors=\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support "%c" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n// eslint-disable-next-line complexity\nfunction useColors(){\n// NB: In an Electron preload script, document will be defined but not fully\n// initialized. Since we know we\'re in Chrome, we\'ll just detect this case\n// explicitly\nif("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;\n// Internet Explorer and Edge do not support colors.\nif("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;\n// Is webkit? http://stackoverflow.com/a/16459606/376773\n// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\nreturn"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\n// Is firebug? http://stackoverflow.com/a/398120/376773\n"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\n// Is firefox >= v31?\n// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\n// Double check webkit in userAgent just in case we are in a worker\n"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},t.storage=function localstorage(){try{\n// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n// The Browser also has localStorage in the global context.\nreturn localStorage}catch(e){\n// Swallow\n// XXX (@Qix-) should we be logging these?\n}}(),\n/**\n * Colors.\n */\nt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(3)(t);const{formatters:s}=e.exports;\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(4))\n/***/},\n/* 1 */\n/***/function(e,t,r){"use strict";r.r(t);\n// EXTERNAL MODULE: ./node_modules/debug/src/browser.js\nvar n=r(0),s=/* */r.n(n),a=s()("PLMVisWeb:error:BodWorker");a.enabled=!0;var o=s()("PLMVisWeb:warning:BodWorker"),f={normalize:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},cross:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},subtract:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},add:function(e,t,r){return void 0===r?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:[e[0]+t[0]+r[0],e[1]+t[1]+r[1],e[2]+t[2]+r[2]]},scale:function(e,t){return[e[0]*t,e[1]*t,e[2]*t]},interpolate:function(e,t,r,n,s,a){return this.add(this.scale(e,n),this.scale(t,s),this.scale(r,a))},product:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},norm:function(e){return Math.sqrt(this.product(e,e))},angle:function(e,t){var r=this.product(e,t),n=this.norm(e),s=this.norm(t);return 180*Math.acos(r/(n*s))/Math.PI}};function _finalizeResults(e,t){e&&(t.push(e.controlPointIndex.buffer),t.push(e.controlPointBuffer.buffer),t.push(e.normalIndex.buffer),t.push(e.normalBuffer.buffer),t.push(e.vertexIndex.buffer),t.push(e.vertexBuffer.buffer),t.push(e.groupCountBuffer.buffer),t.push(e.groupStartBuffer.buffer))}var u=1/255;function _getXTBody(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r].bodyId===t)return e[r];var s={bodyId:t,faces:[]};return e.push(s),s}function _processCurvedTrianglesFlat(e,t){var r,n=e.dv,s=e.results.buffers[e.results.buffers.length-1],a=0,o=s.numGroups,f=0,u=0,i=0,l=0,p=null,d=null,c=null,g=null,b=0,h=null,y=null,x=null;s.vertexBuffer=[],s.normalBuffer=[],s.indexBuffer=[],s.groupStartBuffer=[],s.groupCountBuffer=[],s.materialIndexBuffer=[],t&&(x=[],[],s.xtBodies=x),p=s.vertexBuffer,d=s.normalBuffer,c=s.indexBuffer,g=s.groupStartBuffer,h=s.groupCountBuffer,y=s.materialIndexBuffer,s.hasVertexColors?(s.vertexColorBuffer=[],s.vertexColorBuffer):s.hasTextureUVs&&(s.uvCoordinatesBuffer=[],s.uvCoordinatesBuffer);var v=[];for(a=0;a<o;++a){var m=null;if(t){(m={}).faceId=n.getInt32(e.byteOffset,!0),e.byteOffset+=4;var C=n.getUint16(e.byteOffset,!0);e.byteOffset+=2,m.bodyId=C,_getXTBody(x,C).faces.push(m)}i=n.getInt32(e.byteOffset,!0),e.byteOffset+=4,y.push(i),f=n.getUint32(e.byteOffset,!0),e.byteOffset+=4,m&&(m.start=c.length,m.groupIndex=g.length),g.push(c.length),b=0;for(var O=0;O<f;++O)c.push(n.getUint32(e.byteOffset,!0)/3),e.byteOffset+=4,e.byteOffset+=4,v.push(n.getUint32(e.byteOffset,!0)/3),e.byteOffset+=4,b++,l++;m&&(m.count=b),h.push(b)}for(r=n.getUint32(e.byteOffset,!0),e.byteOffset+=4,u=0;u<r;++u)p.push(n.getFloat32(e.byteOffset,!0)),p.push(n.getFloat32(e.byteOffset+4,!0)),p.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var B=n.getUint32(e.byteOffset,!0);e.byteOffset+=4,e.byteOffset+=12*B;var F=n.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var w=[],I=0;I<F;++I)w.push(n.getFloat32(e.byteOffset,!0)),w.push(n.getFloat32(e.byteOffset+4,!0)),w.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var U=c.length;d[p.length-1]=void 0;for(var M=0;M<U;++M)void 0===d[3*c[M]]?(d[3*c[M]]=w[3*v[M]],d[3*c[M]+1]=w[3*v[M]+1],d[3*c[M]+2]=w[3*v[M]+2]):(p.push(p[3*c[M]]),p.push(p[3*c[M]+1]),p.push(p[3*c[M]+2]),d.push(w[3*v[M]]),d.push(w[3*v[M]+1]),d.push(w[3*v[M]+2]),c[M]=p.length/3-1);return s.maxIdx=l,s}function _processCurvedTriangles(e,t){var r=6;(function isNumeric(e){return!isNaN(e)&&isFinite(e)})(e.lod)&&(r=e.lod);var n=e.dv,s=e.results.buffers[e.results.buffers.length-1];e.curvedBuffers={controlPointIndex:[],controlPointBuffer:[],normalIndex:[],normalBuffer:[],vertexIndex:[],vertexBuffer:[],groupCountBuffer:[],groupStartBuffer:[],lod:r};var a,o=e.curvedBuffers,f=0,u=s.numGroups,i=0,l=0,p=0,d=0,c=null,g=null,b=null,h=null,y=0,x=null,v=null,m=null;s.vertexBuffer=[],s.normalBuffer=[],s.indexBuffer=[],s.groupStartBuffer=[],s.groupCountBuffer=[],s.materialIndexBuffer=[],t&&(m=[],[],s.xtBodies=m),c=s.vertexBuffer,g=s.normalBuffer,b=s.indexBuffer,h=s.groupStartBuffer,x=s.groupCountBuffer,v=s.materialIndexBuffer,o.groupCountBuffer=x,o.groupStartBuffer=h,s.hasVertexColors?(s.vertexColorBuffer=[],s.vertexColorBuffer):s.hasTextureUVs&&(s.uvCoordinatesBuffer=[],s.uvCoordinatesBuffer);var C=o.controlPointIndex,O=o.normalIndex,B=o.vertexIndex;for(f=0;f<u;++f){var F=null;if(t){(F={}).faceId=n.getInt32(e.byteOffset,!0),e.byteOffset+=4;var w=n.getUint16(e.byteOffset,!0);e.byteOffset+=2,F.bodyId=w,_getXTBody(m,w).faces.push(F)}p=n.getInt32(e.byteOffset,!0),e.byteOffset+=4,v.push(p),i=n.getUint32(e.byteOffset,!0),e.byteOffset+=4,F&&(F.start=B.length*(r+1)*(r+1),F.groupIndex=h.length),h.push(B.length*(r+1)*(r+1)),y=0;for(var I=0;I<i;++I)B.push(n.getUint32(e.byteOffset,!0)/3),C.push(n.getUint32(e.byteOffset+4,!0)/3),e.byteOffset+=8,s.curvedUseNormal&&(O.push(n.getUint32(e.byteOffset,!0)/3),e.byteOffset+=4),y+=(r+1)*(r+1),d+=(r+1)*(r+1);F&&(F.count=y),x.push(y)}a=n.getUint32(e.byteOffset,!0),e.byteOffset+=4;var U=o.vertexBuffer;for(l=0;l<a;++l)U.push(n.getFloat32(e.byteOffset,!0)),U.push(n.getFloat32(e.byteOffset+4,!0)),U.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var M=n.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var _=o.controlPointBuffer,D=0;D<M;++D)_.push(n.getFloat32(e.byteOffset,!0)),_.push(n.getFloat32(e.byteOffset+4,!0)),_.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12;var T=o.normalBuffer;if(s.curvedUseNormal){var k=n.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var A=0;A<k;++A)T.push(n.getFloat32(e.byteOffset,!0)),T.push(n.getFloat32(e.byteOffset+4,!0)),T.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12}s.maxIdx=d,o.maxIdx=d;var S={};S.curvedBuffers=o,_refine(S,r);for(var P=0,q=S.indices.length;P<q;++P)b.push(S.indices[P]);for(P=0,q=S.positions.length;P<q;++P)c.push(S.positions[P]),g.push(S.normals[P]);return s}function _processV8TriStrips(e,t){var r,n=e.dv,s=e.results.buffers[e.results.buffers.length-1],a=0,o=s.numGroups,f=0,i=0,l=0,p=0,d=0,c=0,g=null,b=null,h=null,y=0,x=null,v=null,m=null,C=0,O=null,B=0,F=[0,0,0],w=null;for(s.vertexBuffer=[],s.normalBuffer=[],s.indexBuffer=[],s.groupStartBuffer=[],s.groupCountBuffer=[],s.materialIndexBuffer=[],t&&(w=[],[],s.xtBodies=w),g=s.vertexBuffer,b=s.normalBuffer,r=s.indexBuffer,h=s.groupStartBuffer,x=s.groupCountBuffer,v=s.materialIndexBuffer,s.hasVertexColors?(s.vertexColorBuffer=[],O=s.vertexColorBuffer):s.hasTextureUVs&&(s.uvCoordinatesBuffer=[],m=s.uvCoordinatesBuffer),a=0;a<o;++a){var I,U=null;if(t)(U={}).faceId=n.getInt32(e.byteOffset,!0),e.byteOffset+=4,s.useBodyIDs?(I=n.getUint32(e.byteOffset,!0),e.byteOffset+=4):(I=n.getUint16(e.byteOffset,!0),e.byteOffset+=2),U.bodyId=I,_getXTBody(w,I).faces.push(U);for(d=n.getInt32(e.byteOffset,!0),e.byteOffset+=4,v.push(d),i=n.getUint32(e.byteOffset,!0),e.byteOffset+=4,U&&(U.start=r.length,U.groupIndex=h.length),h.push(r.length),y=0,f=0;f<i;++f)for(l=n.getUint16(e.byteOffset,!0),e.byteOffset+=2,p=0;p<l;++p){var M=0;if(s.usesPooling){var _=p%8;0===_&&(B=n.getUint8(e.byteOffset,!0),e.byteOffset+=1),(M=0==(B&1<<_))?F[p>1?2:p%3]=c++:(F[p>2?2:p%3]=n.getUint32(e.byteOffset,!0),e.byteOffset+=4)}else F[p>1?2:p%3]=c++;p>1&&(p%2==1&&F.reverse(),Array.prototype.push.apply(r,F),y+=3,p%2==1&&F.reverse(),F[0]=F[1],F[1]=F[2]),(!s.usesPooling||s.usesPooling&&M)&&(g.push(n.getFloat32(e.byteOffset,!0)),g.push(n.getFloat32(e.byteOffset+4,!0)),g.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12,b.push(n.getFloat32(e.byteOffset,!0)),b.push(n.getFloat32(e.byteOffset+4,!0)),b.push(n.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12,s.hasVertexColors?(C=n.getUint32(e.byteOffset,!0)>>8,e.byteOffset+=4,O.push(((16711680&C)>>16)*u),O.push(((65280&C)>>8)*u),O.push((255&C)*u)):s.hasTextureUVs&&(m.push(n.getFloat32(e.byteOffset,!0)),m.push(n.getFloat32(e.byteOffset+4,!0)),e.byteOffset+=8))}U&&(U.count=y),x.push(y)}return s.maxIdx=c,s}function _processV8LineStrips(e){var t=e.dv,r=e.results.buffers[e.results.buffers.length-1],n=0,s=r.numGroups,a=0,o=0,f=0,i=0,l=0,p=0,d=null,c=null,g=null,b=0,h=null,y=null,x=0,v=null,m=0;for(r.vertexBuffer=[],r.indexBuffer=[],r.groupStartBuffer=[],r.groupCountBuffer=[],r.materialIndexBuffer=[],d=r.vertexBuffer,c=r.indexBuffer,g=r.groupStartBuffer,h=r.groupCountBuffer,y=r.materialIndexBuffer,r.hasVertexColors&&(r.vertexColorBuffer=[],v=r.vertexColorBuffer),n=0;n<s;++n){for(l=t.getInt32(e.byteOffset,!0),e.byteOffset+=4,y.push(l),o=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,g.push(c.length),b=0,a=0;a<o;++a)for(p+(a>0||n>0?1:0),f=t.getUint16(e.byteOffset,!0),e.byteOffset+=2,i=0;i<f;++i){i>1&&(c.push(c[c.length-1]),b++);var C=0;if(r.usesPooling){var O=i%8;0===O&&(m=t.getUint8(e.byteOffset,!0),e.byteOffset+=1),(C=0==(m&1<<O))?c.push(p++):(c.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4)}else c.push(p++);b++,(!r.usesPooling||r.usesPooling&&C)&&(d.push(t.getFloat32(e.byteOffset,!0)),d.push(t.getFloat32(e.byteOffset+4,!0)),d.push(t.getFloat32(e.byteOffset+8,!0)),e.byteOffset+=12,r.hasVertexColors&&(x=t.getUint32(e.byteOffset,!0)>>8,e.byteOffset+=4,v.push(((16711680&x)>>16)*u),v.push(((65280&x)>>8)*u),v.push((255&x)*u)))}h.push(b)}r.maxIdx=p}function _processV8BinaryData(e){var t=e.dv,r=e.results;r.numMaterials=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,r.numBuffers=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,r.numMaterials>0&&function _processV8Materials(e){var t=e.dv,r=e.results;r.materials={};var n=r.materials,s=0,a=r.numMaterials,o=null,f=0,u=0,i=null,l=0,p=[],d=-1;for(s=0;s<a;++s){switch(f=t.getUint8(e.byteOffset,!0),e.byteOffset+=1,p[s]={type:f,internalIndex:-1},f){case 0:void 0===n.phong&&(n.phong={index:[],diffuse:[],emissive:[],specular:[],shininess:[]}),(o=n.phong).diffuse.push(t.getUint32(e.byteOffset,!0)),o.emissive.push(t.getUint32(e.byteOffset+4,!0)),o.specular.push(t.getUint32(e.byteOffset+8,!0)),o.shininess.push(t.getFloat32(e.byteOffset+12,!0)),e.byteOffset+=16;break;case 1:void 0===n.flat&&(n.flat={index:[],diffuse:[]}),(o=n.flat).diffuse.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4;break;case 3:void 0===n.line&&(n.line={index:[],color:[]}),(o=n.line).color.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4;break;case 2:void 0===n.texture&&(n.texture={index:[],texB64Data:[]}),o=n.texture,u=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,i=new Uint8Array(t.buffer),o.texB64Data.push(i.subarray(e.byteOffset,e.byteOffset+u)),e.byteOffset+=u;break;case 4:void 0===n.spheremap&&(n.spheremap={blendType:[],blendColor:[],index:[],texB64Data:[]}),(o=n.spheremap).blendType.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.blendColor.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,u=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,i=new Uint8Array(t.buffer),o.texB64Data.push(i.subarray(e.byteOffset,e.byteOffset+u)),e.byteOffset+=u;break;case 5:for(void 0===n.cubemap&&(n.cubemap={blendType:[],blendColor:[],index:[],texB64Data:[]}),(o=n.cubemap).blendType.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.blendColor.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,l=0;l<6;++l)u=t.getUint32(e.byteOffset,!0),e.byteOffset+=4,i=new Uint8Array(t.buffer),o.texB64Data.push(i.subarray(e.byteOffset,e.byteOffset+u)),e.byteOffset+=u;break;case 6:void 0===n.texpair&&(n.texpair={baseMaterialType:[],baseMaterialIndex:[],textureMaterialType:[],textureMaterialIndex:[],index:[]}),(o=n.texpair).baseMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.textureMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,d=o.baseMaterialIndex.length-1,o.baseMaterialType.push(4294967295===o.baseMaterialIndex[d]?-1:p[o.baseMaterialIndex[d]].type),o.textureMaterialType.push(4294967295===o.textureMaterialIndex[d]?-1:p[o.textureMaterialIndex[d]].type),4294967295!==o.baseMaterialIndex[d]&&(o.baseMaterialIndex[d]=p[o.baseMaterialIndex[d]].internalIndex),4294967295!==o.textureMaterialIndex[d]&&(o.textureMaterialIndex[d]=p[o.textureMaterialIndex[d]].internalIndex);break;case 7:void 0===n.textriplet&&(n.textriplet={baseMaterialType:[],baseMaterialIndex:[],uvMaterialIndex:[],envMaterialType:[],envMaterialIndex:[],index:[]}),(o=n.textriplet).baseMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.uvMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,o.envMaterialIndex.push(t.getUint32(e.byteOffset,!0)),e.byteOffset+=4,d=o.baseMaterialIndex.length-1,o.baseMaterialType.push(4294967295===o.baseMaterialIndex[d]?-1:p[o.baseMaterialIndex[d]].type),o.envMaterialType.push(4294967295===o.envMaterialIndex[d]?-1:p[o.envMaterialIndex[d]].type),4294967295!==o.baseMaterialIndex[d]&&(o.baseMaterialIndex[d]=p[o.baseMaterialIndex[d]].internalIndex),4294967295!==o.uvMaterialIndex[d]&&(o.uvMaterialIndex[d]=p[o.uvMaterialIndex[d]].internalIndex),4294967295!==o.envMaterialIndex[d]&&(o.envMaterialIndex[d]=p[o.envMaterialIndex[d]].internalIndex);break;default:throw{name:"BOD material processing error",message:"Unsupported material type: "+f.toString()}}o.index.push(s),p[s].internalIndex=o.index.length-1}}(e);var n=null;r.numBuffers>0&&(n=function _processV8Buffers(e){var t=null,r=e.dv,n=e.results;n.buffers=[];var s=n.buffers,a=null,o=0,f=n.numBuffers,u=0;for(o=0;o<f;++o){switch(s.push({}),a=s[o],u=r.getUint8(e.byteOffset,!0),e.byteOffset+=1,a.geometryType=3&u,a.curvedUseNormal=(32&u)>0,a.curvedFlat=(64&u)>0,u&=252,a.usesPooling=(4&u)>0,a.hasTextureUVs=(8&u)>0,a.hasVertexColors=(16&u)>0,a.useBodyIDs=(32&u)>0,a.numGroups=r.getUint16(e.byteOffset,!0,e.lod),e.byteOffset+=2,a.geometryType){case 0:_processV8TriStrips(e,!1);break;case 1:_processV8LineStrips(e);break;case 2:t=_processV8TriStrips(e,!0);break;case 3:t=a.curvedFlat?_processCurvedTrianglesFlat(e,!0):_processCurvedTriangles(e,!0);break;default:throw{name:"BOD processing error",message:"Invalid thisBuffer type: "+a.geometryType.toString()}}delete a.usesPooling}return t}(e)),n&&function _processXTEdgeMap(e,t){var r=e.byteOffset,n=e.dv,s=n.getUint16(r,!0);if(r+=2,s>0){for(var a=[],o=0,f=e.results.buffers.length;o<f;o++)for(var u=0,i=e.results.buffers[o].xtBodies.length;u<i;u++)a.push(e.results.buffers[o].xtBodies[u]);for(var l=0;l<s;l++){var p=_getXTBody(a,n.getInt32(r,!0));r+=4;var d=n.getUint16(r,!0);if(r+=2,d>0){for(var c={},g={},b=0,h=0,y=0;y<d;y++){var x=n.getInt32(r,!0);r+=4;var v=n.getInt32(r,!0);r+=4;var m=n.getInt32(r,!0);r+=4,v<0||m<0?(c[x]=Math.max(v,m),h++):v>0&&m>0&&(g[x]={f1:v,f2:m},b++)}p&&(h>0&&(p.nonManifoldEdgeMap=c,p.nonManifoldEdgeMapSize=h),b>0&&(p.manifoldEdgeMap=g,p.manifoldEdgeMapSize=b))}}}e.byteOffset=r}(e),function _finalizeV8Data(e){var t,r=e.results.materials,n=e.results.buffers,s=null,a=0,o=e.ports;if(r){if(r.phong&&(r.phong.index=new Uint32Array(r.phong.index),o.push(r.phong.index.buffer),r.phong.diffuse=new Uint32Array(r.phong.diffuse),o.push(r.phong.diffuse.buffer),r.phong.emissive=new Uint32Array(r.phong.emissive),o.push(r.phong.emissive.buffer),r.phong.specular=new Uint32Array(r.phong.specular),o.push(r.phong.specular.buffer),r.phong.shininess=new Float32Array(r.phong.shininess),o.push(r.phong.shininess.buffer)),r.flat&&(r.flat.index=new Uint32Array(r.flat.index),o.push(r.flat.index.buffer),r.flat.diffuse=new Uint32Array(r.flat.diffuse),o.push(r.flat.diffuse.buffer)),r.texture){r.texture.index=new Uint32Array(r.texture.index),o.push(r.texture.index.buffer);for(var f=0,u=r.texture.index.length;f<u;++f)r.texture.texB64Data[f]=new Uint8Array(r.texture.texB64Data[f]),o.push(r.texture.texB64Data[f].buffer)}if(r.spheremap)for(r.spheremap.index=new Uint32Array(r.spheremap.index),o.push(r.spheremap.index.buffer),r.spheremap.blendType=new Uint32Array(r.spheremap.blendType),o.push(r.spheremap.blendType.buffer),r.spheremap.blendColor=new Uint32Array(r.spheremap.blendColor),o.push(r.spheremap.blendColor.buffer),f=0,u=r.spheremap.index.length;f<u;++f)r.spheremap.texB64Data[f]=new Uint8Array(r.spheremap.texB64Data[f]),o.push(r.spheremap.texB64Data[f].buffer);if(r.cubemap)for(r.cubemap.index=new Uint32Array(r.cubemap.index),o.push(r.cubemap.index.buffer),r.cubemap.blendType=new Uint32Array(r.cubemap.blendType),o.push(r.cubemap.blendType.buffer),r.cubemap.blendColor=new Uint32Array(r.cubemap.blendColor),o.push(r.cubemap.blendColor.buffer),f=0,u=r.cubemap.texB64Data.length;f<u;++f)r.cubemap.texB64Data[f]=new Uint8Array(r.cubemap.texB64Data[f]),o.push(r.cubemap.texB64Data[f].buffer);r.texpair&&(r.texpair.index=new Uint32Array(r.texpair.index),o.push(r.texpair.index.buffer),r.texpair.baseMaterialIndex=new Uint32Array(r.texpair.baseMaterialIndex),o.push(r.texpair.baseMaterialIndex.buffer),r.texpair.baseMaterialType=new Uint32Array(r.texpair.baseMaterialType),o.push(r.texpair.baseMaterialType.buffer),r.texpair.textureMaterialIndex=new Uint32Array(r.texpair.textureMaterialIndex),o.push(r.texpair.textureMaterialIndex.buffer),r.texpair.textureMaterialType=new Uint32Array(r.texpair.textureMaterialType),o.push(r.texpair.textureMaterialType.buffer)),r.textriplet&&(r.textriplet.index=new Uint32Array(r.textriplet.index),o.push(r.textriplet.index.buffer),r.textriplet.baseMaterialIndex=new Uint32Array(r.textriplet.baseMaterialIndex),o.push(r.textriplet.baseMaterialIndex.buffer),r.textriplet.baseMaterialType=new Uint32Array(r.textriplet.baseMaterialType),o.push(r.textriplet.baseMaterialType.buffer),r.textriplet.uvMaterialIndex=new Uint32Array(r.textriplet.uvMaterialIndex),o.push(r.textriplet.uvMaterialIndex.buffer),r.textriplet.envMaterialIndex=new Uint32Array(r.textriplet.envMaterialIndex),o.push(r.textriplet.envMaterialIndex.buffer),r.textriplet.envMaterialType=new Uint32Array(r.textriplet.envMaterialType),o.push(r.textriplet.envMaterialType.buffer))}for(a=0,t=e.results.numBuffers;a<t;++a)(s=n[a]).vertexBuffer=new Float32Array(s.vertexBuffer),o.push(s.vertexBuffer.buffer),s.maxIdx<65536?s.indexBuffer=new Uint16Array(s.indexBuffer):s.indexBuffer=new Uint32Array(s.indexBuffer),o.push(s.indexBuffer.buffer),s.groupStartBuffer=new Uint32Array(s.groupStartBuffer),o.push(s.groupStartBuffer.buffer),s.groupCountBuffer=new Uint32Array(s.groupCountBuffer),o.push(s.groupCountBuffer.buffer),s.normalBuffer&&(s.normalBuffer=new Float32Array(s.normalBuffer),o.push(s.normalBuffer.buffer)),s.vertexColorBuffer?(s.vertexColorBuffer=new Float32Array(s.vertexColorBuffer),o.push(s.vertexColorBuffer.buffer)):s.materialIndexBuffer&&(s.materialIndexBuffer=new Int32Array(s.materialIndexBuffer),o.push(s.materialIndexBuffer.buffer)),s.uvCoordinatesBuffer&&(s.uvCoordinatesBuffer=new Float32Array(s.uvCoordinatesBuffer),o.push(s.uvCoordinatesBuffer.buffer));delete e.byteOffset}(e)}function _refine(e,t){var r=e.curvedBuffers,n=(t+1)*(t+1),s=(e.curvedBuffers.lod+1)*(e.curvedBuffers.lod+1);e.groupCountBuffer=new Int32Array(e.curvedBuffers.groupCountBuffer.length),e.groupStartBuffer=new Int32Array(e.curvedBuffers.groupStartBuffer.length);var a=(t*t+5*t+6)/2;e.positions=new Float32Array(a*r.vertexIndex.length),e.normals=new Float32Array(a*r.vertexIndex.length),e.indices=new Uint32Array(n*r.vertexIndex.length);for(var o=0,u=r.groupCountBuffer.length;o<u;++o)e.groupCountBuffer[o]=e.curvedBuffers.groupCountBuffer[o]*n/s;for(o=0,u=r.groupStartBuffer.length;o<u;++o)e.groupStartBuffer[o]=e.curvedBuffers.groupStartBuffer[o]*n/s;e.maxIdx=e.curvedBuffers.maxIdx*n/s;var i=[],l=[],p=[],d=t+1,c=1/d;for(o=0;o<d+1;o++)for(var g=0;g<o+1;g++)i.push(1-c*o),p.push(c*g),l.push(c*o-c*g);for(var b=i.length,h=[],y=[],x=[],v=[],m=[],C=[],O=0;O<b;O++)h.push(i[O]*i[O]),y.push(l[O]*l[O]),x.push(p[O]*p[O]),v.push(i[O]*l[O]),m.push(i[O]*p[O]),C.push(l[O]*p[O]);var B=[0,1,2];for(o=1;o<d;o++){var F=2*o+1,w=.5*o*(o+1),I=o+1,U=[w,w+I,w+I+1],M=[w,w+I+1,w+1];B.push(U[0]),B.push(U[1]),B.push(U[2]),B.push(M[0]),B.push(M[1]),B.push(M[2]);var _=!0,D=1;for(g=2;g<F;g++)if(_){_=!1;var T=f.add(U,[D,D,D]);B.push(T[0]),B.push(T[1]),B.push(T[2])}else{_=!0;T=f.add(M,[D,D,D]);B.push(T[0]),B.push(T[1]),B.push(T[2]),D++}}var k=B.length;function getAVertex(e){return[r.vertexBuffer[3*e],r.vertexBuffer[3*e+1],r.vertexBuffer[3*e+2]]}function getControlPoint(e){return[r.controlPointBuffer[3*e],r.controlPointBuffer[3*e+1],r.controlPointBuffer[3*e+2]]}function getNormal(e){return[r.normalBuffer[3*e],r.normalBuffer[3*e+1],r.normalBuffer[3*e+2]]}var A=r.vertexIndex.length/3,S=0,P=0;for(o=0;o<A;++o){var q,R,V,L=S/3,E=getAVertex(r.vertexIndex[3*o]),z=getAVertex(r.vertexIndex[3*o+1]),N=getAVertex(r.vertexIndex[3*o+2]),W=getControlPoint(r.controlPointIndex[3*o+1]),H=getControlPoint(r.controlPointIndex[3*o+2]),X=getControlPoint(r.controlPointIndex[3*o]),j=!1;q=getNormal(r.normalIndex[3*o]),R=getNormal(r.normalIndex[3*o+1]),V=getNormal(r.normalIndex[3*o+2]),r.normalIndex[3*o]===r.normalIndex[3*o+1]&&r.normalIndex[3*o+1]===r.normalIndex[3*o+2]&&(j=!0);var G=f.normalize(f.add(q,R)),J=f.normalize(f.add(R,V)),$=f.normalize(f.add(q,V));for(g=0;g<b;g++){var Q,Y;Q=f.add(f.interpolate(E,z,N,h[g],y[g],x[g]),f.interpolate(W,H,X,2*v[g],2*C[g],2*m[g])),Y=j?q:f.add(f.interpolate(q,R,V,h[g],y[g],x[g]),f.interpolate(G,J,$,2*v[g],2*C[g],2*m[g])),e.positions[S]=Q[0],e.positions[S+1]=Q[1],e.positions[S+2]=Q[2],e.normals[S]=Y[0],e.normals[S+1]=Y[1],e.normals[S+2]=Y[2],S+=3}if(j)for(se=0;se<k;se+=3){var Z=[e.normals[3*(L+B[se])],e.normals[3*(L+B[se])+1],e.normals[3*(L+B[se])+2]],K=[e.positions[3*(L+B[se])],e.positions[3*(L+B[se])+1],e.positions[3*(L+B[se])+2]],ee=[e.positions[3*(L+B[se+1])],e.positions[3*(L+B[se+1])+1],e.positions[3*(L+B[se+1])+2]],te=[e.positions[3*(L+B[se+2])],e.positions[3*(L+B[se+2])+1],e.positions[3*(L+B[se+2])+2]],re=f.subtract(K,te),ne=f.subtract(ee,K);l=f.cross(re,ne);f.product(l,Z)<0?(e.indices[P]=L+B[se+1],e.indices[P+1]=L+B[se],e.indices[P+2]=L+B[se+2]):(e.indices[P]=L+B[se],e.indices[P+1]=L+B[se+1],e.indices[P+2]=L+B[se+2]),P+=3}else for(var se=0;se<k;se++)e.indices[P]=L+B[se],P++}}var i=function(){};i.prototype.processBinaryData=function _processBinaryData(e){var t=e.dv;e.byteOffset+=6;var r=t.getUint16(e.byteOffset,!0);e.byteOffset+=2;var n=null;r>=8&&(n=t.getUint32(e.byteOffset,!0),e.byteOffset+=4);var s=t.getUint32(e.byteOffset,!0);switch(e.byteOffset+=4,s>0&&function _processDelta(e){var t=e.dv,r=t.getUint32(e.byteOffset,!0);if(e.byteOffset+=4,r>0){var n={};e.results.delta=n;for(var s=0;s<r;s++){var a={created:[],modified:[],deleted:[]},o=t.getUint32(e.byteOffset,!0);e.byteOffset+=4,n[o]=a,a.bodyId=o;var f=t.getUint32(e.byteOffset,!0);e.byteOffset+=4;for(var u=0;u<f;u++){var i=t.getUint32(e.byteOffset,!0);e.byteOffset+=4;var l=t.getUint8(e.byteOffset,!0);e.byteOffset+=1;for(var p=0;p<i;p++){var d=t.getUint32(e.byteOffset,!0);switch(e.byteOffset+=4,l){case 1:a.created.push(d);break;case 2:a.modified.push(d);break;case 3:a.deleted.push(d)}}}}}}(e),r){case 8:_processV8BinaryData(e);break;default:throw{name:"BOD processing error",message:"Unsupported BOD version: "+r.toString()+(null!==n?"."+n:"")}}var a=e.curvedBuffers;a&&(a.controlPointIndex=new Uint32Array(a.controlPointIndex),a.controlPointBuffer=new Float32Array(a.controlPointBuffer),a.normalIndex=new Uint32Array(a.normalIndex),a.normalBuffer=new Float32Array(a.normalBuffer),a.vertexIndex=new Uint32Array(a.vertexIndex),a.vertexBuffer=new Float32Array(a.vertexBuffer),a.groupCountBuffer=new Uint32Array(a.groupCountBuffer),a.groupStartBuffer=new Uint32Array(a.groupStartBuffer),e.results.curvedBuffers=a,_finalizeResults(a,e.ports))},i.prototype.refine=_refine;var l=new i,p={processMessage:function(e,t){var r={dv:null,lod:e.lod,results:{},ports:[],byteOffset:0,url:e.url||"base64"};if(e.shape){var n=e.shape,s=[];l.refine(n,e.lod),_finalizeResults(n.curvedBuffers,s),s.push(n.groupCountBuffer.buffer),s.push(n.groupStartBuffer.buffer),n.positions&&s.push(n.positions.buffer),n.normals&&s.push(n.normals.buffer),n.indices&&s.push(n.indices.buffer),t(n,s)}else if(e.binaryData)try{r.dv=new DataView(e.binaryData),l.processBinaryData(r),r.results.index=e.index,t(r.results,r.ports)}catch(e){a("%s - %s",e.name,e.message),t()}else if(e.url){var f=e.url,u=e.method||"GET",i=this.networkManager.createHttpRequest(u,f);i.responseType="arraybuffer",e.arguments&&e.arguments.contentType?i.setContentType(e.arguments.contentType):i.setContentType("text/plain"),i.onprogress=function(e){if(e.lengthComputable){var r={url:f,loaded:e.loaded};t({isProgressEvent:!0,progressEvent:r},null,!0)}},i.onsuccess=function(){if(i.response)if(i.response.byteLength>0){var e=new DataView(i.response);r.dv=e,r.results.index=0;var n=function(e){var t={byteOffset:0,offsets:[]};if("PLMBOD"==""+String.fromCharCode(e.getUint8(t.byteOffset,!0))+String.fromCharCode(e.getUint8(t.byteOffset+1,!0))+String.fromCharCode(e.getUint8(t.byteOffset+2,!0))+String.fromCharCode(e.getUint8(t.byteOffset+3,!0))+String.fromCharCode(e.getUint8(t.byteOffset+4,!0))+String.fromCharCode(e.getUint8(t.byteOffset+5,!0)))return t;var r=e.getUint32(t.byteOffset,!0);t.byteOffset+=4;var n=0;if(r>0)for(var s=0;s<r;s++){var a=e.getUint32(t.byteOffset,!0);t.byteOffset+=4,t.offsets.push({start:n,length:a}),n+=a}return t}(e);if(0===n.offsets.length)l.processBinaryData(r),t(r.results,r.ports);else for(var s=0,a=n.offsets.length;s<a;s++){var u=n.offsets[s];r.dv=e,r.byteOffset=u.start+n.byteOffset,r.results={},r.ports.length=0,r.results.index=s,l.processBinaryData(r),t(r.results,r.ports,s<a-1)}}else t(null,null);else o("Failed to receive HttpRequest data!",f),t()},i.onerror=function(){a("Failed to retrieve."+e.url),t()};var p=null;e.arguments&&(p=JSON.stringify(e.arguments)),i.send(p)}else if(e.base64Data)try{var d={b64Str:function BodWorker_ab2str(e){for(var t=new Uint16Array(e),r="",n=0,s=t.length;n<s;n+=65535)r+=n+65535>s?String.fromCharCode.apply(null,t.subarray(n,n+(s-n))):String.fromCharCode.apply(null,t.subarray(n,n+65535));return r}(e.base64Data,e.url)};delete e.base64Data,r.dv=new DataView(function BodWorker_decodeBase64ToBinaryBuffer(e){if(void 0!==e.b64Str){for(var t=atob(e.b64Str),r=[],n=0,s=t.length;n<s;++n)r.push(t.charCodeAt(n));t=null,e.binData=new Uint8Array(r).buffer}else e.binData=void 0}(d,e.url)),l.processBinaryData(r),t(r.results,r.ports)}catch(e){a("%s - %s",e.name,e.message),t()}}},d=s()("PLMVisWeb:error:XTBodWorker");d.enabled=!0;var c=s()("PLMVisWeb:warning:XTBodWorker"),g=function(e,t,r,n,s){var a=e.getUint8(t,!0);switch(r.entityType=a,t+=1,a){case 6:r.offset=e.getFloat32(t,!0),r.underlyingSurface={},t=g(e,t,r.underlyingSurface,n,s);break;case 1:t=function(e,t,r){var n={};n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.location=n;var s={};return s.x=e.getFloat32(t,!0),t+=4,s.y=e.getFloat32(t,!0),t+=4,s.z=e.getFloat32(t,!0),t+=4,r.axis=s,t}(e,t,r);break;case 2:t=function(e,t,r){var n={};n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.location=n;var s={};return s.x=e.getFloat32(t,!0),t+=4,s.y=e.getFloat32(t,!0),t+=4,s.z=e.getFloat32(t,!0),t+=4,r.axis=s,r.radius=e.getFloat32(t,!0),t+=4}(e,t,r);break;case 3:t=function(e,t,r){var n={};return n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.origin=n,r.radius=e.getFloat32(t,!0),t+=4}(e,t,r);break;case 4:t=function(e,t,r){var n={};n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.location=n;var s={};s.x=e.getFloat32(t,!0),t+=4,s.y=e.getFloat32(t,!0),t+=4,s.z=e.getFloat32(t,!0),t+=4,r.axis=s,r.radius=e.getFloat32(t,!0),r.radius=15,t+=4;var a=e.getFloat32(t,!0);r.cosHalfAngle=Math.cos(a),r.oneDivideCosHalfAngle=1/r.cosHalfAngle,t+=4;var o=r.radius/Math.tan(r.halfAngle),f={x:n.x+o*s.x,y:n.y+o*s.y,z:n.z+o*s.z};return r.apex=f,t}(e,t,r);break;case 5:t=function(e,t,r){var n={};n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.location=n;var s={};return s.x=e.getFloat32(t,!0),t+=4,s.y=e.getFloat32(t,!0),t+=4,s.z=e.getFloat32(t,!0),t+=4,r.axis=s,r.majorRadius=e.getFloat32(t,!0),t+=4,r.minorRadius=e.getFloat32(t,!0),t+=4}(e,t,r);break;case 11:t=function(e,t,r){var n={};n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.location=n;var s={};return s.x=e.getFloat32(t,!0),t+=4,s.y=e.getFloat32(t,!0),t+=4,s.z=e.getFloat32(t,!0),t+=4,r.axis=s,r.radius=e.getFloat32(t,!0),t+=4}(e,t,r);break;case 13:t=function(e,t,r){var n={};n.x=e.getFloat32(t,!0),t+=4,n.y=e.getFloat32(t,!0),t+=4,n.z=e.getFloat32(t,!0),t+=4,r.location=n;var s={};return s.x=e.getFloat32(t,!0),t+=4,s.y=e.getFloat32(t,!0),t+=4,s.z=e.getFloat32(t,!0),t+=4,r.axis=s,r.majorRadius=e.getFloat32(t,!0),t+=4,r.minorRadius=e.getFloat32(t,!0),t+=4}(e,t,r);break;case 15:t=function(e,t){return t}(0,t);break;case 0:t+=4;var o=e.getInt32(t,!0);t+=4;var f=n[o];f&&(n[s]=f);break;default:c("XTBodWorker: Unknown geometry type is encountered")}return t},b=function(e,t,r,n){for(var s=0,a=0;a<n;a++){var o=s;r[s++]=e.getFloat32(t,!0),t+=4,r[s++]=e.getFloat32(t,!0),t+=4,r[s++]=e.getFloat32(t,!0),t+=4,a>0&&a<n-1&&(r[s++]=r[o++],r[s++]=r[o++],r[s++]=r[o++])}return t},h=function(e){var t=e.dv,r=0;String.fromCharCode(t.getUint8(r+0,!0)),String.fromCharCode(t.getUint8(r+1,!0)),String.fromCharCode(t.getUint8(r+2,!0)),String.fromCharCode(t.getUint8(r+3,!0)),String.fromCharCode(t.getUint8(r+4,!0)),String.fromCharCode(t.getUint8(r+5,!0));r+=6;t.getUint16(r,!0);r+=2;t.getUint32(r,!0);r+=4,r+=t.getUint32(r,!0)+4;var n=t.getUint32(r,!0);if(r+=4,e.parseXTFacetData){r+=n;var s=t.getUint32(r,!0);r+=4;var a={};for(y=0;y<s;y++){x=t.getUint32(r,!0);r+=4;v=t.getUint32(r,!0);if(r+=4,!(v<=0)){var o={};a[x]=o;for(C=0;C<v;C++){var f=t.getInt32(r,!0);r+=4;var u=t.getUint16(r,!0);r+=2;var i=new Float32Array(3*(2*(u-2)+2));o[f]=i,r=b(t,r,i,u)}}}if(e.xtIds&&e.xtIds.length>0)if(o=a[e.psId]){for(var l={},p=(y=0,e.xtIds.length);y<p;y++){var d=o[f=e.xtIds[y]];d&&(l[f]={positions:d},e.ports.push(d.buffer))}e.results.nonManifoldEdges=l}}else{var c=t.getUint32(r,!0);r+=4;for(var h={},y=0;y<c;y++){var x=t.getUint32(r,!0);r+=4;var v=t.getUint32(r,!0);if(r+=4,!(v<=0)){var m={};h[e.psId]=m;for(var C=0;C<v;C++){var O={},B=t.getUint32(r,!0);r+=4,m[B]=O,r=g(t,r,O,m,B)}}}e.results.xtDescriptions=h}},y={processMessage:function(e,t){var r={dv:null,psId:e.psId,xtIds:e.xtIds,parseXTFacetData:e.parseXTFacetData,results:{callbackId:e.callbackId},ports:[],byteOffset:0,url:e.url||"base64"};if(e.binaryData)try{r.dv=new DataView(e.binaryData),h(r),t(r.results,r.ports)}catch(e){d("%s - %s",e.name,e.message),t()}else if(e.url){var n=this.networkManager.createHttpRequest("GET",e.url);n.responseType="arraybuffer",n.onsuccess=function(){n.response?n.response.byteLength>0?(r.dv=new DataView(n.response),n=null,h(r),t(r.results,r.ports)):t(null,null):(c("Failed to receive HttpRequest data!",url),t())},n.onerror=function(){d("Failed to retrieve."+url),t()},n.send(null)}else if(e.base64Data)try{var s={b64Str:_ab2str(e.base64Data,e.url)};delete e.base64Data,r.dv=new DataView(_decodeBase64ToBinaryBuffer(s,e.url)),h(r),t(r.results,r.ports)}catch(e){d("%s - %s",e.name,e.message),t()}}},x=s()("PLMVisWeb:debug:Network:NetworkManager"),v=s()("PLMVisWeb:debug:Network:HttpRequest"),m=s()("PLMVisWeb:verbose:Network:HttpRequest"),C=s()("PLMVisWeb:error:Network:HttpRequest");C.enabled=!0;var O=function(e){return 0===e||e>=200&&e<400},B=function(e){return e>=500},F=function(e,t,r,n){v("constructor",e,t,r,n),this.retryLimit=3,this.url=r;var s=0,a=this;void 0===n?n=!0:"boolean"!=typeof withCredentials&&(n=!1),function requestRun(){v("requestRun",s.toString()+"/"+a.retryLimit.toString(),t,r);var o=new XMLHttpRequest;o.open(t,r,!0);if(n){var f=e.token;f&&f.length>0&&o.setRequestHeader("Authorization","Bearer "+f)}a.xhr=o;o.onload=function(n){m("requestRun:onload",n),401===o.status?(C("requestRun:onload:DENY",t,r),s=a.retryLimit,"function"==typeof a.ondeny&&a.ondeny(n),e&&e.deny(a)):void 0!==o.response&&O(o.status)?(v("requestRun:onload:SUCCESS",t,r),"function"==typeof a.onsuccess&&a.onsuccess(n)):s!==a.retryLimit&&B(o.status)||"function"!=typeof a.onerror?s++<a.retryLimit&&(m("requestRun:RETRY",t,r),requestRun(),a.send(a.body)):(C("requestRun:onload:ERROR",t,r),a.onerror(n))};o.onprogress=function(e){m("requestRun:onprogress",t,r,e),"function"==typeof a.onprogress&&a.onprogress(e)};o.onerror=function(e){C("requestRun:onerror",t,r,e),s++<a.retryLimit?(requestRun(),a.send(a.body)):"function"==typeof a.onerror&&a.onerror(e)};o.ontimeout=function(e){m("requestRun:ontimeout",t,r,e),s++<a.retryLimit?(requestRun(),a.send(a.body)):"function"==typeof a.ontimeout&&a.ontimeout(e)}}()};Object.defineProperties(F.prototype,{upload:{get:function(){return this.xhr.upload}},response:{get:function(){return this.xhr.response}},responseText:{get:function(){return this.xhr.responseText}},status:{get:function(){return this.xhr.status}},readyState:{get:function(){return this.xhr.readyState}},responseType:{get:function(){return this.xhr.responseType},set:function(e){this.xhr.responseType=e}},timeout:{get:function(){return this.xhr.timeout},set:function(e){this.xhr.timeout=e}},onreadystatechange:{get:function(){return this.xhr.onreadystatechange},set:function(e){this.xhr.onreadystatechange=e}}}),F.prototype.setContentType=function(e){v("setContentType",e),this.xhr.setRequestHeader("content-type",e)},F.prototype.setRequestHeader=function(e,t){v("setRequestHeader",e,t),this.xhr.setRequestHeader(e,t)},F.prototype.abort=function(){v("abort"),this.xhr.abort()},F.prototype.send=function(e){v("send",e),this.body=e,this.xhr.send(e)};var w=s()("PLMVisWeb:debug:WorkerImpl"),I={},U=[];\n// CONCATENATED MODULE: ./staging/WorkerImpl.js\nself.onmessage=function(e){w("onmessage - "+JSON.stringify(e.data.cmd));var t=e.data;if("init"===t.cmd){for(var r in I.BodWorker=p,I.XTBodWorker=y,self.networkManager=new function(){x("constructor");var e=null;Object.defineProperties(this,{token:{get:function(){return e},set:function(t){e!==t&&(e=t,this.workerPool&&this.workerPool.broadcast({cmd:"token",token:t}))}}}),this.deny=function(e){x("deny",e),this.worker?this.worker.postMessage({cmd:"deny",request:{url:e.url}}):function(e,t){if(null!==t&&void 0!==t&&null!==t.type&&void 0!==t.type&&void 0!==e._listeners){var r=e._listeners[t.type];if(void 0!==r)for(var n=r.length,s=0;s<n;s++){var a=r[s];a.call(a,t)}}}(this,{type:"onDeny",url:e.url})},this.createHttpRequest=function(e,t,r){return x("createHttpRequest",e,t,r),new F(this,e,t,r)},this.addEventListener=function(e,t){x("addEventListener",e,t),void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},this.removeEventListener=function(e,t){if(x("removeEventListener",e,t),void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}},self.networkManager.worker=self,I){if(I.hasOwnProperty(r))(n=I[r]).networkManager||(n.networkManager=self.networkManager)}w("postmessage",{__commands:U})}if(t.__token&&(self.networkManager.token=t.__token),"token"===t.cmd)self.networkManager.token=t.token;else if("close"===t.cmd)this.close();else{var n;(n=I[t.cmd])&&n.processMessage(t,function(e,t,r){t=t||[],w("postmessage",{result:e,__taskId:this.__taskId,__hasMore:r},t),self.postMessage({result:e,__taskId:this.__taskId,__hasMore:r},t)}.bind(t))}}},\n/* 2 */\n/***/function(e,t){\n/**\n * Helpers.\n */\nvar r=1e3,n=60*r,s=60*n,a=24*s,o=7*a,f=365.25*a;\n/**\n * Pluralization helper.\n */\nfunction plural(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}\n/***/\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\ne.exports=function(e,t){t=t||{};var u=typeof e;if("string"===u&&e.length>0)\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\nreturn function parse(e){if((e=String(e)).length>100)return;var t=/^((?:\\d+)?\\-?\\d?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var u=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*f;case"weeks":case"week":case"w":return u*o;case"days":case"day":case"d":return u*a;case"hours":case"hour":case"hrs":case"hr":case"h":return u*s;case"minutes":case"minute":case"mins":case"min":case"m":return u*n;case"seconds":case"second":case"secs":case"sec":case"s":return u*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */(e);if("number"===u&&!1===isNaN(e))return t.long?\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\nfunction fmtLong(e){var t=Math.abs(e);if(t>=a)return plural(e,t,a,"day");if(t>=s)return plural(e,t,s,"hour");if(t>=n)return plural(e,t,n,"minute");if(t>=r)return plural(e,t,r,"second");return e+" ms"}(e):function fmtShort(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+"d";if(t>=s)return Math.round(e/s)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},\n/* 3 */\n/***/function(e,t,r){e.exports=\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\nfunction setup(e){\n/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\nfunction selectColor(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return createDebug.colors[Math.abs(t)%createDebug.colors.length]}\n/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\nfunction createDebug(e){let t;function debug(...e){\n// Disabled?\nif(!debug.enabled)return;const r=debug,n=Number(new Date),s=n-(t||n);\n// Set `diff` timestamp\nr.diff=s,r.prev=t,r.curr=n,t=n,e[0]=createDebug.coerce(e[0]),"string"!=typeof e[0]&&\n// Anything else let\'s inspect with %O\ne.unshift("%O");\n// Apply any `formatters` transformations\nlet a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,n)=>{\n// If we encounter an escaped % then don\'t increase the array index\nif("%%"===t)return t;a++;const s=createDebug.formatters[n];if("function"==typeof s){const n=e[a];t=s.call(r,n),\n// Now we need to remove `args[index]` since it\'s inlined in the `format`\ne.splice(a,1),a--}return t}),\n// Apply env-specific formatting (colors, etc.)\ncreateDebug.formatArgs.call(r,e),(r.log||createDebug.log).apply(r,e)}return debug.namespace=e,debug.enabled=createDebug.enabled(e),debug.useColors=createDebug.useColors(),debug.color=selectColor(e),debug.destroy=destroy,debug.extend=extend,\n// Debug.formatArgs = formatArgs;\n// debug.rawLog = rawLog;\n// env-specific initialization logic for debug instances\n"function"==typeof createDebug.init&&createDebug.init(debug),createDebug.instances.push(debug),debug}function destroy(){const e=createDebug.instances.indexOf(this);return-1!==e&&(createDebug.instances.splice(e,1),!0)}function extend(e,t){return createDebug(this.namespace+(void 0===t?":":t)+e)}\n/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\nfunction toNamespace(e){return e.toString().substring(2,e.toString().length-2).replace(/\\.\\*\\?$/,"*")}\n/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(e){return e instanceof Error?e.stack||e.message:e},createDebug.disable=\n/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\nfunction disable(){const e=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(e=>"-"+e)].join(",");return createDebug.enable(""),e}\n/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/,createDebug.enable=function enable(e){let t;createDebug.save(e),createDebug.names=[],createDebug.skips=[];const r=("string"==typeof e?e:"").split(/[\\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+e.substr(1)+"$")):createDebug.names.push(new RegExp("^"+e+"$")));for(t=0;t<createDebug.instances.length;t++){const e=createDebug.instances[t];e.enabled=createDebug.enabled(e.namespace)}},createDebug.enabled=function enabled(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=createDebug.skips.length;t<r;t++)if(createDebug.skips[t].test(e))return!1;for(t=0,r=createDebug.names.length;t<r;t++)if(createDebug.names[t].test(e))return!0;return!1},createDebug.humanize=r(2),Object.keys(e).forEach(t=>{createDebug[t]=e[t]}),\n/**\n\t* Active `debug` instances.\n\t*/\ncreateDebug.instances=[],\n/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\ncreateDebug.names=[],createDebug.skips=[],\n/**\n\t* Map of special "%n" handling functions, for the debug "format" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. "n" and "N".\n\t*/\ncreateDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}},\n/* 4 */\n/***/function(e,t){\n// shim for using process in browser\nvar r,n,s=e.exports={};\n// cached from whatever global is present so that test runners that stub it\n// don\'t break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn\'t define any globals.  It\'s inside a\n// function because try/catches deoptimize in certain engines.\nfunction defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(r===setTimeout)\n//normal enviroments in sane situations\nreturn setTimeout(e,0);\n// if setTimeout wasn\'t available but was latter defined\nif((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{\n// when when somebody has screwed with setTimeout but no I.E. maddness\nreturn r(e,0)}catch(t){try{\n// When we are in I.E. but the script has been evaled so I.E. doesn\'t trust the global object when called normally\nreturn r.call(null,e,0)}catch(t){\n// same as above but when it\'s a version of I.E. that must have the global object for \'this\', hopfully our context correct otherwise it will throw a global error\nreturn r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){r=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var a,o=[],f=!1,u=-1;function cleanUpNextTick(){f&&a&&(f=!1,a.length?o=a.concat(o):u=-1,o.length&&drainQueue())}function drainQueue(){if(!f){var e=runTimeout(cleanUpNextTick);f=!0;for(var t=o.length;t;){for(a=o,o=[];++u<t;)a&&a[u].run();u=-1,t=o.length}a=null,f=!1,function runClearTimeout(e){if(n===clearTimeout)\n//normal enviroments in sane situations\nreturn clearTimeout(e);\n// if clearTimeout wasn\'t available but was latter defined\nif((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{\n// when when somebody has screwed with setTimeout but no I.E. maddness\nreturn n(e)}catch(t){try{\n// When we are in I.E. but the script has been evaled so I.E. doesn\'t  trust the global object when called normally\nreturn n.call(null,e)}catch(t){\n// same as above but when it\'s a version of I.E. that must have the global object for \'this\', hopfully our context correct otherwise it will throw a global error.\n// Some versions of I.E. have different rules for clearTimeout vs setTimeout\nreturn n.call(this,e)}}}(e)}}\n// v8 likes predictible objects\nfunction Item(e,t){this.fun=e,this.array=t}function noop(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new Item(e,t)),1!==o.length||f||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",// empty string to avoid regexp issues\ns.versions={},s.on=noop,s.addListener=noop,s.once=noop,s.off=noop,s.removeListener=noop,s.removeAllListeners=noop,s.emit=noop,s.prependListener=noop,s.prependOnceListener=noop,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}\n/******/]);\n//# sourceMappingURL=plmvisweb.worker.min.js.map',null)};
/***/},
/* 135 */
/***/function(e,t,n){"use strict";
/* harmony import */var r=n(4),i=/* */n.n(r),a=i()("PLMVisWeb:error:XTBodWorker");
/* harmony import */a.enabled=!0;var o=i()("PLMVisWeb:warning:XTBodWorker"),s=function(e,t,n,r,i){var a=e.getUint8(t,!0);switch(n.entityType=a,t+=1,a){case 6:n.offset=e.getFloat32(t,!0),n.underlyingSurface={},t=s(e,t,n.underlyingSurface,r,i);break;case 1:t=function(e,t,n){var r={};r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.location=r;var i={};return i.x=e.getFloat32(t,!0),t+=4,i.y=e.getFloat32(t,!0),t+=4,i.z=e.getFloat32(t,!0),t+=4,n.axis=i,t}(e,t,n);break;case 2:t=function(e,t,n){var r={};r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.location=r;var i={};return i.x=e.getFloat32(t,!0),t+=4,i.y=e.getFloat32(t,!0),t+=4,i.z=e.getFloat32(t,!0),t+=4,n.axis=i,n.radius=e.getFloat32(t,!0),t+=4}(e,t,n);break;case 3:t=function(e,t,n){var r={};return r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.origin=r,n.radius=e.getFloat32(t,!0),t+=4}(e,t,n);break;case 4:t=function(e,t,n){var r={};r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.location=r;var i={};i.x=e.getFloat32(t,!0),t+=4,i.y=e.getFloat32(t,!0),t+=4,i.z=e.getFloat32(t,!0),t+=4,n.axis=i,n.radius=e.getFloat32(t,!0),n.radius=15,t+=4;var a=e.getFloat32(t,!0);n.cosHalfAngle=Math.cos(a),n.oneDivideCosHalfAngle=1/n.cosHalfAngle,t+=4;var o=n.radius/Math.tan(n.halfAngle),s={x:r.x+o*i.x,y:r.y+o*i.y,z:r.z+o*i.z};return n.apex=s,t}(e,t,n);break;case 5:t=function(e,t,n){var r={};r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.location=r;var i={};return i.x=e.getFloat32(t,!0),t+=4,i.y=e.getFloat32(t,!0),t+=4,i.z=e.getFloat32(t,!0),t+=4,n.axis=i,n.majorRadius=e.getFloat32(t,!0),t+=4,n.minorRadius=e.getFloat32(t,!0),t+=4}(e,t,n);break;case 11:t=function(e,t,n){var r={};r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.location=r;var i={};return i.x=e.getFloat32(t,!0),t+=4,i.y=e.getFloat32(t,!0),t+=4,i.z=e.getFloat32(t,!0),t+=4,n.axis=i,n.radius=e.getFloat32(t,!0),t+=4}(e,t,n);break;case 13:t=function(e,t,n){var r={};r.x=e.getFloat32(t,!0),t+=4,r.y=e.getFloat32(t,!0),t+=4,r.z=e.getFloat32(t,!0),t+=4,n.location=r;var i={};return i.x=e.getFloat32(t,!0),t+=4,i.y=e.getFloat32(t,!0),t+=4,i.z=e.getFloat32(t,!0),t+=4,n.axis=i,n.majorRadius=e.getFloat32(t,!0),t+=4,n.minorRadius=e.getFloat32(t,!0),t+=4}(e,t,n);break;case 15:t=function(e,t){return t}(0,t);break;case 0:t+=4;var l=e.getInt32(t,!0);t+=4;var c=r[l];c&&(r[i]=c);break;default:o("XTBodWorker: Unknown geometry type is encountered")}return t},l=function(e,t,n,r){for(var i=0,a=0;a<r;a++){var o=i;n[i++]=e.getFloat32(t,!0),t+=4,n[i++]=e.getFloat32(t,!0),t+=4,n[i++]=e.getFloat32(t,!0),t+=4,a>0&&a<r-1&&(n[i++]=n[o++],n[i++]=n[o++],n[i++]=n[o++])}return t},c=function(e){var t=e.dv,n=0;String.fromCharCode(t.getUint8(n+0,!0)),String.fromCharCode(t.getUint8(n+1,!0)),String.fromCharCode(t.getUint8(n+2,!0)),String.fromCharCode(t.getUint8(n+3,!0)),String.fromCharCode(t.getUint8(n+4,!0)),String.fromCharCode(t.getUint8(n+5,!0));n+=6;t.getUint16(n,!0);n+=2;t.getUint32(n,!0);n+=4,n+=t.getUint32(n,!0)+4;var r=t.getUint32(n,!0);if(n+=4,e.parseXTFacetData){n+=r;var i=t.getUint32(n,!0);n+=4;var a={};for(v=0;v<i;v++){y=t.getUint32(n,!0);n+=4;b=t.getUint32(n,!0);if(n+=4,!(b<=0)){var o={};a[y]=o;for(_=0;_<b;_++){var c=t.getInt32(n,!0);n+=4;var u=t.getUint16(n,!0);n+=2;var h=new Float32Array(3*(2*(u-2)+2));o[c]=h,n=l(t,n,h,u)}}}if(e.xtIds&&e.xtIds.length>0)if(o=a[e.psId]){for(var d={},p=(v=0,e.xtIds.length);v<p;v++){var f=o[c=e.xtIds[v]];f&&(d[c]={positions:f},e.ports.push(f.buffer))}e.results.nonManifoldEdges=d}}else{var m=t.getUint32(n,!0);n+=4;for(var g={},v=0;v<m;v++){var y=t.getUint32(n,!0);n+=4;var b=t.getUint32(n,!0);if(n+=4,!(b<=0)){var x={};g[e.psId]=x;for(var _=0;_<b;_++){var w={},M=t.getUint32(n,!0);n+=4,x[M]=w,n=s(t,n,w,x,M)}}}e.results.xtDescriptions=g}},u={processMessage:function(e,t){var n={dv:null,psId:e.psId,xtIds:e.xtIds,parseXTFacetData:e.parseXTFacetData,results:{callbackId:e.callbackId},ports:[],byteOffset:0,url:e.url||"base64"};if(e.binaryData)try{n.dv=new DataView(e.binaryData),c(n),t(n.results,n.ports)}catch(e){a("%s - %s",e.name,e.message),t()}else if(e.url){var r=this.networkManager.createHttpRequest("GET",e.url);r.responseType="arraybuffer",r.onsuccess=function(){r.response?r.response.byteLength>0?(n.dv=new DataView(r.response),r=null,c(n),t(n.results,n.ports)):t(null,null):(o("Failed to receive HttpRequest data!",url),t())},r.onerror=function(){a("Failed to retrieve."+url),t()},r.send(null)}else if(e.base64Data)try{var i={b64Str:_ab2str(e.base64Data,e.url)};delete e.base64Data,n.dv=new DataView(_decodeBase64ToBinaryBuffer(i,e.url)),c(n),t(n.results,n.ports)}catch(e){a("%s - %s",e.name,e.message),t()}}};/* harmony default export */t.a=u},
/* 136 */
/***/function(e,t,n){"use strict";
/* harmony import */var r=n(0),i=n(7),a=function(e,t,n){var i=t[n+0],a=t[n+1],o=t[n+2];return e=r.b._combineHash(e,i),e=r.b._combineHash(e,a),e=r.b._combineHash(e,o)},o=function(e){this.hash=function(t){var n=0;return n=a(n,e,t.v1),n=a(n,e,t.v2)}},s=function(e,t,n,i){if(t===n)return!0;var a=e[t+0],o=e[t+1],s=e[t+2],l=e[n+0],c=e[n+1],u=e[n+2];return r.b._vertexEqual(a,o,s,l,c,u,i)},l=function(e,t){this.equals=function(n,r){return s(e,n.v1,r.v1,t)&&s(e,n.v2,r.v2,t)}},c=function(e){this.hash=function(t){var n=0;return n=a(n,e,t)}},u=function(e,t){this.equals=function(n,r){return s(e,n,r,t)}},h=function(e,t,n){e.push(t[n+0]),e.push(t[n+1]),e.push(t[n+2])},d=function(e,t,n,r,i,a,o){var s=n[i+0],l=n[i+1],c=n[i+2],u=.5*(r[i+0]+r[a+0]),h=.5*(r[i+1]+r[a+1]),d=.5*(r[i+2]+r[a+2]),p=1/Math.sqrt(u*u+h*h+d*d);u*=p,h*=p,d*=p;for(var f=0;f<o;f++)e.push(s),e.push(l),e.push(c),t.push(u),t.push(h),t.push(d)},p=function(e,t,n,r,i,a){r.visited=!0,d(t,n,i,a,r.index1,r.abuttingEdge.index1,1);for(var o=e.get(r.index2);!o.visited;){o.visited=!0,d(t,n,i,a,o.index1,o.abuttingEdge.index1,2);var s=e.get(o.index3);s.visited&&(s=e.get(o.index2)),o=s}d(t,n,i,a,r.index1,r.abuttingEdge.index1,1)},f=function(e,t,n,r,i,a,o){var s=r;h(o,i,s.index1);do{s.visited=!0;var l=s.index3>=0?2:1;d(t,n,i,a,s.index1,s.abuttingEdge.index1,l);var c=e.get(s.index2);if(c.visited&&s.index3>=0&&(c=e.get(s.index3)),-1===c.index3){d(t,n,i,a,c.index1,c.abuttingEdge.index1,1),h(o,i,c.index1),c.visited=!0;break}s=c}while(!s.visited)},m=function(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(!i)continue;var a=[],o=[],s=[],l=i.map,c=l.values;for(var u in c){if(c.hasOwnProperty(u))(h=c[u])&&-1===h.index3&&!h.visited&&f(l,a,o,h,t,n,s)}if(0===a.length)for(var u in c){var h;if(c.hasOwnProperty(u))(h=c[u])&&!h.visited&&p(l,a,o,h,t,n)}i.positions=new Float32Array(a),i.isManifold=!0,i.normals=new Float32Array(o),s.length>0&&(i.vertices=new Float32Array(s)),delete i.vertexMap}},g=function(e,t,n,r,i,a,o,s){var l={v1:n,v2:t},c=r.get(l);if(c){if(o.faceId!==c.faceId){var u={f1:o.faceId,f2:c.faceId},h=i.get(u);void 0!==h&&function(e,t,n,r,i,a,o){var s=e[t];if(void 0!==s){null===s&&(s={map:o()},e[t]=s);var l=s.map,c={index1:r,index2:i,index3:-1,visited:!1,abuttingEdge:a},u={index1:i,index2:r,index3:-1,visited:!1,abuttingEdge:a};if(c.entry=u,u.entry=c,0===l.size)l.put(r,c),l.put(i,u);else{var h=l.tryPut(r,c),d=l.tryPut(i,u);if(h&&d&&h.entry===d)return;h&&(h.index3=c.index2),d&&(d.index3=u.index2)}}}(a,h,0,n,t,c,s)}}else c={faceId:o.faceId,index1:t,index2:n},l.v1=t,l.v2=n,r.put(l,c)},v=function(e,t,n,r,i){return!s(e,t,n,i)&&!s(e,n,r,i)&&!s(e,r,t,i)},y={processMessage:function(e,t){for(var n=e.manifoldEdges,r=e.tolerance,a=0,s=e.xtBodies.length;a<s;a++){for(var h=e.xtBodies[a].xtBodies,d=e.xtBodies[a].positions,p=e.xtBodies[a].normals,f=e.xtBodies[a].indices,y=new Uint32Array(d.buffer),b=function(){return new i.b(256,new c(y),new u(d,r))},x=new i.b(f.length,new o(y),new l(d,r)),_=0,w=h.length;_<w;_++){var M=h[_],E=M.faceEdgeMap,S={};for(var L in n)if(n.hasOwnProperty(L)){if(void 0===M.manifoldEdgeMap)break;var T=M.manifoldEdgeMap[L];T&&(S[T.f1]||(S[T.f1]=!0),S[T.f2]||(S[T.f2]=!0))}for(var A=0,C=M.faces.length;A<C;A++){var P=M.faces[A];if(S[P.faceId])for(var I=P.start,O=P.start+P.count;I<O;I+=3){var B=3*f[I],R=3*f[I+1],G=3*f[I+2];v(d,B,R,G,r)&&(g(0,B,R,x,E,n,P,b),g(0,R,G,x,E,n,P,b),g(0,G,B,x,E,n,P,b))}}}m(n,d,p)}t(n,null)}};
/* harmony import */ /* harmony default export */t.a=y},
/* 137 */
/***/function(module,__webpack_exports__,__webpack_require__){"use strict";
/* unused harmony export UIWorker */
/* unused harmony export WebWorker */
/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"a",function(){return WorkerPool});
/* harmony import */var _Utilities__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_BodWorker__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11),_EdgeWorker__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(136),_XTBodWorker__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(135),worker_loader_name_plmvisweb_worker_min_js_inline_true_fallback_false_WorkerImpl__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(134),worker_loader_name_plmvisweb_worker_min_js_inline_true_fallback_false_WorkerImpl__WEBPACK_IMPORTED_MODULE_4___default=/* */__webpack_require__.n(worker_loader_name_plmvisweb_worker_min_js_inline_true_fallback_false_WorkerImpl__WEBPACK_IMPORTED_MODULE_4__),debug__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4),debug__WEBPACK_IMPORTED_MODULE_5___default=/* */__webpack_require__.n(debug__WEBPACK_IMPORTED_MODULE_5__),debug=debug__WEBPACK_IMPORTED_MODULE_5___default()("PLMVisWeb:debug:WorkerPool"),error=debug__WEBPACK_IMPORTED_MODULE_5___default()("PLMVisWeb:error:WorkerPool");
/* harmony import */error.enabled=!0;var debugUiWorker=debug__WEBPACK_IMPORTED_MODULE_5___default()("PLMVisWeb:debug:UIWorker"),debugWebWorker=debug__WEBPACK_IMPORTED_MODULE_5___default()("PLMVisWeb:debug:WebWorker"),debugGeneralWorker=debug__WEBPACK_IMPORTED_MODULE_5___default()("PLMVisWeb:debug:GeneralWorker"),_handlers={BodWorker:_BodWorker__WEBPACK_IMPORTED_MODULE_1__.a,EdgeWorker:_EdgeWorker__WEBPACK_IMPORTED_MODULE_2__.a,XTBodWorker:_XTBodWorker__WEBPACK_IMPORTED_MODULE_3__.a},UIWorker=function(e,t){debugUiWorker("constructor",a,t),this.type="UIWorker";for(var n={},r=0,i=e.length;r<i;r++){var a=e[r],o=_handlers[a];o&&"function"==typeof o.processMessage&&(o.networkManager=t,n[a]=o)}var s=[],l=[],c=[],u=this,h=function(e){debugUiWorker("onmessage",e);var t=e.data;"close"===t.cmd&&u.close();var r=n[t.cmd];r&&r.processMessage(t,function(t,n,r){(e={}).data={result:t,__taskId:this.__taskId,__hasMore:r},function(e){debugUiWorker("invokeMessageHandlers",e);for(var t=0,n=l.length;t<n;t++){var r=l[t];r&&r(e)}}(e)}.bind(t))},d=setInterval(function(){if(s.length>0){var e=s.pop();e&&h(e)}},5);this.isCommandSupported=function(e){debugUiWorker("isCommandSupported",e,!!n[e]);var t=n[e];return null!==t&&void 0!==t},this.close=function(){debugUiWorker("close"),asnycQueue.length=0,l.length=0,c.length=0,clearInterval(d)},this.postMessage=function(e){debugUiWorker("postMessage",e);var t={data:e};s.push(t)},this.addEventListener=function(e,t){"message"===e&&l.push(t)},this.removeEventListener=function(e,t){if("message"===e){var n=l.indexOf(t);n>=0&&l.splice(n,1)}}},WebWorker=function(e,t,n){debugWebWorker("constructor",e,t,n),this.type="WebWorker";var r=new worker_loader_name_plmvisweb_worker_min_js_inline_true_fallback_false_WorkerImpl__WEBPACK_IMPORTED_MODULE_4___default.a,i=["BodWorker","XTBodWorker"],a={cmd:"init"};n&&(a.fullSource=n),r.postMessage(a),this.isCommandSupported=function(e){return debugWebWorker("isCommandSupported",e,i.indexOf(e)>=0),null!=i&&i.length>0&&i.indexOf(e)>=0},this.postMessage=function(e,t){debugWebWorker("postMessage",e,t),r.postMessage(e,t)},this.addEventListener=function(e,t){r.addEventListener(e,t)},this.removeEventListener=function(e,t){r.removeEventListener(e,t)},this.close=function(){debugWebWorker("close"),r.postMessage({cmd:"close"})}},findScriptPrefix=function(){var e,t=window.document.getElementsByTagName("script");if(t&&t.length>0)for(var n=0,r=t.length;n<r&&!e;++n){var i=t[n];if(i.src){var a=i.src.indexOf("PLMVisWeb.js");a>=0?e=i.src.substring(0,a):(a=i.src.indexOf("plmvisweb.min.js"))>=0&&(e=i.src.substring(0,a))}}return debugGeneralWorker("findscriptPrefix",e),e},InitWorker=function(e,t){debugGeneralWorker("InitWorker",e,t),e.workLoad=0,e.workItems={},e.taskIdCounter=0,e.name="Worker#"+t,e.addEventListener("message",function(t){var n=e.workItems[t.data.__taskId];void 0!==n&&(t.data.__hasMore||(e.workLoad--,delete e.workItems[t.data.__taskId]),n(t.data.result))}),e.addEventListener("error",function(e){throw error(["Web Worker Error: Line ",e.lineno," in ",e.filename,": ",e.message].join("")),e})},postMessageInternal=function(e,t,n,r){debugGeneralWorker("postMessageInternal",e,t,n,r);var i=e.taskIdCounter++;t.__taskId=i,e.workItems[i]=r,e.workLoad++,e.postMessage(t,null===n?void 0:n)},WorkerPool=function(viewer,commandNames,networkManager,webworkerCount){debug("constructor",viewer,commandNames,networkManager,webworkerCount);var workers=[],fullSourceFiles,prefix=findScriptPrefix();if(prefix||void 0===prefix&&Worker){var workerJS=prefix+"plmvisweb.worker.min.js";try{eval("viewer._extensions")&&(workerJS=prefix+"WorkerImpl.js",fullSourceFiles=[prefix+"Network.js",prefix+"BodWorker.js",prefix+"XTBodWorker.js"])}catch(e){}_Utilities__WEBPACK_IMPORTED_MODULE_0__.b._isNumber(webworkerCount)||(webworkerCount=4);for(var i=0;i<webworkerCount;i++){var worker=new WebWorker(workerJS,networkManager,fullSourceFiles);InitWorker(worker,i),workers.push(worker)}}var uiWorker=new UIWorker(commandNames,networkManager);InitWorker(uiWorker,workers.length),workers.push(uiWorker),this.concurrencyLevel=workers.length;var handleInvalidCommand=function(e){debug("handleInvalidCommand"),e({error:"Cannot find the command handler"})};this.defer=function(e,t){debug("defer",e,t);var n=setInterval(function(t){clearInterval(n),e(t)},0,t)},this.postMessage=function(e,t,n){debug("postMessage",e,t,n);for(var r=null,i=workers.length,a=0;a<i;a++){var o=workers[a];o.isCommandSupported(e.cmd)&&(null==r||o.workLoad<r.workLoad)&&(r=o)}null!==r&&void 0!==r?(e.__token=networkManager.token,postMessageInternal(r,e,t,n)):handleInvalidCommand(n)},this.broadcast=function(e,t){debug("broadcast",e,t);for(var n=workers.length,r=0;r<n;r++){var i=workers[r];i&&i.postMessage(e,t)}},this.close=function(){debug("close");for(var e=0;e<workers.length;e++)workers[e].close()}}},
/* 138 */
/***/function(e,t){e.exports="#define SILHOUETTE_FRAGMENT_SHADER\n\nprecision highp float;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\nvarying vec3 vExpandedNormal;\n\n#include <common>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tfloat epsilon = 0.999965;\n\tvec3 testNormal = vec3( 0, 0, -1 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t// if( abs( dot( testNormal, vExpandedNormal ) ) > epsilon ) {\n\t// \tdiscard;\n\t// }\n\n\tgl_FragColor = diffuseColor;\n\n}\n"
/***/},
/* 139 */
/***/function(e,t){e.exports="#define SILHOUETTE_VERTEX_SHADER\n\nprecision highp float;\n\n#include <common>\n#include <clipping_planes_pars_vertex>\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\nuniform float sWidth;\nattribute vec3 expandNormal;\n\nvarying vec3 vExpandedNormal;\n\nvoid main() {\n\n\t#include <begin_vertex>\n\n\tgl_Position = ( projectionMatrix * modelViewMatrix * vec4( position + ( expandNormal * sWidth ), 1.0 ) );\n\tvExpandedNormal = normalize( ( viewMatrix * vec4( expandNormal, 1.0 ) ).xyz );\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n}\n"
/***/},
/* 140 */
/***/function(e){e.exports={CONTROL_LOGGER_Constructor:"Control- Inside PLMVisWeb Control constructor.",CONTROL_LOGGER_Constructor2:"Control- Unexpected children found in host element!",CONTROL_LOGGER_License:"Control- Failed to acquire license!",CONTROL_LOGGER_setSize:"Control- setSize API- Updating the size of the control.",CONTROL_LOGGER_getSize:"Control- getSize API- Returning the size of the control.",VIEWER_LOGGER_Constructor:"PLMVis JavaScript toolkit Viewer constructor.",VIEWER_LOGGER_startRenderLoop:"startRenderLoop API: starting render loop.",VIEWER_CONSOLE_startRenderLoop:"Viewer must be initialized ( viewer.init(); ) before starting the render loop.",VIEWER_LOGGER_stopRenderLoop:"stopRenderLoop API: render loop stopped.",VIEWER_LOGGER_getSelectedVerticesInfo:"getSelectedVerticesInfo API : getting selected vertices.",VIEWER_LOGGER_finest_getSelectedVerticesInfo:"getSelectedVerticesInfo API : selected vertices : ",VIEWER_LOGGER_setMouseNavigationEnabled:"setMouseNavigationEnabled API : setting mouse navigation to :",VIEWER_LOGGER_warn_setMouseNavigationEnabled:"setMouseNavigationEnabled API : camera controls are not defined.",VIEWER_LOGGER_getMouseNavigationEnabled:"getMouseNavigationEnabled API : returning mouse navigation status.",VIEWER_LOGGER_zoomToCursor:"zoomToCursor API : setting zoom to cursor to :",VIEWER_LOGGER_isZoomingToCursor:"isZoomingToCursor API : returning zom to cursor status.",VIEWER_LOGGER_rotateAroundTheCameraTarget:"zoomToCursor API : camera controls are not defined.",VIEWER_LOGGER_warn_rotateAroundTheCameraTarget:"rotateAroundTheCameraTarget API : camera controls are not defined.",VIEWER_LOGGER_clearScene:"clearScene API :clearing the scene.",VIEWER_LOGGER_fine_clearScene:"clearScene API : clearing the existing  extensions.",VIEWER_LOGGER_finest_clearScene:"clearScene API : clearing the extension:",VIEWER_LOGGER_finest2_clearScene:"clearScene API : This extension will not be cleared :",VIEWER_LOGGER_info2_clearScene:"clearScene API : scene cleared.",VIEWER_LOGGER_getCameraMode:"getCameraMode API: returning camera mode.",VIEWER_LOGGER_setCameraMode:"setCameraMode API: updating camera mode to:",VIEWER_LOGGER_setMouseNavigationMode:"setMouseNavigationMode API: updating mouse navigation mode to:",VIEWER_LOGGER_getMouseNavigationMode:"getMouseNavigationMode API: returning mouse navigation mode.",VIEWER_LOGGER_setMouseNavigationModeSensitivity:"setMouseNavigationModeSensitivity API: updating mouse navigation mode speed to:",VIEWER_LOGGER_fitAll:"fitAll API: moving camera to fit all the geomtery into view.",VIEWER_LOGGER_info2_fitAll:"fitAll API: moving camera to fit all the visible geometry into view.",VIEWER_LOGGER_warn_fitAll:"fitAll API: model bounding box is empty.",VIEWER_LOGGER_getWebGLContext:"getWebGLContext API: returning the wenGL context.",VIEWER_LOGGER_setPickingEnabled:"setPickingEnabled API: updating the picking enable state.",VIEWER_LOGGER_getPickingEnabled:"getPickingEnabled API: returning if the picking is enabled or not",VIEWER_LOGGER_registerMouseOverEvent:"registerMouseOverEvent API: registering the mouse over event.",VIEWER_LOGGER_unregisterMouseOverEvent:"unregisterMouseOverEvent API: unregistering the mouse over event.",VIEWER_LOGGER_registerProgressEvent:"registerProgressEvent API: registering the progress event.",VIEWER_LOGGER_unregisterProgressEvent:"unregisterProgressEvent API: unregistering the progress event.",VIEWER_LOGGER_open:"open API: opening the model.",VIEWER_LOGGER_importModel:"importModel API: importing the model.",VIEWER_LOGGER_openWithObject:"openWithObject API: Opening a model with json object :",VIEWER_LOGGER_finest_openWithObject:"openWithObject API: open successfully loaded with rootID:",VIEWER_LOGGER_importModelWithObject:"importModelWithObject API: Importing  model with json object :",VIEWER_LOGGER_setVisibilityByPsId:"setVisibilityByPsId API: Updating visibility of the object with psid :",VIEWER_LOGGER_setVisibilityByPsIds:"setVisibilityByPsIds API: Updating visibility of the objects with the array of psids.",VIEWER_LOGGER_finest_setVisibilityByPsId:"setVisibilityByPsId API: Updated the visibility.",VIEWER_LOGGER_finest2_setVisibilityByPsId:"setVisibilityByPsId API: Updating visibility of the children object with psid:",VIEWER_LOGGER_warn_setVisibilityByPsId:"setVisibilityByPsId API: Object with the given psid is null or undefined.",VIEWER_LOGGER_setEdgesVisibilityByPsId:"setEdgesVisibilityByPsId API: Updating visibility of the edges with psid :",VIEWER_LOGGER_setRenderMode:"setRenderMode API: updating rendering mode of current model",VIEWER_LOGGER_finest_getRenderMode:"getRenderMode API: get rendering mode of current model",VIEWER_LOGGER_finest_setEdgesVisibilityByPsId:"setEdgesVisibilityByPsId API:Loading edges and vertices for object :",VIEWER_LOGGER_finest_getEdgesVisibilityByPsId:"getEdgesVisibilityByPsId API: returning visibility of the edges with psid :",VIEWER_LOGGER_finest_warn_getEdgesVisibilityByPsId:"getEdgesVisibilityByPsId API: object is undefined or null",VIEWER_LOGGER_finest_getEdgeGeometryByPsId:"getEdgeGeometryByPsId API: returning geometry of the edges with psid :",VIEWER_LOGGER_finest_warn_getEdgeGeometryByPsId:"getEdgeGeometryByPsId API: object is undefined or null",VIEWER_LOGGER_setVerticesVisibilityByPsId:"setVerticesVisibilityByPsId API: returning visibility of the vertices with psid :",VIEWER_LOGGER_finest_setVerticesVisibilityByPsId:"setVerticesVisibilityByPsId API:Loading edges and vertices for object :",VIEWER_LOGGER_getVerticesVisibilityByPsId:"getVerticesVisibilityByPsId API: returning visibility of the edges with psid :",VIEWER_LOGGER_warn_getVerticesVisibilityByPsId:"getVerticesVisibilityByPsId API: object is undefined or null.",VIEWER_LOGGER_getVisibilityStateByPsId:"getVisibilityStateByPsId API: returning visibility state of a node with psId:",VIEWER_LOGGER_warn_getVisibilityStateByPsId:"getVisibilityStateByPsId API: object is undefined or null.",VIEWER_LOGGER_getVerticesByPsId:"getVerticesByPsId API: returning positions of vertices with psId:",VIEWER_LOGGER_getVertexByPsId:"getVertexByPsId API: returning position of vertex with psId:",VIEWER_LOGGER_getNameByPsId:"getNameByPsId API: returning the name of the object with psid: :",VIEWER_LOGGER_warn_getNameByPsId:"getNameByPsId API: object is undefined or null.",VIEWER_LOGGER_rotateAboutSelectedPoint:"rotateAboutSelectedPoint API: updating the flag to rotate about selected point to the value :",VIEWER_LOGGER_isRotatingAboutSelectedPoint:"isRotatingAboutSelectedPoint API: Returning whether rotation center is updated not not.",VIEWER_LOGGER_draw:"draw API: forcing a render call.",VIEWER_LOGGER_translateByPsId:"translateByPsId API: Applying a translation to the object identified with the specified psid",VIEWER_LOGGER_finest_translateByPsId:"translateByPsId API:object is found with the given psid",VIEWER_LOGGER_rotateByPsId:"rotateByPsId API: Applying a rotation to the object identified with the specified psid.",VIEWER_LOGGER_scaleByPsId:"scaleByPsId API: Applying a scaling transformation to the object identified with the specified psid",VIEWER_LOGGER_finest_scaleByPsId:"scaleByPsId API:object is found with the given psid",VIEWER_LOGGER_setMaterialByPsId:"setMaterialByPsId API: Updating the various material attributes for the object with the specified psid.",VIEWER_LOGGER_resetMaterialByPsId:"resetMaterialByPsId API: Reseting a part/assembly to its original material.",VIEWER_LOGGER_setCameraOrientation:"setCameraOrientation API: setting the camera orientation to: ",VIEWER_LOGGER_finest_setCameraOrientation:"setCameraOrientation API: camera orientation updated successfully.",VIEWER_LOGGER_registerVisibilityChangeEventByPsId:"registerVisibilityChangeEventByPsId API: Registering visibility change event for the object with given psid.",VIEWER_LOGGER_registerVisibilityEvent:"registerVisibilityEvent API: registering the visibility event.",VIEWER_LOGGER_finest_registerVisibilityChangeEventByPsId:"registerVisibilityChangeEventByPsId API:visibility change event for the object with given psid registered successfully.",VIEWER_LOGGER_unregisterVisibilityChangeEventByPsId:"unregisterVisibilityChangeEventByPsId API: Unregistering visibility change event for the object with given psid.",VIEWER_LOGGER_finest_unregisterVisibilityChangeEventByPsId:"unregisterVisibilityChangeEventByPsId API:visibility change event for the object with given psid unregistered successfully.",VIEWER_LOGGER_unregisterVisibilityEvent:"unregisterVisibilityEvent API: unregistering the visibility event.",VIEWER_LOGGER_getProductStructureInfo:"getProductStructureInfo API:Returning the product struction information.",VIEWER_LOGGER_setCameraOrientationInfo:"setCameraOrientationInfo API:Updating camera orientation information.",VIEWER_LOGGER_getCameraOrientationInfo:"getCameraOrientationInfo API:returning camera orientation information.",VIEWER_LOGGER_getCameraInfo:"getCameraInfo API:returning perspective and orthographic camera information.",VIEWER_LOGGER_modelHasPmi:"modelHasPmi API:Checking if the model has pmi data.",VIEWER_LOGGER_modelHasXt:"modelHasXt API:Checking if the model has xt data.",VIEWER_LOGGER_warn_modelHasXt:"modelHasXt API:given model is undefined.",VIEWER_LOGGER_unloadGeometryByPsId:"unloadGeometryByPsId API:unloading geometry of the object with given psid.",VIEWER_LOGGER_loadGeometryByPsId:"loadGeometryByPsId API:loading geometry of the object with given psid.",VIEWER_LOGGER_setDrawWhileLoading:"setDrawWhileLoading API:updating the drawWhileLoading to:",VIEWER_LOGGER_getDrawWhileLoading:"getDrawWhileLoading API:returning the drawWhileLoading flag value.",VIEWER_LOGGER_setAutoDraw:"setAutoDraw API:updating the autoDraw to:",VIEWER_LOGGER_getAutoDraw:"getAutoDraw API:returning the autoDraw flag value.",VIEWER_LOGGER_setDrawPerParts:"setDrawPerParts API:updating the no of pats to be loaded before calling render to :",VIEWER_LOGGER_getDrawPerParts:"getDrawPerParts API:returning the no of parts that will be loaded before calling render.",VIEWER_LOGGER_applyTransformationMatrixByPsId:"applyTransformationMatrixByPsId API:Applyting the given transformation matrix to the object.",VIEWER_LOGGER_setSectionCaps:"setSectionCaps API: Updating the value of the cap flag.",VIEWER_LOGGER_getSectionCaps:"getSectionCaps API:Returning the value of the cap flag.",VIEWER_LOGGER_setDragFlag:"setDragFlag API: Updating the value of the drag flag.",VIEWER_LOGGER_getDragFlag:"getDragFlag API:Returning the value of the drag flag.",VIEWER_LOGGER_setDragAxes:"setDragAxes API: Updating the value of the drag axes to:",VIEWER_LOGGER_finest_setDragAxes:"setDragAxes API: Updated the value of the drag AXes to:",VIEWER_LOGGER_getDragAxes:"getDragAxes API: Returning the value of the drag axes.",VIEWER_LOGGER_setDragSpriteOnly:"setDragSpriteOnly API:Updating the value of the flag which decided whether drag/drop is limited to sprites.",VIEWER_LOGGER_getDragSpriteOnly:"getDragSpriteOnly API:Returning the value of the flag which decided whether drag/drop is limited to sprites.",VIEWER_LOGGER_isRendering:"isRendering API: Returning the render loop running state.",VIEWER_LOGGER_overrideMouseNavigationControls:"overrideMouseNavigationControls API: Overriding the mouse navigation controls with a custom controller.",VIEWER_LOGGER_overrideMouseNavigationInput:"overrideMouseNavigationIput API: Overriding the mouse navigation input with user defined mouse and key events.",VIEWER_LOGGER_addImageToScene:"addImageToScene API:Adding image to the scene.",VIEWER_LOGGER_getPsIdAtViewCoordinate:"getPsIdAtViewCoordinate API:Returning the psId of the object at the given view coordinate.",VIEWER_LOGGER_finest_getPsIdAtViewCoordinate:"getPsIdAtViewCoordinate API:PsId is:",VIEWER_LOGGER_warn_getPsIdAtViewCoordinate:"getPsIdAtViewCoordinate API:Coordinate is null or undefined.",VIEWER_LOGGER_getFaceNormalAtViewCoordinate:"getFaceNormalAtViewCoordinate API: Returning the face normal of the face at the given view coordinate.",VIEWER_LOGGER_finest_getFaceNormalAtViewCoordinate:"getFaceNormalAtViewCoordinate API: Face normal is:",VIEWER_LOGGER_warn_getFaceNormalAtViewCoordinate:"getFaceNormalAtViewCoordinate API: Either coordinate is null or undefined, the object is not in the octree, or a face was not located at the coordinate.",VIEWER_LOGGER_getFaceNormalAtModelCoordinate:"getFaceNormalAtModelCoordinate API: Returning the face normal of the face at the given model coordinate.",VIEWER_LOGGER_finest_getFaceNormalAtModelCoordinate:"getFaceNormalAtModelCoordinate API: Face normal is:",VIEWER_LOGGER_warn_getFaceNormalAtModelCoordinate:"getFaceNormalAtModelCoordinate API: Either coordinate is null or undefined, the object is not in the octree, or a face was not located at the coordinate.",VIEWER_LOGGER_getModelPointAtViewCoordinate:"getModelPointAtViewCoordinate API: Returning the model point at the given view coordinate.",VIEWER_LOGGER_finest_getModelPointAtViewCoordinate:"getModelPointAtViewCoordinate API: Model point is:",VIEWER_LOGGER_warn_getModelPointAtViewCoordinate:"getModelPointAtViewCoordinate API: Either coordinate is null or undefined, the object is not in the octree, or a model object was not located at the coordinate.",VIEWER_LOGGER_projectModelPointToViewCoordinate:"projectModelPointToViewCoordinate API: Projecting the model point into view coordinates.",VIEWER_LOGGER_convertParameterToModelPoint:"convertParameterToModelPoint API: Returning the model point corresponding to the shape's parameter.",VIEWER_LOGGER_warn_convertParameterToModelPoint:"convertParameterToModelPoint API: Either no shape was found with the given xtId, the parameter was not 0 or 1 for a face, the parameter was not in the [0-1.0] range for an edge",VIEWER_LOGGER_convertModelPointToParameter:"convertModelPointToParameter API: Returning the shapes parameter if it corresponds to the given model point, otherwise returning null.",VIEWER_LOGGER_warn_convertModelPointToParameter:"convertModelPointToParameter API: Either no shape could be found with the given xtId or the model point does not reside on the shape.",VIEWER_LOGGER_setDefaultMaterialSide:"setDefaultMaterialSide API:Updating default material behavior.",VIEWER_LOGGER_getDefaultMaterialSide:"getDefaultMaterialSide API:Returning default material behavior.",VIEWER_LOGGER_setBackgroundColor:"setBackgroundColor API:Updating default background color to :",VIEWER_LOGGER_getActiveCameraControl:"getActiveCameraControl API:Getting the custom camera control object.",VIEWER_LOGGER_setTransformationMatrixByPsId:"setTransformationMatrixByPsId API:Updating the local transformation matrix of the object.",VIEWER_LOGGER_getTransformationMatrixByPsId:"getTransformationMatrixByPsId API:Returning the local transformation matrix of the object.",VIEWER_LOGGER_warn_getTransformationMatrixByPsId:"getTransformationMatrixByPsId API:object with the given psid is null or undefined",VIEWER_LOGGER_getBoundingBoxCenterByPsId:"getBoundingBoxCenterByPsId API:Returning the center of a part/assembly bounding box.",VIEWER_LOGGER_warn_getBoundingBoxCenterByPsId:"getBoundingBoxCenterByPsId API:object with the given psid is null or undefined",VIEWER_LOGGER_getVisibleModelBoundingBoxCenter:"getVisibleModelBoundingBoxCenter API:Returning the center of visible part/assembly structure bounding box.",VIEWER_LOGGER_warn_getVisibleModelBoundingBoxCenter:"getVisibleModelBoundingBoxCenter API:Bounding box is empty.",VIEWER_LOGGER_finest_getVisibleModelBoundingBoxCenter:"getVisibleModelBoundingBoxCenter API:Bounding box is not empty with center:",VIEWER_LOGGER_getVisibleModelBoundingBoxLength:"getVisibleModelBoundingBoxLength API:Returning the cross length of visible part/assembly structure bounding box.",VIEWER_LOGGER_warn_getVisibleModelBoundingBoxLength:"getVisibleModelBoundingBoxLength API:Bounding box is empty.",VIEWER_LOGGER_finest_getVisibleModelBoundingBoxLength:"getVisibleModelBoundingBoxLength API:Bounding box is not empty with cross length:",VIEWER_LOGGER_setCameraOrientationFromPLMXML:"setCameraOrientationFromPLMXML API:Updating the camera orientation according to the given plmxml file.",VIEWER_LOGGER_warn_setCameraOrientationFromPLMXML:"setCameraOrientationFromPLMXML API:Failed to receive XMLHttpRequest data.",VIEWER_LOGGER_warn3_setCameraOrientationFromPLMXML:"setCameraOrientationFromPLMXML API:Failed to retrieve ",VIEWER_LOGGER_finest_setCameraOrientationFromPLMXML:"setCameraOrientationFromPLMXML API: camera orientation has been updated successfully according to the given plmxml file",VIEWER_LOGGER_warn2_setCameraOrientationFromPLMXML:"setCameraOrientationFromPLMXML API:Failed to receive XMLHttpRequest response.",VIEWER_LOGGER_replaceMaterialByPsId:"replaceMaterialByPsId API: Length of color data and width and height don't match (colors.length = width * height * 3)",GENERAL_CONSOLE_warn_FailedRequest:"Failed to receive XMLHttpRequest data!",GENERAL_CONSOLE_warn_FailedResponse:"Failed to receive XMLHttpRequest response!",GENERAL_CONSOLE_err_FailedToRetrieve:"Failed to retrieve.",VIEWER_LOGGER_setCameraToStandardView:"setCameraToStandardView API:Updating the camera orientation according to the given plmxml file.",VIEWER_LOGGER_getTextureTransparencyDefault:"getTextureTransparencyDefault API:checking whether materials with textures will be treated as transparent objects.",VIEWER_LOGGER_setTextureTransparencyDefault:"setTextureTransparencyDefault API:Updating whether materials with textures will be treated as transparent objects.",VIEWER_LOGGER_getObjectTypeByPsId:"getObjectTypeByPsId API:Finding the type of geometry an object refers to.",VIEWER_LOGGER_setFaceWireframeVisibilityByPsId:"setFaceWireframeVisibilityByPsId API:Finding the type of geometry an object refers to.",VIEWER_LOGGER_getFaceWireframeVisibilityByPsId:"getFaceWireframeVisibilityByPsId API:Returning the visibility of the face wire frames for the given PSID.",VIEWER_LOGGER_warn_getFaceWireframeVisibilityByPsId:"getFaceWireframeVisibilityByPsId API:Object is either not defined or null.",VIEWER_LOGGER_finest_autoExplode:"autoExplode API: Model %d% exploded.",VIEWER_LOGGER_setExplodeMode:"setExplodeMode API: Updating the mode of auto-explode.",VIEWER_LOGGER_getExplodeMode:"getExplodeMode API: Returning the current auto-explode mode.",VIEWER_LOGGER_setFPS:"setFPS API: FPS is now set to: ",VIEWER_LOGGER_getFPS:"getFPS API: Current FPS is set at: ",VIEWER_LOGGER_setFPS_warn:"setFPS API: FPS acceptable range is between 1 and 60.",VIEWER_LOGGER_addSGO:"addSGO API: Adding Scene Graph Object to the scene.",VIEWER_LOGGER_removeSGO:"removeSGO API: Removing Scene Graph Object from the scene.",VIEWER_LOGGER_getSGOs:"getSGOs API: Returns all Scene Graph Objects in the scene.",VIEWER_LOGGER_renderOrderSGO:"renderOrderSGO API: Reorders the rendering of a Scene Graph Object in the scene.",VIEWER_LOGGER_getWCS:"getWCS API: Returning World Coordinate System Trihedron object.",VIEWER_LOGGER_setTransparentRenderingFlag:"setTransparentRenderingFlag API: Transparent rendering flag is now: ",VIEWER_LOGGER_getTransparentRenderingFlag:"getTransparentRenderingFlag API: Transparent rendering flag is currently: ",VIEWER_LOGGER_setPickOnly:"setPickOnly API: Pick-Only raycasting is now: ",VIEWER_LOGGER_getPickOnly:"getPickOnly API: Pick-Only raycasting is currently: ",VIEWER_LOGGER_setEventPriority:"setEventPriority API: Component, type, priority: ",VIEWER_LOGGER_getEventPriority:"getEventPriority API: Component, type: ",VIEWER_LOGGER_setMouseEasing:"setMouseEasing API: factor: ",VIEWER_LOGGER_err_setMouseEasing:"setMouseEasing API: invalid factor.",VIEWER_LOGGER_getMouseEasing:"getMouseEasing API: factor: ",VIEWER_LOGGER_registerPickingEvent:"registerPickingEvent API: Registering the picking event.",VIEWER_LOGGER_unregisterPickingEvent:"unregisterPickingEvent API: Unregistering the picking event.",VIEWER_LOGGER_registerCameraChangedEvent:"registerCameraChangedEvent API: registering the camera changed event.",VIEWER_LOGGER_unregisterCameraChangedEvent:"unregisterCamerachangedEvent API: unregistering the camera changed event.",VIEWER_LOGGER_setUserCapColor:"setUserCapColor API: Setting the user cap material via the material definition",VIEWER_LOGGER_resetUserCapColor:"resetUserCapColor API: Resetting the user cap material to the default material definition ( diffuse: 0x999999, emissive: 0x0, specular: 0x0, shininess: 1, opacity: 1 )",VIEWER_LOGGER_setUserCapColorEnabled:"setUserCapColorEnabled API: Section cap colors are now using the user-defined section cap material, set via the 'setUserCapColor' API",VIEWER_LOGGER_warn_setUserCapColorEnabled:"setUserCapColorEnabled API: Flag parameter is not a boolean value",VIEWER_LOGGER_getUserCapColorEnabled:"getUserCapColorEnabled API: User-defined section cap material is ",VIEWER_LOGGER_getBodyIdsById:"getBodyIdsById API: returning the body ids owned by or associated with the object with id :",VIEWER_LOGGER_getEdgeIdsById:"getEdgeIdsById API: returning the edge ids owned by or associated with the object with id :",VIEWER_LOGGER_getFaceIdsById:"getFaceIdsById API: returning the face ids owned by or associated with the object with id : ",VIEWER_LOGGER_getVertexIdsById:"getVertexIdsById API: returning the vertex ids owned by or associated with the object with id :",VIEWER_LOGGER_addBox:"addBox API: ",VIEWER_LOGGER_addSolidBox:"addSolidBox API: ",VIEWER_LOGGER_removeBox:"removeBox API: id: ",VIEWER_LOGGER_addLine:"addLine API: ",VIEWER_LOGGER_removeLine:"removeLine API: id: ",VIEWER_LOGGER_error_updateGeometryByPsId:"updateGeometryByPsId API: bad psId:",VIEWER_LOGGER_error_PrototypeId:"protoId cannot be undefined",VIEWER_LOGGER_error_PsId:"psId cannot be undefined",PMI_LOGGER_registerVisibilityChangeEventByPsId:"PMI-registerVisibilityChangeEventByPsId API: Registers the given visibility change event on a specific object.",PMI_LOGGER_unregisterVisibilityChangeEventByPsId:"PMI-unregisterVisibilityChangeEventByPsId API: Unregistering the given visibility change event on a specific object.",PMI_LOGGER_registerSelectionChangeEventByPsId:"PMI-registerSelectionChangeEventByPsId API: registering the given selection change event on a specific object.",PMI_LOGGER_unregisterSelectionChangeEventByPsId:"PMI-unregisterSelectionChangeEventByPsId API: unregistering the given selection change event on a specific object.",PMI_LOGGER_loadPmiData:"PMI-loadPmiData API: Loading PMI data from plm_pmi.json.",PMI_LOGGER_finest_loadPmiData:"PMI-loadPmiData API: Pmi data is loaded.",PMI_LOGGER_warn_loadPmiData:"PMI-loadPmiData API: Object with the given psid is either null or not defined.",PMI_CONSOLE_warn_loadPmiData:"Failed to receive XMLHttpRequest data!",PMI_CONSOLE_warn2_loadPmiData:"Failed to receive XMLHttpRequest response!",PMI_CONSOLE_err_loadPmiData:"Failed to retrieve ",PMI_LOGGER_loadPmiDataWithObject:"PMI-loadPmiDataWithObject API: Loading PMI data from the given jaavscript object.",PMI_LOGGER_warn_loadPmiDataWithObject:"PMI-loadPmiDataWithObject API: Object with the given psid is either null or not defined.",PMI_LOGGER_isPmiObject:"PMI-isPmiObject API:Finding if current psid is associated with a pmi object.",PMI_LOGGER_alignCameraToPmi:"PMI-alignCameraToPmi API:Aligning the camera to a specified PMI object.",PMI_LOGGER_setPmiSelectionMaterial:"PMI-setPmiSelectionMaterial API:Updating the selection material for PMI.",PMI_LOGGER_setPmiColorByPsId:"PMI-setPmiColorByPsId API:Updating the color of the object specified.",PMI_LOGGER_finest_setPmiColorByPsId:"PMI-setPmiColorByPsId API:Updated the color of the object specified.",PMI_LOGGER_setPmiMaterial:"PMI-setPmiMaterial API:Updating the material for PMI.",PMI_LOGGER_finest_setPmiMaterial:"PMI-setPmiMaterial API:Updated the material for PMI.",PMI_LOGGER_getPmiStructureInfo:"PMI-getPmiStructureInfo API:Returning the PMI structure information.",PMI_LOGGER_getDesignGroupsStructureInfo:"PMI-getDesignGroupsStructureInfo API:Retrieving Design Groups structure information.",PMI_LOGGER_getModelViewsStructureInfo:"PMI-getModelViewsStructureInfo API:Retrieving Model Views structure information.",PMI_LOGGER_setSelectionByPsId:"PMI-setSelectionByPsId API:Updating the selection of the given object to: ",PMI_LOGGER_finest_setSelectionByPsId:"PMI-setSelectionByPsId API:Updated the selection of the given object to: ",PMI_LOGGER_setDesignGroupActive:"PMI-setDesignGroupActive API:Updating the sdesign group status",PMI_LOGGER_setModelViewActive:"PMI-setModelViewActive API:Updating the model view status.",PMI_LOGGER_getVisibilityStateByPsId:"getVisibilityStateByPsId API: returning visibility state of a PMI object with psId:",PMI_LOGGER_warn_getVisibilityStateByPsId:"getVisibilityStateByPsId API: object is undefined or null.",PMI_CONSOLE_log_setModelViewActive:"Warning: Feature IDs not supported for Model Groups.",PMI_CONSOLE_warn__setObjectSelection:"Encountered unknown object (%d) during selection.",PMI_CONSOLE_warn2__setObjectSelection:"ERROR!\nProcessing PMI ID: %s\nFeature not found: %s",ANNOTATION_LOGGER_finest_createGenericAnnotation:"Annotation- createGenericAnnotation API- Returning the annotation id :",ANNOTATION_LOGGER_setAnchorHandlerOn:"Annotation- setAnchorHandlerOn API- Turning on select and drag functions to anchored text",ANNOTATION_LOGGER_removeByAnnotationId:"Annotation- removeByAnnotationId API- Removing an individual annotation with given id.",ANNOTATION_LOGGER_finest_removeByAnnotationId:"Annotation- removeByAnnotationId API-Annotation with given id removed successfully.",ANNOTATION_LOGGER_createGenericAnnotation:"Annotation- createGenericAnnotation API- Creating a generic annotation that is outside of the scene.",ANNOTATION_LOGGER_setOnTopByAnnotationId:"Annotation- setOnTopByAnnotationId API- Updating the onTop state for the specified annotation.",ANNOTATION_LOGGER_getOnTopByAnnotationId:"Annotation- getOnTopByAnnotationId API- Returning the onTop state for the specified annotation.",ANNOTATION_LOGGER_finest_getOnTopByAnnotationId:"Annotation- getOnTopByAnnotationId API- onTop state for the specified annotation is returned successfully.",ANNOTATION_LOGGER_warn_getOnTopByAnnotationId:"Annotation- getOnTopByAnnotationId API- Annotation object is undefined.",ANNOTATION_LOGGER_setVisibilityByAnnotationId:"Annotation- setVisibilityByAnnotationId API- Updating the visibility state for the specified annotation.",ANNOTATION_LOGGER_latest_setVisibilityByAnnotationId:"Annotation- setVisibilityByAnnotationId API- Updated the visibility state for the specified annotation.",ANNOTATION_LOGGER_getVisibilityByAnnotationId:"Annotation- getVisibilityByAnnotationId API- Finding the visibility state for the specified annotation.",ANNOTATION_LOGGER_warn_getVisibilityByAnnotationId:"Annotation- getVisibilityByAnnotationId API- Annotation object with the given id is either undefined or null.",ANNOTATION_LOGGER_setPositionByAnnotationId:"Annotation- setPositionByAnnotationId API- Updating the position of the specified annotation.",ANNOTATION_LOGGER_setAnchorPositionByAnnotationId:"Annotation- setAnchorPositionByAnnotationId API- Updating the anchor position of the specified annotation.",ANNOTATION_LOGGER_getPositionByAnnotationId:"Annotation- getPositionByAnnotationId API- Finding the  position of the specified annotation.",ANNOTATION_LOGGER_getAnchorPositionByAnnotationId:"Annotation- getAnchorPositionByAnnotationId API- Finding the  anchor position of the specified annotation.",ANNOTATION_LOGGER_getContentByAnnotationId:"Annotation- getContentByAnnotationId API- Finding the content of the specified annotation.",ANNOTATION_LOGGER_setContentByAnnotationId:"Annotation- setContentByAnnotationId API- Setting the content of the specified annotation.",ANNOTATION_LOGGER_setPositionsByAnnotationId:"Annotation- setPositionsByAnnotationId API-Updating  both the position and anchor position of the specified annotation.",ANNOTATION_LOGGER_setAnnotationsOnTop:"Annotation- setAnnotationsOnTop API-Updating  whether the annotations should all be on top or not from the given parameter.",ANNOTATION_LOGGER_getAnnotationsOnTop:"Annotation- getAnnotationsOnTop API-Finding whether the annotations should all be on top or not.",ANNOTATION_LOGGER_setPositionByAnnotationIdByViewCoordinates:"Annotation- setPositionByAnnotationIdByViewCoordinates API-Updating the position of the specified annotation relative to the current view.",ANNOTATION_LOGGER_addSprite:"Annotation- addSprite API-Adding a sprite annotation to the scene.",ANNOTATION_LOGGER_setOwnerNameByAnnotationId:"Annotation- setOwnerNameByAnnotationId API- Setting the owner of the text for the specified annotation.",ANNOTATION_LOGGER_registerAnnotationEvent:"Annotation- registerAnnotationEvent API-Registering an annotation event for annotation objects.",ANNOTATION_LOGGER_unregisterAnnotationEvent:"Annotation- unregisterAnnotationEvent API-Unregistering an annotation event for annotation objects.",ANNOTATION_LOGGER_clearSelected:"Annotation- clearSelected API-Clears all annotation object selection.",PROPERTIES_LOGGER_loadProperties:"Properties- loadProperties API-Loading the properties of the parts with the psid of the model.",PROPERTIES_LOGGER_warn_loadProperties:"Properties- loadProperties API-Failed to retrieve the path given.",PROPERTIES_LOGGER_getProperties:"Properties- getProperties API-Returning the properties of the parts with the psid of the model.",PROPERTIES_LOGGER_getProperty:"Properties- getProperty API-Returning the property value of the property key.",PROPERTIES_LOGGER_loadAllProperties:"Properties- loadAllProperties API-Loading properties of all the models in the scene.",PROPERTIES_LOGGER_addProperty:"Properties- addProperty API-Dynamically adding a key-value pair to the object properties",PROPERTIES_LOGGER_addProperties:"Properties- addProperties API-Dynamically adding a property object to the object properties",PROPERTIES_LOGGER_removeProperty:"Properties- removeProperty API-Dynamically removing a key-value pair to the object properties",PROPERTIES_LOGGER_removeAllProperties:"Properties- removeAllProperties API-Dynamically removing all object properties associated with psId",WCS_LOGGER_setVisibility:"WCS- setVisibility API-Updating the visibility state for the WCS.",WCS_LOGGER_getVisibility:"WCS- getVisibility API-Finding the visibility state for the WCS.",WCS_LOGGER_setPosition:"WCS- setPosition API-Repositioning the WCS trihedron.",WCS_LOGGER_getPosition:"WCS- getPosition API-Finding the position of the WCS.",WCS_LOGGER_setSize:"WCS- setSize API-Updating the size of the WCS.",WCS_LOGGER_getSize:"WCS- getSize API-Finding the size of the WCS.",WCS_LOGGER_setOnTop:"WCS- setOnTop API- Updating whether the WCS is rendered on top of or behind the scene geometry.",WCS_LOGGER_getOnTop:"WCS- getOnTop API-Finding whether the WCS is rendered on top of or behind the scene geometry.",CULLING_LOGGER_initialize:"Culling- initialize API-Initializing the culling library.",CULLING_LOGGER_warn_initialize:"Culling- initialize API- Error:",CULLING_LOGGER_warn2_initialize:"Culling- initialize API-worker is not defined or null.",CULLING_LOGGER_warn_clear:"Culling- unknown failure to remove all cullable objects",CULLING_LOGGER_warn_render:"Culling- unknown failure before a render",CULLING_LOGGER_warn_setCullableObjects:"Culling- unknown failure during setCullableObjects",CULLING_LOGGER_unregisterLayerChangeEvent:"Culling- unregisterLayerChangeEvent API-Unregistering a layer change event for the whole view.",CULLING_LOGGER_registerLayerChangeEvent:"Culling- registerLayerChangeEvent API-Registering a layer change event for the whole view.",CULLING_LOGGER_getCullingLayerByPsId:"Culling- getCullingLayerByPsId API- Finding an object's current layer.",CULLING_LOGGER_warn_getCullingLayerByPsId:"Culling-getCullingLayerByPsId API- object for given psid is not defined.",CULLING_LOGGER_setCullableObjects:"Culling- setCullableObjects API- Setting the list of cullable objects.",CULLING_LOGGER_getCullableObjects:"Culling- getCullableObjects API-retrieivng the identifiers and culling layer of all registered objects.",CULLING_LOGGER_setBatchFrames:"Culling- setBatchFrames API- Setting the frames between processing cull batches.",CULLING_LOGGER_getBatchFrames:"Culling- getBatchFrames API- Returning the frames between processing cull batches.",CULLING_LOGGER_setBatchSize:"Culling- setBatchSize API- Updating the number of cull actions to process per cull batch.",CULLING_LOGGER_getBatchSize:"Culling- getBatchSize API- Returning the number of cull actions to process per cull batch.",CULLING_LOGGER_setBoundary1Size:"Culling- setBoundary1Size API-Updating the screen radius of the object when the first cull action should occur.",CULLING_LOGGER_getBoundary1Size:"Culling- getBoundary1Size API-Returning  the screen radius of the object when the first cull action should occur.",CULLING_LOGGER_setBoundary2Size:"Culling- setBoundary2Size API-Updating  the screen radius of the object when the second cull action should occur.",CULLING_LOGGER_getBoundary2Size:"Culling- getBoundary2Size API-Returning  the screen radius of the object when the second cull action should occur.",CULLING_LOGGER_setBoundarySizes:"Culling- setBoundarySizes API-Updating  the screen radius of the object when the first and second cull action should occur.",CULLING_LOGGER_useDefaultActions:"Culling- useDefaultActions API-Updating whether the culling module should use default culling actions or not.",CULLING_LOGGER_isUsingDefaultActions:"Culling- isUsingDefaultActions API-Finding whether the the culling module is using default culling actions or not.",CULLING_LOGGER_setUseLoadingUnloading:"Culling- setUseLoadingUnloading API-Updating  whether the culling actions include loading/unloading (for use with default actions only).",CULLING_LOGGER_isUsingLoadingUnloading:"Culling- isUsingLoadingUnloading API-Finding whether culling actions include laoding/unloading.",CULLING_LOGGER_setActive:"Culling- setActive API-Updating whether culling occurs or not.",CULLING_LOGGER_isActive:"Culling- isActive API-Finding whether culling occurs or not.",CULLING_LOGGER_setSuspendOnMovement:"Culling- setSuspendOnMovement API-Updating whether culling should still occur while rotating/panning or not.",CULLING_LOGGER_getSuspendOnMovement:"Culling- getSuspendOnMovement API-Finding whether culling should still occur while rotating/panning or not.",CULLING_LOGGER_updateObjects:"Culling- updateObjects API-Updating all currently cullable objects.",CULLING_LOGGER_addCullableObjectByPsId:"Culling- addCullableObjectByPsId API-Adding the object identified by given psid to the list of cullable objects.",CULLING_LOGGER_removeCullableObjectByPsId:"Culling- removeCullableObjectByPsId API-Removing the object identified by given psid to the list of cullable objects.",CULLING_LOGGER_processCullableObjectByPsId:"Culling- processCullableObjectByPsId API- Processing the current culling layer of the object identified by given psid.",CULLING_LOGGER_processCullableObjects:"Culling- processCullableObjects API- Processing the current culling layer of all cullable objects.",CULLING_LOGGER_isCullableObject:"Culling- isCullableObject API- Returning if the object is in the list of cullable objects.",CULLING_LOGGER_waitUtilNotBusy:"Culling- waitUtilNotBusy API-waiting until the culler is done processing all registered parts.",CULLING_LOGGER_getCullingLayer:"Culling- getCullingLayer API-retrieving the culling layer for a specific registered object.",CULLING_LOGGER_addCullableObjects:"Culling- addCullableObjects API-adding a list of objects to the registered list of cullable objects.",CULLING_LOGGER_removeCullableObjects:"Culling- removeCullableObjects API-removing a list of objects from the registered list of cullable objects.",CULLING_LOGGER_registerLayerChangeBatchEvent:"Culling- registerLayerChangeBatchEvent API-registers for batches of layer change events.",CULLING_LOGGER_unregisterLayerChangeBatchEvent:"Culling- unregisterLayerChangeBatchEvent API-unregisters for batches of layer change events.",CULLING_LOGGER_setLayerBoundaries:"Culling- setLayerBoundaries API-defines the thresholds from when registered objects transition from one layer to another.",CULLING_LOGGER_getLayerBoundaries:"Culling- getLayerBoundaries API-retrieves the thresholds for when registered objects transition from one layer to another.",CULLING_LOGGER_setUseMovingFrameCulling:"Culling- setUseMovingFrameCulling API-defines whether or not moving-frame-culling is to be used.",CULLING_LOGGER_getUseMovingFrameCulling:"Culling- getUseMovingFrameCulling API-retreives whether or not moving-frame-culling is to be used.",CULLING_LOGGER_setFetchCountWhileRotating:"Culling- setFetchCountWhileRotating API-sets how many objects are processed in between frames while rotating.",CULLING_LOGGER_getFetchCountWhileRotating:"Culling- getFetchCountWhileRotating API-gets how many objects are processed in between frames while rotating.",CULLING_LOGGER_setFetchCountWhileIdle:"Culling- setFetchCountWhileIdle API-sets how many objects are processed in batches when the user is not rotating (idle).",CULLING_LOGGER_getFetchCountWhileIdle:"Culling- getFetchCountWhileIdle API-retrieves how many objects are processed in batches when the user is not rotating (idle).",SECTION_LOGGER_registerPlaneSelectionEvent:"Section- registerPlaneSelectionEvent API-Registering section plane selected event.",SECTION_LOGGER_unregisterPlaneSelectionEvent:"Section- unregisterPlaneSelectionEvent API-Unregistering section plane selected event.",SECTION_LOGGER_setSectionActive:"Section- setSectionActive API-Enabling or disabling sectioning depending on the given parameter",SECTION_LOGGER_getSectionActive:"Section- getSectionActive API-Finding if the sectioning is enabled.",SECTION_LOGGER_clear:"Section- clear API-Clearing all section plane in the scene.",SECTION_LOGGER_addSectionPlane:"Section- addSectionPlane API-Adding a section plane to the scene.",SECTION_LOGGER_finest_addSectionPlane:"Section- addSectionPlane API-Plane id created: ",SECTION_LOGGER_removeSectionPlane:"Section- removeSectionPlane API-Removing a section plane from the scene.",SECTION_LOGGER_setSectionSide:"Section- setSectionSide API- Updating the sectioning side of section plane.",SECTION_LOGGER_getSectionSide:"Section- getSectionSide API-Finding the sectioning side of section plane.",SECTION_LOGGER_warn_getSectionSide:"Section- getSectionSide API-Section plane is not defined.",SECTION_LOGGER_setSectionDirection:"Section- setSectionDirection API-Updating the direction/normal of section plane.",SECTION_LOGGER_getSectionDirection:"Section- getSectionDirection API-Finding the direction/normal of section plane.",SECTION_LOGGER_info2_getSectionDirection:"Section- getSectionDirection API-Section plane is undefined.",SECTION_LOGGER_setSectionPosition:"Section- setSectionPosition API-Updating the position of section plane.",SECTION_LOGGER_getSectionPosition:"Section- getSectionPosition API-Finding the position of section plane.",SECTION_LOGGER_warn_getSectionPosition:"Section- getSectionPosition API-Section plane is undefined.",SECTION_LOGGER_setSelectionById:"Section- setSelectionById API-Updating the selection state of a section plane.",SECTION_LOGGER_getSelectionById:"Section- getSelectionById API-Finding the selection state of a section plane.",SECTION_LOGGER_finest_getSelectionById:"Section- getSelectionById API-Selection sate of the plane found.",SECTION_LOGGER_warn_getSelectionById:"Section- getSelectionById API-Section plane is not defined.",SECTION_LOGGER_setSelectionAll:"Section- setSelectionAll API-Updating the selection state for all section planes.",SECTION_LOGGER_noCycle:"Section- path without cycle found. A section cap may be missing for",SELECTION_CONSOLE_warn__setObjectSelection:"Encountered unknown object (%s) during selection.",SELECTION_CONSOLE_warn__setObjectHighlight:"Encountered unknown object (%s) during highlight.",SELECTION_LOGGER_setAreaSelect:"setAreaSelect API: Area selection state is updated to: ",SELECTION_LOGGER_getAreaSelect:"getAreaSelect API: Area selection state is currently: ",SELECTION_LOGGER_setSelectionMaterial:"setSelectionMaterial API:Updating the selection material to given values.",SELECTION_LOGGER_setHighlightingMaterial:"setHighlightingMaterial API:Updating the highlight material to given values.",SELECTION_LOGGER_setPickingModes:"setPickingModes API: Updating picking modes.",SELECTION_LOGGER_setPickingMode:"setPickingMode API: Updating picking mode.",SELECTION_LOGGER_finest_setPickingMode:"setPickingMode API: Picking mode is updated to :",SELECTION_LOGGER_getPickingMode:"getPickingMode API: returning the picking mode.",SELECTION_LOGGER_setSelectionToggleMode:"setSelectionToggleMode API: Selection toggle mode is updated to :",SELECTION_LOGGER_getSelectionToggleMode:"getSelectionToggleMode API: returning the selection toggle mode.",SELECTION_LOGGER_selectNone:"selectNone API: clearing the selection in the scene.",SELECTION_LOGGER_getSelectedParts:"getSelectedParts API : getting selected parts.",SELECTION_LOGGER_finest_getSelectedParts:"getSelectedParts API : selected part with psid : ",SELECTION_LOGGER_getSelectedBodies:"getSelectedBodies API : getting selected bodies.",SELECTION_LOGGER_finest_getSelectedBodies:"getSelectedBodies API : selected body with psid : ",SELECTION_LOGGER_getSelectedFaces:"getSelectedFaces API : getting selected faces.",SELECTION_LOGGER_finest_getSelectedFaces:"getSelectedFaces API : selected face with psid : ",SELECTION_LOGGER_getSelectedEdges:"getSelectedEdges API : getting selected edges.",SELECTION_LOGGER_finest_getSelectedEdges:"getSelectedEdges API : selected edge with psid : ",SELECTION_LOGGER_getSelectedVerticesInfo:"getSelectedVerticesInfo API : getting selected vertices.",SELECTION_LOGGER_finest_getSelectedVerticesInfo:"getSelectedVerticesInfo API : selected vertices : ",SELECTION_LOGGER_setSelectionByPsId:"setSelectionByPsId API: updating selection of the object with psid:",SELECTION_LOGGER_setSelectionByPsIds:"setSelectionByPsIds API: updating selection of the objects with the array of psids.",SELECTION_LOGGER_getSelectionByPsId:"getSelectionByPsId API: get selection information of the object with psid:",SELECTION_LOGGER_registerSelectionEvent:"registerSelectionEvent API: registering the selection event.",SELECTION_LOGGER_unregisterSelectionEvent:"unregisterSelectionEvent API: unregistering the selection event.",SELECTION_LOGGER_registerSelectionChangeEventByPsId:"registerSelectionChangeEventByPsId API:registering selection change event for the object with given psid",SELECTION_LOGGER_finest_registerSelectionChangeEventByPsId:"registerSelectionChangeEventByPsId API:selection change event for the object with given psid registered successfully.",SELECTION_LOGGER_unregisterSelectionChangeEventByPsId:"unregisterSelectionChangeEventByPsId API: Unregistering selection change event for the object with given psid.",SELECTION_LOGGER_finest_unregisterSelectionChangeEventByPsId:"unregisterSelectionChangeEventByPsId API:Selection change event for the object with given psid unregistered successfully.",SELECTION_LOGGER_setPickOnly:"setPickOnly API: Pick-Only raycasting is now: ",SELECTION_LOGGER_getPickOnly:"getPickOnly API: Pick-Only raycasting is currently: ",SELECTION_LOGGER_registerPickingEvent:"registerPickingEvent API: Registering the picking event.",SELECTION_LOGGER_unregisterPickingEvent:"unregisterPickingEvent API: Unregistering the picking event.",SELECTION_LOGGER_setPartialAreaSelect:"setPartialAreaSelect API: Partial area select flag set to ",SELECTION_LOGGER_getPartialAreaSelect:"getPartialAreaSelect API: Partial area select flag is ",SELECTION_LOGGER_findObjectsInArea:"findObjectsInArea API: Returning all objects within the specified area.",SCENE_LOGGER_nullEdgeWarn:"Scene.setEdges- Some edges may be missing. Null edge data found in ",SCENE_LOGGER_insufficientVertices:"Scene.addSectionCaps- Insufficient vertices for section cap triangulation for ",SCENEGRAPH_LOGGER_threeErr:"Raycaster: Unsupported camera type.",SCENEGRAPH_LOGGER_threeWarn:"Raycaster.intersectObjects: objects is not an Array.",SHAPES_LOGGER_addBox:"addBox API: ",SHAPES_LOGGER_addSolidBox:"addSolidBox API: ",SHAPES_LOGGER_err_addBox:"addBox API: invalid parameters.",SHAPES_LOGGER_err_addSolidBox:"addSolidBox API: invalid parameters.",SHAPES_LOGGER_addLine:"addLine API: ",SHAPES_LOGGER_err_addLine:"addLine API: invalid parameters.",SHAPES_LOGGER_addPlane:"addPlane API: ",SHAPES_LOGGER_err_addPlane:"addPlane API: invalid parameters.",SHAPES_LOGGER_removeShape:"removeshape API: id: ",SHAPES_LOGGER_setVisibilityById:"setVisibilityById API: updating visibility of the shape with id: ",SHAPES_LOGGER_getVisibilityById:"getVisibilityById API: returning  visibility of the shape with id: ",SHAPES_LOGGER_clearShapes:"clearShapes API: id: ",SNAPSHOT_LOGGER_setSnapshotEnabled:"Snapshot- setSnapshotEnabled API-Enabling or disabling snapshot creation depending on the argument.",SNAPSHOT_LOGGER_getSnapshotEnabled:"Snapshot- getSnapshotEnabled API-Retrieving the current snapshot-enabled state.",SNAPSHOT_LOGGER_createSnapshotPNG:"Snapshot- createSnapshotPNG API-Creating a snapshot based on the current scenegraph state.",SNAPSHOT_LOGGER_createSnapshotSVG:"Snapshot- createSnapshotSVG API-Creating a snapshot based on the current scenegraph state.",SNAPSHOT_LOGGER_print:"Snapshot- print API-Printing the current contents of the viewer.",SNAPSHOT_LOGGER_warn_print:"Snapshot- print API-Snapshot is disabled.",MEASUREMENT_LOGGER_registerMeasurementEvent:"Measurement- registerMeasurementEvent API-Registering measurement event for Measurement Event notifications.",MEASUREMENT_LOGGER_unregisterMeasurementEvent:"Measurement- unregisterMeasurementEvent API-Removing the given callback from Measurement Event notifications.",MEASUREMENT_LOGGER_measure:"Measurement- measure API-Performing measurement operation given a specified measurement parameters.",XTBODLOADER_CONSOLE_warn_loadFromBinary:"Failed to load XT geometry - Binary data undefined.",THREEEXTENSIONS_CONSOLE_err_updateBuffer:"THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.",THREEEXTENSIONS_CONSOLE_err_WebGLRenderer:"PLMVisWeb.WebGLRenderer:",THREEEXTENSIONS_CONSOLE_err_setupVertexAttributes:"PLMVisWeb.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.",THREEEXTENSIONS_CONSOLE_err_render:"PLMVisWeb.WebGLRenderer.render: camera is not an instance of THREE.Camera.",THREEEXTENSIONS_CONSOLE_err_uploadTexture:"Float Depth Texture only supported in WebGL2.0",THREEEXTENSIONS_CONSOLE_err_setupDepthTexture:"Depth Texture with cube render targets is not supported!",THREEEXTENSIONS_CONSOLE_err2_setupDepthTexture:"renderTarget.depthTexture must be an instance of THREE.DepthTexture.",THREEEXTENSIONS_CONSOLE_err_depthTexture:"target.depthTexture not supported in Cube render targets.",THREEEXTENSIONS_CONSOLE_err_readRenderTargetPixels:"PLMVisWeb.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.",THREEEXTENSIONS_CONSOLE_err2_readRenderTargetPixels:"PLMVisWeb.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.",THREEEXTENSIONS_CONSOLE_err3_readRenderTargetPixels:"PLMVisWeb.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.",THREEEXTENSIONS_CONSOLE_err4_readRenderTargetPixels:"PLMVisWeb.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.",MARKUP_LOGGER_enableMarkup:"Markup- enableMarkup : ",MARKUP_LOGGER_setMarkupMode:"Markup- setMarkupMode : ",MARKUP_LOGGER_showMarkupViewByFile:"Markup- showMarkupViewByFile : ",MARKUP_LOGGER_downloadMarkupView:"Markup- downloadMarkupView : ",MARKUP_LOGGER_showMarkupViewByData:"Markup- showMarkupViewByData : ",MARKUP_LOGGER_getMarkupViewData:"Markup- getMarkupViewData : ",MARKUP_LOGGER_deleteSelected:"Markup- deleteSelected.",MARKUP_LOGGER_setMarkupProperty:"Markup- setMarkupProperty : ",MARKUP_LOGGER_createLine:"Markup- createLine.",MARKUP_LOGGER_createFreehand:"Markup- createFreehand.",MARKUP_LOGGER_createEllipse:"Markup- createEllipse.",MARKUP_LOGGER_createRect:"Markup- createRect.",MARKUP_LOGGER_createText:"Markup- createText.",MARKUP_LOGGER_createAnchoredText:"Markup- createAnchoredText.",MARKUP_LOGGER_selectMarkup:"Markup- selectMarkup: ",MARKUP_LOGGER_deleteMarkup:"Markup- deleteMarkup: ",MARKUP_LOGGER_setPropertyOnMarkup:"Markup- setPropertyOnMarkup: ",MARKUP_LOGGER_getPropertyOnMarkup:"Markup- getPropertyOnMarkup: ",MARKUP_LOGGER_getMarkupViewImage:"Markup- getMarkupViewImage.",MARKUP_LOGGER_showMarkupLayerByFile:"Markup- showMarkupLayerByFile : ",MARKUP_LOGGER_downloadMarkupLayer:"Markup- downloadMarkupLayer : ",MARKUP_LOGGER_showMarkupLayerByData:"Markup- showMarkupLayerByData : ",MARKUP_LOGGER_getMarkupLayerData:"Markup- getMarkupLayerData : ",MARKUP_LOGGER_newLayer:"Markup- newLayer: ",MARKUP_LOGGER_deleteLayer:"Markup- deleteLayer: ",MARKUP_LOGGER_getNumberOfLayers:"Markup- getNumberOfLayers: ",MARKUP_LOGGER_getLayers:"Markup- getLayers: ",MARKUP_LOGGER_setActiveLayer:"Markup- setActiveLayer: ",MARKUP_LOGGER_getActiveLayer:"Markup- getActiveLayer: ",MARKUP_LOGGER_setLayerVisibility:"Markup- setLayerVisibility: ",MARKUP_LOGGER_getLayerVisibility:"Markup- getLayerVisibility: ",MARKUP_LOGGER_invalidInputArg:"Markup- invalid input argument.",MARKUP_LOGGER_openErrorSVG:"Markup - failed to open SVG file.",MOUSEINPUT_LOGGER_doMouseDown:"Mouse Input, Down",MOUSEINPUT_LOGGER_doMouseMove:"Mouse Input, Move",MOUSEINPUT_LOGGER_doMouseUp:"Mouse Input, Up",MOUSEINPUT_LOGGER_doMouseScroll:"Mouse Input, Scroll",TOUCHINPUT_LOGGER_doTouchStart:"Touch Input, Start",TOUCHINPUT_LOGGER_doTouchEnd:"Touch Input, End",TOUCHINPUT_LOGGER_doTouchMove:"Touch Input, Move",VIEWER_DAC_LOGGER_ERROR_invalidParent:" Invalid parent PsId: ",VIEWER_DAC_LOGGER_ERROR_invalidInstanceId:" Invalid instance PsId: ",VIEWER_DAC_LOGGER_ERROR_invalidNode:" Invalid node PsId:",VIEWER_DAC_LOGGER_createNode:" New node created with PsId: ",CACHELOADEREXT_LOGGER_finest_openCacheDB:"DB Cache opened: ",CACHELOADEREXT_LOGGER_finest_retrieved:"record retrieved, VALUE: PENDING COUNT:  ",CACHELOADEREXT_LOGGER_finest_saved:"record added ID:, PENDING COUNT: ",CACHELOADEREXT_LOGGER_finest_db_Open:" cache open ",CACHELOADEREXT_LOGGER_fine_readFinished:"cache read finished ",CACHELOADEREXT_LOGGER_fine_deleteSuccess:"delete success",CACHELOADEREXT_LOGGER_fine_cachingFinished:"caching finished ",CACHELOADEREXT_LOGGER_warn_unableToOpenCache:"Unable to open DB Cache ",CACHELOADEREXT_LOGGER_warn_failedToFindCacheRecord:"Failed to get record ",CACHELOADEREXT_LOGGER_warn_failedToAddCacheRecord:"Failed to add record VALUE: , ERROR: ",CACHELOADEREXT_LOGGER_warn_purgeError:"purge error",CACHELOADEREXT_LOGGER_warn_purgeBlocked:"Couldn't delete database due to the operation being blocked",CACHELOADEREXT_LOGGER_warn_errorFired:"error fired",CACHELOADEREXT_LOGGER_warn_cacheOpenFailed:"Open failed",CACHELOADEREXT_LOGGER_warn_mustCallStart:"Must initialize with Start()",CACHELOADEREXT_LOGGER_warn_cacheStatusFail:" error checking cache status ",CACHELOADEREXT_LOGGER_warn_mustCallOpen:"Must initialize with Open()",CACHELOADEREXT_LOGGER_warn_badPut:"Invalid state or args on Put ",CACHELOADEREXT_LOGGER_warn_badGet:"Invalid state or args on Get",CACHELOADEREXT_LOGGER_warn_failedToGetModelList:"error getting model List"};
/***/},
/* 141 */
/***/function(e,t,n){"use strict";n.r(t);
// EXTERNAL MODULE: ./staging/Utilities.js + 1 modules
var r=n(0),i=n(3),a=n(4),o=/* */n.n(a),s=o()("PLMVisWeb:debug:PLMVisWeb"),l=o()("PLMVisWeb:error:PLMVisWeb");
// EXTERNAL MODULE: ./staging/StringTable.js
l.enabled=!0;"undefined"==typeof PLMVISWEB_CONFIG||null===PLMVISWEB_CONFIG||PLMVISWEB_CONFIG;var c=void 0!==self.document,u=function(){if(c){var e=null;if(document.currentScript)e=document.currentScript.getAttribute("src");else{var t=document.getElementsByTagName("script");e=t&&t.length&&t[t.length-1].getAttribute("src")}if(e&&(e.indexOf("plmvisweb.min.js")>-1||e.indexOf("PLMVisWeb.js")>-1))return e.substring(0,e.lastIndexOf("/")+1)}return""}(),h=null,d=!1;function PLMVisWeb(e){s("PLMVisWeb constructor"),s("notWorker = "+c.toString()),s("plmVisWebPath = "+u),h=new StringTable,e&&(e.locale&&h.setLocale(e.locale,null,!1),e.localePath&&h.setLocalePath(e.localePath,null,!1),e.silent&&(d=e.silent)),c&&console.log([this.PRODUCT,this.VERSION,this.COPYRIGHT].join(" "))}PLMVisWeb.prototype.setLocale=function(e,t){h.setLocale(e,t,!0)},PLMVisWeb.prototype.setLocalePath=function(e,t){h.setLocalePath(e,t,!0)};var p="1.6.2-2 (6/28/2019 9:59 AM)";function setLicenseKey(e){r.b._isString(e,!0),r.b._setLicense(e)}function checkLicense(e,t,n=!1){if(r.b._isString(e,!0),r.b._isFunction(t,!0),r.b._optionalArgCheck(n,r.b._isBoolean),r.b._checkLicense(n))t(!0);else{var i=new XMLHttpRequest;i.open("POST",e),i.onload=function(){if(i.response&&i.response.length>0){r.b._setLicense(i.response);var e=r.b._checkLicense(n);t(e)}}.bind(this),i.onerror=function(){l("ERROR: failed to contact license server: ",e),t(!1)},i.send("")}}Object.defineProperties(PLMVisWeb.prototype,{LOCALE:{enumerable:!0,get:function(){return locale}},Locales:{enumerable:!0,value:i.a},path:{enumerable:!1,get:function(){return u}},isSilent:{enumerable:!1,get:function(){return d}},StringTable:{enumerable:!1,get:function(){return h}}});/* harmony default export */var f=PLMVisWeb,m=n(2),g=o()("PLMVisWeb:debug:ExtendableObject"),v=function(){};
// EXTERNAL MODULE: ./staging/Enums.js
(v.prototype={constructor:v})._apply=function(e){g("_apply",e),e&&e.prototype&&(e.prototype.addExtension=v.prototype.addExtension,e.prototype.removeExtension=v.prototype.removeExtension,e.prototype.isExtensionLoaded=v.prototype.isExtensionLoaded,e.prototype.getExtensionManager=v.prototype.getExtensionManager)},v.prototype.addExtension=function(e,t){if(e)return this.isExtensionLoaded(e)||((t=t||{})._parent=this,this._extensions[e.prototype._name]=new e(t)),this.getExtensionManager(e)},v.prototype.removeExtension=function(e){e&&this.isExtensionLoaded(e)&&(this._extensions[e.prototype._name]._dispose&&this._extensions[e.prototype._name]._dispose(),delete this._extensions[e.prototype._name])},v.prototype.isExtensionLoaded=function(e){return e&&void 0!==this._extensions[e.prototype._name]},v.prototype.getExtensionManager=function(e){if(g("getExtensionManager",e),e)return this._extensions[e.prototype._name]},v.prototype._dispose=function(){if(this._extensions)for(var e=Object.keys(this._extensions),t=0,n=e.length;t<n;++t)this.removeExtension(this.getExtensionManager([e[t]]))};/* harmony default export */var y=v;
// CONCATENATED MODULE: ./FOSS/tween/Tween.js
/**@preserve
 * Tween.js - Licensed under the MIT license
 * https://github.com/sole/tween.js
 * ----------------------------------------------
 *
 * See https://github.com/sole/tween.js/graphs/contributors for the full list of contributors.
 * Thank you all, you're awesome!
 * 
 * Change log:
 * 2019-04-03 - Rob Hofford                                 Added default es6 export.
 * @copyright SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
 */
// Date.now shim for (ahem) Internet Explo(d|r)er
void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var b=b||function(){var e=[];return{REVISION:"14",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},update:function(t){if(0===e.length)return!1;var n=0;for(t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();n<e.length;)e[n].update(t)?n++:e.splice(n,1);return!0}}}();b.Tween=function(e){var t=e,n={},r={},i={},a=1e3,o=0,s=!1,l=!1,c=!1,u=0,h=null,d=b.Easing.Linear.None,p=b.Interpolation.Linear,f=[],m=null,g=!1,v=null,y=null,x=null;
// Set all starting values present on the target object
for(var _ in e)n[_]=parseFloat(e[_],10);this.to=function(e,t){return void 0!==t&&(a=t),r=e,this},this.start=function(e){for(var a in b.add(this),l=!0,g=!1,h=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),h+=u,r){
// check if an Array was provided as property value
if(r[a]instanceof Array){if(0===r[a].length)continue;
// create a local copy of the Array with the start value at the front
r[a]=[t[a]].concat(r[a])}n[a]=t[a],n[a]instanceof Array==!1&&(n[a]*=1),i[a]=n[a]||0}return this},this.stop=function(){return l?(b.remove(this),l=!1,null!==x&&x.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=f.length;e<t;e++)f[e].stop()},this.delay=function(e){return u=e,this},this.repeat=function(e){return o=e,this},this.yoyo=function(e){return s=e,this},this.easing=function(e){return d=e,this},this.interpolation=function(e){return p=e,this},this.chain=function(){return f=arguments,this},this.onStart=function(e){return m=e,this},this.onUpdate=function(e){return v=e,this},this.onComplete=function(e){return y=e,this},this.onStop=function(e){return x=e,this},this.update=function(e){var l;if(e<h)return!0;!1===g&&(null!==m&&m.call(t),g=!0);var b=(e-h)/a,x=d(b=b>1?1:b);for(l in r){var _=n[l]||0,w=r[l];w instanceof Array?t[l]=p(w,x):(
// Parses relative end values with start as base (e.g.: +10, -3)
"string"==typeof w&&(w=_+parseFloat(w,10)),
// protect against non numeric properties.
"number"==typeof w&&(t[l]=_+(w-_)*x))}if(null!==v&&v.call(t,x),1==b){if(o>0){
// reassign starting values, restart by making startTime = now
for(l in isFinite(o)&&o--,i){if("string"==typeof r[l]&&(i[l]=i[l]+parseFloat(r[l],10)),s){var M=i[l];i[l]=r[l],r[l]=M}n[l]=i[l]}return s&&(c=!c),h=e+u,!0}null!==y&&y.call(t);for(var E=0,S=f.length;E<S;E++)f[E].start(e);return!1}return!0}},b.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},InOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-b.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*b.Easing.Bounce.In(2*e):.5*b.Easing.Bounce.Out(2*e-1)+.5}}},b.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=b.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){var n,r=0,i=e.length-1,a=Math.pow,o=b.Interpolation.Utils.Bernstein;for(n=0;n<=i;n++)r+=a(1-t,i-n)*a(t,n)*e[n]*o(i,n);return r},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=b.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=b.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n,r=1;if(e[t])return e[t];for(n=t;n>1;n--)r*=n;return e[t]=r}}(),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),o=.5*(r-t),s=i*i;return(2*t-2*n+a+o)*(i*s)+(-3*t+3*n-2*a-o)*s+a*i+t}}};
/* harmony default export */var x=b,_=n(1),w=function(e,t){this.parent=e,this._userMaterialIndex=-1,this._originalMaterialIndex=t,this._selectedMaterialIndex=-1,this._selected=!1,this._highlighted=!1,this._start=-1,this._count=0};
// EXTERNAL MODULE: ./node_modules/three/build/three.module.js
Object.defineProperties(w.prototype,{materialIndex:{get:function(){return this._selectedMaterialIndex>=0?this._selectedMaterialIndex:this._userMaterialIndex>=0?this._userMaterialIndex:this._originalMaterialIndex},set:function(e){this._originalMaterialIndex=e}},start:{get:function(){return this._start},set:function(e){this._start=e,this.face&&(this.face.start=e)}},count:{get:function(){return this._count},set:function(e){this._count=e,this.face&&(this.face.count=e)}},selected:{get:function(){return this._selected},set:function(e){this._selected!==e&&(this._selected=e,this._highlighted=!1,this._selectedMaterialIndex=e?this.parent.selectionIndex:-1)}},highlighted:{get:function(){return this._highlighted},set:function(e){if(this._highlighted!==e){this._highlighted=e;var t=-1;this._selected&&(t=this.parent.selectionIndex),this._selectedMaterialIndex=e?this.parent.highlightingIndex:t}}}}),w.prototype.setUserMaterial=function(e){this._userMaterialIndex=e};/* harmony default export */var M=w,E=function(){_.InstancedBufferGeometry.call(this),this.selectionIndex=0,this.highlightingIndex=1,this.maxInstancedCount=0,this._instanceCount=0,this._instMatrixCol0Array=null,this._instMatrixCol1Array=null,this._instMatrixCol2Array=null,this._instMatrixCol3Array=null,this._lastInsertIndex=0,this.instances=[]};
// CONCATENATED MODULE: ./staging/CustomGeometries.js
(E.prototype=Object.create(_.InstancedBufferGeometry.prototype)).constructor=E,Object.defineProperties(E.prototype,{expectedInstanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this._instanceCount>0&&(this._instMatrixCol0Array=new Float32Array(4*e),this._instMatrixCol1Array=new Float32Array(4*e),this._instMatrixCol2Array=new Float32Array(4*e),this._instMatrixCol3Array=new Float32Array(4*e),this.initMaterialBuffers(e)))}}});var S=function(e,t,n,r){var i=n*r;if(i<t&&(t-=r)-i>0){var a=t,o=i;if(e.copyWithin)e.copyWithin(o,a,a+r-1);else for(var s=0;s<r;s++)e[o++]=e[a++]}return t};E.prototype.updateGeometryAttribute=function(e,t,n){var r=this.attributes[t];r?(r.array=e,r.needsUpdate=!0):(r=new _.InstancedBufferAttribute(e,n),this.addAttribute(t,r))},E.prototype.updateTransformBuffer=function(e,t){this.maxInstancedCount>0?this.updateGeometryAttribute(e,t,4):delete this.attributes[t]},E.prototype.addTransformAttribute=function(e){for(var t=e.matrixWorld.elements,n=0,r=t.length/4;n<r;n++)this._instMatrixCol0Array[this._lastInsertIndex]=t[n],this._instMatrixCol1Array[this._lastInsertIndex]=t[n+4],this._instMatrixCol2Array[this._lastInsertIndex]=t[n+8],this._instMatrixCol3Array[this._lastInsertIndex]=t[n+12],this._lastInsertIndex++;this.updateTransformBuffer(this._instMatrixCol0Array,"instanceModelMatrixColumn0"),this.updateTransformBuffer(this._instMatrixCol1Array,"instanceModelMatrixColumn1"),this.updateTransformBuffer(this._instMatrixCol2Array,"instanceModelMatrixColumn2"),this.updateTransformBuffer(this._instMatrixCol3Array,"instanceModelMatrixColumn3")},E.prototype.removeTransformAttribute=function(e,t){S(this._instMatrixCol0Array,this._lastInsertIndex,t,4),S(this._instMatrixCol1Array,this._lastInsertIndex,t,4),S(this._instMatrixCol2Array,this._lastInsertIndex,t,4);var n=S(this._instMatrixCol3Array,this._lastInsertIndex,t,4);n!==this._lastInsertIndex&&(this._lastInsertIndex=n,this.updateTransformBuffer(this._instMatrixCol0Array,"instanceModelMatrixColumn0"),this.updateTransformBuffer(this._instMatrixCol1Array,"instanceModelMatrixColumn1"),this.updateTransformBuffer(this._instMatrixCol2Array,"instanceModelMatrixColumn2"),this.updateTransformBuffer(this._instMatrixCol3Array,"instanceModelMatrixColumn3"))},E.prototype.updateTransform=function(e){if(0!==this.expectedInstanceCount){var t=e.index;if(t<0&&(t=this.instances.indexOf(e)),this._instMatrixCol0Array&&t>=0){var n=4*t,r=e.matrixWorld.elements;this._instMatrixCol0Array[n]=r[0],this._instMatrixCol0Array[n+1]=r[1],this._instMatrixCol0Array[n+2]=r[2],this._instMatrixCol0Array[n+3]=r[3],this._instMatrixCol1Array[n]=r[4],this._instMatrixCol1Array[n+1]=r[5],this._instMatrixCol1Array[n+2]=r[6],this._instMatrixCol1Array[n+3]=r[7],this._instMatrixCol2Array[n]=r[8],this._instMatrixCol2Array[n+1]=r[9],this._instMatrixCol2Array[n+2]=r[10],this._instMatrixCol2Array[n+3]=r[11],this._instMatrixCol3Array[n]=r[12],this._instMatrixCol3Array[n+1]=r[13],this._instMatrixCol3Array[n+2]=r[14],this._instMatrixCol3Array[n+3]=r[15],this.attributes.instanceModelMatrixColumn0.needsUpdate=!0,this.attributes.instanceModelMatrixColumn1.needsUpdate=!0,this.attributes.instanceModelMatrixColumn2.needsUpdate=!0,this.attributes.instanceModelMatrixColumn3.needsUpdate=!0}}},E.prototype.removeGroupAttributes=function(e){if(e.attributes)for(var t in e.attributes)e.attributes[t]&&(delete e.attributes[t],delete this.attributes[t])},E.prototype.updateGroupAttribute=function(e,t,n,r){var i=this.attributes[n];i?(i.array=t,i.needsUpdate=!0):(i=new _.InstancedBufferAttribute(t,r),this.addAttribute(n,i)),e.attributes[n]=i},E.prototype.updateMaterialBuffers=function(e){this.maxInstancedCount>0?this.updateGroupAttributes(e):this.removeGroupAttributes(e)};var L=function(e,t,n){return e[t++]=n.r,e[t++]=n.g,e[t++]=n.b,t};E.prototype.updateGroup=function(e){if(0===this.expectedInstanceCount)return!1;var t=!1,n=e.index;if(n>=0&&this.instances&&this.instances.length>0){for(var r=0,i=0,a=this.instances.length;i<a;i++){var o=this.instances[i].groups[n];"InstancedLineBufferGeometry"===this.type||"InstancedPointsBufferGeometry"===this.type?o.visible||o.selected||o.highlights?(this.setMaterialBuffer(o.material,r),r++,t=t||!0):(L(this._diffuseArray,3*r,{r:-1,b:-1,g:-1}),r++,t=t||!0):(this.setMaterialBuffer(o.material,r),r++,t=t||!0)}t&&this.updateMaterialBuffers(e)}return t},E.prototype.addInstance=function(e){if(this.expectedInstanceCount>0){this.maxInstancedCount++;var t=this.instances.length;e.index=t,this.addTransformAttribute(e,t),this.instances.push(e),this.owner.visible=this.instances.length>0}},E.prototype.removeInstance=function(e){if(this.expectedInstanceCount>0){var t=e.index;if(t>=0){if(this.maxInstancedCount--,this.removeTransformAttribute(e,t),t<=this.instances.length-1){var n=this.instances[this.instances.length-1];n.index=t,this.instances[t]=n}this.instances.length-=1,this.owner.visible=this.instances.length>0}e.index=-1}},E.prototype.copy=function(e){void 0!==e.xtBodies&&(this.xtBodies=e.xtBodies),void 0!==e.isLines&&(this.isLines=e.isLines),void 0!==e.selectionIndex&&(this.selectionIndex=e.selectionIndex),void 0!==e.highlightingIndex&&(this.highlightingIndex=e.highlightingIndex),r.b._isNumber(e.drawMode)&&(this.drawMode=e.drawMode);var t=e.index;null!==t&&this.setIndex(t.clone());var n=e.attributes;for(var i in n){if(n[i])var a=n[i];r.b._isFunction(a.clone)&&this.addAttribute(i,a.clone())}for(var o=e.groups,s=0,l=o.length;s<l;s++){var c=o[s],u=this.addGroup(c.start,c.count,c.materialIndex);void 0!==c.face&&(u.face=c.face),void 0!==c.edgeId&&(u.edgeId=c.edgeId)}return this},E.prototype.addGroup=function(e,t,n){var r=new M(this,n);return r.start=e,r.count=t,r.index=this.groups.length,r.attributes={},this.groups.push(r),r},E.prototype.setMaterialBuffer=function(e,t,n){},E.prototype.updateGroupAttributes=function(e){},E.prototype.initMaterialBuffers=function(e){},E.prototype.rebuildDrawGroups=function(){if(r.b._isNullOrUndefined(this.unmodifiedGroups)&&(this.unmodifiedGroups=this.groups.slice(0,this.groups.length)),this.groups.length=0,r.b._notNullOrUndefined(this.instances)&&this.instances.length>0){for(var e,t,n,i,a,o,s,l=0,c=0,u=0,h=this.unmodifiedGroups.length;u<h;u++){e=this.unmodifiedGroups[u],o=!1,s=!0;for(var d=0,p=this.instances.length;d<p;d++)n=this.instances[d].groups[u],o=o||n.visible||n.selected||n.highlighted,u-1>=0&&(i=this.instances[d].groups[u-1],s=s&&o&&n.materialIndex===i.materialIndex);s?(l+=e.count,u+1===h&&this.groups.push({start:c,count:l,materialIndex:e.materialIndex,index:e.index,attributes:{}})):a&&o?(this.groups.push({start:c,count:l,materialIndex:t.materialIndex,index:t.index,attributes:{}}),c=e.start,l=e.count,u+1===h&&this.groups.push({start:c,count:l,materialIndex:e.materialIndex,index:e.index,attributes:{}})):a&&!o?(this.groups.push({start:c,count:l,materialIndex:t.materialIndex,index:t.index,attributes:{}}),l=0):!a&&o&&(c=e.start,l=e.count,u+1===h&&this.groups.push({start:c,count:l,materialIndex:e.materialIndex,index:e.index,attributes:{}})),t=e,a=o}this.owner.needsUpdate=!1}};var T=function(){_.BufferGeometry.call(this),this.selectionIndex=0,this.highlightingIndex=1};(T.prototype=Object.create(_.BufferGeometry.prototype)).constructor=T,T.prototype.clone=function(){return(new T).copy(this)},T.prototype.addGroup=function(e,t,n){var r=new M(this,n);r.start=e,r.count=t,r.index=this.groups.length,this.groups.push(r)};var A=function(){E.call(this),this._diffuseArray=null,this._emissiveArray=null,this._specularArray=null,this._shininessArray=null,this._opacityArray=null,this._useMapArray=null,this._hasEnvMapArray=null,this.type="InstancedMeshBufferGeometry",this.drawMode=_.TrianglesDrawMode};A.prototype=Object.create(E.prototype),A.constructor=A,A.prototype.clone=function(){return(new A).copy(this)},A.prototype.initMaterialBuffers=function(e){this._diffuseArray=new Float32Array(3*e),this._emissiveArray=new Float32Array(3*e),this._specularArray=new Float32Array(3*e),this._shininessArray=new Float32Array(1*e),this._opacityArray=new Float32Array(1*e),this._useMapArray=new Uint16Array(1*e),this._hasEnvMapArray=new Uint16Array(1*e)},A.prototype.setMaterialBuffer=function(e,t){L(this._diffuseArray,3*t,e.uniforms.diffuse?e.uniforms.diffuse.value:new _.Color(0,0,0)),L(this._emissiveArray,3*t,e.uniforms.emissive?e.uniforms.emissive.value:new _.Color(0,0,0)),L(this._specularArray,3*t,e.uniforms.specular?e.uniforms.specular.value:new _.Color(0,0,0)),this._shininessArray[t]=e.uniforms.shininess?e.uniforms.shininess.value:30,this._opacityArray[t]=e.uniforms.opacity?e.uniforms.opacity.value:1,this._useMapArray[t]=e.useMap?1:0,this._hasEnvMapArray[t]=e.hasEnvMap?1:0},A.prototype.updateGroupAttributes=function(e){this.updateGroupAttribute(e,this._diffuseArray,"aDiffuse",3),this.updateGroupAttribute(e,this._emissiveArray,"aEmissive",3),this.updateGroupAttribute(e,this._specularArray,"aSpecular",3),this.updateGroupAttribute(e,this._shininessArray,"aShininess",1),this.updateGroupAttribute(e,this._opacityArray,"aOpacity",1),this.updateGroupAttribute(e,this._useMapArray,"aUseMap",1),this.updateGroupAttribute(e,this._hasEnvMapArray,"aHasEnvMap",1)};var C=function(){E.call(this),this._diffuseArray=null,this.type="InstancedLineBufferGeometry"};C.prototype=Object.create(E.prototype),C.constructor=C,C.prototype.clone=function(){return(new C).copy(this)},C.prototype.initMaterialBuffers=function(e){this._diffuseArray=new Float32Array(3*e)},C.prototype.setMaterialBuffer=function(e,t){L(this._diffuseArray,3*t,e.uniforms.diffuse.value)},C.prototype.updateGroupAttributes=function(e){this.updateGroupAttribute(e,this._diffuseArray,"aColor",3)};var P=function(){E.call(this),this._diffuseArray=null,this.type="InstancedPointsBufferGeometry"};P.prototype=Object.create(E.prototype),P.constructor=P,P.prototype.clone=function(){return(new P).copy(this)},P.prototype.initMaterialBuffers=function(e){this._diffuseArray=new Float32Array(3*e)},P.prototype.setMaterialBuffer=function(e,t){L(this._diffuseArray,3*t,e.uniforms.diffuse.value)},P.prototype.updateGroupAttributes=function(e){this.updateGroupAttribute(e,this._diffuseArray,"aColor",3)};var I=function(){E.call(this),this._vertexColorArray=null,this._overrideColorArray=null,this.type="InstancedVertexColorBufferGeometry"};I.prototype=Object.create(E.prototype),I.constructor=I,I.prototype.clone=function(){return(new I).copy(this)},I.prototype.initMaterialBuffers=function(e){this._vertexColorArray=new Float32Array(3*e),this._overrideColorArray=new Uint16Array(1*e)},I.prototype.setMaterialBuffer=function(e,t){L(this._vertexColorArray,3*t,e.uniforms.vertexColor.value),this._overrideColorArray[t]=e.uniforms.overrideColor.value},I.prototype.updateGroupAttributes=function(e){this.updateGroupAttribute(e,this._vertexColorArray,"vertexColor",3),this.updateGroupAttribute(e,this._overrideColorArray,"overrideColor",1)};
// CONCATENATED MODULE: ./staging/SceneGraphNode.js
var O=function(){};O.prototype={constructor:O,apply:function(e){e.getObjectByXtId=O.prototype.getObjectByXtId,e.getScene=O.prototype.getScene,e.getUnit=O.prototype.getUnit,e.getPartOwner=O.prototype.getPartOwner,e.raycastOverride=O.prototype.raycastOverride,e.validateRaycast=O.prototype.validateRaycast},getScene:function(){if(!this._scene)for(var e=this;null!==e;){if(e.isScene){this._scene=e;break}e=e.parent}return this._scene},getObjectByXtId:function(e){if(this.faces){var t=this.faces[e];if(r.b._notNullOrUndefined(t))return t}if(this.edges){var n=this.edges[e];if(r.b._notNullOrUndefined(n))return n}if(this.points){var i=this.points[e];if(r.b._notNullOrUndefined(i))return i}if(this.vertices){if(this.vertices.id.toString()===e)return vertexShape;var a=e.indexOf("|");if(-1!==a){var o=e.substring(0,a),s=e.substring(a+1);if(this.vertices.id.toString()===o)var l=this.vertices.vertices[s];if(l)return l}}if(this.sectionEdges)for(var c,u=0;u<this.sectionEdges.length;u++)if((c=(c=this.sectionEdges[u].userData.psId).substring(c.lastIndexOf("|")+1))===e)return this.sectionEdges[u];if(this.children)for(u=0;u<this.children.length;u++){var h=this.children[u];if(h.psId.toString()===e)return h;var d=h.getObjectByXtId(e);if(r.b._notNullOrUndefined(d))return d}return null},getUnit:function(){for(var e=this;e&&"Part"!==e.type&&"Body"!==e.type;)e=e.parent;return e?e.unit:Units.UNKNOWN},getPartOwner:function(){for(var e=this;e;){if("Part"===e.type)return e;e=e.parent}return null},validateRaycast:function(e,t,n){return!0},raycastOverride:function(e,t,n){this.validateRaycast(e,t,n)&&this.raycast(e,n)}};/* harmony default export */var B=O;
// CONCATENATED MODULE: ./staging/Container.js
function _initMap(){this.psIdToObjectMap||(this.psIdToObjectMap={})}var R=function(e){_.Object3D.call(this),this.type="Container",this.name=e,this.visibilityState=m.D.None};(R.prototype=Object.create(_.Object3D.prototype)).constructor=R,B.prototype.apply(R.prototype),R.prototype.addPsIdToObjectMap=function(e,t){_initMap.call(this),this.psIdToObjectMap[e]=t},R.prototype.removePsIdToObjectMap=function(e){_initMap.call(this),this.psIdToObjectMap.hasOwnProperty(e)&&delete this.psIdToObjectMap[e]},R.prototype.inPsIdToObjectMap=function(e){return _initMap.call(this),this.psIdToObjectMap.hasOwnProperty(e)},R.prototype.clearPsIdToObjectMap=function(){this.psIdToObjectMap={}},R.prototype.getObjectByPsId=function(e,t){var n=r.b._parsePsId(e);if(n&&null!=n.psId&&void 0!==n.psId){var i=void 0;return _initMap.call(this),(i=this.psIdToObjectMap.hasOwnProperty(n.psId)?this.psIdToObjectMap[n.psId]:function getObjectByPsIdInternal(e,t,n){if(n=void 0===n||n,null!==e.userData&&void 0!==e.userData&&e.userData.psId===t)return e;if(e.children)for(var r=0,i=e.children.length;r<i;r++){var a=e.children[r];if(null!==a.userData&&void 0!==a.userData){if(a.userData.psId===t)return a;if(!0===n&&a.children&&a.children.length>0&&(a=getObjectByPsIdInternal(a,t,n)))return a}}}(this,n.psId,t))?n.xtId&&i.getObjectByXtId?i.getObjectByXtId(n.xtId):i:void 0}},R.prototype.add=function(e){_.Object3D.prototype.add.call(this,e),this.dispatchEvent({type:"childAdded",object:e})},R.prototype.remove=function(e){_.Object3D.prototype.remove.call(this,e),this.dispatchEvent({type:"childRemoved",object:e})};/* harmony default export */var G=R,D=function(e,t){this.parent=e,this.original=t,this._userMaterialIndex=-1,this._originalMaterialIndex=-1,this._selected=!1,this._highlighted=!1,this._selectedMaterialIndex=-1};
// CONCATENATED MODULE: ./staging/GroupInstance.js
Object.defineProperties(D.prototype,{selected:{get:function(){return this._selected},set:function(e){this._selected!==e&&(this._selected=e,this._selectedMaterialIndex=e?this.parent.selectionIndex:-1)}},highlighted:{get:function(){return this._highlighted},set:function(e){if(this._highlighted!==e){this._highlighted=e;var t=-1;this._selected&&(t=this.parent.selectionIndex),this._selectedMaterialIndex=e?this.parent.highlightingIndex:t}}},material:{get:function(){if(Array.isArray(this._material)){var e=this.original.materialIndex;return this._selectedMaterialIndex>=0?e=this._selectedMaterialIndex:this._userMaterialIndex>=0?e=this._userMaterialIndex:this.parent._userMaterialIndex>=0?e=this.parent._userMaterialIndex:this._originalMaterialIndex>=0&&(e=this._originalMaterialIndex),this._material[e]}return this._material}},_geometry:{get:function(){return this.parent.geometry}},_material:{get:function(){return this.parent.material}}});/* harmony default export */var V=D,N=function(e,t,n){V.call(this,e,t),this.parent=e,this.index=n,this.userData={},this.userData.psId=this.getPartOwner().userData.psId+"|"+t.edgeId,this.id=(new _.Object3D).id,this._visible=!1,this._originalMaterialIndex=t._originalMaterialIndex};
// CONCATENATED MODULE: ./staging/Edge.js
(N.prototype=Object.create(V.prototype)).constructor=N,B.prototype.apply(N.prototype),Object.defineProperties(N.prototype,{type:{value:"Edge"},selected:{get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._selectedMaterialIndex=e?this.parent.selectionIndex:-1,this.parent.original.needsUpdate=!0)}},highlighted:{get:function(){return this._highlighted},set:function(e){e!==this._highlighted&&(this._highlighted=e,this._selected?this._selectedMaterialIndex=e?this.parent.highlightingIndex:this.parent.selectionIndex:this._selectedMaterialIndex=e?this.parent.highlightingIndex:-1,this.parent.original.needsUpdate=!0)}},visible:{get:function(){return this._visible},set:function(e){e!==this.visible&&(this._visible=e,this.parent.original.needsUpdate=!0)}},edge:{get:function(){return{start:this.original.start,count:this.original.count,materialIndex:this.materialIndex,index:this.original.index,edgeId:this.original.edgeId,attributes:{}}}},boundingBox:{get:function(){return this._box||(this._box=new _.Box3,this._box.setFromArray(this.position)),this._box}},boundingSphere:{get:function(){return this._sphere||(this._sphere=new _.Sphere,this.boundingBox.getBoundingSphere(this._sphere)),this._sphere}},materialIndex:{get:function(){return this._highlighted?this._geometry.highlightingIndex:this._selected?this._geometry.selectionIndex:this._userMaterialIndex<0?this._originalMaterialIndex:this._userMaterialIndex}},position:{get:function(){return this.parent.geometry.attributes.position.array.subarray(3*this.original.start,3*(this.original.start+this.original.count))},set:function(e){e.length>3*this.original.count?e.constructor===Float32Array?this.parent.geometry.attributes.position.array.set(e.subarray(0,3*this.original.count),3*this.original.start):e.constructor===Array&&this.parent.geometry.attributes.position.array.set(e.slice(0,3*this.original.count),3*this.original.start):this.parent.geometry.attributes.position.array.set(e,3*this.original.start),this.parent.geometry.attributes.position.needsUpdate=!0}},geometry:{get:function(){return this.parent.geometry}},matrix:{get:function(){return this.parent.matrix}},matrixWorld:{get:function(){return this.parent.matrixWorld}},normal:{get:function(){return this.parent.geometry.attributes.normal.array.subarray(3*this.original.start,3*(this.original.start+this.original.count))},set:function(e){e.length>3*this.original.count?e.constructor===Float32Array?this.parent.geometry.attributes.normal.array.set(e.subarray(0,3*this.original.count),3*this.original.start):e.constructor===Array&&this.parent.geometry.attributes.normal.array.set(e.slice(0,3*this.original.count),3*this.original.start):this.parent.geometry.attributes.normal.array.set(e,3*this.original.start),this.parent.geometry.attributes.normal.needsUpdate=!0}},vertices:{get:function(){var e=[];return this.original.edgeId&&this.original.edgeId in this.parent.parent.edgeVertexMap&&this.parent.parent.edgeVertexMap[this.original.edgeId].forEach(function(t){e.push(this.parent.parent.vertices.vertices[t])}.bind(this)),e}},faces:{get:function(){var e=[];return this.parent.parent.xtBody&&this.parent.parent.xtBody&&this.parent.parent.xtBody.manifoldEdgeMap&&this.parent.parent.xtBody.manifoldEdgeMap[this.original.edgeId]&&(-1!==this.parent.parent.xtBody.manifoldEdgeMap[this.original.edgeId].f1&&e.push(this.parent.parent.faces[this.parent.parent.xtBody.manifoldEdgeMap[this.original.edgeId].f1]),-1!==this.parent.parent.xtBody.manifoldEdgeMap[this.original.edgeId].f2&&e.push(this.parent.parent.faces[this.parent.parent.xtBody.manifoldEdgeMap[this.original.edgeId].f2])),e}},bodies:{get:function(){return"Body"===this.parent.parent.type?this.parent.parent:null}}}),N.prototype.getDescription=function(){return this.original.description},N.prototype.setDescription=function(e){this.original.description=e},N.prototype.getUserMaterial=function(){var e=this.material,t={},n=this.materialIndex;return t.diffuse=e[n].uniforms.diffuse.value.getHex(),t},N.prototype.setUserMaterial=function(e){var t=this.parent.material;this.parent.material.userMatIdxMap||(this.parent.material.userMatIdxMap={});var n=this.parent.material.userMatIdxMap,r=this.id;-1===e.uniforms.emissive&&(e.uniforms.emissive=t[this._originalMaterialIndex].uniforms.emissive),-1===e.uniforms.diffuse&&(e.uniforms.diffuse=t[this._originalMaterialIndex].uniforms.diffuse),-1===e.uniforms.specular&&(e.uniforms.specular=t[this._originalMaterialIndex].uniforms.specular),-1===e.uniforms.shininess&&(e.uniforms.shininess=t[this._originalMaterialIndex].uniforms.shininess),-1===e.uniforms.opacity&&(e.uniforms.opacity=t[this._originalMaterialIndex].uniforms.opacity?t[this._originalMaterialIndex].uniforms.opacity:1,e.opacity=e.uniforms.opacity.value),e.opacity<1&&(t[this._originalMaterialIndex].transparent=!0),n[r]?t[n[r]]=e:(t.push(e),n[r]=t.length-1),t[n[r]].needsUpdate=!0,this._userMaterialIndex=n[r],this.parent.original.needsUpdate=!0},N.prototype.resetUserMaterial=function(){var e=this.parent.material,t=this.parent.material.userMatIdxMap,n=this.id;this._userMaterialIndex=-1,t&&t[n]&&(delete e[t[n]],delete t[n]),this.parent.original.needsUpdate=!0};/* harmony default export */var U=N,F=function(){var e=new _.Sphere,t=new _.Ray,n=new _.Matrix4,i=new _.Vector3,a=new _.Vector3,o=new _.Vector3,s=new _.Vector3,l=new _.Vector3,c=new _.Quaternion,u=new _.Vector3;return function(h,d){var p=this.geometry,f=this.matrixWorld;f.decompose(l,c,u);var m=h.linePrecision,g=m/((u.x+u.y+u.z)/3),v=g*g;n.getInverse(f),t.copy(h.ray).applyMatrix4(n);var y=(this&&this.isLineSegments)instanceof _.LineSegments?2:1;if("LineShape"===this.type){if(r.b._isNullOrUndefined(this.boundingSphere)&&(this.boundingSphere=new _.Sphere,this.boundingBox.getBoundingSphere(this.boundingSphere)),e.copy(this.boundingSphere),e.applyMatrix4(f),e.radius+=m,!1===h.ray.intersectsSphere(e))return null;if(p instanceof _.BufferGeometry)for(var b=0,x=(S=p.attributes.position.array).length/3-1;b<x;b+=y){if(i.fromArray(S,3*b),a.fromArray(S,3*b+3),!(t.distanceSqToSegment(i,a,s,o)>v))if(s.applyMatrix4(this.matrixWorld),!((L=h.ray.origin.distanceTo(s))<h.near||L>h.far)){var w=new _.Vector3;h.ray.at(L,w),d.push({distance:L,point:w,modelPoint:o.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else for(var M in this.edges)if(this.edges[M]){var E=this.edges[M];if(r.b._isNullOrUndefined(E.boundingSphere)&&(E.boundingSphere=new _.Sphere,E.boundingBox.getBoundingSphere(E.boundingSphere)),e.copy(E.boundingSphere),e.applyMatrix4(f),e.radius+=m,!1!==h.ray.intersectsSphere(e)&&p instanceof _.BufferGeometry){var S;for(b=0,x=(S=E.position).length/3-1;b<x;b+=y){var L;if(i.fromArray(S,3*b),a.fromArray(S,3*b+3),!(t.distanceSqToSegment(i,a,s,o)>v))if(s.applyMatrix4(this.matrixWorld),!((L=h.ray.origin.distanceTo(s))<h.near||L>h.far)){w=new _.Vector3;h.ray.at(L,w),d.push({distance:L,point:w,modelPoint:o.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:E})}}}}}}(),z=function(e,t){if(this.id=(new _.Object3D).id,this.parent=e,this.original=t,this.userMaterial=null,this.groups=[],this.index=-1,this._userMaterialIndex=-1,t.frustumCulled=!1,this.frustumCulled=!0,t.geometry.unmodifiedGroups||(t.geometry.unmodifiedGroups=t.geometry.groups.slice(0,t.geometry.groups.length)),"InstancedPointsBufferGeometry"!==t.geometry.type||"InstancedLineBufferGeometry"!==t.geometry.type||"InstancedMeshBufferGeometry"!==t.geometry.type)for(var n=0,r=t.geometry.unmodifiedGroups.length;n<r;n++){var i=new V(this,t.geometry.unmodifiedGroups[n],n);this.groups.push(i)}this._selected=!1,this._highlighted=!1,this._visible=!1,this._cullingLayer=e.cullingLayer};
// CONCATENATED MODULE: ./staging/LineRaycast.js
Object.defineProperties(z.prototype,{type:{value:"ShapeInstance"},boundingBox:{get:function(){return this.geometry.boundingBox||this.geometry.computeBoundingBox(),this.geometry.boundingBox}},selected:{get:function(){return this._selected},set:function(e){if(this._selected!==e){this._selected=e,this._highlighted=!1;for(var t=0,n=this.groups.length;t<n;t++)this.groups[t].selected=e}}},highlighted:{get:function(){return this._highlighted},set:function(e){if(this._highlighted!==e){this._highlighted=e;for(var t=0,n=this.groups.length;t<n;t++)this.groups[t].highlighted=e}}},visible:{get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,e?this.original.geometry.addInstance(this):this.original.geometry.removeInstance(this))},configurable:!0},cullingLayer:{get:function(){return this._cullingLayer},set:function(e){this._cullingLayer!==e&&(this._cullingLayer=e)}},layers:{get:function(){return this.original.layers}},scale:{get:function(){return this.parent.scale}},normalMatrix:{get:function(){return this.parent.normalMatrix.getNormalMatrix(this.parent.matrixWorld)}},matrix:{get:function(){return this.parent.matrix},set:function(){if(this.parent){var e=arguments;Array.isArray(e[0])?this.parent.matrix.setFromArray(e[0]):e[0].isMatrix4?this.parent.matrix.copy(e[0]):16===e.length&&Object.keys(e).reduce(function(t,n){return isNaN(parseInt(n))||(t=t&&Number.isInteger(e[n])),t},!0)&&this.parent.matrix.set(...e)}}},matrixWorld:{get:function(){return this.parent.matrixWorld},set:function(){if(this.parent){var e=arguments;Array.isArray(e[0])?this.parent.matrixWorld.setFromArray(e[0]):e[0].isMatrix4?this.parent.matrixWorld.copy(e[0]):16===e.length&&Object.keys(e).reduce(function(t,n){return isNaN(parseInt(n))||(t=t&&Number.isInteger(e[n])),t},!0)&&this.parent.matrixWorld.set(...e)}}},expectedInstanceCount:{get:function(){return this.geometry.expectedInstanceCount}},selectionIndex:{get:function(){return this.geometry.selectionIndex}},highlightingIndex:{get:function(){return this.geometry.highlightingIndex}},geometry:{get:function(){return this.original.geometry}},material:{get:function(){return this.original.material}}}),z.prototype.addGroup=function(e,t){if(t){var n=this.material.indexOf(t);if(n<0){n=this.material.length,this.material.push(t);var r=("InstancedMeshBufferGeometry"===this.geometry.type||"InstancedLineBufferGeometry"===this.geometry.type||"InstancedVertexColorBufferGeometry"===this.geometry.type)&&this.geometry.expectedInstanceCount>0;t.isInstanced=r}e.materialIndex=n}else e.materialIndex=this.material.length-1;var i=new V(this,e,e.index);return i.isNew=!0,this.groups.push(i),i},z.prototype.getUnit=function(){return this.parent.getUnit()},z.prototype.getScene=function(){return this.parent.getScene()},z.prototype.updateCulling=function(e){this.visible&&(!e&&(this._cullingLayer<=m.e.visibleAndLoaded||void 0===this._cullingLayer)?this.index<0&&(this.expectedInstanceCount>0?this.geometry.addInstance(this):this.original.visible=!0):this.index>=0&&(this.expectedInstanceCount>0?this.geometry.removeInstance(this):this.original.visible=!1))},z.prototype.updateMatrixWorld=function(){"InstancedPointsBufferGeometry"!==this.geometry.type&&"InstancedMeshBufferGeometry"!==this.geometry.type&&"InstancedLineBufferGeometry"!==this.geometry.type&&"InstancedVertexColorBufferGeometry"!==this.geometry.type||this.geometry.updateTransform(this)},z.prototype.setOverwriteMaterial=function(e){var t,n,r,i,a=this.material,o=[];this.material.userMatIdxMap||(this.material.userMatIdxMap={});for(var s=this.material.userMatIdxMap,l=0,c=this.groups.length;l<c;l++){if(-1===o.indexOf(this.groups[l].original._originalMaterialIndex)){i=this.groups[l].original._originalMaterialIndex,o.push(i);var u=e.clone();-1===e.uniforms.emissive&&(u.uniforms.emissive=a[i].uniforms.emissive),-1===e.uniforms.diffuse&&(u.uniforms.diffuse=a[i].uniforms.diffuse),-1===e.uniforms.specular&&(u.uniforms.specular=a[i].uniforms.specular),-1===e.uniforms.shininess&&(u.uniforms.shininess=a[i].uniforms.shininess),-1===e.uniforms.opacity&&(u.uniforms.opacity=a[i].uniforms.opacity,u.opacity=u.uniforms.opacity.value,u.transparent=u.opacity<1),a.push(u)}if(t=this.groups[l],r=(n=this.groups[l].original)._originalMaterialIndex,u.opacity<1)for(var h=0,d=a.length;h<d;h++)a[h]&&(a[h].transparent=!0);u.envMap&&!a[n._originalMaterialIndex].envMap&&(a[n._originalMaterialIndex].envMap=u.envMap,a[n._originalMaterialIndex].uniforms.envMap.value=u.uniforms.envMap.value,a[n._originalMaterialIndex].needsUpdate=!0),n._userMaterialIndex=-1,t._userMaterialIndex=-1,n._originalMaterialIndex=a.length-1,t._originalMaterialIndex=a.length-1,s[r]&&(s[a.length-1]=s[r],delete s[r])}this.original.needsUpdate=!0},z.prototype.getUserMaterial=function(){var e=[];if(this.groups){for(var t,n=this.material,r=new Set,i=0;i<this.groups.length;i++)t=-1===this.groups[i]._userMaterialIndex?this.groups[i]._originalMaterialIndex:this.groups[i]._userMaterialIndex,r.add(t);for(var a of r){var o={};o.diffuse=n[a].uniforms.diffuse.value.getHex(),o.emissive=n[a].uniforms.emissive.value.getHex(),o.specular=n[a].uniforms.specular.value.getHex(),o.shininess=n[a].uniforms.shininess.value,o.opacity=n[a].uniforms.opacity.value,e.push(o)}}return e},z.prototype.setUserMaterial=function(e){if(this.groups){var t=this.material;this.material.userMatIdxMap||(this.material.userMatIdxMap={});for(var n,r,i,a,o=this.material.userMatIdxMap,s=[],l=0,c=this.groups.length;l<c;l++){if(r=this.faces[l],n=this.groups[l],i=this.id,-1===s.indexOf(this.groups[l].original._originalMaterialIndex)){a=this.groups[l].original._originalMaterialIndex,s.push(a);var u=e.clone();-1===e.uniforms.emissive&&(u.uniforms.emissive=t[a].uniforms.emissive),-1===e.uniforms.diffuse&&(u.uniforms.diffuse=t[a].uniforms.diffuse),-1===e.uniforms.specular&&(u.uniforms.specular=t[a].uniforms.specular),-1===e.uniforms.shininess&&(u.uniforms.shininess=t[a].uniforms.shininess),-1===e.uniforms.opacity&&(u.uniforms.opacity=t[a].uniforms.opacity,u.opacity=u.uniforms.opacity.value,u.transparent=u.opacity<1)}else u=t[o[i]];if(u.opacity<1)for(var h=0,d=t.length;h<d;h++)t[h]&&(t[h].transparent=!0);u.envMap&&!t[n._originalMaterialIndex].envMap&&(t[n._originalMaterialIndex].envMap=u.envMap,t[n._originalMaterialIndex].uniforms.envMap.value=u.uniforms.envMap.value,t[n._originalMaterialIndex].needsUpdate=!0),o[i]?t[o[i]]=u:(t.push(u),o[i]=t.length-1),n._userMaterialIndex=o[i],r._userMaterialIndex=o[i],r.face&&(r.face.materialIndex=o[i]),t[o[i]].needsUpdate=!0,this.original.needsUpdate=!0}}},z.prototype.resetUserMaterial=function(){for(var e,t,n=this.material,r=0,i=this.groups.length;r<i;r++)t=this.faces[r],e=this.groups[r],n[this.groups[r].original.materialIndex].needsUpdate,t.face&&(t.face.materialIndex=t._originalMaterialIndex),-1!==e._userMaterialIndex&&(e._userMaterialIndex=-1,t._userMaterialIndex=-1),this.original.needsUpdate=!0};/* harmony default export */var k=z,j=function(e,t){k.call(this,e,t);for(var n=0;n<this.groups.length;n++)this.groups[n].visible=!1};
// CONCATENATED MODULE: ./staging/LineShape.js
(j.prototype=Object.create(k.prototype)).constructor=j,B.prototype.apply(j.prototype),Object.defineProperties(j.prototype,{type:{value:"LineShape"},visible:{get:function(){return this._visible},set:function(e){if(e!==this._visible){this._visible=e;for(var t=0;t<this.groups.length;t++)this.groups[t].visible=e;this.original.visible=e}}}}),j.prototype.raycast=F;/* harmony default export */var H=j,W=function(e,t,n){H.call(this,e,t),null!==n&&void 0!==n||(n={edgeId:(new _.Object3D).id}),this.edge=n,this.userData={},this.userData.psId=e.userData.psId+"|"+n.edgeId};
// CONCATENATED MODULE: ./staging/EdgeShapeBase.js
(W.prototype=Object.create(H.prototype)).constructor=W,Object.defineProperties(W.prototype,{type:{value:"EdgeShapeBase"},descriptionLoaded:{get:function(){return this.edge.descriptionLoaded},set:function(e){this.edge.descriptionLoaded=e}}}),W.prototype.getDescription=function(){return this.edge.description},W.prototype.setDescription=function(e){this.edge.description=e},W.prototype.validateRaycast=function(e,t){return(t.pickingMode&m.x.EDGE)===m.x.EDGE};/* harmony default export */var X=W,q=function(e,t,n){X.call(this,e,t,n),this.drawGroups=t.geometry.groups,this.edges=[],e.edges||(e.edges={});for(var r=0,i=t.geometry.unmodifiedGroups.length;r<i;r++)this.edges.push(new U(this,t.geometry.unmodifiedGroups[r],r)),e.edges[t.geometry.unmodifiedGroups[r].edgeId]=this.edges[r];this.groups=this.edges,t.visible=!0};
// CONCATENATED MODULE: ./staging/EdgeShape.js
(q.prototype=Object.create(X.prototype)).constructor=q,B.prototype.apply(X.prototype),Object.defineProperties(q.prototype,{type:{value:"EdgeShape"},visible:{get:function(){for(var e in this.edges)if(this.edges[e].visible||this.edges[e].selected||this.edges[e].highlighted)return!0;return!1},set:function(e){for(var t in this.edges)this.edges[t]&&(this.edges[t].visible=e)}}}),q.prototype.resetDrawGroups=function(){this.drawGroups.length=0},q.prototype.raycast=F;/* harmony default export */var Y=q,Z=function(e,t){k.call(this,e,t)};
// CONCATENATED MODULE: ./staging/OutlineShape.js
(Z.prototype=Object.create(k.prototype)).constructor=Z,Object.defineProperties(Z.prototype,{type:{value:"OutlineShape"}});/* harmony default export */var J=Z,Q=function(e,t,n){V.call(this,e,t),this.parent=e,this.index=n,this.userData={},t.face?(this.userData.psId=this.getPartOwner().userData.psId+"|"+t.face.faceId,r.b._notNullOrUndefined(t.face.groupIdx)&&(r.b._isNullOrUndefined(t.face.groupIndex)&&(t.face.groupIndex=t.face.groupIdx),delete t.face.groupIdx)):(t.face={},this.userData.psId=this.getPartOwner().userData.psId+"|"+n),this.id=(new _.Object3D).id,this._visible=!0,this._originalMaterialIndex=t._originalMaterialIndex};
// CONCATENATED MODULE: ./staging/FaceShape.js
(Q.prototype=Object.create(V.prototype)).constructor=Q,B.prototype.apply(Q.prototype),Object.defineProperties(Q.prototype,{type:{value:"FaceShape"},selected:{get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._selectedMaterialIndex=e?this.parent.selectionIndex:-1,this.parent.original.needsUpdate=!0)}},highlighted:{get:function(){return this._highlighted},set:function(e){e!==this._highlighted&&(this._highlighted=e,this._selected?this._selectedMaterialIndex=e?this.parent.highlightingIndex:this.parent.selectionIndex:this._selectedMaterialIndex=e?this.parent.highlightingIndex:-1,this.parent.original.needsUpdate=!0)}},visible:{get:function(){return this._visible},set:function(e){e!==this.visible&&(this._visible=e,this.parent.original.needsUpdate=!0)}},face:{get:function(){return this.original.face&&!r.b._isObjectEmpty(this.original.face)?{start:this.original.face.start,count:this.original.face.count,materialIndex:this.materialIndex,index:this.original.face.groupIndex,faceId:this.original.face.faceId,bodyId:this.original.face.bodyId,attributes:{}}:{start:this.original.start,count:this.original.count,materialIndex:this.materialIndex,index:this.index,faceId:this.index,bodyId:null,attributes:{}}}},boundingBox:{get:function(){var e=this.original.face.boundingBox;if(!e){e=new _.Box3;var t=this.geometry.attributes.position.array,n=this.geometry.index.array;if(t.length>0){for(var r=1/0,i=1/0,a=1/0,o=-1/0,s=-1/0,l=-1/0,c=this.start,u=this.start+this.count;c<u;c+=1){var h=3*n[c],d=t[h],p=t[h+1],f=t[h+2];d<r&&(r=d),p<i&&(i=p),f<a&&(a=f),d>o&&(o=d),p>s&&(s=p),f>l&&(l=f)}e.min.set(r,i,a),e.max.set(o,s,l)}this.original.face.boundingBox=e}return e}},boundingSphere:{get:function(){var e=this.original.face.boundingSphere;return e||(e=new _.Sphere,this.boundingBox.getBoundingSphere(e),this.original.face.boundingSphere=e),e}},materialIndex:{get:function(){return this._highlighted?this._geometry.highlightingIndex:this._selected?this._geometry.selectionIndex:this._userMaterialIndex<0?this._originalMaterialIndex:this._userMaterialIndex}},start:{get:function(){return this.original.start}},count:{get:function(){return this.original.count}},geometry:{get:function(){return this.parent.geometry}},matrix:{get:function(){return this.parent.matrix},set:function(){if(this.parent){var e=arguments;Array.isArray(e[0])?this.parent.matrix.setFromArray(e[0]):e[0].isMatrix4?this.parent.matrix.copy(e[0]):16===e.length&&Object.keys(e).reduce(function(t,n){return isNaN(parseInt(n))||(t=t&&Number.isInteger(e[n])),t},!0)&&this.parent.matrix.set(...e)}}},matrixWorld:{get:function(){return this.parent.matrixWorld},set:function(){if(this.parent){var e=arguments;Array.isArray(e[0])?this.parent.matrixWorld.setFromArray(e[0]):e[0].isMatrix4?this.parent.matrixWorld.copy(e[0]):16===e.length&&Object.keys(e).reduce(function(t,n){return isNaN(parseInt(n))||(t=t&&Number.isInteger(e[n])),t},!0)&&this.parent.matrixWorld.set(...e)}}},scale:{get:function(){return this.parent.scale}},descriptionLoaded:{get:function(){return this.original.face.descriptionLoaded},set:function(e){this.original.face.descriptionLoaded=e}},normal:{get:function(){var e=this.original.face.normal;if(!e){e=new _.Vector3;var t=this.geometry.attributes.normal.array,n=this.geometry.index.array;if(t.length>0){for(var r=this.start,i=this.start+this.count;r<i;r+=1){var a=3*n[r],o=t[a],s=t[a+1],l=t[a+2];e.x+=o,e.y+=s,e.z+=l}var c=3/this.count;e.x*=c,e.y*=c,e.z*=c,e.normalize()}this.original.face.normal=e}return e}},diffuseColor:{get:function(){var e=this.original.face.__diffuseColor;if(void 0===e){if("InstancedVertexColorBufferGeometry"===this.geometry.type){var t=this.geometry.attributes.color.array;e=new _.Color(t[0],t[1],t[2])}else{var n=this.material;if(n){var r=n.uniforms.diffuse;r&&(e=r.value)}}this.original.face.__diffuseColor=e}return e}},vertices:{get:function(){var e=[],t=this.edges;if(t)for(var n=0;n<t.length;n++)if(t[n].edge.edgeId in this.parent.parent.edgeVertexMap)for(var r=this.parent.parent.edgeVertexMap[t[n].edge.edgeId],i=0;i<r.length;i++)-1===e.indexOf(this.parent.parent.vertices.vertices[r[i]])&&e.push(this.parent.parent.vertices.vertices[r[i]]);return e}},edges:{get:function(){var e=[];if(this.parent.parent.xtBody&&this.parent.parent.edgesLoaded)for(var t in this.parent.parent.xtBody.manifoldEdgeMap)if(this.parent.parent.xtBody.manifoldEdgeMap[t]){var n=this.parent.parent.xtBody.manifoldEdgeMap[t];n.f1!==this.face.faceId&&n.f2!==this.face.faceId||e.push(this.parent.parent.edges[t])}return e}},bodies:{get:function(){return"Body"===this.parent.parent.type?this.parent.parent:null}}}),Q.prototype.getUnit=function(){return this.parent.parent.getUnit()},Q.prototype.getDescription=function(){if(this.original.face)return this.original.face.description},Q.prototype.setDescription=function(e){this.original.face||(this.original.face={}),this.original.face.description=e},Q.prototype.getUserMaterial=function(){var e=this.parent.material,t={},n=this.materialIndex;return t.diffuse=e[n].uniforms.diffuse.value.getHex(),t.emissive=e[n].uniforms.emissive.value.getHex(),t.specular=e[n].uniforms.specular.value.getHex(),t.shininess=e[n].uniforms.shininess.value,t.opacity=e[n].uniforms.opacity.value,t},Q.prototype.setUserMaterial=function(e){var t=this.parent.material;this.parent.material.userMatIdxMap||(this.parent.material.userMatIdxMap={});var n=this.parent.material.userMatIdxMap,r=this.id;-1===e.uniforms.emissive&&(e.uniforms.emissive=t[this._originalMaterialIndex].uniforms.emissive),-1===e.uniforms.diffuse&&(e.uniforms.diffuse=t[this._originalMaterialIndex].uniforms.diffuse),-1===e.uniforms.specular&&(e.uniforms.specular=t[this._originalMaterialIndex].uniforms.specular),-1===e.uniforms.shininess&&(e.uniforms.shininess=t[this._originalMaterialIndex].uniforms.shininess),-1===e.uniforms.opacity&&(e.uniforms.opacity=t[this._originalMaterialIndex].uniforms.opacity,e.opacity=e.uniforms.opacity.value),e.opacity<1&&(t[this._originalMaterialIndex].transparent=!0),n[r]?t[n[r]]=e:(t.push(e),n[r]=t.length-1),this._userMaterialIndex=n[r],t[n[r]].needsUpdate=!0,this.parent.original.needsUpdate=!0},Q.prototype.setOverwriteMaterial=function(e){var t=this.parent.material;-1===e.uniforms.emissive&&(e.uniforms.emissive=t[this._originalMaterialIndex].uniforms.emissive),-1===e.uniforms.diffuse&&(e.uniforms.diffuse=t[this._originalMaterialIndex].uniforms.diffuse),-1===e.uniforms.specular&&(e.uniforms.specular=t[this._originalMaterialIndex].uniforms.specular),-1===e.uniforms.shininess&&(e.uniforms.shininess=t[this._originalMaterialIndex].uniforms.shininess),-1===e.uniforms.opacity&&(e.uniforms.opacity=t[this._originalMaterialIndex].uniforms.opacity),e.opacity<1&&(t[this._originalMaterialIndex].transparent=!0),t.push(e),this._originalMaterialIndex=t.length-1,t[this._originalMaterialIndex].needsUpdate=!0,this.parent.original.needsUpdate=!0},Q.prototype.resetUserMaterial=function(){var e=this.parent.material;this._userMaterialIndex=-1;var t=this.parent.material.userMatIdxMap,n=this.id;t&&t[n]&&(delete e[t[n]],delete t[n]),this.parent.original.needsUpdate=!0};/* harmony default export */var K=Q,$=function(){var e=new _.Matrix4,t=new _.Ray,n=new _.Sphere,r=new _.Vector3,i=new _.Vector3,a=new _.Vector3,o=new _.Vector2,s=new _.Vector2,l=new _.Vector2,c=new _.Vector3,u=new _.Vector3;function checkBufferGeometryIntersection(e,t,n,h,d,p,f,m,g){r.fromBufferAttribute(d,f),i.fromBufferAttribute(d,m),a.fromBufferAttribute(d,g);var v=function checkIntersection(e,t,n,r,i,a,o,s){if(null===(t.side===_.BackSide?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==_.DoubleSide,s))){if("PmiSurface"!==e.type)return null;var l=new _.Vector3,c=r.distanceSqToSegment(i,a,l);s.copy(l);var h=r.distanceSqToSegment(a,o,l);if(c>h&&(c=h,s.copy(l)),c>(h=r.distanceSqToSegment(o,i,l))&&(c=h,s.copy(l)),c>n.linePrecision*n.linePrecision)return null}u.copy(s),u.applyMatrix4(e.matrixWorld);var d=n.ray.origin.distanceTo(u);return d<n.precision||d<n.near||d>n.far?null:{distance:d,point:u.clone(),object:e}}(e,t,n,h,r,i,a,c);if(v){p&&(o.fromBufferAttribute(p,f),s.fromBufferAttribute(p,m),l.fromBufferAttribute(p,g),v.uv=_.Triangle.getUV(c,r,i,a,o,s,l,new _.Vector2));var y=new _.Face3(f,m,g);_.Triangle.getNormal(r,i,a,y.normal),v.face=y}return v}return function raycast(r,i){var a,o=this.geometry,s=this.material,l=this.matrixWorld;if(void 0!==s&&(null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(l),!1!==r.ray.intersectsSphere(n)&&(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),(null===o.boundingBox||!1!==t.intersectsBox(o.boundingBox))&&o.isBufferGeometry))){var c,u,h,d,p,f,m,g,v=o.attributes.index,y=o.attributes.position,b=o.attributes.uv,x=o.groups,_=o.drawRange;if(null!==v&&void 0!==v)if(Array.isArray(s))for(T=0,p=x.length;T<p;T++)for(g=s[(m=x[T]).materialIndex],d=Math.max(m.start,_.start),f=Math.min(m.start+m.count,_.start+_.count);d<f;d+=3)c=v.getX(d),u=v.getX(d+1),h=v.getX(d+2),(a=checkBufferGeometryIntersection(this,g,r,t,y,b,c,u,h))&&(a.faceIndex=Math.floor(d/3),i.push(a));else for(T=Math.max(0,_.start),p=Math.min(v.count,_.start+_.count);T<p;T+=3)c=v.getX(T),u=v.getX(T+1),h=v.getX(T+2),(a=checkBufferGeometryIntersection(this,s,r,t,y,b,c,u,h))&&(a.faceIndex=Math.floor(T/3),i.push(a));else if(this.faces&&this.faces.length>0)for(var w=this.faces,M=o.index.array,E=0,S=w.length;E<S;E++){var L=w[E];if((null===L.boundingSphere||(n.copy(L.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==r.ray.intersectsSphere(n)))&&(null===L.boundingBox||!1!==t.intersectsBox(L.boundingBox)))for(var T=L.start,A=L.start+L.count;T<A;T+=3)c=M[T],u=M[T+1],h=M[T+2],(a=checkBufferGeometryIntersection(this,L.material,r,t,y,b,c,u,h))&&(a.faceIndex=null,a.xtFace=L,a.xtBody=L.face&&void 0!==L.face.bodyId?this.parent:null,i.push(a))}else if(void 0!==y)if(Array.isArray(s))for(T=0,p=x.length;T<p;T++)for(g=s[(m=x[T]).materialIndex],d=Math.max(m.start,_.start),f=Math.min(m.start+m.count,_.start+_.count);d<f;d+=3)(a=checkBufferGeometryIntersection(this,g,r,t,y,b,c=d,u=d+1,h=d+2))&&(a.faceIndex=Math.floor(d/3),i.push(a));else for(T=Math.max(0,_.start),p=Math.min(y.count,_.start+_.count);T<p;T+=3)(a=checkBufferGeometryIntersection(this,s,r,t,y,b,c=T,u=T+1,h=T+2))&&(a.faceIndex=Math.floor(T/3),i.push(a))}}}(),ee=function(e,t){k.call(this,e,t),this.drawGroups=t.geometry.groups,this.faces=[],e.faces||(e.faces={});for(var n=0,i=t.geometry.unmodifiedGroups.length;n<i;n++)this.faces.push(new K(this,t.geometry.unmodifiedGroups[n],n)),t.geometry.unmodifiedGroups[n].face&&(e.faces[t.geometry.unmodifiedGroups[n].face.faceId]=this.faces[n]);this.groups=this.faces,r.b._notNullOrUndefined(t.geometry.xtBodies)&&"Body"===e.type&&r.b._isNullOrUndefined(e.xtBody)&&(e.xtBody=t.geometry.xtBodies[0],e.parent.bodies||(e.parent.bodies={}),e.parent.bodies[t.geometry.xtBodies[0].bodyId]=t.geometry.xtBodies[0])};
// CONCATENATED MODULE: ./staging/MeshRaycast.js
(ee.prototype=Object.create(k.prototype)).constructor=ee,B.prototype.apply(ee.prototype),Object.defineProperties(ee.prototype,{type:{value:"PartShape"}}),ee.prototype.resetDrawGroups=function(){this.drawGroups.length=0},ee.prototype.addFace=function(e,t){var n=this.addGroup(e,t),r=new K(n,this);return this.faces.push(r),r.face&&(this.parent.faces[r.face.faceId]=r),r},ee.prototype.validateRaycast=function(e,t){var n=t.pickingMode;return(n&m.x.FREE)===m.x.FREE||(n&m.x.PART)===m.x.PART||(n&m.x.FACE)===m.x.FACE||(n&m.x.PMI)===m.x.PMI},ee.prototype.raycast=$;/* harmony default export */var te=ee,ne=function(e,t){k.call(this,e,t),this.visible=!1,this._matrix=new _.Matrix4};
// CONCATENATED MODULE: ./staging/pmi/PmiShapeInstance.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
(ne.prototype=Object.create(k.prototype)).constructor=ne,B.prototype.apply(ne.prototype),Object.defineProperties(ne.prototype,{type:{value:"PmiShapeInstance"},visible:{get:function(){return this._visible},set:function(e){if(e!==this._visible){this._visible=e;for(var t=0;t<this.groups.length;t++)this.groups[t].visible=e;this.original.geometry.addInstance&&(e?this.original.geometry.addInstance(this):this.original.geometry.removeInstance(this))}}},matrix:{get:function(){return this._matrix},set:function(e){e instanceof _.Matrix4&&(this._matrix=e)}},matrixWorld:{get:function(){return(new _.Matrix4).multiplyMatrices(this.parent.matrixWorld,this.matrix)},set:function(){
// do nothing
}}}),ne.prototype.raycast=function(e,t){this.original instanceof _.Mesh?$.call(this,e,t):F.call(this,e,t)}
/* harmony default export */;var re=ne;
// CONCATENATED MODULE: ./staging/pmi/PmiObjectInstance.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
function PmiObjectInstance(e){_.Object3D.call(this),this.type="PmiObjectInstance",this.visibilityState=m.D.None,this._visible=!1,this.original=e,this._selected=!1,this._highlighted=!1,e.instances.push(this),e.expectedInstanceCount++,this._shapes=[],e.shapes&&e.shapes.forEach(e=>this.addShape(new re(this,e)))}PmiObjectInstance.prototype=Object.create(_.Object3D.prototype),PmiObjectInstance.prototype.constructor=PmiObjectInstance,Object.defineProperties(PmiObjectInstance.prototype,{isLoaded:{enumerable:!0,get:function(){if(this.original)return this.original.isLoaded},set:function(e){this.original.isLoaded!==e&&(this.original.isLoaded=e)}},isLoading:{enumerable:!0,get:function(){if(this.original)return this.original.isLoading},set:function(e){this.original.isLoading!==e&&(this.original.isLoading=e)}},visible:{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._shapes&&this._shapes.forEach(t=>{t.visible=e}))}},shapes:{get:function(){return this._shapes}},matrixWorld:{get:function(){return this.pmiGroup.part.matrixWorld.clone().multiply(this.original.matrix)},set:function(){
// do nothing
}}}),PmiObjectInstance.prototype.addShape=function(e){this._shapes.push(e),e.owner=this},PmiObjectInstance.prototype.removeShape=function(e){var t=this._shapes.indexOf(e);t>=0&&this._shapes.splice(t,1),this.remove(e),e.owner=null},PmiObjectInstance.prototype.dispose=function(){
// Swap with last instance in orginal to maintain instance indices
var e=this.original.instances;if(e){var t=e.indexOf(this);t>-1&&e.splice(t,1)}
// Remove last element from the original
this.original.expectedInstanceCount--,this.original=null,
// Delete null properties
delete this.original},PmiObjectInstance.prototype.clone=function(e,t){return e=e?new PmiObjectInstance(e.original).copy(e,t):new PmiObjectInstance(this.original).copy(this,t)};
/* harmony default export */var ie=PmiObjectInstance;
// CONCATENATED MODULE: ./staging/pmi/PmiObjects.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
function PmiObjects(e){this._part=e,this._children=[]}Object.defineProperties(PmiObjects.prototype,{part:{get:function(){return this._part}},children:{get:function(){return this._children}}}),PmiObjects.prototype.add=function(e){e.pmiGroup=this,this._children.push(e)},PmiObjects.prototype.remove=function(e){var t=this._children;if(t){var n=t.indexOf(e);n>-1&&(t.splice(n,1),e.dispose(),e.pmiGroup=null)}},PmiObjects.prototype.getObjectByPsId=function(e){for(var t=this.children,n=0,r=t.length;n<r;++n){var i=t[n];if(i.userData.psId===e)return i}return null},PmiObjects.prototype.addPmiObject=function(e){
//original pmi, create pmi or dimension based on the type
var t=new ie(e);return t.userData.psId=this._part.userData.psId+":"+e.userData.psId,t.psId=e.userData.psId,this.add(t),t};var ae=function(e){
// remove pmi shape instance
var t=[];e.shapes.forEach(e=>{t.push(e)});for(var n=0;n<t.length;++n)e.removeShape(t[n]);return t};PmiObjects.prototype.removePmiObject=function(e){e?(ae(e),this.remove(e)):this._children.forEach(e=>{ae(e),this.remove(e)})};
/* harmony default export */var oe=PmiObjects,se=function(){_.Object3D.call(this),this.type="ProductStructureObject",this.visibilityState=m.D.None,this.visible=!1,this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this._areEdgesVisible=!1,this._areVerticesVisible=!1,this._selected=!1,this._highlighted=!1,this._visible=!1};
// CONCATENATED MODULE: ./staging/ProductStructureObject.js
(se.prototype=Object.create(_.Object3D.prototype)).constructor=se,B.prototype.apply(se.prototype),Object.defineProperties(se.prototype,{isAssembly:{enumerable:!0,value:!1},areVerticesVisible:{get:function(){return this.visible&&this._areVerticesVisible},set:function(e){if(this._areVerticesVisible!==e){if(this._areVerticesVisible=e,this.vertices&&(this.vertices.visible=e),this.bodies)for(var t in this.bodies)this.bodies.hasOwnProperty(t)&&(this.bodies[t]._areVerticesVisible=!0);if(e)for(var n=this.parent;n instanceof se;)n._areVerticesVisible=!0,n=n.parent;else for(n=this.parent;n instanceof se;){for(var r=0;r<n.children.length;r++)if(!0===n.children[r]._areVerticesVisible)return;n._areVerticesVisible=!1,n=n.parent}}}},areEdgesVisible:{get:function(){return this.visible&&this._areEdgesVisible},set:function(e){if(this._areEdgesVisible!==e&&this.visible){if(this._areEdgesVisible=e,this.outlines)for(var t=0,n=this.outlines.length;t<n;t++)this.outlines[t].visible=e;if(this.edges)for(var r in this.edges)this.edges.hasOwnProperty(r)&&(this.edges[r].visible=e);if(this.bodies)for(var i in this.bodies)this.bodies.hasOwnProperty(i)&&(this.bodies[i]._areEdgesVisible=!0);if(e)for(var a=this.parent;a instanceof se;)a._areEdgesVisible=!0,a=a.parent;else for(a=this.parent;a instanceof se;){for(t=0;t<a.children.length;t++)if(!0===a.children[t]._areEdgesVisible)return;a._areEdgesVisible=!1,a=a.parent}}}},visible:{get:function(){return this._visible},set:function(e){if(this._visible!==e){if(this._visible=e,this.shapes)for(var t=0,n=this.shapes.length;t<n;t++){var r=this.shapes[t];"OutlineShape"===r.type||"EdgeShape"===r.type?r.visible=!!e&&this._areEdgesVisible:"VertexShape"===r.type?r.visible=!!e&&this._areVerticesVisible:r.visible=e}var i=this.getScene();i&&i.onVisibilityChanged(this)}}},selected:{get:function(){return this._selected},set:function(e){this._selected!==e&&(this._selected=e,this._highlighted=!1)}},highlighted:{get:function(){return this._highlighted},set:function(e){this._highlighted!==e&&(this._highlighted=e)}},renderOrder:{get:function(){if(this.shapes)return this.shapes[0].original.renderOrder},set:function(e){this.shapes&&(this.shapes[0].original.renderOrder=e)}},expectedInstanceCount:{get:function(){return 1}},hasBothSectionSide:{get:function(){var e=!1,t=this.getScene();return t&&(e=t.hasBothSectionSide),e}}}),se.prototype.updateMatrixWorld=function(e){var t=!0===this.matrixWorldNeedsUpdate||!0===e;if(_.Object3D.prototype.updateMatrixWorld.call(this,e),t&&this.shapes)for(var n=0,r=this.shapes.length;n<r;n++)this.shapes[n].updateMatrixWorld()},se.prototype.add=function(e){_.Object3D.prototype.add.call(this,e),e.updateMatrixWorld()},se.prototype.invalidateRaycast=function(e,t){var n=t.pickingMode;return n===m.x.FREE||n===m.x.PART||(n&m.x.FACE)===m.x.FACE||(n&m.x.EDGE)===m.x.EDGE},se.prototype.raycast=function(e){if(this.visible){if(this.boundingSphere){var t=new _.Sphere;if(t.copy(this.boundingSphere),t.applyMatrix4(this.matrixWorld),!1===e.ray.intersectsSphere(t))return!1}else if(this.boundingBox){var n=new _.Box3;if(n.copy(this.boundingBox),n.applyMatrix4(this.matrixWorld),!1===e.ray.intersectsBox(n))return!1}return!0}return!1};var le=function(e,t,n,r){if(n&&n instanceof se){t.userData.psId=r,e!==t&&(t.matrix=n.matrix.clone());var i=n.getScene();if(n.pmiObjects)for(var a=0,o=n.pmiObjects.length;a<o;a++){var s=n.pmiObjects[a],l=(r=e.userData.psId+"i"+s.userData.psId,s.clone());t.addPmiObject(l),i&&i.pmiTreeObject&&i.pmiTreeObject.addPsIdToObjectMap(r,l)}var c=0;for(o=n.children.length;c<o;c++){var u=n.children[c];r=e.userData.psId+"i"+u.userData.psId;(l=u.clone(void 0,!1)).visible=!1,t.add(l),i&&i.modelObject.addPsIdToObjectMap(r,l),le(e,l,u,r)}}};se.prototype.setOriginal=function(e,t){le(this,this,e,t)},se.prototype.addPmiObject=function(e){return this.pmiObjects||(this.pmiObjects=new oe(this)),this.pmiObjects.addPmiObject(e)},se.prototype.removePmiObject=function(e){this.pmiObjects&&this.pmiObjects.removePmiObject(e)},se.prototype.getPmiObjectByPsId=function(e){return this.pmiObjects?this.pmiObjects.getObjectByPsId(e):null};/* harmony default export */var ce=se,ue=function(e,t,n,r,i){X.call(this,e,t),this._edge=null,this._clippingPlane=r,this._face=n,this._edgeCreator=i,this.position=t.geometry.attributes.position.array};
// CONCATENATED MODULE: ./staging/SectionEdgeShape.js
(ue.prototype=Object.create(X.prototype)).constructor=ue,Object.defineProperties(ue.prototype,{type:{value:"SectionEdgeShape"},edge:{get:function(){if(null==this._edge&&this._edgeCreator){this._edge={};var e=this._face.getDescription();e&&(this._edge.description=this._edgeCreator(e,this._clippingPlane,this.geometry.attributes.position.array))}return this._edge},set:function(e){this._edge=e}}}),ue.prototype.validateRaycast=function(e,t){var n=this.getScene();return n||n.hasBothSectionSide?(t.pickingMode&m.x.FREE)===m.x.FREE||(t.pickingMode&m.x.PART)===m.x.PART:(t.pickingMode&m.x.EDGE)===m.x.EDGE};/* harmony default export */var he=ue,de=function(e,t){k.call(this,e,t)};
// CONCATENATED MODULE: ./staging/SectionCapShape.js
(de.prototype=Object.create(k.prototype)).constructor=de,Object.defineProperties(de.prototype,{type:{value:"SectionCapShape"}}),de.prototype.validateRaycast=function(e,t,n){var r=this.getScene();return r||r.hasBothSectionSide?(t.pickingMode&m.x.FREE)===m.x.FREE||(t.pickingMode&m.x.PART)===m.x.PART:(t.pickingMode&m.x.EDGE)===m.x.EDGE},de.prototype.raycastOverride=function(e,t,n){this.validateRaycast(e,t,n)&&this.raycast(e,n)},de.prototype.raycast=function(e,t){return!!this.visible};/* harmony default export */var pe=de,fe=function(e,t,n){V.call(this,e,t),this.parent=e,this.index=n,this.userData={},this.userData.psId=e.userData.psId+"|"+this.index,this.id=(new _.Object3D).id,this._visible=!1,this._originalMaterialIndex=t._originalMaterialIndex};
// CONCATENATED MODULE: ./staging/Vertex.js
(fe.prototype=Object.create(V.prototype)).constructor=fe,B.prototype.apply(fe.prototype),Object.defineProperties(fe.prototype,{type:{value:"Vertex"},selected:{get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._selectedMaterialIndex=e?this.parent.selectionIndex:-1,this.parent.original.needsUpdate=!0)}},highlighted:{get:function(){return this._highlighted},set:function(e){e!==this._highlighted&&(this._highlighted=e,this._selected?this._selectedMaterialIndex=e?this.parent.highlightingIndex:this.parent.selectionIndex:this._selectedMaterialIndex=e?this.parent.highlightingIndex:-1,this.parent.original.needsUpdate=!0)}},visible:{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parent.original.needsUpdate=!0)}},materialIndex:{get:function(){return this._selected?this._geometry.selectionIndex:this._highlighted?this._geometry.highlightingIndex:this._userMaterialIndex<0?this._originalMaterialIndex:this._userMaterialIndex}},position:{get:function(){return new _.Vector3(this._geometry.attributes.position.array[3*this.index],this._geometry.attributes.position.array[3*this.index+1],this._geometry.attributes.position.array[3*this.index+2])},set:function(){}}}),fe.prototype.getUserMaterial=function(){var e={};return e.diffuse=this.material.uniforms.diffuse.value.getHex(),e},fe.prototype.setUserMaterial=function(e){var t=this.parent.material;this.parent.material.userMatIdxMap||(this.parent.material.userMatIdxMap={});var n=this.parent.material.userMatIdxMap,r=this.id;-1===e.uniforms.emissive&&(e.uniforms.emissive=t[this._originalMaterialIndex].uniforms.emissive),-1===e.uniforms.diffuse&&(e.uniforms.diffuse=t[this._originalMaterialIndex].uniforms.diffuse),-1===e.uniforms.specular&&(e.uniforms.specular=t[this._originalMaterialIndex].uniforms.specular),-1===e.uniforms.shininess&&(e.uniforms.shininess=t[this._originalMaterialIndex].uniforms.shininess),-1===e.uniforms.opacity&&(e.uniforms.opacity=t[this._originalMaterialIndex].uniforms.opacity?t[this._originalMaterialIndex].uniforms.opacity:1,e.opacity=e.uniforms.opacity.value),e.opacity<1&&(t[this._originalMaterialIndex].transparent=!0),n[r]?t[n[r]]=e:(t.push(e),n[r]=t.length-1),t[n[r]].needsUpdate=!0,this._userMaterialIndex=n[r],this.parent.original.needsUpdate=!0},fe.prototype.resetUserMaterial=function(){var e=this.parent.material,t=this.parent.material.userMatIdxMap,n=this.id;this._userMaterialIndex=-1,t&&t[n]&&(delete e[t[n]],delete t[n]),this.parent.original.needsUpdate=!0};/* harmony default export */var me=fe,ge=function(){var e=new _.Matrix4,t=new _.Ray,n=new _.Sphere;return function raycast(i,a){var o=this,s=this.geometry,l=this.matrixWorld,c=i.params.Points.threshold;if(r.b._isNullOrUndefined(s.boundingSphere)&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(l),n.radius+=c,!1!==i.ray.intersectsSphere(n)){e.getInverse(l),t.copy(i.ray).applyMatrix4(e);var u=c/((this.scale.x+this.scale.y+this.scale.z)/3),h=u*u,d=new _.Vector3,p=new _.Vector3;if(s.isBufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var g=f.array,v=0,y=g.length;v<y;v++){var b=g[v];d.fromArray(m,3*b),testPoint(d,b)}else{v=0;for(var x=m.length/3;v<x;v++)d.fromArray(m,3*v),testPoint(d,v)}}else{var w=s.vertices;for(v=0,x=w.length;v<x;v++)testPoint(w[v],v)}}function testPoint(e,n){var r=t.distanceSqToPoint(e);if(r<h){t.closestPointToPoint(e,p),p.applyMatrix4(l);var s=i.ray.origin.distanceTo(p);if(s<i.near||s>i.far)return;a.push({distance:s,distanceToRay:Math.sqrt(r),point:p.clone(),index:n,face:null,object:o.vertices[n]})}}}}(),ve=function(e,t){k.call(this,e,t),this.drawGroups=t.geometry.groups,this.vertices=[],this.userData={},this.userData.psId=this.getPartOwner().userData.psId+"|"+this.id;for(var n=0,r=t.geometry.unmodifiedGroups.length;n<r;n++)this.vertices.push(new me(this,t.geometry.unmodifiedGroups[n],n));this.groups=this.vertices,this._selectedIndices=[],this._highlightedIndices=[],t.visible=!0};
// CONCATENATED MODULE: ./staging/PointsRaycast.js
(ve.prototype=Object.create(k.prototype)).constructor=ve,B.prototype.apply(ve.prototype),Object.defineProperties(ve.prototype,{type:{value:"VertexShape"},selectedIndices:{get:function(){return this._selectedIndices}},highlightedIndices:{get:function(){return this._highlightedIndices}},visible:{get:function(){if(r.b._notNullOrUndefined(this.vertices))for(var e=0,t=this.vertices.length;e<t;e++)if(this.vertices[e].visible||this.vertices[e].selected||this.vertices[e].highlighted)return!0;return!1},set:function(e){if(r.b._notNullOrUndefined(this.vertices))for(var t=0,n=this.vertices.length;t<n;t++)this.vertices[t].visible=e}}}),ve.prototype.resetDrawGroups=function(){this.drawGroups.length=0},ve.prototype.validateRaycast=function(e,t){return(t.pickingMode&m.x.VERTEX)===m.x.VERTEX},ve.prototype.raycast=ge;/* harmony default export */var ye=ve,be=o()("PLMVisWeb:error:");
// CONCATENATED MODULE: ./staging/Part.js
be.enabled=!0;var xe=function(e){ce.call(this),this.type="Part",this.original=e,this.instanceIndex=e.instances.length,this.cullingLayer=0,this.updateMatrixWorld(!0),e.instances.push(this),e.expectedInstanceCount++,this.userData={},Object.defineProperties(this.userData,{percentLoaded:{get:function(){if(be("Node.userData.percentLoaded is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.percentLoaded)return e.percentLoaded},set:function(t){be("Node.userData.percentLoaded is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.percentLoaded=t)}},baseRef:{get:function(){if(be("Node.userData.baseRef is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.baseRef)return e.baseRef},set:function(t){be("Node.userData.baseRef is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.baseRef=t)}},objectFileRef:{get:function(){if(be("Node.userData.objectFileRef is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.objectFileRef)return e.objectFileRef},set:function(t){be("Node.userData.objectFileRef is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.objectFileRef=t)}},objectFileLen:{get:function(){if(be("Node.userData.objectFileLen is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.objectFileLen)return e.objectFileLen},set:function(t){be("Node.userData.objectFileLen is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.objectFileLen=t)}},objectHasXT:{get:function(){if(be("Node.userData.objectHasXT is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.objectHasXT)return e.objectHasXT},set:function(t){be("Node.userData.objectHasXT is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.objectHasXT=t)}},xtFileRef:{get:function(){if(be("Node.userData.xtFileRef is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.xtFileRef)return e.xtFileRef},set:function(t){be("Node.userData.xtFileRef is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.xtFileRef=t)}},xtFileLen:{get:function(){if(be("Node.userData.xtFileLen is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.xtFileLen)return e.xtFileLen},set:function(t){be("Node.userData.xtFileLen is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.xtFileLen=t)}},b64data:{get:function(){if(be("Node.userData.b64data is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.b64data)return e.b64data},set:function(t){be("Node.userData.b64data is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.b64data=t)}},xtb64data:{get:function(){if(be("Node.userData.xtb64data is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&e.xtb64data)return e.xtb64data},set:function(t){be("Node.userData.xtb64data is deprecated and will be removed after the 1.6.0 release. Please set properties directly on the node."),e&&(e.xtb64data=t)}}})};(xe.prototype=Object.create(ce.prototype)).constructor=xe,Object.defineProperties(xe.prototype,{isAssembly:{enumerable:!0,value:!1},isInstance:{enumerable:!0,value:!1},shapesLoaded:{enumerable:!0,writable:!0,value:!1},isLoaded:{enumerable:!0,get:function(){if(this.original)return this.original.isLoaded},set:function(e){this.original.isLoaded!==e&&(this.original.isLoaded=e)}},isLoading:{enumerable:!0,get:function(){if(this.original)return this.original.isLoading},set:function(e){this.original.isLoading!==e&&(this.original.isLoading=e)}},edgesLoaded:{enumerable:!0,get:function(){if(this.original)return this.original.edgesLoaded},set:function(e){this.original.edgesLoaded!==e&&(this.original.edgesLoaded=e)}},edgeVertexMap:{enumerable:!0,get:function(){if(this.original)return this.original.edgeVertexMap},set:function(e){this.original.edgeVertexMap!==e&&(this.original.edgeVertexMap=e)}},doneLoadingCallbacks:{get:function(){if(this.original&&this.original.doneLoadingCallback)return this.original.doneLoadingCallback},set:function(e){this.original.doneLoadingCallback!==e&&(this.original.doneLoadingCallback=e)}},boundingBox:{enumerable:!0,get:function(){if(this.original)return this.original.boundingBox},set:function(e){this.original&&e.isBox3&&(this.original.boundingBox=e,e.getBoundingSphere(this.original.boundingSphere))}},boundingSphere:{enumerable:!0,get:function(){if(this.original)return this.original.boundingSphere}},name:{enumerable:!0,get:function(){if(this.original)return this.original.name},set:function(e){this.original&&r.b._isString(e)&&(this.original.name=e)}},unit:{enumerable:!0,get:function(){if(this.original)return this.original.unit},set:function(e){this.original&&Object.values(m.E).includes(e)&&(this.original.unit=e)}},instances:{enumerable:!0,get:function(){if(this.original)return this.original.instances}},cullingLayer:{get:function(){return this._cullingLayer},set:function(e){if(this._cullingLayer!==e){if(this.shapes)for(var t=0,n=this.shapes.length;t<n;t++)this.shapes[t].cullingLayer=e;if(this._cullingLayer=e,this.children)for(t=0,n=this.children.length;t<n;t++)this.children[t].cullingLayer=e}}},expectedInstanceCount:{get:function(){return this.original?this.original.expectedInstanceCount:0}},percentLoaded:{get:function(){if(this.original&&this.original.percentLoaded)return this.original.percentLoaded},set:function(e){this.original&&(this.original.percentLoaded=e)}},baseRef:{get:function(){if(this.original&&this.original.baseRef)return this.original.baseRef},set:function(e){this.original&&(this.original.baseRef=e)}},objectFileRef:{get:function(){if(this.original&&this.original.objectFileRef)return this.original.objectFileRef},set:function(e){this.original&&(this.original.objectFileRef=e)}},objectFileLen:{get:function(){if(this.original&&this.original.objectFileLen)return this.original.objectFileLen},set:function(e){this.original&&(this.original.objectFileLen=e)}},objectHasXT:{get:function(){if(this.original&&this.original.objectHasXT)return this.original.objectHasXT},set:function(e){this.original&&(this.original.objectHasXT=e)}},xtFileRef:{get:function(){if(this.original&&this.original.xtFileRef)return this.original.xtFileRef},set:function(e){this.original&&(this.original.xtFileRef=e)}},xtFileLen:{get:function(){if(this.original&&this.original.xtFileLen)return this.original.xtFileLen},set:function(e){this.original&&(this.original.xtFileLen=e)}},b64data:{get:function(){if(this.original&&this.original.b64data)return this.original.b64data},set:function(e){this.original&&(this.original.b64data=e)}},xtb64data:{get:function(){if(this.original&&this.original.xtb64data)return this.original.xtb64data},set:function(e){this.original&&(this.original.xtb64data=e)}}}),xe.prototype.dispose=function(){if(r.b._notNullOrUndefined(this.children))for(;this.children.length>0;)this.children[0].dispose();var e=this.getScene();if(e.unloadObject(this),e.modelObject.removePsIdToObjectMap(this.userData.psId),this.parent.remove(this),this.instanceIndex<=this.original.instances.length-1){var t=this.original.instances[this.original.instances.length-1];t.index=this.instanceIndex,this.original.instances[this.instanceIndex]=t}this.original.instances.length-=1,this.original.expectedInstanceCount--,0===this.original.instanceCount&&this.original.dispose(),this.original=null,delete this.original,delete this.parent},xe.prototype.addShape=function(e,t){var n=null;return n=e.geometry.isLines?new H(this,e):new te(this,e),this.shapes||(this.shapes=[]),this.shapes.push(n),n.visible=t,n.selected=this.selected,n},xe.prototype.addEdge=function(e,t,n){var r=new X(this,t,e);return r.visible=n,r.original.renderOrder=-1,this.shapes||(this.shapes=[]),r},xe.prototype.addEdgeFrame=function(e,t,n){var r=new Y(this,t,e);r.original.renderOrder=-1;var i=r.material;if(i)for(var a=0,o=i.length;a<o;++a)i[a]&&(i[a].transparent=!0);return this.shapes||(this.shapes=[]),this.shapes.push(r),r},xe.prototype.addOutline=function(e,t){var n=new J(this,e);return n.visible=t,n.original.renderOrder=-1,this.shapes||(this.shapes=[]),this.shapes.push(n),this.outlines||(this.outlines=[]),this.outlines.push(n),e.userData.ignoreRenderMode=!0,n},xe.prototype.addSectionEdge=function(e,t,n,r){var i=new he(this,t,e,n,r);return i.visible=!0,this.shapes||(this.shapes=[]),this.shapes.push(i),this.sectionEdges||(this.sectionEdges=[]),this.sectionEdges.push(i),i},xe.prototype.addSectionCap=function(e,t){var n=new pe(this,e,t);return n.visible=!0,this.shapes||(this.shapes=[]),this.shapes.push(n),this.sectionCaps||(this.sectionCaps=[]),this.sectionCaps.push(n),n},xe.prototype.addVertexShape=function(e,t){var n=new ye(this,e);return n.visible=t,this.vertices=n,this.shapes.push(n),n},xe.prototype.setOverwriteMaterial=function(e){if(this.shapes&&this.shapes.length>0)for(var t=0,n=this.shapes.length;t<n;t++){var r=this.shapes[t];r instanceof te&&r.setOverwriteMaterial(e)}},xe.prototype.getUserMaterial=function(){var e;if(this.shapes&&this.shapes.length>0)for(var t=0,n=this.shapes.length;t<n;t++){var r=this.shapes[t];r instanceof te&&(e=r.getUserMaterial())}return e},xe.prototype.setUserMaterial=function(e){if(this.shapes&&this.shapes.length>0)for(var t=0,n=this.shapes.length;t<n;t++){var r=this.shapes[t];r instanceof te&&r.setUserMaterial(e)}},xe.prototype.resetUserMaterial=function(){if(this.shapes&&this.shapes.length>0)for(var e=0,t=this.shapes.length;e<t;e++){var n=this.shapes[e];n instanceof te&&n.resetUserMaterial()}},xe.prototype.updateMatrixWorld=function(e){var t=!0===this.matrixWorldNeedsUpdate||!0===e;if(_.Object3D.prototype.updateMatrixWorld.call(this,e),t&&this.shapes)for(var n=0,r=this.shapes.length;n<r;n++)this.shapes[n].updateMatrixWorld()},xe.prototype.add=function(e){_.Object3D.prototype.add.call(this,e),e.updateMatrixWorld()},xe.prototype.invalidateRaycast=function(e,t){var n=t.pickingMode;return n===m.x.FREE||n===m.x.PART||(n&m.x.FACE)===m.x.FACE||(n&m.x.EDGE)===m.x.EDGE},xe.prototype.raycast=function(e){if(this.visible){if(this.boundingSphere){var t=new _.Sphere;if(t.copy(this.boundingSphere),t.applyMatrix4(this.matrixWorld),!1===e.ray.intersectsSphere(t))return!1}else if(this.boundingBox){var n=new _.Box3;if(n.copy(this.boundingBox),n.applyMatrix4(this.matrixWorld),!1===e.ray.intersectsBox(n))return!1}return!0}return!1},xe.prototype.clone=function(e,t){return e=e?new xe(e.original).copy(e,t):new xe(this.original).copy(this,t)};/* harmony default export */var _e=xe,we=function(e,t,n){ce.call(this),this.type="Assembly",this.name=e,this.unit=n,this.boundingBox=r.b._notNullOrUndefined(t)?t:new _.Box3};
// CONCATENATED MODULE: ./staging/Assembly.js
(we.prototype=Object.create(ce.prototype)).constructor=we,Object.defineProperties(we.prototype,{isAssembly:{enumerable:!0,value:!0},isInstance:{enumerable:!0,value:!1},isLoaded:{enumerable:!0,get:function(){for(var e=0,t=this.children.length;e<t;++e)if(!this.children[e].isLoaded)return!1;return!0}},shapesLoaded:{enumerable:!0,get:function(){for(var e=0,t=this.children.length;e<t;++e)if(!this.children[e].shapesLoaded)return!1;return!0}},edgesLoaded:{enumerable:!0,get:function(){for(var e=0,t=this.children.length;e<t;++e)if(!this.children[e].edgesLoaded)return!1;return!0}},boundingBox:{enumerable:!0,get:function(){if(r.b._notNullOrUndefined(this._boundingBox))return this._boundingBox},set:function(e){e.isBox3&&(this._boundingBox=e,r.b._isNullOrUndefined(this._boundingSphere)&&(this._boundingSphere=new _.Sphere),e.getBoundingSphere(this._boundingSphere))}},boundingSphere:{enumerable:!0,get:function(){if(r.b._isNullOrUndefined(this._boundingSphere)){if(!r.b._notNullOrUndefined(this._boundingBox))return;this._boundingSphere=new _.Sphere,this._boundingBox.getBoundingSphere(this._boundingSphere)}return this._boundingSphere}}}),we.prototype.dispose=function(){if(r.b._notNullOrUndefined(this.children))for(;this.children.length>0;)this.children[0].dispose();this.getScene().modelObject.removePsIdToObjectMap(this.userData.psId),this.parent.remove(this),delete this.parent},we.prototype.clone=function(e,t){return e=e?new we(e.name,e.bbox,e.unit).copy(e,t):new we(this.name,this.bbox,this.unit).copy(this,t)},we.prototype.setMaterial=function(e,t){for(var n=0,r=this.children.length;n<r;n++)this.children[n].setMaterial(e,t)};/* harmony default export */var Me=we,Ee=function(e,t,n,r){_.Points.call(this,n,r),this.type="PointShape",this.matrixWorld=e.matrixWorld,this.parent=e,this.userData={},this.userData.psId=this.getPartOwner().userData.psId+"|p"+t,e.points||(e.points={}),e.points["p"+t]=this};
// CONCATENATED MODULE: ./staging/PointShape.js
(Ee.prototype=Object.create(_.Points.prototype)).constructor=Ee,B.prototype.apply(Ee.prototype);/* harmony default export */var Se=Ee,Le=function(){};
// CONCATENATED MODULE: ./staging/pmi/PmiNode.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
B.prototype.apply(Le.prototype),Le.prototype.constructor=Le,Le.prototype.getUnit=function(){for(var e=this;e&&!(e instanceof PmiObject);)e=e.parent;if(e){for(var t=null,n=e.parent;null!=n;){if(void 0!==n.userData.psId){t=n.userData.psId.toString();break}n=n.parent}if(null!==t){var r=this.getScene();if(null!=r){var i=r.getObjectByPsId(t);if(i)return i.unit}}}return Units.UNKNOWN},Le.prototype.validateRaycast=function(e,t){return t.pickingMode===m.x.FREE||(t.pickingMode&m.x.PMI)===m.x.PMI;// NOSONAR
},Le.prototype.apply=function(e){e.isPmi=!0,e.getObjectByPsId=Le.prototype.getObjectByPsId,e.getScene=Le.prototype.getScene,e.getUnit=Le.prototype.getUnit,e.raycastOverride=Le.prototype.raycastOverride,e.validateRaycast=Le.prototype.validateRaycast};
/* harmony default export */var Te=Le,Ae=function(e,t){_.LineSegments.call(this,e,t),this.type="PmiLine",e.owner=this};
// CONCATENATED MODULE: ./staging/pmi/PmiLine.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
(Ae.prototype=Object.create(_.LineSegments.prototype)).constructor=Ae,Te.prototype.apply(Ae.prototype),Ae.prototype.clone=function(e){return void 0===e&&(e=new Ae(this.geometry,this.material)),_.LineSegments.prototype.clone.call(this,e),e};
/* harmony default export */var Ce=Ae,Pe=function(e,t,n){_.Points.call(this,e,t),this.type="PmiPoints",this.psIdMap=n,e.owner=this};
// CONCATENATED MODULE: ./staging/pmi/PmiPoint.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
Pe.prototype=Object.create(_.Points.prototype),Object.defineProperties(Pe.prototype,{isPoint:{writable:!1,enumerable:!0,value:!0}}),Pe.prototype.constructor=Pe,Te.prototype.apply(Pe.prototype),Pe.prototype.clone=function(e){return void 0===e&&(e=new Pe(this.geometry,this.material)),_.Points.prototype.clone.call(this,e),e},Pe.prototype.hasPsId=function(e){return this.psIdMap.indexOf(e)>-1},Pe.prototype.setVisibility=function(e,t){var n=this.psIdMap.indexOf(e);n>-1&&(this.geometry.attributes.visible.array[n]=t?1:0,this.geometry.attributes.visible.needsUpdate=!0)},Pe.prototype.setVisibilityAll=function(e){for(var t=0,n=this.geometry.attributes.visible.array.length;t<n;++t)this.geometry.attributes.visible.array[t]=e?1:0;this.geometry.attributes.visible.needsUpdate=!0},Pe.prototype.setSelection=function(e,t){var n=this.psIdMap.indexOf(e);n>-1&&(this.geometry.attributes.selected.array[n]=t?1:0,this.geometry.attributes.selected.needsUpdate=!0)},Pe.prototype.setSelectionAll=function(e){for(var t=0,n=this.geometry.attributes.selected.array.length;t<n;++t)this.geometry.attributes.selected.array[t]=e?1:0;this.geometry.attributes.selected.needsUpdate=!0};
/* harmony default export */var Ie=Pe,Oe=function(e,t){_.Object3D.call(this),this.type="PmiRefPlane",this.geometry=e,this._shapeMaterial=t,this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0),this.drawMode=_.TrianglesDrawMode,e.owner=this};
// CONCATENATED MODULE: ./staging/pmi/PmiRefPlane.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
(Oe.prototype=Object.create(_.Mesh.prototype)).constructor=Oe,Te.prototype.apply(Oe.prototype),Object.defineProperties(Oe.prototype,{material:{enumerable:!0,get:function(){return this._shapeMaterial},set:function(e){this._shapeMaterial=e}}}),Oe.prototype.raycast=$,Oe.prototype.clone=function(e,t){return e||(e=new Oe(this.geometry,this._shapeMaterial)),_.Object3D.prototype.clone.call(this,e,t),e};
/* harmony default export */var Be=Oe,Re=function(e,t){_.Object3D.call(this),this.type="PmiSurface",this.geometry=e,this._shapeMaterial=t,this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0),this.drawMode=_.TrianglesDrawMode,e.owner=this};
// CONCATENATED MODULE: ./staging/pmi/PmiSurface.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
(Re.prototype=Object.create(_.Mesh.prototype)).constructor=Re,Te.prototype.apply(Re.prototype),Object.defineProperties(Re.prototype,{material:{enumerable:!0,get:function(){return this._shapeMaterial},set:function(e){this._shapeMaterial=e}}}),Re.prototype.raycast=$,Re.prototype.clone=function(e,t){return e||(e=new Re(this.geometry,this._shapeMaterial)),_.Object3D.prototype.clone.call(this,e,t),e};
/* harmony default export */var Ge=Re,De=function(e,t){Ce.call(this,e,t,"Text"),this.type="PmiText",e.owner=this};
// CONCATENATED MODULE: ./staging/pmi/PmiText.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
(De.prototype=Object.create(Ce.prototype)).constructor=De,Te.prototype.apply(De.prototype),De.prototype.clone=function(e){return void 0===e&&(e=new De(this.geometry,this.material)),Ce.clone.call(this,e),e};
/* harmony default export */var Ve=De,Ne=function(){};
// CONCATENATED MODULE: ./staging/SceneGraph.js
Ne.prototype={constructor:Ne,apply:function(e){e.addEventListener=Ne.prototype.addEventListener,e.hasEventListener=Ne.prototype.hasEventListener,e.removeEventListener=Ne.prototype.removeEventListener,e.dispatchEvent=Ne.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(null!==e&&void 0!==e&&null!==e.type&&void 0!==e.type&&void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t)for(var n=t.length,r=0;r<n;r++){var i=t[r];i.call(i,e)}}}};var Ue=function(e){var t=new Uint16Array([0,1,2,0,2,3]),n=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),i=new _.BufferGeometry;i.setIndex(new _.BufferAttribute(t,1)),i.addAttribute("position",new _.BufferAttribute(n,3)),i.addAttribute("uv",new _.BufferAttribute(r,2)),_.Object3D.call(this),this.type="Sprite",this.geometry=i,this.matrixAutoUpdate=!1,this.material=void 0!==e?e:new THREE_SpriteMaterial,this.center=new _.Vector2(.5,.5)};(Ue.prototype=Object.create(_.Sprite.prototype)).constructor=Ue,B.prototype.apply(Ue.prototype),Ue.prototype.raycast=function(){var e=new _.Vector3,t=new _.Quaternion,n=new _.Vector3;return function(r,i){this.matrix.decompose(e,t,n);var a=r.ray.distanceToPoint(e);a>n.x||i.push({distance:a,point:this.position,face:null,object:this})}}(),Ue.prototype.clone=function(e){return void 0===e&&(e=new Ue(this.material)),_.Object3D.prototype.clone.call(this,e),e};var Fe=function(e,t,n){_.Object3D.call(this),this.shapeType=n,this._sphere=null,this._selected=!1,this._highlighted=!1,this.type="GenericShape";var r=null;switch(n){case m.A.Container:r=null;break;case m.A.Points:r=new _.Points(e,t);break;case m.A.Line:r=new _.Line(e,t);break;case m.A.LineSegments:r=new _.LineSegments(e,t);break;case m.A.LineStrip:r=new _.LineStrip(e,t);break;default:r=new _.Mesh(e,t)}null!=r&&(this.add(r),this.underlyingShape=r)};Fe.prototype=Object.create(_.Object3D.prototype),Fe.constructor=Fe,B.prototype.apply(Fe.prototype),Object.defineProperties(Fe.prototype,{boundingSphere:{get:function(){if(!this._sphere)if(this.underlyingShape&&this.underlyingShape.geometry)this.underlyingShape.geometry.boundingSphere||this.underlyingShape.geometry.computeBoundingSphere(),this._sphere=this.underlyingShape.geometry.boundingSphere;else{for(var e=new _.Box3,t=0,n=this.children.length;t<n;t++){var r=this.children[t];r&&r.geometry&&(r.geometry.boundingBox||r.geometry.computeBoundingBox(),e.union(r.geometry.boundingBox))}this._sphere=new _.Sphere,e.getBoundingSphere(this._sphere)}return this._sphere}},geometry:{get:function(){return this.underlyingShape?this.underlyingShape.geometry:null}},material:{get:function(){return this.underlyingShape?this.underlyingShape.material:null}},selected:{get:function(){return this._selected},set:function(e){if(this._selected!==e)if(this._selected=e,e&&(this._highlighted=!1),this.geometry)for(var t=0,n=this.geometry.groups.length;t<n;t++)this.geometry.groups[t].materialIndex=e?0:2;else for(t=0,n=this.children;t<n;t++){var r=this.children[t];if(r&&r.geometry)for(var i=0,a=this.geometry.groups.length;i<a;i++)this.geometry.groups[i].materialIndex=e?0:2}}},highlighted:{get:function(){return this._highlighted},set:function(e){if(this._highlighted!==e)if(this._highlighted=e,this.geometry)for(var t=0,n=this.geometry.groups.length;t<n;t++)this.geometry.groups[t].materialIndex=e?1:2;else for(t=0,n=this.children;t<n;t++){var r=this.children[t];if(r&&r.geometry)for(var i=0,a=this.geometry.groups.length;i<a;i++)this.geometry.groups[i].materialIndex=e?1:2}}}}),Fe.prototype.raycast=function(e,t){var n=[];if(this.shape)this.shape.raycast(e,n);else for(var r=0,i=this.children.length;r<i;r++){var a=this.children[r];if(a.children.length>0)for(var o=0;o<a.children.length;o++){var s=a.children[o];s&&s.raycast&&s.raycast(e,n)}a&&a.raycast&&a.raycast(e,n)}for(r=0,i=n.length;r<i;r++)n[r].object=this,t.push(n[r])},Fe.prototype.validateRaycast=function(e,t){return 0===t.pickingMode||(t.pickingMode&m.x.DIMENSION)===m.x.DIMENSION};var ze={Assembly:Me,BufferGeometry:T,Container:G,Edge:U,EdgeShape:Y,EdgeShapeBase:X,EventDispatcher:Ne,FaceShape:K,GenericShape:Fe,InstancedBufferGeometry:E,InstancedLineBufferGeometry:C,InstancedPointsBufferGeometry:P,InstancedMeshBufferGeometry:A,InstancedVertexColorBufferGeometry:I,LineShape:H,OutlineShape:J,Part:_e,PointShape:Se,PartShape:te,PmiLine:Ce,PmiPoint:Ie,PmiRefPlane:Be,PmiSurface:Ge,PmiText:Ve,SectionCapShape:pe,SectionEdgeShape:he,ShapeInstance:k,Sprite:Ue,Vertex:me,VertexShape:ye},ke=n(7),je=n(6),He=n(5);/* harmony default export */
/* harmony default export */var We=
// CONCATENATED MODULE: ./staging/pmi/PmiArrow.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
function PmiArrow(e,t){var n;return e.shape&&(n=e.shape),n.side=e.side,n.type="PmiArrow",n},Xe=function(){_.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";new _.BufferGeometry;this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.addAttribute("position",new _.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.addAttribute("uv",new _.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};
// CONCATENATED MODULE: ./staging/ThreeExtensions/lines/LineSegmentsGeometry.js
/**
 * @preserve
 * @author WestLangley / http://github.com/WestLangley
 * @author Mark Doud   / https://www.siemens.com/plm
 *
* Change Log:
 *
 * 2018-09-26   Mark Doud           ES6ified the file.
 */Xe.prototype=Object.assign(Object.create(_.InstancedBufferGeometry.prototype),{constructor:Xe,isLineSegmentsGeometry:!0,applyMatrix:function(e){var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(e.applyToBufferAttribute(t),e.applyToBufferAttribute(n),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new _.InstancedInterleavedBuffer(t,6,1);// xyz, xyz
return this.addAttribute("instanceStart",new _.InterleavedBufferAttribute(n,3,0)),// xyz
this.addAttribute("instanceEnd",new _.InterleavedBufferAttribute(n,3,3)),// xyz
//
this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new _.InstancedInterleavedBuffer(t,6,1);// rgb, rgb
// rgb
return this.addAttribute("instanceColorStart",new _.InterleavedBufferAttribute(n,3,0)),// rgb
this.addAttribute("instanceColorEnd",new _.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){
// set colors, maybe
return this.fromWireframeGeometry(new WireframeGeometry(e.geometry)),this},fromLineSegements:function(e){var t=e.geometry;
// set colors, maybe
return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},computeBoundingBox:function(){var e=new _.Box3;return function computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new _.Box3);var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==t&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(t),e.setFromBufferAttribute(n),this.boundingBox.union(e))}}(),computeBoundingSphere:function(){var e=new _.Vector3;return function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new _.Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==t&&void 0!==n){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var i=0,a=0,o=t.count;a<o;a++)e.fromBufferAttribute(t,a),i=Math.max(i,r.distanceToSquared(e)),e.fromBufferAttribute(n,a),i=Math.max(i,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){
// todo
},clone:function(){
// todo
},copy:function(e){
// todo
return this}});
/* harmony default export */var qe=Xe,Ye=n(10),Ze=function(e,t){_.Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new qe,this.material=void 0!==t?t:new Ye.a({color:16777215*Math.random()})};
// EXTERNAL MODULE: ./staging/ThreeExtensions/lines/LineMaterial.js
Ze.prototype=Object.assign(Object.create(_.Mesh.prototype),{constructor:Ze,isLineSegments2:!0,computeLineDistances:function(){// for backwards-compatability, but could be a method of LineSegmentsGeometry...
var e=new _.Vector3,t=new _.Vector3;return function computeLineDistances(){for(var n=this.geometry,r=n.attributes.instanceStart,i=n.attributes.instanceEnd,a=new Float32Array(2*r.data.count),o=0,s=0,l=r.data.count;o<l;o++,s+=2)e.fromBufferAttribute(r,o),t.fromBufferAttribute(i,o),a[s]=0===s?0:a[s-1],a[s+1]=a[s]+e.distanceTo(t);var c=new _.InstancedInterleavedBuffer(a,2,1);// d0, d1
// d1
return n.addAttribute("instanceDistanceStart",new _.InterleavedBufferAttribute(c,1,0)),// d0
n.addAttribute("instanceDistanceEnd",new _.InterleavedBufferAttribute(c,1,1)),this}}(),copy:function(e){
// todo
return this}});
/* harmony default export */var Je=Ze,Qe=r.b._createWideLineMaterial({diffuse:0,linewidth:2},!0,!1),Ke=function(e,t){t instanceof Ye.a||(t=Qe);var n=new qe;n.owner=this,n.setPositions(e.vertexBuffer),e.indexBuffer&&n.setIndex(e.indexBuffer),Je.call(this,n,t)};
// CONCATENATED MODULE: ./staging/pmi/PmiMeshLine.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
(Ke.prototype=Object.create(Je.prototype)).constructor=Ke,Te.prototype.apply(Ke.prototype);
/* harmony default export */var $e=Ke;
// CONCATENATED MODULE: ./staging/pmi/PmiArrowLine.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
/* harmony default export */var et=function PmiArrowLine(e,t){var n;return e.shape&&(n=e.shape),n.side=e.side,n.type="PmiArrowLine",n};
// CONCATENATED MODULE: ./staging/pmi/PmiExtensionLine.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
/* harmony default export */var tt=function PmiExtensionLine(e,t){var n;return e.shape&&(n=e.shape),n.side=e.side,n.type="PmiExtensionLine",n};
// CONCATENATED MODULE: ./staging/pmi/PmiObject.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
r.b._createWideLineMaterial({diffuse:0,linewidth:2},!0,!1);function PmiObject_PmiObject(e){_.Object3D.call(this),this.type="PmiObject",e&&(this.name=e.name,this.userData.pmiType=e.pmiType,this.userData.unit=e.unit,this.userData.textIndex=e.textIndex,e.frame?this.userData.pmiFrame=e.frame:this.userData.pmiFrame=[0,0,0,0,1,0,1,0,0]),this.psId=e.id,this._shapes=[],
//initilize materials
this.addMaterials(e),
// Hold references to each part
this.instances=[],this.expectedInstanceCount=0,this._visible=!1}PmiObject_PmiObject.prototype=Object.create(_.Object3D.prototype),PmiObject_PmiObject.prototype.constructor=PmiObject_PmiObject,B.prototype.apply(PmiObject_PmiObject.prototype),Te.prototype.apply(PmiObject_PmiObject.prototype),Object.defineProperties(PmiObject_PmiObject.prototype,{isLoaded:{enumerable:!0,writable:!0,value:!1},isLoading:{enumerable:!0,writable:!0,value:!1},visible:{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._shapes&&this._shapes.forEach(t=>{t.visible=e}))}},shapes:{get:function(){return this._shapes}}}),PmiObject_PmiObject.prototype.addShape=function(e){this._shapes.push(e),e.owner=this,e.visible=!1,this.instances.forEach(t=>{var n=new re(t,e);t.addShape(n),e.geometry.expectedInstanceCount++})},PmiObject_PmiObject.prototype.removeShape=function(e){var t=this._shapes.indexOf(e);t>=0&&this._shapes.splice(t,1),this.remove(e),e.owner=null,this.instances.forEach(e=>{for(;e.shapes.length>0;)e.removeShape(e.shapes[0])})},PmiObject_PmiObject.prototype.addMaterials=function(e){e.lineMaterials&&(this.lineMaterials=[],e.lineMaterials.forEach(e=>{var t=Utils._createLineMaterial(e.color,1,e.width);this.lineMaterials.push(t)})),e.meshMaterials&&(this.meshMaterials=[],e.meshMaterials.forEach(e=>{var t=Utils._createMeshMaterial({diffuse:e.color,opacity:e.opacity},!0,!0);this.meshMaterials.push(t)}))},PmiObject_PmiObject.prototype.addShapes=function(e){e.extensionLines&&e.extensionLines.forEach(e=>{rt(this,e)}),e.arrowLines&&e.arrowLines.forEach(e=>{at(this,e)}),e.arrows&&e.arrows.forEach(e=>{it(this,e)}),e.text&&ot(this,e.text)};var nt=function(e,t){var n,r;return e.geometryType===m.A.WideLine?((r=new qe).setPositions(e.vertexBuffer),e.indexBuffer&&r.setIndex(new _.BufferAttribute(new Uint16Array(e.indexBuffer),1)),n=new $e(r,t)):e.geometryType===m.A.Mesh?((r=new A).addAttribute("position",new _.BufferAttribute(new Float32Array(e.vertexBuffer),3)),e.indexBuffer?r.setIndex(new _.BufferAttribute(new Uint16Array(e.indexBuffer),1)):r.setIndex(new _.BufferAttribute(new Uint16Array([0,1,2]),1)),n=new Ge(r,t)):((r=new C).addAttribute("position",new _.BufferAttribute(new Float32Array(e.vertexBuffer),3)),e.indexBuffer&&r.setIndex(new _.BufferAttribute(new Uint16Array(e.indexBuffer),1)),n=new Ce(r,t)),r&&(r.computeBoundingBox(),r.computeBoundingSphere()),n},rt=function(e,t){var n=t.materials;if(t.geometrySpec){var r=nt(t.geometrySpec,n);t.shape=r}var i=new tt(t,n);e.addShape(i)},it=function(e,t){var n=t.materials;if(t.geometrySpec){var r=nt(t.geometrySpec,n);t.shape=r}var i=new We(t,n);e.addShape(i)},at=function(e,t){var n=t.materials;if(t.geometrySpec){var r=nt(t.geometrySpec,n);t.shape=r}var i=new et(t,n);e.addShape(i)},ot=function(e,t){var n,r=t.materials;t.geometrySpec&&((n=nt(t.geometrySpec,r)).shape=n);var i=new Ve(n.geometry,r);t.origin instanceof Array&&(i.origin=(new _.Vector3).fromArray(t.origin)),t.direction instanceof Array&&(i.direction=(new _.Vector3).fromArray(t.direction)),t.rotationPoint instanceof Array&&(i.rotationPoint=(new _.Vector3).fromArray(t.rotationPoint)),e.addShape(i)},st=PmiObject_PmiObject,lt=function(){this.characterWidth=1.017591,this.fontPoints=[.454545,1,.454545,.363636,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.409091,.636364,.5,.909091,.545455,.909091,.454545,.636364,.409091,.636364,.590909,.636364,.681818,.909091,.727273,.909091,.636364,.636364,.590909,.636364,.5,1.18182,.181818,-.272727,.772727,1.18182,.454545,-.272727,.181818,.590909,.818182,.590909,.136364,.318182,.772727,.318182,.363636,1.18182,.363636,-.136364,.545455,1.18182,.545455,-.136364,.772727,.863636,.681818,.954545,.545455,1,.363636,1,.227273,.954545,.136364,.863636,.136364,.772727,.227273,.636364,.318182,.590909,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.181818,.681818,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.136364,.181818,.727273,.772727,.181818,.181818,.318182,.772727,.363636,.727273,.363636,.636364,.318182,.590909,.227273,.590909,.181818,.636364,.181818,.727273,.227273,.772727,.318182,.772727,.5,.727273,.636364,.727273,.727273,.772727,.590909,.363636,.545455,.318182,.545455,.227273,.590909,.181818,.681818,.181818,.727273,.227273,.727273,.318182,.681818,.363636,.590909,.363636,.909091,.590909,.909091,.636364,.863636,.681818,.818182,.681818,.772727,.636364,.727273,.545455,.636364,.318182,.545455,.181818,.454545,.0909091,.363636,.0454545,.181818,.0454545,.0909091,.0909091,.0454545,.136364,0,.227273,0,.318182,.0454545,.409091,.0909091,.454545,.409091,.636364,.454545,.681818,.5,.772727,.5,.863636,.454545,.954545,.363636,1,.272727,.954545,.227273,.863636,.227273,.772727,.272727,.636364,.363636,.5,.590909,.181818,.681818,.0909091,.772727,.0454545,.863636,.0454545,.909091,.0909091,.909091,.136364,.409091,.636364,.5,.909091,.545455,.909091,.454545,.636364,.409091,.636364,.636364,1.18182,.545455,1.09091,.454545,.954545,.363636,.772727,.318182,.545455,.318182,.363636,.363636,.136364,.454545,-.0454545,.545455,-.181818,.636364,-.272727,.272727,1.18182,.363636,1.09091,.454545,.954545,.545455,.772727,.590909,.545455,.590909,.363636,.545455,.136364,.454545,-.0454545,.363636,-.181818,.272727,-.272727,.454545,.727273,.454545,.181818,.227273,.590909,.681818,.318182,.681818,.590909,.227273,.318182,.136364,.454545,.772727,.454545,.454545,.136364,.454545,.772727,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.136364,.454545,.772727,.454545,.409091,0,.409091,.0909091,.5,.0909091,.5,0,.409091,0,.0909091,0,.818182,.909091,.409091,1,.272727,.954545,.181818,.818182,.136364,.590909,.136364,.454545,.181818,.227273,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.227273,.772727,.454545,.772727,.590909,.727273,.818182,.636364,.954545,.5,1,.409091,1,.272727,.818182,.363636,.863636,.5,1,.5,.0454545,.181818,.772727,.181818,.818182,.227273,.909091,.272727,.954545,.363636,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.590909,.5,.136364,.0454545,.772727,.0454545,.227273,1,.727273,1,.454545,.636364,.590909,.636364,.681818,.590909,.727273,.545455,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.363636,.0454545,.227273,.0909091,.181818,.136364,.136364,.227273,.590909,1,.136364,.363636,.818182,.363636,.590909,1,.590909,.0454545,.681818,1,.227273,1,.181818,.590909,.227273,.636364,.363636,.681818,.5,.681818,.636364,.636364,.727273,.545455,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.363636,.0454545,.227273,.0909091,.181818,.136364,.136364,.227273,.727273,.863636,.681818,.954545,.545455,1,.454545,1,.318182,.954545,.227273,.818182,.181818,.590909,.181818,.363636,.227273,.181818,.318182,.0909091,.454545,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.318182,.772727,.363636,.727273,.5,.636364,.590909,.5,.636364,.454545,.636364,.318182,.590909,.227273,.5,.181818,.363636,.772727,1,.318182,.0454545,.136364,1,.772727,1,.363636,1,.227273,.954545,.181818,.863636,.181818,.772727,.227273,.681818,.318182,.636364,.5,.590909,.636364,.545455,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.181818,.136364,.136364,.227273,.136364,.363636,.181818,.454545,.272727,.545455,.409091,.590909,.590909,.636364,.681818,.681818,.727273,.772727,.727273,.863636,.681818,.954545,.545455,1,.363636,1,.727273,.681818,.681818,.545455,.590909,.454545,.454545,.409091,.409091,.409091,.272727,.454545,.181818,.545455,.136364,.681818,.136364,.727273,.181818,.863636,.272727,.954545,.409091,1,.454545,1,.590909,.954545,.681818,.863636,.727273,.681818,.727273,.454545,.681818,.227273,.590909,.0909091,.454545,.0454545,.363636,.0454545,.227273,.0909091,.181818,.181818,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.681818,.727273,.227273,.454545,.681818,.181818,.181818,.545455,.727273,.545455,.181818,.363636,.727273,.363636,.227273,.727273,.681818,.454545,.227273,.181818,.181818,.772727,.181818,.818182,.227273,.909091,.272727,.954545,.363636,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.636364,.590909,.454545,.5,.454545,.363636,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.0454545,.636364,.181818,1,.318182,.636364,.0909091,.772727,.272727,.772727,.363636,.681818,.363636,.318182,.590909,.318182,.590909,.363636,.863636,.363636,.727273,.363636,.727273,.0454545,.454545,1,.0909091,.0454545,.454545,1,.818182,.0454545,.227273,.363636,.681818,.363636,.136364,1,.136364,.0454545,.136364,1,.545455,1,.681818,.954545,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.681818,.590909,.545455,.545455,.136364,.545455,.545455,.545455,.681818,.5,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.545455,.0454545,.136364,.0454545,.818182,.772727,.772727,.863636,.681818,.954545,.590909,1,.409091,1,.318182,.954545,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.409091,.181818,.272727,.227273,.181818,.318182,.0909091,.409091,.0454545,.590909,.0454545,.681818,.0909091,.772727,.181818,.818182,.272727,.136364,1,.136364,.0454545,.136364,1,.454545,1,.590909,.954545,.681818,.863636,.727273,.772727,.772727,.636364,.772727,.409091,.727273,.272727,.681818,.181818,.590909,.0909091,.454545,.0454545,.136364,.0454545,.181818,1,.181818,.0454545,.181818,1,.772727,1,.181818,.545455,.545455,.545455,.181818,.0454545,.772727,.0454545,.181818,1,.181818,.0454545,.181818,1,.772727,1,.181818,.545455,.545455,.545455,.818182,.772727,.772727,.863636,.681818,.954545,.590909,1,.409091,1,.318182,.954545,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.409091,.181818,.272727,.227273,.181818,.318182,.0909091,.409091,.0454545,.590909,.0454545,.681818,.0909091,.772727,.181818,.818182,.272727,.818182,.409091,.590909,.409091,.818182,.409091,.136364,1,.136364,.0454545,.772727,1,.772727,.0454545,.136364,.545455,.772727,.545455,.454545,1,.454545,.0454545,.636364,1,.636364,.272727,.590909,.136364,.545455,.0909091,.454545,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.181818,.272727,.181818,.363636,.136364,1,.136364,.0454545,.772727,1,.136364,.363636,.363636,.590909,.772727,.0454545,.181818,1,.181818,.0454545,.181818,.0454545,.727273,.0454545,.0909091,1,.0909091,.0454545,.0909091,1,.454545,.0454545,.818182,1,.454545,.0454545,.818182,1,.818182,.0454545,.136364,1,.136364,.0454545,.136364,1,.772727,.0454545,.772727,1,.772727,.0454545,.363636,1,.272727,.954545,.181818,.863636,.136364,.772727,.0909091,.636364,.0909091,.409091,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.818182,.409091,.818182,.636364,.772727,.772727,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.136364,1,.136364,.0454545,.136364,1,.545455,1,.681818,.954545,.727273,.909091,.772727,.818182,.772727,.681818,.727273,.590909,.681818,.545455,.545455,.5,.136364,.5,.363636,1,.272727,.954545,.181818,.863636,.136364,.772727,.0909091,.636364,.0909091,.409091,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.818182,.409091,.818182,.636364,.772727,.772727,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.5,.227273,.772727,-.0454545,.136364,1,.136364,.0454545,.136364,1,.545455,1,.681818,.954545,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.681818,.590909,.545455,.545455,.136364,.545455,.454545,.545455,.772727,.0454545,.772727,.863636,.681818,.954545,.545455,1,.363636,1,.227273,.954545,.136364,.863636,.136364,.772727,.181818,.681818,.227273,.636364,.318182,.590909,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.181818,.681818,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.136364,.181818,.454545,1,.454545,.0454545,.136364,1,.772727,1,.136364,1,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.318182,.772727,1,.0909091,1,.454545,.0454545,.818182,1,.454545,.0454545,.0454545,1,.227273,.0454545,.454545,1,.681818,.0454545,.863636,1,.136364,1,.772727,.0454545,.772727,1,.136364,.0454545,.0909091,1,.454545,.545455,.454545,.0454545,.818182,1,.454545,.545455,.772727,1,.136364,.0454545,.136364,1,.772727,1,.136364,.0454545,.772727,.0454545,.363636,.909091,.363636,0,.409091,.909091,.409091,0,.363636,.909091,.590909,.909091,.363636,0,.590909,0,.136364,.590909,.772727,.590909,.454545,.272727,.454545,.909091,.136364,.136364,.772727,.136364,.5,.909091,.5,0,.545455,.909091,.545455,0,.318182,.909091,.545455,.909091,.318182,0,.545455,0,.227273,.681818,.454545,.909091,.681818,.681818,0,0,.909091,0,.409091,.636364,.5,.636364,.590909,.727273,.590909,.818182,.5,.909091,.409091,.909091,.318182,.818182,.318182,.727273,.409091,.636364,.727273,.681818,.727273,.0454545,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.181818,1,.181818,.0454545,.181818,.545455,.272727,.636364,.363636,.681818,.5,.681818,.590909,.636364,.681818,.545455,.727273,.409091,.727273,.318182,.681818,.181818,.590909,.0909091,.5,.0454545,.363636,.0454545,.272727,.0909091,.181818,.181818,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.727273,1,.727273,.0454545,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.181818,.409091,.727273,.409091,.727273,.5,.681818,.590909,.636364,.636364,.545455,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.681818,1,.590909,1,.5,.954545,.454545,.818182,.454545,.0454545,.318182,.681818,.636364,.681818,.727273,.681818,.727273,-.0454545,.681818,-.181818,.636364,-.227273,.545455,-.272727,.409091,-.272727,.318182,-.227273,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.227273,1,.227273,.0454545,.227273,.5,.363636,.636364,.454545,.681818,.590909,.681818,.681818,.636364,.727273,.5,.727273,.0454545,.409091,1,.454545,.954545,.5,1,.454545,1.04545,.409091,1,.454545,.681818,.454545,.0454545,.454545,1,.5,.954545,.545455,1,.5,1.04545,.454545,1,.5,.681818,.5,-.0909091,.454545,-.227273,.363636,-.272727,.272727,-.272727,.227273,1,.227273,.0454545,.681818,.681818,.227273,.227273,.409091,.409091,.727273,.0454545,.454545,1,.454545,.0454545,.0454545,.681818,.0454545,.0454545,.0454545,.5,.0909091,.636364,.181818,.681818,.318182,.681818,.409091,.636364,.454545,.5,.454545,.0454545,.454545,.5,.5,.636364,.590909,.681818,.727273,.681818,.818182,.636364,.863636,.5,.863636,.0454545,.227273,.681818,.227273,.0454545,.227273,.5,.363636,.636364,.454545,.681818,.590909,.681818,.681818,.636364,.727273,.5,.727273,.0454545,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.318182,.772727,.409091,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.181818,.681818,.181818,-.272727,.181818,.545455,.272727,.636364,.363636,.681818,.5,.681818,.590909,.636364,.681818,.545455,.727273,.409091,.727273,.318182,.681818,.181818,.590909,.0909091,.5,.0454545,.363636,.0454545,.272727,.0909091,.181818,.181818,.727273,.681818,.727273,-.272727,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.318182,.681818,.318182,.0454545,.318182,.409091,.363636,.545455,.454545,.636364,.545455,.681818,.681818,.681818,.727273,.545455,.681818,.636364,.545455,.681818,.409091,.681818,.272727,.636364,.227273,.545455,.272727,.454545,.363636,.409091,.590909,.363636,.681818,.318182,.727273,.227273,.727273,.181818,.681818,.0909091,.545455,.0454545,.409091,.0454545,.272727,.0909091,.227273,.181818,.454545,1,.454545,.227273,.5,.0909091,.590909,.0454545,.681818,.0454545,.318182,.681818,.636364,.681818,.227273,.681818,.227273,.227273,.272727,.0909091,.363636,.0454545,.5,.0454545,.590909,.0909091,.727273,.227273,.727273,.681818,.727273,.0454545,.181818,.681818,.454545,.0454545,.727273,.681818,.454545,.0454545,.0909091,.681818,.272727,.0454545,.454545,.681818,.272727,.0454545,.454545,.681818,.636364,.0454545,.818182,.681818,.636364,.0454545,.227273,.681818,.727273,.0454545,.727273,.681818,.227273,.0454545,.181818,.681818,.454545,.0454545,.727273,.681818,.454545,.0454545,.363636,-.136364,.272727,-.227273,.181818,-.272727,.136364,-.272727,.727273,.681818,.227273,.0454545,.227273,.681818,.727273,.681818,.227273,.0454545,.727273,.0454545,.5,.909091,.409091,.863636,.363636,.818182,.363636,.727273,.454545,.636364,.5,.545455,.409091,.863636,.363636,.727273,.5,.636364,.454545,.5,.363636,.818182,.409091,.727273,.5,.636364,.5,.545455,.454545,.5,.363636,.454545,.454545,.409091,.5,.363636,.5,.272727,.409091,.181818,.363636,.0909091,.454545,.409091,.5,.272727,.363636,.181818,.409091,.0454545,.5,.363636,.454545,.272727,.363636,.181818,.363636,.0909091,.409091,.0454545,.5,0,.545455,.818182,.363636,.818182,.181818,.727273,.0909091,.545455,.0909091,.363636,.181818,.181818,.363636,.0909091,.545455,.0909091,.727273,.181818,.818182,.363636,.818182,.545455,.727273,.727273,.545455,.818182,.772727,1.09091,.136364,-.181818,.409091,.909091,.5,.863636,.545455,.818182,.545455,.727273,.454545,.636364,.409091,.545455,.5,.863636,.545455,.727273,.409091,.636364,.454545,.5,.545455,.818182,.5,.727273,.409091,.636364,.409091,.545455,.454545,.5,.545455,.454545,.454545,.409091,.409091,.363636,.409091,.272727,.5,.181818,.545455,.0909091,.454545,.409091,.409091,.272727,.545455,.181818,.5,.0454545,.409091,.363636,.454545,.272727,.545455,.181818,.545455,.0909091,.5,.0454545,.409091,0,.136364,.909091,.181818,.954545,.272727,1,.363636,1,.545455,.818182,.636364,.818182,.727273,.863636,.772727,.909091,.454545,1,.454545,.363636,.454545,.136364,.454545,.0454545,.409091,.636364,.5,.909091,.545455,.909091,.454545,.636364,.409091,.636364,.590909,.636364,.681818,.909091,.727273,.909091,.636364,.636364,.590909,.636364,.5,1.18182,.181818,-.272727,.772727,1.18182,.454545,-.272727,.181818,.590909,.818182,.590909,.136364,.318182,.772727,.318182,.772727,.863636,.727273,.909091,.590909,1,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.727273,.272727,.636364,.318182,.590909,.409091,.545455,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.227273,.727273,.136364,.681818,.0909091,.590909,.0454545,.409091,.0454545,.272727,.0909091,.181818,.181818,.5,-.0454545,.5,1.09091,.727273,.772727,.181818,.181818,.318182,.772727,.363636,.727273,.363636,.636364,.318182,.590909,.227273,.590909,.181818,.636364,.181818,.727273,.227273,.772727,.318182,.772727,.5,.727273,.636364,.727273,.727273,.772727,.590909,.363636,.545455,.318182,.545455,.227273,.590909,.181818,.681818,.181818,.727273,.227273,.727273,.318182,.681818,.363636,.590909,.363636,.772727,0,.272727,.727273,.227273,.818182,.227273,.863636,.272727,.954545,.363636,1,.454545,1,.545455,.954545,.590909,.863636,.590909,.818182,.545455,.727273,.227273,.409091,.136364,.318182,.0909091,.227273,.0909091,.181818,.136364,.0909091,.227273,.0454545,.409091,.0454545,.5,.0909091,.772727,.318182,.409091,.636364,.5,.909091,.545455,.909091,.454545,.636364,.409091,.636364,.5,1.09091,.454545,.909091,.409091,.636364,.409091,.409091,.454545,.136364,.5,-.0454545,.409091,1.09091,.454545,.909091,.5,.636364,.5,.409091,.454545,.136364,.409091,-.0454545,.454545,.727273,.454545,.181818,.227273,.590909,.681818,.318182,.681818,.590909,.227273,.318182,.454545,.727273,.454545,.272727,.227273,.5,.681818,.5,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.227273,.5,.681818,.5,.409091,0,.409091,.0909091,.5,.0909091,.5,0,.409091,0,.0909091,0,.818182,.909091,.409091,1,.318182,.954545,.227273,.863636,.181818,.772727,.181818,.272727,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.727273,.272727,.727273,.772727,.681818,.863636,.590909,.954545,.5,1,.409091,1,.272727,.818182,.454545,1,.454545,0,.181818,.863636,.227273,.909091,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.636364,.227273,.0454545,.727273,.0454545,.227273,.863636,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.590909,.5,.5,.454545,.5,.590909,.5,.681818,.454545,.727273,.363636,.727273,.272727,.681818,.136364,.636364,.0909091,.545455,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.5,.954545,.227273,.181818,.727273,.181818,.636364,.363636,.636364,.0454545,.681818,1,.227273,1,.227273,.590909,.363636,.636364,.5,.636364,.636364,.590909,.681818,.545455,.727273,.454545,.727273,.227273,.681818,.136364,.636364,.0909091,.5,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.636364,.909091,.590909,.954545,.5,1,.409091,1,.318182,.954545,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.363636,.181818,.227273,.227273,.136364,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.681818,.136364,.727273,.227273,.727273,.409091,.681818,.5,.636364,.545455,.545455,.590909,.363636,.590909,.272727,.545455,.181818,.454545,.227273,.863636,.227273,1,.727273,1,.318182,.0454545,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.727273,.272727,.636364,.318182,.590909,.409091,.545455,.5,.545455,.590909,.590909,.636364,.636364,.681818,.727273,.681818,.818182,.636364,.909091,.590909,.954545,.5,1,.409091,1,.545455,.545455,.636364,.5,.681818,.454545,.727273,.363636,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.181818,.227273,.181818,.363636,.227273,.454545,.272727,.5,.363636,.545455,.727273,.636364,.636364,.5,.590909,.454545,.5,.409091,.409091,.409091,.318182,.454545,.272727,.5,.181818,.636364,.181818,.772727,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.727273,.772727,.727273,.318182,.636364,.181818,.545455,.0909091,.454545,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.681818,.727273,.227273,.454545,.681818,.181818,.227273,.636364,.681818,.636364,.681818,.318182,.227273,.318182,.227273,.727273,.681818,.454545,.227273,.181818,.227273,.863636,.318182,.954545,.409091,1,.5,1,.590909,.954545,.681818,.863636,.727273,.772727,.727273,.681818,.681818,.590909,.590909,.5,.5,.454545,.454545,.363636,.454545,.318182,.454545,.136364,.454545,.0454545,.0454545,.636364,.181818,1,.318182,.636364,.0909091,.772727,.272727,.772727,.363636,.681818,.363636,.318182,.590909,.318182,.590909,.363636,.863636,.363636,.727273,.363636,.727273,.0454545,.136364,.0454545,.454545,1,.772727,.0454545,.227273,.318182,.681818,.318182,.136364,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.636364,.590909,.545455,.545455,.136364,.545455,.136364,1,.136364,.0454545,.590909,.0454545,.681818,.0909091,.727273,.136364,.772727,.227273,.772727,.363636,.727273,.454545,.681818,.5,.590909,.545455,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.272727,.954545,.181818,.863636,.136364,.772727,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.136364,1,.545455,1,.636364,.954545,.727273,.863636,.772727,.772727,.772727,.272727,.727273,.181818,.636364,.0909091,.545455,.0454545,.136364,.0454545,.136364,1,.772727,1,.136364,1,.136364,.0454545,.772727,.0454545,.136364,.545455,.681818,.545455,.136364,.0454545,.136364,1,.772727,1,.136364,.545455,.681818,.545455,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.272727,.954545,.181818,.863636,.136364,.772727,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.772727,.545455,.5,.545455,.136364,1,.136364,.0454545,.136364,.545455,.772727,.545455,.772727,1,.772727,.0454545,.454545,1,.454545,.0454545,.590909,1,.590909,.181818,.545455,.0909091,.5,.0454545,.363636,.0454545,.272727,.136364,.136364,1,.136364,.0454545,.136364,.409091,.772727,1,.772727,.0454545,.363636,.590909,.181818,1,.181818,.0454545,.727273,.0454545,.0909091,.0454545,.0909091,1,.454545,.318182,.818182,1,.818182,.0454545,.136364,.0454545,.136364,1,.772727,.0454545,.772727,1,.363636,1,.272727,.954545,.181818,.863636,.136364,.772727,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.772727,.772727,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.136364,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.636364,.590909,.545455,.545455,.136364,.545455,.136364,1,.136364,.0454545,.363636,1,.272727,.954545,.181818,.863636,.136364,.772727,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.772727,.772727,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.590909,.227273,.818182,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.636364,.590909,.545455,.545455,.136364,.545455,.136364,1,.136364,.0454545,.545455,.545455,.727273,.0454545,.772727,.863636,.727273,.909091,.590909,1,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.727273,.272727,.636364,.318182,.590909,.409091,.545455,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.227273,.727273,.136364,.681818,.0909091,.590909,.0454545,.409091,.0454545,.272727,.0909091,.181818,.181818,.136364,1,.772727,1,.454545,1,.454545,.0454545,.136364,1,.136364,.272727,.181818,.181818,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.772727,1,.136364,1,.454545,.0454545,.772727,1,.0454545,1,.227273,.0454545,.454545,.954545,.681818,.0454545,.863636,1,.136364,1,.772727,.0454545,.136364,.0454545,.772727,1,.136364,1,.454545,.5,.772727,1,.454545,.5,.454545,.0454545,.136364,1,.772727,1,.136364,.0454545,.772727,.0454545,.363636,.909091,.363636,0,.409091,.909091,.409091,0,.363636,.909091,.590909,.909091,.363636,0,.590909,0,.454545,.863636,.454545,.409091,.227273,.636364,.681818,.636364,.227273,.272727,.681818,.272727,.5,.909091,.5,0,.545455,.909091,.545455,0,.318182,.909091,.545455,.909091,.318182,0,.545455,0,.227273,.681818,.454545,.909091,.681818,.681818,0,0,.909091,0,.409091,.636364,.5,.636364,.590909,.727273,.590909,.818182,.5,.909091,.409091,.909091,.318182,.818182,.318182,.727273,.409091,.636364,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.681818,.681818,.681818,.0454545,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.227273,1,.227273,.0454545,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.681818,1,.681818,.0454545,.227273,.363636,.681818,.363636,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.590909,1,.545455,1,.454545,.954545,.409091,.863636,.409091,.0454545,.318182,.681818,.545455,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.681818,.681818,.681818,-.0909091,.636364,-.181818,.590909,-.227273,.5,-.272727,.409091,-.272727,.318182,-.227273,.227273,-.136364,.227273,1,.227273,.0454545,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.454545,1,.454545,.909091,.454545,.681818,.454545,.0454545,.545455,1,.545455,.909091,.545455,.681818,.545455,-.0909091,.5,-.181818,.454545,-.227273,.363636,-.272727,.318182,-.272727,.181818,1,.181818,.0454545,.181818,.272727,.681818,.727273,.681818,.0454545,.363636,.409091,.454545,.954545,.454545,.136364,.5,.0454545,.0454545,.681818,.0454545,.0454545,.0454545,.5,.0909091,.590909,.136364,.636364,.227273,.681818,.272727,.681818,.363636,.636364,.409091,.590909,.454545,.5,.454545,.0454545,.454545,.5,.5,.590909,.545455,.636364,.636364,.681818,.681818,.681818,.772727,.636364,.818182,.590909,.863636,.5,.863636,.0454545,.227273,.681818,.227273,.0454545,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.227273,.681818,.227273,-.272727,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.681818,.681818,.681818,-.272727,.318182,.681818,.318182,.0454545,.318182,.545455,.363636,.636364,.454545,.681818,.545455,.681818,.636364,.636364,.636364,.636364,.545455,.681818,.363636,.681818,.272727,.636364,.227273,.590909,.227273,.5,.272727,.454545,.363636,.409091,.545455,.363636,.636364,.318182,.681818,.272727,.681818,.136364,.636364,.0909091,.545455,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.454545,.954545,.454545,.181818,.5,.0909091,.590909,.0454545,.363636,.681818,.590909,.681818,.227273,.681818,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.681818,.181818,.681818,.454545,.0454545,.727273,.681818,.0909091,.681818,.272727,.0454545,.454545,.636364,.636364,.0454545,.818182,.681818,.181818,.681818,.727273,.0454545,.181818,.0454545,.727273,.681818,.227273,.681818,.454545,.0909091,.681818,.681818,.363636,-.136364,.272727,-.227273,.181818,-.272727,.181818,.681818,.772727,.681818,.181818,.0454545,.772727,.0454545,.5,.909091,.409091,.863636,.363636,.818182,.363636,.727273,.454545,.636364,.5,.545455,.409091,.863636,.363636,.727273,.5,.636364,.454545,.5,.363636,.818182,.409091,.727273,.5,.636364,.5,.545455,.454545,.5,.363636,.454545,.454545,.409091,.5,.363636,.5,.272727,.409091,.181818,.363636,.0909091,.454545,.409091,.5,.272727,.363636,.181818,.409091,.0454545,.5,.363636,.454545,.272727,.363636,.181818,.363636,.0909091,.409091,.0454545,.5,0,.545455,.818182,.363636,.818182,.181818,.727273,.0909091,.545455,.0909091,.363636,.181818,.181818,.363636,.0909091,.545455,.0909091,.727273,.181818,.818182,.363636,.818182,.545455,.727273,.727273,.545455,.818182,.772727,1.09091,.136364,-.181818,.409091,.909091,.5,.863636,.545455,.818182,.545455,.727273,.454545,.636364,.409091,.545455,.5,.863636,.545455,.727273,.409091,.636364,.454545,.5,.545455,.818182,.5,.727273,.409091,.636364,.409091,.545455,.454545,.5,.545455,.454545,.454545,.409091,.409091,.363636,.409091,.272727,.5,.181818,.545455,.0909091,.454545,.409091,.409091,.272727,.545455,.181818,.5,.0454545,.409091,.363636,.454545,.272727,.545455,.181818,.545455,.0909091,.5,.0454545,.409091,0,.136364,.909091,.181818,.954545,.272727,1,.363636,1,.545455,.818182,.636364,.818182,.727273,.863636,.772727,.909091,.454545,1,.454545,.318182,.454545,.136364,.454545,.0454545,.409091,.636364,.5,.909091,.545455,.909091,.454545,.636364,.409091,.636364,.590909,.636364,.681818,.909091,.727273,.909091,.636364,.636364,.590909,.636364,.5,1.18182,.181818,-.272727,.772727,1.18182,.454545,-.272727,.181818,.590909,.818182,.590909,.136364,.318182,.772727,.318182,.363636,1.18182,.363636,-.136364,.545455,1.18182,.545455,-.136364,.772727,.863636,.681818,.954545,.545455,1,.363636,1,.227273,.954545,.136364,.863636,.136364,.772727,.227273,.636364,.318182,.590909,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.181818,.681818,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.136364,.181818,.727273,.772727,.181818,.181818,.318182,.772727,.363636,.727273,.363636,.636364,.318182,.590909,.227273,.590909,.181818,.636364,.181818,.727273,.227273,.772727,.318182,.772727,.5,.727273,.636364,.727273,.727273,.772727,.590909,.363636,.545455,.318182,.545455,.227273,.590909,.181818,.681818,.181818,.727273,.227273,.727273,.318182,.681818,.363636,.590909,.363636,.772727,.318182,.545455,.136364,.409091,.0454545,.227273,.0454545,.0909091,.0909091,.0454545,.181818,.0454545,.272727,.0909091,.363636,.454545,.681818,.5,.727273,.545455,.818182,.5,.909091,.454545,.954545,.363636,1,.272727,1,.181818,.909091,.136364,.818182,.136364,.772727,.181818,.681818,.681818,.136364,.818182,.0909091,.863636,.0909091,.409091,.636364,.5,.909091,.545455,.909091,.454545,.636364,.409091,.636364,.636364,1.18182,.545455,1.09091,.454545,.954545,.363636,.772727,.318182,.545455,.318182,.363636,.363636,.136364,.454545,-.0454545,.545455,-.181818,.636364,-.272727,.272727,1.18182,.363636,1.09091,.454545,.954545,.545455,.772727,.590909,.545455,.590909,.363636,.545455,.136364,.454545,-.0454545,.363636,-.181818,.272727,-.272727,.454545,.727273,.454545,.181818,.227273,.590909,.681818,.318182,.681818,.590909,.227273,.318182,.227273,.363636,.681818,.363636,.454545,.590909,.454545,.136364,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.227273,.363636,.681818,.363636,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.681818,1,.227273,.0454545,.5,1,.590909,.954545,.681818,.863636,.727273,.772727,.727273,.272727,.681818,.181818,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.181818,.272727,.181818,.772727,.227273,.863636,.318182,.954545,.409091,1,.5,1,.727273,1.09091,.181818,-.0454545,.454545,1,.454545,.0454545,.136364,.863636,.272727,.954545,.409091,1,.545455,1,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.636364,.545455,.454545,.5,.363636,.454545,.227273,.363636,.181818,.272727,.136364,.0909091,.136364,.0454545,.772727,.0454545,.181818,.909091,.272727,.954545,.409091,1,.5,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.636364,.636364,.5,.590909,.409091,.590909,.5,.590909,.545455,.590909,.681818,.545455,.727273,.5,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.409091,.0454545,.272727,.0909091,.181818,.181818,.636364,.0454545,.636364,1,.0454545,.318182,.863636,.318182,.681818,1,.227273,1,.181818,.545455,.272727,.590909,.409091,.636364,.5,.636364,.636364,.590909,.727273,.545455,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.409091,.0454545,.272727,.0909091,.181818,.136364,.136364,.181818,.681818,.863636,.636364,.954545,.5,1,.409091,1,.318182,.954545,.227273,.863636,.181818,.727273,.136364,.545455,.136364,.272727,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.772727,.363636,.727273,.5,.636364,.590909,.5,.636364,.409091,.636364,.272727,.590909,.181818,.5,.136364,.409091,.136364,1,.772727,1,.636364,.727273,.5,.409091,.409091,.0454545,.5,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.818182,.181818,.727273,.227273,.636364,.272727,.590909,.363636,.545455,.545455,.545455,.681818,.5,.727273,.454545,.772727,.318182,.772727,.272727,.727273,.181818,.636364,.0909091,.5,.0454545,.409091,.0454545,.272727,.0909091,.181818,.181818,.136364,.272727,.136364,.318182,.181818,.454545,.227273,.5,.363636,.545455,.545455,.545455,.636364,.590909,.681818,.636364,.727273,.727273,.727273,.818182,.681818,.909091,.636364,.954545,.5,1,.227273,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.727273,.318182,.772727,.5,.772727,.772727,.727273,.863636,.636364,.954545,.5,1,.409091,1,.272727,.954545,.181818,.863636,.136364,.772727,.136364,.681818,.181818,.545455,.272727,.454545,.409091,.409091,.5,.409091,.636364,.454545,.727273,.545455,.772727,.636364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.681818,.727273,.227273,.454545,.681818,.181818,.227273,.181818,.681818,.181818,.227273,.454545,.681818,.454545,.227273,.727273,.681818,.454545,.227273,.181818,.181818,.772727,.181818,.818182,.227273,.909091,.272727,.954545,.363636,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.636364,.590909,.454545,.5,.454545,.363636,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.0454545,.636364,.181818,1,.318182,.636364,.0909091,.772727,.272727,.772727,.363636,.681818,.363636,.318182,.590909,.318182,.590909,.363636,.863636,.363636,.727273,.363636,.727273,.0454545,.0454545,.0454545,.454545,1,.863636,.0454545,.227273,.409091,.681818,.409091,.0909091,.0454545,.0909091,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.636364,.590909,.545455,.545455,.0909091,.545455,.636364,.590909,.772727,.5,.818182,.409091,.818182,.272727,.772727,.181818,.681818,.0909091,.545455,.0454545,.0909091,.0454545,.818182,.909091,.636364,1,.454545,1,.272727,.909091,.0909091,.727273,.0454545,.545455,.0454545,.454545,.0909091,.272727,.272727,.0909091,.409091,.0454545,.545455,.0454545,.727273,.0909091,.863636,.227273,.0909091,1,.0909091,.0454545,.363636,.0454545,.5,.0909091,.636364,.181818,.681818,.227273,.727273,.318182,.772727,.454545,.772727,.590909,.727273,.727273,.681818,.818182,.636364,.863636,.5,.954545,.363636,1,.0909091,1,.727273,1,.136364,1,.136364,.0454545,.727273,.0454545,.136364,.545455,.5,.545455,.727273,1,.136364,1,.136364,.0454545,.136364,.545455,.5,.545455,.818182,.909091,.636364,1,.454545,1,.272727,.909091,.0909091,.727273,.0454545,.545455,.0454545,.454545,.0909091,.272727,.272727,.0909091,.409091,.0454545,.545455,.0454545,.727273,.0909091,.863636,.227273,.863636,.545455,.545455,.545455,.136364,1,.136364,.0454545,.136364,.545455,.772727,.545455,.772727,1,.772727,.0454545,.272727,1,.636364,1,.454545,1,.454545,.0454545,.272727,.0454545,.636364,.0454545,.772727,1,.772727,.363636,.727273,.181818,.590909,.0909091,.454545,.0454545,.318182,.0909091,.227273,.181818,.181818,.272727,.0909091,1,.0909091,.0454545,.0909091,.409091,.727273,1,.363636,.636364,.772727,.0454545,.136364,1,.136364,.0454545,.772727,.0454545,.0454545,.0454545,.0454545,1,.454545,.181818,.863636,1,.863636,.0454545,.0909091,.0454545,.0909091,1,.772727,.0454545,.772727,1,.0454545,.590909,.0454545,.454545,.0909091,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.818182,.318182,.863636,.454545,.863636,.590909,.818182,.727273,.727273,.863636,.636364,.954545,.5,1,.409091,1,.272727,.954545,.181818,.863636,.0909091,.727273,.0454545,.590909,.136364,.0454545,.136364,1,.454545,1,.590909,.954545,.681818,.863636,.727273,.772727,.727273,.681818,.681818,.590909,.590909,.5,.454545,.454545,.136364,.454545,.0454545,.590909,.0454545,.454545,.0909091,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.818182,.318182,.863636,.454545,.863636,.590909,.818182,.727273,.727273,.863636,.636364,.954545,.5,1,.409091,1,.272727,.954545,.181818,.863636,.0909091,.727273,.0454545,.590909,.590909,.318182,.863636,.0454545,.136364,.0454545,.136364,1,.454545,1,.590909,.954545,.681818,.863636,.727273,.772727,.727273,.681818,.681818,.590909,.590909,.5,.454545,.454545,.136364,.454545,.545455,.454545,.772727,.0454545,.681818,.909091,.636364,.954545,.5,1,.409091,1,.272727,.954545,.181818,.818182,.181818,.681818,.272727,.590909,.409091,.545455,.636364,.5,.727273,.409091,.772727,.318182,.772727,.227273,.636364,.0909091,.5,.0454545,.409091,.0454545,.272727,.0909091,.181818,.181818,.0909091,1,.818182,1,.454545,1,.454545,.0454545,.136364,1,.136364,.318182,.181818,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.727273,.181818,.772727,.318182,.772727,1,.0909091,1,.454545,.0454545,.818182,1,-.0909091,1,.181818,.0454545,.454545,1,.727273,.0454545,1,1,.136364,1,.818182,.0454545,.772727,1,.0909091,.0454545,.136364,1,.454545,.454545,.454545,.0454545,.454545,.454545,.772727,1,.136364,1,.772727,1,.136364,.0454545,.772727,.0454545,.318182,.545455,.636364,.545455,.545455,1,.363636,1,.363636,-.0454545,.545455,-.0454545,.136364,.590909,.772727,.590909,.454545,.272727,.454545,.909091,.136364,.136364,.772727,.136364,.363636,1,.545455,1,.545455,-.0454545,.363636,-.0454545,.227273,.681818,.454545,.909091,.681818,.681818,0,0,.909091,0,.409091,.636364,.5,.636364,.590909,.727273,.590909,.818182,.5,.909091,.409091,.909091,.318182,.818182,.318182,.727273,.409091,.636364,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.681818,.681818,.681818,.0454545,.227273,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.681818,.545455,.727273,.409091,.727273,.318182,.681818,.181818,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.227273,1,.227273,.0454545,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.681818,1,.681818,.0454545,.181818,.409091,.727273,.409091,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.727273,.909091,.681818,.954545,.590909,1,.5,1,.409091,.954545,.363636,.909091,.318182,.818182,.318182,.0454545,.181818,.636364,.5,.636364,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.681818,.681818,.681818,-.0454545,.590909,-.227273,.5,-.272727,.409091,-.272727,.318182,-.227273,.272727,-.181818,.227273,1,.227273,.0454545,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.454545,1,.454545,.909091,.454545,.681818,.454545,.0454545,.681818,1,.681818,.909091,.681818,.681818,.681818,0,.590909,-.181818,.545455,-.227273,.454545,-.272727,.363636,-.272727,.272727,-.227273,.227273,-.181818,.181818,1,.181818,.0454545,.181818,.318182,.636364,.681818,.363636,.454545,.681818,.0454545,.454545,1,.454545,.0454545,0,.681818,0,.0454545,0,.5,.0454545,.590909,.0909091,.636364,.181818,.681818,.272727,.681818,.363636,.636364,.409091,.590909,.454545,.5,.454545,.0454545,.454545,.5,.5,.590909,.545455,.636364,.636364,.681818,.727273,.681818,.818182,.636364,.863636,.590909,.909091,.5,.909091,.0454545,.227273,.681818,.227273,.0454545,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.727273,.318182,.727273,.409091,.681818,.545455,.590909,.636364,.5,.681818,.227273,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.681818,.545455,.727273,.409091,.727273,.318182,.681818,.181818,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.227273,.681818,.227273,-.272727,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.181818,.409091,.181818,.318182,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.681818,.681818,.681818,-.272727,.227273,.681818,.227273,.0454545,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.545455,.272727,.5,.318182,.409091,.545455,.363636,.590909,.318182,.636364,.227273,.636364,.181818,.590909,.0909091,.5,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.454545,1,.454545,.0454545,.272727,.681818,.636364,.681818,.227273,.681818,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.681818,.681818,.227273,.681818,.0454545,.181818,.681818,.454545,.0454545,.727273,.681818,.0909091,.681818,.272727,.0454545,.454545,.636364,.636364,.0454545,.818182,.681818,.272727,.681818,.681818,.0454545,.636364,.681818,.227273,.0454545,.136364,.681818,.409091,.0909091,.818182,.681818,.318182,-.136364,.227273,-.227273,.136364,-.272727,.0454545,-.272727,.227273,.681818,.636364,.681818,.227273,.0454545,.681818,.0454545,.318182,.363636,.545455,.363636,.5,.909091,.409091,.863636,.363636,.818182,.363636,.727273,.454545,.636364,.5,.545455,.409091,.863636,.363636,.727273,.5,.636364,.454545,.5,.363636,.818182,.409091,.727273,.5,.636364,.5,.545455,.454545,.5,.363636,.454545,.454545,.409091,.5,.363636,.5,.272727,.409091,.181818,.363636,.0909091,.454545,.409091,.5,.272727,.363636,.181818,.409091,.0454545,.5,.363636,.454545,.272727,.363636,.181818,.363636,.0909091,.409091,.0454545,.5,0,.545455,.818182,.363636,.818182,.181818,.727273,.0909091,.545455,.0909091,.363636,.181818,.181818,.363636,.0909091,.545455,.0909091,.727273,.181818,.818182,.363636,.818182,.545455,.727273,.727273,.545455,.818182,.772727,1.09091,.136364,-.181818,.409091,.909091,.5,.863636,.545455,.818182,.545455,.727273,.454545,.636364,.409091,.545455,.5,.863636,.545455,.727273,.409091,.636364,.454545,.5,.545455,.818182,.5,.727273,.409091,.636364,.409091,.545455,.454545,.5,.545455,.454545,.454545,.409091,.409091,.363636,.409091,.272727,.5,.181818,.545455,.0909091,.454545,.409091,.409091,.272727,.545455,.181818,.5,.0454545,.409091,.363636,.454545,.272727,.545455,.181818,.545455,.0909091,.5,.0454545,.409091,0,.636364,.909091,.590909,.818182,.5,.818182,.409091,.954545,.318182,.954545,.272727,.863636,.454545,1,.454545,.318182,.454545,.136364,.454545,.0454545,.272727,1,.272727,.727273,.636364,1,.636364,.727273,.5,1.18182,.181818,-.272727,.772727,1.18182,.454545,-.272727,.181818,.590909,.818182,.590909,.136364,.318182,.772727,.318182,.772727,.863636,.545455,1,.363636,1,.136364,.863636,.136364,.681818,.363636,.545455,.681818,.454545,.772727,.363636,.772727,.136364,.545455,.0454545,.363636,.0454545,.136364,.136364,.454545,1.09091,.454545,-.0909091,.318182,.681818,.272727,.590909,.181818,.545455,.0909091,.590909,.0454545,.681818,.0909091,.772727,.181818,.818182,.272727,.772727,.318182,.681818,.681818,1,.227273,.0454545,.590909,.318182,.636364,.409091,.727273,.454545,.818182,.409091,.863636,.318182,.818182,.227273,.727273,.181818,.636364,.227273,.590909,.318182,.727273,.0454545,.318182,.681818,.272727,.772727,.272727,.863636,.318182,.954545,.409091,1,.454545,1,.545455,.954545,.590909,.863636,.590909,.772727,.545455,.681818,.5,.636364,.181818,.409091,.136364,.318182,.136364,.227273,.181818,.136364,.227273,.0909091,.318182,.0454545,.409091,.0454545,.5,.0909091,.545455,.136364,.772727,.409091,.454545,1,.454545,.727273,.545455,1,.454545,.909091,.409091,.818182,.363636,.636364,.363636,.318182,.409091,.136364,.454545,.0454545,.545455,-.0454545,.363636,1,.454545,.909091,.5,.818182,.545455,.636364,.545455,.318182,.5,.136364,.454545,.0454545,.363636,-.0454545,.454545,.727273,.454545,.181818,.227273,.590909,.681818,.318182,.681818,.590909,.227273,.318182,.227273,.363636,.681818,.363636,.454545,.590909,.454545,.136364,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.227273,.363636,.681818,.363636,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.681818,1,.227273,.0454545,.5,1,.590909,.954545,.636364,.863636,.681818,.727273,.681818,.318182,.636364,.181818,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.272727,.181818,.227273,.318182,.227273,.727273,.272727,.863636,.318182,.954545,.409091,1,.5,1,.318182,.727273,.590909,1,.590909,.0454545,.227273,.818182,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.636364,.636364,.545455,.227273,.0454545,.681818,.0454545,.227273,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.636364,.590909,.590909,.5,.545455,.318182,.545455,.5,.545455,.590909,.5,.636364,.454545,.681818,.363636,.681818,.227273,.636364,.136364,.590909,.0909091,.5,.0454545,.227273,.0454545,.409091,1,.181818,.227273,.727273,.227273,.545455,.0454545,.545455,.5,.681818,1,.227273,1,.227273,.545455,.5,.545455,.590909,.5,.636364,.454545,.681818,.363636,.681818,.227273,.636364,.136364,.590909,.0909091,.5,.0454545,.227273,.0454545,.590909,1,.409091,.909091,.318182,.818182,.272727,.681818,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.363636,.636364,.454545,.590909,.5,.5,.545455,.227273,.545455,.227273,1,.681818,1,.409091,.0454545,.409091,.545455,.681818,.545455,.409091,.545455,.318182,.590909,.272727,.727273,.272727,.818182,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.818182,.636364,.727273,.590909,.590909,.5,.545455,.409091,.545455,.318182,.5,.272727,.454545,.227273,.363636,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.363636,.636364,.454545,.590909,.5,.5,.545455,.681818,.636364,.636364,.545455,.590909,.5,.5,.454545,.409091,.454545,.318182,.5,.272727,.545455,.227273,.636364,.227273,.772727,.272727,.863636,.318182,.909091,.409091,.954545,.5,.954545,.590909,.909091,.636364,.863636,.681818,.772727,.681818,.545455,.636364,.363636,.590909,.227273,.5,.136364,.318182,.0454545,.454545,.5,.454545,.409091,.454545,.136364,.454545,.0454545,.454545,.5,.454545,.409091,.454545,.136364,.454545,-.136364,.681818,.727273,.227273,.454545,.681818,.181818,.227273,.181818,.681818,.181818,.227273,.454545,.681818,.454545,.227273,.727273,.681818,.454545,.227273,.181818,.227273,.954545,.318182,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.772727,.636364,.681818,.590909,.636364,.5,.590909,.454545,.5,.454545,.318182,.454545,.136364,.454545,.0454545,.0454545,.636364,.181818,1,.318182,.636364,.0909091,.772727,.272727,.772727,.363636,.681818,.363636,.318182,.590909,.318182,.590909,.363636,.863636,.363636,.727273,.363636,.727273,.0454545,.181818,.0454545,.454545,1,.727273,.0454545,.272727,.363636,.636364,.363636,.227273,1,.5,1,.636364,.909091,.681818,.818182,.681818,.681818,.636364,.590909,.590909,.545455,.681818,.454545,.727273,.363636,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.227273,.0454545,.227273,1,.227273,.545455,.590909,.545455,.681818,1,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.681818,.0454545,.227273,.0454545,.227273,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.227273,.636364,.136364,.590909,.0909091,.5,.0454545,.227273,.0454545,.636364,1,.227273,1,.227273,.0454545,.636364,.0454545,.227273,.545455,.545455,.545455,.636364,1,.227273,1,.227273,.0454545,.227273,.545455,.636364,.545455,.681818,1,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.681818,.0454545,.681818,.545455,.545455,.545455,.227273,1,.227273,.0454545,.227273,.545455,.681818,.545455,.681818,1,.681818,.0454545,.454545,1,.454545,.0454545,.590909,1,.590909,.227273,.545455,.136364,.5,.0909091,.409091,.0454545,.272727,.0454545,.227273,1,.227273,.0454545,.227273,.454545,.681818,1,.318182,.545455,.681818,.0454545,.272727,1,.272727,.0454545,.636364,.0454545,.181818,.0454545,.181818,1,.454545,.454545,.727273,1,.727273,.0454545,.227273,.0454545,.227273,1,.681818,.0454545,.681818,1,.363636,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.181818,.227273,.181818,.818182,.227273,.909091,.272727,.954545,.363636,1,.227273,.0454545,.227273,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.636364,.636364,.545455,.590909,.5,.5,.454545,.227273,.454545,.363636,1,.545455,1,.636364,.954545,.681818,.909091,.727273,.818182,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.181818,.227273,.181818,.818182,.227273,.909091,.272727,.954545,.363636,1,.5,.272727,.772727,.0454545,.227273,.0454545,.227273,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.636364,.636364,.545455,.590909,.5,.5,.454545,.227273,.454545,.5,.454545,.681818,.0454545,.681818,.954545,.590909,1,.363636,1,.272727,.954545,.227273,.863636,.227273,.772727,.272727,.681818,.545455,.5,.636364,.409091,.681818,.318182,.681818,.181818,.636364,.0909091,.545455,.0454545,.318182,.0454545,.227273,.0909091,.227273,1,.681818,1,.454545,1,.454545,.0454545,.227273,1,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,1,.181818,1,.454545,.0454545,.727273,1,.0909091,1,.272727,.0454545,.454545,.636364,.636364,.0454545,.818182,1,.181818,1,.727273,.0454545,.727273,1,.181818,.0454545,.181818,1,.454545,.454545,.727273,1,.454545,.454545,.454545,.0454545,.227273,1,.681818,1,.227273,.0454545,.681818,.0454545,.545455,1,.363636,1,.363636,-.0454545,.545455,-.0454545,.136364,.590909,.772727,.590909,.454545,.272727,.454545,.909091,.136364,.136364,.772727,.136364,.363636,1,.545455,1,.545455,-.0454545,.363636,-.0454545,.227273,.681818,.454545,.909091,.681818,.681818,0,0,.909091,0,.409091,.636364,.5,.636364,.590909,.727273,.590909,.818182,.5,.909091,.409091,.909091,.318182,.818182,.318182,.727273,.409091,.636364,.318182,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.227273,.227273,.227273,.272727,.318182,.363636,.409091,.409091,.681818,.409091,.227273,1,.227273,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.227273,.681818,.636364,.681818,.454545,.681818,.363636,.636364,.318182,.590909,.272727,.5,.272727,.227273,.318182,.136364,.363636,.0909091,.454545,.0454545,.636364,.0454545,.681818,1,.681818,.0454545,.409091,.0454545,.318182,.0909091,.272727,.136364,.227273,.227273,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.681818,.681818,.227273,.363636,.681818,.363636,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.681818,.0454545,.636364,1,.545455,1,.454545,.954545,.409091,.863636,.409091,.0454545,.318182,.681818,.636364,.681818,.681818,.0454545,.409091,.0454545,.318182,.0909091,.272727,.136364,.227273,.227273,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.681818,.681818,.681818,-.0454545,.636364,-.136364,.590909,-.181818,.5,-.227273,.227273,-.227273,.227273,1,.227273,.0454545,.227273,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.454545,1,.454545,.909091,.454545,.681818,.454545,.0454545,.454545,1,.454545,.909091,.454545,.681818,.454545,-.0454545,.409091,-.136364,.363636,-.181818,.272727,-.227273,.181818,-.227273,.227273,1,.227273,.0454545,.681818,.681818,.227273,.363636,.363636,.454545,.681818,.0454545,.363636,1,.363636,.227273,.409091,.136364,.454545,.0909091,.545455,.0454545,.136364,.0454545,.136364,.681818,.590909,.681818,.727273,.636364,.772727,.5,.772727,.0454545,.454545,.681818,.454545,.0454545,.227273,.0454545,.227273,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.0454545,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.227273,-.227273,.227273,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.227273,.636364,.136364,.590909,.0909091,.5,.0454545,.227273,.0454545,.681818,-.227273,.681818,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.681818,.0454545,.272727,.0454545,.272727,.681818,.454545,.681818,.545455,.636364,.636364,.545455,.636364,.5,.636364,.636364,.545455,.681818,.363636,.681818,.272727,.636364,.227273,.545455,.272727,.454545,.636364,.272727,.681818,.181818,.636364,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.409091,1,.409091,.0454545,.272727,.681818,.636364,.681818,.227273,.681818,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.681818,.0454545,.681818,.681818,.227273,.681818,.454545,.0454545,.681818,.681818,.136364,.681818,.318182,.0454545,.454545,.454545,.590909,.0454545,.772727,.681818,.227273,.681818,.681818,.0454545,.227273,.0454545,.681818,.681818,.227273,.681818,.454545,.0454545,.681818,.681818,.363636,-.136364,.318182,-.181818,.227273,-.227273,.227273,.681818,.681818,.681818,.227273,.0454545,.681818,.0454545,.5,.909091,.409091,.863636,.363636,.818182,.363636,.727273,.454545,.636364,.5,.545455,.409091,.863636,.363636,.727273,.5,.636364,.454545,.5,.363636,.818182,.409091,.727273,.5,.636364,.5,.545455,.454545,.5,.363636,.454545,.454545,.409091,.5,.363636,.5,.272727,.409091,.181818,.363636,.0909091,.454545,.409091,.5,.272727,.363636,.181818,.409091,.0454545,.5,.363636,.454545,.272727,.363636,.181818,.363636,.0909091,.409091,.0454545,.5,0,.545455,.818182,.363636,.818182,.181818,.727273,.0909091,.545455,.0909091,.363636,.181818,.181818,.363636,.0909091,.545455,.0909091,.727273,.181818,.818182,.363636,.818182,.545455,.727273,.727273,.545455,.818182,.772727,1.09091,.136364,-.181818,.409091,.909091,.5,.863636,.545455,.818182,.545455,.727273,.454545,.636364,.409091,.545455,.5,.863636,.545455,.727273,.409091,.636364,.454545,.5,.545455,.818182,.5,.727273,.409091,.636364,.409091,.545455,.454545,.5,.545455,.454545,.454545,.409091,.409091,.363636,.409091,.272727,.5,.181818,.545455,.0909091,.454545,.409091,.409091,.272727,.545455,.181818,.5,.0454545,.409091,.363636,.454545,.272727,.545455,.181818,.545455,.0909091,.5,.0454545,.409091,0,.636364,.909091,.590909,.818182,.5,.818182,.409091,.954545,.318182,.954545,.272727,.863636,.454545,1,.454545,.318182,.454545,.136364,.454545,.0454545,.272727,1,.272727,.727273,.636364,1,.636364,.727273,.5,1.18182,.181818,-.272727,.772727,1.18182,.454545,-.272727,.181818,.590909,.818182,.590909,.136364,.318182,.772727,.318182,.772727,.863636,.545455,1,.363636,1,.136364,.863636,.136364,.681818,.363636,.545455,.681818,.454545,.772727,.363636,.772727,.136364,.545455,.0454545,.363636,.0454545,.136364,.136364,.454545,1.09091,.454545,-.0909091,.318182,.681818,.272727,.590909,.181818,.545455,.0909091,.590909,.0454545,.681818,.0909091,.772727,.181818,.818182,.272727,.772727,.318182,.681818,.681818,1,.227273,.0454545,.590909,.318182,.636364,.409091,.727273,.454545,.818182,.409091,.863636,.318182,.818182,.227273,.727273,.181818,.636364,.227273,.590909,.318182,.727273,.5,.727273,.454545,.681818,.272727,.545455,.0909091,.454545,.0454545,.272727,.0454545,.181818,.0909091,.0909091,.227273,.0909091,.363636,.181818,.5,.454545,.681818,.5,.818182,.5,.909091,.454545,.954545,.363636,1,.318182,1,.227273,.954545,.181818,.909091,.181818,.818182,.272727,.636364,.409091,.454545,.590909,.227273,.681818,.136364,.772727,.0909091,.863636,.0909091,.454545,1,.454545,.727273,.545455,1,.454545,.909091,.409091,.818182,.363636,.636364,.363636,.318182,.409091,.136364,.454545,.0454545,.545455,-.0454545,.363636,1,.454545,.909091,.5,.818182,.545455,.636364,.545455,.318182,.5,.136364,.454545,.0454545,.363636,-.0454545,.454545,.727273,.454545,.181818,.227273,.590909,.681818,.318182,.681818,.590909,.227273,.318182,.227273,.363636,.681818,.363636,.454545,.590909,.454545,.136364,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.227273,.363636,.681818,.363636,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.681818,1,.227273,.0454545,.409091,1,.5,1,.590909,.954545,.636364,.863636,.681818,.681818,.681818,.363636,.636364,.181818,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.272727,.181818,.227273,.363636,.227273,.681818,.272727,.863636,.318182,.954545,.409091,1,.227273,.863636,.454545,1,.454545,.0454545,.272727,.0454545,.636364,.0454545,.227273,.772727,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.681818,.636364,.545455,.454545,.409091,.272727,.227273,.227273,.0909091,.227273,.0454545,.681818,.0454545,.227273,.863636,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.636364,.545455,.545455,.363636,.545455,.5,.545455,.590909,.5,.636364,.454545,.681818,.363636,.681818,.227273,.636364,.136364,.590909,.0909091,.5,.0454545,.363636,.0454545,.272727,.0909091,.181818,.181818,.590909,.0454545,.590909,1,.181818,.318182,.727273,.318182,.636364,1,.227273,1,.227273,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.454545,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.227273,.409091,.272727,.545455,.318182,.590909,.409091,.636364,.5,.636364,.590909,.590909,.636364,.545455,.681818,.409091,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.272727,.136364,.227273,.272727,.227273,.681818,.272727,.818182,.318182,.909091,.363636,.954545,.454545,1,.545455,1,.636364,.954545,.181818,1,.727273,1,.318182,.0454545,.409091,.545455,.318182,.590909,.272727,.636364,.227273,.727273,.227273,.818182,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.636364,.590909,.590909,.5,.545455,.409091,.545455,.272727,.454545,.227273,.409091,.181818,.318182,.181818,.227273,.227273,.136364,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.681818,.136364,.727273,.227273,.727273,.318182,.681818,.409091,.636364,.454545,.5,.545455,.681818,.681818,.636364,.545455,.590909,.5,.5,.454545,.409091,.454545,.318182,.5,.272727,.545455,.227273,.681818,.227273,.772727,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.772727,.681818,.363636,.636364,.227273,.590909,.136364,.545455,.0909091,.454545,.0454545,.363636,.0454545,.272727,.0909091,.454545,.5,.454545,.409091,.454545,.136364,.454545,.0454545,.454545,.5,.454545,.409091,.454545,.136364,.454545,-.136364,.681818,.727273,.227273,.454545,.681818,.181818,.227273,.181818,.681818,.181818,.227273,.454545,.681818,.454545,.227273,.727273,.681818,.454545,.227273,.181818,.227273,.954545,.318182,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.772727,.636364,.681818,.590909,.636364,.5,.590909,.454545,.5,.454545,.318182,.454545,.136364,.454545,.0454545,.0454545,.636364,.181818,1,.318182,.636364,.0909091,.772727,.272727,.772727,.363636,.681818,.363636,.318182,.590909,.318182,.590909,.363636,.863636,.363636,.727273,.363636,.727273,.0454545,.181818,.0454545,.454545,1,.727273,.0454545,.272727,.363636,.636364,.363636,.181818,.0454545,.181818,1,.454545,1,.636364,.954545,.681818,.818182,.681818,.727273,.636364,.590909,.5,.545455,.181818,.545455,.5,.545455,.636364,.5,.681818,.454545,.727273,.363636,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.181818,.0454545,.727273,.727273,.727273,.818182,.636364,.954545,.5,1,.409091,1,.272727,.954545,.181818,.818182,.136364,.636364,.136364,.409091,.181818,.227273,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.227273,.727273,.318182,.181818,.0454545,.181818,1,.409091,1,.545455,.954545,.636364,.863636,.681818,.681818,.681818,.363636,.636364,.181818,.545455,.0909091,.409091,.0454545,.181818,.0454545,.681818,1,.181818,1,.181818,.0454545,.681818,.0454545,.181818,.545455,.545455,.545455,.681818,1,.181818,1,.181818,.0454545,.181818,.545455,.545455,.545455,.727273,.772727,.727273,.818182,.636364,.954545,.5,1,.409091,1,.272727,.954545,.181818,.818182,.136364,.636364,.136364,.409091,.181818,.227273,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.227273,.772727,.409091,.772727,.454545,.5,.454545,.772727,.454545,.772727,.0454545,.181818,1,.181818,.0454545,.181818,.545455,.727273,.545455,.727273,1,.727273,.0454545,.454545,1,.454545,.0454545,.636364,1,.636364,.272727,.590909,.136364,.5,.0454545,.409091,.0454545,.318182,.136364,.272727,.272727,.181818,1,.181818,.0454545,.181818,.409091,.681818,1,.409091,.636364,.727273,.0454545,.227273,1,.227273,.0454545,.681818,.0454545,.136364,.0454545,.136364,1,.454545,.318182,.772727,1,.772727,.0454545,.181818,.0454545,.181818,1,.727273,.0454545,.727273,1,.409091,1,.272727,.954545,.181818,.818182,.136364,.636364,.136364,.409091,.181818,.227273,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.227273,.772727,.409091,.772727,.636364,.727273,.818182,.636364,.954545,.5,1,.409091,1,.181818,.0454545,.181818,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.681818,.636364,.590909,.590909,.545455,.5,.5,.181818,.5,.409091,1,.272727,.954545,.181818,.818182,.136364,.636364,.136364,.409091,.181818,.227273,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.227273,.772727,.409091,.772727,.636364,.727273,.818182,.636364,.954545,.5,1,.409091,1,.409091,.272727,.545455,.181818,.636364,0,.772727,-.0909091,.181818,.0454545,.181818,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.681818,.636364,.590909,.590909,.545455,.5,.5,.181818,.5,.5,.5,.681818,.0454545,.727273,.818182,.681818,.909091,.636364,.954545,.545455,1,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.727273,.272727,.636364,.318182,.590909,.409091,.545455,.545455,.5,.636364,.454545,.681818,.409091,.727273,.318182,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.363636,.0454545,.272727,.0909091,.227273,.136364,.181818,.227273,.181818,1,.772727,1,.454545,1,.454545,.0454545,.181818,1,.181818,.318182,.227273,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.181818,.727273,.318182,.727273,1,.181818,1,.454545,.0454545,.727273,1,.0454545,1,.227273,.0454545,.454545,1,.681818,.0454545,.863636,1,.227273,1,.727273,.0454545,.181818,.0454545,.681818,1,.181818,1,.454545,.5,.454545,.0454545,.454545,.5,.727273,1,.181818,1,.727273,1,.181818,.0454545,.727273,.0454545,.545455,1,.363636,1,.363636,-.0454545,.545455,-.0454545,.136364,.590909,.772727,.590909,.454545,.272727,.454545,.909091,.136364,.136364,.772727,.136364,.363636,1,.545455,1,.545455,-.0454545,.363636,-.0454545,.227273,.681818,.454545,.909091,.681818,.681818,0,0,.909091,0,.409091,.636364,.5,.636364,.590909,.727273,.590909,.818182,.5,.909091,.409091,.909091,.318182,.818182,.318182,.727273,.409091,.636364,.272727,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.545455,.636364,.136364,.681818,.0454545,.636364,.454545,.590909,.409091,.363636,.363636,.318182,.318182,.272727,.227273,.272727,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.227273,1,.227273,.0454545,.227273,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.454545,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.636364,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.681818,1,.681818,.0454545,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.227273,.363636,.636364,.363636,.636364,.454545,.590909,.590909,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.590909,1,.5,.954545,.454545,.909091,.454545,.0454545,.318182,.636364,.590909,.636364,.727273,.681818,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.545455,.272727,.409091,.318182,.318182,.409091,.272727,.5,.272727,.590909,.318182,.636364,.409091,.636364,.545455,.590909,.636364,.409091,.272727,.318182,.227273,.272727,.181818,.272727,.136364,.409091,.0909091,.363636,.0909091,.545455,.0909091,.681818,.0454545,.727273,-.0454545,.727273,-.0909091,.681818,-.181818,.545455,-.227273,.363636,-.227273,.227273,-.181818,.181818,-.0909091,.181818,-.0454545,.227273,.0454545,.363636,.0909091,.272727,1,.272727,.0454545,.272727,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.545455,.636364,.0454545,.454545,1,.454545,.909091,.454545,.681818,.454545,.0454545,.545455,1,.545455,.909091,.545455,.681818,.545455,-.0909091,.5,-.181818,.409091,-.227273,.363636,-.227273,.272727,1,.272727,.0454545,.272727,.318182,.636364,.681818,.454545,.454545,.681818,.0454545,.454545,1,.454545,.0454545,.0909091,.681818,.0909091,.0454545,.0909091,.545455,.136364,.636364,.227273,.681818,.318182,.681818,.409091,.636364,.454545,.545455,.454545,.0454545,.454545,.545455,.5,.636364,.590909,.681818,.681818,.681818,.772727,.636364,.818182,.545455,.818182,.0454545,.272727,.681818,.272727,.0454545,.272727,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.545455,.636364,.0454545,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.272727,.681818,.454545,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.227273,.681818,.227273,-.227273,.227273,.545455,.318182,.636364,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.454545,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.227273,.181818,.681818,.681818,.681818,-.227273,.681818,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.318182,.681818,.318182,.0454545,.318182,.454545,.363636,.545455,.454545,.636364,.545455,.681818,.590909,.681818,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.545455,.272727,.5,.318182,.409091,.590909,.318182,.636364,.227273,.636364,.181818,.590909,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.272727,.136364,.454545,1,.454545,.136364,.5,.0454545,.590909,.0454545,.636364,.0909091,.363636,.681818,.590909,.681818,.272727,.681818,.272727,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.636364,.681818,.636364,.0454545,.272727,.681818,.454545,.0454545,.636364,.681818,.136364,.681818,.272727,.0454545,.454545,.681818,.636364,.0454545,.772727,.681818,.272727,.681818,.681818,.0454545,.227273,.0454545,.636364,.681818,.272727,.681818,.454545,.0454545,.636364,.681818,.454545,.0454545,.409091,-.0909091,.363636,-.181818,.272727,-.227273,.272727,.681818,.636364,.681818,.272727,.0454545,.636364,.0454545,.5,.909091,.409091,.863636,.363636,.818182,.363636,.727273,.454545,.636364,.5,.545455,.409091,.863636,.363636,.727273,.5,.636364,.454545,.5,.363636,.818182,.409091,.727273,.5,.636364,.5,.545455,.454545,.5,.363636,.454545,.454545,.409091,.5,.363636,.5,.272727,.409091,.181818,.363636,.0909091,.454545,.409091,.5,.272727,.363636,.181818,.409091,.0454545,.5,.363636,.454545,.272727,.363636,.181818,.363636,.0909091,.409091,.0454545,.5,0,.545455,.818182,.363636,.818182,.181818,.727273,.0909091,.545455,.0909091,.363636,.181818,.181818,.363636,.0909091,.545455,.0909091,.727273,.181818,.818182,.363636,.818182,.545455,.727273,.727273,.545455,.818182,.772727,1.09091,.136364,-.181818,.409091,.909091,.5,.863636,.545455,.818182,.545455,.727273,.454545,.636364,.409091,.545455,.5,.863636,.545455,.727273,.409091,.636364,.454545,.5,.545455,.818182,.5,.727273,.409091,.636364,.409091,.545455,.454545,.5,.545455,.454545,.454545,.409091,.409091,.363636,.409091,.272727,.5,.181818,.545455,.0909091,.454545,.409091,.409091,.272727,.545455,.181818,.5,.0454545,.409091,.363636,.454545,.272727,.545455,.181818,.545455,.0909091,.5,.0454545,.409091,0,.636364,.909091,.590909,.818182,.5,.818182,.409091,.954545,.318182,.954545,.272727,.863636,.454545,1,.5,.909091,.454545,.318182,.409091,.909091,.454545,1,.454545,.545455,.454545,.136364,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.454545,.0454545,.318182,1,.318182,.772727,.590909,1,.590909,.772727,.363636,.863636,.363636,.136364,.227273,.409091,.681818,.409091,.545455,.136364,.545455,.863636,.681818,.681818,.227273,.681818,.681818,.727273,.636364,.863636,.545455,.909091,.363636,.909091,.272727,.818182,.227273,.727273,.227273,.636364,.272727,.590909,.636364,.454545,.681818,.409091,.681818,.318182,.636364,.227273,.545455,.136364,.363636,.136364,.272727,.181818,.227273,.318182,.409091,.0454545,.409091,1,.5,1,.5,.0454545,.727273,1,.181818,.0909091,.590909,.181818,.636364,.181818,.727273,.272727,.727273,.363636,.636364,.454545,.590909,.454545,.5,.363636,.5,.272727,.590909,.181818,.363636,.681818,.318182,.681818,.227273,.772727,.227273,.863636,.318182,.954545,.363636,.954545,.454545,.863636,.454545,.772727,.363636,.681818,.681818,.0454545,.454545,.409091,.409091,.590909,.318182,.636364,.272727,.727273,.272727,.818182,.318182,.954545,.363636,1,.454545,1,.5,.954545,.545455,.818182,.545455,.727273,.5,.636364,.363636,.636364,.272727,.545455,.227273,.454545,.181818,.318182,.181818,.181818,.227273,.0909091,.318182,.0454545,.454545,.0454545,.545455,.0909091,.681818,.227273,.727273,.318182,.727273,.363636,.409091,.636364,.5,.909091,.545455,1.09091,.454545,1.04545,.363636,.954545,.318182,.863636,.318182,.181818,.363636,.0909091,.454545,0,.545455,-.0454545,.363636,1.09091,.454545,1.04545,.545455,.954545,.590909,.863636,.590909,.181818,.545455,.0909091,.454545,0,.363636,-.0454545,.454545,.772727,.454545,.318182,.727273,.272727,.181818,.818182,.727273,.818182,.181818,.272727,.227273,.545455,.681818,.545455,.272727,.5,.636364,.5,.454545,.681818,.454545,.318182,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.272727,.5,.636364,.5,.409091,0,.409091,.0909091,.5,.0909091,.5,0,.409091,0,.681818,.954545,.227273,.0909091,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.818182,.636364,.909091,.590909,.954545,.5,1,.409091,1,.363636,.818182,.5,1,.5,.0454545,.181818,.772727,.227273,.909091,.272727,.954545,.409091,1,.5,1,.636364,.954545,.681818,.909091,.727273,.772727,.727273,.681818,.181818,.0454545,.727273,.0454545,.136364,1,.636364,1,.727273,.954545,.772727,.863636,.772727,.772727,.727273,.681818,.636364,.636364,.409091,.636364,.636364,.636364,.727273,.590909,.772727,.5,.772727,.181818,.727273,.0909091,.636364,.0454545,.136364,.0454545,.454545,1,.136364,.318182,.772727,.318182,.545455,.590909,.545455,.0454545,.772727,1,.136364,1,.136364,.545455,.590909,.545455,.681818,.5,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.590909,.0454545,.136364,.0454545,.545455,1,.409091,.954545,.318182,.909091,.227273,.818182,.181818,.727273,.136364,.590909,.136364,.227273,.181818,.0909091,.318182,.0454545,.590909,.0454545,.727273,.0909091,.772727,.227273,.772727,.363636,.727273,.5,.590909,.545455,.136364,.545455,.136364,1,.772727,1,.409091,.0454545,.545455,1,.681818,.954545,.727273,.818182,.727273,.772727,.681818,.636364,.545455,.590909,.363636,.590909,.227273,.636364,.181818,.772727,.181818,.818182,.227273,.954545,.363636,1,.545455,1,.590909,.590909,.727273,.545455,.772727,.409091,.772727,.227273,.727273,.0909091,.590909,.0454545,.318182,.0454545,.181818,.0909091,.136364,.227273,.136364,.409091,.181818,.545455,.318182,.590909,.772727,.5,.318182,.5,.181818,.545455,.136364,.681818,.136364,.818182,.181818,.954545,.318182,1,.590909,1,.727273,.954545,.772727,.818182,.772727,.454545,.727273,.318182,.681818,.227273,.590909,.136364,.5,.0909091,.363636,.0454545,.318182,.0454545,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.636364,.818182,.227273,.5,.636364,.181818,.272727,.545455,.636364,.545455,.636364,.409091,.272727,.409091,.272727,.818182,.681818,.5,.272727,.181818,.227273,.772727,.227273,.818182,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.636364,.590909,.590909,.454545,.5,.454545,.227273,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.0454545,.636364,.772727,.545455,.772727,.454545,.727273,.409091,.636364,.409091,.545455,.454545,.454545,.545455,.409091,.636364,.409091,.727273,.454545,.772727,.545455,.772727,.636364,.727273,.727273,.590909,.863636,.5,.909091,.363636,.909091,.272727,.863636,.181818,.772727,.136364,.681818,.136364,.5,.181818,.409091,.272727,.272727,.318182,.227273,.454545,.136364,.545455,.136364,.636364,.181818,.727273,.272727,.136364,.0454545,.454545,1,.772727,.0454545,.272727,.454545,.636364,.454545,.136364,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.545455,.545455,.136364,.545455,.545455,.545455,.636364,.5,.681818,.454545,.727273,.363636,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.136364,.0454545,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.181818,1,.181818,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.181818,1,.772727,1,.136364,1,.136364,.0454545,.772727,.0454545,.136364,.545455,.545455,.545455,.772727,1,.136364,1,.136364,.0454545,.136364,.545455,.545455,.545455,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.727273,.409091,.5,.409091,.136364,1,.136364,.0454545,.136364,.5,.772727,.5,.772727,1,.772727,.0454545,.227273,1,.681818,1,.454545,1,.454545,.0454545,.227273,.0454545,.681818,.0454545,.727273,1,.727273,.272727,.681818,.136364,.636364,.0909091,.5,.0454545,.409091,.0454545,.272727,.0909091,.227273,.136364,.181818,.272727,.136364,1,.136364,.0454545,.136364,.454545,.727273,1,.318182,.590909,.772727,.0454545,.136364,1,.136364,.0454545,.772727,.0454545,.136364,.0454545,.136364,1,.454545,.5,.772727,1,.772727,.0454545,.136364,.0454545,.136364,1,.772727,.0454545,.772727,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.318182,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.136364,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.545455,.545455,.136364,.545455,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.318182,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.545455,.272727,.772727,.0454545,.136364,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.545455,.545455,.136364,.545455,.545455,.545455,.772727,.0454545,.727273,.772727,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.272727,.954545,.181818,.818182,.181818,.727273,.272727,.590909,.363636,.545455,.590909,.545455,.681818,.5,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.590909,.0454545,.318182,.0454545,.181818,.136364,.136364,.227273,.136364,1,.772727,1,.454545,1,.454545,.0454545,.181818,1,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.727273,1,.136364,1,.454545,.0454545,.772727,1,.0454545,1,.272727,.0454545,.454545,1,.636364,.0454545,.863636,1,.136364,1,.772727,.0454545,.136364,.0454545,.772727,1,.136364,1,.454545,.454545,.454545,.0454545,.454545,.454545,.772727,1,.136364,1,.772727,1,.136364,.0454545,.772727,.0454545,.636364,1.09091,.318182,1.09091,.318182,-.0454545,.636364,-.0454545,.0454545,1.18182,.863636,-.272727,.272727,1.09091,.590909,1.09091,.590909,-.0454545,.272727,-.0454545,.0909091,.545455,.454545,1,.818182,.545455,0,0,.909091,0,.409091,.909091,.363636,.909091,.5,.636364,.545455,.636364,.409091,.909091,.818182,.727273,.0909091,.318182,.818182,.318182,.454545,.818182,.818182,.818182,.818182,.227273,.0909091,.227273,.0909091,.818182,.454545,.818182,.454545,.954545,.454545,.0909091,.0454545,.227273,.272727,.681818,.863636,.681818,.636364,.227273,.0454545,.227273,.0454545,.363636,.0454545,.409091,.0909091,.590909,.136364,.681818,.181818,.727273,.363636,.818182,.545455,.818182,.727273,.727273,.772727,.681818,.818182,.590909,.863636,.409091,.863636,.363636,.0454545,.363636,.409091,.863636,.5,.863636,.636364,.818182,.772727,.681818,.818182,.545455,.818182,.454545,.772727,.318182,.636364,.181818,.5,.136364,.409091,.136364,.272727,.181818,.136364,.318182,.0909091,.454545,.0909091,.545455,.136364,.681818,.272727,.818182,.409091,.863636,.454545,.863636,.0909091,.136364,.772727,.863636,.409091,.136364,.409091,.772727,.5,.772727,.590909,.727273,.636364,.681818,.681818,.590909,.681818,.5,.636364,.409091,.590909,.363636,.5,.318182,.409091,.318182,.318182,.363636,.272727,.409091,.227273,.5,.227273,.590909,.272727,.681818,.318182,.727273,.409091,.772727,.318182,.863636,.0454545,.136364,.545455,.136364,.818182,.863636,.0454545,.0909091,.863636,.909091,.318182,.590909,.545455,.363636,.863636,.909091,.181818,.772727,.727273,.772727,.863636,.5,.0454545,.5,.181818,.227273,.727273,.227273,.409091,.727273,.5,.727273,.590909,.681818,.636364,.636364,.681818,.545455,.681818,.454545,.636364,.363636,.590909,.318182,.5,.272727,.409091,.272727,.318182,.318182,.272727,.363636,.227273,.454545,.227273,.545455,.272727,.636364,.318182,.681818,.409091,.727273,.454545,.863636,.454545,.136364,.0909091,.5,.818182,.5,.0454545,.363636,.0454545,.409091,.0909091,.590909,.136364,.681818,.181818,.727273,.363636,.818182,.545455,.818182,.727273,.727273,.772727,.681818,.818182,.590909,.863636,.409091,.863636,.363636,.0909091,.136364,.818182,.136364,.454545,.136364,.454545,.909091,.409091,.863636,.5,.863636,.636364,.818182,.772727,.681818,.818182,.545455,.818182,.454545,.772727,.318182,.636364,.181818,.5,.136364,.409091,.136364,.272727,.181818,.136364,.318182,.0909091,.454545,.0909091,.545455,.136364,.681818,.272727,.818182,.363636,.863636,.318182,.318182,.318182,.681818,.454545,.5,.590909,.681818,.590909,.318182,.409091,.727273,.5,.727273,.590909,.681818,.636364,.636364,.681818,.545455,.681818,.454545,.636364,.363636,.590909,.318182,.5,.272727,.409091,.272727,.318182,.318182,.272727,.363636,.227273,.454545,.227273,.545455,.272727,.636364,.318182,.681818,.409091,.727273,.636364,.863636,.272727,.136364,.409091,.727273,.5,.727273,.590909,.681818,.636364,.636364,.681818,.545455,.681818,.454545,.636364,.363636,.590909,.318182,.5,.272727,.409091,.272727,.318182,.318182,.272727,.363636,.227273,.454545,.227273,.545455,.272727,.636364,.318182,.681818,.409091,.727273,.409091,.863636,.5,.863636,.636364,.818182,.772727,.681818,.818182,.545455,.818182,.454545,.772727,.318182,.636364,.181818,.5,.136364,.409091,.136364,.272727,.181818,.136364,.318182,.0909091,.454545,.0909091,.545455,.136364,.681818,.272727,.818182,.363636,.863636,.318182,.318182,.318182,.318182,.318182,.681818,.545455,.681818,.590909,.636364,.590909,.545455,.545455,.5,.318182,.5,.318182,1,.318182,.0454545,.772727,.0454545,.5,.363636,.454545,.272727,.409091,.227273,.227273,.227273,.181818,.272727,.136364,.363636,.136364,.636364,.181818,.727273,.227273,.772727,.409091,.772727,.454545,.727273,.5,.636364,.409091,.863636,.5,.863636,.636364,.818182,.772727,.681818,.818182,.545455,.818182,.454545,.772727,.318182,.636364,.181818,.5,.136364,.409091,.136364,.272727,.181818,.136364,.318182,.0909091,.454545,.0909091,.545455,.136364,.681818,.272727,.818182,.409091,.863636,.409091,.727273,.5,.727273,.590909,.681818,.636364,.636364,.681818,.545455,.681818,.454545,.636364,.363636,.590909,.318182,.5,.272727,.409091,.272727,.318182,.318182,.272727,.363636,.227273,.454545,.227273,.545455,.272727,.636364,.318182,.681818,.409091,.727273,.409091,.863636,.5,.863636,.636364,.818182,.772727,.681818,.818182,.545455,.818182,.454545,.772727,.318182,.636364,.181818,.5,.136364,.409091,.136364,.272727,.181818,.136364,.318182,.0909091,.454545,.0909091,.545455,.136364,.681818,.272727,.818182,.409091,.863636,.545455,.590909,.5,.681818,.409091,.681818,.363636,.590909,.363636,.545455,.545455,.454545,.545455,.409091,.5,.318182,.409091,.318182,.363636,.409091,.454545,.818182,.818182,.818182,.818182,.227273,.0909091,.227273,.0909091,.818182,.454545,.818182,.454545,.545455,.454545,.863636,.5,.863636,.636364,.818182,.772727,.681818,.818182,.545455,.818182,.454545,.772727,.318182,.636364,.181818,.5,.136364,.409091,.136364,.272727,.181818,.136364,.318182,.0909091,.454545,.0909091,.545455,.136364,.681818,.272727,.818182,.409091,.863636,.454545,.863636,.454545,.5,.454545,.909091,.0454545,.0909091,.863636,.0909091,.454545,.909091,.454545,.454545,.454545,.909091,.863636,.5,.454545,.0909091,.0454545,.5,.454545,.909091,.454545,.5,.454545,.0454545,.454545,1,.0909091,.363636,.818182,.363636,.454545,1,.636364,.0454545,.0909091,1,.818182,1,.272727,.0454545,.136364,1,.454545,.454545,.454545,.0454545,.454545,.454545,.772727,1,.681818,1.09091,.590909,1.09091,.454545,1.04545,.409091,1,.363636,.863636,.363636,.681818,.318182,.590909,.272727,.545455,.318182,.5,.363636,.409091,.363636,.181818,.409091,.0454545,.454545,0,.590909,-.0454545,.681818,-.0454545,.454545,1.18182,.454545,-.272727,.227273,1.09091,.318182,1.09091,.454545,1.04545,.5,1,.545455,.863636,.545455,.681818,.590909,.590909,.636364,.545455,.590909,.5,.545455,.409091,.545455,.181818,.5,.0454545,.454545,0,.363636,-.0454545,.272727,-.0454545,.0454545,.545455,.0909091,.590909,.181818,.636364,.272727,.636364,.636364,.454545,.727273,.454545,.818182,.5,.863636,.545455,.454545,1,.409091,.954545,.409091,.863636,.454545,.5,.454545,1,.454545,.363636,.5,.363636,.454545,1,.5,1,.5,.363636,.5,1,.545455,.954545,.545455,.863636,.5,.5,.454545,.181818,.409091,.136364,.409091,.0909091,.454545,.0454545,.5,.0454545,.545455,.0909091,.545455,.136364,.5,.181818,.454545,.181818,.454545,.136364,.454545,.0909091,.5,.0909091,.5,.136364,.454545,.136364,.272727,1,.227273,.954545,.227273,.681818,.272727,.954545,.227273,.681818,.272727,1,.318182,.954545,.227273,.681818,.681818,1,.636364,.954545,.636364,.681818,.681818,.954545,.636364,.681818,.681818,1,.727273,.954545,.636364,.681818,.181818,.636364,.818182,.636364,.818182,.590909,.181818,.590909,.181818,.636364,.454545,1.04545,.5,1.04545,.181818,-.272727,.136364,-.272727,.454545,1.04545,.772727,1.04545,.818182,1.04545,.5,-.272727,.454545,-.272727,.772727,1.04545,.136364,.227273,.136364,.272727,.772727,.272727,.772727,.227273,.136364,.227273,.363636,1.18182,.363636,-.136364,.545455,1.18182,.545455,-.136364,.727273,.772727,.727273,.818182,.681818,.818182,.681818,.727273,.772727,.727273,.772727,.818182,.727273,.909091,.681818,.954545,.545455,1,.363636,1,.227273,.954545,.136364,.863636,.136364,.727273,.181818,.636364,.318182,.545455,.590909,.454545,.681818,.409091,.727273,.318182,.727273,.181818,.681818,.0909091,.181818,.727273,.227273,.636364,.318182,.590909,.590909,.5,.681818,.454545,.727273,.363636,.227273,.954545,.181818,.863636,.181818,.772727,.227273,.681818,.318182,.636364,.590909,.545455,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.181818,.136364,.136364,.227273,.136364,.318182,.227273,.318182,.227273,.227273,.181818,.227273,.181818,.272727,.727273,.772727,.181818,.181818,.318182,.772727,.363636,.727273,.363636,.636364,.318182,.590909,.227273,.590909,.181818,.636364,.181818,.727273,.227273,.772727,.318182,.772727,.5,.727273,.636364,.727273,.727273,.772727,.590909,.363636,.545455,.318182,.545455,.227273,.590909,.181818,.681818,.181818,.727273,.227273,.727273,.318182,.681818,.363636,.590909,.363636,.590909,.409091,.681818,.409091,.772727,.318182,.772727,.227273,.681818,.136364,.590909,.136364,.5,.227273,.5,.318182,.590909,.409091,.227273,.818182,.136364,.727273,.136364,.636364,.227273,.545455,.318182,.545455,.409091,.636364,.409091,.727273,.318182,.818182,.227273,.818182,.863636,.590909,.863636,.636364,.818182,.636364,.818182,.545455,.909091,.545455,.909091,.636364,.863636,.681818,.818182,.681818,.772727,.636364,.727273,.545455,.636364,.318182,.545455,.181818,.454545,.0909091,.363636,.0454545,.181818,.0454545,.0909091,.0909091,.0454545,.181818,.0454545,.318182,.0909091,.409091,.363636,.590909,.454545,.681818,.5,.772727,.5,.863636,.454545,.954545,.363636,1,.272727,.954545,.227273,.863636,.227273,.727273,.272727,.590909,.363636,.454545,.545455,.227273,.681818,.0909091,.772727,.0454545,.863636,.0454545,.909091,.136364,.909091,.181818,.136364,.0909091,.0909091,.181818,.0909091,.318182,.136364,.409091,.181818,.454545,.454545,.681818,.5,.863636,.5,.772727,.454545,.954545,.272727,.954545,.227273,.772727,.272727,.636364,.363636,.5,.545455,.272727,.681818,.136364,.772727,.0909091,.272727,.0454545,.181818,.0909091,.136364,.181818,.136364,.318182,.181818,.409091,.363636,.590909,.227273,.863636,.272727,.681818,.409091,.5,.590909,.272727,.727273,.136364,.818182,.0909091,.863636,.0909091,.909091,.136364,.5,1,.454545,.954545,.454545,.681818,.5,.954545,.454545,.681818,.5,1,.545455,.954545,.454545,.681818,.590909,1.18182,.5,1.09091,.409091,.954545,.318182,.772727,.272727,.545455,.272727,.363636,.318182,.136364,.409091,-.0454545,.5,-.181818,.590909,-.272727,.409091,.909091,.363636,.772727,.318182,.590909,.318182,.318182,.363636,.136364,.409091,0,.5,1.09091,.454545,1,.409091,.863636,.363636,.590909,.363636,.318182,.409091,.0454545,.454545,-.0909091,.5,-.181818,.318182,1.18182,.409091,1.09091,.5,.954545,.590909,.772727,.636364,.545455,.636364,.363636,.590909,.136364,.5,-.0454545,.409091,-.181818,.318182,-.272727,.5,.909091,.545455,.772727,.590909,.590909,.590909,.318182,.545455,.136364,.5,0,.409091,1.09091,.454545,1,.5,.863636,.545455,.590909,.545455,.318182,.5,.0454545,.454545,-.0909091,.409091,-.181818,.454545,1,.409091,.954545,.5,.5,.454545,.454545,.454545,1,.454545,.454545,.454545,1,.5,.954545,.409091,.5,.454545,.454545,.227273,.863636,.272727,.863636,.636364,.590909,.681818,.590909,.227273,.863636,.681818,.590909,.227273,.863636,.227273,.818182,.681818,.636364,.681818,.590909,.681818,.863636,.636364,.863636,.272727,.590909,.227273,.590909,.681818,.863636,.227273,.590909,.681818,.863636,.681818,.818182,.227273,.636364,.227273,.590909,.454545,.863636,.454545,.0909091,.5,.0909091,.454545,.863636,.5,.863636,.5,.0909091,.0909091,.5,.863636,.5,.863636,.454545,.0909091,.5,.0909091,.454545,.863636,.454545,.545455,.0909091,.5,.0454545,.454545,.0454545,.409091,.0909091,.409091,.136364,.454545,.181818,.5,.181818,.545455,.136364,.545455,0,.5,-.0909091,.409091,-.136364,.454545,.136364,.454545,.0909091,.5,.0909091,.5,.136364,.454545,.136364,.5,.0454545,.545455,0,.545455,.0909091,.5,-.0909091,.0909091,.5,.863636,.5,.863636,.454545,.0909091,.5,.0909091,.454545,.863636,.454545,.454545,.181818,.409091,.136364,.409091,.0909091,.454545,.0454545,.5,.0454545,.545455,.0909091,.545455,.136364,.5,.181818,.454545,.181818,.454545,.136364,.454545,.0909091,.5,.0909091,.5,.136364,.454545,.136364,.863636,1.18182,.0454545,-.272727,.0909091,-.272727,.863636,1.18182,.909091,1.18182,.0909091,-.272727,.409091,1,.272727,.954545,.181818,.818182,.136364,.590909,.136364,.454545,.181818,.227273,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.227273,.772727,.454545,.772727,.590909,.727273,.818182,.636364,.954545,.5,1,.409091,1,.272727,.909091,.227273,.818182,.181818,.636364,.181818,.409091,.227273,.227273,.272727,.136364,.636364,.136364,.681818,.227273,.727273,.409091,.727273,.636364,.681818,.818182,.636364,.909091,.409091,1,.318182,.954545,.272727,.863636,.227273,.636364,.227273,.409091,.272727,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.681818,.409091,.681818,.636364,.636364,.863636,.590909,.954545,.5,1,.409091,.909091,.409091,.0454545,.454545,.909091,.454545,.0909091,.5,1,.5,.0454545,.5,1,.363636,.863636,.272727,.818182,.227273,.0454545,.681818,.0454545,.409091,.0909091,.318182,.0454545,.409091,.136364,.363636,.0454545,.5,.136364,.545455,.0454545,.5,.0909091,.590909,.0454545,.181818,.818182,.181818,.772727,.227273,.772727,.227273,.818182,.181818,.818182,.181818,.863636,.227273,.863636,.272727,.818182,.272727,.772727,.227273,.727273,.181818,.727273,.136364,.772727,.136364,.818182,.181818,.909091,.227273,.954545,.363636,1,.545455,1,.681818,.954545,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.590909,.545455,.363636,.454545,.272727,.409091,.181818,.318182,.136364,.181818,.136364,.0454545,.681818,.909091,.727273,.818182,.727273,.727273,.681818,.636364,.545455,1,.636364,.954545,.681818,.818182,.681818,.727273,.636364,.636364,.545455,.545455,.363636,.454545,.136364,.136364,.181818,.181818,.272727,.181818,.5,.136364,.681818,.136364,.772727,.181818,.272727,.181818,.5,.0909091,.681818,.0909091,.727273,.136364,.272727,.181818,.5,.0454545,.681818,.0454545,.727273,.0909091,.772727,.181818,.772727,.272727,.181818,.818182,.181818,.772727,.227273,.772727,.227273,.818182,.181818,.818182,.181818,.863636,.227273,.863636,.272727,.818182,.272727,.772727,.227273,.727273,.181818,.727273,.136364,.772727,.136364,.818182,.181818,.909091,.227273,.954545,.363636,1,.545455,1,.681818,.954545,.727273,.863636,.727273,.727273,.681818,.636364,.545455,.590909,.636364,.954545,.681818,.863636,.681818,.727273,.636364,.636364,.5,1,.590909,.954545,.636364,.863636,.636364,.727273,.590909,.636364,.5,.590909,.409091,.590909,.545455,.590909,.636364,.545455,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.545455,.0454545,.363636,.0454545,.227273,.0909091,.181818,.136364,.136364,.227273,.136364,.272727,.181818,.318182,.227273,.318182,.272727,.272727,.272727,.227273,.227273,.181818,.181818,.181818,.681818,.454545,.727273,.363636,.727273,.227273,.681818,.136364,.5,.590909,.590909,.545455,.636364,.5,.681818,.363636,.681818,.227273,.636364,.0909091,.545455,.0454545,.181818,.272727,.181818,.227273,.227273,.227273,.227273,.272727,.181818,.272727,.5,.863636,.5,.0454545,.545455,.909091,.545455,.0909091,.590909,1,.590909,.0454545,.590909,1,.0909091,.318182,.818182,.318182,.363636,.0454545,.727273,.0454545,.5,.0909091,.409091,.0454545,.5,.136364,.454545,.0454545,.590909,.136364,.636364,.0454545,.590909,.0909091,.681818,.0454545,.227273,1,.136364,.545455,.227273,.636364,.363636,.681818,.5,.681818,.636364,.636364,.727273,.545455,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.363636,.0454545,.227273,.0909091,.181818,.136364,.136364,.227273,.136364,.272727,.181818,.318182,.227273,.318182,.272727,.272727,.272727,.227273,.227273,.181818,.181818,.181818,.681818,.545455,.727273,.454545,.727273,.272727,.681818,.181818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.454545,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.181818,.272727,.181818,.227273,.227273,.227273,.227273,.272727,.181818,.272727,.227273,1,.681818,1,.227273,.954545,.590909,.954545,.227273,.909091,.409091,.909091,.590909,.954545,.681818,1,.636364,.863636,.636364,.818182,.681818,.818182,.681818,.863636,.636364,.863636,.681818,.909091,.636364,.909091,.590909,.863636,.590909,.818182,.636364,.772727,.681818,.772727,.727273,.818182,.727273,.863636,.681818,.954545,.590909,1,.454545,1,.318182,.954545,.227273,.863636,.181818,.772727,.136364,.590909,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.318182,.772727,.363636,.727273,.5,.636364,.590909,.5,.636364,.409091,.636364,.318182,.590909,.272727,.545455,.227273,.454545,.272727,.863636,.227273,.772727,.181818,.590909,.181818,.318182,.227273,.181818,.272727,.136364,.681818,.181818,.727273,.272727,.727273,.409091,.681818,.5,.454545,1,.363636,.954545,.318182,.909091,.272727,.818182,.227273,.636364,.227273,.318182,.272727,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.272727,.681818,.409091,.636364,.545455,.590909,.590909,.5,.636364,.136364,1,.136364,.727273,.772727,1,.772727,.863636,.727273,.727273,.545455,.5,.5,.409091,.454545,.227273,.454545,.0454545,.5,.454545,.454545,.363636,.409091,.227273,.409091,.0454545,.727273,.727273,.5,.5,.409091,.363636,.363636,.227273,.363636,.0454545,.454545,.0454545,.136364,.818182,.181818,.909091,.272727,1,.363636,1,.590909,.863636,.681818,.863636,.727273,.909091,.772727,1,.227273,.909091,.272727,.954545,.363636,.954545,.454545,.909091,.136364,.818182,.181818,.863636,.272727,.909091,.363636,.909091,.590909,.863636,.363636,1,.227273,.954545,.181818,.863636,.181818,.727273,.227273,.636364,.363636,.590909,.545455,.590909,.681818,.636364,.727273,.727273,.727273,.863636,.681818,.954545,.545455,1,.363636,1,.272727,.954545,.227273,.863636,.227273,.727273,.272727,.636364,.636364,.636364,.681818,.727273,.681818,.863636,.636364,.954545,.363636,1,.318182,.954545,.272727,.863636,.272727,.727273,.318182,.636364,.363636,.590909,.545455,.590909,.590909,.636364,.636364,.727273,.636364,.863636,.590909,.954545,.545455,1,.363636,.590909,.227273,.545455,.181818,.5,.136364,.409091,.136364,.227273,.181818,.136364,.227273,.0909091,.363636,.0454545,.545455,.0454545,.681818,.0909091,.727273,.136364,.772727,.227273,.772727,.409091,.727273,.5,.681818,.545455,.545455,.590909,.227273,.5,.181818,.409091,.181818,.227273,.227273,.136364,.681818,.136364,.727273,.227273,.727273,.409091,.681818,.5,.363636,.590909,.272727,.545455,.227273,.409091,.227273,.227273,.272727,.0909091,.363636,.0454545,.545455,.0454545,.636364,.0909091,.681818,.227273,.681818,.409091,.636364,.545455,.545455,.590909,.227273,.227273,.227273,.181818,.272727,.181818,.272727,.227273,.227273,.227273,.681818,.590909,.636364,.5,.590909,.454545,.5,.409091,.409091,.409091,.272727,.454545,.181818,.545455,.136364,.681818,.136364,.727273,.181818,.863636,.272727,.954545,.409091,1,.5,1,.636364,.954545,.727273,.863636,.772727,.727273,.772727,.454545,.727273,.272727,.681818,.181818,.590909,.0909091,.454545,.0454545,.318182,.0454545,.227273,.0909091,.181818,.181818,.181818,.227273,.227273,.272727,.272727,.272727,.318182,.227273,.318182,.181818,.272727,.136364,.227273,.136364,.227273,.545455,.181818,.636364,.181818,.772727,.227273,.863636,.636364,.909091,.681818,.863636,.727273,.727273,.727273,.454545,.681818,.272727,.636364,.181818,.409091,.409091,.318182,.454545,.272727,.5,.227273,.636364,.227273,.772727,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.863636,.681818,.727273,.681818,.409091,.636364,.227273,.590909,.136364,.545455,.0909091,.454545,.0454545,.454545,.681818,.409091,.636364,.409091,.590909,.454545,.545455,.5,.545455,.545455,.590909,.545455,.636364,.5,.681818,.454545,.681818,.454545,.636364,.454545,.590909,.5,.590909,.5,.636364,.454545,.636364,.454545,.181818,.409091,.136364,.409091,.0909091,.454545,.0454545,.5,.0454545,.545455,.0909091,.545455,.136364,.5,.181818,.454545,.181818,.454545,.136364,.454545,.0909091,.5,.0909091,.5,.136364,.454545,.136364,.454545,.681818,.409091,.636364,.409091,.590909,.454545,.545455,.5,.545455,.545455,.590909,.545455,.636364,.5,.681818,.454545,.681818,.454545,.636364,.454545,.590909,.5,.590909,.5,.636364,.454545,.636364,.545455,.0909091,.5,.0454545,.454545,.0454545,.409091,.0909091,.409091,.136364,.454545,.181818,.5,.181818,.545455,.136364,.545455,0,.5,-.0909091,.409091,-.136364,.454545,.136364,.454545,.0909091,.5,.0909091,.5,.136364,.454545,.136364,.5,.0454545,.545455,0,.545455,.0909091,.5,-.0909091,.681818,.727273,.227273,.454545,.681818,.181818,.681818,.136364,.181818,.454545,.636364,.727273,.681818,.727273,.0909091,.681818,.863636,.681818,.863636,.636364,.0909091,.681818,.0909091,.636364,.863636,.636364,.0909091,.318182,.863636,.318182,.863636,.272727,.0909091,.318182,.0909091,.272727,.863636,.272727,.227273,.727273,.681818,.454545,.227273,.181818,.272727,.181818,.727273,.454545,.272727,.727273,.227273,.727273,.227273,.772727,.227273,.818182,.272727,.818182,.272727,.727273,.181818,.727273,.181818,.818182,.227273,.909091,.272727,.954545,.363636,1,.545455,1,.681818,.954545,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.681818,.590909,.5,.5,.681818,.909091,.727273,.863636,.727273,.681818,.681818,.636364,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.590909,.545455,.454545,.5,.454545,.363636,.5,.363636,.5,.5,.454545,.5,.454545,.181818,.409091,.136364,.409091,.0909091,.454545,.0454545,.5,.0454545,.545455,.0909091,.545455,.136364,.5,.181818,.454545,.181818,.454545,.136364,.454545,.0909091,.5,.0909091,.5,.136364,.454545,.136364,.590909,.545455,.5,.590909,.409091,.590909,.363636,.5,.363636,.454545,.409091,.363636,.5,.363636,.590909,.409091,.590909,.590909,.590909,.409091,.636364,.363636,.727273,.363636,.772727,.454545,.772727,.5,.727273,.636364,.636364,.727273,.5,.772727,.454545,.772727,.318182,.727273,.227273,.636364,.181818,.5,.181818,.454545,.227273,.318182,.318182,.227273,.454545,.181818,.5,.181818,.636364,.227273,.454545,1,.136364,.0909091,.409091,.863636,.681818,.0454545,.454545,.863636,.727273,.0454545,.454545,1,.772727,.0454545,.227273,.318182,.636364,.318182,.0454545,.0454545,.318182,.0454545,.545455,.0454545,.863636,.0454545,.136364,.0909091,.0909091,.0454545,.136364,.0909091,.227273,.0454545,.681818,.0909091,.590909,.0454545,.681818,.136364,.636364,.0454545,.727273,.136364,.818182,.0454545,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.272727,1,.272727,.0454545,.0454545,1,.590909,1,.727273,.954545,.772727,.909091,.818182,.818182,.818182,.727273,.772727,.636364,.727273,.590909,.590909,.545455,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.590909,1,.681818,.954545,.727273,.863636,.727273,.681818,.681818,.590909,.590909,.545455,.272727,.545455,.590909,.545455,.727273,.5,.772727,.454545,.818182,.363636,.818182,.227273,.772727,.136364,.727273,.0909091,.590909,.0454545,.0454545,.0454545,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.590909,.545455,.681818,.5,.727273,.409091,.727273,.181818,.681818,.0909091,.590909,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.318182,1,.272727,.909091,.363636,1,.272727,.954545,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.727273,.863636,.772727,1,.772727,.727273,.727273,.863636,.636364,.954545,.545455,1,.409091,1,.272727,.954545,.181818,.863636,.136364,.772727,.0909091,.636364,.0909091,.409091,.136364,.272727,.181818,.181818,.272727,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.409091,.181818,.272727,.227273,.181818,.409091,1,.318182,.954545,.227273,.818182,.181818,.636364,.181818,.409091,.227273,.227273,.318182,.0909091,.409091,.0454545,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.272727,1,.272727,.0454545,.0454545,1,.5,1,.636364,.954545,.727273,.863636,.772727,.772727,.818182,.636364,.818182,.409091,.772727,.272727,.727273,.181818,.636364,.0909091,.5,.0454545,.0454545,.0454545,.681818,.863636,.727273,.772727,.772727,.636364,.772727,.409091,.727273,.272727,.681818,.181818,.5,1,.590909,.954545,.681818,.818182,.727273,.636364,.727273,.409091,.681818,.227273,.590909,.0909091,.5,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.318182,1,.272727,.909091,.363636,1,.272727,.954545,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.272727,1,.272727,.0454545,.0454545,1,.772727,1,.772727,.727273,.272727,.545455,.545455,.545455,.545455,.727273,.545455,.363636,.0454545,.0454545,.772727,.0454545,.772727,.318182,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.318182,1,.272727,.909091,.363636,1,.272727,.954545,.545455,1,.772727,.954545,.636364,1,.772727,.909091,.681818,1,.772727,.863636,.727273,1,.772727,.727273,.545455,.727273,.5,.545455,.545455,.363636,.545455,.636364,.454545,.545455,.545455,.454545,.545455,.590909,.363636,.545455,.545455,.5,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.545455,.0454545,.772727,.0909091,.636364,.0454545,.772727,.136364,.681818,.0454545,.772727,.181818,.727273,.0454545,.772727,.318182,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.272727,1,.272727,.0454545,.0454545,1,.772727,1,.772727,.727273,.272727,.545455,.545455,.545455,.545455,.727273,.545455,.363636,.0454545,.0454545,.409091,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.318182,1,.272727,.909091,.363636,1,.272727,.954545,.545455,1,.772727,.954545,.636364,1,.772727,.909091,.681818,1,.772727,.863636,.727273,1,.772727,.727273,.545455,.727273,.5,.545455,.545455,.363636,.545455,.636364,.454545,.545455,.545455,.454545,.545455,.590909,.363636,.545455,.545455,.5,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.727273,.863636,.772727,1,.772727,.727273,.727273,.863636,.636364,.954545,.545455,1,.409091,1,.272727,.954545,.181818,.863636,.136364,.772727,.0909091,.636364,.0909091,.409091,.136364,.272727,.181818,.181818,.272727,.0909091,.409091,.0454545,.545455,.0454545,.636364,.0909091,.727273,.0909091,.772727,.0454545,.772727,.409091,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.409091,.181818,.272727,.227273,.181818,.409091,1,.318182,.954545,.227273,.818182,.181818,.636364,.181818,.409091,.227273,.227273,.318182,.0909091,.409091,.0454545,.727273,.363636,.727273,.136364,.681818,.409091,.681818,.136364,.636364,.0909091,.545455,.409091,.909091,.409091,.590909,.409091,.681818,.363636,.636364,.409091,.681818,.318182,.818182,.409091,.772727,.318182,.863636,.409091,.772727,.363636,.136364,1,.136364,.0454545,.181818,.954545,.181818,.0909091,.227273,1,.227273,.0454545,.681818,1,.681818,.0454545,.727273,.954545,.727273,.0909091,.772727,1,.772727,.0454545,0,1,.363636,1,.545455,1,.909091,1,.227273,.545455,.681818,.545455,0,.0454545,.363636,.0454545,.545455,.0454545,.909091,.0454545,.0454545,1,.136364,.954545,.0909091,1,.136364,.909091,.272727,1,.227273,.909091,.318182,1,.227273,.954545,.590909,1,.681818,.954545,.636364,1,.681818,.909091,.818182,1,.772727,.909091,.863636,1,.772727,.954545,.136364,.0909091,.0454545,.0454545,.136364,.136364,.0909091,.0454545,.227273,.136364,.272727,.0454545,.227273,.0909091,.318182,.0454545,.681818,.0909091,.590909,.0454545,.681818,.136364,.636364,.0454545,.772727,.136364,.818182,.0454545,.772727,.0909091,.863636,.0454545,.409091,1,.409091,.0454545,.454545,.954545,.454545,.0909091,.5,1,.5,.0454545,.272727,1,.636364,1,.272727,.0454545,.636364,.0454545,.318182,1,.409091,.954545,.363636,1,.409091,.909091,.545455,1,.5,.909091,.590909,1,.5,.954545,.409091,.0909091,.318182,.0454545,.409091,.136364,.363636,.0454545,.5,.136364,.545455,.0454545,.5,.0909091,.590909,.0454545,.5,1,.5,.227273,.454545,.0909091,.409091,.0454545,.545455,.954545,.545455,.227273,.5,.0909091,.590909,1,.590909,.227273,.545455,.0909091,.409091,.0454545,.318182,.0454545,.227273,.0909091,.181818,.181818,.181818,.272727,.227273,.318182,.272727,.318182,.318182,.272727,.318182,.227273,.272727,.181818,.227273,.181818,.227273,.272727,.227273,.227273,.272727,.227273,.272727,.272727,.227273,.272727,.363636,1,.727273,1,.409091,1,.5,.954545,.454545,1,.5,.909091,.636364,1,.590909,.909091,.681818,1,.590909,.954545,.136364,1,.136364,.0454545,.181818,.954545,.181818,.0909091,.227273,1,.227273,.0454545,.727273,.954545,.227273,.454545,.363636,.545455,.681818,.0454545,.409091,.545455,.727273,.0454545,.409091,.636364,.772727,.0454545,0,1,.363636,1,.590909,1,.863636,1,0,.0454545,.363636,.0454545,.545455,.0454545,.863636,.0454545,.0454545,1,.136364,.954545,.0909091,1,.136364,.909091,.272727,1,.227273,.909091,.318182,1,.227273,.954545,.681818,1,.727273,.954545,.818182,1,.727273,.954545,.136364,.0909091,.0454545,.0454545,.136364,.136364,.0909091,.0454545,.227273,.136364,.272727,.0454545,.227273,.0909091,.318182,.0454545,.681818,.136364,.590909,.0454545,.681818,.136364,.818182,.0454545,.272727,1,.272727,.0454545,.318182,.954545,.318182,.0909091,.363636,1,.363636,.0454545,.136364,1,.5,1,.136364,.0454545,.818182,.0454545,.818182,.318182,.181818,1,.272727,.954545,.227273,1,.272727,.909091,.409091,1,.363636,.909091,.454545,1,.363636,.954545,.272727,.0909091,.181818,.0454545,.272727,.136364,.227273,.0454545,.363636,.136364,.409091,.0454545,.363636,.0909091,.454545,.0454545,.590909,.0454545,.818182,.0909091,.681818,.0454545,.818182,.136364,.727273,.0454545,.818182,.181818,.772727,.0454545,.818182,.318182,.0909091,1,.0909091,.0909091,.0909091,1,.409091,.0454545,.136364,1,.409091,.181818,.181818,1,.454545,.181818,.727273,1,.409091,.0454545,.727273,1,.727273,.0454545,.772727,.954545,.772727,.0909091,.818182,1,.818182,.0454545,-.0454545,1,.181818,1,.727273,1,.954545,1,-.0454545,.0454545,.227273,.0454545,.590909,.0454545,.954545,.0454545,0,1,.0909091,.954545,.863636,1,.818182,.909091,.909091,1,.818182,.954545,.0909091,.0909091,0,.0454545,.0909091,.0909091,.181818,.0454545,.727273,.0909091,.636364,.0454545,.727273,.136364,.681818,.0454545,.818182,.136364,.863636,.0454545,.818182,.0909091,.909091,.0454545,.136364,1,.136364,.0909091,.136364,1,.772727,.0454545,.181818,1,.727273,.181818,.227273,1,.772727,.181818,.772727,.954545,.772727,.0454545,0,1,.227273,1,.636364,1,.909091,1,0,.0454545,.272727,.0454545,.0454545,1,.136364,.954545,.681818,1,.772727,.954545,.863636,1,.772727,.954545,.136364,.0909091,.0454545,.0454545,.136364,.0909091,.227273,.0454545,.409091,1,.272727,.954545,.181818,.863636,.136364,.772727,.0909091,.590909,.0909091,.454545,.136364,.272727,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.818182,.454545,.818182,.590909,.772727,.772727,.727273,.863636,.636364,.954545,.5,1,.409091,1,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.409091,.181818,.272727,.227273,.181818,.681818,.181818,.727273,.272727,.772727,.409091,.772727,.636364,.727273,.772727,.681818,.863636,.409091,1,.318182,.954545,.227273,.818182,.181818,.636364,.181818,.409091,.227273,.227273,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.227273,.727273,.409091,.727273,.636364,.681818,.818182,.590909,.954545,.5,1,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.272727,1,.272727,.0454545,.0454545,1,.590909,1,.727273,.954545,.772727,.909091,.818182,.818182,.818182,.681818,.772727,.590909,.727273,.545455,.590909,.5,.272727,.5,.727273,.909091,.772727,.818182,.772727,.681818,.727273,.590909,.590909,1,.681818,.954545,.727273,.863636,.727273,.636364,.681818,.545455,.590909,.5,.0454545,.0454545,.409091,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.318182,1,.272727,.909091,.363636,1,.272727,.954545,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.409091,1,.272727,.954545,.181818,.863636,.136364,.772727,.0909091,.590909,.0909091,.454545,.136364,.272727,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.272727,.818182,.454545,.818182,.590909,.772727,.772727,.727273,.863636,.636364,.954545,.5,1,.409091,1,.227273,.863636,.181818,.772727,.136364,.636364,.136364,.409091,.181818,.272727,.227273,.181818,.681818,.181818,.727273,.272727,.772727,.409091,.772727,.636364,.727273,.772727,.681818,.863636,.409091,1,.318182,.954545,.227273,.818182,.181818,.636364,.181818,.409091,.227273,.227273,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.227273,.727273,.409091,.727273,.636364,.681818,.818182,.590909,.954545,.5,1,.272727,.181818,.318182,.272727,.409091,.318182,.454545,.318182,.545455,.272727,.590909,.181818,.636364,-.0909091,.681818,-.181818,.772727,-.181818,.818182,-.0909091,.818182,0,.636364,0,.681818,-.0909091,.727273,-.136364,.772727,-.136364,.590909,.181818,.681818,-.0454545,.727273,-.0909091,.772727,-.0909091,.818182,-.0454545,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.272727,1,.272727,.0454545,.0454545,1,.590909,1,.727273,.954545,.772727,.909091,.818182,.818182,.818182,.727273,.772727,.636364,.727273,.590909,.590909,.545455,.272727,.545455,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.590909,1,.681818,.954545,.727273,.863636,.727273,.681818,.681818,.590909,.590909,.545455,.454545,.545455,.545455,.5,.590909,.409091,.681818,.136364,.727273,.0454545,.818182,.0454545,.863636,.136364,.863636,.227273,.681818,.227273,.727273,.136364,.772727,.0909091,.818182,.0909091,.545455,.5,.590909,.454545,.727273,.181818,.772727,.136364,.818182,.136364,.863636,.181818,.0454545,.0454545,.409091,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.318182,1,.272727,.909091,.363636,1,.272727,.954545,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.727273,.863636,.772727,1,.772727,.727273,.727273,.863636,.636364,.954545,.5,1,.363636,1,.227273,.954545,.136364,.863636,.136364,.727273,.181818,.636364,.318182,.545455,.590909,.454545,.681818,.409091,.727273,.318182,.727273,.181818,.681818,.0909091,.181818,.727273,.227273,.636364,.318182,.590909,.590909,.5,.681818,.454545,.727273,.363636,.227273,.954545,.181818,.863636,.181818,.772727,.227273,.681818,.318182,.636364,.590909,.545455,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.545455,.0454545,.409091,.0454545,.272727,.0909091,.181818,.181818,.136364,.318182,.136364,.0454545,.181818,.181818,.0909091,1,.0909091,.727273,.409091,1,.409091,.0454545,.454545,.954545,.454545,.0909091,.5,1,.5,.0454545,.818182,1,.818182,.727273,.0909091,1,.818182,1,.272727,.0454545,.636364,.0454545,.136364,1,.0909091,.727273,.181818,1,.0909091,.863636,.227273,1,.0909091,.909091,.318182,1,.0909091,.954545,.590909,1,.818182,.954545,.681818,1,.818182,.909091,.727273,1,.818182,.863636,.772727,1,.818182,.727273,.409091,.0909091,.318182,.0454545,.409091,.136364,.363636,.0454545,.5,.136364,.545455,.0454545,.5,.0909091,.590909,.0454545,.136364,1,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.318182,.772727,.954545,.181818,.954545,.181818,.272727,.227273,.181818,.227273,1,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,0,1,.363636,1,.636364,1,.909091,1,.0454545,1,.136364,.954545,.0909091,1,.136364,.909091,.272727,1,.227273,.909091,.318182,1,.227273,.954545,.681818,1,.772727,.954545,.863636,1,.772727,.954545,.136364,1,.454545,.0454545,.181818,1,.454545,.181818,.454545,.0454545,.227273,1,.5,.181818,.772727,.954545,.454545,.0454545,.0454545,1,.363636,1,.590909,1,.863636,1,.0909091,1,.181818,.909091,.272727,1,.227273,.909091,.318182,1,.227273,.954545,.681818,1,.772727,.954545,.818182,1,.772727,.954545,.0909091,1,.272727,.0454545,.136364,1,.272727,.272727,.272727,.0454545,.181818,1,.318182,.272727,.454545,1,.318182,.272727,.272727,.0454545,.454545,1,.636364,.0454545,.5,1,.636364,.272727,.636364,.0454545,.545455,1,.681818,.272727,.818182,.954545,.681818,.272727,.636364,.0454545,-.0454545,1,.318182,1,.454545,1,.545455,1,.681818,1,.954545,1,0,1,.136364,.954545,.0454545,1,.136364,.909091,.227273,1,.181818,.909091,.272727,1,.181818,.954545,.727273,1,.818182,.954545,.909091,1,.818182,.954545,.0454545,1,.363636,1,.318182,1,.227273,.954545,.272727,1,.227273,.909091,.0909091,1,.181818,.909091,.136364,1,.681818,.0454545,.727273,.0454545,.181818,1,.227273,1,.772727,.0454545,.863636,.0454545,.545455,.0454545,.590909,.0454545,.681818,.0909091,.636364,.0454545,.681818,.136364,.818182,.0454545,.727273,.136364,.590909,1,.863636,1,.681818,1,.772727,.954545,.818182,1,.772727,.954545,.136364,.0909091,.0909091,.0454545,.0454545,.0454545,.318182,.0454545,.136364,.0909091,.227273,.0454545,.0909091,1,.409091,.5,.409091,.0454545,.136364,1,.454545,.5,.454545,.0909091,.181818,1,.5,.5,.5,.0454545,.772727,.954545,.5,.5,0,1,.318182,1,.636364,1,.909091,1,.272727,.0454545,.636364,.0454545,.0454545,1,.136364,.954545,.272727,1,.181818,.954545,.681818,1,.772727,.954545,.863636,1,.772727,.954545,.409091,.0909091,.318182,.0454545,.409091,.136364,.363636,.0454545,.5,.136364,.545455,.0454545,.5,.0909091,.590909,.0454545,.772727,1,.136364,1,.136364,.727273,.681818,1,.136364,.0454545,.727273,1,.181818,.0454545,.772727,1,.227273,.0454545,.136364,.0454545,.772727,.0454545,.772727,.318182,.181818,1,.136364,.727273,.227273,1,.136364,.863636,.272727,1,.136364,.909091,.363636,1,.136364,.954545,.545455,.0454545,.772727,.0909091,.636364,.0454545,.772727,.136364,.681818,.0454545,.772727,.181818,.727273,.0454545,.772727,.318182,.363636,.909091,.363636,0,.409091,.909091,.409091,0,.363636,.909091,.590909,.909091,.363636,0,.590909,0,.136364,.590909,.818182,.590909,.818182,.545455,.136364,.545455,.136364,.590909,.5,.909091,.454545,.909091,.454545,.227273,.5,.227273,.5,.909091,.136364,.136364,.136364,.0909091,.818182,.0909091,.818182,.136364,.136364,.136364,.5,.909091,.5,0,.545455,.909091,.545455,0,.318182,.909091,.545455,.909091,.318182,0,.545455,0,.227273,.681818,.454545,.909091,.681818,.681818,.636364,.681818,.454545,.863636,.272727,.681818,.227273,.681818,0,0,.909091,0,.409091,1,.318182,.954545,.272727,.863636,.272727,.772727,.318182,.681818,.409091,.636364,.5,.636364,.590909,.681818,.636364,.772727,.636364,.863636,.590909,.954545,.5,1,.409091,1,.409091,1,.272727,.863636,.318182,.681818,.5,.636364,.636364,.772727,.590909,.954545,.409091,1,.5,1,.318182,.954545,.272727,.772727,.409091,.636364,.590909,.681818,.636364,.863636,.5,1,.272727,.545455,.272727,.590909,.318182,.590909,.318182,.5,.227273,.5,.227273,.590909,.272727,.636364,.363636,.681818,.545455,.681818,.636364,.636364,.681818,.590909,.727273,.5,.727273,.181818,.772727,.0909091,.818182,.0454545,.636364,.590909,.681818,.5,.681818,.181818,.727273,.0909091,.545455,.681818,.590909,.636364,.636364,.545455,.636364,.181818,.681818,.0909091,.818182,.0454545,.863636,.0454545,.636364,.454545,.590909,.409091,.363636,.363636,.227273,.318182,.181818,.227273,.181818,.181818,.227273,.0909091,.363636,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.272727,.318182,.227273,.227273,.227273,.181818,.272727,.0909091,.590909,.409091,.409091,.363636,.318182,.318182,.272727,.227273,.272727,.181818,.318182,.0909091,.363636,.0454545,.181818,1,.181818,.0454545,.227273,.0909091,.318182,.0909091,.227273,.954545,.227273,.136364,.0454545,1,.272727,1,.272727,.0909091,.272727,.545455,.318182,.636364,.409091,.681818,.5,.681818,.636364,.636364,.727273,.545455,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.272727,.181818,.681818,.545455,.727273,.454545,.727273,.272727,.681818,.181818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.454545,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.681818,.5,.681818,.545455,.636364,.545455,.636364,.454545,.727273,.454545,.727273,.545455,.636364,.636364,.545455,.681818,.409091,.681818,.272727,.636364,.181818,.545455,.136364,.409091,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.227273,.545455,.181818,.454545,.181818,.272727,.227273,.181818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.636364,1,.636364,.0454545,.863636,.0454545,.681818,.954545,.681818,.0909091,.5,1,.727273,1,.727273,.0454545,.636364,.545455,.590909,.636364,.5,.681818,.409091,.681818,.272727,.636364,.181818,.545455,.136364,.409091,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.227273,.545455,.181818,.454545,.181818,.272727,.227273,.181818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.545455,1,.636364,.954545,.590909,1,.636364,.909091,.727273,.136364,.772727,.0454545,.727273,.0909091,.818182,.0454545,.227273,.409091,.727273,.409091,.727273,.5,.681818,.590909,.636364,.636364,.5,.681818,.409091,.681818,.272727,.636364,.181818,.545455,.136364,.409091,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.681818,.454545,.681818,.5,.636364,.590909,.227273,.545455,.181818,.454545,.181818,.272727,.227273,.181818,.636364,.409091,.636364,.545455,.590909,.636364,.5,.681818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.681818,.909091,.681818,.954545,.636364,.954545,.636364,.863636,.727273,.863636,.727273,.954545,.681818,1,.545455,1,.454545,.954545,.409091,.909091,.363636,.772727,.363636,.0454545,.454545,.909091,.409091,.772727,.409091,.0909091,.545455,1,.5,.954545,.454545,.863636,.454545,.0454545,.227273,.681818,.636364,.681818,.227273,.0454545,.590909,.0454545,.363636,.0909091,.272727,.0454545,.363636,.136364,.318182,.0454545,.454545,.136364,.5,.0454545,.454545,.0909091,.545455,.0454545,.727273,.636364,.772727,.590909,.818182,.636364,.772727,.681818,.727273,.681818,.636364,.636364,.590909,.590909,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.5,.227273,.409091,.272727,.318182,.318182,.272727,.409091,.227273,.5,.227273,.590909,.272727,.636364,.318182,.681818,.409091,.681818,.5,.636364,.590909,.590909,.636364,.5,.681818,.409091,.681818,.318182,.590909,.272727,.5,.272727,.409091,.318182,.318182,.590909,.318182,.636364,.409091,.636364,.5,.590909,.590909,.409091,.681818,.363636,.636364,.318182,.545455,.318182,.363636,.363636,.272727,.409091,.227273,.5,.227273,.545455,.272727,.590909,.363636,.590909,.545455,.545455,.636364,.5,.681818,.272727,.318182,.227273,.272727,.181818,.181818,.181818,.136364,.227273,.0454545,.272727,0,.409091,-.0454545,.590909,-.0454545,.727273,-.0909091,.772727,-.136364,.272727,.0454545,.409091,0,.590909,0,.727273,-.0454545,.181818,.136364,.227273,.0909091,.363636,.0454545,.590909,.0454545,.727273,0,.772727,-.0909091,.772727,-.136364,.727273,-.227273,.590909,-.272727,.318182,-.272727,.181818,-.227273,.136364,-.136364,.136364,-.0909091,.181818,0,.318182,.0454545,.318182,-.272727,.227273,-.227273,.181818,-.136364,.181818,-.0909091,.227273,0,.318182,.0454545,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.0454545,1,.272727,1,.272727,.0454545,.272727,.5,.318182,.590909,.363636,.636364,.454545,.681818,.590909,.681818,.681818,.636364,.727273,.590909,.772727,.454545,.772727,.0454545,.681818,.590909,.727273,.454545,.727273,.0909091,.590909,.681818,.636364,.636364,.681818,.5,.681818,.0454545,.0454545,.0454545,.409091,.0454545,.545455,.0454545,.909091,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.681818,.0909091,.590909,.0454545,.681818,.136364,.636364,.0454545,.772727,.136364,.818182,.0454545,.772727,.0909091,.863636,.0454545,.409091,1,.409091,.909091,.5,.909091,.5,1,.409091,1,.454545,1,.454545,.909091,.409091,.954545,.5,.954545,.409091,.681818,.409091,.0454545,.454545,.636364,.454545,.0909091,.272727,.681818,.5,.681818,.5,.0454545,.272727,.0454545,.636364,.0454545,.318182,.681818,.409091,.636364,.363636,.681818,.409091,.590909,.409091,.0909091,.318182,.0454545,.409091,.136364,.363636,.0454545,.5,.136364,.545455,.0454545,.5,.0909091,.590909,.0454545,.454545,1,.454545,.909091,.545455,.909091,.545455,1,.454545,1,.5,1,.5,.909091,.454545,.954545,.545455,.954545,.454545,.681818,.454545,-.0909091,.409091,-.227273,.363636,-.272727,.5,.636364,.5,-.0454545,.454545,-.181818,.318182,.681818,.545455,.681818,.545455,-.0454545,.5,-.181818,.454545,-.227273,.363636,-.272727,.227273,-.272727,.181818,-.227273,.181818,-.136364,.272727,-.136364,.272727,-.227273,.227273,-.227273,.227273,-.181818,.363636,.681818,.454545,.636364,.409091,.681818,.454545,.590909,.181818,1,.181818,.0454545,.227273,.954545,.227273,.0909091,.0454545,1,.272727,1,.272727,.0454545,.681818,.636364,.272727,.227273,.454545,.409091,.772727,.0454545,.454545,.363636,.727273,.0454545,.409091,.363636,.681818,.0454545,.545455,.681818,.863636,.681818,.0454545,.0454545,.409091,.0454545,.545455,.0454545,.863636,.0454545,.0909091,1,.181818,.954545,.136364,1,.181818,.909091,.590909,.681818,.681818,.636364,.818182,.681818,.681818,.636364,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.681818,.136364,.590909,.0454545,.636364,.136364,.818182,.0454545,.409091,1,.409091,.0454545,.454545,.954545,.454545,.0909091,.272727,1,.5,1,.5,.0454545,.272727,.0454545,.636364,.0454545,.318182,1,.409091,.954545,.363636,1,.409091,.909091,.409091,.0909091,.318182,.0454545,.409091,.136364,.363636,.0454545,.5,.136364,.545455,.0454545,.5,.0909091,.590909,.0454545,-.0454545,.681818,-.0454545,.681818,.136364,.681818,.136364,.0454545,.227273,.0454545,-.0454545,.0454545,.0454545,.0909091,.0454545,.136364,0,.0454545,.181818,.0454545,.136364,.136364,.136364,.0909091,.227273,.0454545,.0454545,.0454545,.0454545,.681818,0,.681818,.0454545,.590909,-.0454545,.681818,.0454545,.636364,.0909091,.636364,.0909091,.0909091,.136364,.5,.181818,.636364,.272727,.681818,.318182,.681818,.363636,.636364,.409091,.5,.409091,.0454545,.363636,.0454545,.409091,.136364,.409091,.0909091,.318182,.0454545,.590909,.0454545,.5,.0909091,.5,.136364,.545455,.0454545,.5,.0454545,.5,.454545,.454545,.590909,.409091,.636364,.318182,.681818,.409091,.590909,.454545,.454545,.454545,.0909091,.5,.5,.545455,.636364,.636364,.681818,.681818,.681818,.727273,.636364,.772727,.5,.772727,.0454545,.772727,.136364,.727273,.0454545,.772727,.0909091,.681818,.0454545,.954545,.0454545,.863636,.0909091,.863636,.136364,.909091,.0454545,.863636,.0454545,.863636,.454545,.818182,.590909,.772727,.636364,.681818,.681818,.772727,.590909,.818182,.454545,.818182,.0909091,.181818,.681818,.181818,.0454545,.227273,.636364,.227273,.0909091,.0454545,.681818,.272727,.681818,.272727,.0454545,.272727,.5,.318182,.590909,.363636,.636364,.454545,.681818,.590909,.681818,.681818,.636364,.727273,.590909,.772727,.454545,.772727,.0454545,.681818,.590909,.727273,.454545,.727273,.0909091,.590909,.681818,.636364,.636364,.681818,.5,.681818,.0454545,.0454545,.0454545,.409091,.0454545,.545455,.0454545,.909091,.0454545,.0909091,.681818,.181818,.636364,.136364,.681818,.181818,.590909,.181818,.0909091,.0909091,.0454545,.181818,.136364,.136364,.0454545,.272727,.136364,.318182,.0454545,.272727,.0909091,.363636,.0454545,.681818,.0909091,.590909,.0454545,.681818,.136364,.636364,.0454545,.772727,.136364,.818182,.0454545,.772727,.0909091,.863636,.0454545,.409091,.681818,.272727,.636364,.181818,.545455,.136364,.409091,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.727273,.181818,.772727,.318182,.772727,.409091,.727273,.545455,.636364,.636364,.5,.681818,.409091,.681818,.227273,.545455,.181818,.454545,.181818,.272727,.227273,.181818,.681818,.181818,.727273,.272727,.727273,.454545,.681818,.545455,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.272727,.681818,.454545,.636364,.590909,.590909,.636364,.5,.681818,.181818,.681818,.181818,-.272727,.227273,.636364,.227273,-.227273,.0454545,.681818,.272727,.681818,.272727,-.272727,.272727,.545455,.318182,.636364,.409091,.681818,.5,.681818,.636364,.636364,.727273,.545455,.772727,.409091,.772727,.318182,.727273,.181818,.636364,.0909091,.5,.0454545,.409091,.0454545,.318182,.0909091,.272727,.181818,.681818,.545455,.727273,.454545,.727273,.272727,.681818,.181818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.454545,.681818,.272727,.636364,.136364,.590909,.0909091,.5,.0454545,.0454545,-.272727,.409091,-.272727,.0909091,.681818,.181818,.636364,.136364,.681818,.181818,.590909,.181818,-.227273,.0909091,-.272727,.181818,-.181818,.136364,-.272727,.272727,-.181818,.318182,-.272727,.272727,-.227273,.363636,-.272727,.636364,.636364,.636364,-.272727,.681818,.590909,.681818,-.227273,.590909,.636364,.681818,.636364,.727273,.681818,.727273,-.272727,.636364,.545455,.590909,.636364,.5,.681818,.409091,.681818,.272727,.636364,.181818,.545455,.136364,.409091,.136364,.318182,.181818,.181818,.272727,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.181818,.227273,.545455,.181818,.454545,.181818,.272727,.227273,.181818,.409091,.681818,.318182,.636364,.272727,.590909,.227273,.454545,.227273,.272727,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,-.272727,.863636,-.272727,.636364,-.227273,.545455,-.272727,.636364,-.181818,.590909,-.272727,.727273,-.181818,.772727,-.272727,.727273,-.227273,.818182,-.272727,.272727,.681818,.272727,.0454545,.318182,.636364,.318182,.0909091,.136364,.681818,.363636,.681818,.363636,.0454545,.681818,.590909,.681818,.636364,.636364,.636364,.636364,.545455,.727273,.545455,.727273,.636364,.681818,.681818,.590909,.681818,.5,.636364,.409091,.545455,.363636,.409091,.136364,.0454545,.5,.0454545,.181818,.681818,.272727,.636364,.227273,.681818,.272727,.590909,.272727,.0909091,.181818,.0454545,.272727,.136364,.227273,.0454545,.363636,.136364,.409091,.0454545,.363636,.0909091,.454545,.0454545,.681818,.590909,.727273,.681818,.727273,.5,.681818,.590909,.636364,.636364,.545455,.681818,.363636,.681818,.272727,.636364,.227273,.590909,.227273,.5,.272727,.409091,.363636,.363636,.590909,.318182,.681818,.272727,.727273,.136364,.272727,.636364,.227273,.5,.272727,.454545,.363636,.409091,.590909,.363636,.681818,.318182,.727273,.272727,.681818,.0909091,.227273,.590909,.272727,.5,.363636,.454545,.590909,.409091,.681818,.363636,.727273,.272727,.727273,.136364,.681818,.0909091,.590909,.0454545,.409091,.0454545,.318182,.0909091,.272727,.136364,.227273,.227273,.227273,.0454545,.272727,.136364,.363636,.909091,.363636,.272727,.409091,.136364,.454545,.0909091,.545455,.0454545,.636364,.0454545,.727273,.0909091,.772727,.181818,.409091,.909091,.409091,.227273,.454545,.136364,.363636,.909091,.454545,1,.454545,.227273,.5,.0909091,.545455,.0454545,.227273,.681818,.636364,.681818,.181818,.681818,.181818,.272727,.227273,.136364,.272727,.0909091,.363636,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.227273,.636364,.227273,.227273,.272727,.136364,.0454545,.681818,.272727,.681818,.272727,.227273,.318182,.0909091,.363636,.0454545,.681818,.681818,.681818,.0454545,.909091,.0454545,.727273,.636364,.727273,.0909091,.545455,.681818,.772727,.681818,.772727,.0454545,.0909091,.681818,.181818,.636364,.136364,.681818,.181818,.590909,.772727,.136364,.818182,.0454545,.772727,.0909091,.863636,.0454545,.181818,.681818,.454545,.0454545,.227273,.681818,.454545,.136364,.272727,.681818,.5,.136364,.727273,.636364,.5,.136364,.454545,.0454545,.0909091,.681818,.409091,.681818,.545455,.681818,.818182,.681818,.136364,.681818,.272727,.590909,.363636,.681818,.272727,.636364,.636364,.681818,.727273,.636364,.772727,.681818,.727273,.636364,.0909091,.681818,.272727,.0454545,.136364,.681818,.272727,.181818,.181818,.681818,.318182,.181818,.454545,.681818,.318182,.181818,.272727,.0454545,.454545,.681818,.636364,.0454545,.5,.681818,.636364,.181818,.454545,.681818,.545455,.681818,.681818,.181818,.818182,.636364,.681818,.181818,.636364,.0454545,-.0454545,.681818,.318182,.681818,.681818,.681818,.954545,.681818,0,.681818,.136364,.636364,.272727,.681818,.181818,.636364,.727273,.681818,.818182,.636364,.909091,.681818,.818182,.636364,.181818,.681818,.636364,.0454545,.227273,.681818,.681818,.0454545,.272727,.681818,.727273,.0454545,.681818,.636364,.227273,.0909091,.0909091,.681818,.409091,.681818,.545455,.681818,.818182,.681818,.0909091,.0454545,.363636,.0454545,.5,.0454545,.818182,.0454545,.136364,.681818,.227273,.636364,.363636,.681818,.272727,.636364,.590909,.681818,.681818,.636364,.772727,.681818,.681818,.636364,.227273,.0909091,.136364,.0454545,.227273,.0909091,.318182,.0454545,.636364,.0909091,.545455,.0454545,.681818,.0909091,.772727,.0454545,.181818,.681818,.454545,.0454545,.227273,.681818,.454545,.136364,.272727,.681818,.5,.136364,.727273,.636364,.5,.136364,.363636,-.136364,.272727,-.227273,.181818,-.272727,.0909091,-.272727,.0454545,-.227273,.0454545,-.136364,.136364,-.136364,.136364,-.227273,.0909091,-.227273,.0909091,-.181818,.0909091,.681818,.409091,.681818,.545455,.681818,.818182,.681818,.136364,.681818,.272727,.590909,.363636,.681818,.272727,.636364,.636364,.681818,.727273,.636364,.772727,.681818,.727273,.636364,.636364,.681818,.181818,.0454545,.681818,.681818,.227273,.0454545,.727273,.681818,.272727,.0454545,.727273,.681818,.181818,.681818,.181818,.5,.181818,.0454545,.727273,.0454545,.727273,.227273,.227273,.681818,.181818,.5,.272727,.681818,.181818,.545455,.318182,.681818,.181818,.590909,.409091,.681818,.181818,.636364,.5,.0454545,.727273,.0909091,.590909,.0454545,.727273,.136364,.636364,.0454545,.727273,.181818,.681818,.0454545,.727273,.227273,.5,.909091,.409091,.863636,.363636,.818182,.363636,.727273,.454545,.636364,.5,.545455,.409091,.863636,.363636,.727273,.5,.636364,.454545,.5,.363636,.818182,.409091,.727273,.5,.636364,.5,.545455,.454545,.5,.363636,.454545,.454545,.409091,.5,.363636,.5,.272727,.409091,.181818,.363636,.0909091,.454545,.409091,.5,.272727,.363636,.181818,.409091,.0454545,.5,.363636,.454545,.272727,.363636,.181818,.363636,.0909091,.409091,.0454545,.5,0,.363636,.818182,.545455,.818182,.727273,.727273,.818182,.545455,.818182,.363636,.727273,.181818,.545455,.0909091,.363636,.0909091,.181818,.181818,.0909091,.363636,.0909091,.545455,.181818,.727273,.363636,.818182,.363636,.772727,.545455,.772727,.727273,.681818,.772727,.545455,.772727,.363636,.727273,.227273,.545455,.136364,.363636,.136364,.181818,.227273,.136364,.363636,.136364,.545455,.181818,.681818,.363636,.772727,.772727,1.09091,.136364,-.181818,.0909091,-.181818,.727273,1.09091,.772727,1.09091,.409091,.909091,.5,.863636,.545455,.818182,.545455,.727273,.454545,.636364,.409091,.545455,.5,.863636,.545455,.727273,.409091,.636364,.454545,.5,.545455,.818182,.5,.727273,.409091,.636364,.409091,.545455,.454545,.5,.545455,.454545,.454545,.409091,.409091,.363636,.409091,.272727,.5,.181818,.545455,.0909091,.454545,.409091,.409091,.272727,.545455,.181818,.5,.0454545,.409091,.363636,.454545,.272727,.545455,.181818,.545455,.0909091,.5,.0454545,.409091,0,.636364,.909091,.590909,.818182,.5,.818182,.409091,.954545,.318182,.954545,.272727,.863636,.454545,1,.5,.909091,.454545,.318182,.409091,.909091,.454545,1,.454545,.545455,.454545,.136364,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.454545,.0454545,.318182,1,.318182,.772727,.590909,1,.590909,.772727,.454545,.818182,.454545,.454545,.272727,.636364,.636364,.636364,.272727,.318182,.636364,.318182,.409091,.636364,.5,.636364,.590909,.727273,.590909,.818182,.5,.909091,.409091,.909091,.318182,.818182,.318182,.727273,.409091,.636364,.727273,1,.181818,.0909091,.590909,.181818,.636364,.181818,.727273,.272727,.727273,.363636,.636364,.454545,.590909,.454545,.5,.363636,.5,.272727,.590909,.181818,.363636,.681818,.318182,.681818,.227273,.772727,.227273,.863636,.318182,.954545,.363636,.954545,.454545,.863636,.454545,.772727,.363636,.681818,.681818,.0454545,.454545,.409091,.409091,.590909,.318182,.636364,.272727,.727273,.272727,.818182,.318182,.954545,.363636,1,.454545,1,.5,.954545,.545455,.818182,.545455,.727273,.5,.636364,.363636,.636364,.272727,.545455,.227273,.454545,.181818,.318182,.181818,.181818,.227273,.0909091,.318182,.0454545,.454545,.0454545,.545455,.0909091,.681818,.227273,.727273,.318182,.727273,.363636,.409091,.636364,.5,.909091,.545455,1.09091,.454545,1.04545,.363636,.954545,.318182,.863636,.318182,.181818,.363636,.0909091,.454545,0,.545455,-.0454545,.363636,1.09091,.454545,1.04545,.545455,.954545,.590909,.863636,.590909,.181818,.545455,.0909091,.454545,0,.363636,-.0454545,.454545,.772727,.454545,.318182,.727273,.272727,.181818,.818182,.727273,.818182,.181818,.272727,.227273,.545455,.681818,.545455,.272727,.5,.636364,.5,.454545,.681818,.454545,.318182,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.272727,.5,.636364,.5,.409091,0,.409091,.0909091,.5,.0909091,.5,0,.409091,0,.681818,.954545,.227273,.0909091,.409091,1,.318182,.954545,.272727,.909091,.227273,.818182,.227273,.227273,.272727,.136364,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.636364,.136364,.681818,.227273,.681818,.818182,.636364,.909091,.590909,.954545,.5,1,.409091,1,.363636,.818182,.5,1,.5,.0454545,.181818,.772727,.227273,.909091,.272727,.954545,.409091,1,.5,1,.636364,.954545,.681818,.909091,.727273,.772727,.727273,.681818,.181818,.0454545,.727273,.0454545,.136364,1,.636364,1,.727273,.954545,.772727,.863636,.772727,.772727,.727273,.681818,.636364,.636364,.409091,.636364,.636364,.636364,.727273,.590909,.772727,.5,.772727,.181818,.727273,.0909091,.636364,.0454545,.136364,.0454545,.454545,1,.136364,.318182,.772727,.318182,.545455,.590909,.545455,.0454545,.772727,1,.136364,1,.136364,.545455,.590909,.545455,.681818,.5,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.590909,.0454545,.136364,.0454545,.545455,1,.409091,.954545,.318182,.909091,.227273,.818182,.181818,.727273,.136364,.590909,.136364,.227273,.181818,.0909091,.318182,.0454545,.590909,.0454545,.727273,.0909091,.772727,.227273,.772727,.363636,.727273,.5,.590909,.545455,.136364,.545455,.136364,1,.772727,1,.409091,.0454545,.545455,1,.681818,.954545,.727273,.818182,.727273,.772727,.681818,.636364,.545455,.590909,.363636,.590909,.227273,.636364,.181818,.772727,.181818,.818182,.227273,.954545,.363636,1,.545455,1,.590909,.590909,.727273,.545455,.772727,.409091,.772727,.227273,.727273,.0909091,.590909,.0454545,.318182,.0454545,.181818,.0909091,.136364,.227273,.136364,.409091,.181818,.545455,.318182,.590909,.772727,.5,.318182,.5,.181818,.545455,.136364,.681818,.136364,.818182,.181818,.954545,.318182,1,.590909,1,.727273,.954545,.772727,.818182,.772727,.454545,.727273,.318182,.681818,.227273,.590909,.136364,.5,.0909091,.363636,.0454545,.318182,.0454545,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.681818,.409091,.636364,.454545,.590909,.5,.636364,.454545,.681818,.5,.0909091,.454545,.0454545,.409091,.0909091,.454545,.136364,.5,.0909091,.5,0,.454545,-.0909091,.409091,-.136364,.636364,.818182,.227273,.5,.636364,.181818,.272727,.545455,.636364,.545455,.636364,.409091,.272727,.409091,.272727,.818182,.681818,.5,.272727,.181818,.227273,.772727,.227273,.818182,.272727,.909091,.318182,.954545,.409091,1,.5,1,.590909,.954545,.636364,.909091,.681818,.818182,.681818,.727273,.636364,.636364,.590909,.590909,.454545,.5,.454545,.227273,.454545,.136364,.409091,.0909091,.454545,.0454545,.5,.0909091,.454545,.136364,.454545,.0454545,.636364,.772727,.545455,.772727,.454545,.727273,.409091,.636364,.409091,.545455,.454545,.454545,.545455,.409091,.636364,.409091,.727273,.454545,.772727,.545455,.772727,.636364,.727273,.727273,.590909,.863636,.5,.909091,.363636,.909091,.272727,.863636,.181818,.772727,.136364,.681818,.136364,.5,.181818,.409091,.272727,.272727,.318182,.227273,.454545,.136364,.545455,.136364,.636364,.181818,.727273,.272727,.136364,.0454545,.454545,1,.772727,.0454545,.272727,.454545,.636364,.454545,.136364,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.545455,.545455,.136364,.545455,.545455,.545455,.636364,.5,.681818,.454545,.727273,.363636,.727273,.227273,.681818,.136364,.636364,.0909091,.545455,.0454545,.136364,.0454545,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.181818,1,.181818,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.181818,1,.772727,1,.136364,1,.136364,.0454545,.772727,.0454545,.136364,.545455,.545455,.545455,.772727,1,.136364,1,.136364,.0454545,.136364,.545455,.545455,.545455,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.727273,.409091,.5,.409091,.136364,1,.136364,.0454545,.136364,.5,.772727,.5,.772727,1,.772727,.0454545,.227273,1,.681818,1,.454545,1,.454545,.0454545,.227273,.0454545,.681818,.0454545,.727273,1,.727273,.272727,.681818,.136364,.636364,.0909091,.5,.0454545,.409091,.0454545,.272727,.0909091,.227273,.136364,.181818,.272727,.136364,1,.136364,.0454545,.136364,.454545,.727273,1,.318182,.590909,.772727,.0454545,.136364,1,.136364,.0454545,.772727,.0454545,.136364,.0454545,.136364,1,.454545,.5,.772727,1,.772727,.0454545,.136364,.0454545,.136364,1,.772727,.0454545,.772727,1,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.318182,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.136364,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.545455,.545455,.136364,.545455,.409091,1,.272727,.954545,.227273,.909091,.181818,.772727,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.318182,.727273,.772727,.681818,.909091,.636364,.954545,.5,1,.409091,1,.545455,.272727,.772727,.0454545,.136364,.0454545,.136364,1,.545455,1,.636364,.954545,.681818,.863636,.681818,.681818,.636364,.590909,.545455,.545455,.136364,.545455,.545455,.545455,.772727,.0454545,.727273,.772727,.727273,.863636,.636364,.954545,.545455,1,.363636,1,.272727,.954545,.181818,.818182,.181818,.727273,.272727,.590909,.363636,.545455,.590909,.545455,.681818,.5,.727273,.454545,.772727,.363636,.772727,.227273,.727273,.136364,.681818,.0909091,.590909,.0454545,.318182,.0454545,.181818,.136364,.136364,.227273,.136364,1,.772727,1,.454545,1,.454545,.0454545,.181818,1,.181818,.272727,.227273,.136364,.272727,.0909091,.409091,.0454545,.5,.0454545,.636364,.0909091,.681818,.136364,.727273,.272727,.727273,1,.136364,1,.454545,.0454545,.772727,1,.0454545,1,.272727,.0454545,.454545,1,.636364,.0454545,.863636,1,.136364,1,.772727,.0454545,.136364,.0454545,.772727,1,.136364,1,.454545,.454545,.454545,.0454545,.454545,.454545,.772727,1,.136364,1,.772727,1,.136364,.0454545,.772727,.0454545,.636364,1.09091,.318182,1.09091,.318182,-.0454545,.636364,-.0454545,.0454545,1.18182,.863636,-.272727,.272727,1.09091,.590909,1.09091,.590909,-.0454545,.272727,-.0454545,.0909091,.545455,.454545,1,.818182,.545455,0,0,.909091,0,.409091,.909091,.363636,.909091,.5,.636364,.545455,.636364,.409091,.909091,.181818,.909091,.727273,.909091,.181818,.136364,.727273,.136364,.181818,.909091,.136364,.545455,.772727,.545455,.454545,.818182,.409091,.772727,.454545,.727273,.5,.772727,.454545,.818182,.454545,.727273,.454545,.363636,.409091,.318182,.454545,.272727,.5,.318182,.454545,.363636,.454545,.272727,.818182,.909091,.0909091,.590909,.818182,.272727,.818182,.136364,.0909091,.136364,.0909091,.909091,.818182,.590909,.0909091,.272727,.0909091,.136364,.818182,.136364,.454545,.727273,.181818,.272727,.727273,.272727,.454545,.727273,.0454545,.454545,.136364,.454545,.272727,.0454545,.409091,1,.863636,1,.818182,.909091,.0909091,.0909091,.818182,.0909091,.0909091,.909091,.0909091,.863636,.818182,.863636,.0909091,.5,.818182,.5,.818182,.136364,.0909091,.136364,.0909091,.727273,.818182,.727273,.818182,.363636,.0909091,.363636,.272727,.0909091,.636364,.954545,.727273,.863636,.727273,.954545,.681818,1.04545,.636364,1.09091,.545455,1.09091,.5,1.04545,.454545,.954545,.454545,.0909091,.409091,0,.363636,-.0454545,.272727,-.0454545,.227273,0,.181818,.0909091,.181818,.181818,.0454545,.681818,.727273,.681818,.818182,.636364,.863636,.590909,.863636,.454545,.818182,.409091,.727273,.363636,.0454545,.363636,.227273,.772727,.454545,.272727,.681818,.772727,.227273,.272727,.454545,.772727,.681818,.272727,.0454545,.590909,.0909091,.636364,.181818,.681818,.272727,.681818,.636364,.5,.727273,.5,.818182,.545455,.863636,.590909,.863636,.409091,.818182,.363636,.727273,.318182,.636364,.318182,.272727,.5,.181818,.5,.0909091,.454545,.0454545,.409091,.863636,.909091,.863636,1,.0454545,1,.5,.5,.0454545,.0454545,.863636,.0454545,.863636,.136364,.454545,-.0454545,.454545,1.09091,.318182,.5,.590909,.5,.454545,1.09091,.454545,1.09091,.454545,-.0454545,.318182,.545455,.590909,.545455,.454545,-.0454545,-.0909091,.5,1,.5,.454545,.636364,.454545,.363636,1,.5,1,.5,-.0909091,.5,.454545,.636364,.454545,.363636,-.0909091,.5,.363636,.772727,.545455,.772727,.636364,.727273,.681818,.681818,.727273,.590909,.727273,.409091,.681818,.318182,.636364,.272727,.545455,.227273,.363636,.227273,.272727,.272727,.227273,.318182,.181818,.409091,.181818,.590909,.227273,.681818,.272727,.727273,.363636,.772727,.727273,1,.272727,.0454545,.5,.818182,.590909,.818182,.636364,.727273,.681818,.590909,.681818,.454545,.636364,.318182,.545455,.136364,.409091,.0454545,.318182,.0454545,.272727,.136364,.227273,.272727,.227273,.409091,.272727,.545455,.363636,.727273,.5,.818182,.272727,.454545,.681818,.454545,.136364,.636364,.136364,.681818,.181818,.772727,.272727,.818182,.318182,.818182,.409091,.772727,.454545,.681818,.454545,.0454545,.454545,.681818,.5,.772727,.590909,.818182,.636364,.818182,.727273,.772727,.772727,.681818,.772727,.636364,.227273,.636364,.227273,.545455,.272727,.409091,.318182,.318182,.409091,.272727,.5,.272727,.590909,.318182,.636364,.409091,.681818,.545455,.681818,.636364,.454545,.818182,.454545,.0454545,.0454545,.727273,.0454545,.318182,.0909091,.181818,.136364,.0909091,.227273,.0454545,.318182,.0454545,.409091,.0909091,.454545,.181818,.454545,.590909,.454545,.181818,.5,.0909091,.590909,.0454545,.681818,.0454545,.772727,.0909091,.818182,.181818,.863636,.318182,.863636,.590909,.818182,.818182,.136364,1,.318182,.818182,.409091,.681818,.5,.454545,.545455,.318182,.636364,.181818,.772727,.0454545,.136364,.0454545,.272727,.181818,.454545,.5,.590909,.363636,.545455,.454545,.454545,.545455,.363636,.590909,.272727,.590909,.181818,.545455,.0909091,.454545,.0454545,.363636,.0454545,.272727,.0909091,.181818,.181818,.0909091,.272727,.0454545,.363636,.0454545,.454545,.0909091,.545455,.181818,.590909,.272727,.818182,.590909,.727273,.545455,.636364,.454545,.590909,.363636,.590909,.272727,.636364,.181818,.727273,.0909091,.818182,.0454545,.5,.590909,.409091,.590909,.318182,.545455,.227273,.454545,.181818,.363636,.181818,.272727,.227273,.181818,.318182,.0909091,.409091,.0454545,.5,.0454545,.590909,.0909091,.681818,.181818,.727273,.272727,.727273,.363636,.681818,.454545,.590909,.545455,.454545,.636364,.363636,.727273,.318182,.818182,.318182,.909091,.409091,.954545,.545455,.954545,.590909,.909091,.636364,.818182,.0909091,-.181818,.227273,.590909,.181818,.272727,.227273,.136364,.318182,.0454545,.5,.0454545,.590909,.136364,.636364,.272727,.681818,.590909,.590909,.136364,.636364,.0454545,.727273,.0454545,.0454545,1,.863636,1,.227273,1,.227273,.0454545,.681818,.0454545,.681818,1,.863636,1,.0454545,1,.863636,1,.454545,.954545,.5,.863636,.454545,.272727,.409091,.863636,.454545,.954545,.454545,.5,.454545,.0909091,.5,.0454545,.454545,0,.409091,.0454545,.454545,.0909091,.454545,0,.318182,.954545,.318182,.727273,.590909,.954545,.590909,.727273,.363636,.818182,.363636,.0909091,.227273,.363636,.681818,.363636,.545455,.0909091,.545455,.818182,.681818,.636364,.227273,.636364,.681818,.681818,.636364,.818182,.545455,.863636,.363636,.863636,.272727,.772727,.227273,.681818,.227273,.590909,.272727,.545455,.636364,.409091,.681818,.363636,.681818,.272727,.636364,.181818,.545455,.0909091,.363636,.0909091,.272727,.136364,.227273,.272727,.409091,0,.409091,.954545,.5,.954545,.5,0,.727273,.954545,.181818,.0454545,.590909,.136364,.636364,.136364,.727273,.227273,.727273,.318182,.636364,.409091,.590909,.409091,.5,.318182,.5,.227273,.590909,.136364,.363636,.636364,.318182,.636364,.227273,.727273,.227273,.818182,.318182,.909091,.363636,.909091,.454545,.818182,.454545,.727273,.363636,.636364,.681818,0,.454545,.363636,.409091,.545455,.318182,.590909,.272727,.681818,.272727,.772727,.318182,.909091,.363636,.954545,.454545,.954545,.5,.909091,.545455,.772727,.545455,.681818,.5,.590909,.363636,.590909,.272727,.5,.227273,.409091,.181818,.272727,.181818,.136364,.227273,.0454545,.318182,0,.454545,0,.545455,.0454545,.681818,.181818,.727273,.272727,.727273,.318182,.409091,.590909,.5,.863636,.545455,1.04545,.454545,1,.363636,.909091,.318182,.818182,.318182,.136364,.363636,.0454545,.454545,-.0454545,.545455,-.0909091,.363636,1.04545,.454545,1,.545455,.909091,.590909,.818182,.590909,.136364,.545455,.0454545,.454545,-.0454545,.363636,-.0909091,.454545,.727273,.454545,.272727,.727273,.227273,.181818,.772727,.727273,.772727,.181818,.227273,.227273,.5,.681818,.5,.272727,.454545,.636364,.454545,.454545,.636364,.454545,.272727,.5,.0454545,.454545,0,.409091,.0454545,.454545,.0909091,.5,.0454545,.5,-.0454545,.454545,-.136364,.409091,-.181818,.272727,.454545,.636364,.454545,.409091,-.0454545,.409091,.0454545,.5,.0454545,.5,-.0454545,.409091,-.0454545,.681818,.909091,.227273,.0454545,.409091,.954545,.318182,.909091,.272727,.863636,.227273,.772727,.227273,.181818,.272727,.0909091,.318182,.0454545,.409091,0,.5,0,.590909,.0454545,.636364,.0909091,.681818,.181818,.681818,.772727,.636364,.863636,.590909,.909091,.5,.954545,.409091,.954545,.363636,.772727,.5,.954545,.5,0,.181818,.727273,.227273,.863636,.272727,.909091,.409091,.954545,.5,.954545,.636364,.909091,.681818,.863636,.727273,.727273,.727273,.636364,.181818,0,.727273,0,.136364,.954545,.636364,.954545,.727273,.909091,.772727,.818182,.772727,.727273,.727273,.636364,.636364,.590909,.409091,.590909,.636364,.590909,.727273,.545455,.772727,.454545,.772727,.136364,.727273,.0454545,.636364,0,.136364,0,.454545,.954545,.136364,.272727,.772727,.272727,.545455,.545455,.545455,0,.772727,.954545,.136364,.954545,.136364,.5,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.181818,.727273,.0909091,.681818,.0454545,.590909,0,.136364,0,.545455,.954545,.409091,.909091,.318182,.863636,.227273,.772727,.181818,.681818,.136364,.545455,.136364,.181818,.181818,.0454545,.318182,0,.590909,0,.727273,.0454545,.772727,.181818,.772727,.318182,.727273,.454545,.590909,.5,.136364,.5,.136364,.954545,.772727,.954545,.409091,0,.545455,.954545,.681818,.909091,.727273,.772727,.727273,.727273,.681818,.590909,.545455,.545455,.363636,.545455,.227273,.590909,.181818,.727273,.181818,.772727,.227273,.909091,.363636,.954545,.545455,.954545,.590909,.545455,.727273,.5,.772727,.363636,.772727,.181818,.727273,.0454545,.590909,0,.318182,0,.181818,.0454545,.136364,.181818,.136364,.363636,.181818,.5,.318182,.545455,.772727,.454545,.318182,.454545,.181818,.5,.136364,.636364,.136364,.772727,.181818,.909091,.318182,.954545,.590909,.954545,.727273,.909091,.772727,.772727,.772727,.409091,.727273,.272727,.681818,.181818,.590909,.0909091,.5,.0454545,.363636,0,.318182,0,.454545,.636364,.409091,.590909,.454545,.545455,.5,.590909,.454545,.636364,.454545,.0909091,.409091,.0454545,.454545,0,.5,.0454545,.454545,.0909091,.454545,.636364,.409091,.590909,.454545,.545455,.5,.590909,.454545,.636364,.5,.0454545,.454545,0,.409091,.0454545,.454545,.0909091,.5,.0454545,.5,-.0454545,.454545,-.136364,.409091,-.181818,.636364,.772727,.227273,.454545,.636364,.136364,.272727,.5,.636364,.5,.636364,.363636,.272727,.363636,.272727,.772727,.681818,.454545,.272727,.136364,.227273,.727273,.227273,.772727,.272727,.863636,.318182,.909091,.409091,.954545,.5,.954545,.590909,.909091,.636364,.863636,.681818,.772727,.681818,.681818,.636364,.590909,.590909,.545455,.454545,.454545,.454545,.181818,.454545,.0909091,.409091,.0454545,.454545,0,.5,.0454545,.454545,.0909091,.454545,0,.636364,.727273,.545455,.727273,.454545,.681818,.409091,.590909,.409091,.5,.454545,.409091,.545455,.363636,.636364,.363636,.727273,.409091,.772727,.5,.772727,.590909,.727273,.681818,.590909,.818182,.5,.863636,.363636,.863636,.272727,.818182,.181818,.727273,.136364,.636364,.136364,.454545,.181818,.363636,.272727,.227273,.318182,.181818,.454545,.0909091,.545455,.0909091,.636364,.136364,.727273,.227273,.136364,0,.454545,.954545,.772727,0,.272727,.409091,.636364,.409091,.136364,0,.136364,.954545,.545455,.954545,.636364,.909091,.681818,.818182,.681818,.636364,.636364,.545455,.545455,.5,.136364,.5,.545455,.5,.636364,.454545,.681818,.409091,.727273,.318182,.727273,.181818,.681818,.0909091,.636364,.0454545,.545455,0,.136364,0,.727273,.727273,.681818,.863636,.636364,.909091,.5,.954545,.409091,.954545,.272727,.909091,.227273,.863636,.181818,.727273,.181818,.227273,.227273,.0909091,.272727,.0454545,.409091,0,.5,0,.636364,.0454545,.681818,.0909091,.727273,.227273,.181818,.954545,.181818,0,.5,0,.636364,.0454545,.681818,.0909091,.727273,.227273,.727273,.727273,.681818,.863636,.636364,.909091,.5,.954545,.181818,.954545,.772727,.954545,.136364,.954545,.136364,0,.772727,0,.136364,.5,.545455,.5,.772727,.954545,.136364,.954545,.136364,0,.136364,.5,.545455,.5,.727273,.727273,.681818,.863636,.636364,.909091,.5,.954545,.409091,.954545,.272727,.909091,.227273,.863636,.181818,.727273,.181818,.227273,.227273,.0909091,.272727,.0454545,.409091,0,.5,0,.636364,.0454545,.681818,.0909091,.727273,.227273,.727273,.363636,.5,.363636,.136364,.954545,.136364,0,.136364,.454545,.772727,.454545,.772727,.954545,.772727,0,.227273,.954545,.681818,.954545,.454545,.954545,.454545,0,.227273,0,.681818,0,.727273,.954545,.727273,.227273,.681818,.0909091,.636364,.0454545,.5,0,.409091,0,.272727,.0454545,.227273,.0909091,.181818,.227273,.136364,.954545,.136364,0,.136364,.409091,.727273,.954545,.318182,.545455,.772727,0,.136364,.954545,.136364,0,.772727,0,.136364,0,.136364,.954545,.454545,.454545,.772727,.954545,.772727,0,.136364,0,.136364,.954545,.772727,0,.772727,.954545,.409091,.954545,.272727,.909091,.227273,.863636,.181818,.727273,.181818,.227273,.227273,.0909091,.272727,.0454545,.409091,0,.5,0,.636364,.0454545,.681818,.0909091,.727273,.272727,.727273,.727273,.681818,.863636,.636364,.909091,.5,.954545,.409091,.954545,.136364,0,.136364,.954545,.545455,.954545,.636364,.909091,.681818,.818182,.681818,.636364,.636364,.545455,.545455,.5,.136364,.5,.409091,.954545,.272727,.909091,.227273,.863636,.181818,.727273,.181818,.227273,.227273,.0909091,.272727,.0454545,.409091,0,.5,0,.636364,.0454545,.681818,.0909091,.727273,.272727,.727273,.727273,.681818,.863636,.636364,.909091,.5,.954545,.409091,.954545,.545455,.227273,.772727,0,.136364,0,.136364,.954545,.545455,.954545,.636364,.909091,.681818,.818182,.681818,.636364,.636364,.545455,.545455,.5,.136364,.5,.545455,.5,.772727,0,.727273,.727273,.727273,.818182,.636364,.909091,.545455,.954545,.363636,.954545,.272727,.909091,.181818,.772727,.181818,.681818,.272727,.545455,.363636,.5,.590909,.5,.681818,.454545,.727273,.409091,.772727,.318182,.772727,.181818,.727273,.0909091,.681818,.0454545,.590909,0,.318182,0,.181818,.0909091,.136364,.181818,.136364,.954545,.772727,.954545,.454545,.954545,.454545,0,.181818,.954545,.181818,.227273,.227273,.0909091,.272727,.0454545,.409091,0,.5,0,.636364,.0454545,.681818,.0909091,.727273,.227273,.727273,.954545,.136364,.954545,.454545,0,.772727,.954545,.0454545,.954545,.272727,0,.454545,.954545,.636364,0,.863636,.954545,.136364,.954545,.772727,0,.136364,0,.772727,.954545,.136364,.954545,.454545,.409091,.454545,0,.454545,.409091,.772727,.954545,.136364,.954545,.772727,.954545,.136364,0,.772727,0,.318182,1.04545,0,1.04545,0,-.0909091,.318182,-.0909091,.0454545,1.13636,.863636,-.318182,0,1.04545,.318182,1.04545,.318182,-.0909091,0,-.0909091,.0909091,.5,.454545,.954545,.818182,.5,0,-.0454545,.909091,-.0454545,.272727,.454545,.636364,.454545,.454545,.636364,.454545,.272727,.272727,.272727,.636364,.272727,.818182,.681818,.0909091,.272727,.818182,.272727,.0909091,.0909091,.818182,.0909091,.454545,.0909091,.454545,.863636,.0454545,.181818,.272727,.636364,.863636,.636364,.636364,.181818,.0454545,.181818,.0454545,.318182,.0454545,.363636,.0909091,.545455,.136364,.636364,.181818,.681818,.363636,.772727,.545455,.772727,.727273,.681818,.772727,.636364,.818182,.545455,.863636,.363636,.863636,.318182,.0454545,.318182,.409091,.818182,.5,.818182,.636364,.772727,.772727,.636364,.818182,.5,.818182,.409091,.772727,.272727,.636364,.136364,.5,.0909091,.409091,.0909091,.272727,.136364,.136364,.272727,.0909091,.409091,.0909091,.5,.136364,.636364,.272727,.772727,.409091,.818182,.454545,.818182,.0909091,.0909091,.772727,.818182,.409091,.0909091,.409091,.727273,.5,.727273,.590909,.681818,.636364,.636364,.681818,.545455,.681818,.454545,.636364,.363636,.590909,.318182,.5,.272727,.409091,.272727,.318182,.318182,.272727,.363636,.227273,.454545,.227273,.545455,.272727,.636364,.318182,.681818,.409091,.727273,.318182,.818182,.0454545,.0909091,.545455,.0909091,.818182,.818182,.0454545,.0454545,.863636,.863636,.318182,.545455,.545455,.318182,.863636,.863636,.181818,.727273,.727273,.727273,.863636,.454545,.0454545,.454545,.181818,.181818,.727273,.181818,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.409091,.636364,.318182,.590909,.272727,.5,.227273,.409091,.227273,.318182,.272727,.272727,.318182,.227273,.409091,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.454545,.818182,.454545,.0909091,.0909091,.454545,.818182,.454545,.0454545,.318182,.0454545,.363636,.0909091,.545455,.136364,.636364,.181818,.681818,.363636,.772727,.545455,.772727,.727273,.681818,.772727,.636364,.818182,.545455,.863636,.363636,.863636,.318182,.409091,.818182,.5,.818182,.636364,.772727,.772727,.636364,.818182,.5,.818182,.409091,.772727,.272727,.636364,.136364,.5,.0909091,.409091,.0909091,.272727,.136364,.136364,.272727,.0909091,.409091,.0909091,.5,.136364,.636364,.272727,.772727,.409091,.818182,.318182,.636364,.318182,.272727,.590909,.272727,.409091,.818182,.5,.818182,.636364,.772727,.772727,.636364,.818182,.5,.818182,.409091,.772727,.272727,.636364,.136364,.5,.0909091,.409091,.0909091,.272727,.136364,.136364,.272727,.0909091,.409091,.0909091,.5,.136364,.636364,.272727,.772727,.409091,.818182,.318182,.272727,.318182,.636364,.454545,.454545,.590909,.636364,.590909,.272727,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.409091,.636364,.318182,.590909,.272727,.5,.227273,.409091,.227273,.318182,.272727,.272727,.318182,.227273,.409091,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.636364,.818182,.272727,.0909091,.0909091,.772727,.818182,.772727,.818182,.181818,.0909091,.181818,.0909091,.772727,.409091,.818182,.5,.818182,.636364,.772727,.772727,.636364,.818182,.5,.818182,.409091,.772727,.272727,.636364,.136364,.5,.0909091,.409091,.0909091,.272727,.136364,.136364,.272727,.0909091,.409091,.0909091,.5,.136364,.636364,.272727,.772727,.409091,.818182,.318182,.272727,.318182,.272727,.318182,.636364,.545455,.636364,.590909,.590909,.590909,.5,.545455,.454545,.318182,.454545,.318182,.954545,.318182,0,.772727,0,.5,.318182,.454545,.227273,.409091,.181818,.227273,.181818,.181818,.227273,.136364,.318182,.136364,.590909,.181818,.681818,.227273,.727273,.409091,.727273,.454545,.681818,.5,.590909,.409091,.818182,.5,.818182,.636364,.772727,.772727,.636364,.818182,.5,.818182,.409091,.772727,.272727,.636364,.136364,.5,.0909091,.409091,.0909091,.272727,.136364,.136364,.272727,.0909091,.409091,.0909091,.5,.136364,.636364,.272727,.772727,.409091,.818182,.409091,.681818,.5,.681818,.590909,.636364,.636364,.590909,.681818,.5,.681818,.409091,.636364,.318182,.590909,.272727,.5,.227273,.409091,.227273,.318182,.272727,.272727,.318182,.227273,.409091,.227273,.5,.272727,.590909,.318182,.636364,.409091,.681818,.409091,.818182,.5,.818182,.636364,.772727,.772727,.636364,.818182,.5,.818182,.409091,.772727,.272727,.636364,.136364,.5,.0909091,.409091,.0909091,.272727,.136364,.136364,.272727,.0909091,.409091,.0909091,.5,.136364,.636364,.272727,.772727,.409091,.818182,.545455,.545455,.5,.636364,.409091,.636364,.363636,.545455,.363636,.5,.545455,.409091,.545455,.363636,.5,.272727,.409091,.272727,.363636,.363636,.0454545,.136364,.5,.818182,.227273,.545455,.363636,.454545,.5,.818182,.0454545,.136364,.409091,.136364,.863636,.818182,.590909,.545455,.727273,.454545,.863636,.818182,.0909091,.454545,.818182,.454545,.272727,.272727,.272727,.0909091,.636364,.0909091,.636364,.272727,.272727,.363636,.454545,.0909091,.636364,.363636,.0909091,.772727,.818182,.772727,.454545,.772727,.454545,.181818,.318182,.318182,.454545,.181818,.590909,.318182,.0454545,.454545,.863636,.454545,.136364,.681818,.136364,.227273,.863636,.454545,.0454545,.0909091,.0454545,.545455,.863636,.0909091,.0454545,.0909091,.681818,1.04545,.590909,1.04545,.454545,1,.409091,.954545,.363636,.818182,.363636,.636364,.318182,.545455,.272727,.5,.318182,.454545,.363636,.363636,.363636,.136364,.409091,0,.454545,-.0454545,.590909,-.0909091,.681818,-.0909091,.454545,1.04545,.454545,-.0909091,.227273,1.04545,.318182,1.04545,.454545,1,.5,.954545,.545455,.818182,.545455,.636364,.590909,.545455,.636364,.5,.590909,.454545,.545455,.363636,.545455,.136364,.5,0,.454545,-.0454545,.363636,-.0909091,.272727,-.0909091,.409091,.590909,.5,.590909,.590909,.681818,.590909,.772727,.5,.863636,.409091,.863636,.318182,.772727,.318182,.681818,.409091,.590909],this.fontIndices=[0,0,2,7,0,5,10,0,2,4,6,8,0,2,4,23,0,2,14,23,0,34,0,5,0,10,0,10,0,2,4,6,0,2,4,0,8,0,2,0,5,0,2,0,17,0,4,0,14,0,15,0,3,5,0,17,0,23,0,2,4,0,29,0,23,0,5,10,0,5,13,0,3,0,2,4,0,3,0,14,19,0,3,5,8,10,12,0,2,4,6,0,2,11,21,0,18,0,2,14,0,2,4,6,8,0,2,4,6,0,19,21,0,2,4,6,0,2,0,10,0,2,4,6,0,2,4,0,2,4,6,8,0,2,4,6,0,21,0,2,12,0,20,22,0,2,12,14,0,20,0,2,4,0,10,0,2,4,0,5,0,2,4,0,3,5,0,2,4,6,0,2,4,6,8,0,2,4,6,0,2,4,6,8,0,3,0,2,0,9,0,2,16,0,2,16,0,14,0,2,16,0,17,0,5,7,0,7,21,0,2,9,0,5,7,0,5,10,0,2,4,6,0,2,0,2,9,16,0,2,9,0,17,0,2,16,0,2,16,0,2,7,0,17,0,5,7,0,7,9,0,2,4,0,2,4,6,8,0,2,4,0,2,8,0,2,4,6,0,6,8,10,21,23,25,31,0,13,15,0,6,8,10,21,23,25,31,0,8,0,0,0,2,4,0,5,10,0,2,4,6,8,0,22,24,0,2,14,23,0,20,0,5,0,6,0,6,0,2,4,6,0,2,4,0,8,0,2,0,5,0,2,0,17,0,3,0,11,0,10,21,0,3,5,0,15,0,24,0,4,0,17,33,0,23,0,5,10,0,5,13,0,3,0,2,4,0,3,0,13,15,0,3,5,8,10,12,0,3,5,0,10,20,0,14,0,11,0,4,6,0,3,5,0,17,0,2,4,6,0,2,0,6,0,2,4,6,0,3,0,5,0,4,0,17,0,10,12,0,17,19,0,10,12,14,0,22,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,0,2,4,6,8,0,2,4,6,0,2,4,6,8,0,3,0,2,0,9,0,17,19,0,17,19,0,14,0,17,19,0,17,0,5,7,0,17,25,0,2,11,0,2,4,0,2,8,0,2,4,6,0,3,0,2,11,20,0,2,11,0,17,0,17,19,0,17,19,0,2,7,0,17,0,4,6,0,10,0,3,0,5,0,2,4,0,2,6,0,4,0,6,8,10,21,23,25,31,0,13,15,0,6,8,10,21,23,25,31,0,8,0,0,0,2,4,0,5,10,0,2,4,6,8,0,2,4,23,0,2,14,23,0,22,0,5,0,10,0,10,0,2,4,6,0,2,4,0,8,0,2,0,5,0,2,0,17,19,0,2,0,16,0,11,23,0,4,0,17,0,24,0,5,0,33,0,24,0,5,10,0,5,13,0,3,0,2,4,0,3,0,14,19,0,3,5,8,10,12,0,3,5,0,11,19,0,13,0,15,0,4,6,0,3,5,0,15,0,2,4,6,0,2,4,6,0,8,0,2,4,6,0,3,0,5,0,4,0,21,0,11,0,21,23,0,11,13,0,18,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,6,0,4,0,2,4,6,0,4,0,3,0,2,0,9,0,14,16,0,14,16,0,14,0,14,16,0,16,0,8,10,0,14,21,0,2,11,0,2,4,0,2,10,0,2,4,6,0,2,0,2,11,20,0,2,11,0,17,0,14,16,0,14,16,0,2,9,0,17,0,2,4,0,10,12,0,3,0,5,0,2,4,0,2,7,0,4,6,0,6,8,10,21,23,25,31,0,13,15,0,6,8,10,21,23,25,31,0,6,0,0,0,2,4,0,2,4,0,2,4,6,8,0,12,14,0,9,11,20,0,22,0,2,0,8,0,8,0,2,4,6,0,2,4,0,8,0,2,0,5,0,2,0,17,0,3,0,12,0,10,19,0,3,5,0,12,0,18,0,3,5,0,28,0,21,0,2,4,0,2,4,0,3,0,2,4,0,3,0,12,14,0,3,5,8,10,12,0,3,5,0,15,17,0,10,0,11,0,4,6,0,3,5,0,12,0,2,4,6,0,2,0,6,0,2,4,6,0,3,0,5,0,4,0,17,0,11,0,17,19,0,11,13,0,15,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,0,4,0,2,4,6,0,4,0,3,0,2,0,9,0,14,0,11,0,10,0,11,0,15,0,5,7,0,15,0,2,8,0,2,4,0,2,8,0,2,4,6,0,5,0,6,8,0,7,0,17,0,11,0,11,0,6,0,12,0,2,4,0,7,0,3,0,5,0,2,4,0,2,6,0,4,0,6,8,10,21,23,25,31,0,13,15,0,6,8,10,21,23,25,31,0,6,0,0,0,2,4,0,2,4,0,2,4,6,8,0,12,14,0,9,11,20,0,25,0,2,0,8,0,8,0,2,4,6,0,2,4,0,8,0,2,0,5,0,2,0,17,0,3,5,0,15,0,11,22,0,4,0,16,0,23,0,3,0,32,0,23,0,2,4,0,2,4,0,3,0,2,4,0,3,0,12,14,0,3,5,8,10,12,0,3,5,0,9,18,0,16,0,11,0,4,6,0,3,5,0,18,20,0,2,4,6,0,2,0,7,0,2,4,6,0,3,0,5,0,4,0,17,0,11,0,17,21,0,11,13,0,24,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,0,4,0,2,4,6,0,4,0,3,0,2,0,9,0,8,19,0,2,16,0,14,0,2,16,0,16,0,4,6,0,14,19,32,0,2,9,0,2,4,0,2,7,0,2,4,6,0,2,0,2,9,16,0,2,9,0,17,0,2,16,0,2,16,0,2,7,0,16,0,5,7,0,7,9,0,3,0,5,0,2,4,0,2,7,0,4,0,6,8,10,21,23,25,31,0,13,15,0,6,8,10,21,23,25,31,0,6,0,0,0,6,12,0,2,4,0,2,4,6,8,0,16,18,20,0,2,11,20,0,25,0,2,0,8,0,8,0,2,4,6,8,0,2,4,0,8,0,2,0,5,0,2,0,17,0,3,0,11,0,8,15,0,3,5,0,12,0,16,0,3,0,13,25,0,17,0,5,10,0,5,13,0,3,0,2,4,0,3,0,14,20,0,26,0,3,5,0,9,18,0,16,0,11,0,4,6,0,3,5,0,18,0,2,4,6,0,2,4,6,0,9,0,2,4,6,0,3,0,5,0,4,0,17,0,9,0,17,19,0,9,11,0,21,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,0,4,0,2,0,4,0,3,0,2,0,5,0,3,0,6,8,0,5,0,13,0,17,0,2,4,0,17,19,21,0,5,0,2,4,6,0,17,19,21,0,12,0,2,4,0,17,22,0,17,19,0,17,0,17,25,0,3,15,0,17,34,0,17,27,0,7,0,19,0,5,0,6,0,5,0,4,0,3,5,0,15,0,2,0,15,0,8,0,0,0,4,7,10,14,23,28,0,3,5,8,11,13,16,0,5,10,15,20,0,2,4,24,30,51,0,2,14,23,32,41,0,36,41,43,45,47,52,58,66,0,3,5,8,0,10,16,24,0,10,16,24,0,4,6,10,14,16,20,24,26,30,0,3,6,9,12,0,11,16,18,20,0,3,6,0,9,14,0,3,6,0,17,23,29,37,45,0,2,4,6,9,11,13,15,17,19,0,5,28,32,39,45,49,55,0,5,22,26,32,52,56,63,68,0,2,4,6,9,11,13,15,17,19,0,23,27,35,40,42,44,48,0,5,36,42,46,55,63,0,2,9,13,19,27,31,36,0,13,17,21,27,33,49,53,57,63,69,0,5,36,40,46,54,63,0,9,14,23,28,0,9,14,25,30,32,34,0,7,0,3,6,9,12,0,7,0,17,21,27,32,41,46,0,8,27,0,2,4,6,8,10,12,14,16,18,20,22,24,0,2,4,6,15,19,25,35,39,45,47,49,51,53,55,57,59,61,0,20,26,34,0,2,4,6,18,24,32,34,36,38,40,42,44,46,48,0,2,4,6,9,11,13,16,18,20,22,24,26,28,30,32,35,38,41,43,45,47,49,51,53,55,57,0,2,4,6,9,11,13,15,17,19,21,23,25,27,29,31,34,37,40,42,44,46,48,0,21,27,35,37,40,42,44,46,48,50,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,0,2,4,6,8,10,12,14,16,18,20,22,24,26,0,4,7,21,26,28,30,32,34,36,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,0,2,4,6,8,11,13,15,17,19,21,23,25,27,29,31,33,35,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,0,2,4,6,8,10,12,14,16,18,20,22,24,26,0,21,27,33,41,49,0,2,4,6,16,20,26,28,30,32,34,36,38,40,42,44,0,21,27,33,41,49,60,64,69,0,2,4,6,16,20,26,34,38,44,46,48,50,52,54,56,58,60,62,0,17,23,41,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,0,10,13,18,20,22,24,26,28,30,32,34,0,2,5,7,9,11,13,15,17,19,21,23,0,2,5,7,10,12,15,17,20,22,24,26,28,30,32,34,36,38,0,2,4,6,8,10,12,14,16,18,20,22,24,27,30,32,34,0,3,6,9,11,13,15,17,19,21,23,25,27,29,31,33,0,3,5,7,9,12,14,16,18,20,22,24,26,28,0,2,4,6,8,0,5,10,15,0,2,4,6,8,0,7,0,2,0,13,20,27,0,15,19,26,37,41,48,0,4,6,9,23,27,35,37,39,0,19,23,31,0,3,5,8,22,26,34,36,38,40,42,0,17,20,24,28,36,0,12,15,19,21,23,25,27,29,31,0,7,24,28,32,38,44,54,58,73,79,0,2,4,7,16,19,23,25,27,29,31,33,35,37,39,41,43,45,47,0,5,7,9,11,13,16,18,20,22,24,26,28,30,0,5,7,9,13,16,29,31,33,0,2,4,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,0,2,4,7,9,11,13,15,17,19,21,0,4,7,9,11,13,15,17,19,21,28,30,34,36,41,44,51,53,57,59,64,67,0,2,4,7,16,19,23,25,27,29,31,33,35,37,39,41,43,45,47,0,17,21,25,33,41,0,2,4,7,21,25,33,35,37,39,41,43,45,47,0,2,4,8,22,26,34,36,38,40,42,44,0,2,4,7,18,20,22,24,26,28,30,32,0,15,17,21,23,38,0,8,11,16,18,0,9,12,17,20,22,25,27,29,31,33,0,2,4,6,9,11,13,15,17,19,21,0,2,4,6,9,11,13,16,19,21,23,25,27,29,31,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,0,2,4,6,18,20,22,24,26,28,30,0,2,4,6,9,12,14,16,18,20,22,24,26,28,0,6,8,10,21,23,25,31,0,13,26,31,0,6,8,10,21,23,25,31,0,6,0,0,0,6,12,0,2,4,0,2,4,6,0,9,0,2,11,20,0,25,0,2,0,8,0,8,0,2,4,6,8,0,2,4,0,8,0,2,0,5,0,2,0,17,0,3,0,11,0,8,15,0,3,5,0,12,0,16,0,3,0,13,25,0,17,0,5,10,0,5,13,0,3,0,2,4,0,3,0,14,20,0,26,0,3,5,0,9,18,0,16,0,11,0,4,6,0,3,5,0,18,0,2,4,6,0,2,4,6,0,9,0,2,4,6,0,3,0,5,0,4,0,17,0,9,0,17,19,0,9,11,0,21,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,0,4,0,2,0,4,0,3,0,2,0,5,0,5,0,2,8,14,0,3,5,0,3,5,0,4,0,5,0,2,4,0,2,4,6,0,2,4,6,0,14,0,8,0,3,0,3,0,8,16,0,7,0,5,0,5,0,5,0,5,0,17,19,0,15,17,0,8,15,0,10,12,0,9,18,0,7,10,0,16,24,0,24,0,2,9,12,0,2,4,6,0,3,0,0,0,6,12,0,2,4,0,2,4,6,8,0,16,18,20,0,2,11,20,0,25,0,2,0,8,0,8,0,2,4,6,8,0,2,4,0,8,0,2,0,5,0,2,0,17,0,3,0,11,0,8,15,0,3,5,0,12,0,16,0,3,0,13,25,0,17,0,5,10,0,5,13,0,3,0,2,4,0,3,0,14,20,0,26,0,3,5,0,9,18,0,16,0,11,0,4,6,0,3,5,0,18,0,2,4,6,0,2,4,6,0,9,0,2,4,6,0,3,0,5,0,4,0,17,0,9,0,17,19,0,9,11,0,21,0,2,4,0,10,0,3,0,5,0,2,4,0,3,5,0,4,0,4,0,2,0,4,0,3,0,2,0,2,4,6,0,3,0,2,4,0,5,0,13,0,17,0,2,4,0,17,19,21,0,5,0,2,4,6,0,17,19,21,0,12,0,17,20,0,17,22,0,17,19,0,5,0,17,25,0,3,15,0,17,34,0,17,27,0,5,11,0,2,0,4,0,3,0,2,5,7,0,5,0,4,0,15,0,2,0,15,0,9,0],this.indexStartPerSymbol=[0,1,4,7,12,16,20,22,24,26,28,32,35,37,39,41,43,45,47,49,51,54,56,58,61,63,65,68,71,73,76,78,81,87,91,95,97,100,105,109,112,116,118,120,124,127,132,136,138,141,144,148,150,153,155,158,160,163,166,170,175,179,184,186,188,190,193,196,198,201,203,206,209,212,215,218,222,224,228,231,233,236,239,242,244,247,250,253,258,261,264,268,276,279,287,289,290,291,294,297,302,305,309,311,313,315,317,321,324,326,328,330,332,334,336,338,341,344,346,348,350,353,355,358,361,363,366,368,371,377,380,383,385,387,390,393,395,399,401,403,407,409,411,413,415,418,421,425,427,430,432,434,436,439,442,444,449,453,458,460,462,464,467,470,472,475,477,480,483,486,489,492,496,498,502,505,507,510,513,516,518,521,523,525,527,530,533,535,543,546,554,556,557,558,561,564,569,573,577,579,581,583,585,589,592,594,596,598,600,603,605,607,610,612,614,616,618,620,622,625,628,630,633,635,638,644,647,650,652,654,657,660,662,666,670,672,676,678,680,682,684,686,689,692,694,697,699,701,703,706,709,712,714,718,720,722,724,726,729,732,734,737,739,742,745,748,751,754,758,760,764,767,769,772,775,778,780,783,786,788,790,793,796,799,807,810,818,820,821,822,825,828,833,836,840,842,844,846,848,852,855,857,859,861,863,865,867,869,872,875,877,879,882,884,886,889,892,894,897,899,902,908,911,914,916,918,921,924,926,930,932,934,938,940,942,944,946,948,951,954,956,959,961,963,965,968,971,973,975,979,981,983,985,987,989,991,993,995,997,1e3,1002,1005,1008,1011,1015,1017,1020,1022,1024,1026,1028,1030,1032,1035,1037,1039,1041,1044,1047,1049,1057,1060,1068,1070,1071,1072,1075,1078,1083,1086,1090,1092,1094,1096,1098,1102,1105,1107,1109,1111,1113,1115,1118,1120,1123,1125,1127,1129,1131,1133,1135,1138,1141,1143,1146,1148,1151,1157,1160,1163,1165,1167,1170,1173,1176,1180,1182,1184,1188,1190,1192,1194,1196,1198,1201,1204,1206,1209,1211,1213,1215,1218,1221,1223,1225,1229,1231,1233,1235,1237,1240,1243,1245,1248,1250,1253,1257,1260,1263,1266,1270,1272,1276,1279,1281,1284,1287,1290,1292,1295,1298,1300,1302,1305,1308,1310,1318,1321,1329,1331,1332,1333,1336,1339,1344,1348,1352,1354,1356,1358,1360,1365,1368,1370,1372,1374,1376,1378,1380,1382,1385,1388,1390,1392,1394,1397,1399,1402,1405,1407,1410,1412,1415,1417,1420,1423,1425,1427,1430,1433,1435,1439,1443,1445,1449,1451,1453,1455,1457,1459,1462,1465,1467,1470,1472,1474,1476,1479,1482,1484,1486,1488,1490,1492,1494,1496,1498,1501,1503,1505,1507,1510,1514,1516,1520,1524,1526,1529,1532,1535,1537,1540,1543,1546,1549,1551,1553,1555,1557,1559,1561,1564,1566,1568,1570,1572,1573,1574,1581,1588,1593,1599,1605,1614,1618,1622,1626,1636,1641,1646,1649,1652,1655,1661,1671,1679,1688,1698,1706,1713,1721,1732,1739,1744,1751,1753,1758,1760,1767,1770,1783,1801,1805,1820,1847,1870,1881,1909,1923,1933,1957,1975,1997,2011,2017,2033,2042,2061,2065,2085,2097,2109,2127,2144,2160,2174,2179,2183,2188,2190,2192,2196,2203,2212,2216,2227,2233,2243,2254,2273,2287,2296,2317,2328,2350,2369,2375,2389,2401,2413,2419,2424,2435,2446,2461,2478,2489,2503,2511,2515,2523,2525,2526,2527,2530,2533,2537,2539,2543,2545,2547,2549,2551,2556,2559,2561,2563,2565,2567,2569,2571,2573,2576,2579,2581,2583,2585,2588,2590,2593,2596,2598,2601,2603,2606,2608,2611,2614,2616,2618,2621,2624,2626,2630,2634,2636,2640,2642,2644,2646,2648,2650,2653,2656,2658,2661,2663,2665,2667,2670,2673,2675,2677,2679,2681,2683,2685,2687,2689,2693,2696,2699,2701,2703,2706,2710,2714,2716,2718,2720,2722,2725,2727,2729,2731,2733,2735,2738,2741,2744,2747,2750,2753,2756,2758,2762,2766,2768,2769,2770,2773,2776,2781,2785,2789,2791,2793,2795,2797,2802,2805,2807,2809,2811,2813,2815,2817,2819,2822,2825,2827,2829,2831,2834,2836,2839,2842,2844,2847,2849,2852,2854,2857,2860,2862,2864,2867,2870,2872,2876,2880,2882,2886,2888,2890,2892,2894,2896,2899,2902,2904,2907,2909,2911,2913,2916,2919,2921,2923,2925,2927,2929,2931,2935,2937,2940,2942,2944,2946,2949,2953,2955,2959,2963,2965,2968,2971,2974,2976,2979,2982,2985,2988,2991,2993,2995,2997,3001,3003,3005,3007,3009,3011,3013,3014],this.pointStartPerSymbol=[0,0,14,34,50,96,142,210,220,240,260,272,280,296,300,310,314,348,356,384,414,424,458,504,512,570,616,636,662,668,676,682,720,744,756,798,834,862,878,890,932,944,948,968,980,988,1004,1016,1058,1082,1126,1154,1194,1202,1222,1230,1240,1248,1258,1270,1286,1298,1314,1320,1324,1342,1374,1406,1434,1466,1500,1514,1556,1574,1588,1608,1620,1624,1656,1674,1708,1740,1772,1786,1820,1834,1852,1860,1876,1884,1900,1912,1974,2004,2066,2082,2082,2082,2090,2110,2126,2174,2220,2260,2270,2282,2294,2306,2314,2330,2334,2344,2348,2382,2388,2410,2452,2462,2492,2540,2548,2614,2660,2680,2706,2712,2720,2726,2756,2780,2790,2830,2858,2880,2892,2902,2936,2948,2952,2964,2976,2982,2992,3e3,3034,3058,3096,3124,3168,3176,3196,3202,3212,3220,3230,3238,3254,3266,3282,3288,3292,3310,3348,3386,3414,3452,3486,3500,3550,3572,3580,3596,3608,3614,3654,3676,3710,3748,3786,3800,3834,3846,3866,3872,3882,3890,3902,3910,3972,4002,4064,4080,4080,4080,4088,4108,4124,4170,4216,4260,4270,4290,4310,4322,4330,4346,4350,4360,4364,4402,4406,4438,4484,4492,4526,4574,4584,4650,4698,4718,4744,4750,4758,4764,4802,4826,4836,4874,4900,4930,4942,4952,4982,4994,5006,5022,5034,5040,5050,5058,5100,5122,5168,5194,5230,5238,5258,5264,5274,5282,5292,5304,5312,5324,5332,5338,5342,5360,5392,5424,5452,5484,5516,5536,5578,5600,5608,5628,5640,5644,5684,5706,5740,5772,5804,5822,5856,5864,5888,5894,5904,5912,5926,5938,6e3,6030,6092,6104,6104,6104,6112,6120,6136,6164,6204,6248,6252,6268,6284,6296,6304,6320,6324,6334,6338,6372,6378,6402,6440,6450,6474,6510,6520,6576,6618,6626,6634,6640,6648,6654,6682,6706,6716,6750,6770,6792,6804,6814,6838,6850,6854,6866,6878,6884,6894,6902,6936,6958,6996,7022,7052,7060,7080,7086,7096,7104,7114,7122,7130,7142,7150,7156,7160,7178,7206,7228,7248,7270,7300,7314,7344,7360,7368,7384,7396,7406,7422,7436,7470,7492,7514,7526,7550,7558,7572,7578,7588,7596,7608,7616,7678,7708,7770,7782,7782,7782,7790,7798,7814,7842,7882,7932,7936,7952,7968,7980,7988,8004,8008,8018,8022,8056,8066,8096,8140,8148,8180,8226,8232,8296,8342,8350,8358,8364,8372,8378,8406,8430,8440,8476,8508,8530,8542,8552,8592,8604,8608,8622,8634,8640,8650,8658,8692,8714,8756,8782,8830,8838,8858,8864,8874,8882,8892,8900,8908,8920,8928,8934,8938,8956,8994,9026,9054,9086,9118,9130,9194,9212,9220,9234,9246,9250,9282,9300,9334,9366,9398,9412,9444,9458,9476,9482,9492,9500,9514,9522,9584,9614,9676,9688,9688,9688,9712,9720,9736,9776,9816,9866,9870,9886,9902,9918,9926,9942,9946,9956,9960,9994,1e4,10022,10052,10062,10086,10118,10124,10174,10208,10228,10254,10260,10268,10274,10314,10366,10376,10412,10444,10466,10478,10488,10524,10536,10548,10566,10578,10584,10594,10602,10636,10654,10692,10714,10756,10764,10784,10790,10800,10808,10818,10826,10834,10838,10846,10852,10856,10866,10872,10888,10898,10924,10958,10966,11008,11018,11030,11072,11096,11104,11148,11186,11220,11270,11300,11368,11422,11436,11474,11484,11496,11506,11514,11524,11554,11558,11588,11604,11604,11604,11660,11692,11732,11834,11916,12048,12064,12112,12160,12220,12244,12284,12296,12324,12336,12426,12464,12574,12710,12748,12844,12970,13042,13180,13306,13362,13430,13444,13468,13482,13574,13628,13676,13798,13866,13962,14076,14172,14272,14380,14432,14504,14596,14666,14750,14802,14900,14988,15126,15250,15332,15408,15476,15522,15598,15666,15732,15788,15804,15834,15850,15864,15868,15922,16018,16096,16158,16242,16314,16376,16534,16628,16688,16754,16836,16878,17012,17106,17188,17282,17370,17434,17510,17546,17612,17654,17716,17780,17840,17896,17958,18020,18082,18094,18094,18094,18118,18126,18138,18156,18196,18246,18250,18266,18282,18298,18306,18322,18326,18336,18340,18374,18380,18402,18432,18442,18466,18498,18504,18554,18588,18608,18634,18640,18648,18654,18694,18746,18756,18792,18824,18846,18858,18868,18904,18916,18928,18946,18958,18964,18974,18982,19016,19034,19072,19094,19136,19144,19164,19170,19180,19188,19198,19206,19214,19218,19226,19232,19236,19246,19256,19284,19294,19304,19312,19322,19330,19342,19354,19382,19398,19404,19410,19442,19456,19466,19476,19486,19496,19534,19568,19598,19622,19658,19678,19726,19774,19798,19810,19816,19816,19816,19840,19848,19864,19904,19944,19994,19998,20014,20030,20046,20054,20070,20074,20084,20088,20122,20128,20150,20180,20190,20214,20246,20252,20302,20336,20356,20382,20388,20396,20402,20442,20494,20504,20540,20572,20594,20606,20616,20652,20664,20676,20694,20706,20712,20722,20730,20764,20782,20820,20842,20884,20892,20912,20918,20928,20936,20946,20954,20962,20966,20974,20980,20984,20996,21002,21010,21020,21046,21080,21088,21130,21140,21152,21194,21218,21258,21302,21340,21350,21400,21430,21498,21552,21574,21578,21586,21592,21606,21616,21624,21654,21658,21688,21706,21706]};(lt.prototype={constructor:lt}).getCharacterWidth=function(){return this.characterWidth},lt.prototype.setCharacterWidth=function(e){e>=0&&(this.characterWidth=e)},lt.prototype.numSymbols=function(){return this.indexStartPerSymbol.length},lt.prototype.getString=function(e,t,n){if(t&&(t<1||t>9))return null;t=t-1||0;var r=function(e,t){var n=null;return e instanceof Float32Array?n=new Float32Array(e.length+t.length):e instanceof Uint16Array&&(n=new Uint16Array(e.length+t.length)),n.set(e),n.set(t,e.length),n},i=new _.BufferGeometry;i.setIndex(new _.BufferAttribute(new Uint16Array(0),1)),i.addAttribute("position",new _.BufferAttribute(new Float32Array(0),3));for(var a=[],o=[],s=0,l=0,c=0,u=0,h=0;h<e.length;++h){s=96*t+(e.charCodeAt(h)-32),l=this.indexStartPerSymbol[s+1]-this.indexStartPerSymbol[s],u=this.pointStartPerSymbol[s];for(var d=1;d<l;++d)for(var p=this.fontIndices[this.indexStartPerSymbol[s]+d]-this.fontIndices[this.indexStartPerSymbol[s]+d-1],f=0;f<p;++f)f>0&&o.push(c),a.push(this.fontPoints[u]+h*this.characterWidth,this.fontPoints[u+1],0),u+=2,f+1<p&&o.push(c),++c;for(i.attributes.position.array=r(i.attributes.position.array,new Float32Array(a)),i.index.array=r(i.index.array,new Uint16Array(o));a.length>0;)a.pop();for(;o.length>0;)o.pop()}return i.attributes.position.count=i.attributes.position.array.length/i.attributes.position.itemSize,i.index.count=i.index.array.length/i.index.itemSize,i.computeBoundingBox(),new ze.PmiText(i,n,_.LineSegments)};/* harmony default export */var ct=lt,ut="PLM Vis Web",ht="Â© 2016 Siemens Product Lifecycle Management Software Inc.",dt=o()("PLMVisWeb:debug:Snapshot");
// CONCATENATED MODULE: ./staging/Copyright.js
const pt=Object.freeze({_dispose:Symbol(),_clear:Symbol()});var ft=function(e){var t=null,n=!1,a=null,o=function(e){t=e._parent,(a=document.createElement("iframe")).setAttribute("seamless","seamless"),a.style.display="hidden",a.style.position="absolute",a.style.top=0,a.style.left=0,a.style.height=0,a.style.width=0,a.style.border=0,o.prototype[pt._clear](),t.domElement.appendChild(a)};return o.prototype={constructor:o},o.prototype[pt._dispose]=function(){t.domElement.removeChild(a),a=null},o.prototype[pt._clear]=function(){a.src="about:blank"},o.prototype.setSnapshotEnabled=function(e){r.b._isBoolean(e,!0),dt(i.b.stringsByLabel.SNAPSHOT_LOGGER_setSnapshotEnabled),n=e},o.prototype.getSnapshotEnabled=function(){return dt(i.b.stringsByLabel.SNAPSHOT_LOGGER_getSnapshotEnabled),n},o.prototype.createSnapshotPNG=function(e,a){if(r.b._isFunction(e,!0),r.b._optionalArgCheck(a,r.b._isObject),dt(i.b.stringsByLabel.SNAPSHOT_LOGGER_createSnapshotPNG),e=e||function(){},n){var o=t.isRendering();o&&t.stopRenderLoop(),t.draw(),!function captureSceneIn2DPNG(e,n,i){var a,o,s,l=parseInt(e.style.width.replace(/[px]/gi,"")),c=parseInt(e.style.height.replace(/[px]/gi,"")),u=l,h=c;r.b._notNullOrUndefined(n)&&(u=r.b._isNumber(n.width)?n.width:l,h=r.b._isNumber(n.height)?n.height:c,r.b._isNumber(n.bgcolor)&&(a=n.bgcolor,o=t._renderer.getClearColor().clone(),s=t._renderer.getClearAlpha())),t[Vp._setSize](u,h),r.b._isNumber(a)&&t.setBackgroundColor(a,1);var d=t._renderer.domElement.toDataURL("img/png");t[Vp._setSize](l,c),r.b._isObject(o)&&r.b._isNumber(s)&&t.setBackgroundColor(o,s),i(d)}(t._renderer.domElement,a,e),o&&t.startRenderLoop()}else e(null)},o.prototype.createSnapshotSVG=function(e){if(r.b._isFunction(e,!0),dt(i.b.stringsByLabel.SNAPSHOT_LOGGER_createSnapshotSVG),n){var a=t.isRendering();a&&t.stopRenderLoop(),t.draw(),e(function captureSceneIn2DSVG(e){var t=e.style.width,n=e.style.height,i=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=i.namespaceURI;i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttribute("height",n),i.setAttribute("width",t),i.setAttribute("version","1.1");var o=e.childNodes,s=[],l=[];l.length=o.length;for(var c=0;c<o.length;c++){s[c]=o[c].cloneNode(!0);for(var u=o[c].style.zIndex;null!=l[u]&&u<l.length;)u++;"DIV"===o[c].tagName?(s[c].setAttribute("xmlns",document.documentElement.namespaceURI),l[u]=document.createElementNS(a,"foreignObject"),l[u].setAttribute("height",n),l[u].setAttribute("width",t),l[u].setAttribute("x","0"),l[u].setAttribute("y","0"),l[u].innerHTML=s[c].outerHTML.replace(/(\r\n|\n|\r|\t|[\s]{2,})/gm,"")):"CANVAS"===o[c].tagName&&(l[u]=document.createElementNS(a,"image"),l[u].setAttribute("xlink:href",o[c].toDataURL("img/png")),l[u].setAttribute("x","0"),l[u].setAttribute("y","0"),l[u].setAttribute("height",n),l[u].setAttribute("width",t),l[u].setAttribute("crossOrigin","anonymous"))}var h,d=document.createElementNS(a,"g");for(c=0;c<l.length;c++)null!=l[c]&&((d=document.createElementNS(a,"g")).appendChild(l[c]),i.appendChild(d));h=r.b._notNullOrUndefined(i.outerHTML)?i.outerHTML:(new XMLSerializer).serializeToString(i);var p=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',h],{type:"image/svg+xml;charset=utf-8"});return URL.createObjectURL(p)}(t._renderer.domElement)),a&&t.startRenderLoop()}else e(null)},o.prototype.print=function(e){if(r.b._isFunction(e,!0),dt(i.b.stringsByLabel.SNAPSHOT_LOGGER_print),n){o.prototype.createSnapshotPNG(function(n){var r=a.contentWindow.document,i=a.contentWindow;t._modelObject.children.length>0?r.title=t._modelObject.children[0].name:r.title=[ut,p].join(" ");var s=r.createElement("img");s.setAttribute("src",n),s.onload=function(){i.focus(),i.print(),o.prototype[pt._clear](),e(!0)},r.body.appendChild(s)})}else dt(i.b.stringsByLabel.SNAPSHOT_LOGGER_warn_print),e(!1)},new o(e)};ft.prototype={constructor:ft,_name:"Snapshot"};
// CONCATENATED MODULE: ./staging/PMI.js
var mt=o()("PLMVisWeb:debug:PMI"),gt=o()("PLMVisWeb:warning:PMI"),vt=o()("PLMVisWeb:verbose:PMI"),yt=null;const bt=Object.freeze({_setObjectVisibility:Symbol(),_setVisibilityHelper:Symbol(),_clearSelection:Symbol(),_setObjectSelection:Symbol(),_clear:Symbol(),_getPmiObject:Symbol(),_getPmiShapes:Symbol(),_removeNode:Symbol(),_getAncestryByPsId:Symbol()});var xt=function(e){var t="-3",n=null,a=null,o=null,s=null,l=null,c=null,u=null,h=null,d=null,p=null,f=null,g=null,v=null,y=[],b=null,x=null,w=!0,M=!1,E=null,S=null;function _PMI(e){n=e._parent,a=n._selectionMngr,_createPmiColors()}_PMI.prototype={constructor:_PMI,psId:t};var L=function(e){ze.Container.call(this,e)};function _createPmiColors(){var e=[0,0,0],t=1,n=[0,0,.66],i=1;null!==o&&(e[0]=o.uniforms.diffuse.value.r,e[1]=o.uniforms.diffuse.value.g,e[2]=o.uniforms.diffuse.value.b,t=o.uniforms.opacity.value,o.dispose()),(o=r.b._createLineMaterial(0,t,1)).uniforms.diffuse.value.setRGB(e[0],e[1],e[2]),o.blending=_.NormalBlending,null!==l&&(n[0]=l.uniforms.diffuse.value.r,n[1]=l.uniforms.diffuse.value.g,n[2]=l.uniforms.diffuse.value.b,i=l.uniforms.opacity.value,l.dispose()),(l=r.b._createLineMaterial(0,i,1)).uniforms.diffuse.value.setRGB(n[0],n[1],n[2]),l.blending=_.NormalBlending,null!==s&&(e[0]=s.uniforms.diffuse.value.r,e[1]=s.uniforms.diffuse.value.g,e[2]=s.uniforms.diffuse.value.b,t=s.uniforms.opacity.value,s.dispose());var a=_.UniformsUtils.clone(_.ShaderLib.basic.uniforms);a.diffuse.value.setRGB(e[0],e[1],e[2]),a.opacity.value=t;var p={fragmentShader:_.ShaderLib.basic.fragmentShader,vertexShader:_.ShaderLib.basic.vertexShader,uniforms:a,transparent:a.opacity.value<1};s=new _.ShaderMaterial(p),null!==c&&(n[0]=c.uniforms.diffuse.value.r,n[1]=c.uniforms.diffuse.value.g,n[2]=c.uniforms.diffuse.value.b,i=s.uniforms.opacity.value,c.dispose());var f=_.UniformsUtils.clone(_.ShaderLib.basic.uniforms);f.diffuse.value.setRGB(n[0],n[1],n[2]),f.opacity.value=i;var m={fragmentShader:_.ShaderLib.basic.fragmentShader,vertexShader:_.ShaderLib.basic.vertexShader,uniforms:f,transparent:f.opacity.value<1};c=new _.ShaderMaterial(m),null!==u&&u.dispose();var g=_.UniformsUtils.clone(_.ShaderLib.basic.uniforms);g.diffuse.value.setRGB(e[0],e[1],e[2]),g.opacity.value=.25*t;var v={fragmentShader:_.ShaderLib.basic.fragmentShader,vertexShader:_.ShaderLib.basic.vertexShader,uniforms:g,transparent:g.opacity.value<1,flatShading:!0,side:_.DoubleSide};(u=new _.ShaderMaterial(v)).opacity=g.opacity.value,null!==h&&h.dispose();var y=_.UniformsUtils.clone(_.ShaderLib.basic.uniforms);y.diffuse.value.setRGB(n[0],n[1],n[2]),y.opacity.value=.25*i;var b={fragmentShader:_.ShaderLib.basic.fragmentShader,vertexShader:_.ShaderLib.basic.vertexShader,uniforms:y,transparent:y.opacity.value<1,flatShading:!0,side:_.DoubleSide};(h=new _.ShaderMaterial(b)).opacity=y.opacity.value,null!==d&&d.dispose();var x=_.UniformsUtils.clone(He.c.pmiPoints.uniforms);x.color.value.copy(o.uniforms.diffuse.value),x.opacity.value=o.uniforms.opacity.value,x.selectionColor.value.copy(l.uniforms.diffuse.value),x.selectionOpacity.value=l.uniforms.opacity.value,d=new _.RawShaderMaterial({uniforms:x,vertexShader:He.c.pmiPoints.vertexShader,fragmentShader:He.c.pmiPoints.fragmentShader,transparent:x.opacity.value<1||x.selectionOpacity.value<1})}function _cameraChangedHandler(e){if(e.cameraChange===m.b.POST&&xt&&n.isExtensionLoaded(xt)){var t=t=n.getExtensionManager(xt);t.reorientText()}}function _fireVisibilityChangeEvents(e){if(void 0!==e.userData.visibilityChangeEvents)for(var t=e.userData.visibilityChangeEvents.length,n=0;n<t;++n)e.userData.visibilityChangeEvents[n](e.visibilityState)}function _fireSelectionChangeEvents(e){if(void 0!==e.userData.selectionChangeEvents)for(var t=e.userData.selectionChangeEvents.length,n=0;n<t;++n)e.userData.selectionChangeEvents[n](e.selected)}function _initializePmiContainer(e){p||((p=new L("PMI")).userData.psId=t,p.visible=!1,n._scene.pmiTreeObject=p,p.addPsIdToObjectMap(t,p)),e._pmiObject=p,E||(E=new ze.Container("PMIShape"),n._scene._pmiShapeContainer=E,n._scene.add(E)),n&&n[Vp._addEventListener](m.i.cameraChanged,_cameraChangedHandler),S||(S=T())}function _jsonHandler(e,t,n,r){if(void 0!==e&&null!==e){if(_initializePmiContainer(this),"PMI"===e.title)_processPmiStructure(e,p,n,t),y.length>0&&_processPmiPoints();else if("PMI Root"===e.title)for(var i=e.children.length,a=null,o=0;o<i;++o)"PMI"===(a=e.children[o]).title&&(_processPmiStructure(a,p,n,t),y.length>0&&_processPmiPoints()),"Design Groups"===a.title&&(p.userData.designGroupMap={},_processDesignGroups(a,n,t),f=_generateDesignGroupsStructureInfo(a,n)),"Model Views"===a.title&&(p.userData.modelViewMap={},_processModelViews(a,n,t),g=_generateModelViewsStructureInfo(a,n));r(!0)}}function _processPmiPoints(){for(var e=y.length,t=[],r=new _.BufferGeometry,i=new Float32Array(3*e),a=new Float32Array(e),o=new Float32Array(e),s=0;s<e;++s)i[3*s+0]=y[s].point[0],i[3*s+1]=y[s].point[1],i[3*s+2]=y[s].point[2],a[s]=0,o[s]=0,t.push(y[s].psId);r.addAttribute("position",new _.BufferAttribute(i,3)),r.addAttribute("visible",new _.BufferAttribute(a,1)),r.addAttribute("selected",new _.BufferAttribute(o,1)),(b=new ze.PmiPoint(r,d,t)).visible=!0,p.add(b),n._scene.addIndexedShape(b)}function compareVertBbox(e,t){e.x>t.max.x&&(t.max.x=e.x),e.y>t.max.y&&(t.max.y=e.y),e.z>t.max.z&&(t.max.z=e.z),e.x<t.min.x&&(t.min.x=e.x),e.y<t.min.y&&(t.min.y=e.y),e.z<t.min.z&&(t.min.z=e.z)}L.prototype=Object.create(ze.Container.prototype),L.prototype.constructor=L,L.prototype.getObjectByPsId=function(e){var t=void 0;return this.psIdToObjectMap.hasOwnProperty(e)&&(t=this.psIdToObjectMap[e]),t},_PMI.prototype.registerVisibilityChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),mt(i.b.stringsByLabel.PMI_LOGGER_registerVisibilityChangeEventByPsId);var n=p.getObjectByPsId(e,!0);null!==n&&void 0!==n&&(void 0===n.userData.visibilityChangeEvents&&(n.userData.visibilityChangeEvents=[]),r.b._isFunction(t)&&-1===r.b._eventMapIndex(n.userData.visibilityChangeEvents,t)&&n.userData.visibilityChangeEvents.push(t))},_PMI.prototype.unregisterVisibilityChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),mt(i.b.stringsByLabel.PMI_LOGGER_unregisterVisibilityChangeEventByPsId);var n=p.getObjectByPsId(e,!0);if(null!==n&&void 0!==n&&void 0!==n.userData.visibilityChangeEvents){var a=r.b._eventMapIndex(n.userData.visibilityChangeEvents,t);-1!==a&&n.userData.visibilityChangeEvents.splice(a,1)}},_PMI.prototype.registerSelectionChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),mt(i.b.stringsByLabel.PMI_LOGGER_registerSelectionChangeEventByPsId);var n=p.getObjectByPsId(e,!0);null!==n&&void 0!==n&&(void 0===n.userData.selectionChangeEvents&&(n.userData.selectionChangeEvents=[]),r.b._isFunction(t)&&-1===r.b._eventMapIndex(n.userData.selectionChangeEvents,t)&&n.userData.selectionChangeEvents.push(t))},_PMI.prototype.unregisterSelectionChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),mt(i.b.stringsByLabel.PMI_LOGGER_unregisterSelectionChangeEventByPsId);var n=p.getObjectByPsId(e,!0);if(null!==n&&void 0!==n&&void 0!==n.userData.selectionChangeEvents){var a=r.b._eventMapIndex(n.userData.selectionChangeEvents,t);-1!==a&&n.userData.selectionChangeEvents.splice(a,1)}},_PMI.prototype.loadPmiData=function(e,t){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),mt(i.b.stringsByLabel.PMI_LOGGER_loadPmiData),t=t||function(){},_createPmiColors();var a=n._modelObject.getObjectByPsId(e);a?n.getLoader().loadPmiStructure({modelPath:a.userData.modelPath,modelRootPsId:e,doneCallback:function(n){if(n){var r=e.split(":")[0];_jsonHandler.call(this,n,a.baseRef,r,t)}}.bind(this)}):t(!1)},_PMI.prototype.loadPmiDataWithObject=function(e,t,a){r.b._isString(e,!0),r.b._isObject(t,!0),r.b._optionalArgCheck(a,r.b._isFunction),mt(i.b.stringsByLabel.PMI_LOGGER_loadPmiDataWithObject),a=a||function(){};var o=n._modelObject.getObjectByPsId(e);if(t&&o){var s=e.split(":")[0];_jsonHandler.call(this,t,o.baseRef,s,a)}else vt(i.b.stringsByLabel.PMI_LOGGER_warn_loadPmiDataWithObject),a(!1)},Object.defineProperties(_PMI.prototype,{autoTextFlipping:{get:function(){return w},set:function(e){w=e}}}),_PMI.prototype.reorientText=function(e){r.b._isNullOrUndefined(e)?e=!1:r.b._isBoolean(e,!0);var t=e||w;p&&p.traverse(function(e){e.userData&&e.userData.textIndex&&function _calculatePmiTextMatrix(e,t){if(e.isLoaded&&e.visible&&e.userData.pmiFrame){var r=_getPmiObjectTransformInfo(e.userData.pmiFrame,e.matrixWorld),i=r.xform,a=r.width,o=r.height;if(0===a.length()||0===o.length())return;var s=!1,l=!1;if(t){var c=o.clone();c.projectOnVector(n._currentCamera.up);var u=c.angleTo(n._currentCamera.up),s=Math.abs(Math.PI-u)<.01,h=new _.Vector3;n._currentCamera.getWorldDirection(h);var d=new _.Vector3;d.crossVectors(h,n._currentCamera.up),(c=a.clone()).projectOnVector(d),u=c.angleTo(d);var l=Math.abs(Math.PI-u)<.01}if(e.shapes&&e.shapes.length)for(var p=0;p<e.userData.textIndex.length;++p){var f=e.userData.textIndex[p];if(e.shapes[f]){var m=e.shapes[f],g=i.clone();if(s||l){var v;if(m.midpoint)v=m.midpoint;else if(m.geometry&&m.geometry.boundingBox){var y=m.geometry.boundingBox,b=(y.max.x-y.min.x)/2+y.min.x,x=(y.max.y-y.min.y)/2+y.min.y;v=new _.Vector3(b,x,0),m.midpoint=v}else{var b=a.clone().multiplyScalar(.5),x=o.clone().multiplyScalar(.5);(v=new _.Vector3).addVectors(x,b)}var w=new _.Matrix4,M=new _.Matrix4,E=new _.Matrix4;w.makeTranslation(v.x,v.y,v.z),g.multiply(w),s&&l?(E.makeRotationZ(Math.PI),g.multiply(E)):s?(E.makeRotationX(Math.PI),g.multiply(E)):l&&(E.makeRotationY(Math.PI),g.multiply(E)),M.makeTranslation(-v.x,-v.y,-v.z),g.multiply(M)}m.matrixAutoUpdate=!1,m.matrix=g,m.updateMatrixWorld(!0)}}n._scene.updateIndexedObject(e)}}(e,t)}),E&&E.traverse(e=>{"PmiText"===e.type&&S(e,t)}),n[Vp._render]()};var T=function(){var e=new _.Vector3(0,0,-1),t=new _.Vector3(1,0,0),r=new _.Vector3,i=new _.Vector3,a=new _.Matrix4,o=new _.Matrix4,s=new _.Matrix4,l=new _.Matrix4,c=new _.Quaternion,u=new _.Vector3,h=new _.Vector3,d=new _.Vector3;return function _flipPmiText(p,f){if(p&&p.visible){var g=p.direction||t;if(i.copy(g),r.crossVectors(i,e),d.set(0,0,0),a.lookAt(d,e,r),p.midpoint)h.copy(p.midpoint);else{if(!p.geometry||!p.geometry.boundingBox)return;p.geometry.boundingBox.getCenter(h),p.midpoint=h.clone()}var v=!1,y=!1;if(f){var b=p.matrixWorld;b.decompose(d,c,u),v=r.applyQuaternion(c).angleTo(n._currentCamera.up)>Math.PI/2,n.getCameraMode()===m.c.PERSPECTIVE?(d.copy(h),d.applyMatrix4(b),d.sub(n._currentCamera.position)):n._currentCamera.getWorldDirection(d);var x=u.crossVectors(r,i.applyQuaternion(c));v&&x.negate(),y=x.angleTo(d)>Math.PI/2}if(v||y){var _=p.matrix;p.rotationPoint&&h.copy(p.rotationPoint),o.makeTranslation(h.x,h.y,h.z),_.multiply(o),_.multiply(a),v&&y?l.makeRotationZ(Math.PI):v?l.makeRotationX(Math.PI):y&&l.makeRotationY(Math.PI),_.multiply(l),_.multiply(l.getInverse(a)),s.makeTranslation(-h.x,-h.y,-h.z),_.multiply(s),p.matrixAutoUpdate=!1,p.updateMatrixWorld(!0),n._scene.updateIndexedObject(p)}}}};function _processPmiStructure(e,t,i,a){if("PMI"!==e.title){var s=void 0!==e.plane||void 0!==e.point&&void 0===e.normal||void 0!==e.axis||!1,l=!s&&void 0!==e.point&&void 0!==e.normal||!1,c=void 0!==e.coordSysFrame,h=null;h=s||c||l||void 0===e.children&&(void 0!==e.fileRef||void 0!==e.pmiData||void 0!==e.transform)?new st({id:e.psId,xform:e.xform}):new ze.Assembly(e.title,function _getBBox(e){if(e.bboxMin&&e.bboxMax){var t=new _.Vector3(e.bboxMin[0],e.bboxMin[1],e.bboxMin[2]),n=new _.Vector3(e.bboxMax[0],e.bboxMax[1],e.bboxMax[2]);return new _.Box3(t,n)}}(e)),void 0!==e.psId?(h.userData.psId=i+":"+e.psId,h.psId=e.psId,p.addPsIdToObjectMap(h.userData.psId,h)):t&&t.userData&&t.userData.psId&&(h.userData.psId=t.userData.psId+"."+h.name,h.psId=h.name,p.addPsIdToObjectMap(h.userData.psId,h)),h.visible=!1,h.name=e.title;var d=new _.Matrix4;if(void 0!==e.xform?(d.set(e.xform[0],e.xform[3],e.xform[6],e.xform[9],e.xform[1],e.xform[4],e.xform[7],e.xform[10],e.xform[2],e.xform[5],e.xform[8],e.xform[11],0,0,0,1),e.xform.length=0):d.identity(),h.applyMatrix(d),e.pmiRef&&(h.userData.pmiBodRef=e.pmiRef),void 0!==e.fileRef||void 0!==e.b64data||s||l||!e.children)t.add(h),h.selected=!1,h.percentLoaded=0,e.transform&&(h.userData.pmiTransform=(new _.Matrix4).set(e.transform[0],e.transform[1],e.transform[2],e.transform[3],e.transform[4],e.transform[5],e.transform[6],e.transform[7],e.transform[8],e.transform[9],e.transform[10],e.transform[11],e.transform[12],e.transform[13],e.transform[14],e.transform[15]),h.isLoaded=!0),h.userData.cbQueue=[],e.fileRef?(h.baseRef=a,h.objectFileRef=e.fileRef,e.fileLen&&(h.objectFileLen=e.fileLen)):h.b64data=r.b._decodeBase64ToBinaryBuffer(e.pmiData),h.userData.referencePsId=t.parent&&t.parent.userData?t.parent.userData.psId:null;else{t.add(h);for(var f=e.children.length,m=0;m<f;++m)_processPmiStructure(e.children[m],h,i,a)}if(h.updateMatrixWorld(!0),void 0!==e.partIds){h.userData.partIds=[];for(m=0,f=e.partIds.length;m<f;++m)h.userData.partIds.push(i+":"+e.partIds[m].toString())}if(void 0!==e.pmiIds){h.userData.pmiIds=[];for(m=0,f=e.pmiIds.length;m<f;++m)h.userData.pmiIds.push(i+":"+e.pmiIds[m].toString())}if(void 0!==e.nrPmiIds){h.userData.nrPmiIds=[];for(m=0,f=e.nrPmiIds.length;m<f;++m)h.userData.nrPmiIds.push(i+":"+e.nrPmiIds[m].toString())}if(void 0!==e.xtIds){h.userData.xtIds=[];for(m=0,f=e.xtIds.length;m<f;++m)h.userData.xtIds.push(i+":"+e.xtIds[m].toString())}if(l){h.userData.sectionOrigin=[],h.userData.sectionDirection=[],h.userData.sectionIds=[];for(m=0,f=e.point.length;m<f;m+=3)h.userData.sectionOrigin.push((new _.Vector3).fromArray(e.point.slice(m,m+3))),h.userData.sectionDirection.push((new _.Vector3).fromArray(e.normal.slice(m,m+3)));h.isLoaded=!0}void 0!==e.frame&&(h.userData.pmiFrame=e.frame.slice(0)),void 0!==e.textIdx&&(h.userData.textIndex=e.textIdx.slice(0)),void 0!==e.textData&&function _processPmiText(e,t){var r=t.length,i=null,a=null,s=0;yt||(yt=new ct);for(var l=new _.Vector3,c=new _.Vector3,u=new _.Vector3,h=new _.Vector3,d=new _.Vector3,p=new _.Vector3,f=new _.Matrix4,m=new _.Matrix4,g=new _.Matrix4,v=new _.Matrix4,y=new _.Matrix4,b=0;b<r;++b)i=t[b],a=yt.getString(i.text,i.font,o),s=i.textBox[2],v.makeScale(s,s,s),a.applyMatrix(v),f.makeTranslation(i.textBox[0],i.textBox[1],0),a.applyMatrix(f),l.set(e.userData.pmiFrame[0],e.userData.pmiFrame[1],e.userData.pmiFrame[2]),u.set(e.userData.pmiFrame[3],e.userData.pmiFrame[4],e.userData.pmiFrame[5]),u.sub(l),c.set(e.userData.pmiFrame[6],e.userData.pmiFrame[7],e.userData.pmiFrame[8]),c.sub(l),g.makeTranslation(l.x,l.y,l.z),d.crossVectors(u,c),p.copy(u),m.lookAt(h,d,p),y.multiply(g),y.multiply(m),a.applyMatrix(y),a.visible=!1,e.addShape(a),l.set(e.userData.pmiFrame[0],e.userData.pmiFrame[1],e.userData.pmiFrame[2]),u.set(e.userData.pmiFrame[3],e.userData.pmiFrame[4],e.userData.pmiFrame[5]),c.set(e.userData.pmiFrame[6],e.userData.pmiFrame[7],e.userData.pmiFrame[8]),compareVertBbox(l,n._modelBBox),compareVertBbox(u,n._modelBBox),compareVertBbox(c,n._modelBBox),m.identity(),g.identity(),y.identity(),l.copy(h),u.copy(h),c.copy(h),d.copy(h),a=null,i=null;i=null}(h,e.textData),s&&function _processReferenceGeometry(e,t,n){if(void 0!==t.plane){var r=new _.Vector3(t.plane[0],t.plane[1],t.plane[2]),i=new _.Vector3(t.plane[3],t.plane[4],t.plane[5]),a=new _.Vector3(t.plane[6],t.plane[7],t.plane[8]),s=new _.Vector3(t.plane[9],t.plane[10],t.plane[11]),l=new _.Vector3((r.x+a.x)/2,(r.y+a.y)/2,(r.z+a.z)/2);r.sub(l),i.sub(l),a.sub(l),s.sub(l),(v=new _.BufferGeometry).addAttribute("position",new _.BufferAttribute(new Float32Array([r.x,r.y,r.z,i.x,i.y,i.z,a.x,a.y,a.z,s.x,s.y,s.z]),3)),v.setIndex(new _.BufferAttribute(new Uint16Array([0,1,3,1,2,3]),1)),v.computeVertexNormals(),v.computeBoundingBox();var c=new ze.PmiRefPlane(v,u);c.visible=!1,e.addShape(c);var h=v.clone();h.setIndex(new _.BufferAttribute(new Uint32Array([0,1,1,2,2,3,3,0]),1)),(c=new ze.PmiLine(h,o)).visible=!1,e.addShape(c);var d=(new _.Matrix4).makeTranslation(l.x,l.y,l.z);e.applyMatrix(d),e.updateMatrixWorld()}if(void 0!==t.point&&(y.push({point:[t.point[0],t.point[1],t.point[2]],psId:n+":"+t.psId}),e.userData.pointIndex=y.length-1),void 0!==t.axis){y.push({point:[t.axis[0],t.axis[1],t.axis[2]],psId:n+":"+t.psId},{point:[t.axis[3],t.axis[4],t.axis[5]],psId:n+":"+t.psId}),e.userData.pointIndex=y.length-2,e.userData.endPointIndex=y.length-1;for(var p=[],f=[],m=t.axis.length,g=0;g<m;++g)p.push(t.axis[g]);var v;f.push(0,1),(v=new _.BufferGeometry).setIndex(new _.BufferAttribute(new Uint32Array(f),1)),v.addAttribute("position",new _.BufferAttribute(new Float32Array(p),3)),(c=new ze.PmiLine(v,o)).visible=!1,e.addShape(c),c=null,v=null}e.isLoaded=!0}(h,e,i),c&&function _processCoordSysGeometry(e,t,i){(A=new _.Matrix4).makeScale(3,3,3);var a=new _.LineBasicMaterial({color:10053222});if(void 0!==t.coordSysFrame){var o=new _.Vector3(t.coordSysFrame[0],t.coordSysFrame[1],t.coordSysFrame[2]),s=new _.Vector3(t.coordSysFrame[3],t.coordSysFrame[4],t.coordSysFrame[5]),l=new _.Vector3(t.coordSysFrame[6],t.coordSysFrame[7],t.coordSysFrame[8]),c=new _.Vector3;s.normalize(),l.normalize(),c.crossVectors(s,l);var u=new _.BufferGeometry,h=[o.x,o.y,o.z,12*s.x,s.y,s.z],d=[0,1];u.setIndex(new _.BufferAttribute(new Uint32Array(d),1)),u.addAttribute("position",new _.BufferAttribute(new Float32Array(h),3));var p=new ze.PmiLine(u,a);p.visible=!0,e.addShape(p),h.length=0,d.length=0,u=null,u=new _.BufferGeometry,h=[o.x,o.y,o.z,l.x,12*l.y,l.z],d=[0,1],u.setIndex(new _.BufferAttribute(new Uint32Array(d),1)),u.addAttribute("position",new _.BufferAttribute(new Float32Array(h),3)),u.attributes.position.array=r.b._typedArrayAppend(u.attributes.position.array,new Float32Array(h)),u.index.array=r.b._typedArrayAppend(u.index.array,new Uint32Array(d));var f=new ze.PmiLine(u,a);f.visible=!0,e.addShape(f),h.length=0,d.length=0,u=null,u=new _.BufferGeometry,h=[o.x,o.y,o.z,c.x,c.y,12*c.z],d=[0,1],u.setIndex(new _.BufferAttribute(new Uint32Array(d),1)),u.addAttribute("position",new _.BufferAttribute(new Float32Array(h),3));var m=new ze.PmiLine(u,a);m.visible=!0,e.addShape(m),h.length=0,d.length=0,u=null,yt||(yt=new ct);var g=yt.getString("i",1,a);g.applyMatrix(A),g.position.set(12,0,0);var v=yt.getString("j",1,a);v.applyMatrix(A),v.position.set(0,12,0);var y=yt.getString("k",1,a);y.applyMatrix(A),y.position.set(0,0,12),e.addShape(g),e.addShape(v),e.addShape(y),g=null,v=null,y=null;var b=new _.LineBasicMaterial({color:16777215}),x=(o=new _.Vector3,new _.Vector3),w=new _.Vector3,M=new _.Vector3,E=new _.Vector3,S=new _.Vector3,L=(new _.Matrix4,new _.Matrix4),T=new _.Matrix4,A=new _.Matrix4,C=new _.Matrix4,P=yt.getString(t.title,1,b);P.applyMatrix(A),o.set(t.coordSysFrame[0],t.coordSysFrame[1],t.coordSysFrame[2]),w.set(t.coordSysFrame[3],t.coordSysFrame[4],t.coordSysFrame[5]),w.sub(o),x.set(t.coordSysFrame[6],t.coordSysFrame[7],t.coordSysFrame[8]),x.sub(o);var I=P.geometry.boundingBox,O=new _.Vector3((I.max.x+I.min.x)/2,(I.max.y+I.min.y)/2,(I.max.z+I.min.z)/2);T.makeTranslation(-1*O.x,-1*O.y,-1*O.z),E.crossVectors(w,x),S.copy(w),L.lookAt(M,E,S),C.multiply(T),P.applyMatrix(C),P.visible=!1,e.addShape(P),o.set(t.coordSysFrame[0],t.coordSysFrame[1],t.coordSysFrame[2]),w.set(t.coordSysFrame[3],t.coordSysFrame[4],t.coordSysFrame[5]),x.set(t.coordSysFrame[6],t.coordSysFrame[7],t.coordSysFrame[8]),compareVertBbox(o,n._modelBBox),compareVertBbox(w,n._modelBBox),compareVertBbox(x,n._modelBBox),L.identity(),T.identity(),C.identity(),o.copy(M),w.copy(M),x.copy(M),E.copy(M),P=null;var B=new _.Vector3(I.min.x-.3,I.min.y-.3,0),R=new _.Vector3(I.max.x+.3,I.min.y-.3,0),G=new _.Vector3(I.max.x+.3,I.max.y+.3,0),D=new _.Vector3(I.min.x-.3,I.max.y+.3,0);E=new _.Vector3((B.x+G.x)/2,(B.y+G.y)/2,(B.z+G.z)/2),B.sub(E),R.sub(E),G.sub(E),D.sub(E),(u=new _.BufferGeometry).addAttribute("position",new _.BufferAttribute(new Float32Array([B.x,B.y,-.01,R.x,R.y,-.01,G.x,G.y,-.01,D.x,D.y,-.01]),3)),u.setIndex(new _.BufferAttribute(new Uint16Array([0,1,3,1,2,3]),1)),u.computeVertexNormals(),u.computeBoundingBox();var V=_.UniformsUtils.clone(_.ShaderLib.basic.uniforms);V.diffuse.value.setRGB(0,0,0),V.opacity.value=.6;var N={fragmentShader:_.ShaderLib.basic.fragmentShader,vertexShader:_.ShaderLib.basic.vertexShader,uniforms:V,transparent:V.opacity.value<1,flatShading:!0,side:_.DoubleSide},U=new _.ShaderMaterial(N);U.opacity=V.opacity.value,(F=new ze.PmiRefPlane(u,U)).visible=!1,F.applyMatrix(C),e.addShape(F);var F,z=u.clone();z.setIndex(new _.BufferAttribute(new Uint32Array([0,1,1,2,2,3,3,0]),1)),(F=new ze.PmiLine(z,b)).visible=!1,F.applyMatrix(C),e.addShape(F)}e.isLoaded=!0}(h,e),h.shapes&&h.shapes.forEach(e=>{E.add(e),n[Vp._expandModelBoundingBox](e),n._scene.addIndexedShape(e)})}else for(m=0,f=e.children.length;m<f;++m)_processPmiStructure(e.children[m],t,i,a)}function _processDesignGroups(e,t,n){if(void 0!==e.pmiIds||void 0!==e.partIds){var r={},i=0,a=0;if(r.title=e.title,void 0!==e.partIds){r.partIds=[];for(a=0,i=e.partIds.length;a<i;++a)r.partIds.push(t+":"+e.partIds[a].toString())}if(void 0!==e.pmiIds){r.pmiIds=[];for(a=0,i=e.pmiIds.length;a<i;++a)r.pmiIds.push(t+":"+e.pmiIds[a].toString())}if(void 0!==e.xtIds){r.xtIds=[];for(a=0,i=e.xtIds.length;a<i;++a)r.xtIds.push(t+":"+e.xtIds[a].toString())}void 0!==n&&(r.refPsId=n),p.userData.designGroupMap[t+":"+e.psId.toString()]=r,r=null}else if(void 0!==e.children){void 0!==e.psId&&(n=t+":"+e.psId);for(i=e.children.length,a=0;a<i;++a)_processDesignGroups(e.children[a],t,n)}}function _processModelViews(e,t,r){if(void 0!==e.camera){p.userData.modelViewMap[t+":"+e.psId.toString()]={};var i=p.userData.modelViewMap[t+":"+e.psId.toString()];if(i.title=e.title,void 0!==r&&(i.refPsId=r),void 0!==e.partIds){i.partIds=[];for(var a=0,o=e.partIds.length;a<o;++a)i.partIds.push(t+":"+e.partIds[a])}else if(void 0!==e.excPartIds){i.excPartIds=[];for(a=0,o=e.excPartIds.length;a<o;++a)i.excPartIds.push(t+":"+e.excPartIds[a])}if(void 0!==e.pmiIds){i.pmiIds=[];for(a=0,o=e.pmiIds.length;a<o;++a)i.pmiIds.push(t+":"+e.pmiIds[a])}if(void 0!==e.xtIds){i.xtIds=[];for(a=0,o=e.xtIds.length;a<o;++a)i.xtIds.push(t+":"+e.xtIds[a])}void 0!==e.camera&&(i.camera=e.camera.slice(0),void 0!==e.cameraType?i.cameraMode=e.cameraType:i.cameraMode=n.getCameraMode()),void 0!==e.bgColor&&(i.bgColor=parseInt(e.bgColor)),void 0!==e.edgeType&&(i.edgeType=e.edgeType)}else if(void 0!==e.psId&&(r=t+":"+e.psId),void 0!==e.children)for(o=e.children.length,a=0;a<o;++a)_processModelViews(e.children[a],t,r)}_PMI.prototype.isPmiObject=function(e){if(r.b._isString(e,!0),mt(i.b.stringsByLabel.PMI_LOGGER_isPmiObject),!p)return!1;var t=e===this.psId?p:p.getObjectByPsId(e,!0);return!!(t&&t instanceof st)},_PMI.prototype.alignCameraToPmi=function(e){r.b._isString(e,!0),mt(i.b.stringsByLabel.PMI_LOGGER_alignCameraToPmi);var t=e===this.psId?p:p.getObjectByPsId(e,!0);if(t){var a=new _.Vector3(t.userData.pmiFrame[0],t.userData.pmiFrame[1],t.userData.pmiFrame[2]),o=new _.Vector3(t.userData.pmiFrame[3],t.userData.pmiFrame[4],t.userData.pmiFrame[5]),s=new _.Vector3(t.userData.pmiFrame[6],t.userData.pmiFrame[7],t.userData.pmiFrame[8]),l=o.clone().sub(a),c=s.clone().sub(a),u=(new _.Vector3).crossVectors(c,l).clone().add(a);n._cameraControls.preupdate(),n._currentCamera.position.copy(u),n._currentCamera.lookAt(a),n._cameraControls.target.copy(a),n._cameraControls.update();var h=l.clone();n._currentCamera.up.copy(h),n._cameraControls.update(),n[Vp._render](),n.fitToVisible()}},_PMI.prototype.setPmiSelectionMaterial=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0),mt(i.b.stringsByLabel.PMI_LOGGER_setPmiSelectionMaterial),t=r.b._getValidOpacity(t);var a=l;a.uniforms.diffuse.value.setHex(e),a.uniforms.opacity.value=t,a.transparent=t<1,a.needsUpdate=!0;var o=c;o.uniforms.diffuse.value.setHex(e),o.uniforms.opacity.value=t,o.transparent=t<1,o.needsUpdate=!0;var s=h;s.uniforms.diffuse.value.setHex(e),s.uniforms.opacity.value=.25*t,s.transparent=t<1,s.needsUpdate=!0;var u=d;u.uniforms.selectionColor.value.setHex(e),u.uniforms.selectionOpacity.value=t,u.transparent=u.uniforms.opacity.value<1||u.uniforms.selectionOpacity.value,u.needsUpdate=!0,n[Vp._render]()};var A=function(e,t,n){if(e.shapes&&e.shapes.forEach(e=>A(e,t,n)),e instanceof ze.PmiRefPlane&&(n*=.25),e.material){e.material=e.material.clone().copy(e.material);var r=e.material.uniforms;r.diffuse.value.setHex(t),r.opacity.value=n,e.material.transparent=n<1,e.material.needsUpdate=!0,e.userData.updatedmaterial=e.material}};_PMI.prototype.setPmiColorByPsId=function(e,t,a,o){r.b._isString(e,!0),r.b._isNumber(t,!0),r.b._isNumber(a,!0),r.b._isNullOrUndefined(o)?o=!0:r.b._isBoolean(o,!0),mt(i.b.stringsByLabel.PMI_LOGGER_setPmiColorByPsId),a=r.b._getValidOpacity(a),r.b._isBoolean(o)||(o=!0);var s=p.getObjectByPsId(e,!0);C(s,t,a,o),n[Vp._render](),vt(i.b.stringsByLabel.PMI_LOGGER_finest_setPmiColorByPsId)};var C=function(e,t,n,i){if(r.b._notNullOrUndefined(e)){if(e instanceof st)A(e,t,n);else if(Array.isArray(e.children)&&e.children.length>0)for(var a=0;a<e.children.length;a++){var o=e.children[a];C(o,t,n,i)}if(i&&e.userData.pmiIds)e.userData.pmiIds.forEach(e=>{var r=p.getObjectByPsId(e,!0);r&&A(r,t,n)})}},P=function(e){var t=e||p;if(null!==t&&void 0!==t){if(t.material&&t.userData.updatedmaterial)switch(t.userData.updatedmaterial=void 0,t.type){case"PmiLine":t.material=o;break;case"PmiRefPlane":t.material=u;break;case"PmiSurface":t.material=s;break;case"PmiPoint":t.material=d}if(t.children&&0!==t.children.length)for(var n=0;n<t.children.length;n++){var r=t.children[n];r.shapes?r.shapes.forEach(P):P(r)}}};function _generateDesignGroupsStructureInfo(e,t,n){var r={name:e.title,psId:t+":"+e.psId};if(void 0!==e.pmiIds){r.refPsId=n,r.pmiIds=[];for(var i=0,a=e.pmiIds.length;i<a;++i)r.pmiIds.push(t+":"+e.pmiIds[i].toString())}else void 0!==e.psId&&(n=t+":"+e.psId);if(void 0!==e.featureIds){r.featureIds=[];for(i=0,a=e.featureIds.length;i<a;++i)r.featureIds.push(t+":"+e.featureIds[i].toString())}if(void 0!==e.partIds){r.partIds=[];for(i=0,a=e.partIds.length;i<a;++i)r.partIds.push(t+":"+e.partIds[i].toString())}if(void 0!==e.children&&e.children.length>0){r.children=[];var o=e.children.length;for(i=0;i<o;++i)r.children.push(_generateDesignGroupsStructureInfo(e.children[i],t,n))}return r}function _generateModelViewsStructureInfo(e,t,n){var r={name:e.title,psId:t+":"+e.psId};if(void 0!==e.psId&&void 0===n&&void 0===e.camera&&(n=t+":"+e.psId),e.camera&&(r.psId=t+":"+e.psId,void 0!==n&&(r.refPsId=n)),void 0!==e.pmiIds){r.pmiIds=[];for(var i=0,a=e.pmiIds.length;i<a;++i)r.pmiIds.push(t+":"+e.pmiIds[i].toString())}if(void 0!==e.children&&e.children.length>0){r.children=[];var o=e.children.length;for(i=0;i<o;++i)r.children.push(_generateModelViewsStructureInfo(e.children[i],t,n))}return r}function _updateAssemblyVisibilityState(e){for(var t,n=e.children?e.children.length:0,r=e.visibilityState,i=0;i<n;++i)if(void 0!==e.children[i].visibilityState&&e.children[i].visibilityState!==t)switch(t){case void 0:t=e.children[i].visibilityState;break;case m.D.All:case m.D.None:t=m.D.Some;break;case m.D.Some:}e.visibilityState=t,e.visible=e.visibilityState!==m.D.None,e===p&&(e.visible=e.visibilityState!==m.D.None);var a=r!==e.visibilityState;return a&&_fireVisibilityChangeEvents(e),a}function _bubbleUpVisibility(e){for(var t=e.parent;t&&!(t instanceof _.Scene);){var n=_updateAssemblyVisibilityState(t);if(t===p&&(t.visible=t.visibilityState!==m.D.None),!n)break;t=t.parent}}function _processChildren(e,t,n,r){if(e&&e.children&&e.children.length>0)for(var i=e.children.length,a=0,o=function(){++a===i&&r()},s=0;s<i;s++)this[bt._setObjectVisibility](e.children[s],t,o,!1,n);else r()}function _setObjectVisibilityNR(e,t,r){if(e&&e.visible!==t){var i=t!==this.visibilityState,a=function(){this.visibilityState=t?m.D.All:m.D.None,this.visible=t,e.traverse(e=>{e.visible=t}),i&&_fireVisibilityChangeEvents(this),_bubbleUpVisibility(this),n[Vp._fireProgressEvents](101),r()}.bind(e);!e.isLoaded&&e.userData&&e.userData.psId?n[Vp._loadGeometryHelper](e,a):a()}else r()}function _loadPMIFromList(e,t,r,i,a){if(e&&e.length){let m=[],g=[],v=[];e.forEach(function(e){var t=p.getObjectByPsId(e,!0);t?t.isLoaded?t.userData.psId&&g.push(t):m.push(t):void 0!==p.userData.designGroupMap&&p.userData.designGroupMap[e]&&v.push(e)});var o=n.getLoader();if(o&&o.loadShapesFromList){var s=function(e){let n=0;var r=function(){++n===v.length&&e()}.bind(this),a=function(e){activateDesignGroup.call(this,e,t,r,i)}.bind(this);v.length>0?v.forEach(a):e()}.bind(this);let e=0;var l=function(){++e===m.length+g.length&&s(function(){n[Vp._render](),n[Vp._fireProgressEvents](101),r()}.bind(this))}.bind(this),c=function(e){e.isLoaded=!0,this[bt._setObjectVisibility](e,t,l,a,i)}.bind(this),u=function(){m.forEach(c),g.forEach(c)}.bind(this);n[Vp._fireProgressEvents](-1),m.length>0?o.loadShapesFromList({objects:m,doneCallback:u,progressCallback:function(e,t){n[Vp._fireProgressEvents](t)}}):u()}else{let n=0;for(var h=function(){++n===e.length&&r()}.bind(this),d=0,f=e.length;d<f;++d)this[bt._setVisibilityHelper](e[d],t,h,i,a)}}else r()}function clearVisibility(e){e=e||function(){},n.clearBackgroundColor(),this[bt._setVisibilityHelper](this.psId,!1,function(){n.setEdgesVisibilityByPsId(n.psId,!1,function(){n.setVisibilityByPsId(n.psId,!1,e)})},!1,!0)}function activateDesignGroup(e,t,r,i){if(r=r||function(){},void 0!==p.userData.designGroupMap)var a=p.userData.designGroupMap[e.toString()];var o=function(){var e=[!1,!1],o=function(t){e[t]=!0,e[0]&&e[1]&&r()};if(a.partIds){n.setVisibilityByPsIds(a.partIds,!0,function(){o(0)})}else i?o(0):void 0!==a.refPsId?n.setVisibilityByPsId(a.refPsId,!0,o(0)):o(0);if(a.pmiIds){var s=function(){t&&this.reorientText(),o(1)}.bind(this);_loadPMIFromList.call(this,a.pmiIds,t,s,!1,!0)}else o(1)}.bind(this);void 0!==a?t?a===x?r():i?o():(x=a,clearVisibility.call(this,o)):a===x?(x=null,clearVisibility.call(this,function(){void 0!==a.refPsId?n.setVisibilityByPsId(a.refPsId,!0,r):r()})):(x=null,r()):r()}function mvCB_showEdges(e,t){e&&void 0!==e.edgeType?(n.setRenderMode(e.edgeType),n.setEdgesVisibilityByPsId(n.psId,!0,t)):t()}function _findNodeInJson(e,t){var n;if(t&&t.psId&&e===t.psId)n=t;else if(t.children)for(var r=0;!n&&r<t.children.length;++r)n=_findNodeInJson(e,t.children[r]);return n}function _removeNodeInJson(e,t){var n=!0;if(t.children){for(var i=0;n&&i<t.children.length;++i)if(t.children[i].psId===e){var a=t.children[i];t.children.splice(i,1),r.b._clearJsonObject(a),n=!1}else n=_removeNodeInJson(e,t.children[i]);0===t.children.length&&delete t.children}return n}function _getDescendentsInJson(e,t){if(e.children)for(var n=0;n<e.children.length;++n)_getDescendentsInJson(e.children[n],t);else e.psId&&t.push(e.psId)}function _getFlatModelViewsList(e){return e=e||[],r.b._notNullOrUndefined(g)&&function _getFlatMvListHelper(e,t){if(e.refPsId)t.push(e);else if(e.children)for(var n=e.children.length,r=0;r<n;++r)_getFlatMvListHelper(e.children[r],t)}(g,e),e}_PMI.prototype.setPmiMaterial=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0),mt(i.b.stringsByLabel.PMI_LOGGER_setPmiMaterial),t=r.b._getValidOpacity(t);var a=o;a.uniforms.diffuse.value.setHex(e),a.uniforms.opacity.value=t,a.transparent=t<1,a.needsUpdate=!0;var l=s;l.uniforms.diffuse.value.setHex(e),l.uniforms.opacity.value=t,l.transparent=t<1,l.needsUpdate=!0;var c=u;c.uniforms.diffuse.value.setHex(e),c.uniforms.opacity.value=.25*t,c.transparent=!0,c.needsUpdate=!0;var h=d;h.uniforms.color.value.setHex(e),h.uniforms.opacity.value=t,h.transparent=h.uniforms.opacity.value<1||h.uniforms.selectionOpacity.value,h.needsUpdate=!0,P(),n[Vp._render](),vt(i.b.stringsByLabel.PMI_LOGGER_finest_setPmiMaterial)},_PMI.prototype.getPmiStructureInfo=function(e,t,a){r.b._optionalArgCheck(e,r.b._isString),r.b._optionalArgCheck(t,r.b._isArray,r.b._isNumber),r.b._optionalArgCheck(a,r.b._isNumber),mt(i.b.stringsByLabel.PMI_LOGGER_getPmiStructureInfo),e=r.b._isNullOrUndefined(e)?this.psId:e,t=r.b._isNullOrUndefined(t)?[]:t,a=r.b._isNullOrUndefined(a)?1/0:a;var o=r.b._isNullOrUndefined(p)?null:p.getObjectByPsId(e,!0);return r.b._notNullOrUndefined(o)?n[Vp._getStructureHelper](o,t,a):{ERROR:"Failed to get object for psId:"+e}},_PMI.prototype.getDesignGroupsStructureInfo=function(){return mt(i.b.stringsByLabel.PMI_LOGGER_getDesignGroupsStructureInfo),f},_PMI.prototype.getModelViewsStructureInfo=function(){return mt(i.b.stringsByLabel.PMI_LOGGER_getModelViewsStructureInfo),g},_PMI.prototype[bt._setObjectVisibility]=function(e,t,r,i,a){var o=function(){i&&_bubbleUpVisibility(e),r()};e.isAssembly||e instanceof ze.Container?_processChildren.call(this,e,t,a,function(t){_updateAssemblyVisibilityState(e),o()}.bind(this)):e instanceof st||e instanceof ze.PmiLine||e instanceof ze.PmiRefPlane||e instanceof ze.PmiPoint?function _processEntity(e,t,r,i){let a=!1,o=!1,s=!1;var l=function(e){a&&o&&s&&i(e)},c=e.visibilityState;if(e.visibilityState=t?m.D.All:m.D.None,e.visible=t,e.instances&&e.instances.forEach(e=>{e.visibilityState=t?m.D.All:m.D.None,e.visible=t}),c!==e.visibilityState){if(_fireVisibilityChangeEvents(e),void 0!==e.userData.sectionOrigin&&void 0!==$i&&n.isExtensionLoaded($i)){var u=n.getExtensionManager($i);if(u)if(t)for(var h=0,d=e.userData.sectionOrigin.length;h<d;++h)e.userData.sectionIds.push(u.addSectionPlane(e.userData.sectionOrigin[h].x,e.userData.sectionOrigin[h].y,e.userData.sectionOrigin[h].z,e.userData.sectionDirection[h].x,e.userData.sectionDirection[h].y,e.userData.sectionDirection[h].z,m.z.NEGATIVE,!1));else for(;e.userData.sectionIds&&e.userData.sectionIds.length>0;)u.removeSectionPlane(e.userData.sectionIds.pop());u=null}var f=e.userData.pmiIds?e.userData.pmiIds.length:0,g=e.userData.nrPmiIds?e.userData.nrPmiIds.length:0;if(r&&(f=0,g=0),f>0)s=!0,_loadPMIFromList.call(this,e.userData.pmiIds,t,function(){o=!0,l()},!1,!0);else if(o=!0,g>0)for(var v=0,y=function(){++v===g&&(s=!0,l())}.bind(this),b=0;b<g;b++){var x=p.getObjectByPsId(e.userData.nrPmiIds[b]);_setObjectVisibilityNR.call(this,x,t,y)}else s=!0,l();_processChildren.call(this,e,t,r,function(){a=!0,l()})}else i()}.call(this,e,t,a,o):r()},_PMI.prototype.setVisibilityByPsId=function(e,t,i){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(i,r.b._isFunction),i=i||function(){};var a=function(){t&&(this.reorientText(),n[Vp._updateModelBoundingBox]()),i()}.bind(this);this[bt._setVisibilityHelper](e,t,a,!1,!0)},_PMI.prototype[bt._setVisibilityHelper]=function(e,t,r,i,a){r=r||function(){};var o=e===this.psId?p:p.getObjectByPsId(e,!0);if(o){var s=function(){n[Vp._fireProgressEvents](101);var e=function(){n[Vp._render](),r()}.bind(this);this[bt._setObjectVisibility](o,t,e,a,i)}.bind(this),l=function(e,t){n[Vp._fireProgressEvents](t)}.bind(this);if(t&&!0!==o.isLoaded)if(n[Vp._fireProgressEvents](-1),o===p){let e=0,t=o.children.length;for(var c=function(){++e===t&&(s(),o.isLoaded=!0)},u=0;u<o.children.length;u++)o.children[u].userData&&o.children[u].userData.psId?n[Vp._loadGeometryHelper](o.children[u],c,l):e++}else n[Vp._loadGeometryHelper](o,s,l);else s()}else if(e){if(void 0!==p.userData.designGroupMap)p.userData.designGroupMap[e.toString()]?activateDesignGroup.call(this,e,t,r,i):r();else r()}else r()},_PMI.prototype.setSelectionByPsId=function(e,t,o,s){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(o,r.b._isBoolean),r.b._optionalArgCheck(s,r.b._isBoolean),mt(i.b.stringsByLabel.PMI_LOGGER_setSelectionByPsId+t),s=!!r.b._isBoolean(s)&&s,t&&!s&&(_PMI.prototype[bt._clearSelection](),a[Di._clearHighlightBuffer]()),o=!r.b._isBoolean(o)||o;var l=[],c=e===p.userData.psId?p:p.getObjectByPsId(e,!0);void 0!==c&&null!==c&&this[bt._setObjectSelection](c,t,o,!0,l),n.setHighlightByPsIds(l,!0),vt(i.b.stringsByLabel.PMI_LOGGER_finest_setSelectionByPsId+t)},_PMI.prototype[bt._clearSelection]=function(e){null!==e&&void 0!==e||(e=p),e&&function _clearSelectionRecursive(e){_PMI.prototype[bt._setObjectSelection](e,!1,!1,!1);for(var t=0,n=e.children.length;t<n;t++)_clearSelectionRecursive(e.children[t])}(e)},_PMI.prototype[bt._setObjectSelection]=function(e,t,n,r,d){if(void 0!==e&&e.visible&&e.selected!==t){if(e.userData.updatedmaterial&&!t)e.material=e.userData.updatedmaterial,a[Di._setObjectSelection](e,t);else if("PmiRefPlane"===e.type&&e.selected!==t)e.material=t?h:u,a[Di._setObjectSelection](e,t);else if(e instanceof _.Mesh&&e.selected!==t)e.material=t?c:s,a[Di._setObjectSelection](e,t);else if(e instanceof _.LineSegments||e instanceof ze.PmiLine)e.material=t?l:o,a[Di._setObjectSelection](e,t);else if(e.isPoint)a[Di._setObjectSelection](e,t);else if(e instanceof _.Object3D){if(e.selected=t,_fireSelectionChangeEvents(e),void 0!==e.children&&null!==e.children)for(var f=e.children.length,m=0;m<f;++m)this[bt._setObjectSelection](e.children[m],t,n,r,d);e instanceof st&&e.shapes&&e.shapes.forEach(e=>{this[bt._setObjectSelection](e,t,n,r,d)})}else if(void 0===e.selected&&void 0!==e.children&&null!==e.children){for(f=e.children.length,m=0;m<f;++m)this[bt._setObjectSelection](e.children[m],t,n,r,d);_fireSelectionChangeEvents(e)}else gt(i.b.stringsByLabel.PMI_CONSOLE_warn__setObjectSelection,e.userData.psId);if(t&&n&&e.owner&&e.owner.userData.xtIds)for(var g=e.owner.userData.xtIds.length,v=0;v<g;++v)void 0!==e.owner.userData.xtIds[v]?d.push(e.owner.userData.xtIds[v]):gt(i.b.stringsByLabel.PMI_CONSOLE_warn2__setObjectSelection,e.owner.userData.psId,e.owner.userData.xtIds[v]);var y=null;if(r&&e.userData.pmiIds){var b=0;for(g=e.userData.pmiIds.length;b<g;++b)null!=(y=p.getObjectByPsId(e.userData.pmiIds[b],!0))&&void 0!==y&&this[bt._setObjectSelection](y,t,n,!0,d)}if(y=null,r&&e.userData.nrPmiIds)for(b=0,g=e.userData.nrPmiIds.length;b<g;++b)null!==(y=p.getObjectByPsId(e.userData.nrPmiIds[b],!0))&&void 0!==y&&this[bt._setObjectSelection](y,t,n,!1,d);y=null}},_PMI.prototype.setDesignGroupActive=function(e,t,n){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isFunction),mt(i.b.stringsByLabel.PMI_LOGGER_setDesignGroupActive),activateDesignGroup.call(this,e,t,n)},_PMI.prototype.setModelViewActive=function(e,t,a){var o;r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(a,r.b._isFunction),mt(i.b.stringsByLabel.PMI_LOGGER_setModelViewActive),a=a||function(){},void 0!==p.userData.modelViewMap&&null!==e&&void 0!==e&&(o=p.userData.modelViewMap[e.toString()]);var s=function(){var t=function(e){if(o.partIds){n.setVisibilityByPsIds(o.partIds,!0,function(){mvCB_showEdges.call(this,o,a)})}else if(o.excPartIds){var t=function(){if(o.excPartIds){n.setVisibilityByPsIds(o.excPartIds,!1,function(){mvCB_showEdges.call(this,o,a)})}else mvCB_showEdges.call(this,o,a)};o.refPsId?n.setVisibilityByPsId(o.refPsId,!0,t,!0):t()}else if(!e&&o.refPsId){var r=function(){mvCB_showEdges(o,a)}.bind(this);n.setVisibilityByPsId(o.refPsId,!0,r)}else mvCB_showEdges.call(this,o,a)};if(function alignToModelView(e){r.b._isString(e,!0),r.b._notNullOrUndefined(p.userData.modelViewMap,!0);const t=p.userData.modelViewMap[e.toString()],i=(new _.Vector4).fromArray(t.camera.slice(3,7)),a=(new _.Vector3).fromArray(t.camera.slice(0,3)),o=(new _.Vector3).fromArray(t.camera.slice(7,10)),s=(new _.Vector3).subVectors(a,o),l=s.length();if(r.b._floatEqual(l,0))return!1;s.normalize();const c=(new _.Vector3).copy(i),u=i.w,h=(new _.Quaternion).setFromAxisAngle(c,u),d=(new _.Matrix4).makeRotationFromQuaternion(h),f=new _.Vector3(0,1,0);c.normalize();let g=(new _.Vector3).subVectors(f,c);g.lengthSq()<1e-5?f.set(0,0,-1):g.length()>1.99999&&f.set(0,0,1);g.subVectors(f,s),g.lengthSq()<1e-5?f.set(-1,0,0):g.length()>1.99999&&f.set(1,0,0);const v=new _.Vector4;g=(new _.Vector4).copy(f),function multVecRight(e,t,n){let r=0,i=t.toArray(),a=[],o=e.elements[Symbol.iterator]();for(let e=0;e<4;++e){r=0;for(let e=0;e<4;++e)r+=o.next().value*i[e];a.push(r)}n.fromArray(a)}(d,g,v),v.multiplyScalar(1/v.w);const y=(new _.Vector3).copy(v);y.normalize();const b=t.cameraMode;!r.b._notNullOrUndefined(b,!1)||b!==m.c.PERSPECTIVE&&b!==m.c.ORTHOGRAPHIC||n.setCameraMode(b);const x=(new _.Vector3).addVectors(o,s.multiplyScalar(1.2*l));mt(`neweye:  ${x.x.toFixed(2)}  ${x.y.toFixed(2)}  ${x.z.toFixed(2)}`);const w=n._currentCamera,M=new _.Matrix4;return function findXFormForPart(e,t){const r=p.userData.modelViewMap[e.toString()],i=n._modelObject.getObjectByPsId(r.refPsId);return i&&t.copy(i.matrixWorld),t}(e,M),a.applyMatrix4(M),x.applyMatrix4(M),o.applyMatrix4(M),M.getInverse(M),M.transpose(),y.applyMatrix4(M),y.normalize(),w.position.copy(x),n.getNavigationManager().target.copy(o),w.up.copy(y),w.lookAt(o),!0}(e.toString()),r.b._notNullOrUndefined(o.bgColor)&&(M=!0,n.setBackgroundColor(o.bgColor)),o.pmiIds){var i=function(){this.reorientText();var e=n[Vp._getVisiblePartCount]()>0;t(e)}.bind(this);_loadPMIFromList.call(this,o.pmiIds,!0,i,!0,!0)}else t(!1)}.bind(this);void 0!==o?t?o===x?a():(x=o,clearVisibility.call(this,s)):o===x?(x=null,clearVisibility.call(this,function(){void 0!==o.refPsId?n.setVisibilityByPsId(o.refPsId,!0,a):a()})):(x=null,a()):a()},_PMI.prototype.clear=function(){this.clearPmiData()},_PMI.prototype[bt._getPmiObject]=function(e){for(var t=e;void 0!==t&&null!==t;){if(t instanceof st)return t;t=t.parent}return e},_PMI.prototype[bt._getPmiShapes]=function(e,t){if(void 0!==e&&null!==e||(e=p),null!==e&&(e.isPmi&&e.visible&&t.push(e),e.visible&&void 0!==e.children&&null!==e.children))for(var n=e.children.length,r=0;r<n;++r)this[bt._getPmiShapes](e.children[r],t)},_PMI.prototype[bt._getAncestryByPsId]=function(e,t){var i=null;if(p&&e!==this.psId&&(i=p.getObjectByPsId(e,!0))&&i instanceof st){var a={};a.psId=i.userData.psId.toString(),a.id=i.psId.toString(),a.type="PMI",t.push(a);var o=r.b._parsePsId(e);i=o.xtId&&o.psId?n._modelObject.getObjectByPsId(o.psId,!0):i.parent}return i},_PMI.prototype[bt._removeNode]=function(e){if(p)if(e===this.psId)this.clearPmiData();else{var t=p.getObjectByPsId(e,!0);if(t)this[bt._setObjectVisibility](t,!1,function(){!function _removeNodeHelper(e){var t=e.userData&&e.userData.psId?e.userData.psId:void 0;if(g&&t){var i=_findNodeInJson(t,g);if(i){var a=[];_getDescendentsInJson(i,a);for(var o=p.userData.modelViewMap,s=0;s<a.length;++s){var l=a[s];o&&o.hasOwnProperty(l)&&(delete o[l],p.removePsIdToObjectMap(l))}}_removeNodeInJson(t,g)}if(f&&t){var i=_findNodeInJson(t,f);if(i){var c=[];_getDescendentsInJson(i,c);for(var u=p.userData.designGroupMap,s=0;s<c.length;++s){var h=c[s];u&&u.hasOwnProperty(h)&&(delete u[h],p.removePsIdToObjectMap(h))}}_removeNodeInJson(t,f)}if(e.traverse(function(e){if(e.userData.psId)for(p.removePsIdToObjectMap(e.userData.psId);e.shapes&&e.shapes.length>0;){var t=e.shapes[0];n._scene.removeIndexedShape(t),E.remove(t),e.removeShape(t)}}),r.b._clearObject3D(e),e.parent){var s=e.parent.children.indexOf(e);s>-1&&e.parent.children.splice(s,1),_bubbleUpVisibility(e)}}(t)});else{var i=[];Object.keys(p.psIdToObjectMap).forEach(t=>{var n=t.indexOf("|");n>-1&&(t.slice(0,n)===e&&i.push(t))}),i.forEach(e=>{this[bt._removeNode](e)})}}},_PMI.prototype.clearPmiData=function(){mt("PMI-clearPmiData API:clearing the pmi data."),null!==p&&(p.clearPsIdToObjectMap(),r.b._clearJsonObject(p.userData.modelViewMap),p.userData.modelViewMap=null,r.b._clearJsonObject(g),g=null,r.b._clearJsonObject(p.userData.designGroupMap),p.userData.designGroupMap=null,r.b._clearJsonObject(f),f=null,r.b._clearObject3D(p),n._scene.remove(p),p=null,r.b._clearObject3D(E),n._scene.remove(E),E=null,n&&n[Vp._removeEventListener](m.i.cameraChanged,_cameraChangedHandler)),null!==v&&(r.b._clearObject3D(v),n._scene.remove(v),v=null),null!==b&&(r.b._clearArray(y),n._scene.remove(b),b=null),M&&(n.clearBackgroundColor(),M=!1),n[Vp._render](),vt("PMI-clearPmiData API:cleared the pmi data.")},_PMI.prototype.getModelViewThumbnails=function(e){if(r.b._isFunction(e,!0),mt("PMI-getModelViewThumbnails API:Returning the model view thumbnails."),g&&void 0!==ft&&n.isExtensionLoaded(ft)){n[Vp._ignoreSGO](!0);var t=n.isRendering();t&&n.stopRenderLoop();var i=n.getCameraMode(),a=n.getCameraOrientationInfo(),o=n.getExtensionManager(ft),s=o.getSnapshotEnabled();o.setSnapshotEnabled(!0);var l={},c=function(r){var c=document.createElement("img");c.setAttribute("src",r),c.style.width="100%",c.style.height="100%",c.style.position="absolute",c.style.top=0,c.style.left=0,c.style.zIndex=parseInt(n._renderer.domElement.style.zIndex)+1,n._renderer.domElement.parentElement.appendChild(c);var u=function(){n.setVisibilityByPsId(n.psId,!1),n.setCameraMode(i),null!==a&&n.setCameraOrientationInfo(a),n._renderer.domElement.parentElement.removeChild(c),n.setVisibilityByPsId(n.psId,!0),n[Vp._ignoreSGO](!1),this[bt._setVisibilityHelper](this.psId,!1,void 0,!1,!0),o.setSnapshotEnabled(s),t&&n.startRenderLoop(),e(l)}.bind(this),h=[];_getFlatModelViewsList(h);for(var d=0;d<h.length;++d)h[d].working&&delete h[d].working;var p=setInterval(function(){0===h.length?(clearInterval(p),u()):void 0===h[h.length-1].working&&(h[h.length-1].working=!0,function _getModelViewThumbnail(e,t){var r=null,i=function(){n[Vp._render](),t(r)};_PMI.prototype.setModelViewActive(e,!0,function(){n[Vp._render](),r=n._renderer.domElement.toDataURL(),_PMI.prototype.setModelViewActive(e,!1,i)})}(h[h.length-1].psId,function(e){h.length>0&&(l[h[h.length-1].psId]=e,h.pop())}))},10)}.bind(this);o.createSnapshotPNG(c)}else e({})},_PMI.prototype.getSelectionByPsId=function(e){r.b._isString(e,!0),mt("PMI-getSelectionByPsId API:Returning the selection state of a PMI object by its scene ID.");var t=e===this.psId?p:p.getObjectByPsId(e,!0);if(t)return t.selected},_PMI.prototype.getVisibilityStateByPsId=function(e){r.b._isString(e,!0),mt(i.b.stringsByLabel.PMI_LOGGER_getVisibilityStateByPsId+e);var t=e===this.psId?p:p.getObjectByPsId(e,!0);if(t)return t.visibilityState;vt(i.b.stringsByLabel.PMI_LOGGER_warn_getVisibilityStateByPsId)},_PMI.prototype.getFlatModelViewsList=function(e){return r.b._optionalArgCheck(e,r.b._isArray,r.b._isObject),mt("PMI-getFlatModelViewsList API:Returning all model views as a flat list."),_getFlatModelViewsList(e=e||[]),e},_PMI.prototype.getModelViewPmiPsIds=function(e){if(r.b._isString(e,!0),mt("PMI-getModelViewPmiPsIds API:Returning a Model View for its referenced PMI PSIDs."),void 0!==p.userData.modelViewMap){var t=p.userData.modelViewMap[e.toString()];if(void 0!==t&&void 0!==t.pmiIds)return t.pmiIds}return vt("PMI-getModelViewPmiPsIds API:model view map is empty."),[]},_PMI.prototype.getDesignGroupPmiPsIds=function(e){if(r.b._isString(e,!0),mt("PMI-getDesignGroupPmiPsIds API:Returning a Design Group for its referenced PMI PSIDs."),r.b._notNullOrUndefined(e)&&r.b._notNullOrUndefined(p)&&r.b._notNullOrUndefined(p.userData)&&r.b._notNullOrUndefined(p.userData.designGroupMap)){var t=p.userData.designGroupMap[e.toString()];if(void 0!==t&&void 0!==t.pmiIds)return t.pmiIds}return vt("PMI-getModelViewPmiPsIds API:Design group map is empty."),[]},_PMI.prototype.modelViewHasPMI=function(e){r.b._isString(e,!0),mt("PMI-modelViewHasPMI API:Checking if a modelView has PMI associated with it.");var t=p.userData.modelViewMap[e.toString()];return void 0!==t&&(null!==t.pmiIds&&void 0!==t.pmiIds&&(0!==t.pmiIds.length&&t.pmiIds.length>0))};var I=function(e,t){var n,r=e.userData.psId+"|"+t.id;return(n=new st(t)).userData.psId=r,p.addPsIdToObjectMap(r,n),p.add(n),n.owner=e,n.userData.psId};function _setMaterial(e,t){var n;return e&&r.b._notNullOrUndefined(e.materialIndex)&&t&&(n=t[e.materialIndex+6]),!e||e.geometryType!==m.A.Mesh?n||(n=o):n||(n=s),n}function _getPmiObjectTransformInfo(e,t){var n=new _.Vector3(e[0],e[1],e[2]).applyMatrix4(t),r=new _.Vector3(e[3],e[4],e[5]).applyMatrix4(t).sub(n),i=new _.Vector3(e[6],e[7],e[8]).applyMatrix4(t).sub(n),a=(new _.Vector3).crossVectors(r,i),o={xform:new _.Matrix4,origin:n,width:i,height:r,center:a,rotate:new _.Matrix4};if(0===i.length()||0===r.length())return o;var s=(new _.Matrix4).makeTranslation(n.x,n.y,n.z);o.xform.multiply(s);var l=new _.Vector3;return o.rotate.lookAt(l,a,r),o.xform.multiply(o.rotate),o}return _PMI.prototype.addPmiObjects=function(e,t){_initializePmiContainer(this);var r=n._modelObject.getObjectByPsId(e),i=[];if(r&&t instanceof Array)for(var a=0;a<t.length;++a){var o=I(r,t[a]);i.push(o)}return i},_PMI.prototype.addPmiShapes=function(e,t){!function addPmiShapes(e,t){if(!e||!t)return;if(t.geometries)for(var r=t.geometries.length,i=0;i<r;i++){var a,l=t.geometries[i];l.computeBoundingBox(),l.computeBoundingSphere(),void 0===l.isLines?(a=new ze.PmiSurface(l,s)).material.uniforms&&a.material.uniforms.tImage&&(a.material.uniforms.tImage.value.needsUpdate=!0):a=new ze.PmiLine(l,o),e.addShape(a),a.applyMatrix(e.matrixWorld),a.updateMatrixWorld(!0),n[Vp._expandModelBoundingBox](a),n._scene.addIndexedShape(a)}else{var c=_getPmiObjectTransformInfo(e.userData.pmiFrame,e.owner.matrixWorld),u=t.materials;if(!u){for(var h=e.owner;h&&h.parent&&!(h.parent instanceof ze.Container);)h=h.parent;h&&(u=h.userData.materialPool)}!function _getGeometryMaterial(e,t){e.extensionLines&&e.extensionLines.forEach(e=>{e.materials=_setMaterial(e.geometrySpec,t)}),e.arrowLines&&e.arrowLines.forEach(e=>{e.materials=_setMaterial(e.geometrySpec,t)}),e.arrows&&e.arrows.forEach(e=>{e.materials=_setMaterial(e.geometrySpec,t)}),e.text&&(e.text.materials=_setMaterial(e.text.geometrySpec,t))}(t,u),e.addShapes(t),e.shapes.forEach(e=>{e.userData.updatedmaterial=e.material,e.applyMatrix(c.xform),e.updateMatrixWorld(!0),n._scene.addIndexedShape(e)})}e.shapes.forEach(e=>{E.add(e)}),e.instances.forEach(e=>{!function addShapeInstance(e){e&&e.shapes.forEach(e=>{n[Vp._expandModelBoundingBox](e),n._scene.addIndexedShape(e)})}(e)})}(p.getObjectByPsId(e),t)},new _PMI(e)};xt.prototype={constructor:xt,_name:"PMI"};
// CONCATENATED MODULE: ./staging/ThreeOctree.js
/**@preserve
 * @file This file contains the derivative work of Octree.
 */
/**@preserve
 * @copyright github.com/collinhover/threeoctree/blob/master/LICENSE
 * @copyright 2017 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
 */
/**@preserve
 * Date          Name                     Description of Change
 * 01-Dec-2016   Collin Hover             Original version of threeoctree.js (r60).
 * 01-Dec-2016   Marco Zhou               Add support for indexing PLMVisWeb scene graph.
 * 01-Dec-2016   Marco Zhou               Add support for updating objects quadrant by reworking Octree.updateObject impl.
 * 06-Dec-2016   Marco Zhou               Add Octree.reset function to support resetting octree to its original state.
 * 06-Dec-2016   Marco Zhou               Remove Octree.objects and Octree.objectsMap to optimize memory usage.
 * 14-Dec-2016   Marco Zhou               Add Octree.searchClosestObjects function to support efficient filtering
 *                                        of distance objects for measurement algorithm
 * 18-Oct-2017   Jesse Perlstein          Fixed bug in Octree.rebuild for a variable missing var declaration
 * 22-Jan-2018   Anthony Scharf           Resolve SonarQube errors.
 * 26-Apr-2019   Dan Lee                  Fix three.js deprecation of getPositionFromMatrix.
 */
var _t=o()("PLMVisWeb:debug:ThreeOctree");
/*!
 * @preserve
 * threeoctree.js (r60) / https://github.com/collinhover/threeoctree
 * (sparse) dynamic 3D spatial representation structure for fast searches.
 *
 * @author Collin Hover / http://collinhover.com/
 * based on Dynamic Octree by Piko3D @ http://www.piko3d.com/ and Octree by Marek Pawlowski @ pawlowski.it
 *
 * @author Marco Zhou / http://www.plm.automation.siemens.com/
 */function distanceSqBetweenNodeAndBox(e,t){var n=0;return t.max.x<e.left?n+=Math.pow(t.max.x-e.left,2):t.min.x>e.right&&(n-=Math.pow(t.min.x-e.right,2)),t.max.y<e.bottom?n-=Math.pow(t.max.y-e.bottom,2):t.min.y>e.top&&(n-=Math.pow(t.min.y-e.top,2)),t.max.z<e.back?n-=Math.pow(t.max.z-e.back,2):t.min.z>e.front&&(n-=Math.pow(t.min.z-e.front,2)),n}var wt=function(e,t){var n=0;return e.min.x>t.max.x?n+=Math.pow(t.max.x-e.min.x,2):e.max.x<t.min.x&&(n+=Math.pow(t.min.x-e.max.x,2)),e.min.y>t.max.y?n+=Math.pow(t.max.y-e.min.y,2):e.max.y<t.min.y&&(n+=Math.pow(t.min.y-e.max.y,2)),e.min.z>t.max.z?n+=Math.pow(t.max.z-e.min.z,2):e.max.z<t.min.z&&(n+=Math.pow(t.min.z-e.max.z,2)),n};function sortedAdd(e,t){if(0!==e.length){for(var n=t.userData.distanceSq,r=0,i=e.length-1;i>r;){var a=r+i>>1;if((o=e[a].userData.distanceSq)===n)break;o>n?i=a-1:r=a+1}for(;r>=0;){var o;if((o=e[r].userData.distanceSq)<n){r++;break}r--}r<0&&(r=0),e.splice(r,0,t)}else e.push(t)}function ThreeOctree_isNumber(e){return!isNaN(e)&&isFinite(e)}function isValid(e){return void 0!==e&&null!==e}function toArray(e){return e?!0!==function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}(e)?[e]:e:[]}function indexOfValue(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var Mt=function(e){(e=e||{}).tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=ThreeOctree_isNumber(e.INDEX_OUTSIDE_POS_X)?e.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=ThreeOctree_isNumber(e.INDEX_OUTSIDE_NEG_X)?e.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=ThreeOctree_isNumber(e.INDEX_OUTSIDE_POS_Y)?e.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=ThreeOctree_isNumber(e.INDEX_OUTSIDE_NEG_Y)?e.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=ThreeOctree_isNumber(e.INDEX_OUTSIDE_POS_Z)?e.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=ThreeOctree_isNumber(e.INDEX_OUTSIDE_NEG_Z)?e.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new _.Vector3,this.utilVec32Search=new _.Vector3,this.scene=e.scene,this.scene&&(this.visualGeometry=new _.CubeGeometry(1,1,1),this.visualMaterial=new _.MeshBasicMaterial({color:16711782,wireframe:!0,wireframeLinewidth:1})),this.objectsData={},this.objectCount=0,this.objectsDeferred={},this.objectsDeferredCount=0,this.depthMax=ThreeOctree_isNumber(e.depthMax)?e.depthMax:1/0,this.objectsThreshold=ThreeOctree_isNumber(e.objectsThreshold)?e.objectsThreshold:8,this.overlapPct=ThreeOctree_isNumber(e.overlapPct)?e.overlapPct:.15,this.undeferred=e.undeferred||!1,this.root=e.root instanceof St?e.root:new St(e)};Mt.prototype={reset:function(){this.objectsData={},this.objectCount=0,this.objectsDeferred={},this.objectsDeferredCount=0,this.root.reset()},setLocation:function(e,t){this.root.setLocation(e,t)},update:function(){if(this.objectsDeferredCount>0){for(var e in this.objectsDeferred)if(this.objectsDeferred[e]){var t=this.objectsDeferred[e];this.addDeferred(t.object,t.options)}this.objectsDeferred={},this.objectsDeferredCount=0}},add:function(e,t){this.undeferred?this.addDeferred(e,t):this.objectsDeferred[e.id]||(this.objectsDeferred[e.id]={object:e,options:t},this.objectsDeferredCount++)},addDeferred:function(e,t){var n,r,i,a,o,s;if(e instanceof Et&&(e=e.object),!this.objectsData[e.id])if(t&&(a=t.useFaces,s=t.useVertices),!0===s)for(n=0,r=(o=e.geometry.vertices).length;n<r;n++)this.addObjectData(e,o[n]);else if(!0===a)for(n=0,r=(i=e.geometry.faces).length;n<r;n++)this.addObjectData(e,i[n]);else this.addObjectData(e)},addObjectData:function(e,t){var n=new Et(e,t);this.objectsData[e.id]=n,this.objectCount++,this.root.addObject(n)},remove:function(e){var t,n,r,i=e;if(e instanceof Et&&(e=e.object),this.objectsData[e.id])for(t=0,n=(r=this.root.removeObject(i)).length;t<n;t++)i=r[t],delete this.objectsData[i.object.id],this.objectCount--;else this.objectsDeferred[e.id]&&(delete this.objectsDeferred[e.id],this.objectsDeferredCount--)},extend:function(e){var t,n;if(e instanceof Mt)for(var r in t=e.objectsData)t[r]&&(n=t[r],this.add(n,{useFaces:n.faces,useVertices:n.vertices}))},rebuild:function(){var e,t,n,r=[];for(var i in this.objectsData)this.objectsData[i]&&(e=(t=this.objectsData[i]).node,t.update(),e instanceof St&&!t.positionLast.equals(t.position)&&(n=t.indexOctant,e.getOctantIndex(t)!==n&&r.push(t)));for(var a=0,o=r.length;a<o;a++)(t=r[a]).node.removeObject(t),this.root.addObject(t)},updateObject:function(e){var t=this.objectsData[e.id];if(null!==t&&void 0!==t){t.update();var n=t.node,r=t.indexOctant;n.getOctantIndex(t)!==r&&(t.node.removeObject(t),this.root.addObject(t))}},search:function(e,t,n,r){var i,a,o,s,l,c,u,h,d,p;for(o=[].concat(this.root.objects),t>0||(t=Number.MAX_VALUE),r instanceof _.Vector3&&(r=this.utilVec31Search.copy(r).normalize(),p=this.utilVec32Search.set(1,1,1).divide(r)),i=0,a=this.root.nodesIndices.length;i<a;i++)o=this.root.nodesByIndex[this.root.nodesIndices[i]].search(e,t,o,r,p);if(!0===n)for(c=[],h=[],i=0,a=o.length;i<a;i++)-1===(d=indexOfValue(h,l=(s=o[i]).object))?(u={object:l,faces:[],vertices:[]},c.push(u),h.push(l)):u=c[d],s.faces?u.faces.push(s.faces):s.vertices&&u.vertices.push(s.vertices);else c=o;return c},searchClosestObjects:function(e,t,n,r){r=this.root.searchMinDistance(e,t,n,r);var i=[],a=t+Math.sqrt(r);return this.root.searchPrecise(i,e,a,n,r),i},findClosestVertex:function(e,t){var n=this.search(e,t,!0);if(!n[0])return null;var r=n[0].object,i=n[0].vertices;if(0===i.length)return null;for(var a,o=null,s=r.worldToLocal(e.clone()),l=0,c=i.length;l<c;l++)(a=i[l].distanceTo(s))>t||(t=a,o=i[l]);return null===o?null:r.localToWorld(o.clone())},setRoot:function(e){e instanceof St&&(this.root=e,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};var Et=function(e,t){this.object=e,t instanceof _.Face3?(this.faces=t,this.face3=!0,this.utilVec31FaceBounds=new _.Vector3):t instanceof _.Face4?(this.face4=!0,this.faces=t,this.utilVec31FaceBounds=new _.Vector3):t instanceof _.Vector3&&(this.vertices=t),this.radius=0,this.position=new _.Vector3,this.object instanceof _.Object3D||this.object instanceof ze.ShapeInstance||this.object.boundingSphere?this.update():(e.position instanceof _.Vector3?this.position.set(e.position.x,e.position.y,e.position.z):this.position.set(e.x,e.y,e.z),this.radius=e.radius),this.positionLast=this.position.clone()};Et.prototype={update:function(){var e=this.object.matrixWorld.getMaxScaleOnAxis();this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces)*e,this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.face4?(this.radius=this.getFace4BoundingRadius(this.object,this.faces)*e,this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vertices?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius*e,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius*e,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):this.object.boundingSphere?(this.radius=this.object.boundingSphere.radius*e,this.position.copy(this.object.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)},getFace3BoundingRadius:function(e,t){var n=(e.geometry||e).vertices,r=t.centroid,i=n[t.a],a=n[t.b],o=n[t.c],s=this.utilVec31FaceBounds;return r.addVectors(i,a).add(o).divideScalar(3),Math.max(s.subVectors(r,i).length(),s.subVectors(r,a).length(),s.subVectors(r,o).length())},getFace4BoundingRadius:function(e,t){var n=(e.geometry||e).vertices,r=t.centroid,i=n[t.a],a=n[t.b],o=n[t.c],s=n[t.d],l=this.utilVec31FaceBounds;return r.addVectors(i,a).add(o).add(s).divideScalar(4),Math.max(l.subVectors(r,i).length(),l.subVectors(r,a).length(),l.subVectors(r,o).length(),l.subVectors(r,s).length())}};var St=function(e){this.utilVec31Branch=new _.Vector3,this.utilVec31Expand=new _.Vector3,this.utilVec31Ray=new _.Vector3,(e=e||{}).tree instanceof Mt?this.tree=e.tree:e.parent instanceof St||(e.root=this,this.tree=new Mt(e)),this.id=this.tree.nodeCount++,this.indexOctant=e.indexOctant,this.depth=0,this.reset(),this.setParent(e.parent),this.setLocation(e.position,e.radius)};St.prototype={setParent:function(e){e!==this&&this.parent!==e&&(this.parent=e,this.updateProperties())},updateProperties:function(){var e,t;for(this.parent instanceof St?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0,e=0,t=this.nodesIndices.length;e<t;e++)this.nodesByIndex[this.nodesIndices[e]].updateProperties()},setLocation:function(e,t){this.position=e instanceof _.Vector3?e:new _.Vector3,this.radius=t>0?t:1,this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual||(this.visual=new _.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.tree.scene.add(this.visual)),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.visual.updateMatrix(),this.visual.updateMatrixWorld())},reset:function(e,t){var n,r,i,a=this.nodesIndices||[],o=this.nodesByIndex;for(this.objects=[],this.nodesIndices=[],this.nodesByIndex={},n=0,r=a.length;n<r;n++)(i=o[a[n]]).setParent(void 0),!0===e&&i.reset(e,t);!0===t&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(e,t){e.indexOctant=t,-1===indexOfValue(this.nodesIndices,t)&&this.nodesIndices.push(t),this.nodesByIndex[t]=e,e.parent!==this&&e.setParent(this)},removeNode:function(e){var t,n;t=indexOfValue(this.nodesIndices,e),this.nodesIndices.splice(t,1),n=n||this.nodesByIndex[e],delete this.nodesByIndex[e],n.parent===this&&n.setParent(void 0)},addObject:function(e){var t;(t=this.getOctantIndex(e))>-1&&this.nodesIndices.length>0?this.branch(t).addObject(e):t<-1&&this.parent instanceof St?this.parent.addObject(e):(-1===indexOfValue(this.objects,e)&&this.objects.push(e),e.node=this,this.checkGrow())},addObjectWithoutCheck:function(e){var t,n,r;for(t=0,n=e.length;t<n;t++)r=e[t],this.objects.push(r),r.node=this},removeObject:function(e){var t,n,r,i;if((r=(i=this.removeObjectRecursive(e,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]})).nodesRemovedFrom).length>0)for(t=0,n=r.length;t<n;t++)r[t].shrink();return i.objectsDataRemoved},removeObjectRecursive:function(e,t){var n,r,i,a,o=-1;if(e instanceof Et)-1!==(o=indexOfValue(this.objects,e))&&(this.objects.splice(o,1),e.node=void 0,t.objectsDataRemoved.push(e),t.searchComplete=a=!0);else for(n=this.objects.length-1;n>=0;n--)if((i=this.objects[n]).object===e&&(this.objects.splice(n,1),i.node=void 0,t.objectsDataRemoved.push(i),a=!0,!i.faces&&!i.vertices)){t.searchComplete=!0;break}if(!0===a&&t.nodesRemovedFrom.push(this),!0!==t.searchComplete)for(n=0,r=this.nodesIndices.length;n<r&&!0!==(t=this.nodesByIndex[this.nodesIndices[n]].removeObjectRecursive(e,t)).searchComplete;n++);return t},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()},grow:function(){var e,t,n,r,i=[],a=[],o=[],s=[],l=[];for(n=0,r=this.objects.length;n<r;n++)t=this.objects[n],(e=this.getOctantIndex(t))>-1?(o.push(t),s.push(e)):e<-1?(i.push(t),a.push(e)):l.push(t);o.length>0&&(l=l.concat(this.split(o,s))),i.length>0&&(l=l.concat(this.expand(i,a))),this.objects=l,this.checkMerge()},split:function(e,t){var n,r,i,a,o;if(this.depth<this.tree.depthMax){for(e=e||this.objects,t=t||[],o=[],n=0,r=e.length;n<r;n++)a=e[n],(i=t[n])>-1?this.branch(i).addObject(a):o.push(a);e===this.objects&&(this.objects=o)}else o=this.objects;return o},branch:function(e){var t,n,r,i,a;return this.nodesByIndex[e]instanceof St?t=this.nodesByIndex[e]:(r=(n=.5*this.radiusOverlap)-n*this.tree.overlapPct,i=this.utilVec31Branch.set(1&e?r:-r,2&e?r:-r,4&e?r:-r),a=(new _.Vector3).addVectors(this.position,i),t=new St({tree:this.tree,parent:this,position:a,radius:n,indexOctant:e}),this.addNode(t,e)),t},expand:function(e,t){var n,r,i,a,o,s,l,c,u,h,d,p,f,m,g,v,y,b,x,w,M,E,S,L,T,A,C,P,I=this.tree.INDEX_OUTSIDE_MAP,O=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){for(e=e||this.objects,t=t||[],a=[],o=[],n=0,r=I.length;n<r;n++)I[n].count=0;for(n=0,r=e.length;n<r;n++)i=e[n],(s=t[n])<-1?((l=-s-this.tree.INDEX_OUTSIDE_OFFSET)&this.tree.FLAG_POS_X?I[this.tree.INDEX_OUTSIDE_POS_X].count++:l&this.tree.FLAG_NEG_X&&I[this.tree.INDEX_OUTSIDE_NEG_X].count++,l&this.tree.FLAG_POS_Y?I[this.tree.INDEX_OUTSIDE_POS_Y].count++:l&this.tree.FLAG_NEG_Y&&I[this.tree.INDEX_OUTSIDE_NEG_Y].count++,l&this.tree.FLAG_POS_Z?I[this.tree.INDEX_OUTSIDE_POS_Z].count++:l&this.tree.FLAG_NEG_Z&&I[this.tree.INDEX_OUTSIDE_NEG_Z].count++,o.push(i)):a.push(i);if(o.length>0)for((u=I.slice(0)).sort(function(e,t){return t.count-e.count}),f=1|(h=u[0]).index,g=u[1],v=u[2],m=1|(d=(1|g.index)!==f?g:v).index,g=u[2],v=u[3],y=u[4],b=1|g.index,x=1|v.index,p=b!==f&&b!==m?g:x!==f&&x!==m?v:y,w=h.x+d.x+p.x,M=h.y+d.y+p.y,E=h.z+d.z+p.z,s=this.getOctantIndexFromPosition(w,M,E),c=this.getOctantIndexFromPosition(-w,-M,-E),S=this.overlap,L=this.radius,T=(A=this.tree.overlapPct>0?S/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*L)+A*this.tree.overlapPct-(L+S),O.set(1&s?T:-T,2&s?T:-T,4&s?T:-T),C=(new _.Vector3).addVectors(this.position,O),(P=new St({tree:this.tree,position:C,radius:A})).addNode(this,c),this.tree.setRoot(P),n=0,r=o.length;n<r;n++)this.tree.root.addObject(o[n]);e===this.objects&&(this.objects=a)}else a=e;return a},shrink:function(){this.checkMerge(),this.tree.root.checkContract()},checkMerge:function(){for(var e,t=this;t.parent instanceof St&&t.getObjectCountEnd()<this.tree.objectsThreshold;)e=t,t=t.parent;t!==this&&t.merge(e)},merge:function(e){var t,n,r;for(t=0,n=(e=toArray(e)).length;t<n;t++)r=e[t],this.addObjectWithoutCheck(r.getObjectsEnd()),r.reset(!0,!0),this.removeNode(r.indexOctant,r);this.checkMerge()},checkContract:function(){var e,t,n,r,i,a,o;if(this.nodesIndices.length>0){for(a=0,o=this.objects.length,e=0,t=this.nodesIndices.length;e<t;e++)o+=r=(n=this.nodesByIndex[this.nodesIndices[e]]).getObjectCountEnd(),(i instanceof St==!1||r>a)&&(i=n,a=r);(o-=a)<this.tree.objectsThreshold&&i instanceof St&&this.contract(i)}},contract:function(e){var t,n,r;for(t=0,n=this.nodesIndices.length;t<n;t++)(r=this.nodesByIndex[this.nodesIndices[t]])!==e&&(e.addObjectWithoutCheck(r.getObjectsEnd()),r.reset(!0,!0));e.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(e),e.checkContract()},getOctantIndex:function(e){var t,n;return e instanceof Et?(n=e.radius,t=e.position,e.positionLast.copy(t)):e instanceof St&&(t=e.position,n=0),e.indexOctant=this.getOctantIndexFromPositionAndRadius(t,n),e.indexOctant},getOctantIndexFromPositionAndRadius:function(e,t){var n=0,r=e.x-this.position.x,i=e.y-this.position.y,a=e.z-this.position.z,o=Math.abs(r),s=Math.abs(i),l=Math.abs(a);if(Math.max(o,s,l)+t>this.radiusOverlap)return o+t>this.radiusOverlap&&(n^=r>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),s+t>this.radiusOverlap&&(n^=i>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),l+t>this.radiusOverlap&&(n^=a>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),n=-n-this.tree.INDEX_OUTSIDE_OFFSET;if(r-t>-this.overlap)n|=1;else if(!(r+t<this.overlap))return this.tree.INDEX_INSIDE_CROSS;if(i-t>-this.overlap)n|=2;else if(!(i+t<this.overlap))return this.tree.INDEX_INSIDE_CROSS;if(a-t>-this.overlap)n|=4;else if(!(a+t<this.overlap))return this.tree.INDEX_INSIDE_CROSS;return n},getOctantIndexFromPosition:function(e,t,n){var r=0;return e>0&&(r|=1),t>0&&(r|=2),n>0&&(r|=4),r},searchPrecise:function(e,t,n,r,i){if(!0===this.intersectSphere(t,n)){!function gatherObjects(e,t,n,r){for(var i=0,a=e.length;i<a;i++){var o,s=e[i];(o=isValid(s.object.boundingBox)?wt(n,s.object.boundingBox):distanceSqToBox(s.position,n))<=r&&(s.userData||(s.userData={}),s.userData.distanceSq=o,sortedAdd(t,s))}}(this.objects,e,r,i);for(var a=0,o=this.nodesIndices.length;a<o;a++){this.nodesByIndex[this.nodesIndices[a]].searchPrecise(e,t,n,r,i)}}},search:function(e,t,n,r,i){var a,o;if(!0===(r?this.intersectRay(e,r,t,i):this.intersectSphere(e,t)))for(n=n.concat(this.objects),a=0,o=this.nodesIndices.length;a<o;a++)n=this.nodesByIndex[this.nodesIndices[a]].search(e,t,n,r);return n},searchMinDistance:function(e,t,n,r){if(this.nodesIndices.length>0){var i=this.getOctantIndexFromPositionAndRadius(e,t);if(i>-1&&this.nodesIndices.length>0){if(0!==(c=this.branch(i)).objects.length||0!==c.nodesIndices.length)return c.searchMinDistance(e,t,n,r);i=-2}if(i<-1||0===this.objects.length){for(var a=null,o=1/0,s=0,l=this.nodesIndices.length;s<l;s++){var c;if(0!==(c=this.nodesByIndex[this.nodesIndices[s]]).objects.length||0!==c.nodesIndices.length){var u=distanceSqBetweenNodeAndBox(c,n);u<o&&(a=c,o=u)}}if(a)return a.searchMinDistance(e,t,n,r)}}return function calculateMinDistance(e,t,n){for(var r=e;r;){var i=r.parent;if(!i)break;if(0===r.objects.length)for(var a=0,o=i.nodesIndices.length;a<o;a++){var s=i.nodesByIndex[i.nodesIndices[a]];if(s.objects.length>0){r=s;break}}if(r.objects.length>0)break;r=i}var l=1/0;if(0===(o=r.objects.length))l=distanceSqBetweenNodeAndBox(r,t);else for(a=0;a<o;a++){var c,u=r.objects[a];if((c=isValid(u.object.boundingBox)?wt(t,u.object.boundingBox):distanceSqBetweenNodeAndBox(r,t))<l&&(l=c),0===l)break}return Math.min(n,l)}(this,n,r)},intersectSphere:function(e,t){var n=t*t,r=e.x,i=e.y,a=e.z;return r<this.left?n-=Math.pow(r-this.left,2):r>this.right&&(n-=Math.pow(r-this.right,2)),i<this.bottom?n-=Math.pow(i-this.bottom,2):i>this.top&&(n-=Math.pow(i-this.top,2)),a<this.back?n-=Math.pow(a-this.back,2):a>this.front&&(n-=Math.pow(a-this.front,2)),n>=0},intersectRay:function(e,t,n,r){void 0===r&&(r=this.utilVec31Ray.set(1,1,1).divide(t));var i,a=(this.left-e.x)*r.x,o=(this.right-e.x)*r.x,s=(this.bottom-e.y)*r.y,l=(this.top-e.y)*r.y,c=(this.back-e.z)*r.z,u=(this.front-e.z)*r.z,h=Math.min(Math.min(Math.max(a,o),Math.max(s,l)),Math.max(c,u));return!(h<0)&&!((i=Math.max(Math.max(Math.min(a,o),Math.min(s,l)),Math.min(c,u)))>h||i>n)},getDepthEnd:function(e){var t,n;if(this.nodesIndices.length>0)for(t=0,n=this.nodesIndices.length;t<n;t++)e=this.nodesByIndex[this.nodesIndices[t]].getDepthEnd(e);else e=!e||this.depth>e?this.depth:e;return e},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var e,t,n=this.nodesIndices.length;for(e=0,t=this.nodesIndices.length;e<t;e++)n+=this.nodesByIndex[this.nodesIndices[e]].getNodeCountRecursive();return n},getObjectsEnd:function(e){var t,n;for(e=(e||[]).concat(this.objects),t=0,n=this.nodesIndices.length;t<n;t++)e=this.nodesByIndex[this.nodesIndices[t]].getObjectsEnd(e);return e},getObjectCountEnd:function(){var e,t,n=this.objects.length;for(e=0,t=this.nodesIndices.length;e<t;e++)n+=this.nodesByIndex[this.nodesIndices[e]].getObjectCountEnd();return n},getObjectCountStart:function(){for(var e=this.objects.length,t=this.parent;t instanceof St;)e+=t.objects.length,t=t.parent;return e},toConsole:function(e){var t,n;for(e="string"==typeof e?e:"   ",_t(this.parent?e+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),_t(this.parent?e+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),_t(this.parent?e+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex),t=0,n=this.nodesIndices.length;t<n;t++)this.nodesByIndex[this.nodesIndices[t]].toConsole(e+"   ")}};var Lt={intersectOctreeObject:function(e,t){var n,r,i,a;return e.object instanceof _.Object3D?(e=(r=e).object,a=r.faces,i=e.geometry.faces,a.length>0&&(e.geometry.faces=a),n=this.intersectObject(e,t),a.length>0&&(e.geometry.faces=i)):n=this.intersectObject(e,t),n},intersectOctreeObjects:function(e,t){var n,r,i=[];for(n=0,r=e.length;n<r;n++)i=i.concat(this.intersectOctreeObject(e[n],t));return i.sort(function(e,t){return e.distance-t.distance}),i},Octree:Mt,OctreeObjectData:Et,OctreeNode:St},Tt=o()("PLMVisWeb:debug:Measurement"),At=function(e,t){var n=function(e){for(var t=4,n=r.b._getUnitScale(e);n>=10;)n/=10,t+=1;return t}(t),i=Math.pow(10,n);return(e=Math.round(e*i))/i},Ct=function(e){return null!==e&&void 0!==e},Pt=function(e,t){return"("+At(e.x,t)+", "+At(e.y,t)+", "+At(e.z,t)+")"},It=function(e){var t="";if(e)switch(e){case m.E.UNKNOWN:t=m.F.UNKNOWN;break;case m.E.MICROMETER:t=m.F.MICROMETER;break;case m.E.MILLIMETER:t=m.F.MILLIMETER;break;case m.E.CENTIMETER:t=m.F.CENTIMETER;break;case m.E.DECIMETER:t=m.F.DECIMETER;break;case m.E.METER:t=m.F.METER;break;case m.E.KILOMETER:t=m.F.KILOMETER;break;case m.E.INCH:t=m.F.INCH;break;case m.E.FEET:t=m.F.FEET;break;case m.E.YARD:t=m.F.YARD;break;case m.E.MILE:t=m.F.MILE;break;case m.E.MIL:t=m.F.MIL}return t},Ot=function(e,t,n){if(t===n)return!0;var i=e[t+0],a=e[t+1],o=e[t+2],s=e[n+0],l=e[n+1],c=e[n+2];return r.b._vertexEqual(i,a,o,s,l,c)},Bt=function(e,t,n,r){return!Ot(e,t,n)&&!Ot(e,n,r)&&!Ot(e,r,t)},Rt=function(e,t,n,r,i,a){return e*r+t*i+n*a},Gt=function(e,t,n,r,i,a){var o=e-r,s=t-i,l=n-a;return o*o+s*s+l*l},Dt=function(e,t,n){var r=-1;return t<0?n>0?(r=-t/e)>1&&(r=.5):r=1:r=0,r},Vt=function(e,t,n){return e+n*(t-e)},Nt=function(e,t,n,r,i,a,o,s,l){var c=o-r,u=s-i,h=l-a,d=e-r,p=t-i,f=n-a,m=Rt(c,u,h,c,u,h),g=Rt(d,p,f,c,u,h),v=-1,y=Vt(r,o,v=g<=0?0:g>m?1:g/m),b=Vt(i,s,v),x=Vt(a,l,v);return{distanceSquared:Gt(y,b,x,e,t,n),p:{x:e,y:t,z:n},q:{x:y,y:b,z:x}}},Ut=function(e,t,n,r,i,a,o,s,l,c,u,h){var d=r-e,p=i-t,f=a-n,m=c-o,g=u-s,v=h-l,y=e-o,b=t-s,x=n-l,_=Rt(d,p,f,d,p,f),w=Rt(d,p,f,m,g,v),M=Rt(m,g,v,m,g,v),E=Rt(d,p,f,y,b,x),S=Rt(m,g,v,y,b,x),L=E,T=L+_,A=L-w,C=T-w,P=-S,I=P+M,O=P-w,B=O+M,R=[];if(_>0&&M>0){var G=Dt(_,L,T),D=Dt(_,A,C),V=G<=0?-1:G>=1?1:0,N=D<=0?-1:D>=1?1:0;if(-1==V&&-1==N)R[0]=0,R[1]=Dt(M,P,I);else if(1==V&&1==N)R[0]=1,R[1]=Dt(M,O,B);else{var U=[],F=[[],[]];!function(e,t,n,r,i,a,o,s,l){r<0?(s[0]=0,l[0][0]=0,l[0][1]=t/e,(l[0][1]<0||l[0][1]>1)&&(l[0][1]=.5),0===i?(s[1]=3,l[1][0]=o,l[1][1]=1):(s[1]=1,l[1][0]=1,l[1][1]=n/e,(l[1][1]<0||l[1][1]>1)&&(l[1][1]=.5))):0===r?(s[0]=2,l[0][0]=a,l[0][1]=0,i<0?(s[1]=0,l[1][0]=0,l[1][1]=t/e,(l[1][1]<0||l[1][1]>1)&&(l[1][1]=.5)):0===i?(s[1]=3,l[1][0]=i,l[1][1]=1):(s[1]=1,l[1][0]=1,l[1][1]=n/e,(l[1][1]<0||l[1][1]>1)&&(l[1][1]=.5))):(s[0]=1,l[0][0]=1,l[0][1]=n/e,(l[0][1]<0||l[0][1]>1)&&(l[0][1]=.5),0===i?(s[1]=3,l[1][0]=o,l[1][1]=1):(s[1]=0,l[1][0]=0,l[1][1]=t/e,(l[1][1]<0||l[1][1]>1)&&(l[1][1]=.5)))}(w,L,T,V,N,G,D,U,F),function(e,t,n,r,i,a,o,s,l,c){var u=l[1][1]-l[0][1],h=u*(-e*l[0][0]+t*l[0][1]-n);if(h>=0)0===s[0]?(c[0]=0,c[1]=Dt(t,r,a)):1===s[0]?(c[0]=1,c[1]=Dt(t,i,o)):(c[0]=l[0][0],c[1]=l[0][1]);else{var d=u*(-e*l[1][0]+t*l[1][1]-n);if(d<=0)0===s[1]?(c[0]=0,c[1]=Dt(t,r,a)):1===s[1]?(c[0]=1,c[1]=Dt(t,i,o)):(c[0]=l[0][0],c[1]=l[0][1]);else{var p=function(e){return e>1?1:e<0?0:e}(h/(h-d));c[0]=Vt(l[0][0],l[1][0],p),c[1]=Vt(l[0][1],l[1][1],p)}}}(w,M,S,P,O,I,B,U,F,R)}}else _>0?(R[0]=Dt(_,L,T),R[1]=0):M>0?(R[0]=0,R[1]=Dt(M,P,I)):(R[0]=0,R[1]=0);var z=Vt(e,r,R[0]),k=Vt(t,i,R[0]),j=Vt(n,a,R[0]),H=Vt(o,c,R[1]),W=Vt(s,u,R[1]),X=Vt(l,h,R[1]);return{distanceSquared:Gt(z,k,j,H,W,X),p:{x:z,y:k,z:j},q:{x:H,y:W,z:X}}},Ft=function(e,t,n,r,i,a,o,s,l,c,u,h){var d=r,p=i,f=a,m=o-r,g=s-i,v=l-a,y=c-r,b=u-i,x=h-a,_=d-e,w=p-t,M=f-n,E=Rt(m,g,v,m,g,v),S=Rt(m,g,v,y,b,x),L=Rt(y,b,x,y,b,x),T=Rt(m,g,v,_,w,M),A=Rt(y,b,x,_,w,M),C=E*L-S*S,P=S*A-L*T,I=S*T-E*A;if(P+I<=C)if(P<0)I<0&&T<0?(I=0,P=-T>=E?1:-T/E):(P=0,I=A>=0?0:-A>=L?1:-A/L);else if(I<0)I=0,P=T>=0?0:-T>=E?1:-T/E;else{var O=1/C;P*=O,I*=O}else if(P<0)(R=L+A)>(B=S+T)?I=1-(P=(G=R-B)>=(D=E-2*S+L)?1:G/D):(P=0,I=R<=0?1:A>=0?0:-A/L);else if(I<0){var B,R;if((R=S+A)<(B=E+T)){if((G=L+A-S-T)<=0)P=0;else P=G>=(D=E-2*S+L)?1:G/D;I=1-P}else I=0,P=B<=0?1:T>=0?0:-T/E}else{var G,D;if((G=L+A-S-T)<=0)P=0;else P=G>=(D=E-2*S+L)?1:G/D;I=1-P}var V=d+P*m+I*y,N=p+P*g+I*b,U=f+P*v+I*x;return{distanceSquared:Gt(V,N,U,e,t,n),p:{x:e,y:t,z:n},q:{x:V,y:N,z:U}}},zt=function(e,t,n,r,i,a){for(var o=0;o<3;o++){var s=3*i[a+o],l=3*i[a+(o+1)%3],c=r[s+0],u=r[s+1],h=r[s+2],d=r[l+0],p=r[l+1],f=r[l+2],m=Ut(t.x,t.y,t.z,n.x,n.y,n.z,c,u,h,d,p,f);(null===e||m.distanceSquared<e.distanceSquared)&&(e=m)}return e},kt=new _.Matrix4,jt=function(e,t,n){var r=new _.Vector3(e[t],e[t+1],e[t+2]);return n!==kt&&r.applyMatrix4(n),r},Ht=function(e,t,n,r,i,a,o){var s=null,l=3*n[r],c=3*n[r+1],u=3*n[r+2],h=jt(t,l,e),d=jt(t,c,e),p=jt(t,u,e);s=zt(s,h,d,i,a,o),s=zt(s,d,p,i,a,o),s=zt(s,p,h,i,a,o);l=3*a[o],c=3*a[o+1],u=3*a[o+2];var f=i[l],m=i[l+1],g=i[l+2],v=i[c],y=i[c+1],b=i[c+2],x=i[u],_=i[u+1],w=i[u+2],M=Ft(h.x,h.y,h.z,f,m,g,v,y,b,x,_,w);M.distanceSquared<s.distanceSquared&&(s=M),(M=Ft(d.x,d.y,d.z,f,m,g,v,y,b,x,_,w)).distanceSquared<s.distanceSquared&&(s=M),(M=Ft(p.x,p.y,p.z,f,m,g,v,y,b,x,_,w)).distanceSquared<s.distanceSquared&&(s=M);for(var E=0;E<3;E++){var S=3*a[o+E],L=i[S],T=i[S+1],A=i[S+2];(M=Ft(L,T,A,h.x,h.y,h.z,d.x,d.y,d.z,p.x,p.y,p.z)).distanceSquared<s.distanceSquared&&(s=M)}return s},Wt=function(e,t,n,r,i,a,o){for(var s=null,l=jt(t,n,e),c=jt(t,r,e),u=0;u<3;u++){var h=3*a[o+u],d=3*a[o+(u+1)%3],p=i[h+0],f=i[h+1],m=i[h+2],g=i[d+0],v=i[d+1],y=i[d+2],b=Ut(l.x,l.y,l.z,c.x,c.y,c.z,p,f,m,g,v,y);(null===s||b.distanceSquared<s.distanceSquared)&&(s=b)}d=3*a[o];var x=3*a[o+1],_=3*a[o+2];return(b=Ft(t,n,i,d,x,_)).distanceSquared<s.distanceSquared&&(s=b),(b=Ft(t,r,i,d,x,_)).distanceSquared<s.distanceSquared&&(s=b),s},Xt=null,qt=function(e){return null===Xt?Xt=new Lt.Octree({undeferred:!0,depthMax:1/0,objectsThreshold:1,overlapPct:0,position:e?e.center:void 0,radius:e?e.radius:void 0}):(Xt.reset(),e&&Xt.setLocation(e.center,e.radius)),Xt},Yt=function(e,t,n,r,i){var a=3*n[r],o=3*n[r+1],s=3*n[r+2],l=1/3*(t[a]+t[o]+t[s]),c=1/3*(t[a+1]+t[o+1]+t[s+1]),u=1/3*(t[a+2]+t[o+2]+t[s+2]);e.position.set(l,c,u);var h=Gt(l,c,u,t[a],t[a+1],t[a+2]),d=Gt(l,c,u,t[o],t[o+1],t[o+2]),p=Gt(l,c,u,t[s],t[s+1],t[s+2]);e.radius=Math.sqrt(Math.max(h,Math.max(d,p)));var f=Math.min(t[a],Math.min(t[o],t[s])),m=Math.max(t[a],Math.max(t[o],t[s])),g=Math.min(t[a+1],Math.min(t[o+1],t[s+1])),v=Math.max(t[a+1],Math.max(t[o+1],t[s+1])),y=Math.min(t[a+2],Math.min(t[o+2],t[s+2])),b=Math.max(t[a+2],Math.max(t[o+2],t[s+2])),x=e.boundingBox;x||(x=new _.Box3,e.boundingBox=x),x.min.set(f,g,y),x.max.set(m,v,b),i!==kt&&(x.applyMatrix4(i),e.position.applyMatrix4(i),e.radius=e.radius*i.getMaxScaleOnAxis())},Zt=function(e,t,n,r,i){for(var a=0,o=r;o<i;o+=3)if(Bt(t,3*n[o],3*n[o+1],3*n[o+2])){var s={position:new _.Vector3,radius:0,id:a++,index:o};Yt(s,t,n,o,kt),e.add(s)}},Jt=function(e,t){var n=kt;return e!==t&&e.matrixWorld!==t.matrixWorld&&(n=kt.clone()).multiplyMatrices(n.getInverse(t.matrixWorld),e.matrixWorld),n},Qt=function(e,t,n,r){var i=n,a=n+3,o=.5*(t[i]+t[a]),s=.5*(t[i+1]+t[a+1]),l=.5*(t[i+2]+t[a+2]);e.position.set(o,s,l);var c=Gt(o,s,l,t[i],t[i+1],t[i+2]),u=Gt(o,s,l,t[a],t[a+1],t[a+2]);e.radius=Math.sqrt(Math.max(c,u));var h=Math.min(t[i],t[a]),d=Math.max(t[i],t[a]),p=Math.min(t[i+1],t[a+1]),f=Math.max(t[i+1],t[a+1]),m=Math.min(t[i+2],t[a+2]),g=Math.max(t[i+2],t[a+2]),v=e.boundingBox;v||(v=new _.Box3,e.boundingBox=v),v.min.set(h,p,m),v.max.set(d,f,g),r!==kt&&(v.applyMatrix4(r),e.position.applyMatrix4(r),e.radius=e.radius*r.getMaxScaleOnAxis())},Kt=function(e,t){for(var n=0,r=0,i=t.length;r<i;r+=6){var a={position:new _.Vector3,radius:0,id:n++,index:r};Qt(a,t,r,kt),e.add(a)}},$t=function(e,t,n,r){var i=null;if(t.length*r.length/36<=128){for(var a=Jt(e,n),o=0,s=t.length;o<s;o+=6){for(var l=o+3,c=jt(t,o,a),u=jt(t,l,a),h=0,d=r.length;h<d;h+=6){var p=h,f=h+3,m=r[p+0],g=r[p+1],v=r[p+2],y=r[f+0],b=r[f+1],x=r[f+2],w=Ut(c.x,c.y,c.z,u.x,u.y,u.z,m,g,v,y,b,x);if((null===i||w.distanceSquared<i.distanceSquared)&&(i=w),0===i.distanceSquared)break}if(0===i.distanceSquared)break}i.distance=0===i.distanceSquared?0:Math.sqrt(i.distanceSquared)}else{var M=e,E=n,S=t,L=r;t.length>r.length&&(M=n,E=e,S=r,L=t),i=function(e,t,n,r){var i=null,a=1/0,o=qt();Kt(o,r);for(var s={position:new _.Vector3,radius:0},l=Jt(e,n),c=0,u=t.length;c<u;c+=6){Qt(s,t,c,l);for(var h=c+3,d=jt(t,c,l),p=jt(t,h,l),f=o.searchClosestObjects(s.position,s.radius,s.boundingBox,a),m=0,g=f.length;m<g;m++){var v=f[m],y=v.object.index;if(!(v.userData.distanceSq>=a)){var b=y,x=y+3,w=r[b+0],M=r[b+1],E=r[b+2],S=r[x+0],L=r[x+1],T=r[x+2],A=Ut(d.x,d.y,d.z,p.x,p.y,p.z,w,M,E,S,L,T);if(A.distanceSquared<a&&(i=A,a=A.distanceSquared),0===a)break}}if(0===a)break}return i.distance=0===i.distanceSquared?0:Math.sqrt(i.distanceSquared),i}(M,S,E,L)}return i},en=function(e,t,n,r,i,a,o){var s=null,l=t.length/6,c=(o-a)/3;if(l*c<=128){for(var u=Jt(e,n),h=0,d=t.length;h<d;h+=6){for(var p=a;p<o;p+=3)if(Bt(r,3*i[p],3*i[p+1],3*i[p+2])){var f=Wt(u,t,h,h+3,r,i,p);if((null===s||f.distanceSquared<s.distanceSquared)&&(s=f),0===Gt)break}if(0===Gt)break}s.distance=0===s.distanceSquared?0:Math.sqrt(s.distanceSquared)}else s=l<=c?function(e,t,n,r,i,a,o){var s=null,l=1/0,c=qt();Zt(c,r,i,a,o);for(var u={position:new _.Vector3,radius:0},h=Jt(e,n),d=0,p=t.length;d<p;d+=6){Qt(u,t,d,h);for(var f=c.searchClosestObjects(u.position,u.radius,u.boundingBox,l),m=0,g=f.length;m<g;m++){var v=f[m],y=v.object.index;if(!(v.userData.distanceSq>=l)){var b=Wt(h,t,d,d+3,r,i,y);if(b.distanceSquared<l&&(s=b,l=b.distanceSquared),0===l)break}}if(0===l)break}return s.distance=0===s.distanceSquared?0:Math.sqrt(s.distanceSquared),s}(e,t,n,r,i,a,o):function(e,t,n,r,i,a,o){var s=null,l=1/0,c=qt();Kt(c,t);for(var u={position:new _.Vector3,radius:0},h=Jt(n,e),d=a;d<o;d+=3)if(Bt(r,3*i[d],3*i[d+1],3*i[d+2])){Yt(u,r,i,d,h);for(var p=c.searchClosestObjects(u.position,u.radius,u.boundingBox,l),f=0,m=p.length;f<m;f++){var g=p[f],v=g.object.index;if(!(g.userData.distanceSq>=l)){var y=Wt(h,t,v,v+3,r,i,d);if(y.distanceSquared<l&&(s=y,l=y.distanceSquared),0===l)break}}if(0===l)break}return s.distance=0===s.distanceSquared?0:Math.sqrt(s.distanceSquared),s}(e,t,n,r,i,a,o);return s},tn=function(e,t){return t!==kt&&e.transformDirection(t),e},nn=function(e,t,n){var r=e[t+0],i=e[t+1],a=e[t+2],o=e[t+3],s=e[t+4],l=e[t+5],c=new _.Vector3(o-r,s-i,l-a);return tn(c,n)},rn=function(e,t,n,r,i){var a=n[r+0],o=n[r+1],s=n[r+2],l=n[r+3],c=n[r+4],u=n[r+5];e.x=a,e.y=o,e.z=s,t.x=l,t.y=c,t.z=u,i&&(e.applyMatrix4(i),t.applyMatrix4(i))},an=function(e,t,n){var r=e.vertices[t].position;if(e===n||e.matrixWorld===n.matrixWorld)return r;r=r.clone();var i=new _.Matrix4;return i.multiplyMatrices(i.getInverse(n.matrixWorld),e.matrixWorld),r.applyMatrix4(i),r},on=function(e,t,n,r){var i=null,a=an(e,t,n);if(r.length/6<=32){for(var o=0,s=r.length;o<s;o+=6){var l=r[o],c=r[o+1],u=r[o+2],h=r[o+3],d=r[o+4],p=r[o+5],f=Nt(a.x,a.y,a.z,l,c,u,h,d,p);if((null===i||f.distanceSquared<i.distanceSquared)&&(i=f),0===i.distanceSquared)break}i.distance=0===i.distanceSquared?0:Math.sqrt(i.distanceSquared)}else i=function(e,t){var n=null,r=1/0,i=qt();Kt(i,t);var a=new _.Box3;a.min.copy(e),a.max.copy(e);for(var o=i.searchClosestObjects(e,0,a,r),s=0,l=o.length;s<l;s++){var c=o[s],u=c.object.index;if(!(c.userData.distanceSq>=r)){var h=t[u],d=t[u+1],p=t[u+2],f=t[u+3],m=t[u+4],g=t[u+5],v=Nt(e.x,e.y,e.z,h,d,p,f,m,g);if(v.distanceSquared<r&&(n=v,r=v.distanceSquared),0===r)break}}return n.distance=0===n.distanceSquared?0:Math.sqrt(n.distanceSquared),n}(a,r);return i},sn=function(e,t,n,r,i,a,o){var s=null,l=an(e,t,n);if((o-a)/3<=128){for(var c=a;c<o;c+=3){var u=3*i[c],h=3*i[c+1],d=3*i[c+2],p=r[u],f=r[u+1],m=r[u+2],g=r[h],v=r[h+1],y=r[h+2],b=r[d],x=r[d+1],w=r[d+2],M=Ft(l.x,l.y,l.z,p,f,m,g,v,y,b,x,w);if((null===s||M.distanceSquared<s.distanceSquared)&&(s=M),0===s.distanceSquared)break}s.distance=0===s.distanceSquared?0:Math.sqrt(s.distanceSquared)}else s=function(e,t,n,r,i){var a=null,o=1/0,s=qt();Zt(s,t,n,r,i);var l=new _.Box3;l.min.copy(e),l.max.copy(e);for(var c=s.searchClosestObjects(e,0,l,o),u=0,h=c.length;u<h;u++){var d=c[u],p=d.object.index;if(!(d.userData.distanceSq>=o)){var f=3*n[p],m=3*n[p+1],g=3*n[p+2],v=t[f],y=t[f+1],b=t[f+2],x=t[m],w=t[m+1],M=t[m+2],E=t[g],S=t[g+1],L=t[g+2],T=Ft(e.x,e.y,e.z,v,y,b,x,w,M,E,S,L);if(T.distanceSquared<o&&(a=T,o=T.distanceSquared),0===o)break}}return a.distance=0===a.distanceSquared?0:Math.sqrt(a.distanceSquared),a}(l,r,i,a,o);return s},ln=function(e,t,n,r,i,a,o,s,l,c){var u=null,h=(i-r)/3,d=(c-l)/3;if(h*d<=128){for(var p=1/0,f=Jt(e,a),m=r;m<i;m+=3)if(Bt(t,3*n[m],3*n[m+1],3*n[m+2])){for(var g=l;g<c;g+=3)if(Bt(o,3*s[g],3*s[g+1],3*s[g+2])){var v=Ht(f,t,n,m,o,s,g);if(v.distanceSquared<p&&(u=v,p=v.distanceSquared),0===p)break}if(0===p)break}u.distance=0===u.distanceSquared?0:Math.sqrt(u.distanceSquared)}else{var y=e,b=a,x=t,w=o,M=n,E=s,S=r,L=l,T=i,A=c;h>d&&(y=a,b=e,x=o,w=t,M=s,E=n,S=l,L=r,T=c,A=i),u=function(e,t,n,r,i,a,o,s,l,c){var u=null,h=1/0,d=qt();Zt(d,o,s,l,c);for(var p={position:new _.Vector3,radius:0},f=Jt(e,a),m=r;m<i;m+=3)if(Bt(t,3*n[m],3*n[m+1],3*n[m+2])){Yt(p,t,n,m,f);for(var g=d.searchClosestObjects(p.position,p.radius,p.boundingBox,h),v=0,y=g.length;v<y;v++){var b=g[v],x=b.object.index;if(!(b.userData.distanceSq>=h)){var w=Ht(f,t,n,m,o,s,x);if(w.distanceSquared<h&&(u=w,h=w.distanceSquared),0===h)break}}if(0===h)break}return u.distance=0===u.distanceSquared?0:Math.sqrt(u.distanceSquared),u}(y,x,M,S,T,b,w,E,L,A)}return u},cn=function(e,t,n,r){var i=e[t],a=e[t+1],o=e[t+2],s=e[n],l=e[n+1],c=e[n+2],u=e[r],h=e[r+1],d=e[r+2],p=new _.Vector3(s-i,l-a,c-o),f=new _.Vector3(u-i,h-a,d-o);return p.cross(f)},un=function(e){var t=e.getDescription();return t&&1===t.entityType},hn=function(e){var t=e.getDescription();return t&&15===t.entityType},dn=180/Math.PI,pn=.5*Math.PI,fn=function(e,t,n,r){var i=t.clone().sub(e),a=r.clone().sub(n);return i.angleTo(a)},mn=function(e,t){return e.distance<t.distance},gn=function(){var e=[];return function(t,n,r,i){return e[0]={distance:t.distanceToSquared(r),pair:[1,3],angle:function(){return fn(t,n,r,i)}},e[1]={distance:t.distanceToSquared(i),pair:[1,4],angle:function(){return fn(t,n,i,r)}},e[2]={distance:n.distanceToSquared(r),pair:[2,3],angle:function(){return fn(n,t,r,i)}},e[3]={distance:n.distanceToSquared(i),pair:[2,4],angle:function(){return fn(n,t,i,r)}},e.sort(mn),{angle:e[0].angle(),pair:e[0].pair}}}(),vn=function(e,t,n){var r=[];return t.forEach(t=>{for(var i=0;i<n;i++)r.push(e[t+i])}),r},yn=function(e,t,n,r,i,a,o,s,l){var c=cn(e,n,r,i);tn(c,l);var u=cn(t,a,o,s),h=c.clone().cross(u);if(function(e){return 0===e.x&&0===e.y&&0===e.z}(h))return 0;var d=c.cross(h),p=h.cross(u);return d.angleTo(p)},bn=function(e,t){return Math.abs(pn-e.angleTo(t))},xn=function(e,t){for(var n=Jt(e,t),r=e.position,i=t.geometry.attributes.position.array,a=t.geometry.index.array,o=hn(e)?6:r.length,s=un(t)?t.start+3:t.start+t.count,l=hn(e)&&un(t)?m.s.Precise:m.s.Imprecise,c=null,u={},h=0;h<o;h+=6)for(var d=nn(r,h,n),p=t.start;p<s;p+=3){var f=3*a[p],g=3*a[p+1],v=3*a[p+2];if(Bt(i,f,g,v)){var y=cn(i,f,g,v),b=bn(d,y);(null==c||b>c)&&(c=b,u.positions1=vn(r,[h],6),u.positions2=vn(i,[f,g,v],3))}}return{angle:c,type:l,info:u}},_n=function(e,t,n,r){var i=e[t],a=e[t+1],o=e[t+2],s=e[n],l=e[n+1],c=e[n+2],u=e[r],h=e[r+1],d=e[r+2];return 1/6*(-(u*l*o)+s*h*o+u*a*c-i*h*c-s*a*d+i*l*d)},wn=function(e,t,n,r,i,a){var o=e-r,s=t-i,l=n-a;return Math.sqrt(o*o+s*s+l*l)},Mn=function(e,t,n,r){var i=e[t],a=e[t+1],o=e[t+2],s=e[n],l=e[n+1],c=e[n+2],u=e[r],h=e[r+1],d=e[r+2],p=wn(i,a,o,s,l,c),f=wn(s,l,c,u,h,d),m=wn(u,h,d,i,a,o),g=.5*(p+f+m);return Math.sqrt(g*(g-p)*(g-f)*(g-m))},En=function(e){var t=e.position,n=t[0],r=t[1],i=t[2],a=t[t.length-3],o=t[t.length-2],s=t[t.length-1];return wn(n,r,i,a,o,s)},Sn=function(e,t){for(var n=e.radius,r=e.location,i=t.position,a=0,o=0,s=i.length;o<s;o+=6){var l=i[o+0],c=i[o+1],u=i[o+2],h=i[o+3],d=i[o+4],p=i[o+5],f=new _.Vector3(l-r.x,c-r.y,u-r.z),m=new _.Vector3(h-r.x,d-r.y,p-r.z);a+=f.angleTo(m)}return n*a},Ln=function(e){for(var t=0,n=e.position,r=0,i=n.length;r<i;r+=6){var a=n[r+0],o=n[r+1],s=n[r+2],l=n[r+3],c=n[r+4],u=n[r+5];t+=wn(a,o,s,l,c,u)}return t},Tn=function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i instanceof ze.Assembly)Tn(i.children,t);else if(!t.parts[i.id]){t.parts[i.id]=i;var a=i.getUnit();null===t.unit?t.unit=a:t.unit!==a&&(t.sameUnit=!1)}}},An=function(e){var t={unit:null,sameUnit:!0,parts:{}};return Tn(e,t),t.sameUnit||(t.unit=m.E.MILLIMETER),t},Cn=function(e,t){if(e.shapes)for(var n=0,r=e.shapes.length;n<r;n++){var i=e.shapes[n];if(i instanceof ze.PartShape)for(var a=i.geometry.attributes.position.array,o=i.geometry.index.array,s=i.faces,l=0,c=s.length;l<c;l++)for(var u=s[l],h=u.start,d=u.start+u.count;h<d;h+=3){var p=3*o[h],f=3*o[h+1],m=3*o[h+2];t+=_n(a,p,f,m)}}if(e.children&&e.children.length>0)for(var g=0,v=e.children.length;g<v;g++)t+=Cn(e.children[g],0);return t},Pn=new _.Box3,In=function(e,t){for(var n,r,i=e.position,a=i.length,o=1/0,s=0;s<a;s+=6){var l=i[s],c=i[s+1],u=i[s+2],h=i[s+3],d=i[s+4],p=i[s+5];if((r=Nt(t.x,t.y,t.z,l,c,u,h,d,p)).distanceSquared<o&&((n=r).v1=[l,c,u],n.v2=[h,d,p],o=r.distanceSquared),0===o)break}return n},On=function(e){var t=An(e),n=t.unit,r={type:m.s.Imprecise,content:{}},i=0;for(var a in t.parts)if(t.parts[a]){var o=t.parts[a];i+=Cn(o,0)}return r.content[m.q.Volume]=At(i,n),r.unit=It(n)+"^3",r},Bn=function(e){var t={type:m.s.Imprecise,content:{}};un(e)&&(t.type=m.s.Precise);for(var n=0,r=e.geometry.attributes.position.array,i=e.geometry.index.array,a=e.start,o=e.start+e.count;a<o;a+=3){var s=3*i[a],l=3*i[a+1],c=3*i[a+2];n+=Mn(r,s,l,c)}return t.content[m.q.Area]=At(n,e.getUnit()),t.unit=It(e.getUnit())+"^2",t},Rn=function(e){var t=e.getDescription(),n={content:{}},r=0;if(t)switch(t.entityType){case 11:n.type=m.s.Precise,r=Sn(t,e);break;case 13:n.type=m.s.Imprecise,r=Ln(e);break;case 15:n.type=m.s.Precise,n.content={},r=En(e)}else n.type=m.s.Imprecise,r=Ln(e);return n.content[m.q.Length]=At(r,e.getUnit()),n.unit=It(e.getUnit()),n},Gn=function(){return null},Dn=function(e,t,n,r){var i=null,a=m.s.Imprecise;if(e instanceof ze.VertexShape||t instanceof ze.VertexShape)if(e instanceof ze.VertexShape)if(t instanceof ze.VertexShape)i=function(e,t,n,r){var i=an(e,t,n),a=n.vertices[r].position;return{distance:i.distanceTo(a),p:i,q:a}}(e,n,t,r),a=m.s.Precise;else if(t instanceof ze.EdgeShapeBase||t instanceof ze.Edge){var o=t.position;i=on(e,n,t,o),a=hn(t)?m.s.Precise:m.s.Imprecise}else{o=t.geometry.attributes.position.array;var s=t.geometry.index.array,l=t.start,c=t.count+l;i=sn(e,n,t,o,s,l,c),a=un(t)?m.s.Precise:m.s.Imprecise}else e instanceof ze.EdgeShapeBase||e instanceof ze.Edge?(o=e.position,i=on(t,r,e,o),a=hn(e)?m.s.Precise:m.s.Imprecise):(o=e.geometry.attributes.position.array,s=e.geometry.index.array,l=e.start,c=e.count+l,i=sn(t,r,e,o,s,l,c),a=un(e)?m.s.Precise:m.s.Imprecise);else if(e instanceof ze.EdgeShapeBase||e instanceof ze.Edge)if(t instanceof ze.EdgeShapeBase||t instanceof ze.Edge){var u=e.position;o=t.position,i=$t(e,u,t,o),a=hn(e)&&hn(t)?m.s.Precise:m.s.Imprecise}else u=e.position,o=t.geometry.attributes.position.array,s=t.geometry.index.array,l=t.start,c=t.count+l,i=en(e,u,t,o,s,l,c),a=hn(e)&&un(t)?m.s.Precise:m.s.Imprecise;else if(t instanceof ze.EdgeShapeBase||t instanceof ze.Edge)u=t.position,o=e.geometry.attributes.position.array,s=e.geometry.index.array,l=e.start,c=e.count+l,i=en(t,u,e,o,s,l,c),a=hn(t)&&un(e)?m.s.Precise:m.s.Imprecise;else{u=e.geometry.attributes.position.array;var h=e.geometry.index.array,d=e.start,p=e.count+d;o=t.geometry.attributes.position.array,s=t.geometry.index.array,l=t.start,c=t.count+l,i=ln(e,u,h,d,p,t,o,s,l,c),a=un(e)&&un(t)?m.s.Precise:m.s.Imprecise}if(i){var f={};return f[m.q.MinimumDistance]=At(i.distance,t.getUnit()),{type:a,unit:It(t.getUnit()),content:f,points:[i.p,i.q]}}return Xt&&Xt.reset(),null},Vn=function(e,t){var n={content:{}},r=null;if(e instanceof ze.FaceShape)if(t instanceof ze.FaceShape)r=function(e,t){var n=Jt(e,t),r=e.geometry.attributes.position.array,i=e.geometry.index.array,a=e.geometry.attributes.position.array,o=e.geometry.index.array,s={};if(un(e)&&un(t)){var l=3*i[e.start],c=3*i[e.start+1],u=3*i[e.start+2],h=3*o[t.start],d=3*o[t.start+1],p=3*o[t.start+2];return s.positions1=vn(r,[l,c,u],3),s.positions2=vn(a,[h,d,p],3),{angle:yn(r,a,l,c,u,h,d,p,n),type:m.s.Precise,info:s}}for(var f=null,g=e.start,v=e.start+e.count;g<v;g+=3)if(l=3*i[g],c=3*i[g+1],u=3*i[g+2],Bt(r,l,c,u))for(var y=t.start,b=t.start+t.count;y<b;y+=3)if(h=3*o[y],d=3*o[y+1],p=3*o[y+2],Bt(a,h,d,p)){var x=yn(r,a,l,c,u,h,d,p,n);(null==f||x>f)&&(f=x,s.positions1=vn(r,[l,c,u],3),s.positions2=vn(a,[h,d,p],3))}return{angle:f,type:m.s.Imprecise,info:s}}(e,t);else{var i=(r=xn(t,e)).info.positions1;r.info.positions1=r.info.positions2.splice(0),r.info.positions2=i}else r=t instanceof ze.FaceShape?xn(e,t):function(e,t){for(var n=Jt(e,t),r=e.position,i=t.position,a=hn(e)?6:r.length,o=hn(t)?6:i.length,s=hn(e)&&hn(t)?m.s.Precise:m.s.Imprecise,l=null,c={},u=new _.Vector3,h=new _.Vector3,d=new _.Vector3,p=new _.Vector3,f=0;f<a;f+=6){rn(u,h,r,f,n);for(var g=0;g<o;g+=6){rn(d,p,i,g);var v=gn(u,h,d,p);if(null==l||v.angle>l){if(l=v.angle,-1!==v.pair.indexOf(2)){var y=u.clone();u.copy(h),h.copy(y)}-1!==v.pair.indexOf(4)&&(y=d.clone(),d.copy(p),p.copy(y)),c.positions1=u.toArray().concat(h.toArray()),c.positions2=d.toArray().concat(p.toArray())}}}return{angle:l,type:s,info:c}}(e,t);r.info&&(n.cacheData=r.info);var a=function(e){return e*dn}(r.angle);return n.content[m.q.Angle]=At(a),n.type=r.type,n},Nn=function(e){var t=e.getDescription(),n={},r=e.getUnit();if(t){n.type=m.s.Precise;var i={},a=!1;Ct(t.radius)&&(i[m.q.Radius]=At(t.radius,r),a=!0),Ct(t.majorRadius)&&(i[m.q.MajorRadius]=At(t.majorRadius,r),a=!0),Ct(t.minorRadius)&&(i[m.q.MinorRadius]=At(t.minorRadius,r),a=!0),a||((un(e)||hn(e))&&(i[m.q.MinimumRadius]="â"),a=!0),a&&(n.content=i,n.unit=It(e.getUnit()))}return n},Un=function(e){var t=An(e);Pn.min.set(1/0,1/0,1/0),Pn.max.set(-1/0,-1/0,-1/0);var n={type:m.s.Imprecise},r={};for(var i in n.content=r,t.parts)if(t.parts[i]){var a=t.parts[i],o=a.boundingBox.clone();o.applyMatrix4(a.matrixWorld),Pn.union(o)}var s=Pn.min,l=Pn.max,c=new _.Vector3;Pn.getCenter(c);var u=t.unit;return r[m.q.BBoxMinimum]=Pt(s,u),r[m.q.BBoxMaximum]=Pt(l,u),r[m.q.BBoxCenter]=Pt(c,u),n.unit=It(u),n},Fn=function(e,t){var n=function(e,t){var n=e.point;if(e===t||e.object.matrixWorld===t.object.matrixWorld)return n;n=n.clone();var r=new _.Matrix4;return r.multiplyMatrices(r.getInverse(t.object.matrixWorld),e.object.matrixWorld),n.applyMatrix4(r),n}(e,t).distanceTo(t.point),r={};return r[m.q.PointDistance]=At(n,e.object.parent.shapes[0].getUnit()),{type:m.s.Imprecise,unit:It(e.object.parent.shapes[0].getUnit()),content:r,points:[e.point,t.point]}},zn=function(e,t,n,r){var i,a=new _.Vector3(t,n,r);if(e instanceof ze.Edge)i=e.parent.parent.localToWorld(function(e,t){for(var n,r,i=e.position,a=i.length,o=1/0,s=0;s<a;s+=6){var l=i[s],c=i[s+1],u=i[s+2],h=i[s+3],d=i[s+4],p=i[s+5];if((r=Nt(t.x,t.y,t.z,l,c,u,h,d,p)).distanceSquared<o&&(n=r,o=r.distanceSquared),0===o)break}return new _.Vector3(n.q.x,n.q.y,n.q.z)}(e,e.parent.parent.worldToLocal(a)));else{if(!(e instanceof ze.FaceShape))return null;i=e.parent.parent.localToWorld(function(e,t){for(var n,r,i=e.geometry.attributes.position.array,a=e.count,o=e.start,s=e.geometry.index.array,l=1/0,c=o;c<o+a;c+=3){var u=3*s[c],h=3*s[c+1],d=3*s[c+2],p=i[u],f=i[u+1],m=i[u+2],g=i[h],v=i[h+1],y=i[h+2],b=i[d],x=i[d+1],w=i[d+2];if((r=Ft(t.x,t.y,t.z,p,f,m,g,v,y,b,x,w)).distanceSquared<l&&(n=r,l=r.distanceSquared),0===l)break}return new _.Vector3(n.q.x,n.q.y,n.q.z)}(e,e.parent.parent.worldToLocal(a)))}return[i.x,i.y,i.z]},kn=function(e,t){var n=e.position;if(0===t)return[n[0],n[1],n[2]];if(1===t){var r=n.length;return[n[r-3],n[r-2],n[r-1]]}var i=e.getDescription(),a=0,o=0,s=0;if(i&&13!==i.entityType)switch(i.entityType){case 11:o=(a=Sn(i,e))*t;for(var l=i.radius,c=i.location,u=0,h=0;s<o;){var d=n[h+0],p=n[h+1],f=n[h+2],m=n[h+3],g=n[h+4],v=n[h+5],y=new _.Vector3(d-c.x,p-c.y,f-c.z),b=new _.Vector3(m-c.x,g-c.y,v-c.z),x=s;s=l*(u+=y.angleTo(b)),h+=6}break;case 15:o=(a=En(e))*t,d=n[0],p=n[1],f=n[2],m=n[n.length-3],g=n[n.length-2],v=n[n.length-1],x=0,s=a}else for(o=(a=Ln(e))*t,h=0;s<o;)d=n[h+0],p=n[h+1],f=n[h+2],m=n[h+3],g=n[h+4],v=n[h+5],x=s,s+=wn(d,p,f,m,g,v),h+=6;if(length===o)return[m,g,v];var w=(o-x)/(s-x),M=new _.Vector3(d,p,f),E=new _.Vector3(m,g,v),S=(new _.Vector3).subVectors(E,M),L=S.length(),T=(new _.Vector3).addVectors(M,S.normalize().multiplyScalar(L*w));return[T.x,T.y,T.z]},jn=function(e,t,n){var i=(t=e.parent.worldToLocal(t)).x,a=t.y,o=t.z,s=e.position,l=s.length;if(s[0]===i&&s[1]===a&&s[2]===o)return 0;if(s[l-3]===i&&s[l-2]===a&&s[l-1]===o)return 1;var c=e.getDescription(),u=0,h=0;if(c&&13!==c.entityType)switch(c.entityType){case 11:u=Sn(c,e);var d=c.radius,p=c.location,f=0,m=0,g=!1;for(L=void 0===n?In(e,new _.Vector3(i,a,o)).v1:[s[3*n],s[3*n+1],s[3*n+2]],m=0;m<l&&!g;m+=6){var v=s[m+0],y=s[m+1],b=s[m+2],x=s[m+3],w=s[m+4],M=s[m+5];if(r.b._vertexEqual(v,y,b,L[0],L[1],L[2]))E=new _.Vector3(v-p.x,y-p.y,b-p.z),S=new _.Vector3(i-p.x,a-p.y,o-p.z),h=d*(f+=E.angleTo(S)),g=!0;else{var E=new _.Vector3(v-p.x,y-p.y,b-p.z),S=new _.Vector3(x-p.x,w-p.y,M-p.z);h=d*(f+=E.angleTo(S))}}break;case 15:u=En(e),v=s[0],y=s[1],b=s[2],h=wn(v,y,b,i,a,o)}else{var L;for(u=Ln(e),m=0,g=!1,L=void 0===n?In(e,new _.Vector3(i,a,o)).v1:[s[3*n],s[3*n+1],s[3*n+2]],m=0;m<l&&!g;m+=6)v=s[m+0],y=s[m+1],b=s[m+2],x=s[m+3],w=s[m+4],M=s[m+5],r.b._vertexEqual(v,y,b,L[0],L[1],L[2])?(h+=wn(v,y,b,i,a,o),g=!0):h+=wn(v,y,b,x,w,M)}return u===h?1:u<h?null:h/u},Hn=function(e){var t=null,n=null,a=null,o={},s=null,l=[],c={viewer:null,selectedObjects:[]},u=m.p.None,h=!1,d=function(){c.selectedObjects.length=0},p=function(e){if(h&&n&&e===m.p.Distance){var t=o[e];return n.innerHandler=t,n}return o[e]},f=function(e){for(var t=!1,n=0,r=c.selectedObjects.length;n<r;n++){var i=c.selectedObjects[n];if(e.object===i.object){if(e.object instanceof ze.VertexShape&&e.pointIndex!==i.pointIndex)continue;t=!0;break}}t||c.selectedObjects.push(e)};var g=function(e,t,n){for(var r=[],i={},o=0,s=0,u=c.selectedObjects.length;s<u;s++){var h=c.selectedObjects[s].object;h instanceof ze.VertexShape?(i[h.id]||(i[h.id]={object:h,indices:[]}),i[h.id].indices.push(c.selectedObjects[s].pointIndex),o++):r.push(h)}if(r.length>0&&a[Di._setObjectsSelection](r,!0,!1),o>0)for(var p in i)i.hasOwnProperty(p)&&(i[p].object.userData.pickedIndices=i[p].indices,a[Di._setObjectSelection](i[p].object,!0));!function _fireMeasurementEvents(e,t,n){var r,i=l.length,a=[],o=[];for(var s in e)if(e.hasOwnProperty(s)){r=e[s];for(var c=0;c<r.length;c++)a.push(r[c].object.userData.psId),r[c].object instanceof ze.Vertex||r[c].object instanceof ze.VertexShape?o.push(r[c].pointIndex):o.push(-1)}if(n)n(a,o,t);else for(var u=0;u<i;++u)l[u](a,o,t)}(c,t,n),e.supportCumulativeMeasurement(c)||d()},v=function(e){for(var t=e.parent;null!=t;){if(t instanceof ce)return t;t=t.parent}return null},y=function(e,n){for(var r={},i=0,a=0,o=e.length;a<o;a++){var s=e[a],l={part:s,shapes:{}};r[s.userData.psId]=l;var c=[];for(var u in s.faces)if(s.faces[u]){var h=s.faces[u];h.descriptionLoaded||(c.push(u),l.shapes[u]=h)}for(var d in s.edges)if(s.edges.hasOwnProperty(d)){var p=s.edges[d];p.descriptionLoaded||(c.push(d),l.shapes[d]=p)}if(c.length>0){i++;t._loader.loadXTShapes({part:s,xtIds:new Float32Array(c),parseFacetData:!1,doneCallback:function(e){var t=r[e.callbackId],a=e.xtDescriptions[t.part.psId];if(a)for(var o in t.shapes)if(t.shapes[o]){var s=t.shapes[o],l=a[o];null!==l&&void 0!==l&&s.setDescription(l),s.descriptionLoaded=!0}0==--i&&n()}})}}0===i&&n()},b=function(e,n,i){if((a=n.length)>0){for(var a,o=0;o<a;o++){var l=n[o];e.validateSelectedObject(l.object)&&f(l)}e.validateContext(c)&&(c.mode=u,function(e,n){if(r.b._isNullOrUndefined(s)&&t&&(s=t.getLoader()),s){for(var i=[],a=0,o=e.selectedObjects.length;a<o;a++){var l=e.selectedObjects[a].object;if(l instanceof ze.EdgeShapeBase||l instanceof ze.Edge||l instanceof ze.FaceShape){var c=v(l);c&&i.indexOf(c)<0&&i.push(c)}}i.length>0?r.b._isFunction(s.loadDescriptions)?s.loadDescriptions({parts:i,doneCallback:n}):y.call(this,i,n):n()}}(c,function(){e.measure(c,function(t){g(e,t,i)})}))}else d()},x=function(e){if(u!==m.p.None){var t=p(u);t&&b(t,e.selectedObjects)}},w=function(e){for(var t=[],n=0,r=e.selectedObjects.length;n<r;n++)t.push(e.selectedObjects[n].object);return t},M=function(e){this.manager=e};M.prototype.getPickingMode=function(){return m.x.FREE},M.prototype.validateSelectedObject=function(){return!1},M.prototype.validateContext=function(){return!1},M.prototype.supportCumulativeMeasurement=function(){return!1},M.prototype.measure=function(){};var E=function(e){this.customHandler=e,this.innerHandler=null};E.prototype.getPickingMode=function(){return this.innerHandler?this.innerHandler.getPickingMode():m.x.FREE},E.prototype.validateSelectedObject=function(e){return!!this.innerHandler&&this.innerHandler.validateSelectedObject(e)},E.prototype.validateContext=function(e){return!!this.innerHandler&&this.innerHandler.validateContext(e)},E.prototype.supportCumulativeMeasurement=function(e){return!!this.innerHandler&&this.innerHandler.supportCumulativeMeasurement(e)},E.prototype.measure=function(e,t){return this.customHandler.measure(e,t)};var S=function(e){M.call(this,e)};(S.prototype=Object.create(M.prototype)).constructor=S,S.prototype.getPickingMode=function(){return m.x.FACE|m.x.EDGE},S.prototype.validateSelectedObject=function(e){return e instanceof ze.FaceShape||e instanceof ze.EdgeShapeBase||e instanceof ze.Edge},S.prototype.validateContext=function(e){return 1===e.selectedObjects.length},S.prototype.measure=function(e,t){var n=e.selectedObjects[0].object,r=Nn(n);r&&t(r)};var L=function(e){M.call(this,e)};(L.prototype=Object.create(M.prototype)).constructor=L,L.prototype.getPickingMode=function(){return m.x.FACE|m.x.EDGE|m.x.VERTEX},L.prototype.validateSelectedObject=function(e){return e instanceof ze.EdgeShapeBase||e instanceof ze.Edge||e instanceof ze.FaceShape||e instanceof ze.Vertex},L.prototype.validateContext=function(e){return 2===e.selectedObjects.length},L.prototype.measure=function(e,t){var n=e.selectedObjects[0].object,r=e.selectedObjects[1].object,i=null,a=null;n instanceof ze.Vertex&&(i=e.selectedObjects[0].pointIndex,n=n.parent),r instanceof ze.Vertex&&(a=e.selectedObjects[1].pointIndex,r=r.parent);var o=Dn(n,r,i,a);o&&o.content&&t(o)};var T=function(e){M.call(this,e)};(T.prototype=Object.create(M.prototype)).constructor=T,T.prototype.getPickingMode=function(){return m.x.EDGE},T.prototype.validateSelectedObject=function(e){return e instanceof ze.EdgeShapeBase||e instanceof ze.Edge},T.prototype.validateContext=function(e){return 1===e.selectedObjects.length},T.prototype.measure=function(e,t){var n=e.selectedObjects[0].object,r=Rn(n);r&&r.content&&t(r)};var A=function(e){M.call(this,e)};(A.prototype=Object.create(M.prototype)).constructor=A,A.prototype.getPickingMode=function(){return m.x.POINT},A.prototype.validateSelectedObject=function(e){return"PointShape"===e.type},A.prototype.validateContext=function(e){return 2===e.selectedObjects.length},A.prototype.measure=function(e,t){var n=e.selectedObjects[0],r=e.selectedObjects[1];if(void 0!==n.parent&&void 0!==r.parent){var i=Fn(n,r);i&&i.content&&t(i)}n.object.dirty=!0,r.object.dirty=!0};var C=function(e){M.call(this,e)};(C.prototype=Object.create(M.prototype)).constructor=C,C.prototype.getPickingMode=function(){return m.x.FACE|m.x.EDGE},C.prototype.validateSelectedObject=function(e){return e instanceof ze.EdgeShapeBase||e instanceof ze.Edge||e instanceof ze.FaceShape},C.prototype.validateContext=function(e){return 2===e.selectedObjects.length},C.prototype.measure=function(e,t){var n=e.selectedObjects[0].object,r=e.selectedObjects[1].object,i=Vn(n,r);i&&i.content&&(i.unit="Degrees",t(i))};var P=function(e){M.call(this,e)};(P.prototype=Object.create(M.prototype)).constructor=P,P.prototype.getPickingMode=function(){return m.x.PART|m.x.BODY},P.prototype.validateSelectedObject=function(e){return e instanceof ce},P.prototype.validateContext=function(e){return e.selectedObjects.length>0},P.prototype.supportCumulativeMeasurement=function(){return!0},P.prototype.measure=function(e,t){var n=w(e),r=On(n);r&&r.content&&t(r)};var I=function(e){M.call(this,e)};(I.prototype=Object.create(M.prototype)).constructor=I,I.prototype.getPickingMode=function(){return m.x.FACE},I.prototype.validateSelectedObject=function(e){return e instanceof ze.FaceShape},I.prototype.validateContext=function(e){return 1===e.selectedObjects.length},I.prototype.measure=function(e,t){var n=e.selectedObjects[0].object,r=Bn(n);r&&r.content&&t(r)};var O=function(e){M.call(this,e)};(O.prototype=Object.create(M.prototype)).constructor=O,O.prototype.getPickingMode=function(){return m.x.FACE|m.x.EDGE},O.prototype.validateSelectedObject=function(e){return e instanceof ze.FaceShape||e instanceof ze.EdgeShapeBase||e instanceof ze.Edge},O.prototype.validateContext=function(e){return 1===e.selectedObjects.length},O.prototype.measure=function(e,t){var n=e.selectedObjects[0].object,r=Gn(n);r&&r.content&&t(r)};var B=function(e){M.call(this,e)};(B.prototype=Object.create(M.prototype)).constructor=B,B.prototype.getPickingMode=function(){return m.x.PART|m.x.BODY},B.prototype.validateSelectedObject=function(e){return e instanceof ce},B.prototype.validateContext=function(e){return e.selectedObjects.length>0},B.prototype.supportCumulativeMeasurement=function(){return!0},B.prototype.measure=function(e,t){var n=w(e),r=Un(n);r&&r.content&&t(r)},o[m.p.Radius]=new S(this),o[m.p.Distance]=new L(this),o[m.p.Length]=new T(this),o[m.p.Angle]=new C(this),o[m.p.Volume]=new P(this),o[m.p.Area]=new I(this),o[m.p.Curvature]=new O(this),o[m.p.BoundingBox]=new B(this),o[m.p.PointDistance]=new A(this);var R=function(e){t=e._parent,a=t._selectionMngr,c.viewer=t,e.measurementHandler&&(n=new E(e.measurementHandler)),t[Vp._addEventListener](m.i.Selection,x)};return(R.prototype={constructor:R}).registerMeasurementEvent=function(e){r.b._isFunction(e,!0),Tt(i.b.stringsByLabel.MEASUREMENT_LOGGER_registerMeasurementEvent),-1===r.b._eventMapIndex(l,e)&&l.push(e)},R.prototype.unregisterMeasurementEvent=function(e){r.b._isFunction(e,!0),Tt(i.b.stringsByLabel.MEASUREMENT_LOGGER_unregisterMeasurementEvent);var t=r.b._eventMapIndex(l,e);-1!==t&&l.splice(t,1)},R.prototype.measure=function(e){r.b._isObject(e,!0),Tt(i.b.stringsByLabel.MEASUREMENT_LOGGER_measure);var n=e.psIds;if(!(n instanceof Array)&&0===n.length)throw new Error("Invalid psIds");var a=e.measurementEvent,o=e.mode||this.mode,s=p(o);if(null==s||void 0===s)throw new Error("Invalid mode");for(var l=[],c=0,u=n.length;c<u;c++){var h=t._modelObject.getObjectByPsId(n[c]);h&&l.push({object:h})}if(0==l.length)throw new Error("No objects found for psIds");b(s,l,a)},R.prototype.findClosestVertex=function(e,n,i,a){r.b._isString(e,!0),r.b._isNumber(n,!0),r.b._isNumber(i,!0),r.b._isNumber(a,!0);var o=t._modelObject.getObjectByPsId(e);return o&&(o instanceof ze.EdgeShapeBase||o instanceof ze.Edge||o instanceof ze.FaceShape)?zn(o,n,i,a):null},R.prototype.convertUtoModelSpace=function(e,n){if(r.b._isString(e,!0),r.b._isNumber(n,!0),n<0||n>1)return null;var i=t._modelObject.getObjectByPsId(e);return i&&(i instanceof ze.EdgeShapeBase||i instanceof ze.Edge)?kn(i,n):null},R.prototype.convertModelSpaceToU=function(e,n,i){r.b._isString(e,!0),r.b._isArray(n,!0,r.b._isNumber),r.b._optionalArgCheck(i,r.b._isNumber);var a=t._modelObject.getObjectByPsId(e);return a&&(a instanceof ze.EdgeShapeBase||a instanceof ze.Edge)?jn(a,new _.Vector3(n[0],n[1],n[2]),i):-1},Object.defineProperties(R.prototype,{mode:{get:function(){return u},set:function(e){if(u!==e)if((u=e)===m.p.None)t.setPickingMode(0),t.setMouseHighlightEnabled(!1);else{var n=p(e);n?(t.setPickingMode(n.getPickingMode()),t.setMouseHighlightEnabled(!0),d()):(t.setPickingMode(0),t.setMouseHighlightEnabled(!1))}}},useServer:{get:function(){return h},set:function(e){h=!0===e||e}}}),new R(e)};Hn.prototype={constructor:Hn,_name:"Measurement"};
// CONCATENATED MODULE: ./staging/Body.js
var Wn=function(e){_e.call(this,e),this.type="Body",this.updateMatrixWorld(!0)};(Wn.prototype=Object.create(_e.prototype)).constructor=Wn,Wn.prototype.invalidateRaycast=function(e,t){var n=t.pickingMode;return n===m.x.BODY||(n&m.x.FACE)===m.x.FACE||(n&m.x.EDGE)===m.x.EDGE},Wn.prototype.clone=function(e,t){return e=e?new Wn(e.original).copy(e,t):new Wn(this.original).copy(this,t)},Object.defineProperties(Wn.prototype,{cullingLayer:{get:function(){return this._cullingLayer<m.e.visibleAndLoaded&&(this._cullingLayer=this.parent._cullingLayer),this.parent._cullingLayer},set:function(e){if(this._cullingLayer!==e){if(this.shapes)for(var t=0,n=this.shapes.length;t<n;t++)this.shapes[t].cullingLayer=e;this._cullingLayer=e}}}});/* harmony default export */var Xn=Wn,qn=null,Yn=qn={makeEventer:function(e,t){var n=!1;return r.b._isNullOrUndefined(e.addEventListener)&&(e.eventListeners={},t&&(t.forEach(function(e){this.eventListeners[e]=[]},e),Object.freeze(e.eventListeners)),e.addEventListener=function(e,t,n){var i=!1,a=this.eventListeners;!function(e,t){Object.isFrozen(e)||void 0!==e[t]||(e[t]=[])}(a,e);var o=a[e],s={eventListener:t,priority:void 0!==n?n:1/0};if(r.b._notNullOrUndefined(o)&&o.every(function(e){return e.eventListener!==t})){for(var l=0,c=o.length;l<c&&!i;l++)o[l].priority>s.priority&&(o.splice(l,0,s),i=!0);i||(o.push(s),i=!0)}else o&&this.updateEventListener(e,t,n);return i}.bind(e),e.updateEventListener=function(e,t,n){var i=!1,a=this.eventListeners[e];if(r.b._notNullOrUndefined(a)){var o={eventListener:t,priority:void 0!==n?n:1/0},s=a.findIndex(function(e){return e.eventListener===t&&e.priority!==n});if(-1!==s){a.splice(s,1);for(var l=0,c=a.length;l<c&&!i;l++)a[l].priority>o.priority&&(a.splice(l,0,o),i=!0);i||(a.push(o),i=!0)}}return i}.bind(e),e.removeEventListener=function(e,t){var n=!1,i=this.eventListeners[e];if(r.b._notNullOrUndefined(i)){var a=i.findIndex(function(e){return e.eventListener===t});a>-1&&(i.splice(a,1),n=!0)}return n}.bind(e),e.dispatchEvent=function(e){for(var t=!1,n=[],i=1;i<arguments.length;++i)n.push(arguments[i]);var a=this.eventListeners[e];return r.b._notNullOrUndefined(a)&&(a.slice(0).forEach(function dispatch(e){n[0].override||e.eventListener.apply(null,n)}),t=!0),t}.bind(e),n=!0),n},makeDisposable:function(e){var t=!1;return e&&!e._dispose&&(e._dispose=function(){this.dispose&&this.dispose(),this.dispatchEvent({type:"dispose"})}.bind(e),t=qn.makeEventer(e,["dispose"])),t},makeContributionContainer:function(e){var t=!1;return e&&!e._contribute&&(e._contribute=function(e){if(this.contribute)return this.contribute(e)}.bind(e),t=!0),t},makeContributableObject:function(e,t,n){var r=!1;return e&&!e._isContributable&&(e._isContributable=function(){return!0}.bind(e),e._initialize=function(e){if(this.initialize)return this.initialize(e)}.bind(e),void 0!==n&&void 0!==n._contribute&&(n._contribute(e),r=!0)),r}},Zn=o()("PLMVisWeb:debug:InputManager"),Jn=o()("PLMVisWeb:verbose:InputManager"),Qn=[],Kn=function(e){var t=void 0,n=[],i=function(e){var i;t=e,Yn.makeEventer(this,[Kn.EventTypes.Down,Kn.EventTypes.Up,Kn.EventTypes.Move,Kn.EventTypes.Scroll]),this.send=function(e,t){r.b._isString(e,!0),r.b._isObject(t,!0),this.dispatchEvent.call(this,e,t)}.bind(this),this.getViewer=function(){return t}.bind(this);for(var a=0;a<Qn.length;a++)void 0!==(i=Object.create(Qn[a]))._initialize&&(i._initialize(this),n.push(i))};return i.prototype={constructor:i},Object.defineProperties(i.prototype,{type:{value:Kn,writable:!1,configurable:!1}}),new i(e)};
// CONCATENATED MODULE: ./staging/ClassFactory.js
Kn.contribute=function(e){Qn&&-1===Qn.indexOf(e)&&Qn.push(e)},Yn.makeContributionContainer(Kn),Kn.EventTypes={Down:"downEvent",Move:"moveEvent",Up:"upEvent",Scroll:"scrollEvent"},function(){var e=function(){};e.prototype={constructor:e,initialize:function(e){var t,n="";function _doMouseMove(e){Jn("InputManager._doMouseMove",i.b.stringsByLabel.MOUSEINPUT_LOGGER_doMouseMove),"CANVAS"===n&&e.preventDefault(),e.stopPropagation(),t.send(Kn.EventTypes.Move,e)}function _doMouseUp(e){Zn("InputManager._doMouseUp",i.b.stringsByLabel.MOUSEINPUT_LOGGER_doMouseUp),"CANVAS"===n&&e.preventDefault(),e.stopPropagation(),t.send(Kn.EventTypes.Up,e),n=""}(t=e).getViewer().domElement.addEventListener("mousemove",_doMouseMove.bind(this)),window.addEventListener("mousemove",_doMouseMove.bind(this)),t.getViewer().domElement.addEventListener("mouseup",_doMouseUp.bind(this)),window.addEventListener("mouseup",_doMouseUp.bind(this)),t.getViewer().domElement.addEventListener("mousedown",function _doMouseDown(e){Zn("InputManager._doMouseDown",i.b.stringsByLabel.MOUSEINPUT_LOGGER_doMouseDown),n=e.target.tagName,e.preventDefault(),e.stopPropagation(),t.send(Kn.EventTypes.Down,e)}.bind(this)),t.getViewer().domElement.addEventListener("wheel",function _doMouseScroll(e){Zn("InputManager._doMouseScroll",i.b.stringsByLabel.MOUSEINPUT_LOGGER_doMouseScroll),t.send(Kn.EventTypes.Scroll,e)}.bind(this),!1)}},Yn.makeContributableObject(e.prototype,"InputManager",Kn)}(),function(){var e=function(){};e.prototype={constructor:e,initialize:function(e){var t;(t=e).getViewer().domElement.addEventListener("touchstart",function _doTouchStart(e){Zn("InputManager._doTouchStart",i.b.stringsByLabel.TOUCHINPUT_LOGGER_doTouchStart),t.send(Kn.EventTypes.Down,e)}.bind(this),!1),t.getViewer().domElement.addEventListener("touchend",function _doTouchEnd(e){Zn("InputManager._doTouchEnd",i.b.stringsByLabel.TOUCHINPUT_LOGGER_doTouchEnd),t.send(Kn.EventTypes.Up,e)}.bind(this),!1),t.getViewer().domElement.addEventListener("touchmove",function _doTouchMove(e){Zn("InputManager._doTouchMove",i.b.stringsByLabel.TOUCHINPUT_LOGGER_doTouchMove),e.preventDefault(),e.stopPropagation(),t.send(Kn.EventTypes.Move,e)}.bind(this),!1)}},Yn.makeContributableObject(e.prototype,"InputManager",Kn)}();/* harmony default export */var $n=Kn;
// CONCATENATED MODULE: ./staging/ProtoContainer.js
function ProtoContainer_initMap(){this.protoIdToObjectMap||(this.protoIdToObjectMap={})}var er=function(e){_.Object3D.call(this),this.type="Container",this.name=e,this.visibilityState=m.D.None};(er.prototype=Object.create(_.Object3D.prototype)).constructor=er,B.prototype.apply(er.prototype),er.prototype.addProtoIdToObjectMap=function(e,t){ProtoContainer_initMap.call(this),this.protoIdToObjectMap[e]=t},er.prototype.removeProtoIdToObjectMap=function(e){ProtoContainer_initMap.call(this),this.protoIdToObjectMap.hasOwnProperty(e)&&delete this.protoIdToObjectMap[e]},er.prototype.inProtoIdToObjectMap=function(e){return ProtoContainer_initMap.call(this),this.protoIdToObjectMap.hasOwnProperty(e)},er.prototype.clearProtoIdToObjectMap=function(){this.protoIdToObjectMap={}},er.prototype.getObjectByProtoId=function(e){if(ProtoContainer_initMap.call(this),this.protoIdToObjectMap.hasOwnProperty(e))return this.protoIdToObjectMap[e]},er.prototype.add=function(e){_.Object3D.prototype.add.call(this,e),this.dispatchEvent({type:"childAdded",object:e})},er.prototype.remove=function(e){_.Object3D.prototype.remove.call(this,e),this.dispatchEvent({type:"childRemoved",object:e})};/* harmony default export */var tr=er,nr=function(){qe.call(this)};
// CONCATENATED MODULE: ./staging/WideLine.js
nr.prototype=Object.create(qe.prototype),Object.assign(nr.prototype,ze.InstancedBufferGeometry.prototype),nr.prototype.constructor=nr;/* harmony default export */var rr=nr,ir={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(
// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function generateUUID(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;
// .toUpperCase() here flattens concatenated strings to save heap memory space.
return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]).toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},
// compute euclidian modulo of m % n
// https://en.wikipedia.org/wiki/Modulo_operation
euclideanModulo:function(e,t){return(e%t+t)%t},
// Linear mapping from range <a1, a2> to range <b1, b2>
mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},
// https://en.wikipedia.org/wiki/Linear_interpolation
lerp:function(e,t,n){return(1-n)*e+n*t},
// http://en.wikipedia.org/wiki/Smoothstep
smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},
// Random integer from <low, high> interval
randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},
// Random float from <low, high> interval
randFloat:function(e,t){return e+Math.random()*(t-e)},
// Random float from <-range/2, range/2> interval
randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*ir.DEG2RAD},radToDeg:function(e){return e*ir.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};
// CONCATENATED MODULE: ./node_modules/three/src/math/Math.js
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */
// CONCATENATED MODULE: ./node_modules/three/src/math/Matrix4.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author philogb / http://blog.thejit.org/
 * @author jordi_ros / http://plattsoft.com
 * @author D1plo1d / http://github.com/D1plo1d
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author timknip / http://www.floorplanner.com/
 * @author bhouston / http://clara.io
 * @author WestLangley / http://github.com/WestLangley
 */
function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}
// CONCATENATED MODULE: ./node_modules/three/src/math/Quaternion.js
/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://clara.io
 */
function Quaternion(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}
// CONCATENATED MODULE: ./node_modules/three/src/math/Vector3.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author kile / http://kile.stravaganza.org/
 * @author philogb / http://blog.thejit.org/
 * @author mikael emtinger / http://gomo.se/
 * @author egraether / http://egraether.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function Vector3(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,a,o,s,l,c,u,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new Vector3;return function extractRotation(t){
// this method does not support reflection matrices
var n=this.elements,r=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-o*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*o,t[4]=v*o-g,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=g*o-v,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*o,t[4]=-a*u,t[8]=v+g*o,t[1]=g+v*o,t[5]=a*c,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var b=a*s,x=a*l,_=o*s,w=o*l;t[0]=s*c,t[4]=w-b*u,t[8]=_*u+x,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=x*u+_,t[10]=b-w*u}else if("XZY"===e.order){b=a*s,x=a*l,_=o*s,w=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=b*u+w,t[5]=a*c,t[9]=x*u-_,t[2]=_*u-x,t[6]=o*c,t[10]=w*u+b}
// bottom row
return t[3]=0,t[7]=0,t[11]=0,
// last column
t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new Vector3(0,0,0),t=new Vector3(1,1,1);return function makeRotationFromQuaternion(n){return this.compose(e,n,t)}}(),lookAt:function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function lookAt(r,i,a){var o=this.elements;return n.subVectors(r,i),0===n.lengthSq()&&(
// eye and target are in the same position
n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(
// up and z are parallel
1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],M=r[8],E=r[12],S=r[1],L=r[5],T=r[9],A=r[13],C=r[2],P=r[6],I=r[10],O=r[14],B=r[3],R=r[7],G=r[11],D=r[15];return i[0]=a*_+o*S+s*C+l*B,i[4]=a*w+o*L+s*P+l*R,i[8]=a*M+o*T+s*I+l*G,i[12]=a*E+o*A+s*O+l*D,i[1]=c*_+u*S+h*C+d*B,i[5]=c*w+u*L+h*P+d*R,i[9]=c*M+u*T+h*I+d*G,i[13]=c*E+u*A+h*O+d*D,i[2]=p*_+f*S+m*C+g*B,i[6]=p*w+f*L+m*P+g*R,i[10]=p*M+f*T+m*I+g*G,i[14]=p*E+f*A+m*O+g*D,i[3]=v*_+y*S+b*C+x*B,i[7]=v*w+y*L+b*P+x*R,i[11]=v*M+y*T+b*I+x*G,i[15]=v*E+y*A+b*O+x*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];
//TODO: make this more efficient
//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )
return e[3]*(+i*s*u-r*l*u-i*o*h+n*l*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*a*h-r*a*d+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*d-i*a*u+n*a*d+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*h+r*a*u-n*a*h+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){
// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm
var n=this.elements,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],x=p*y*h-v*f*h+v*u*m-c*y*m-p*u*b+c*f*b,_=g*f*h-d*y*h-g*u*m+l*y*m+d*u*b-l*f*b,w=d*v*h-g*p*h+g*c*m-l*v*m-d*c*b+l*p*b,M=g*p*u-d*v*u-g*c*f+l*v*f+d*c*y-l*p*y,E=i*x+a*_+o*w+s*M;if(0===E){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var L=1/E;return n[0]=x*L,n[1]=(v*f*s-p*y*s-v*o*m+a*y*m+p*o*b-a*f*b)*L,n[2]=(c*y*s-v*u*s+v*o*h-a*y*h-c*o*b+a*u*b)*L,n[3]=(p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m)*L,n[4]=_*L,n[5]=(d*y*s-g*f*s+g*o*m-i*y*m-d*o*b+i*f*b)*L,n[6]=(g*u*s-l*y*s-g*o*h+i*y*h+l*o*b-i*u*b)*L,n[7]=(l*f*s-d*u*s+d*o*h-i*f*h-l*o*m+i*u*m)*L,n[8]=w*L,n[9]=(g*p*s-d*v*s-g*a*m+i*v*m+d*a*b-i*p*b)*L,n[10]=(l*v*s-g*c*s+g*a*h-i*v*h-l*a*b+i*c*b)*L,n[11]=(d*c*s-l*p*s-d*a*h+i*p*h+l*a*m-i*c*m)*L,n[12]=M*L,n[13]=(d*v*o-g*p*o+g*a*f-i*v*f-d*a*y+i*p*y)*L,n[14]=(g*c*o-l*v*o-g*a*u+i*v*u+l*a*y-i*c*y)*L,n[15]=(l*p*o-d*c*o+d*a*u-i*p*u-l*a*f+i*c*f)*L,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){
// Based on http://www.gamedev.net/reference/articles/article1199.asp
var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+n,c*s-r*a,0,l*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,p=i*u,f=a*c,m=a*u,g=o*u,v=s*l,y=s*c,b=s*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-b)*_,r[5]=(1-(h+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(){var e=new Vector3,t=new Matrix4;return function decompose(n,r,i){var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),l=e.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),n.x=a[12],n.y=a[13],n.z=a[14],
// scale the rotation part
t.copy(this);var c=1/o,u=1/s,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),i.x=o,i.y=s,i.z=l,this}}(),makePerspective:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),l=1/(n-r),c=1/(a-i),u=(t+e)*s,h=(n+r)*l,d=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),Object.assign(Quaternion,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,a,o){
// fuzz-free, array-based Quaternion SLERP operation
var s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(u!==f||s!==h||l!==d||c!==p){var m=1-o,g=s*h+l*d+c*p+u*f,v=g>=0?1:-1,y=1-g*g;
// Skip the Slerp for tiny steps to avoid numeric problems:
if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,g*v);m=Math.sin(m*x)/b,o=Math.sin(o*x)/b}var _=o*v;
// Normalize in case we just did a lerp:
if(s=s*m+h*_,l=l*m+d*_,c=c*m+p*_,u=u*m+f*_,m===1-o){var w=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=w,l*=w,c*=w,u*=w}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=s(n/2),d=s(r/2),p=s(i/2);
// http://www.mathworks.com/matlabcentral/fileexchange/
//  20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/
//  content/SpinCalc.m
return"XYZ"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===a?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===a?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===a&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm
// assumes axis is normalized
var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
var t,n=e.elements,r=n[0],i=n[4],a=n[8],o=n[1],s=n[5],l=n[9],c=n[2],u=n[6],h=n[10],d=r+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-i)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+c)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(a-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(o-i)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){
// assumes direction vectors vFrom and vTo are normalized
var e,t=new Vector3;return function setFromUnitVectors(n,r){return void 0===t&&(t=new Vector3),(e=n.dot(r)+1)<1e-6?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(ir.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){
// quaternion is assumed to have unit length
return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){
// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm
var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+r*l-i*s,this._y=r*c+a*s+i*o-n*l,this._z=i*c+a*l+n*s-r*o,this._w=a*c-n*o-r*s-i*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;
// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/
if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Vector3.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new Quaternion;return function applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new Quaternion;return function applyAxisAngle(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,c=s*n+o*t-i*r,u=s*r+i*n-a*t,h=-i*t-a*n-o*r;
// calculate result * inverse quat
return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new Matrix4;return function unproject(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){
// input: THREE.Matrix4 affine matrix
// vector interpreted as a direction
var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){
// assumes min < max, componentwise
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Vector3,t=new Vector3;return function clampScalar(n,r){return e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},
// TODO lengthSquared?
lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Vector3;return function projectOnPlane(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){
// reflect incident vector off plane orthogonal to normal
// normal is assumed to have unit length
var e=new Vector3;return function reflect(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());
// clamp, to handle numerical problems
return Math.acos(ir.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});
// CONCATENATED MODULE: ./staging/Scene.js
var ar=o()("PLMVisWeb:debug:Scene"),or=o()("PLMVisWeb:warning:Scene"),sr=o()("PLMVisWeb:verbose:Scene"),lr=function(e){this.name=e,this.map={}};lr.prototype.constructor=lr,lr.prototype.get=function(e){return this.map[e.id]},lr.prototype.add=function(e,t){this.map[e.id]||(t.instanceCount=e.expectedInstanceCount,this.map[e.id]=t)},lr.prototype.addInstance=function(e){var t=this.map[e.id];t&&t.instanceCount++},lr.prototype.removeInstance=function(e,t){var n=this.map[e.id];n&&(n.instanceCount>0&&n.instanceCount--,0===n.instanceCount&&(delete this.map[e.id],t(e)))},lr.prototype.clear=function(){this.map={}};var cr=function(e){ze.Container.call(this,e),this.shapeMap={}};(cr.prototype=Object.create(ze.Container.prototype)).constructor=cr,cr.prototype.addShape=function(e,t){var n=this.shapeMap[e.id];n||(n=[],this.shapeMap[e.id]=n),t.owner=e,n.push(t),this.add(t)},cr.prototype.getShapes=function(e){return this.shapeMap[e.id]},cr.prototype.removeShape=function(e,t){var n=this.shapeMap[e.id];if(n&&n.length>0){var r=n.indexOf(t);n.splice(r,1)}this.remove(t)},cr.prototype.clear=function(){this.shapeMap={}};var ur=function(e){ar("Scene",this),_.Scene.call(this),this.isScene=!0,ar("Scene",this),ar("Three Scene",_.Scene),this.useInstancing=e,this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.hasBothSectionSide=!1,this.octree=function(){return new Lt.Octree({undeferred:!1,depthMax:1/0,objectsThreshold:8,overlapPct:.15})}.call(this);var t=m.x.FREE;e||(this._shapeCache=new lr("ShapeCache"),this._edgeCache=new lr("EdgeCache"),this._vertexCache=new lr("VertexCache")),this.modelObject=new ze.Container,this.modelObject.name="Models",this.modelObject.userData.psId="-1",this.add(this.modelObject),this._shapeContainer=new cr("ShapeContainer"),this._edgeContainer=new cr("EdgeContainer"),this._sectionEdgeContainer=new ze.Container("SectionEdgeContainer"),this._sectionFaceContainer=new ze.Container("SectionFaceContainer"),this._pointsContainer=new ze.Container("PointsContainer"),this._vertexContainer=new cr("VertexContainer"),this._auxShapeContainer=new ze.Container("AuxShapeContainer"),this._wireframeContainer=new ze.Container("WireframeContainer"),this._annotationContainer=new ze.Container("AnnotationContainer"),this._prototypeContainer=new tr("Prototypes"),this.children.push(this._shapeContainer),this.children.push(this._edgeContainer),this.children.push(this._vertexContainer),this.children.push(this._sectionEdgeContainer),this.children.push(this._sectionFaceContainer),this.children.push(this._pointsContainer),this.children.push(this._auxShapeContainer),this.children.push(this._wireframeContainer),this.children.push(this._annotationContainer);var n={diffuse:10066329,emissive:0,specular:0,shininess:1,opacity:1};this._defaultMeshMaterial=r.b._createMeshMaterial(n,!1,!0),this._defaultInstancedMeshMaterial=r.b._createMeshMaterial(n,!0,!0),this._defaultLineMaterial=r.b._createLineMaterial(16777215,1,2,!1,!0),this._defaultInstancedLineMaterial=r.b._createLineMaterial(16777215,1,2,!0,!0),n={diffuse:16777088,emissive:0,specular:8355584,shininess:1,opacity:1},this._selectionMaterial=r.b._createMeshMaterial(n,!1,!0),this._instancedSelectionMaterial=r.b._createMeshMaterial(n,!0,!0),this._sectionCapSelectionMaterial=r.b._createMeshMaterial(n,!1,!1),n={diffuse:8323327,emissive:0,specular:128,shininess:1,opacity:1},this._highlightMaterial=r.b._createMeshMaterial(n,!1,!0),this._instancedHighlightMaterial=r.b._createMeshMaterial(n,!0,!0),this._sectionCapHighlightMaterial=r.b._createMeshMaterial(n,!1,!1),this._outlineMaterial=r.b._createOutlineMaterial(0,1,!1,!0),this._instancedoutlineMaterial=r.b._createOutlineMaterial(0,1,!0,!0),this._outlineSelectionMaterial=r.b._createOutlineMaterial(16777088,1,!1,!0),this._instancedOutlineSelectionMaterial=r.b._createOutlineMaterial(16777088,1,!0,!0),this._outlineHighlightMaterial=r.b._createOutlineMaterial(8323327,1,!1,!0),this._instancedOutlineHighlightMaterial=r.b._createOutlineMaterial(8323327,1,!0,!0),this._lineSelectionMaterial=r.b._createLineMaterial(16777088,1,2,!1,!0),this._instancedLineSelectionMaterial=r.b._createLineMaterial(16777088,1,2,!0,!0),this._lineHighlightingMaterial=r.b._createLineMaterial(8323327,1,2,!1,!0),this._instancedLineHighlightingMaterial=r.b._createLineMaterial(8323327,1,2,!0,!0),this._lineMaterial=r.b._createLineMaterial(0,1,2,!1,!0),this._instancedLineMaterial=r.b._createLineMaterial(0,1,2,!0,!0),this._hiddenLineMaterial=r.b._createHiddenLineMaterial(.15,2,!1,!0),this._instancedHiddenLineMaterial=r.b._createHiddenLineMaterial(.15,2,!0,!0),this._sectionLineMaterial=[r.b._createLineMaterial(16777088,1,1,!1,!0),r.b._createLineMaterial(8323327,1,1,!1,!0),r.b._createLineMaterial(16777215,1,1,!1,!0)],this._sectionLineMaterial.isGlobal=!0,this._sectionCapMaterial={userCapColor:{diffuse:10066329,emissive:0,specular:0,shininess:1,opacity:1},enabled:!1},this._meshVertexColorMaterial=[r.b._createMeshVertexColorMaterial(16777088,!1,!0),r.b._createMeshVertexColorMaterial(8323327,!1,!0),r.b._createMeshVertexColorMaterial(null,!1,!0)],this._meshVertexColorMaterial.isGlobal=!0,this._instancedMeshVertexColorMaterial=[r.b._createMeshVertexColorMaterial(16777088,!0,!0),r.b._createMeshVertexColorMaterial(8323327,!0,!0),r.b._createMeshVertexColorMaterial(null,!0,!0)],this._instancedMeshVertexColorMaterial.isGlobal=!0,this._lineVertexColorMaterial=[r.b._createLineVertexColorMaterial(16777088,1,2,!1,!0),r.b._createLineVertexColorMaterial(8323327,1,2,!1,!0),r.b._createLineVertexColorMaterial(null,1,2,!1,!0)],this._lineVertexColorMaterial.isGlobal=!0,this._instancedLineVertexColorMaterial=[r.b._createLineVertexColorMaterial(16777088,!0,!0),r.b._createLineVertexColorMaterial(8323327,!0,!0),r.b._createLineVertexColorMaterial(null,!0,!0)],this._instancedLineVertexColorMaterial.isGlobal=!0,this._pointsMaterial=r.b._createPointsMaterial(0,1,!0,!0),this._pointsSelectionMaterial=r.b._createPointsMaterial(16777088,1,!0,!0),this._pointsHighlightMaterial=r.b._createPointsMaterial(8323327,1,!0,!0),this._pointDistanceMaterial=r.b._createPointsMaterial(16777088,1,!1,!0);var i=new ze.Container("LightsContainer");this.add(i);var a=.5,o=new _.DirectionalLight(16777215,a);o.color.setRGB(a,a,a),o.position.set(0,0,0),o.target.position.set(1,-1,-1),i.add(o),i.add(o.target),a=.5;var s=new _.DirectionalLight(16777215,a);o.color.setRGB(a,a,a),s.target.position.set(-1,-1,-1),s.position.set(0,0,0),i.add(s),i.add(s.target);var l=new _.AmbientLight(16777215);a=.3,l.color.setRGB(a,a,a),i.add(l),void 0===window.tweakDirectionalLights&&(window.tweakDirectionalLights=function(e){void 0!==e.hexColor&&(o.color.setHex(e.hexColor),s.color.setHex(e.hexColor)),void 0!==e.rgbColor&&(o.color.setRGB(e.rgbColor.r,e.rgbColor.g,e.rgbColor.b),s.color.setRGB(e.rgbColor.r,e.rgbColor.g,e.rgbColor.b)),void 0!==e.intensity&&(o.intensity=e.intensity,s.intensity=e.intensity)}),void 0===window.tweakAmbientLight&&(window.tweakAmbientLight=function(e){void 0!==e.hexColor&&l.color.setHex(e.hexColor),void 0!==e.rgbColor&&l.color.setRGB(e.rgbColor.r,e.rgbColor.g,e.rgbColor.b),void 0!==e.intensity&&(l.intensity=e.intensity)}),this._lights=i;var c=new _.Box3,u=new _.Box3,h=new _.Sphere;this.modelObject.addEventListener("childAdded",function(e){e.object instanceof ce&&(u.makeEmpty(),h.radius=0)}),this.modelObject.addEventListener("childRemoved",function(e){e.object instanceof ce&&(u.makeEmpty(),h.radius=0)});var d=!1;this.onVisibilityChanged=function(e){e instanceof ce&&(d=!0),this.dispatchEvent({type:m.i.visibilityChanged,object:e})},this.onLoadChanged=function(e){e instanceof ce&&(d=!0),this.dispatchEvent({type:m.i.loadChanged,object:e})},Object.defineProperties(this,{modelBoundingBox:{get:function(){return u.isEmpty()&&r.b._getTopModelBBox(this.modelObject,u),u}},modelBoundingSphere:{get:function(){return 0===h.radius&&this.modelBoundingBox.getBoundingSphere(h),h}},visibleModelBoundingBox:{get:function(){return d&&(d=!1,c.makeEmpty(),r.b._getVisibleBBox(this.modelObject,c)),c}},pickingMode:{get:function(){return t},set:function(e){null!==e&&void 0!==e||(e=m.x.FREE),t=e}}}),void 0===window.tweakSpecular&&(window.tweakSpecular=function(e){function updateMaterial(t){void 0!==e.hexColor&&void 0!==t.uniforms.specular&&t.uniforms.specular.value.setHex(e.hexColor),void 0!==e.rgbColor&&void 0!==t.uniforms.specular&&t.uniforms.specular.value.setRGB(e.rgbColor.r,e.rgbColor.g,e.rgbColor.b),void 0!==e.shininess&&void 0!==t.uniforms.shininess&&(t.uniforms.shininess.value=e.shininess<=1e-6?1e-6:e.shininess),t.needsUpdate=!0}var t=this.modelObject.children;if(Array.isArray(t)&&t.length>0&&t[0].userData.multiMaterial){var n=t[0].userData.multiMaterial;void 0!==n&&n.forEach(updateMaterial)}else this._shapeContainer.children.forEach(function(e){if(e instanceof _.Mesh){var t=e.material;Array.isArray(t)?t.forEach(updateMaterial):(updateMaterial(t),t.needsUpdate=!0)}})}.bind(this))};(ur.prototype=Object.create(_.Scene.prototype)).constructor=ur,B.prototype.apply(ur.prototype),ur.prototype.traverseTriShape=function(e){for(var t=0,n=this._shapeContainer.children.length;t<n;t++){var r=this._shapeContainer.children[t];r instanceof _.Mesh&&!r.geometry.isLines&&e(r)}},ur.prototype.refineShape=function(e,t){for(var n=null,r=0,i=this._shapeContainer.children.length;r<i;r++){var a=this._shapeContainer.children[r];if(a.id===e.id){a.curvedBuffers=e.curvedBuffers,e.positions&&(a.geometry.attributes.position.array=e.positions,a.geometry.attributes.position.needsUpdate=!0),e.normals&&(a.geometry.attributes.normal.array=e.normals,a.geometry.attributes.normal.needsUpdate=!0),e.indices&&(a.geometry.index.array=e.indices,a.geometry.index.needsUpdate=!0);for(var o=0,s=a.geometry.groups.length;o<s;o++){var l=a.geometry.groups[o];l.start=e.groupStartBuffer[o],l.count=e.groupCountBuffer[o]}if((n=a.owner)&&n.wireframeVisible&&n.wireframes){for(var c=0,u=n.wireframes.length;c<u;c++)this._wireframeContainer.remove(n.wireframes[c]);delete n.wireframes,n.wireframeVisible=!1,this.setWireframes(n,!0,n.wirefameColor)}if(n.edges){r=0;for(var h=n.shapes.length;r<h;r++){(e=n.shapes[r])instanceof ze.EdgeShapeBase&&(this.removeShape(n,e),n.shapes.splice(r,1),r--,h--)}if(this._edgeCache)this._edgeCache.removeInstance(n,function(e){e.edgesLoaded=!1});else{var d=this._edgeContainer.getShapes(n);d&&0!==d.length||(n.edgesLoaded=!1)}}delete n.edges,delete n.sectionEdges;break}}t(n)},ur.prototype.getPickCandidates=function(e){for(var t=0,n=this._auxShapeContainer.children.length;t<n;t++){var r=this._auxShapeContainer.children[t];r instanceof GenericShape&&e.push(r)}},ur.prototype.addIndexedShape=function(e,t){this.octree.add(e,t)},ur.prototype.removeIndexedShape=function(e){this.octree.remove(e)},ur.prototype.updateIndexedObject=function(e){if(null!==e&&void 0!==e)if(!0===e.isPmi)if(0===(n=e.children.length))this.octree.updateObject(e);else for(var t=0;t<n;t++)this.octree.updateObject(e.children[t]);else if(e instanceof ce){if(e.shapes&&e.shapes.length>0){t=0;for(var n=e.shapes.length;t<n;t++)this.octree.updateObject(e.shapes[t])}e.vertices&&this.octree.updateObject(e.vertices)}else if(e instanceof ze.Assembly)for(t=0,n=e.children.length;t<n;t++)this.octree.updateObject(e.children[t]);else e instanceof _.Object3D&&this.octree.updateObject(e)},ur.prototype.update=function(){this.octree.update()},ur.prototype.search=function(e){return this.octree.search(e.ray.origin,e.ray.far,!0,e.ray.direction)},ur.prototype.updateLights=function(e){this._lights.quaternion.copy(e.quaternion)},ur.prototype.addAuxShape=function(e){e instanceof _.Object3D&&(this._auxShapeContainer.add(e),e.updateMatrixWorld(),this.octree.add(e))},ur.prototype._updateModelBoundingBox=function(e){if(e instanceof _.Box3){if(e.min.x=1/0,e.min.y=1/0,e.min.z=1/0,e.max.x=-1/0,e.max.y=-1/0,e.max.z=-1/0,this._shapeContainer.children.length>0)for(var t=0,n=this._shapeContainer.children.length;t<n;t++){var i=this._shapeContainer.children[t];if(i.geometry.boundingBox||i.geometry.computeBoundingBox(),i.instances.length>0)for(var a=0;a<i.instances.length;a++)r.b._unionModelBBox(e,i.geometry.boundingBox,i.instances[a].parent.matrixWorld)}if(this._auxShapeContainer.children.length>0)for(t=0,n=this._auxShapeContainer.children.length;t<n;t++){var o=this._auxShapeContainer.children[t];o.geometry.boundingBox||o.geometry.computeBoundingBox(),r.b._unionModelBBox(e,o.geometry.boundingBox,o.matrixWorld)}this._pmiShapeContainer&&this._pmiShapeContainer.children.length>0&&this._pmiShapeContainer.traverse(function(t){(t instanceof ze.PmiLine||t instanceof ze.PmiSurface)&&(t.geometry.boundingBox||t.geometry.computeBoundingBox(),r.b._unionModelBBox(e,t.geometry.boundingBox,t.matrixWorld))}),this._dimensionContainer instanceof ze.Container&&this._dimensionContainer.children.length>0&&this._dimensionContainer.traverse(function(t){t.geometry&&t.matrixWorld&&(t.geometry.boundingBox||t.geometry.computeBoundingBox(),r.b._unionModelBBox(e,t.geometry.boundingBox,t.matrixWorld))})}},ur.prototype.removeAuxShape=function(e){e instanceof _.Object3D&&(this._auxShapeContainer.remove(e),this.octree.remove(e))},ur.prototype.updateAuxShape=function(e){e instanceof _.Object3D&&this.octree.updateObject(e)},ur.prototype.clear=function(){this._edgeCache&&this._edgeCache.clear(),this._vertexCache&&this._vertexCache.clear(),this._shapeCache&&this._shapeCache.clear(),this._shapeContainer.clear(),this._edgeContainer.clear(),this._vertexContainer.clear(),r.b._clearObject3D(this._shapeContainer,!0),r.b._clearObject3D(this._edgeContainer,!0),r.b._clearObject3D(this._vertexContainer,!0),r.b._clearObject3D(this._sectionEdgeContainer,!0),r.b._clearObject3D(this._sectionFaceContainer,!0),r.b._clearObject3D(this._pointsContainer,!0),r.b._clearObject3D(this._auxShapeContainer,!0),r.b._clearObject3D(this._wireframeContainer,!0),r.b._clearObject3D(this._prototypeContainer,!0),this.octree.reset()},ur.prototype.getExpectedInstanceCount=function(e){return e.expectedInstanceCount},ur.prototype.setShapes=function(e,t,n,i){var a=e.original.instances.length,o=null,s=e,l=this._shapeCache?[]:null;if(null===n)for(;s&&s.parent&&!(s.parent instanceof ze.Container);)s=s.parent;if(s.userData.materialsPool){if(void 0===s.userData.instancedMultiMaterial){var c=s.userData.materialsPool.length,u=[];u[0]=this._instancedSelectionMaterial,u[1]=this._instancedLineSelectionMaterial,u[2]=this._instancedHighlightMaterial,u[3]=this._instancedLineHighlightingMaterial,u[4]=this._defaultInstancedMeshMaterial,u[5]=this._defaultInstancedLineMaterial;for(var h=6;h<c;h++)u[h]=s.userData.materialsPool[h];s.userData.instancedMultiMaterial=u}(o=s.userData.instancedMultiMaterial).isGlobal=!0}else(n=n||[])[0]=this._instancedSelectionMaterial,n[1]=this._instancedLineSelectionMaterial,n[2]=this._instancedHighlightMaterial,n[3]=this._instancedLineHighlightingMaterial,n[4]=this._defaultInstancedMeshMaterial,n[5]=this._defaultInstancedLineMaterial,o=n;var d=-1;for(s=e;s&&s.parent&&!(s.parent instanceof ze.Container)&&-1===d;)void 0!==(s=s.parent).userData.matIdx&&(d=s.userData.matIdx);for(var p=0,f=0,m=null,g=0,v=t.length,y=null;g<v;++g,null){var b=0,x=2,_=!1,w=o;for((y=t[g])instanceof ze.InstancedVertexColorBufferGeometry?(x=1,w=y.isLines?this._instancedLineVertexColorMaterial:this._instancedMeshVertexColorMaterial,_=!0):y.isLines&&(b=1,x=3),y.selectionIndex=b,y.highlightingIndex=x,p=0,f=y.groups.length;p<f;++p)(m=y.groups[p]).materialIndex<0&&(_?m.materialIndex=2:y.isLines?m.materialIndex=5:m.materialIndex=-1===d?4:d);var M=this.createShape(nodePrototype,y,w,a);if(nodePrototype.shapes.push(M),M.instances=[],i&&(M.curvedBuffers=i),l&&l.push(M),nodePrototype.instances&&nodePrototype.instances.length>0){for(h=0,c=nodePrototype.instances.length;h<c;h++){var E=nodePrototype.instances[h].addShape(M,!1);M.instances.push(E),M.instanceCount++,this.octree.add(E),nodePrototype.instances[h].shapesLoaded=!0}"PartShape"===E.type&&r.b._notNullOrUndefined(e.bodies)&&E.rebuildDrawGroups()}M.needsUpdate=!0}l&&l.length>0&&this._shapeCache.add(nodePrototype,l),nodePrototype.shapesLoaded=!0},ur.prototype.setShapesOnPrototype=function(e,t,n,r){for(var i=e.instances.length,a=this._shapeCache?[]:null,o=n.materials,s=n.inheritedMatIdx?n.inheritedMatIdx:-1,l=0,c=0,u=null,h=null,d=0,p=t.length,f=null;d<p;++d,h=null){var m=0,g=2,v=!1;for((f=t[d])instanceof ze.InstancedVertexColorBufferGeometry?(g=1,o=f.isLines?this._instancedLineVertexColorMaterial:this._instancedMeshVertexColorMaterial,v=!0):f.isLines&&(m=1,g=3),f.selectionIndex=m,f.highlightingIndex=g,l=0,c=f.groups.length;l<c;++l)(u=f.groups[l]).materialIndex<0&&(v?u.materialIndex=2:f.isLines?u.materialIndex=5:u.materialIndex=-1===s?4:s);(h=this.createShape(e,f,o,i)).instances=[],e.shapes.push(h),r&&(h.curvedBuffers=r),a&&a.push(h)}a&&a.length>0&&this._shapeCache.add(e,a),e.shapesLoaded=!0},ur.prototype.setShapesOnInstance=function(e,t=!1){var n=e.original;if(n.shapesLoaded){for(var r,i=0,a=n.shapes.length;i<a;i++)if("Mesh"===(r=n.shapes[i]).type||"LineSegments"===r.type){if(r.instanceCount===r.geometry.expectedInstanceCount){for(var o=[];r.geometry.instances.length>0;)o.push(r.geometry.instances[0]),r.geometry.removeInstance(r.geometry.instances[0]);r.geometry.expectedInstanceCount++;for(var s=0,l=o.length;s<l;s++)r.geometry.addInstance(o[s])}var c=e.addShape(r,t);r.instances.push(c),r.instanceCount++,this.octree.add(c),r.needsUpdate=!0}e.shapesLoaded=!0}},ur.prototype.createShape=function(e,t,n,i){var a=null;return"LineSegmentsGeometry"===t.type?(a=new Je(t,n)).computeLineDistances():t.isLines?a=new _.LineSegments(t,n):(a=new _.Mesh(t,n),r.b._isNumber(t.drawMode)&&t.drawMode>-1&&t.drawMode<3&&(a.drawMode=t.drawMode)),t.owner=a,a.visible=!1,r.b._notNullOrUndefined(n)&&(r.b._notNullOrUndefined(n.instanceCount)?n.instanceCount=1:n.instanceCount++),a.instanceCount=0,this._shapeContainer.addShape(e,a),t.expectedInstanceCount=i,a},ur.prototype.createEdge=function(e,t,n,i,a){var o=new _.LineSegments(n,i);return o.userData.edgeId=e,o.visible=!1,n.owner=o,r.b._notNullOrUndefined(i.instanceCount)?i.instanceCount=1:i.instanceCount++,o.instanceCount=0,this._edgeContainer.addShape(t,o),n.expectedInstanceCount=a,o},ur.prototype.createVertices=function(e,t,n,i){var a=new _.Points(t,n);return a.visible=!1,t.owner=a,r.b._notNullOrUndefined(n.instanceCount)?n.instanceCount=1:n.instanceCount++,a.instanceCount=0,this._vertexContainer.addShape(e,a),t.expectedInstanceCount=i,a},ur.prototype.setEdges=function(e,t,n,r){var a=e.original,o=a.instances.length,s=[this._instancedLineSelectionMaterial,this._instancedLineHighlightingMaterial,this._instancedLineMaterial,this._instancedHiddenLineMaterial],l=[this._instancedOutlineSelectionMaterial,this._instancedOutlineHighlightMaterial,this._instancedoutlineMaterial],c=[this._pointsSelectionMaterial,this._pointsHighlightMaterial,this._pointsMaterial],u=[],h=[],d=[],p=!1,f=0,m=0,g=0,v=0,y=new ze.InstancedLineBufferGeometry;for(var b in a.edgeVertexMap=r,t)if(t[b]){var x=t[b],w={edgeId:b};if(g+=v,v=x.attributes.position.array.length/3,y.addGroup(g,v,2),y.groups[m++].edgeId=b,Array.prototype.push.apply(u,x.attributes.position.array),x.attributes.normal&&(Array.prototype.push.apply(h,x.attributes.normal.array),p=!0),h.length!==u.length)for(var M=h.length,E=u.length;M<E;M++)h.push(0);if(x.index&&x.index.array)for(M=0,E=x.index.array.length;M<E;M+=1)d.push(x.index.array[M]);else for(M=0,E=x.attributes.position.count;M<E;M+=1)d.push(f++)}else or(i.b.stringsByLabel.SCENE_LOGGER_nullEdgeWarn+part.name);if(u=new _.BufferAttribute(new Float32Array(u),3),p&&h&&h.length>0&&(h=new _.BufferAttribute(new Float32Array(h),3)),d=new _.BufferAttribute(new(d.length<65536?Uint16Array:Uint32Array)(d),1),y.addAttribute("position",u),p&&h&&h.count>0&&y.addAttribute("normal",h),y.setIndex(d),w={edgeId:b},(P=this.createEdge("EdgeShape",a,y,s,o)).instances=[],P.type="EdgeShape",a.shapes.push(P),void 0!==this._edgeCache&&this._edgeCache.add(a,P),a.instances&&a.instances.length>0){M=0;for(var S=a.instances.length;M<S;M++){var L=a.instances[M].addEdgeFrame(w,P,!1);P.instances.push(L),P.instanceCount++,this.octree.add(L)}L.rebuildDrawGroups()}P.needsUpdate=!0;for(M=0,E=a.shapes.length;M<E;M++)if("Mesh"===a.shapes[M].type&&!a.shapes[M].hasOutline){var T=a.shapes[M].geometry.clone();if(T.groups=[{start:0,count:T.index.count,materialIndex:2,index:0,attributes:{}}],(P=this.createShape(a,T,l,o)).instances=[],P.type="OutlineShape",a.shapes.push(P),void 0!==this._shapeCache&&this._shapeCache.add(a,P),a.instances&&a.instances.length>0){var A=0;for(S=a.instances.length;A<S;A++){var C=a.instances[A].addOutline(P,a.instances[A]._areEdgesVisible);P.instances.push(C),P.instanceCount++,this.octree.add(C)}}a.shapes[M].hasOutline=!0}if(n){var P,I=new ze.InstancedPointsBufferGeometry;I.addAttribute("position",new _.BufferAttribute(n,3));for(M=0;M<n.length;M+=3)I.addGroup(M/3,1,2);if((P=this.createVertices(a,I,c,o)).instances=[],P.type="VertexShape",a.shapes.push(P),void 0!==this._vertexCache&&this._vertexCache.add(part,P),a.instances&&a.instances.length>0){for(M=0,S=a.instances.length;M<S;M++){var O=a.instances[M].addVertexShape(P,a.instances[M]._areVerticesVisible);P.instances.push(O),P.instanceCount++,this.octree.add(O)}O.rebuildDrawGroups()}P.needsUpdate=!0}a.edgesLoaded=!0},ur.prototype.setEdgesOnPrototype=function(e,t,n,r){var a=e.instances.length,o=[this._instancedLineSelectionMaterial,this._instancedLineHighlightingMaterial,this._instancedLineMaterial,this._instancedHiddenLineMaterial],s=[this._instancedOutlineSelectionMaterial,this._instancedOutlineHighlightMaterial,this._instancedoutlineMaterial],l=[this._pointsSelectionMaterial,this._pointsHighlightMaterial,this._pointsMaterial],c=[],u=[],h=[],d=!1,p=0,f=0,m=0,g=0,v=new ze.InstancedLineBufferGeometry;for(var y in e.edgeVertexMap=r,t)if(t[y]){var b=t[y];if(m+=g,g=b.attributes.position.array.length/3,v.addGroup(m,g,2),v.groups[f++].edgeId=y,Array.prototype.push.apply(c,b.attributes.position.array),b.attributes.normal&&(Array.prototype.push.apply(u,b.attributes.normal.array),d=!0),u.length!==c.length)for(var x=u.length,w=c.length;x<w;x++)u.push(0);if(b.index&&b.index.array)for(x=0,w=b.index.array.length;x<w;x+=1)h.push(b.index.array[x]);else for(x=0,w=b.attributes.position.count;x<w;x+=1)h.push(p++)}else or(i.b.stringsByLabel.SCENE_LOGGER_nullEdgeWarn+part.name);c=new _.BufferAttribute(new Float32Array(c),3),d&&u&&u.length>0&&(u=new _.BufferAttribute(new Float32Array(u),3)),h=new _.BufferAttribute(new(h.length<65536?Uint16Array:Uint32Array)(h),1),v.addAttribute("position",c),d&&u&&u.count>0&&v.addAttribute("normal",u),v.setIndex(h),(E=this.createEdge("EdgeShape",e,v,o,a)).instances=[],E.type="EdgeShape",e.shapes.push(E),void 0!==this._edgeCache&&this._edgeCache.add(e,E),E.needsUpdate=!0;for(x=0,w=e.shapes.length;x<w;x++)if("Mesh"===e.shapes[x].type&&!e.shapes[x].hasOutline){var M=e.shapes[x].geometry.clone();M.groups=[{start:0,count:M.index.count,materialIndex:2,index:0,attributes:{}}],(E=this.createShape(e,M,s,a)).instances=[],E.type="OutlineShape",e.shapes.push(E),void 0!==this._shapeCache&&this._shapeCache.add(e,E),e.shapes[x].hasOutline=!0}if(n){var E,S=new ze.InstancedPointsBufferGeometry;S.addAttribute("position",new _.BufferAttribute(n,3));for(x=0;x<n.length;x+=3)S.addGroup(x/3,1,2);(E=this.createVertices(e,S,l,a)).instances=[],E.type="VertexShape",e.shapes.push(E),void 0!==this._vertexCache&&this._vertexCache.add(e,E),E.needsUpdate=!0}e.edgesLoaded=!0},ur.prototype.setEdgesOnInstance=function(e,t=!1){var n=e.original;if(n.edgesLoaded)for(var r,i=0,a=n.shapes.length;i<a;i++)if("EdgeShape"===(r=n.shapes[i]).type||"OutlineShape"===r.type||"VertexShape"===r.type){var o;if(r.instanceCount===r.geometry.expectedInstanceCount){for(var s=[];r.geometry.instances.length>0;)s.push(r.geometry.instances[0]),r.geometry.removeInstance(r.geometry.instances[0]);r.geometry.expectedInstanceCount++;for(var l=0,c=s.length;l<c;l++)r.geometry.addInstance(s[l])}switch(r.type){case"EdgeShape":o=e.addEdgeFrame(null,r,!1);break;case"OutlineShape":o=e.addOutline(r,!1);break;case"VertexShape":o=e.addVertexShape(r,!1)}r.instances.push(o),r.instanceCount++,this.octree.add(o),r.needsUpdate=!0}},ur.prototype.setPoint=function(e,t,n){var r=new _.BufferGeometry;e.worldToLocal(t),r.addAttribute("position",new _.BufferAttribute(new Float32Array([t.x,t.y,t.z]),3)),r.addAttribute("normal",new _.BufferAttribute(new Float32Array([n.x,n.y,n.z]),3));var i=new ze.PointShape(e,this._pointsContainer.children.length,r,this._pointDistanceMaterial);return i.visible=!0,this._pointsContainer.children.push(i),i},ur.prototype.removePoints=function(){for(var e=this._pointsContainer.children,t=null;e.length>0;)(t=e[0]).parent.points&&(t.parent.points={}),this._pointsContainer.remove(t),r.b._clearObject3D(t)},ur.prototype.removeShape=function(e,t){var n,i=e.original,a=t.original;(this.octree.remove(t),t instanceof ze.ShapeInstance)&&(-1!==(n=e.shapes.indexOf(t))&&e.shapes.splice(n,1),a.geometry instanceof ze.InstancedBufferGeometry?(a.geometry.removeInstance(t),-1!==(n=a.instances.indexOf(t))&&(a.instances.splice(n,1),a.instanceCount--),0===a.instanceCount&&(t instanceof ze.EdgeShape?this._edgeContainer.removeShape(i,a):t instanceof ze.VertexShape?this._vertexContainer.removeShape(i,a):this._shapeContainer.removeShape(i,a),-1!==(n=i.shapes.indexOf(a))&&i.shapes.splice(n,1),a.material.instanceCount--,r.b._clearObject3D(a))):t instanceof ze.SectionEdgeShape?(this._sectionEdgeContainer.remove(a),r.b._clearObject3D(a)):t instanceof ze.SectionCapShape&&(this._sectionFaceContainer.remove(a),r.b._clearObject3D(a)))},ur.prototype.unloadObject=function(e){if("Part"===e.type||"Body"===e.type){e.isLoaded=!1;var t=e;if(e.shapes){for(var n=e.shapes.length-1;n>-1;--n){var i=t.shapes[n];this.removeShape(t,i)}if(e.frames)for(n=e.frames.length-1;n>-1;--n){i=e.frames[n];this.removeShape(t,i)}var a;if(this._edgeCache)this._edgeCache.removeInstance(t,function(e){e.edgesLoaded=!1,e.areEdgesVisible=!1});else(a=this._edgeContainer.getShapes(t))&&0!==a.length||(t.edgesLoaded=!1,t.areEdgesVisible=!1);if(this._vertexCache)this._vertexCache.removeInstance(t,function(e){e.areVerticesVisible=!1});else(a=this._vertexContainer.getShapes(t))&&0!==a.length||(t.areVerticesVisible=!1);if(this._shapeCache)this._shapeCache.removeInstance(t,function(e){e.shapesLoaded=!1});else(a=this._shapeContainer.getShapes(t))&&0!==a.length||(t.shapesLoaded=!1)}if(e.bodies){for(var o in e.bodies)if(e.bodies[o]){var s=e.bodies[o];s.manifoldEdgeMap&&delete s.manifoldEdgeMap,delete e.bodies[o]}delete e.bodies}if(e.wireframes&&(this.setWireframes(e,!1,e.wirefameColor),delete e.wirefameColor,delete e.wireframeVisible,delete e.wireframes),delete e.shapes,delete e.edges,delete e.vertices,delete e.frames,delete e.faces,delete e.sectionEdges,e.children&&e.children.length>0)for(n=e.children.length-1;n>-1;--n)this.unloadObject(e.children[n]);for(;r.b._notNullOrUndefined(e.children)&&e.children.length>0;){var l=e.children[0];e.remove(l),this.octree.remove(l),r.b._clearObject3D(l)}this.onLoadChanged(e)}else if(e.children&&e.children.length>0)for(n=e.children.length-1;n>-1;--n)this.unloadObject(e.children[n])},ur.prototype.getEdges=function(e,t,n){for(var r=0,i=t.length;r<i;r++){var a=t[r],o=e.faces[a];if(o){var s=o.parent.geometry.xtBodies;a=o.face.faceId;if(s)for(var l=0,c=s.length;l<c;l++){var u=s[l];if(u.bodyId===o.face.bodyId){var h=u.manifoldEdgeMap;for(var d in h)if(h.hasOwnProperty(d)){var p=h[d];if(p.f1===a||p.f2===a)n.indexOf(d)<0&&n.push(d)}}}}}};var hr=function(e,t){var n=e.faces.indexOf(t);n>=0&&e.faces.splice(n,1)},dr=function(e,t){for(var n=0,r=e.xtBodies.length;n<r;n++){var i=e.xtBodies[n];if(i.bodyId===t)return i}return null},pr=function(e,t,n){var r=n.faceId,i=dr(t.parent,e.bodyId);if(e.faces.indexOf(n)<0&&e.faces.push(n),i){delete e.faceEdgeMap;var a=e.manifoldEdgeMap,o=i.manifoldEdgeMap;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];l.f1!==r&&l.f2!==r||(a[s]||e.manifoldEdgeMapSize++,a[s]=l)}}},fr=function(e,t,n){for(var r=null,i=null,a=null,o=0,s=e.length;o<s;o++)for(var l=e[o],c=0,u=l.groups.length;c<u;c++){if((h=l.groups[c])&&h.face&&h.face.faceId===n){l.groups.splice(c,1),0===l.groups.length&&e.splice(o,1),i=t[(r=h).materialIndex],a=l;break}}if(a)for(c=0,u=a.groups.length;c<u;c++){var h;(h=a.groups[c]).index=c}return r?{geometry:a,group:r,material:i}:null},mr=function(e,t,n,r,i,a){if(0!==t.length)for(var o=t[0].parent,s=o.attributes.position.array,l=o.attributes.normal.array,c=o.index.array,u={},h=0,d=t.length;h<d;h++,a.groupIndex++){for(var p=t[h],f=p.start,m=p.start+p.count;f<m;f++){var g=c[f],v=u[g];if(void 0===v){v=a.index,u[g]=v;var y=3*g;n.push(s[y+0]),n.push(s[y+1]),n.push(s[y+2]),r.push(l[y+0]),r.push(l[y+1]),r.push(l[y+2]),a.index++}i.push(v)}p.start=a.start,p.index=a.groupIndex,p.face.groupIndex=a.groupIndex,p.face.start=a.start,p.face.count=p.count,e.groups.push(p),p.parent=e,a.start+=p.count}},gr=function(e){var t=[],n=[],r=[],i={start:0,groupIndex:0,index:0},a=e.dstGeometry;a.groups=[],mr(a,e.dstGroups,t,n,r,i),mr(a,e.srcGroups,t,n,r,i),a.boundingBox=null,a.boundingSphere=null,a.attributes.position.array=new Float32Array(t),a.attributes.normal.array=new Float32Array(n),a.index.array=new Uint16Array(r),a.attributes.position.count=t.length/3,a.attributes.normal.count=n.length/3,a.index.count=r.length,a.attributes.position.needsUpdate=!0,a.attributes.normal.needsUpdate=!0,a.index.needsUpdate=!0},vr=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t};function _defineGeometry(e){var t=null;return e.hasVertexColors?(t=new ze.InstancedVertexColorBufferGeometry,r.b._isNumber(e.drawMode)&&e.drawMode>-1&&e.drawMode<3&&(t.drawMode=e.drawMode)):6===e.geometryType?t=new rr:1===e.geometryType?t=new ze.InstancedLineBufferGeometry:(t=new ze.InstancedMeshBufferGeometry,r.b._isNumber(e.drawMode)&&e.drawMode>-1&&e.drawMode<3&&(t.drawMode=e.drawMode)),t}function _partBufferToBodyBuffers(e){var t=null;if(1===e.xtBodies.length)(t=e.xtBodies[0]).drawMode=e.drawMode,t.geometryType=e.geometryType,r.b._notNullOrUndefined(e.materialIndexBuffer)&&(t.materialIndexBuffer=e.materialIndexBuffer,e.materialIndexBuffer=null,delete e.materialIndexBuffer),r.b._notNullOrUndefined(e.groupStartBuffer)&&(t.groupStartBuffer=e.groupStartBuffer,e.groupStartBuffer=null,delete e.groupStartBuffer),r.b._notNullOrUndefined(e.groupCountBuffer)&&(t.groupCountBuffer=e.groupCountBuffer,e.groupCountBuffer=null,delete e.groupCountBuffer),r.b._notNullOrUndefined(e.vertexBuffer)&&(t.vertexBuffer=e.vertexBuffer,e.vertexBuffer=null,delete e.vertexBuffer),r.b._notNullOrUndefined(e.indexBuffer)&&(t.indexBuffer=e.indexBuffer,e.indexBuffer=null,delete e.indexBuffer),r.b._notNullOrUndefined(e.normalBuffer)&&(t.normalBuffer=e.normalBuffer,e.normalBuffer=null,delete e.normalBuffer),r.b._notNullOrUndefined(e.vertexColorBuffer)&&(t.vertexColorBuffer=e.vertexColorBuffer,e.vertexColorBuffer=null,delete e.vertexColorBuffer),r.b._notNullOrUndefined(e.uvCoordinatesBuffer)&&(t.uvCoordinatesBuffer=e.uvCoordinatesBuffer,e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer),e.hasVertexColors&&(t.hasVertexColors=!0,delete e.hasVertexColors),e.hasTextureUVs&&(t.hasTextureUVs=!0,delete e.hasTextureUVs),delete e.drawMode,delete e.geometryType;else{for(var n=0,i=0,a=e.xtBodies.length;i<a;i++){(t=e.xtBodies[i]).drawMode=e.drawMode,t.geometryType=e.geometryType;for(var o,s=0,l=t.faces[0].start,c=n,u=0,h=t.faces.length;u<h;u++)(o=t.faces[u]).start-=l,o.groupIndex=u,s+=o.count,e.groupStartBuffer[n]-=l,n++;t.groupStartBuffer=e.groupStartBuffer.slice(c,n),t.groupCountBuffer=e.groupCountBuffer.slice(c,n),t.materialIndexBuffer=e.materialIndexBuffer.slice(c,n);var d,p=e.indexBuffer[l];d=l+s===e.indexBuffer.length?e.indexBuffer.length:e.indexBuffer[l+s],t.indexBuffer=e.indexBuffer.slice(l,l+s);for(var f=t.indexBuffer[0],m=0;m<t.indexBuffer.length;m++)t.indexBuffer[m]=t.indexBuffer[m]-f;r.b._notNullOrUndefined(e.vertexBuffer)&&(t.vertexBuffer=e.vertexBuffer.slice(3*p,3*d)),r.b._notNullOrUndefined(e.normalBuffer)&&(t.normalBuffer=e.normalBuffer.slice(3*p,3*d)),r.b._notNullOrUndefined(e.vertexColorBuffer)&&(t.vertexColorBuffer=e.vertexColorBuffer.slice(3*p,3*d)),r.b._notNullOrUndefined(e.uvCoordinatesBuffer)&&(t.uvCoordinatesBuffer=e.uvCoordinatesBuffer.slice(2*p,2*d))}r.b._notNullOrUndefined(e.materialIndexBuffer)&&(e.materialIndexBuffer=null,delete e.materialIndexBuffer),r.b._notNullOrUndefined(e.groupStartBuffer)&&(e.groupStartBuffer=null,delete e.groupStartBuffer),r.b._notNullOrUndefined(e.groupCountBuffer)&&(e.groupCountBuffer=null,delete e.groupCountBuffer),r.b._notNullOrUndefined(e.vertexBuffer)&&(e.vertexBuffer=null,delete e.vertexBuffer),r.b._notNullOrUndefined(e.indexBuffer)&&(e.indexBuffer=null,delete e.indexBuffer),r.b._notNullOrUndefined(e.normalBuffer)&&(e.normalBuffer=null,delete e.normalBuffer),r.b._notNullOrUndefined(e.vertexColorBuffer)&&(e.vertexColorBuffer=null,delete e.vertexColorBuffer,delete e.hasVertexColors),r.b._notNullOrUndefined(e.uvCoordinatesBuffer)&&(e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer,delete e.hasTextureUVs),delete e.drawMode,delete e.geometryType}}function _processXTBodyBuffer(e,t){var n=_defineGeometry(e);n.xtBodies=[e];for(var i=0,a=e.faces.length;i<a;i++){var o=e.materialIndexBuffer[i];o>=0&&(o+=6),n.addGroup(e.groupStartBuffer[i],e.groupCountBuffer[i],o),n.groups[i].face=e.faces[i]}e.materialIndexBuffer=null,e.groupStartBuffer=null,e.groupCountBuffer=null,delete e.materialIndexBuffer,delete e.groupStartBuffer,delete e.groupCountBuffer,6===e.geometryType?(n.setPositions(e.vertexBuffer),e.vertexBuffer=null,delete e.vertexBuffer):(n.addAttribute("position",new _.BufferAttribute(e.vertexBuffer,3)),e.vertexBuffer=null,delete e.vertexBuffer,n.setIndex(new _.BufferAttribute(e.indexBuffer,1)),e.indexBuffer=null,delete e.indexBuffer,1===e.geometryType&&(n.isLines=!0),r.b._notNullOrUndefined(e.normalBuffer)&&(n.addAttribute("normal",new _.BufferAttribute(e.normalBuffer,3)),e.normalBuffer=null,delete e.normalBuffer),e.hasVertexColors&&(n.addAttribute("color",new _.BufferAttribute(e.vertexColorBuffer,3)),e.vertexColorBuffer=null,delete e.vertexColorBuffer,delete e.hasVertexColors),e.hasTextureUVs&&(n.addAttribute("uv",new _.BufferAttribute(e.uvCoordinatesBuffer,2)),e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer,delete e.hasTextureUVs)),t.push(n),e=null}function _processNoXTBuffer(e,t){for(var n=_defineGeometry(e),i=0,a=e.groupStartBuffer.length;i<a;++i){var o=e.materialIndexBuffer[i];o>=0&&(o+=6),n.addGroup(e.groupStartBuffer[i],e.groupCountBuffer[i],o)}e.materialIndexBuffer=null,e.groupStartBuffer=null,e.groupCountBuffer=null,delete e.materialIndexBuffer,delete e.groupStartBuffer,delete e.groupCountBuffer,6===e.geometryType?(n.setPositions(e.vertexBuffer),e.vertexBuffer=null,delete e.vertexBuffer):(n.addAttribute("position",new _.BufferAttribute(e.vertexBuffer,3)),e.vertexBuffer=null,delete e.vertexBuffer,n.setIndex(new _.BufferAttribute(e.indexBuffer,1)),e.indexBuffer=null,delete e.indexBuffer,1===e.geometryType&&(n.isLines=!0),r.b._notNullOrUndefined(e.normalBuffer)&&(n.addAttribute("normal",new _.BufferAttribute(e.normalBuffer,3)),e.normalBuffer=null,delete e.normalBuffer),e.hasVertexColors&&(n.addAttribute("color",new _.BufferAttribute(e.vertexColorBuffer,3)),e.vertexColorBuffer=null,delete e.vertexColorBuffer,delete e.hasVertexColors),e.hasTextureUVs&&(n.addAttribute("uv",new _.BufferAttribute(e.uvCoordinatesBuffer,2)),e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer,delete e.hasTextureUVs)),t.push(n),e=null}ur.prototype.deleteEdges=function(e,t,n){var r=n.parent.geometry.xtBodies,i=n.face.faceId;if(r)for(var a=0,o=r.length;a<o;a++){var s=r[a];if(s.bodyId===n.face.bodyId){var l=s.manifoldEdgeMap;for(var c in delete s.faceEdgeMap,l)if(l.hasOwnProperty(c)){var u=l[c];if((u.f1===i||u.f2===i)&&void 0!==e.edges&&null!==e.edges){var h=e.edges[c];if(h){delete l[c],s.manifoldEdgeMapSize--,delete e.edges[c],this.removeShape(t,h);var d=e.shapes.indexOf(h);d>=0&&e.shapes.splice(d,1)}}}}}},ur.prototype.deleteFaces=function(e,t){for(var n=e,r={},i=0,a=t.length;i<a;i++){var o=t[i],s=e.faces[o];if(s){var l=dr(s.parent.geometry,s.face.bodyId);l&&hr(l,s.face),delete e.faces[o],this.deleteEdges(e,n,s);var c=s.original.index,u=s.parent.geometry;if(u){u.groups=s.parent.groups;var h=u.groups;h.splice(c,1);for(var d=0,p=h.length;d<p;d++)u.groups[d].original.index=d;if(0===h.length){var f=e.shapes.indexOf(s.parent);f>=0&&(this.removeShape(n,s.parent),e.shapes.splice(f,1),delete r[s.parent.id])}else r[s.parent.id]=s.parent}}}for(var m in r)if(r.hasOwnProperty(m)){var g=r[m];this.octree.updateObject(g)}},ur.prototype.modifyFaces=function(e,t,n,r){for(var i=e,a={},o={},s=0,l=t.length;s<l;s++){var c=t[s],u=e.faces[c];if(u){this.deleteEdges(e,i,u);var h=u.original,d=u.parent.geometry;if(d){if(!(_=a[d.id])){_={dstCount:0,dstGeometry:d,dstGroups:[],srcCount:0,srcGroups:[]};for(var p=u.parent.groups,f=0,m=p.length;f<m;f++)_.dstGroups.push(p[f].original),_.dstCount+=p[f].count;a[d.id]=_}var g=_.dstGroups.indexOf(h);g>=0&&(_.dstGroups.splice(g,1),_.dstCount-=h.count);var v=fr(n,r,c);if(v){var y=v.group,b=dr(d,u.face.bodyId);b&&pr(b,y,u.face),_.srcGeometry=v.geometry,_.srcCount+=y.count,h.start=y.start,h.count=y.count,h.parent=y.parent,_.srcGroups.push(h)}o[u.parent.id]=u.parent}}}for(var x in a)if(a.hasOwnProperty(x)){var _=a[x];gr(_)}for(var x in o)if(o.hasOwnProperty(x)){var w=o[x];this.octree.updateObject(w)}},ur.prototype.addFaces=function(e,t,n,r,i){var a=function(e,t){for(var n=0,r=e.shapes.length;n<r;n++){var i=e.shapes[n];if(i instanceof ze.PartShape){var a=dr(i.geometry,t);if(a)return{shape:i,body:a}}}return null}(e,t);if(a){for(var o=a.shape,s=a.body,l=o.geometry,c=[],u=0,h=n.length;u<h;u++){var d=n[u],p=fr(r,i,d);p&&(c.push(p.group),o.addFace(p.group,p.material),pr(s,p.group,p.group.face))}if(0==c.length)return;var f={start:l.index.array.length,groupIndex:l.groups.length,index:l.attributes.position.array.length/3},m=vr(l.attributes.position.array),g=vr(l.attributes.normal.array),v=vr(l.index.array);mr(l,c,m,g,v,f),l.boundingBox=null,l.boundingSphere=null,l.attributes.position.array=new Float32Array(m),l.attributes.normal.array=new Float32Array(g),l.index.array=new Uint16Array(v),l.attributes.position.count=m.length/3,l.attributes.normal.count=g.length/3,l.index.count=v.length,l.attributes.position.needsUpdate=!0,l.attributes.normal.needsUpdate=!0,l.index.needsUpdate=!0}},ur.prototype.clearSectionShapes=function(e){if(e.sectionEdges&&e.sectionEdges.length>0){for(var t=0,n=e.shapes.length;t<n;t++){var i=e.shapes[t];i instanceof ze.SectionEdgeShape&&(this._sectionEdgeContainer.remove(i.original),r.b._clearObject3D(i.original),e.shapes.splice(t,1),n--,t--,this.octree.remove(i))}delete e.sectionEdges}if(e.sectionCaps&&e.sectionCaps.length>0){for(t=0,n=e.shapes.length;t<n;t++){var a=e.shapes[t];a instanceof ze.SectionCapShape&&(this._sectionFaceContainer.remove(a.original),r.b._clearObject3D(a.original),e.shapes.splice(t,1),n--,t--,this.octree.remove(a))}delete e.sectionCaps}},ur.prototype.addSectionEdges=function(e,t,n,i,a,o){for(var s=r.b._cloneMultiMaterial(this._sectionLineMaterial),l=0,c=a.length;l<c;l++){var u=a[l],h=new ze.InstancedBufferGeometry;if(h.addGroup(0,u.length,2),h.addAttribute("position",new _.BufferAttribute(new Float32Array(u),3)),this.hasBothSectionSide){var d=t.diffuseColor;(s=r.b._cloneMultiMaterial(s))[2].color=d}var p=new _.LineSegments(h,s);p.applyMatrix(e.matrixWorld),this._sectionEdgeContainer.add(p);var f=e.addSectionEdge(t,p,n,i);f.planeId=o,this.octree.add(f)}},ur.prototype.addSectionCaps=function(e,t,n,a,o,s){n.holeVertices=[],a.forEach(function(e){n.holeVertices.push(e.vertices.reverse())});var l=r.b._vector3ToVector2(n.vertices,o.normal);if(l.length<=2)sr(i.b.stringsByLabel.SCENE_LOGGER_insufficientVertices+e.name);else{var c,u,h=new _.Shape(l),d=[];a.forEach(function(e,t){u=r.b._vector3ToVector2(e.vertices,o.normal),c=new _.Path(u),d[t]=c}),h.holes=d;var p,f=h.extractPoints(),m=f.shape,g=f.holes;_.ShapeUtils.isClockWise(m)||(m.reverse(),n.vertices.reverse());for(var v=0,y=g.length;v<y;v++)p=g[v],_.ShapeUtils.isClockWise(p)&&(p.reverse(),n.holeVertices[v].reverse()),Array.prototype.push.apply(n.vertices,n.holeVertices[v]);var b=r.b._earcutTriangulation(m,g);for(v=0;v<b.length;v++)n.faces.push(new _.Face3(b[v][0],b[v][1],b[v][2],void 0,t.diffuse,2));n.computeBoundingSphere(),n.computeFaceNormals();var x,w=[this._sectionCapSelectionMaterial,this._sectionCapHighlightMaterial];this._sectionCapMaterial.enabled?(x={diffuse:this._sectionCapMaterial.userCapColor.diffuse,emissive:this._sectionCapMaterial.userCapColor.emissive,specular:this._sectionCapMaterial.userCapColor.specular,shininess:this._sectionCapMaterial.userCapColor.shininess,opacity:this._sectionCapMaterial.userCapColor.opacity},this._sectionCapMaterial.userCapColor.reflectivity&&(x.reflectivity=this._sectionCapMaterial.userCapColor.reflectivity)):(x={diffuse:t.diffuse.getHex(),emissive:t.emissive.getHex(),specular:t.specular.getHex(),shininess:t.shininess,opacity:t.opacity},t.reflectivity&&(x.reflectivity=t.reflectivity)),w.push(r.b._createMeshMaterial(x,!1,!0)),t.envMap&&(w[2].uniforms.envMap.value=t.envMap,w[2].envMap=t.envMap),w[2].side=_.DoubleSide;var M=w;(h=new _.Mesh((new ze.InstancedBufferGeometry).fromGeometry(n),M)).applyMatrix(e.matrixWorld),this._sectionFaceContainer.add(h);var E=e.addSectionCap(h,o);E.faces=n.faces,E.planeId=s,this.octree.add(E)}},ur.prototype.processMaterial=function(e,t,n){e.wideline?t[6]=r.b._createWideLineMaterial(e,!0,!0):t[6]=r.b._createMeshMaterial(e,!0,!0),n&&n()},ur.prototype.processGeometry=function(e,t,n){for(var i=null,a=0,o=e.length;a<o;++a)if(i=e[a],r.b._notNullOrUndefined(i.xtBodies)){r.b._isNullOrUndefined(i.bufferPerBody)&&(_partBufferToBodyBuffers(i),i.bufferPerBody=!0);for(var s=0,l=i.xtBodies.length;s<l;++s){_processXTBodyBuffer(i.xtBodies[s],t)}}else _processNoXTBuffer(i,t);e=null,n()},ur.prototype.setWireframes=function(e,t,n){if(e.wireframeVisible!==t){if(!0===t&&void 0===e.wireframes){e.wireframes=[];var i=e.shapes,a=null,o=null,s=null;e.wirefameColor=n;var l=r.b._createLineMaterial(n,1,2,!1,!0);for(var c in i)if(i.hasOwnProperty(c)){var u=i[c];u instanceof ze.PartShape&&(a=u.geometry,s=new _.WireframeGeometry(a),(o=new _.LineSegments(s,l)).applyMatrix(e.matrixWorld),this._wireframeContainer.add(o),e.wireframes.push(o),this.octree.add(e.addEdge({edgeId:"WireFrame"},o,!1)))}}var h=e.wireframes;for(var c in h)h.hasOwnProperty(c)&&(h[c].visible=t);return e.wireframeVisible=t,!0}return!1},ur.prototype.setHighlightingMaterial=function(e,t,n,i,a,o){var s={diffuse:e,ambient:t,emissive:n,specular:i,shininess:a,opacity:o};r.b._setMaterial(this._highlightMaterial,s),r.b._setMaterial(this._instancedHighlightMaterial,s),r.b._setMaterial(this._lineHighlightingMaterial,s),r.b._setMaterial(this._instancedLineHighlightingMaterial,s),this._pointsMaterial.uniforms.highlightColor.value.setHex(e),this._outlineHighlightMaterial.uniforms.diffuse.value.setHex(e),this._outlineHighlightMaterial.uniforms.opacity.value=o,this._instancedOutlineHighlightMaterial.uniforms.diffuse.value.setHex(e),this._instancedOutlineHighlightMaterial.uniforms.opacity.value=o},ur.prototype.setSelectionMaterial=function(e,t,n,i,a,o){var s={diffuse:e,ambient:t,emissive:n,specular:i,shininess:a,opacity:o};r.b._setMaterial(this._selectionMaterial,s),r.b._setMaterial(this._instancedSelectionMaterial,s),r.b._setMaterial(this._lineSelectionMaterial,s),r.b._setMaterial(this._instancedLineSelectionMaterial,s),this._pointsMaterial.uniforms.selectionColor.value.setHex(e),this._outlineSelectionMaterial.uniforms.diffuse.value.setHex(e),this._outlineSelectionMaterial.uniforms.opacity.value=o,this._instancedOutlineSelectionMaterial.uniforms.diffuse.value.setHex(e),this._instancedOutlineSelectionMaterial.uniforms.opacity.value=o},ur.prototype.getUserMaterial=function(e){return e.getUserMaterial()},ur.prototype.setUserMaterial=function(e,t,n){var i;i="Edge"===e.type?r.b._createLineMaterial(t.diffuse?t.diffuse:void 0,t.opacity?t.opacity:void 0,1,!0,!0):"Vertex"===e.type?r.b._createPointsMaterial(t.diffuse?t.diffuse:void 0,t.opacity?t.opacity:void 0,!0,!0):r.b._createMeshMaterial(t,!0,!0);try{void 0===t.emissive&&(i.uniforms.emissive=-1),void 0===t.diffuse&&(i.uniforms.diffuse=-1),void 0===t.specular&&(i.uniforms.specular=-1),void 0===t.shininess&&(i.uniforms.shininess=-1),void 0===t.opacity&&(i.uniforms.opacity=-1),i.depthTest=!!r.b._isNullOrUndefined(t.onTop)||!t.onTop,!1===i.depthTest&&"Edge"===e.type&&(i.transparent=!0),n?e.setOverwriteMaterial(i):e.setUserMaterial(i)}catch(e){ar("material.uniforms not defined in Scene.setUserMaterial")}},ur.prototype.resetUserMaterial=function(e){e.resetUserMaterial()};/* harmony default export */var yr=ur,br={
/** Start point of arrow */
ArrowHeadStart:"ArrowHeadStart",
/** Start point of arrow line */
ArrowLineStart:"ArrowLineStart",
/** End point of arrow line */
ArrowLineEnd:"ArrowLineEnd",
/** Start point of extension line */
ExtensionLineStart:"ExtensionLineStart",
/** Anchor point of extension line */
ExtensionLineAnchor:"ExtensionLineAnchor",
/** Start point of stub line */
StubLineStart:"StubLineStart",
/** End point of stub line */
StubLineEnd:"StubLineEnd",
/** Center point of text */
TextCenter:"TextCenter",
/** Start point of text */
TextStart:"TextStart"},xr={
/** Arrow of Dimension */
Arrow:"Arrow",
/** Arrow line of Dimension */
ArrowLine:"ArrowLine",
/** Primary extension line of Dimension */
ExtensionLinePrimary:"ExtensionLinePrimary",
/** Extension line gap of Dimension */
ExtensionLineGap:"ExtensionLineGap",
/** Secondary extension line of Dimension */
ExtensionLineSecondary:"ExtensionLineSecondary",
/** Stub line of Dimension */
StubLine:"StubLine",
/** Text of Dimension */
Text:"Text"},_r={
/** Side 1 of Dimension */
Side1:"Side1",
/** Side 2 of Dimension */
Side2:"Side2"},wr={
/** Solid line */
Solid:"Solid",
/** Dashed line */
Dashed:"Dashed"},Mr={
/** Center-Aligned Text */
Center:0,
/** Left-Aligned Text */
Left:1,
/** Right-Aligned Text */
Right:2,
/** No alignment */
Null:3},Er={
/** Over Text */
Over:0,
/** Aligned Text */
Aligned:1,
/** Perpendicular Text */
Perpendicular:2,
/** Horizontal Text */
Horizontal:3,
/** Vertical Text */
Vertical:4},Sr={computeTangents:function(e){var t=e.index,n=e.attributes;
// based on http://www.terathon.com/code/tangent.html
// (per vertex tangents)
if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var r=t.array,i=n.position.array,a=n.normal.array,o=n.uv.array,s=i.length/3;void 0===n.tangent&&e.addAttribute("tangent",new _.BufferAttribute(new Float32Array(4*s),4));for(var l=n.tangent.array,c=[],u=[],h=0;h<s;h++)c[h]=new _.Vector3,u[h]=new _.Vector3;var d=new _.Vector3,p=new _.Vector3,f=new _.Vector3,m=new _.Vector2,g=new _.Vector2,v=new _.Vector2,y=new _.Vector3,b=new _.Vector3,x=e.groups;0===x.length&&(x=[{start:0,count:r.length}]);h=0;for(var w=x.length;h<w;++h)for(var M=B=(O=x[h]).start,E=B+O.count;M<E;M+=3)handleTriangle(r[M+0],r[M+1],r[M+2]);var S,L,T,A=new _.Vector3,C=new _.Vector3,P=new _.Vector3,I=new _.Vector3;for(h=0,w=x.length;h<w;++h){var O,B;for(M=B=(O=x[h]).start,E=B+O.count;M<E;M+=3)handleVertex(r[M+0]),handleVertex(r[M+1]),handleVertex(r[M+2])}}else console.warn("BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function handleTriangle(e,t,n){d.fromArray(i,3*e),p.fromArray(i,3*t),f.fromArray(i,3*n),m.fromArray(o,2*e),g.fromArray(o,2*t),v.fromArray(o,2*n);var r=p.x-d.x,a=f.x-d.x,s=p.y-d.y,l=f.y-d.y,h=p.z-d.z,x=f.z-d.z,_=g.x-m.x,w=v.x-m.x,M=g.y-m.y,E=v.y-m.y,S=1/(_*E-w*M);y.set((E*r-M*a)*S,(E*s-M*l)*S,(E*h-M*x)*S),b.set((_*a-w*r)*S,(_*l-w*s)*S,(_*x-w*h)*S),c[e].add(y),c[t].add(y),c[n].add(y),u[e].add(b),u[t].add(b),u[n].add(b)}function handleVertex(e){P.fromArray(a,3*e),I.copy(P),L=c[e],
// Gram-Schmidt orthogonalize
A.copy(L),A.sub(P.multiplyScalar(P.dot(L))).normalize(),
// Calculate handedness
C.crossVectors(I,L),T=C.dot(u[e]),S=T<0?-1:1,l[4*e]=A.x,l[4*e+1]=A.y,l[4*e+2]=A.z,l[4*e+3]=S}},
/**
     * @param  {Array<BufferGeometry>} geometries
     * @return {BufferGeometry}
     */
mergeBufferGeometries:function(e,t){for(var n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=new _.BufferGeometry,l=0,c=0;c<e.length;++c){var u=e[c];
// ensure that all geometries are indexed, or none
if(n!==(null!==u.index))return null;
// gather attributes, exit early if they're different
for(var h in u.attributes){if(!r.has(h))return null;void 0===a[h]&&(a[h]=[]),a[h].push(u.attributes[h])}
// gather morph attributes, exit early if they're different
for(var h in u.morphAttributes){if(!i.has(h))return null;void 0===o[h]&&(o[h]=[]),o[h].push(u.morphAttributes[h])}
// gather .userData
if(s.userData.mergedUserData=s.userData.mergedUserData||[],s.userData.mergedUserData.push(u.userData),t){var d;if(n)d=u.index.count;else{if(void 0===u.attributes.position)return null;d=u.attributes.position.count}s.addGroup(l,d,c),l+=d}}
// merge indices
if(n){var p=0,f=[];for(c=0;c<e.length;++c){for(var m=e[c].index,g=0;g<m.count;++g)f.push(m.getX(g)+p);p+=e[c].attributes.position.count}s.setIndex(f)}
// merge attributes
for(var h in a){var v=this.mergeBufferAttributes(a[h]);if(!v)return null;s.addAttribute(h,v)}
// merge morph attributes
for(var h in o){var y=o[h][0].length;if(0===y)break;s.morphAttributes=s.morphAttributes||{},s.morphAttributes[h]=[];for(c=0;c<y;++c){var b=[];for(g=0;g<o[h].length;++g)b.push(o[h][g][c]);var x=this.mergeBufferAttributes(b);if(!x)return null;s.morphAttributes[h].push(x)}}return s},
/**
     * @param {Array<BufferAttribute>} attributes
     * @return {BufferAttribute}
     */
mergeBufferAttributes:function(e){for(var t,n,r,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new _.BufferAttribute(s,n,r)}};
// CONCATENATED MODULE: ./staging/dimension/DimensionConstant.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
/**
 * Define the dimension control point types, work with DimensionSide enum to locate a specific control point.
 * @readonly
 * @enum {String}
 * @memberof PLMVisWeb
 */
/* harmony default export */var Lr=
// CONCATENATED MODULE: ./staging/dimension/DimensionComponent.js
function DimensionComponent(e,t){if(!xr.hasOwnProperty(e))throw new Error("Component type "+e+" is invalid.");if(t&&!_r.hasOwnProperty(t))throw new Error("Component side "+t+" is invalid.");this.componentType=e,this.side=t},Tr=r.b._createLineMaterial(0,1,1,!1,!1),Ar=new ct;
// CONCATENATED MODULE: ./staging/dimension/TextComponent.js
//Â© 2018 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var warning = Debug( "PLMVisWeb:warning:TextComponent" );
//Initialize global materials
/**
 * TextComponent to support dimension text
 * @private
 *
 * @param { string | array } text text to dispaly, could be string or array
 * @param { Object } material the dimension text material, optional.
 * @param { Object } options the dimension text options, optional.
 *                    { font }text font, valid font value range [1, 9]. Default is 1.
 */
function TextComponent(e,t,n){if(!e)throw new Error("Dimension text is undefined.");if(n.font&&"string"==typeof n.font)throw new Error("The font '"+n.font+"' was not loaded!");_.Object3D.call(this),Lr.call(this,xr.Text),t=t||Tr,
// Define properties
this._textValue=e,this.font=n.font||1,// Font: Documentation lists font values as 1-9.
this.isHollow=n.isHollow||!1,this.material=t,this.options={textDisplayHeight:20,lineFactor:.25,textOrientation:Er.Over,hasBorder:!1},n&&Object.assign(this.options,n),this._setText(e),this.type="TextComponent",
// Up vector and Right vector needed to correctly orient text flipping
this.up=new _.Vector3(0,1,0),this.right=new _.Vector3(1,0,0),this.add(this.textObject);var r=this.getTextScalar();this.matrix.scale(new _.Vector3(r,r,r)),this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0),
// auxiliary properties to help calculate text start point
// the initial text start point located at the center of left boundingBox border
this.flipX=this.flipY=this.flipXY=!1}function _createFontGeometry(e,t,n){var r,i=e.generateShapes(t,1);
//create mesh geometry
return(r=n?function _createHollowTextGeometry(e){var t=[];e.length>0&&e.forEach(e=>{e.holes&&e.holes.length>0&&e.holes.forEach(e=>{t.push(e)})});e.push.apply(e,t);var n=[],r=0,i=[];e.forEach(e=>{for(var t=e.getPoints(),a=0;a<t.length;a++)i.push(t[a].x,t[a].y,0),a<t.length-1&&n.push(r,r+1),r++});var a=new _.BufferGeometry;return a.setIndex(new _.BufferAttribute(new Uint16Array(n),1)),a.addAttribute("position",new _.BufferAttribute(new Float32Array(i),3)),a}(i):new _.ShapeBufferGeometry(i)).center(),r.computeBoundingBox(),r}function getBorderGeometry(e){var t=e.boundingBox,n=t.max,r=t.min,i=new Float32Array(12);i[0]=n.x,i[1]=n.y,i[2]=0,i[3]=r.x,i[4]=n.y,i[5]=0,i[6]=r.x,i[7]=r.y,i[8]=0,i[9]=n.x,i[10]=r.y,i[11]=0;var a=new _.BufferGeometry;return a.addAttribute("position",new _.BufferAttribute(i,3)),a.setIndex(new _.BufferAttribute(new Uint16Array([0,1,1,2,2,3,3,0]),1)),a}
/* harmony default export */TextComponent.prototype=Object.create(_.Object3D.prototype),TextComponent.prototype.constructor=TextComponent,Object.defineProperties(TextComponent.prototype,{hasBorder:{get:function(){return this.options.hasBorder},set:function(e){this.options.hasBorder&&!e?this.textObject.geometry=this.textObject.geometries.textGeometry:!this.options.hasBorder&&e&&(this.textObject.geometry=this.textObject.geometries.wholeGeometry),this.options.hasBorder=e}},textValue:{get:function(){return this._textValue},set:function(e){e&&this._textValue!==e&&this._setText(e)}},
// define origin for reuse getScale function in DimensionObject
origin:{get:function(){var e=new _.Vector3;return this.textObject&&this.textObject.geometry.boundingBox&&(this.textObject.geometry.boundingBox.getCenter(e),e.applyMatrix4(this.matrixWorld)),e}}}),
/**
 * Get local dimension text size
 */
TextComponent.prototype.getTextSize=function(){var e=this.textObject.geometry.boundingBox,t=e.max.y-e.min.y,n=t;if(this._textValue instanceof Array){var r=this._textValue.length;
// subtract paddings
n=(n-this.options.lineFactor*(r-1))/r}return{width:e.max.x-e.min.x,height:n,totalHeight:t}},
/**
 * Get the scale real size to display size
 */
TextComponent.prototype.getTextScalar=function(){return this.options.textDisplayHeight*this.options.textScalar/this.getTextSize().height},TextComponent.prototype._setText=function(e){if(e){if(e instanceof Array)for(var t=e.length-1;t>0&&0===e[t].length;t--)e.splice(t);if("Font"===this.font.type){var n=function _createFontTextGeometry(e,t,n){var r;if(e instanceof Array){var i=0;e.forEach(e=>{var a=_createFontGeometry(t,e,n),o=a.boundingBox,s=o.max.y-o.min.y;a.translate(0,-i*(s+.25),0),r=r?Sr.mergeBufferGeometries([r,a],!0):a,i++}),i&&(r.center(),r.computeBoundingBox())}else r=_createFontGeometry(t,e,n);
//create border geometry
var a=getBorderGeometry(r),o=Sr.mergeBufferGeometries([r,a],!0);return a.center(),o.center(),a.computeBoundingBox(),o.computeBoundingBox(),{textGeometry:r,borderGeometry:a,wholeGeometry:o}}(e,this.font,this.isHollow),r=this.hasBorder?n.wholeGeometry:n.textGeometry;this.isHollow?this.textObject&&this.textObject instanceof ze.PmiText?this.textObject.geometry=r:this.textObject=new ze.PmiText(r,this.material):this.textObject&&this.textObject instanceof _.Mesh?this.textObject.geometry=r:this.textObject=new _.Mesh(r,this.material),this.textObject.geometries=n}else{var i=function createTextGeometry(e,t,n,r){var i,a;if(e instanceof Array){var o=0,s=0;(i=new _.BufferGeometry).setIndex(new _.BufferAttribute(new Uint16Array(0),1)),i.addAttribute("position",new _.BufferAttribute(new Float32Array(0),3)),(a=new _.BufferGeometry).setIndex(new _.BufferAttribute(new Uint16Array(0),1)),a.addAttribute("position",new _.BufferAttribute(new Float32Array(0),3));for(var l=0;l<e.length;++l){var c=Ar.getString(e[l],t,n),u=c.geometry.boundingBox;
// For a new blank line, don't merge the border geometry
if(o=0===l?0:o+s+r,e[l].length>0){var h=getBorderGeometry(c.geometry);
// move to next line
h.translate(0,-o,0),a=Sr.mergeBufferGeometries([a,h],!0),
// lineHeight is different for each line
s=u.max.y-u.min.y}
// move to next line
c.geometry.translate(0,-o,0),i=Sr.mergeBufferGeometries([i,c.geometry],!0)}}else{var c=Ar.getString(e,t,n);i=c.geometry,a=getBorderGeometry(c.geometry)}
// get text with border box
var d=Sr.mergeBufferGeometries([i,a],!0);
// make sure center the geometry
// placed the geometry's center at the coordinate system's origin
return i.center(),a.center(),d.center(),
// computeBoundingBox should at the last phase
i.computeBoundingBox(),a.computeBoundingBox(),d.computeBoundingBox(),{textGeometry:i,borderGeometry:a,wholeGeometry:d}}(e,this.font,this.material,this.options.lineFactor),a=this.hasBorder?i.wholeGeometry:i.textGeometry;this.textObject&&this.textObject instanceof ze.PmiText?this.textObject.geometry=a:this.textObject=new ze.PmiText(a,this.material),this.textObject.geometries=i}this.updateMatrixWorld(!0),this._textValue=e}},TextComponent.prototype.raycast=function(){var e=new _.Vector3,t=new _.LineSegments,n=[];return function(r,i){var a=this.textObject.geometries.borderGeometry.boundingBox.clone();if(a.applyMatrix4(this.matrixWorld),r.ray.intersectBox(a,e)){var o={distance:r.ray.origin.distanceTo(e),point:e.clone(),object:this};i.push(o)}else t.geometry=this.textObject.geometries.borderGeometry,t.matrixWorld=this.matrixWorld,n.length=0,t.raycast(r,n),n.length>0&&(n[0].object=this,i.push(n[0]))}}();var Cr=TextComponent;
// CONCATENATED MODULE: ./staging/dimension/ArrowComponent.js
//import Debug from "debug";
//var warning = Debug( "PLMVisWeb:warning:ArrowComponent" );
/**
 * Create a dimension arrow.
 * @private
 *
 * @param {Number} length the arrow head length
 * @param {Number} angle the arrow head angle
 * @param {Object} material the material
 * @param {Object} side the arrow side
 */function ArrowComponent(e,t,n,r){Lr.call(this,xr.Arrow,r),this.arrowLength=e||1,this.arrowAngle=t||Math.PI/6;var i=new _.Vector3(1,0,0),a=this.arrowLength/Math.cos(this.arrowAngle/2),o=i.clone().setLength(a),s=new _.Vector3(0,0,1),l=this.arrowAngle/2,c=o.clone().applyAxisAngle(s,l),u=o.clone().applyAxisAngle(s,-l),h=[0,0,0,u.x,u.y,0,c.x,c.y,0],d=new _.BufferGeometry;d.addAttribute("position",new _.BufferAttribute(new Float32Array(h),3)),_.Mesh.call(this,d,n)}ArrowComponent.prototype=Object.create(_.Mesh.prototype),ArrowComponent.prototype.constructor=ArrowComponent,ArrowComponent.prototype.flipArrow=function(){var e=new _.Matrix4,t=(new _.Matrix4).makeRotationZ(Math.PI),n=new _.Matrix4;return function(){e.setPosition(this.position),n.setPosition(this.position.negate()),this.applyMatrix(n),this.applyMatrix(t),this.applyMatrix(e)}}();
/* harmony default export */var Pr=ArrowComponent,Ir=r.b._createLineMaterial(0,1,1,!1,!1),Or=6,Br={primaryLine:[3,2],inverseLine:[0,1]};
// CONCATENATED MODULE: ./staging/dimension/LineComponent.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var warning = Debug( "PLMVisWeb:warning:LineComponent" );
//Initialize global materials
function LineComponent(e,t,n,r,i,a){Lr.call(this,i,a),(n=n||Ir).side=_.DoubleSide,this.originalStartPt=e,this.originalEndPt=t,
// get options
r=r||{},this.inverseLineLength=r.inverseLineLength||Or,this.currentInverseLineLength=this.inverseLineLength,this._isInverse=r.isInverse,this._startPtOffset=0,this._endPtOffset=0,this.direction=t.clone().sub(e),this.length=this.direction.length(),this.direction.normalize(),this.originalLength=this.length;var o=this.direction.clone().setLength(this.inverseLineLength),s=t.clone().add(o),l=this._isInverse?Br.inverseLine:Br.primaryLine,c=[].concat(s.toArray()).concat(t.toArray()).concat(t.toArray()).concat(e.toArray()),u=new _.BufferGeometry;u.setIndex(new _.BufferAttribute(new Uint16Array(l),1)),u.addAttribute("position",new _.BufferAttribute(new Float32Array(c),3)),_.LineSegments.call(this,u,n),
// Update World Matrix
this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0)}
// Arrow Line Component
function ArrowLineComponent(e,t,n,r,i,a){
// options:
//    isInverse - is inverse
//    inverseLineLength - length of inverse line
//    arrowLength - arrow length
//    arrowDegree - arrow degree
LineComponent.call(this,e,t,n,r,i,a),this.arrow=new Pr(r.arrowLength,r.arrowDegree,n,a),this.add(this.arrow);var o=(new _.Vector3).subVectors(t,e).normalize(),s=(new _.Quaternion).setFromUnitVectors(new _.Vector3(1,0,0),o),l=(new _.Matrix4).makeRotationFromQuaternion(s),c=(new _.Matrix4).makeRotationZ(Math.PI);r.isInverse||this.arrow.applyMatrix(c),this.arrow.applyMatrix(l),this.arrow.applyMatrix((new _.Matrix4).setPosition(t)),this.arrow.updateMatrixWorld(!0)}LineComponent.prototype=Object.create(_.LineSegments.prototype),LineComponent.prototype.constructor=LineComponent,LineComponent.prototype.updateBounding=function(){this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},
// set the length of primary line
LineComponent.prototype.setPrimaryLineLength=function(e,t){var n=this.direction.clone().multiplyScalar(e).toArray();t?(this.startPt=this.originalStartPt.toArray(),this.endPt=r.b._addArrayVectors(this.startPt,n)):(this.endPt=this.originalEndPt.toArray(),this.startPt=r.b._subArrayVectors(this.endPt,n)),this.length=e,this.updateBounding()},
// set the length of inverse line
LineComponent.prototype.setInverseLineLength=function(e,t){if(!(0===this.currentInverseLineLength&&e<=0)){var n=this.direction.clone().multiplyScalar(e).toArray();e=Math.max(e,0),t?(this.inverseLineStartPt=r.b._addArrayVectors(this.originalEndPt.toArray(),this.direction.clone().multiplyScalar(this.inverseLineLength).toArray()),this.inverseLineEndPt=r.b._subArrayVectors(this.inverseLineStartPt,n)):(this.inverseLineEndPt=this.originalEndPt.toArray(),this.inverseLineStartPt=r.b._addArrayVectors(this.inverseLineEndPt,n)),this.currentInverseLineLength=e,this.updateBounding()}},
// rotate the whole line for 180 degree so it is different with flipArrow
LineComponent.prototype.reverse=function(){var e=(new _.Matrix4).makeRotationZ(Math.PI),t=new _.Matrix4,n=new _.Matrix4,r=new _.Vector3;return function(){r.fromArray(this.inverseLineEndPt).applyMatrix4(this.matrix),t.setPosition(r),n.setPosition(r.negate()),this.applyMatrix(n),this.applyMatrix(e),this.applyMatrix(t)}}(),
/**
 * relocate the line segment by specify the endpoints' offsets .
 *
 * */
LineComponent.prototype.relocate=function(e,t){var n=e&&e.length()>0,i=t&&t.length()>0;if(n||i){var a=this.direction.clone();
// relocate start point
n&&(this.startPt=r.b._addArrayVectors(this.startPt,e.toArray()),this.originalStartPt=(new _.Vector3).fromArray(this.startPt)),
// relocate end point, also will change the inverse line end point
i&&(this.endPt=r.b._addArrayVectors(this.endPt,t.toArray()),this.inverseLineEndPt=this.endPt,this.originalEndPt=(new _.Vector3).fromArray(this.endPt));var o=(new _.Vector3).fromArray(r.b._subArrayVectors(this.endPt,this.startPt));return this.length=o.length(),this.direction=o.normalize(),
// relocate inverse line start point
this.inverseLineStart=r.b._subArrayVectors(this.inverseLineEndPt,this.direction.clone().multiplyScalar(this.inverseLineLength).toArray()),this.updateBounding(),a}},LineComponent.prototype.getControlPoint=function(){var e=new _.Vector3;return function(t,n){var r=null;switch(t){case br.ArrowLineStart:case br.StubLineStart:r=this.startPt;break;case br.ArrowLineEnd:r=this.inverseLineEndPt;break;case br.StubLineEnd:r=this.endPt}return r&&n&&(r=e.fromArray(r).applyMatrix4(this.matrixWorld).toArray()),r}}(),Object.defineProperties(LineComponent.prototype,{flipped:{get:function(){return this._isInverse},set:function(e){if(this._isInverse!==e){this._isInverse=e;var t=this._isInverse?Br.inverseLine:Br.primaryLine;this.geometry.setIndex(new _.BufferAttribute(new Uint16Array(t),1)),this.updateBounding()}}},inverseLineStartPt:{get:function(){var e=this.geometry.attributes.position.array;return[e[0],e[1],e[2]]},set:function(e){r.b._updatePositionFromArray(this.geometry.attributes.position,e,0)}},inverseLineEndPt:{get:function(){var e=this.geometry.attributes.position.array;return[e[3],e[4],e[5]]},set:function(e){r.b._updatePositionFromArray(this.geometry.attributes.position,e,1)}},endPt:{get:function(){var e=this.geometry.attributes.position.array;return[e[6],e[7],e[8]]},set:function(e){r.b._updatePositionFromArray(this.geometry.attributes.position,e,2)}},startPt:{get:function(){var e=this.geometry.attributes.position.array;return[e[9],e[10],e[11]]},set:function(e){r.b._updatePositionFromArray(this.geometry.attributes.position,e,3)}}}),ArrowLineComponent.prototype=Object.create(LineComponent.prototype),ArrowLineComponent.prototype.constructor=ArrowLineComponent,ArrowLineComponent.prototype.flipArrow=function(){this.flipped=!this.flipped,this.arrow.flipArrow()},ArrowLineComponent.prototype.setMaterial=function(e){this.material=e,this.arrow.material=e},ArrowLineComponent.prototype.relocateArrowLine=function(){var e=new _.Quaternion,t=new _.Matrix4,n=new _.Matrix4,r=new _.Matrix4,i=new _.Vector3;return function(a,o){var s=this.relocate(a,o);s&&(e.setFromUnitVectors(s,this.direction),t.makeRotationFromQuaternion(e),r.setPosition(this.arrow.position),n.setPosition(i.fromArray(this.endPt)),this.arrow.applyMatrix(r),this.arrow.applyMatrix(t),this.arrow.applyMatrix(n),this.arrow.updateMatrixWorld(!0))}}(),ArrowLineComponent.prototype.getControlPoint=function(){var e=new _.Vector3;return function(t,n){var r=null;switch(t){case br.ArrowLineStart:case br.ArrowLineEnd:r=LineComponent.prototype.getControlPoint.call(this,t,n);break;case br.ArrowHeadStart:e.set(this.arrow.arrowLength,0,0).applyMatrix4(this.arrow.matrix),r=n?e.applyMatrix4(this.matrixWorld).toArray():e.toArray()}return r}}();
// CONCATENATED MODULE: ./staging/dimension/DimensionObject.js
//Â© 2016 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var debug = Debug( "PLMVisWeb:debug:DimensionObject" );
//var error = Debug( "PLMVisWeb:error:DimensionObject" );
//error.enabled = true;
//var warning = Debug( "PLMVisWeb:warning:DimensionObject" );
var Rr=function(e){return Gr(e)===wr.Solid?e.uniforms.diffuse.value.getHex():e.color.getHex()},Gr=function(e){return e instanceof _.LineDashedMaterial?wr.Dashed:wr.Solid},Dr=function(e,t){if(this._materials[e]!==this._parent.defaultMaterial[e])!function(e,t){Gr(e)===wr.Solid?e.uniforms.diffuse.value.setHex(t):e.color.setHex(t)}(this._materials[e],t);else{var n=Gr(this._materials[e]);this._materials[e]=function(e,t,n){return t===wr.Dashed?new _.LineDashedMaterial({color:e,dashSize:.001,gapSize:.001}):r.b._createLineMaterial(e,1,n,!1,!1)}(t,n)}};function DimensionObject(e,t){if(!t||!t.text)throw new Error("Dimension text parameter is not specified.");this.enableScreenRelativeSize=!!t.options&&t.options.enableScreenRelativeSize,
//have to provide material here otherwise will throw a null error when adding to the scene
ze.GenericShape.call(this,null,null,m.A.Container),this.type="DimensionObj",this._parent=e,this._viewer=e._viewer,this._materials={},
// dimension origin
this.origin=new _.Vector3(0,0,0),
//TODO remove this property when dimension text position update rework is done
this.baselineLength=0,Object.assign(this._materials,this._parent.defaultMaterial),this.text3D=new Cr(t.text,this._materials.text,t.options),
// create dimension text component
this.add(this.text3D),this._selected=!1,this._highlighted=!1}DimensionObject.prototype=Object.create(ze.GenericShape.prototype),DimensionObject.prototype.constructor=DimensionObject,Object.defineProperties(DimensionObject.prototype,{textValue:{get:function(){return this.text3D.textValue},set:function(e){e&&e!==this.text3D.textValue&&(this.text3D.textValue=e,this.calculateTextPosition(),this.updateDimensionLine(),this._parent._updateModelBoundingBox(),this._viewer[Vp._render]())}},textDisplayHeight:{get:function(){return this.text3D.options.textDisplayHeight},set:function(e){var t=this.text3D;if(r.b._isNumber(e)){t.options.textDisplayHeight=e;var n=this.getTextScale()*this.text3D.getTextScalar();t.matrix.makeScale(n,n,n),this.calculateTextPosition(),this.updateDimensionLine(),this._parent._updateModelBoundingBox(),this._viewer[Vp._render]()}}},
//deprecated, use textDisplayHeight instead
textScalar:{get:function(){return this.text3D.options.textScalar},set:function(e){var t=this.text3D;r.b._isNumber(e)&&(t.options.textScalar=e,this.textDisplayHeight=this.textDisplayHeight)}},textOverFactor:{get:function(){return this.text3D.options.textOverFactor},set:function(e){var t=this.text3D;r.b._isNumber(e)&&(t.options.textOverFactor=e,t.options.textOrientation===Er.Over&&(this.calculateTextPosition(),this._parent._updateModelBoundingBox(),this._viewer[Vp._render]()))}},textOrientation:{get:function(){return this.text3D.options.textOrientation},set:function(e){r.b._isNumber(e)&&(this.text3D.options.textOrientation=e,this.calculateTextPosition(),this.flipText(this._parent.autoTextFlipping),this.updateDimensionLine(),this._parent._updateModelBoundingBox(),this._viewer[Vp._render]())}},selected:{get:function(){return this._selected},set:function(e){this._selected=e;var t=Object.assign({},this.materials);if(e){var n=this._parent.defaultMaterial.selection;t.extensionLine=n,t.dimensionLine=n,t.text=n}this.updateMaterial(t)}},highlighted:{get:function(){return this._highlighted},set:function(e){this._highlighted=e;var t=Object.assign({},this.materials);if(e){var n=this._parent.defaultMaterial.highlight;t.extensionLine=n,t.dimensionLine=n,t.text=n}this.updateMaterial(t)}},materials:{get:function(){return this._materials},set:function(e){this.setDimensionColors(e)}}}),DimensionObject.prototype.updateDimensionLine=function(){
//Sub class need implement this function
},DimensionObject.prototype.updateControlPoint=function(e,t,n){
//get the projected drag vector on dimension frame
var r=[{pointType:t,side:n}];this.getControlPoints(r),this._projectDragVectorOnDimFrame((new _.Vector3).fromArray(r[0].value),e),this.updateControlPointInnel(e,t,n)},DimensionObject.prototype.updateControlPointInnel=function(e,t,n){
//Sub class need implement this function
},DimensionObject.prototype._projectDragVectorOnDimFrame=function(){var e=new _.Ray,t=new _.Plane,n=new _.Vector3;return function(r,i){var a=this._viewer._currentCamera.position,o=n.subVectors(n.copy(r).add(i),a);e.set(a,o.normalize()),
// dim text plane is always xy-plane in local
t.set(n.set(0,0,1),0).applyMatrix4(this.text3D.matrixWorld);var s=n;e.intersectPlane(t,s)&&
//the result drag vector is on dimension frame
i.subVectors(s,r)}}(),DimensionObject.prototype.updateComponentPosition=function(e,t,n,r){
//get the projected drag vector on dimension frame
this._projectDragVectorOnDimFrame(t||this.getTextCenterWorld(),e),
//drag text center has same behavior with dragging text object
n===xr.Text?this.updateControlPoint(e,br.TextCenter,r):this.updateComponentPositionInnel(e,t,n,r)},DimensionObject.prototype.updateComponentPositionInnel=function(e,t,n,r){
//Sub class need implement this function
},DimensionObject.prototype.getTextCenterWorld=function(){var e=this.getTextScale()*this.text3D.getTextScalar(),t=this.text3D.textObject.geometry.boundingBox;return this.text3D.updateMatrixWorld(!0),(new _.Vector3).addVectors(t.max,t.min).multiplyScalar(e/2).applyMatrix4(this.text3D.matrixWorld)},
/**
 * Update all the dimension components that display in screen relative size
 */
DimensionObject.prototype.updateScreenRelativeSize=function(){var e=new _.Vector3,t=new _.Matrix4;return function(){if(this._scaleToCamera){var n=this._scaleToCamera,r=this.getScale()/n;1!==r&&(
// update dimension arrow size
this.traverse(function(n){n instanceof Pr&&(e.copy(n.position),t.identity(),n.applyMatrix(t.setPosition(n.position.negate())),n.applyMatrix(t.makeScale(r,r,r)),t.identity(),n.applyMatrix(t.setPosition(e)),n.updateMatrixWorld(!0))}),this.updateTextMatrix(),this.updateDimensionLine(),this.updateMatrixWorld(!0),this._parent._updateModelBoundingBox())}}}(),
/**
 * Get dimension text scaled size
 */
DimensionObject.prototype.getTextSize=function(){var e=this.text3D.getTextSize(),t=this.getTextScale()*this.text3D.getTextScalar();return{width:e.width*t,height:e.totalHeight*t}},
/**
 * Get dimension text start point
 */
DimensionObject.prototype.getTextStartPosition=function(){var e=this.text3D,t=this.getTextScale()*e.getTextScalar(),n=e.textObject.geometry.boundingBox;e.updateMatrixWorld(!0);
// detemine the text start point
// the initial text start point located at the center of left boundingBox border
var r=e.flipY!==e.flipXY?n.max.x:n.min.x;return this.textOrientation===Er.Perpendicular&&(r=e.flipX!==e.flipXY?n.min.x:n.max.x),new _.Vector3(r,0,0).multiplyScalar(t).applyMatrix4(e.matrixWorld)},DimensionObject.prototype._updateScale=function(e){e&&this.enableScreenRelativeSize&&this.updateScreenRelativeSize();
// scale text object
},
// internal use only:
DimensionObject.prototype.flipText=function(){var e=new _.Vector3,t=new _.Vector3,n=new _.Quaternion,i=new _.Matrix4;return function(a){
// find the text object:
var o=this.text3D;if(r.b._notNullOrUndefined(o)){
// calculate whether the text needs flipping based on the dimension frame:
var s=!1,l=!1;if(a){
// check against camera "up" vector:
o.matrixWorld.decompose(e,n,t);var c,u=e.copy(o.up);u.applyQuaternion(n),s=u.angleTo(this._viewer._currentCamera.up)>Math.PI/2,this._viewer.getCameraMode()===m.c.PERSPECTIVE?(c=this.getTextCenterWorld()).sub(this._viewer._currentCamera.position):(c=e,this._viewer._currentCamera.getWorldDirection(c));var h=t.crossVectors(o.up,o.right);h.applyQuaternion(n),s&&h.negate(),l=h.angleTo(c)>Math.PI/2}
// perform rotate:
s&&l?(i.makeRotationZ(Math.PI),o.flipXY=!o.flipXY):s?(i.makeRotationX(Math.PI),o.flipX=!o.flipX):l&&(i.makeRotationY(Math.PI),o.flipY=!o.flipY),(s||l)&&(o.matrix.multiply(i),o.updateMatrixWorld(!0))}}}(),
// internal use only:
DimensionObject.prototype.getDimensionColors=function(){var e={};return e.text=this.materials.text.uniforms.diffuse.value.getHex(),e.extensionLine=Rr(this.materials.extensionLine),e.extensionLineGap=Rr(this.materials.extensionLineGap),e.dimensionLine=Rr(this.materials.dimensionLine),e},
// internal use only:
DimensionObject.prototype.setDimensionColors=function(e){if(e){var t={};r.b._isNumber(e.text)&&(Dr.call(this,"text",e.text),t.text=this._materials.text),r.b._isNumber(e.extensionLine)&&(Dr.call(this,"extensionLine",e.extensionLine),t.extensionLine=this._materials.extensionLine),r.b._isNumber(e.extensionLineGap)&&(Dr.call(this,"extensionLineGap",e.extensionLineGap),t.extensionLineGap=this._materials.extensionLineGap),r.b._isNumber(e.dimensionLine)&&(Dr.call(this,"dimensionLine",e.dimensionLine),t.dimensionLine=this._materials.dimensionLine),this.updateMaterial(t),this._viewer[Vp._render]()}},DimensionObject.prototype.resetDimensionColors=function(){Object.assign(this._materials,this._parent.defaultMaterial),this.updateMaterial(this._materials),this._viewer[Vp._render]()},DimensionObject.prototype.updateMaterial=function(e){
//override by subclass
},
/**
 * Get the scale of all dimension components relative to screen.
 */
DimensionObject.prototype.getScale=function(){var e=new _.Vector3,t=new _.Vector3,n=new _.Vector3;return function(){var r,i=this._viewer.getCameraMode(),a=this._viewer.getCameraInfo();if(i===m.c.PERSPECTIVE){e.fromArray(a.perspective.pos),t.fromArray(a.perspective.tgt).sub(e),n.subVectors(this.origin,e);var o=n.projectOnVector(t).length();r=2*Math.tan(a.perspective.fov*Math.PI/360)*o}else r=a.orthographic.top-a.orthographic.bottom;return this._scaleToCamera=r/this._viewer.domElement.height,this._scaleToCamera}}(),
// get text scaleToCamera using text.origin
DimensionObject.prototype.getTextScale=function(){var e=this.text3D;return e._viewer||(e._viewer=this._viewer),DimensionObject.prototype.getScale.call(e)},DimensionObject.prototype.updateTextScale=function(){var e=this.text3D,t=e._textScaleToCamera;this.getTextScale(),e._textScaleToCamera=e._scaleToCamera,1!==(t=t?e._scaleToCamera/t:e._scaleToCamera)&&(e.matrix.scale(new _.Vector3(t,t,t)),e.updateMatrixWorld(!0))},DimensionObject.prototype.calculateTextPosition=function(){var e=this.getTextSize().height,t=this.text3D.options.textOverFactor*e,n=new _.Matrix4;this.text3D.options.textOrientation===Er.Over&&(n.makeTranslation(0,t+e/2,0),this.text3D.applyMatrix(n),this.text3D.updateMatrixWorld(!0))},
/**
 * Update text matrix based on the scale, orientation and baselineoffset
 */
DimensionObject.prototype.updateTextMatrix=function(e,t){
//set scale
this.updateTextScale(),this.calculateTextPosition(),this.calculateTextOrientation(e,t)},DimensionObject.prototype.calculateTextOrientation=function(e,t){var n=this.text3D;
// The default of the text orientation is paralle(Over, Ag)
if(n){var r,i,a=new _.Matrix4,o=new _.Vector3,s=new _.Quaternion,l=new _.Vector3;n.matrix.decompose(o,s,l),e&&(n.options.textOrientation===Er.Over||n.options.textOrientation===Er.Aligned?(i=e.clone().normalize(),r=n.right.clone()):n.options.textOrientation===Er.Perpendicular&&(i=e.clone().normalize(),r=n.up.clone())),t&&(n.options.textOrientation===Er.Horizontal?(i=t.clone().normalize(),
//along a direction
r=n.right.clone()):n.options.textOrientation===Er.Vertical&&(i=t.clone().normalize(),
//perpendicular a direction
r=n.up.clone())),r&&(r.applyQuaternion(s),r.z=0,s.setFromUnitVectors(r.normalize(),i),a.makeRotationFromQuaternion(s),n.matrix.multiply(a),n.updateMatrixWorld(!0))}},DimensionObject.prototype.flipArrow=function(){
//Sub class need override this function
},DimensionObject.prototype.isArrowFlipped=function(){return this.dimensionLine?this.dimensionLine.reversed:null;
// for NoteDimension and RadialDimension
},DimensionObject.prototype.getDimensionLine=function(){
// sub class need override the function
return null},DimensionObject.prototype.getExtensionLine=function(){
// sub class need override the function
return null},DimensionObject.prototype.getStubLine=function(){return this.stubLine},DimensionObject.prototype.getControlPoints=function(e){return e.forEach(e=>{var t=e.side,n=e.pointType,r=null;switch(n){case br.ArrowLineStart:case br.ArrowLineEnd:case br.ArrowHeadStart:var i,a=this.getDimensionLine();if(a)(i=a instanceof ArrowLineComponent?a.getControlPoint(n,!0):a.getControlPoint(n,t))&&(r=i);break;case br.ExtensionLineStart:case br.ExtensionLineAnchor:var o=this.getExtensionLine(t);if(o){var s=o.getControlPoint(n);s&&(r=s)}break;case br.TextCenter:r=this.getTextCenterWorld().toArray();break;case br.TextStart:r=this.getTextStartPosition().toArray();break;case br.StubLineStart:case br.StubLineEnd:var l=this.getStubLine();if(l){var c=l.getControlPoint(n,!0);c&&(r=c)}}e.value=r}),e},DimensionObject.prototype.raycast=function(e,t){var n=[];!function intersectChildrenOfObject(e,t,n){if(e.children)for(var r=0,i=e.children.length;r<i;r++){var a=e.children[r];if(a&&a.raycast){var o=n.length;a.raycast(t,n),
// don't drill down to children object when already get dimension component object intersect
n.length>o&&a.componentType&&n.length!==o||intersectChildrenOfObject(a,t,n)}}}
/* harmony default export */(this,e,n);for(var r=0,i=n.length;r<i;r++)n[r].dimComponent=n[r].object,n[r].object=this,t.push(n[r])},DimensionObject.prototype.setComponentVisibility=function(e,t,n){switch(t){case xr.ExtensionLineGap:case xr.ExtensionLinePrimary:case xr.ExtensionLineSecondary:var r=this.getExtensionLine(n,t);r&&(r.visible=e);break;case xr.ArrowLine:case xr.Arrow:var i=this.getDimensionLine(n);i&&(t===xr.ArrowLine?i.visible=e:i.arrow&&(i.arrow.visible=e));break;case xr.StubLine:var a=this.getStubLine();a&&(a.visible=e)}},DimensionObject.prototype.isComponentVisible=function(e,t){var n=!1;switch(e){case xr.ExtensionLineGap:case xr.ExtensionLinePrimary:case xr.ExtensionLineSecondary:var r=this.getExtensionLine(t,e);r&&(n=r.visible);break;case xr.ArrowLine:case xr.Arrow:var i=this.getDimensionLine(t);i&&(e===xr.ArrowLine?n=i.visible:i.arrow&&(n=i.arrow.visible));break;case xr.StubLine:var a=this.getStubLine();a&&(n=a.visible)}return n};var Vr=DimensionObject;
// CONCATENATED MODULE: ./staging/dimension/TwoSidesDimension.js
function TwoSidesDimension(e,t){Vr.call(this,e,t)}TwoSidesDimension.prototype=Object.create(Vr.prototype),TwoSidesDimension.prototype.constructor=TwoSidesDimension,TwoSidesDimension.prototype.getExtensionLine=function(e,t){var n,r;switch(e){case _r.Side1:r=this.extensionLine1;break;case _r.Side2:r=this.extensionLine2}if(t&&r)switch(t){case xr.ExtensionLineGap:n=r.gapLine;break;case xr.ExtensionLinePrimary:n=r.primaryLine;break;case xr.ExtensionLineSecondary:n=r.secondaryLine}else n=r;return n},TwoSidesDimension.prototype.getDimensionLine=function(e){var t=this.dimensionLine;if(e)switch(e){case _r.Side1:t=this.dimensionLine.side1ArrowLine;break;case _r.Side2:t=this.dimensionLine.side2ArrowLine}return t},TwoSidesDimension.prototype.updateExtensionLineStartPosition=function(e,t){var n=new _.Vector3,i=new _.Quaternion,a=new _.Vector3;this.matrixWorld.decompose(n,i,a);var o=e.extensionLineDirection.clone();o=o.applyQuaternion(i);var s=t.clone().projectOnVector(o.clone()),l=r.b._isZero(s.angleTo(o.clone()))?1:-1,c=e.extensionLineDirection.clone().multiplyScalar(s.length()*l);e.startPoint=r.b._addArrayVectors(e.startPoint,c.toArray())},TwoSidesDimension.prototype.setComponentVisibility=function(e,t,n){n&&n!==_r.Side1||Vr.prototype.setComponentVisibility.call(this,e,t,_r.Side1),n&&n!==_r.Side2||Vr.prototype.setComponentVisibility.call(this,e,t,_r.Side2)};
/* harmony default export */var Nr=TwoSidesDimension,Ur=r.b._createLineMaterial(0,1,1,!1,!1),Fr=6,zr=2;
// CONCATENATED MODULE: ./staging/dimension/LinearDimensionLine.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var warning = Debug( "PLMVisWeb:warning:LinearDimensionLine" );
//Initialize global materials
function LinearDimensionLine(e,t,n,r){_.Object3D.call(this),(n=n||Ur).side=_.DoubleSide,this.type="LinearDimensionLine",r||(r={});var i,a=r.reverse;r.length?(i=r.length,this.inverseLineLength=2*i):(i=zr,this.inverseLineLength=Fr);var o=t.clone().sub(e);this.direction=o,this.origin=e,this.endVector=t;var s=o.length();
// Normalize direction
o.normalize();var l=(new _.Vector3).addVectors(e,o.clone().setLength(s/2));this.length=s,this.reversed=a;
// Create Line
var c={isInverse:a,inverseLineLength:this.inverseLineLength,arrowLength:i};this.side1ArrowLine=new ArrowLineComponent(l,e,n,c,xr.ArrowLine,_r.Side1),this.side2ArrowLine=new ArrowLineComponent(l,t,n,c,xr.ArrowLine,_r.Side2),this.add(this.side1ArrowLine),this.add(this.side2ArrowLine),
// Update World Matrix
this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0)}LinearDimensionLine.prototype=Object.create(_.Object3D.prototype),LinearDimensionLine.prototype.constructor=LinearDimensionLine,LinearDimensionLine.prototype.extendLine=function(e,t,n,r,i){e-=i=i||0,t-=i,this.reversed?(this.side1ArrowLine.setInverseLineLength(n?e:Math.max(e,this.side1ArrowLine.inverseLineLength),!1),this.side2ArrowLine.setInverseLineLength(r?t:Math.max(t,this.side2ArrowLine.inverseLineLength),!1)):(this.side1ArrowLine.setPrimaryLineLength(n?e:this.side1ArrowLine.originalLength+e,!0),this.side2ArrowLine.setPrimaryLineLength(r?t:this.side2ArrowLine.originalLength+t,!0))},LinearDimensionLine.prototype.divideLine=function(e,t,n){n=n||0,e>0&&(this.reversed?this.side1ArrowLine.setInverseLineLength(this.side1ArrowLine.inverseLineLength-e-n,!0):this.side1ArrowLine.setPrimaryLineLength(e-n,!1)),t>0&&(this.reversed?this.side2ArrowLine.setInverseLineLength(this.side2ArrowLine.inverseLineLength-t-n,!0):this.side2ArrowLine.setPrimaryLineLength(t-n,!1))},LinearDimensionLine.prototype.setMaterial=function(e){this.side1ArrowLine.setMaterial(e),this.side2ArrowLine.setMaterial(e)},LinearDimensionLine.prototype.getControlPoint=function(){var e=new _.Vector3;return function(t,n){var r,i,a=null;switch(n){case _r.Side1:i=this.side1ArrowLine;break;case _r.Side2:i=this.side2ArrowLine}return(r=i.getControlPoint(t))&&(a=e.fromArray(r).applyMatrix4(this.matrixWorld).toArray()),a}}(),LinearDimensionLine.prototype.flipArrow=function(){this.reversed=!this.reversed,this.side1ArrowLine.flipArrow(),this.side2ArrowLine.flipArrow()};
/* harmony default export */var kr=LinearDimensionLine,jr=r.b._createLineMaterial(0,1,1,!1,!1);
// CONCATENATED MODULE: ./staging/dimension/ExtensionLine.js
//Â© 2018 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
function createLineSegments(e,t,n){var r,i=new _.BufferGeometry;return t&&i.setIndex(new _.BufferAttribute(new Uint16Array(t),1)),i.addAttribute("position",new _.BufferAttribute(new Float32Array(e),3)),r=new _.LineSegments(i,n),n instanceof _.LineDashedMaterial&&r.computeLineDistances(),r}function ExtensionLine(e,t,n,i,a,o,s,l){_.Object3D.call(this);var c=s.overhang*l,u=s.gap*l;
//if the direction is not equal with extended vector, need to draw a extended line
if(this._overhang=c,this._gap=u,this._isGapManualChanged=!1,this._anchorPoint=t.toArray(),this._direction=n.clone().sub(t).normalize(),this._hasExtend=!1,e){var h=e.clone().sub(t).normalize();r.b._floatEqual(h.dot(this._direction),1)||(this._hasExtend=!0)}var d,p=n.clone().add(this._direction.clone().multiplyScalar(this._overhang)),f=[],m=i||jr;this._hasExtend?(f=e.toArray().concat(t.toArray()),this._extendedLine=createLineSegments(f,null,m),this.add(this._extendedLine),this._extendedLine.componentType=xr.ExtensionLineSecondary,this._extendedLine.side=o,d=t.clone()):(!e||e.equals(t)?(d=t.clone().add(this._direction.clone().multiplyScalar(this._gap)),
//gap line position
f=t.toArray().concat(d.toArray())):(d=e.clone().add(this._direction.clone().multiplyScalar(this._gap)),f=t.toArray().concat(e.toArray()),this._connectionLine=createLineSegments(f,null,a),this._connectionLine.componentType=xr.ExtensionLineGap,this._connectionLine.side=o,
//gap line position
f=e.toArray().concat(d.toArray())),this._gapLine=createLineSegments(f,null,a),this._gapLine.componentType=xr.ExtensionLineGap,this._gapLine.side=o,this._gapLine.visible=!1,this._connectionLine&&this._gapLine.add(this._connectionLine),this.add(this._gapLine)),f=d.toArray().concat(n.toArray(),p.toArray());this._primaryLine=createLineSegments(f,[0,1,1,2],m),this._primaryLine.componentType=xr.ExtensionLinePrimary,this._primaryLine.side=o,this.add(this._primaryLine),
// Update World Matrix
this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0)}ExtensionLine.prototype=Object.create(_.Object3D.prototype),ExtensionLine.prototype.constructor=ExtensionLine;Object.defineProperties(ExtensionLine.prototype,{overhang:{get:function(){return this._overhang},set:function(){}},gap:{get:function(){return this._gap},set:function(){}},hasExtend:{get:function(){return this._hasExtend}},startPoint:{get:function(){var e=this._primaryLine.geometry.attributes.position.array;return this._extendedLine&&(e=this._extendedLine.geometry.attributes.position.array),[e[0],e[1],e[2]]},set:function(e){e&&function(e,t){
//the start point of extendLine cannot be changed.
if(!e._hasExtend){r.b._updatePositionFromArray(e._primaryLine.geometry.attributes.position,t,0),e._gapLine&&(r.b._updatePositionFromArray(e._gapLine.geometry.attributes.position,t,1),e._gapLine.geometry.computeBoundingBox()),e._primaryLine.geometry.computeBoundingBox(),e._isGapManualChanged=!0;
//if update overhang
var n=(new _.Vector3).fromArray(e.startPoint),i=(new _.Vector3).fromArray(e.endPoint).clone().sub(n).normalize().clone().multiplyScalar(e.overhang),a=r.b._addArrayVectors(e.endPoint,i.toArray());r.b._updatePositionFromArray(e._primaryLine.geometry.attributes.position,a,2),e._primaryLine.visible=!0}}(this,e)}},endPoint:{get:function(){var e=this._primaryLine.geometry.attributes.position.array;return[e[3],e[4],e[5]]}},anchorPoint:{get:function(){return this._anchorPoint}},gapLine:{get:function(){return this._gapLine}},primaryLine:{get:function(){return this._primaryLine}},secondaryLine:{get:function(){return this._extendedLine}},connectionLine:{get:function(){return this._connectionLine}},extensionLineDirection:{get:function(){var e=this._primaryLine.geometry.attributes.position.array,t=(new _.Vector3).fromArray([e[0],e[1],e[2]]);return(new _.Vector3).fromArray(this.endPoint).clone().sub(t).normalize()}}}),ExtensionLine.prototype.updatePosition=function(e){var t=e,n=this._direction.clone();r.b._floatEqual(this.extensionLineDirection.dot(this._direction),1,1e-4)||(t=-e,n.negate());
// caculate the new length
var i=n.clone().multiplyScalar(t),a=r.b._addArrayVectors(this.endPoint,i.toArray());
// extend end side
//maybe negate direction after update endpoint
if(r.b._updatePositionFromArray(this._primaryLine.geometry.attributes.position,a,1),!this._hasExtend){var o;if(!this._isGapManualChanged){var s=(new _.Vector3).fromArray(this.anchorPoint),l=(new _.Vector3).fromArray(this.endPoint);(new _.Vector3).fromArray(this.startPoint);
//don't show primary extension line when the end point in gap
if(l.sub(s).length()<this._gap)this._primaryLine.visible=!1;else{this._primaryLine.visible=!0;var c=n.clone().multiplyScalar(this._gap);o=r.b._addArrayVectors(this.anchorPoint,c.toArray())}r.b._updatePositionFromArray(this._primaryLine.geometry.attributes.position,o,0)}this._gapLine&&(r.b._updatePositionFromArray(this._gapLine.geometry.attributes.position,o,1),this._gapLine.geometry.computeBoundingBox(),this._gapLine.geometry.computeBoundingSphere())}
// update overhang based on the primary extend line direction
var u=this.extensionLineDirection.clone().multiplyScalar(this.overhang),h=r.b._addArrayVectors(this.endPoint,u.toArray());r.b._updatePositionFromArray(this._primaryLine.geometry.attributes.position,h,2),this._primaryLine.geometry.computeBoundingBox(),this._primaryLine.geometry.computeBoundingSphere()},ExtensionLine.prototype.setMaterial=function(e,t){t||(this._primaryLine.material=e,this._extendedLine&&(this._extendedLine.material=e))},ExtensionLine.prototype.getControlPoint=function(){var e=new _.Vector3;return function(t){var n,r=null;switch(t){case br.ExtensionLineStart:n=this.startPoint;break;case br.ExtensionLineAnchor:n=this.anchorPoint}return n&&(r=e.fromArray(n).applyMatrix4(this.matrixWorld).toArray()),r}}();
/* harmony default export */var Hr=ExtensionLine;
// CONCATENATED MODULE: ./staging/dimension/LinearDimension.js
//ï¿½ 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var debug = Debug( "PLMVisWeb:debug:LinearDimension" );
//var error = Debug( "PLMVisWeb:error:LinearDimension" );
//var warning = Debug( "PLMVisWeb:warning:LinearDimension" );
function LinearDimension(e,t,n,i,a,o,s,l){
// OPTIONS:
// textDisplayHeight : pixel value to make text bigger/smaller (default is 15)
// dimensionLineOffset : distance from dimensionLine to text (default is 25% of the scaled text height)
// textColor : THREE.Color input for text
// extensionLineColor : THREE.Color input for extensionLine
// dimensionLineColor : THREE.Color input for dimensionLine
// enableScreenRelativeSize: whether to enable screen relative size for text and arrow, default relative to model size.
var c={text:t,options:l};Nr.call(this,e,c),this.type="LinearDimension",this.textPadding=l.textPadding;var u=(new _.Vector3).fromArray(n),h=(new _.Vector3).fromArray(i),d=(new _.Vector3).fromArray(a);this.origin=u;
//Dimension parameters
var p=d.clone().sub(u),f=h.clone().sub(u);r.b._isZero(p.length())&&p.set(0,1e-4,0),r.b._isZero(f.length())&&f.set(1e-4,0,0),this.heightDirection=p,this.widthDirection=f;var m=p.length(),g=f.length();
//TODO remove this property when dimension text position update rework is done
this.baselineLength=g,this.heightLength=m;var v,y,b=(new _.Vector3).crossVectors(p,f),x=(new _.Matrix4).lookAt(new _.Vector3(0,0,0),b,p);if(o instanceof Array&&(v=(new _.Vector3).fromArray(o).sub(u),r.b._isZero(v.length())?v=null:v.applyMatrix4((new _.Matrix4).getInverse(x))),s instanceof Array){(y=(new _.Vector3).fromArray(s).sub(h)).length();r.b._isZero()?y=null:y.applyMatrix4((new _.Matrix4).getInverse(x))}
//extend the lead line
var w={gap:l.extensionLineGap,overhang:l.extensionLineOverhang},M=this.getScale();this.extensionLine1=new Hr(v,new _.Vector3(0,0,0),new _.Vector3(0,m,0),this.materials.extensionLine,this.materials.extensionLineGap,_r.Side1,w,M),this.extensionLine2=new Hr(y,new _.Vector3(0,0,0),new _.Vector3(0,m,0),this.materials.extensionLine,this.materials.extensionLineGap,_r.Side2,w,M),this.extensionLine2.applyMatrix((new _.Matrix4).setPosition(new _.Vector3(g,0,0)));var E=l.arrowLength*M*4>g;this.dimensionLine=new kr(new _.Vector3(0,m,0),new _.Vector3(g,m,0),this.materials.dimensionLine,{reverse:E,length:l.arrowLength*M}),this.add(this.extensionLine1),this.add(this.extensionLine2),this.add(this.dimensionLine),this.textOffset=0,
// Calculate the transformation matrix for the frame (positions the entire dimension in 3D space):
this.matrix.setPosition(u),// translation
this.matrix.multiply(x),// rotation, eye at the origin
this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0),
// update dimention text position
this.updateTextMatrix(this.dimensionLine.direction.clone(),this.extensionLine1.extensionLineDirection),this.updateTextScale()}LinearDimension.prototype=Object.create(Nr.prototype),LinearDimension.prototype.constructor=LinearDimension,
/**
 * Update line dimension material.
 * @private
 *
 * @param {Object} updatedMaterials the updated demension material
 */
LinearDimension.prototype.updateMaterial=function(e){e.extensionLine&&(this.extensionLine1.setMaterial(e.extensionLine),this.extensionLine2.setMaterial(e.extensionLine),this.extensionLine&&this.extensionLine.setMaterial(e.extensionLine)),e.extensionLineGap,e.dimensionLine&&this.dimensionLine.setMaterial(e.dimensionLine),e.text&&(this.text3D.textObject.material=e.text)},LinearDimension.prototype.updateDimensionLine=function(){var e=this.text3D.options.textOrientation===Er.Over,t=this.dimensionLine.length/2,n=this.getTextSize(),r=n.width/2,i=n.height/2,a=0,o=0,s=0,l=0,c=this.textPadding*this.getTextScale(),u=r;switch(this.text3D.options.textOrientation){case Er.Aligned:case Er.Vertical:u=r;break;case Er.Horizontal:case Er.Perpendicular:u=i}var h=this.textOffset+t-u,d=u+this.textOffset+t,p=this.textOffset-t-u,f=u+this.textOffset-t,m=!1,g=!1;e?(s=Math.max(-h,0),l=Math.max(f,0)):this.dimensionLine.reversed?(a=Math.max(-h,0),o=Math.max(f,0),0===a&&o>2*u&&(l=p,g=!0),0===o&&a>2*u&&(s=-d,m=!0),a=0,o=0):(this.side1Dragged?a=this.dimensionLine.side1ArrowLine.length:((a=Math.max(h,0))<=c&&(m=!0),a-=c),this.side2Dragged?o=this.dimensionLine.side2ArrowLine.length:((o=Math.max(-f,0))<=c&&(g=!0),o-=c),c=0),e?this.dimensionLine.extendLine(s,l):(this.dimensionLine.extendLine(s,l,m,g,c),this.dimensionLine.divideLine(a,o,c))},LinearDimension.prototype.calculateTextPosition=function(){this.text3D.matrix.setPosition(new _.Vector3(this.baselineLength/2+this.textOffset,this.heightLength,0)),Vr.prototype.calculateTextPosition.call(this)},LinearDimension.prototype.updateControlPointInnel=function(e,t,n){
// TODO: should handle cases based on controlPointType and side
switch(t){case br.TextCenter:this.side1Dragged=!1,this.side2Dragged=!1,this.updateTextPosition(e);break;case br.ExtensionLineStart:var i=this.extensionLine1;n===_r.Side2&&(i=this.extensionLine2),this.updateExtensionLineStartPosition(i,e);break;case br.ArrowLineStart:var a=this.getDimensionLine(n),o=new _.Vector3,s=new _.Quaternion,l=new _.Vector3;this.matrixWorld.decompose(o,s,l);var c=a.direction.clone();c=c.applyQuaternion(s);var u=e.clone().projectOnVector(c.clone()),h=r.b._isZero(u.angleTo(c))?1:-1,d=a.length-u.length()*h;d<0&&(d=0),n===_r.Side1?this.side1Dragged=!0:this.side2Dragged=!0,a.setPrimaryLineLength(d)}},LinearDimension.prototype.updateComponentPositionInnel=function(e,t,n,r){if(n===xr.ArrowLine){var i=e.clone().projectOnVector(this.heightDirection.clone());this.updateTextPosition(i)}},LinearDimension.prototype.updateTextPosition=function(e){var t=e.clone().projectOnVector(this.heightDirection.clone()),n=e.clone().projectOnVector(this.widthDirection.clone()),i=r.b._isZero(t.angleTo(this.heightDirection))?1:-1,a=r.b._isZero(n.angleTo(this.widthDirection))?1:-1,o=n.length()*a,s=i*t.length(),l=(new _.Matrix4).makeTranslation(0,s,0);// translation
this.dimensionLine.applyMatrix(l),this.textOffset+=o,this.heightLength+=s,this.updateDimensionLine();
//text translation
var c=(new _.Matrix4).makeTranslation(o,s,0);// translation
this.text3D.applyMatrix(c),
// update position related
this.text3D.manuallyMoved=!0,
//projection line scal
this.extensionLine1.updatePosition(s),this.extensionLine2.updatePosition(s)},LinearDimension.prototype.flipArrow=function(){this.dimensionLine.flipArrow(),this.updateDimensionLine()};
/* harmony default export */var Wr=LinearDimension;
// CONCATENATED MODULE: ./staging/dimension/CircleLineComponent.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
// Class for circle line component
function CircleLineComponent(e,t,n,r){Lr.call(this,n,r);
// TODO construct the points inside the component
var i=(new _.BufferGeometry).addAttribute("position",new _.BufferAttribute(new Float32Array(e),3));_.LineSegments.call(this,i,t)}
// Class for circle arrow line component
function CircleArrowLineComponent(e,t,n,r,i){CircleLineComponent.call(this,e,t,r,i),
// TODO initialize the arrow inside the component
this.arrow=n}CircleLineComponent.prototype=Object.create(_.LineSegments.prototype),CircleLineComponent.prototype.constructor=CircleLineComponent,CircleLineComponent.prototype.getControlPoint=function(){var e=new _.Vector3,t={Side1:{ExtensionLineStart:"pointMiddleFrom",ExtensionLineAnchor:"pointFrom"},Side2:{ExtensionLineStart:"pointMiddleTo",ExtensionLineAnchor:"pointTo"}};return function(n){if(this.parent){var r,i=null,a=t[this.side][n];return(r=this.parent[a])&&(i=e.fromArray(r).applyMatrix4(this.matrixWorld).toArray()),i}}}(),CircleArrowLineComponent.prototype=Object.create(CircleLineComponent.prototype),CircleArrowLineComponent.prototype.constructor=CircleArrowLineComponent;
// CONCATENATED MODULE: ./staging/dimension/CircleDimensionLine.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var warning = Debug( "PLMVisWeb:warning:CircleDimensionLine" );
var Xr=4,qr=Math.PI/45,Yr=function(e){return[Math.cos(e),Math.sin(e),0]},Zr=function(e){var t=Math.floor(e/Math.PI/2);return e-=2*Math.PI*t},Jr=function(e){return r.b._isZero(e.length())},Qr=91,Kr=92,$r=93,ei=94;
// angleFrom, angleTo: radians of angle
// arrowOptions = {head:boolean,tail:boolean,reverse:boolean,length:Number}
function CircleDimensionLine(e,t,n,r,i,a,o,s){_.Object3D.call(this),s||(s={});var l=s.length||Xr;this.reversed=s.reverse,this.radius=r,this.switchSide=a,this.type="CircleDimensionLine";var c=[];
// Change to none clock wise
if(new _.EllipseCurve(0,0,1,1,0,2*Math.PI,!1,0).getPoints(2*Math.PI/qr).forEach(function(e){c.push(e.x,e.y,0)}),i){var u=Zr(t);t=Zr(n),n=u}else t=Zr(t),n=Zr(n);var h=Zr(t<=n?t/2+n/2:t/2+(n+2*Math.PI)/2),d=(new _.Matrix4).makeRotationZ(t);
// Cache the original setting
this.isClockWise=i,this.radians=t<=n?n-t:2*Math.PI+n-t,this.originalAngleFrom=t,this.originalAngleTo=n,this.originalAngleMiddle=h,t=0,h=(n=this.radians)/2,this._originalPointFrom=[1,0,0],this._originalPointTo=Yr(n),this._originalPointMiddle=Yr(h),c=c.concat(this._originalPointFrom,this._originalPointMiddle,this._originalPointMiddle,this._originalPointTo),this._indexFrom=0,this._indexTo=Math.floor(n/qr),this._indexMiddleFrom=Math.floor(h/qr),this._indexMiddleTo=Math.ceil(h/qr);
// create side 1 and side 2 arrows
var p=(new _.Matrix4).makeScale(r,r,r),f=(s={isInverse:this.reversed,arrowLength:l,inverseLineLength:2*l},(new _.Vector3).fromArray(c,0).applyMatrix4(p)),m=(new _.Vector3).fromArray(c,3).applyMatrix4(p),g=(new _.Vector3).fromArray(c,3*this._indexTo).applyMatrix4(p),v=(new _.Vector3).fromArray(c,282).applyMatrix4(p);if(Jr(g.clone().sub(v))){var y=0===this._indexTo?267:3*this._indexTo-3;g=(new _.Vector3).fromArray(c,y).applyMatrix4(p)}this.switchSide&&(
// switch arrow side
u=f,f=v,v=u,u=m,m=g,g=u),this.side1Arrow=new ArrowLineComponent(m,f,o,s,xr.Arrow,_r.Side1),this.side2Arrow=new ArrowLineComponent(g,v,o,s,xr.Arrow,_r.Side2),this.add(this.side1Arrow),this.add(this.side2Arrow),this.side1ArrowLine=new CircleArrowLineComponent(c,o,this.side1Arrow,xr.ArrowLine,_r.Side1),this.side2ArrowLine=new CircleArrowLineComponent(c,o,this.side2Arrow,xr.ArrowLine,_r.Side2),this._side1ArrowLineGeo=this.side1ArrowLine.geometry,this._side2ArrowLineGeo=this.side2ArrowLine.geometry,this.side1ArrowLine.applyMatrix(p),this.side2ArrowLine.applyMatrix(p),this.add(this.side1ArrowLine),this.add(this.side2ArrowLine),this._updateIndices(),this.applyMatrix(d);var b=(new _.Matrix4).makeTranslation(e.x,e.y,e.z);this.applyMatrix(b)}CircleDimensionLine.prototype=Object.create(_.Object3D.prototype),CircleDimensionLine.prototype.constructor=CircleDimensionLine,Object.defineProperties(CircleDimensionLine.prototype,{pointFrom:{get:function(){var e=this._side1ArrowLineGeo.attributes.position.array;return[e[273],e[274],e[275]];// index 91
},set:function(e){r.b._updatePositionFromArray(this._side1ArrowLineGeo.attributes.position,e,Qr),r.b._updatePositionFromArray(this._side2ArrowLineGeo.attributes.position,e,Qr)}},pointMiddleFrom:{get:function(){var e=this._side1ArrowLineGeo.attributes.position.array;return[e[276],e[277],e[278]];// index 92
},set:function(e){r.b._updatePositionFromArray(this._side1ArrowLineGeo.attributes.position,e,Kr),r.b._updatePositionFromArray(this._side2ArrowLineGeo.attributes.position,e,Kr)}},pointMiddleTo:{get:function(){var e=this._side1ArrowLineGeo.attributes.position.array;return[e[279],e[280],e[281]];// index 93
},set:function(e){r.b._updatePositionFromArray(this._side1ArrowLineGeo.attributes.position,e,$r),r.b._updatePositionFromArray(this._side2ArrowLineGeo.attributes.position,e,$r)}},pointTo:{get:function(){var e=this._side1ArrowLineGeo.attributes.position.array;return[e[282],e[283],e[284]];// index 94
},set:function(e){r.b._updatePositionFromArray(this._side1ArrowLineGeo.attributes.position,e,ei),r.b._updatePositionFromArray(this._side2ArrowLineGeo.attributes.position,e,ei)}}}),CircleDimensionLine.prototype.setMaterial=function(e){e&&(this.side1ArrowLine.material=e,this.side2ArrowLine.material=e,this.side1Arrow.setMaterial(e),this.side2Arrow.setMaterial(e))},CircleDimensionLine.prototype._updateIndices=function(){var e,t,n=[],i=[];
// Extension arc from side
if(n.push(Qr),// add pointFrom
// Deal with 360 degree
(r.b._isZero(this.radians)&&this.isClockWise||90===this._indexTo&&!this.isClockWise)&&(this._indexTo=90,this._indexMiddleFrom=0,this._indexMiddleTo=0),this._indexFrom>0)for(e=this._indexFrom;e<Qr;e++)n.push(e,e);for(e=0;e<=this._indexMiddleFrom;e++)n.push(e,e);// circle2 starts with pointMiddleTo
for(n.push(Kr),//circle1 ends with pointMiddleFrom
i.push($r),e=this._indexMiddleTo;e<this._indexTo;e++)i.push(e,e);i.push(ei),this.switchSide&&(t=n,n=i,i=t),this._side1ArrowLineGeo.setIndex(new _.BufferAttribute(new Uint16Array(n),1)),this._side1ArrowLineGeo.computeBoundingBox(),this._side2ArrowLineGeo.setIndex(new _.BufferAttribute(new Uint16Array(i),1)),this._side2ArrowLineGeo.computeBoundingBox()},CircleDimensionLine.prototype.divide=function(e,t){(e=Math.min(Zr(e),this.radians))+(t=Math.min(Zr(t),this.radians))>this.radians&&(// if include the whole arc, reset the middle point
e=this.radians/2,t=this.radians/2),this.pointMiddleFrom=Yr(e),this.pointMiddleTo=Yr(this.radians-t),this._indexMiddleFrom=Math.floor(e/qr),this._indexMiddleTo=Math.ceil((this.radians-t)/qr),this._updateIndices()},CircleDimensionLine.prototype.extend=function(e,t){e<0||t<0||((e=Math.min(Zr(e),2*Math.PI-this.radians))+(t=Math.min(Zr(t),2*Math.PI-this.radians))>=2*Math.PI-this.radians&&(// if include the whole extension arc, reset the from and to points
e=0,t=2*Math.PI-this.radians),this._indexFrom=0===e?0:Math.ceil((2*Math.PI-e)/qr),this._indexTo=Math.floor((this.radians+t)/qr),this.pointFrom=Yr(2*Math.PI-e),this.pointTo=Yr(this.radians+t),this._updateIndices())},CircleDimensionLine.prototype.resize=function(e){var t=(new _.Matrix4).makeScale(e,e,e);this.side1ArrowLine.applyMatrix(t),this.side2ArrowLine.applyMatrix(t);var n=this.radius*(e-1);// calculate the offset of Arrow
this.radius*=e;var r=(new _.Matrix4).makeTranslation(n,0,0),i=this._originalPointTo,a=(new _.Matrix4).makeTranslation(i[0]*n,i[1]*n,i[2]*n);this.switchSide?(this.side1Arrow.applyMatrix(a),this.side2Arrow.applyMatrix(r)):(this.side1Arrow.applyMatrix(r),this.side2Arrow.applyMatrix(a))},CircleDimensionLine.prototype.flipArrow=function(e){e?(this.side1Arrow.reverse(),this.side2Arrow.reverse()):(this.reversed=!this.reversed,this.side1Arrow.flipArrow(),this.side2Arrow.flipArrow())},CircleDimensionLine.prototype.getControlPoint=function(){var e=new _.Vector3,t={Side1:{ArrowLineStart:"pointMiddleFrom",ArrowLineEnd:"_originalPointFrom",ArrowHeadStart:"side1Arrow",ExtensionLineStart:"pointFrom",ExtensionLineAnchor:"_originalPointFrom"},Side2:{ArrowLineStart:"pointMiddleTo",ArrowLineEnd:"_originalPointTo",ArrowHeadStart:"side2Arrow",ExtensionLineStart:"pointTo",ExtensionLineAnchor:"_originalPointTo"}};return function(n,r){var i,a=this.radius,o=this.matrixWorld,s=null;return n===br.ArrowHeadStart?(o=(i=this[t[r][n]]).matrixWorld,i=i.getControlPoint(n),a=1):(this.switchSide&&(r=r===_r.Side1?_r.Side2:_r.Side1),i=this[t[r][n]]),i&&(s=e.fromArray(i).multiplyScalar(a).applyMatrix4(o).toArray()),s}}();
/* harmony default export */var ti=CircleDimensionLine,ni=10,ri=1.5,ii=Math.PI/2,ai=new _.Vector3(0,0,0),oi=function(e){return r.b._isZero(e.length())};
// CONCATENATED MODULE: ./staging/dimension/AngularDimension.js
//Â© 2018 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
// import Debug from "debug";
//var debug = Debug( "PLMVisWeb:debug:AngularDimension" );
//var error = Debug( "PLMVisWeb:error:AngularDimension" );
//error.enabled = true;
// var warning = Debug( "PLMVisWeb:warning:AngularDimension" );
function AngularDimension(e){var t=e.parent,n=e.startOne,i=e.extensionOne,a=e.directionOne,o=e.startTwo,s=e.extensionTwo,l=e.directionTwo,c=e.radius,u=e.majorAngle,h=e.text,d=e.options;
// OPTIONS:
// textDisplayHeight :pixel value to make text bigger/smaller (default is 20)
// textOverFactor : distance from baseline to text (default is 25% of the scaled text height)
// textColor : THREE.Color input for text
// extensionLineColor : THREE.Color input for extensionLine
// baselineColor : THREE.Color input for baseline
// enableScreenRelativeSize: whether to enable screen relative size for text and arrow, default relative to model size.
// Property internal used for drag
this.lastDragStart=new _.Vector3,this.dragNegate=!1;var p={text:h,options:d};Nr.call(this,t,p),this.type="AngularDimension",this.origin=(new _.Vector3).fromArray(n);var f=(new _.Vector3).fromArray(n),m=(new _.Vector3).fromArray(o),g=(new _.Vector3).fromArray(a).normalize(),v=(new _.Vector3).fromArray(l).normalize(),y=(new _.Vector3).addVectors(g,f),b=(new _.Vector3).addVectors(v,m);this.radius=c||ni;
// Adjust the second extension line to the same plane
var x,w=(new _.Plane).setFromCoplanarPoints(f,y,f.clone().add(v)),M=Math.abs(w.distanceToPoint(m));
// If not on the same plane, project the second extension line to the same plane with first extension line
if(r.b._isZero(M))(oi(g.clone().sub(v))||oi(g.clone().negate().sub(v)))&&(x=m.clone(),m=f.clone(),b=y.clone());
// Get cross point of extension line 1 and extension line 2
else{x=m.clone();var E=new _.Vector3,S=new _.Vector3;w.projectPoint(m,E),m=E.clone(),w.projectPoint(b,S),b=S.clone()}var L=this._getCrossPoint(f,g,m,v),T=L.clone().sub(f),A=L.clone().sub(m),C=T.length(),P=A.length(),I=r.b._isZero(T.angleTo(g))?1:-1,O=r.b._isZero(A.angleTo(v))?1:-1;
// Change the directions if the two extension lines are crossed
I>0&&O>0&&(g.negate(),v.negate(),I=-1,O=-1);
// Calculate the normal of the plane of the two direction vectors
var B,R=this._getNormalOfTwoLines(g,v);
// Check if the directions are already in the xy-plane
if(0===R.x&&0===R.y)B=new _.Matrix4;else{var G=(new _.Quaternion).setFromUnitVectors(R,new _.Vector3(0,0,1));B=(new _.Matrix4).makeRotationFromQuaternion(G)}
// Transform direction vectors to the xy-plane
var D=(new _.Vector3).copy(g).applyMatrix4(B),V=(new _.Vector3).copy(v).applyMatrix4(B),N=Math.atan2(D.y,D.x),U=Math.atan2(V.y,V.x),F=Math.abs(N-U);
// Calculate angles in radians from the positive x-axis to both transformed vectors. Note: Math.atan2 output range: [ pi to -pi ]
// Calculate Angle, flip angle if using the major angle
this.angle=u?F>=Math.PI?F:2*Math.PI-F:F>=Math.PI?2*Math.PI-F:F,this.rotateAngle=0;
// Change cross point to near the start one point
var z=Math.abs(this.radius+C*I),k=Math.abs(this.radius+P*O),j=f.clone().sub(m),H=j.length();if(z>H/2&&k>H/2&&z>this.radius*ri&&k>this.radius*ri){var W=C-this.radius*ri;this.angle>15*Math.PI/16&&(// For more than Math.PI * 15 / 16 angle, move the cross point close to start1
W=C-this.radius/2,O=-I);var X=g.clone().multiplyScalar(W*I);L.sub(X);var q=j.clone().multiplyScalar(W/C);m.add(q),b.add(q),T=L.clone().sub(f),A=L.clone().sub(m),C=T.length(),P=A.length()}var Y,Z,J=(new _.Matrix4).makeTranslation(T.x,T.y,T.z);
// Calculate the extension lines length according to the radius and cross point position
C=this.radius+C*I,this._extension1Sign=C/Math.abs(C),P=this.radius+P*O,this._extension2Sign=P/Math.abs(P),
// If user defined extension one point, create an extension line one
i&&(Y=(new _.Vector3).fromArray(i).sub(y)),
// If user defined extension two point, create an extension line two
s?Z=(new _.Vector3).fromArray(s).sub(m):x&&(Z=x.clone().sub(m));
// Create Direction Vector Geometries
var Q=(new _.Vector3).subVectors(m,f),K=(new _.Matrix4).makeTranslation(Q.x,Q.y,Q.z),$=g.clone().multiplyScalar(C),ee=v.clone().multiplyScalar(P),te=this.materials.extensionLine,ne=this.materials.dimensionLine,re={gap:d.extensionLineGap,overhang:d.extensionLineOverhang},ie=this.getScale();this.extensionLine1=new Hr(Y,ai,$,te,this.materials.extensionLineGap,_r.Side1,re,ie),this.extensionLine2=new Hr(Z,ai,ee,te,this.materials.extensionLineGap,_r.Side2,re,ie),this.extensionLine2.applyMatrix(K),this.add(this.extensionLine1),this.add(this.extensionLine2),this.extensionLine1.applyMatrix((new _.Matrix4).getInverse(J)),this.extensionLine2.applyMatrix((new _.Matrix4).getInverse(J)),this.extensionLine1.applyMatrix(B),this.extensionLine2.applyMatrix(B),
// Calculate arrow options
this.inverseLength=d.arrowLength*ie*4/Math.max(this.angle,.001);var ae={reverse:this.inverseLength>this.radius,length:d.arrowLength*ie};this.extension1Direction=D,this.extension2Direction=V,this.tangentDirection=V.clone().sub(D).normalize(),this.dragStartPointDir=this.tangentDirection.clone();
// Create 2D unit circle segement curve using THREE.EllipseCurve from the smaller angle to the larger angle and calculate angle
var oe=!1;(N>U&&F<=Math.PI||U>N&&F>Math.PI)&&(u=!u,oe=!0,// Fix issue that dimensionLine side is not correct
this.dragStartPointDir.negate(),u&&this.tangentDirection.negate()),oi(this.tangentDirection)&&this.tangentDirection.crossVectors(D,new _.Vector3(0,0,-1)).normalize(),
// Add Arc
this.dimensionLine=new ti(ai,N,U,this.radius,u,oe,ne,ae),this.add(this.dimensionLine),
// Get Mid-Point of the Curve for Text Placement
this.midPt=(new _.Vector3).fromArray(this.dimensionLine._originalPointMiddle).applyMatrix4(this.dimensionLine.matrix),this.midPt.z=0,this.dragDirection=new _.Vector3(this.midPt.x,this.midPt.y,0).normalize();
// Apply transformation/translation to dimension
var se=(new _.Matrix4).getInverse(B);se.elements[12]=n[0]+T.x,se.elements[13]=n[1]+T.y,se.elements[14]=n[2]+T.z,this.matrix=se,
// World Matrix
this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0),
// Manually Set Text Position
this.updateTextMatrix(this.tangentDirection.clone(),this.extension1Direction.clone())}AngularDimension.prototype=Object.create(Nr.prototype),AngularDimension.prototype.constructor=AngularDimension,AngularDimension.prototype.calculateTextPosition=function(){var e=this.radius;if(this.text3D.options.textOrientation===Er.Over){var t=this.getTextSize().height;e+=this.text3D.options.textOverFactor*t+t/2}var n=this.midPt.clone();n.setLength(e),this.rotateAngle&&n.applyAxisAngle(new _.Vector3(0,0,1),this.rotateAngle),this.text3D.matrix.setPosition(new _.Vector3(n.x,n.y,0))},
/**
 * Get the cross point from two lines.
 * @private
 *
 * @param {Object} point1 one point in line 1
 * @param {Object} direction1 the direction of line 1
 * @param {Object} point2 one point in line 2
 * @param {Object} direction2 the direction of line 2
 */
AngularDimension.prototype._getCrossPoint=function(e,t,n,r){var i=e.clone().sub(n).clone().cross(r).length(),a=Math.max(r.clone().cross(t).length(),.001),o=e.clone().add(t.clone().multiplyScalar(i/a)),s=o.clone().sub(n);return oi(r.clone().cross(s))||(// If cross point is not on the second extension line
o=e.clone().add(t.clone().multiplyScalar(-i/a))),o},
/**
 * Get the normal vector of two lines.
 * @private
 *
 * @param {Object} direction1 the direction of line 1
 * @param {Object} direction2 the direction of line 2
 */
AngularDimension.prototype._getNormalOfTwoLines=function(e,t){var n=(new _.Vector3).crossVectors(e,t).normalize();
// Check if valid normal
return oi(n)&&(
// Calculate normal between the axis and the y-axis
n.crossVectors(e,new _.Vector3(0,1,0)).normalize(),
// If the calculated axis is the y-axis, use th z-axis
oi(n)&&n.crossVectors(e,new _.Vector3(0,0,1)).normalize()),n},
/**
 * Update angular dimension material.
 * @private
 *
 *
 * @param {Object} updatedMaterials the updated demension material
 */
AngularDimension.prototype.updateMaterial=function(e){e.extensionLine&&(this.extensionLine1.setMaterial(e.extensionLine),this.extensionLine2.setMaterial(e.extensionLine),this.extensionLine&&this.extensionLine.setMaterial(e.extensionLine)),e.dimensionLine&&this.dimensionLine.setMaterial(e.dimensionLine),e.text&&(this.text3D.textObject.material=e.text)},
/**
 * update dimension control position when drag
 * @private
 *
 * @param dragVec the world vector3
 */
AngularDimension.prototype.updateControlPointInnel=function(){var e=new _.Vector3,t=new _.Quaternion,n=new _.Vector3;return function(i,a,o){switch(a){case br.TextCenter:this.startDragged=!1,this.endDragged=!1,this.updateTextPosition(i);break;case br.ExtensionLineStart:var s=this.extensionLine1;o===_r.Side2&&(s=this.extensionLine2),this.updateExtensionLineStartPosition(s,i);break;case br.ArrowLineStart:this.matrixWorld.decompose(e,t,n);var l=this.dragStartPointDir.clone().applyQuaternion(t),c=i.clone().projectOnVector(l);if(!r.b._isZero(c.length())){var u=r.b._isZero(c.angleTo(l))?1:-1,h=c.length()*u,d=Math.abs(h/2),p=2*Math.asinh(d/this.radius)*d*2/h;o===_r.Side1&&!this.dimensionLine.switchSide||o===_r.Side2&&this.dimensionLine.switchSide?(this.currentStartAngle=Math.max(.001,this.currentStartAngle+p),this.startDragged=!0):(this.currentEndAngle=Math.max(.001,this.currentEndAngle-p),this.endDragged=!0),this.updateDimensionLine()}}}}(),
/**
 * update dimension text position
 * @private
 *
 * @param dragVec the world vector3
 */
AngularDimension.prototype.updateTextPosition=function(e){var t=new _.Vector3,n=new _.Quaternion,i=new _.Vector3;this.matrixWorld.decompose(t,n,i);var a=this.dragDirection.clone().applyQuaternion(n),o=this.tangentDirection.clone().applyQuaternion(n),s=e.clone().projectOnVector(a),l=e.clone().projectOnVector(o),c=s.angleTo(a),u=r.b._isZero(c)?1:-1,h=r.b._isZero(l.angleTo(o))?1:-1;this.rotate(l.length()*h),this.move(s.length()*u),this.updateDimensionLine(),this.text3D.options.textOrientation!==Er.Horizontal&&this.text3D.options.textOrientation!==Er.Vertical||this.calculateTextOrientation(null,this.extension1Direction.clone())},AngularDimension.prototype.updateComponentPositionInnel=function(){var e=new _.Vector3,t=new _.Quaternion,n=new _.Vector3,r=new _.Vector3;return function(i,a,o,s){if(o===xr.ArrowLine){this.matrixWorld.decompose(e,t,n);var l=ai.clone().applyMatrix4(this.matrixWorld);r.subVectors(a,l),i.projectOnVector(r);
// Calculate the drag direction to the text direction
var c=this.dragDirection.clone().applyQuaternion(t);c.setLength(i.length()),r.angleTo(i)>ii&&c.negate(),
// If the drag start when dimension reversed, the drag direction need reverse
this.lastDragStart.equals(a)||(this.lastDragStart.copy(a),this.dragNegate=this.radius<0),this.dragNegate&&c.negate(),this.updateTextPosition(c)}}}(),
/**
 * rotate dimension text and arc
 * @private
 *
 * @param length the float length
 */
AngularDimension.prototype.rotate=function(e){if(!(Math.abs(this.radius)<1||r.b._isZero(Math.abs(e)))){var t,n=Math.abs(e/2),i=2*Math.asinh(n/this.radius)*n*2/e,a=(new _.Matrix4).makeRotationZ(i);this.rotateAngle+=i,this.text3D.applyMatrix(a),this.dragDirection.applyMatrix4(a),this.tangentDirection.applyMatrix4(a),t=this.rotateAngle<0?this.rotateAngle-Math.ceil(this.rotateAngle/Math.PI/2)*Math.PI*2:this.rotateAngle-Math.floor(this.rotateAngle/Math.PI/2)*Math.PI*2,this.rotateAngle=t,this.calculateTextPosition();var o=this.angle/2,s=0,l=0;if(Math.abs(t)>o&&Math.abs(t)<2*Math.PI-o){var c=Math.abs(t)-o;t<0?Math.abs(t)<Math.PI?s=c:l=2*(Math.PI-o)-c:Math.abs(t)>Math.PI?s=2*(Math.PI-o)-c:l=c}this.dimensionLine.extend(s,l),this.flipText(!0)}},
/**
 * update dimension position
 * @private
 *
 * @param length the float length
 */
AngularDimension.prototype.move=function(e){var t=this.dragDirection.clone().multiplyScalar(e),n=(new _.Matrix4).makeTranslation(t.x,t.y,t.z),r=(this.radius+e)/this.radius;this.radius*(this.radius+e)<0&&this.dimensionLine.flipArrow(!0),Math.abs(e)<this.inverseLength&&((this.radius-this.inverseLength)*(this.radius+e-this.inverseLength)<0||(this.radius+this.inverseLength)*(this.radius+e+this.inverseLength)<0)&&this.dimensionLine.flipArrow(),this.radius+=e,this.text3D.applyMatrix(n),this.dimensionLine.resize(r),this.extensionLine1.updatePosition(e*this._extension1Sign),this.extensionLine2.updatePosition(e*this._extension2Sign)},AngularDimension.prototype.flipArrow=function(){this.dimensionLine.flipArrow()},AngularDimension.prototype.updateDimensionLine=function(){if(this.text3D.options.textOrientation!==Er.Over){
//caculate the angle
var e,t=0,n=0,r=this.getTextSize(),i=r.width/2,a=r.height/2,o=Math.atan(a/i),s=new _.Vector3,l=new _.Quaternion,c=new _.Vector3;this.text3D.matrix.decompose(s,l,c);var u=this.text3D.right.clone();u.applyQuaternion(l);var h=0,d=u.angleTo(this.tangentDirection);d>Math.PI/2&&(d=Math.PI-d),h=d>o?a/Math.cos(Math.PI/2-d):i/Math.cos(d),e=Math.atan(h/Math.abs(this.radius)),t=this.dimensionLine.radians/2-e+this.rotateAngle,n=this.dimensionLine.radians/2-e-this.rotateAngle,this.startDragged?t>this.currentStartAngle&&(t=this.currentStartAngle):this.currentStartAngle=t,this.endDragged?n>this.currentEndAngle&&(n=this.currentEndAngle):this.currentEndAngle=n,this.dimensionLine.divide(t,n)}};
/* harmony default export */var si=AngularDimension,li=Math.PI/45,ci=function(e){return[Math.cos(e),Math.sin(e),0]},ui=function(e){var t=Math.floor(e/Math.PI/2);return e-=2*Math.PI*t},hi=91,di=92,pi=93,fi=94;
// CONCATENATED MODULE: ./staging/dimension/CircleExtensionLine.js
//Â© 2018 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//import Debug from "debug";
//var warning = Debug( "PLMVisWeb:warning:CircleExtensionLine" );
// angleFrom, angleTo: radians of angle
function CircleExtensionLine(e,t,n,r,i,a){_.Object3D.call(this),this.type="CircleExtensionLine",this.radius=r;var o=[];
// Change to none clock wise
if(new _.EllipseCurve(0,0,1,1,0,2*Math.PI,!1,0).getPoints(2*Math.PI/li).forEach(function(e){o.push(e.x,e.y,0)}),t=ui(t),n=ui(n),i){var s=t;t=n,n=s}var l=(new _.Matrix4).makeRotationZ(t);
// Cache the original setting
this.isClockWise=i,this.radians=t<=n?n-t:2*Math.PI+n-t,this.originalAngleFrom=t,this.originalAngleTo=n,this.angleFromOffset=0,this.angleToOffset=0,t=0,n=this.radians,this._originalPointFrom=[1,0,0],this._originalPointTo=ci(n),o=o.concat(this._originalPointFrom,this._originalPointFrom,this._originalPointTo,this._originalPointTo),this._indexFrom=0,this._indexTo=Math.floor(n/li),this._indexMiddleFrom=0,this._indexMiddleTo=Math.ceil(n/li),this._negIndexFrom=Math.PI/li,this._negIndexTo=this._indexTo+this._negIndexFrom;
// create side 1 and side 2 circle line
var c=(new _.Matrix4).makeScale(r,r,r);this.side1Line=new CircleLineComponent(o,a,xr.ExtensionLinePrimary,_r.Side1),this.side2Line=new CircleLineComponent(o,a,xr.ExtensionLinePrimary,_r.Side2),this._side1LineGeo=this.side1Line.geometry,this._side2LineGeo=this.side2Line.geometry,this.side1Line.applyMatrix(c),this.side2Line.applyMatrix(c),this.add(this.side1Line),this.add(this.side2Line),
// hide extension lines when creation
this.side1Line.visible=!1,this.side2Line.visible=!1,this._updateIndices(),this.applyMatrix(l);var u=(new _.Matrix4).makeTranslation(e.x,e.y,e.z);this.applyMatrix(u)}CircleExtensionLine.prototype=Object.create(_.Object3D.prototype),CircleExtensionLine.prototype.constructor=CircleExtensionLine,CircleExtensionLine.prototype._updateIndices=function(e){
// if side is not specified, update both sides
if(!e)return this._updateIndices(_r.Side1),void this._updateIndices(_r.Side2);var t,n;switch(e){case _r.Side1:t=mi(this._indexFrom,this._indexMiddleFrom,this._negIndexFrom,e),n=this._side1LineGeo;break;case _r.Side2:t=mi(this._indexTo,this._indexMiddleTo,this._negIndexTo,e),n=this._side2LineGeo}t&&(n.setIndex(new _.BufferAttribute(new Uint16Array(t),1)),n.computeBoundingBox(),n.computeBoundingSphere())};var mi=function(){
// the offset for addStartPointFirst = false, addStartPointFirst = true and point index
var e,t,n,r,i,a={Side1:{anchor:[0,-1,hi],start:[0,1,di]},Side2:{anchor:[1,0,fi],start:[-1,0,pi]}};return function(o,s,l,c){if(c===_r.Side1||c===_r.Side2){var u=a[c],h=!0;c===_r.Side2&&(h=!(0===o&&1===s));var d=[],p=!1,f=null;for(l>s?o>s?o>l?f=[o+u.anchor[0],hi-1,0,s+u.start[0]]:(p=!0,f=[s+u.start[1],o+u.anchor[1]]):f=[o+u.anchor[0],s+u.start[0]]:o<s?o<l&&h?(p=!0,f=[s+u.start[1],hi-1,0,o+u.anchor[1]]):f=[o+u.anchor[0],s+u.start[0]]:(p=!0,f=[s+u.start[1],o+u.anchor[1]]),r=p?u.start[2]:u.anchor[2],i=p?u.anchor[2]:u.start[2],d.push(r),t=0,n=f.length/2;t<n;t++)for(e=f[2*t];e<=f[2*t+1];e++)d.push(e,e);return d.push(i),d}}}();
// drag the start point of circle extension line
CircleExtensionLine.prototype.dragStartPoint=function(){var e={Side1:"angleFromOffset",Side2:"angleToOffset"},t=new _.Vector3,n=new _.Vector3,i=new _.Quaternion;return function(a,o){if(o===_r.Side1||o===_r.Side2){this.matrixWorld.decompose(t,i,n);var s=o===_r.Side1,l=s?this.pointMiddleFrom:this.pointMiddleTo;n.fromArray(l),t.set(0,0,1).cross(n),t.applyQuaternion(i),n.copy(a).projectOnVector(t);var c=r.b._isZero(n.angleTo(t))?1:-1,u=(d=Math.atan(n.length()*c/this.radius))*(s?1:-1),h=e[o];this[h]+=u;var d=ui(this[h]);if(this[h]>0&&d>Math.PI+this.radians?this[h]=d-2*Math.PI:this[h]<=0&&d<Math.PI-this.radians&&(this[h]=d),s)this.pointMiddleFrom=ci(d),this._indexMiddleFrom=Math.floor(d/li);else{var p=ui(this.radians-d);this.pointMiddleTo=ci(p),this._indexMiddleTo=Math.ceil(p/li)}this._updateIndices(o)}}}(),CircleExtensionLine.prototype.extend=function(e,t){e<0||t<0||(
// change visibility of extension lines
this.side1Line.visible=0!==e,this.side2Line.visible=0!==t,e=Math.min(ui(e),2*Math.PI-this.radians),t=Math.min(ui(t),2*Math.PI-this.radians),this._indexFrom=0===e?0:Math.ceil((2*Math.PI-e)/li),this._indexTo=Math.floor((this.radians+t)/li),this.pointFrom=ci(2*Math.PI-e),this.pointTo=ci(this.radians+t),this._updateIndices())},CircleExtensionLine.prototype.getVisibleLine=function(e){var t=null;switch(e){case _r.Side1:this.side1Line.visible&&(t=this.side1Line);break;case _r.Side2:this.side2Line.visible&&(t=this.side2Line)}return t},Object.defineProperties(CircleExtensionLine.prototype,{pointFrom:{get:function(){var e=this._side1LineGeo.attributes.position.array;return[e[273],e[274],e[275]];// index 91
},set:function(e){r.b._updatePositionFromArray(this._side1LineGeo.attributes.position,e,hi)}},pointMiddleFrom:{get:function(){var e=this._side1LineGeo.attributes.position.array;return[e[276],e[277],e[278]];// index 92
},set:function(e){r.b._updatePositionFromArray(this._side1LineGeo.attributes.position,e,di)}},pointMiddleTo:{get:function(){var e=this._side2LineGeo.attributes.position.array;return[e[279],e[280],e[281]];// index 93
},set:function(e){r.b._updatePositionFromArray(this._side2LineGeo.attributes.position,e,pi)}},pointTo:{get:function(){var e=this._side2LineGeo.attributes.position.array;return[e[282],e[283],e[284]];// index 94
},set:function(e){r.b._updatePositionFromArray(this._side2LineGeo.attributes.position,e,fi)}}}),CircleExtensionLine.prototype.setMaterial=function(e){e&&(this.side1Line.material=e,this.side2Line.material=e)};
/* harmony default export */var gi=CircleExtensionLine;
// CONCATENATED MODULE: ./staging/dimension/RadialDimension.js
//Â© 2018 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//var warning = Debug( "PLMVisWeb:warning:RadialDimension" );
function RadialDimensionLine(){_.Object3D.call(this)}function RadialDimension(e,t,n,i,a,o,s,l){
// CIRCLEDEF:
// center - Center point of circle curve
// normal - Normal direction of circle curve( Only used when no start and end parameters )
// start - Start point of existing circle curve
// end - End point of existing circle curve
// showRadius - Flag to show radius line
// showDiameter - Flag to show diameter line( ignore radius if set to true)
// alwaysShow - Flag to always show radius or diameter lines
// showArrow - Flag to show arrow on radius or diameter line
// textInside - Flag to show text inside the circle curve
// OPTIONS:
// insideCircle : DEPRECATED. the boolean flag to show text inside the circle curve (default is false)
// textDisplayHeight : pixel value to make text bigger/smaller (default is 20)
// textOverFactor : distance from baseline to text (default is 25% of the scaled text height)
// textColor : THREE.Color input for text -- FUTURE
// leaderColor : THREE.Color input for leader lines -- FUTURE
// baselineColor : THREE.Color input for baseline -- FUTURE
var c={text:t,options:l};l.textOrientation=Er.Aligned,Nr.call(this,e,c),this.type="RadialDimension",this.textInside=r.b._notNullOrUndefined(s.textInside)?s.textInside:l.insideCircle,
// Initialize the property, will be changed when the text is dragged
this.textInCenter=this.textInside;var u=s.center,h=s.start||n,d=s.end||n,p=s.normal;this.isRadius=s.isRadius,this.alwaysShow=s.alwaysShow,this.showArrow=s.showArrow,
// Properties for drag dimensionLine
this.lastDragStart=new _.Vector3,this.lastDragSign=1;
// Convert parameters to Vector3
var f=(new _.Vector3).fromArray(n);this.origin=f;var m=this.getScale(),g=this.getTextScale();this.currentArrowLength=l.arrowLength*m,this.textPadding=l.textPadding,this.currentTextPadding=l.textPadding*g;var v={arrowLength:this.currentArrowLength};isNaN(o)&&(o=l.stubLineLength*g),this.stubLineLength=o/g||l.stubLineLength,isNaN(a)&&(a=0);var y=(new _.Vector3).fromArray(u),b=(new _.Vector3).fromArray(h),x=(new _.Vector3).fromArray(d),w=f.clone().sub(y).normalize(),M=(new _.Vector3).fromArray(i).normalize(),E=f.clone().add(w.clone().multiplyScalar(a)),S=E.clone().add(M.clone().multiplyScalar(o));this.baseDirection=M.clone();var L=new _.Quaternion,T=new _.Matrix4,A=new _.Vector3(0,0,0),C=new _.Vector3(1,0,0),P=b.clone().sub(y).normalize();r.b._isZero(P)&&(P=E.clone().sub(f).normalize()),L.setFromUnitVectors(P,C);var I=(new _.Matrix4).makeRotationFromQuaternion(L),O=f.clone().sub(y).applyMatrix4(I),B=E.clone().sub(y).applyMatrix4(I),R=S.clone().sub(y).applyMatrix4(I),G=x.clone().sub(y).applyMatrix4(I),D=G.clone().cross(C);
// Rotate to xy-plane
if(r.b._isZero(D.length())&&(D=B.clone().cross(R),r.b._isZero(D.length())&&p&&(D=(new _.Vector3).fromArray(p).applyMatrix4(I),r.b._isZero(D.clone().dot(C))||(D=D.sub(D.clone().projectOnVector(C))))),D.normalize(),!r.b._isZero(D.length())&&!r.b._isZero(Math.abs(D.z)-1)){L.setFromUnitVectors(D,new _.Vector3(0,0,1));var V=T.makeRotationFromQuaternion(L);I.premultiply(V),O.applyMatrix4(V),B.applyMatrix4(V),R.applyMatrix4(V),G.applyMatrix4(V)}w.applyMatrix4(I),M.applyMatrix4(I),
// adjust the text direction to the xy-plane
M.z=0,M.normalize(),this.dragDirection=B.clone().normalize(),this.tangentDirection=new _.Vector3(0,0,1).cross(this.dragDirection).normalize(),this.rotateAngle=0,this.textOffset=B.length(),this.radius=G.length();
// update text position
var N,U=this.getTextSize();this.currentTextLength=U.width,this.currentTextHeight=U.height,this.textInside?(N=this.isRadius?O.clone().multiplyScalar(.5):A,this.textOffset=N.length()):N=R.clone().add(M.clone().multiplyScalar(this.currentTextLength/2+this.currentTextPadding)),L.setFromUnitVectors(C,M),this.text3D.applyMatrix(T.makeRotationFromQuaternion(L)),this.text3D.applyMatrix((new _.Matrix4).setPosition(N)),this.updateTextScale(),
// Create Radial Dimension line
this.dimensionLine=new RadialDimensionLine,this.add(this.dimensionLine);
// Create leader Line
var F=r.b._isZero(a)?O.clone().add(w.clone().multiplyScalar(this.textOffset-this.radius)):B;this.leaderLine=new ArrowLineComponent(F,O,this.materials.extensionLine,v,xr.ArrowLine),(this.alwaysShow&&this.showArrow||this.textInside)&&(this.leaderLine.arrow.visible=!1),this.textInside&&this.leaderLine.arrow.flipArrow(),this.leaderLine.visible=!r.b._isZero(a),
// Create baseline
this.baseTextOffset=r.b._isZero(o)?M.clone().multiplyScalar(this.stubLineLength*m):R.clone().sub(F),this.stubLine=new LineComponent(F.clone().add(this.baseTextOffset),F,this.materials.dimensionLine,null,xr.StubLine),this.add(this.stubLine),this.stubLine.visible=!r.b._isZero(o),
// the secondary radius line is for divide the radius line
this.secondaryRadiusLine=new LineComponent(A,O,this.materials.extensionLine,null,xr.ArrowLine),
// Create radius or diameter line
this.radiusLine=new ArrowLineComponent(A,O,this.materials.extensionLine,v,xr.ArrowLine),this.negRadiusLine=new ArrowLineComponent(A,O.clone().negate(),this.materials.extensionLine,v,xr.ArrowLine),this.showArrow||(this.radiusLine.arrow.visible=!1,this.negRadiusLine.arrow.visible=!1),this.negRadiusLine.visible=!this.isRadius,
// Add component into dimension line
this.dimensionLine.add(this.leaderLine),this.dimensionLine.add(this.secondaryRadiusLine),this.dimensionLine.add(this.radiusLine),this.dimensionLine.add(this.negRadiusLine),this.adjustRadiusLine();
// Calculate Circle Variables
var z,k=G.angleTo(C),j=O.angleTo(C);this.radians=k,this.originRadians=j,// make sure the circle curve contains the origin point
k<j?(z=G.y>0,this.radians=2*Math.PI-k,this.originRadians=2*Math.PI-j):z=r.b._isZero(j)?G.y<0:O.y<0;var H=!r.b._isZero(k)&&z;H?k=2*Math.PI-k:this.originRadians=this.radians-this.originRadians,
// Create Circle Curve
this.extensionLine=new gi(A,0,k,this.radius,H,this.materials.extensionLine),this.add(this.extensionLine);
// Make transform from xy-plane to world
var W=T.getInverse(I),X=(new _.Matrix4).setPosition(y);this.matrix=X.multiply(W),this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0)}RadialDimensionLine.prototype=Object.create(_.Object3D.prototype),RadialDimensionLine.prototype.constructor=RadialDimensionLine,RadialDimensionLine.prototype.getControlPoint=function(e,t){var n=null;if(this.parent&&this.parent.getDimensionArrowLine){var r=this.parent.getDimensionArrowLine(e,t);r&&(n=r.getControlPoint(e,!0))}return n},RadialDimension.prototype=Object.create(Nr.prototype),RadialDimension.prototype.constructor=RadialDimension,RadialDimension.prototype.updateTextPosition=function(){var e=new _.Vector3,t=new _.Quaternion,n=new _.Vector3,i=new _.Vector3;return function(a){this.matrixWorld.decompose(e,t,n);var o=this.dragDirection.clone().applyQuaternion(t),s=this.tangentDirection.clone().applyQuaternion(t),l=a.clone().projectOnVector(o),c=a.clone().projectOnVector(s),u=r.b._isZero(l.angleTo(o))?1:-1,h=r.b._isZero(c.angleTo(s))?1:-1;i.fromArray(this.leaderLine.startPt),i.applyMatrix4(this.leaderLine.matrix),this.rotate(c.length()*h),this.move(l.length()*u,c.length()*h,i)}}(),RadialDimension.prototype.updateComponentPositionInnel=function(){var e=new _.Vector3,t=new _.Quaternion,n=new _.Vector3,i=new _.Vector3;return function(a,o,s,l){switch(s){
// when drag dimension line, only rotate
case xr.ArrowLine:this.matrixWorld.decompose(e,t,n);var c=i.subVectors(o,e),u=c.length();if(!r.b._isZero(u)){var h,d=this.dragDirection.clone().applyQuaternion(t);
// Calculate the direction of drag only when drag start
this.lastDragStart.equals(o)?h=this.lastDragSign:(this.lastDragStart.copy(o),h=c.angleTo(d)>Math.PI/2?-1:1,this.lastDragSign=h);var p=this.textOffset*h;r.b._isZero(p)&&(p=.01);var f=p/u,m=this.tangentDirection.clone().applyQuaternion(t),g=a.clone().projectOnVector(m),v=r.b._isZero(g.angleTo(m))?1:-1;
// cache the old leader line start point
i.fromArray(this.leaderLine.startPt),i.applyMatrix4(this.leaderLine.matrix);var y=g.length()*f*v;this.rotate(y,!0),this.move(0,y,i)}break;
// when drag stub line, only extend
case xr.StubLine:this.matrixWorld.decompose(e,t,n);d=this.dragDirection.clone().applyQuaternion(t);var b=a.clone().projectOnVector(d),x=r.b._isZero(b.angleTo(d))?1:-1;
// cache the old leader line start point
i.fromArray(this.leaderLine.startPt),i.applyMatrix4(this.leaderLine.matrix),this.move(b.length()*x,0,i)}}}(),RadialDimension.prototype.updateControlPointInnel=function(){var e=new _.Quaternion,t=new _.Vector3,n=new _.Vector3,r=new _.Matrix4,i=new _.Matrix4;return function(a,o,s){switch(o){case br.TextCenter:this.updateTextPosition(a);break;case br.StubLineStart:var l=(m=a.clone().projectOnVector(this.baseDirection)).angleTo(this.baseDirection)>Math.PI/2?-1:1,c=m.length()*l,u=this.stubLine.length,h=this.stubLine.length+c;this.stubLine.setPrimaryLineLength(h),this.stubLineLength=this.stubLine.length/this.getTextScale();var d=this.stubLine.direction.clone().multiplyScalar(-this.stubLine.length),p=this.stubLine.length<0?1:-1,f=t.subVectors(d,this.baseTextOffset);u*this.stubLine.length<0&&(this.updateTextPadding(),f.add(this.stubLine.direction.clone().multiplyScalar((this.currentTextLength+2*this.currentTextPadding)*p))),this.baseTextOffset=d,this.text3D.applyMatrix(r.setPosition(f));break;case br.ArrowLineStart:if(!this.negRadiusLine.visible&&this.textInCenter&&s!==_r.Side2){this.secondaryRadiusLine.matrixWorld.decompose(t,e,n),i.getInverse(r.makeRotationFromQuaternion(e));var m=this.secondaryRadiusLine.direction,g=a.clone().applyMatrix4(i).projectOnVector(m);l=g.angleTo(m)>Math.PI/2?1:-1,c=g.length()*l;this.secondaryRadiusLine.length+c>0&&this.secondaryRadiusLine.relocate(g)}break;case br.ExtensionLineStart:this.extensionLine.dragStartPoint(a,s)}}}(),
/**
 * Update angular dimension material.
 * @private
 *
 * @param {Object} updatedMaterials the updated demension material
 */
RadialDimension.prototype.updateMaterial=function(e){e.extensionLine&&(this.leaderLine.setMaterial(e.extensionLine),this.radiusLine.setMaterial(e.extensionLine),this.negRadiusLine.setMaterial(e.extensionLine),this.secondaryRadiusLine.material=e.extensionLine),e.dimensionLine&&(this.extensionLine.setMaterial(e.dimensionLine),this.stubLine.material=e.dimensionLine),e.text&&(this.text3D.textObject.material=e.text)}
/**
 * rotate dimension text and arc
 * param tangent {float}: length of tangent direction
 * param force {boolean}: true for always do rotating
 */,RadialDimension.prototype.rotate=function(e,t){if(!(Math.abs(this.textOffset)<=.5)||t){var n,r=Math.atan(e/this.textOffset),i=(new _.Matrix4).makeRotationZ(r);this.rotateAngle+=r,this.radiusLine.applyMatrix(i),this.secondaryRadiusLine.applyMatrix(i),this.negRadiusLine.applyMatrix(i),this.dragDirection.applyMatrix4(i),this.tangentDirection.applyMatrix4(i),this.leaderLine.applyMatrix(i),n=this.rotateAngle<0?this.rotateAngle-Math.ceil(this.rotateAngle/Math.PI/2)*Math.PI*2:this.rotateAngle-Math.floor(this.rotateAngle/Math.PI/2)*Math.PI*2,this.rotateAngle=n;var a=this.radians/2;n+=a-this.originRadians;var o=0,s=0;if(Math.abs(n)>a&&Math.abs(n)<2*Math.PI-a){var l=Math.abs(n)-a;n<0?Math.abs(n)<Math.PI?o=l:s=2*(Math.PI-a)-l:Math.abs(n)>Math.PI?o=2*(Math.PI-a)-l:s=l}this.extensionLine.extend(o,s),this.flipText(!0)}},
/**
 * update dimension position
 * params  length  {float}: length of drag direction
 *         tangent {float}: length of tangent direction
 *         leaderLineStartPt {Vector3}: start point before change position
 */
RadialDimension.prototype.move=function(e,t,n){var r=this.textOffset;if(Math.abs(this.textOffset)>.5){var i=this.textOffset<0?-1:1;this.textOffset+=i*(Math.sqrt(t*t+this.textOffset*this.textOffset)-Math.abs(this.textOffset))}this.textOffset+=e,(Math.abs(r)-this.radius)*(Math.abs(this.textOffset)-this.radius)<0&&(Math.abs(this.textOffset)<this.radius?(this.textOffset>0||!this.isRadius)&&(this._showLeaderAndBase(!1),this.adjustText()):(this.textOffset<0&&(this._showRadiusOrDiameter(!0),this.leaderLine.arrow.visible=!1,this.radiusLine.arrow.visible=!0),(this.textOffset>0||!this.isRadius)&&this.adjustText(),this._showLeaderAndBase(!0))),(Math.abs(r)-this.radius-this.currentArrowLength)*(Math.abs(this.textOffset)-this.radius-this.currentArrowLength)<0&&this.adjustArrow(),r*this.textOffset<0&&this.isRadius&&(this.textOffset<0?(this._showLeaderAndBase(!0),this.leaderLine.arrow.visible=!1,this.adjustText()):(this._showLeaderAndBase(!1),this.adjustText()));var a=this.textInside?r-this.textOffset:this.textOffset-r,o=this.leaderLine.length+a;this.leaderLine.setPrimaryLineLength(o);var s=(new _.Vector3).fromArray(this.leaderLine.startPt).applyMatrix4(this.leaderLine.matrix).sub(n),l=(new _.Matrix4).setPosition(s);this.text3D.applyMatrix(l),this.stubLine.applyMatrix(l),this.adjustRadiusLine()},RadialDimension.prototype.flipArrow=function(){
// TODO to be implemented
},RadialDimension.prototype._showLeaderAndBase=function(e){this.leaderLine.visible=e,this.stubLine.visible=e},RadialDimension.prototype._showRadiusOrDiameter=function(e){this.radiusLine.visible=e,this.isRadius||(this.negRadiusLine.visible=e)},RadialDimension.prototype.adjustArrow=function(){var e,t;Math.abs(this.textOffset)-this.radius-this.currentArrowLength<0?this.alwaysShow?this.showArrow||(e=!1,t=!0):(this._showRadiusOrDiameter(!0),e=!1,t=!0):this.textOffset<0?(this._showRadiusOrDiameter(!0),e=!1,t=!0):this.alwaysShow?this.showArrow||(e=!0,t=!1):(this._showRadiusOrDiameter(!1),e=!0),void 0!==e&&(this.leaderLine.arrow.visible=e),void 0!==t&&(this.radiusLine.arrow.visible=t,this.isRadius||(this.negRadiusLine.arrow.visible=t))},RadialDimension.prototype.adjustRadiusLine=function(){if(
// secondary radius line should be turned off by default
this.secondaryRadiusLine.visible=!1,this.textInCenter){var e=this.baseTextOffset.clone().normalize().projectOnVector(this.dragDirection).length(),t=e*this.currentTextLength,n=Math.sqrt(1-e*e)*this.currentTextHeight;this.updateTextPadding();var r=Math.abs(t-n)/2+this.currentTextPadding;if(this.textOffset<r&&this.negRadiusLine.setPrimaryLineLength(Math.max(this.radius+this.textOffset-r,0)),this.textOffset-r>0){
// center of the circle is always [0,0,0]
var i=this.textOffset-r,a=this.secondaryRadiusLine.endPt[0],o=this.secondaryRadiusLine.length+(i-a);o>0&&(this.secondaryRadiusLine.setPrimaryLineLength(o,!0),this.secondaryRadiusLine.visible=!0)}this.radiusLine.setPrimaryLineLength(Math.max(this.radius-this.textOffset-r,0))}else this.radiusLine.setPrimaryLineLength(this.radiusLine.originalLength),this.negRadiusLine.setPrimaryLineLength(this.negRadiusLine.originalLength)},RadialDimension.prototype.adjustText=function(){this.updateTextPadding();var e=this.baseTextOffset.clone().multiplyScalar(1+(this.currentTextLength/2+this.currentTextPadding)/this.baseTextOffset.length()),t=new _.Matrix4;this.textInCenter||(e=e.negate()),t.makeTranslation(e.x,e.y,e.z),this.text3D.applyMatrix(t),this.textInCenter=!this.textInCenter},RadialDimension.prototype.calculateTextPosition=function(){var e=this.getTextSize().width;if(!this.textInCenter){var t=new _.Matrix4,n=this.baseTextOffset.clone().multiplyScalar((e/2-this.currentTextLength/2)/this.baseTextOffset.length());t.makeTranslation(n.x,n.y,n.z),this.text3D.applyMatrix(t)}
// get current arrow length
var r=this.leaderLine.arrow.arrowLength;(Math.abs(this.textOffset)-this.radius-r)*(Math.abs(this.textOffset)-this.radius-this.currentArrowLength)<0?(this.currentArrowLength=r,this.adjustArrow()):this.currentArrowLength=r,this.currentTextLength=e,this.currentTextHeight=this.getTextSize().height,this.adjustRadiusLine()},RadialDimension.prototype.updateDimensionLine=function(){var e=this.getTextScale();this.stubLine.setPrimaryLineLength(this.stubLineLength*e);var t=this.baseTextOffset.clone();this.baseTextOffset.multiplyScalar(Math.abs(this.stubLine.length)/this.baseTextOffset.length()),this.textInCenter||(this.text3D.applyMatrix((new _.Matrix4).setPosition((new _.Vector3).subVectors(this.baseTextOffset,t))),this.updateTextPadding())},RadialDimension.prototype.updateTextPadding=function(){var e=this.getTextScale(),t=this.textPadding*e;if(this.currentTextPadding!==t&&!this.textInCenter){var n=this.baseTextOffset.clone().normalize().multiplyScalar(t-this.currentTextPadding);this.text3D.applyMatrix((new _.Matrix4).setPosition(n))}this.currentTextPadding=t},RadialDimension.prototype.getDimensionArrowLine=function(e,t){var n=null;switch(t){case _r.Side2:this.negRadiusLine.visible&&(e!==br.ArrowHeadStart||e===br.ArrowHeadStart&&this.negRadiusLine.arrow.visible)&&(n=this.negRadiusLine);break;case _r.Side1:default:switch(n=this.radiusLine.visible?this.radiusLine:this.leaderLine,e){case br.ArrowHeadStart:this.radiusLine.arrow.visible||(n=this.leaderLine);break;case br.ArrowLineStart:!this.negRadiusLine.visible&&this.textInCenter&&this.secondaryRadiusLine.visible&&(n=this.secondaryRadiusLine)}}return n},RadialDimension.prototype.getStubLine=function(){return this.textInCenter?null:this.stubLine},RadialDimension.prototype.getExtensionLine=function(e,t){return!t&&Math.abs(this.rotateAngle+this.radians/2-this.originRadians)>this.radians/2?this.extensionLine.getVisibleLine(e):null},RadialDimension.prototype.getDimensionLine=function(){return this.dimensionLine};
/* harmony default export */var vi=RadialDimension;
// CONCATENATED MODULE: ./staging/dimension/OneSideDimension.js
function OneSideDimension(e,t){Vr.call(this,e,t)}OneSideDimension.prototype=Object.create(Vr.prototype),OneSideDimension.prototype.constructor=OneSideDimension,OneSideDimension.prototype.getDimensionLine=function(){return this.dimensionLine};
/* harmony default export */var yi=OneSideDimension;
// CONCATENATED MODULE: ./staging/dimension/NoteDimension.js
//Â© 2018 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
// import Debug from "debug";
// var warning = Debug( "PLMVisWeb:warning:NoteDimension" );
// OPTIONS:
// textDisplayHeight : pixel value to make text bigger/smaller (default is 20)
// textOverFactor : distance from baseline to text (default is 25% of the scaled text height)
// textColor : THREE.Color input for text
// extensionColor : THREE.Color input for extension lines
// baselineColor : THREE.Color input for baseline
// enableScreenRelativeSize: whether to enable screen relative size for text and arrow, default relative to model size.
function NoteDimension(e,t,n,r,i,a){var o={text:i,options:a};yi.call(this,e,o),this.type="NoteDimension",a=a||{},this.origin=t.clone();var s=this.getScale(),l=this.getTextScale();isNaN(r)&&(r=a.stubLineLength*l),this.stubLineLength=r/l;var c=new _.Vector3(1,0,0),u=(new _.Vector3(0,1,0),new _.Vector3(0,0,1)),h=new _.Vector3(0,0,0),d=new _.Vector3;this._viewer._currentCamera.getWorldDirection(d);var p=(new _.Vector3).crossVectors(d,this._viewer._currentCamera.up);
//Dimension parameters.
this.heightDirection=this._viewer._currentCamera.up.clone(),this.widthDirection=p.clone(),this.normal=d,this.controlPt1=(new _.Vector3).addVectors(h,c.clone().applyAxisAngle(u,Math.PI/4).setLength(n)),this.controlPt2=(new _.Vector3).addVectors(this.controlPt1,c.clone().setLength(r)),this.dimensionLine=new ArrowLineComponent(this.controlPt1.clone(),h.clone(),this.materials.dimensionLine,{arrowLength:a.arrowLength*s},xr.ArrowLine),this.add(this.dimensionLine),this.stubLine=new LineComponent(this.controlPt2.clone(),this.controlPt1.clone(),this.materials.extensionLine,null,xr.StubLine),this.add(this.stubLine);
// Calculate the transformation matrix for the frame (positions the entire dimension in 3D space):
var f=(new _.Matrix4).lookAt(h,d,this._viewer._currentCamera.up);this.matrix.makeTranslation(this.origin.x,this.origin.y,this.origin.z),// translation
this.matrix.multiply(f),// rotation, eye at the this.origin
this.matrixAutoUpdate=!1,this.updateMatrixWorld(!0),
// update text position
this.updateTextMatrix()}NoteDimension.prototype=Object.create(yi.prototype),NoteDimension.prototype.constructor=NoteDimension,NoteDimension.prototype.calculateTextPosition=function(){var e=this.getTextSize(),t=e.width,n=(e.height,(new _.Vector3).subVectors(this.controlPt2,this.controlPt1).angleTo(this.widthDirection)<Math.PI/2?1:-1);this.text3D.matrix.setPosition(new _.Vector3(this.controlPt2.x+t/2*n,this.controlPt2.y,this.controlPt2.z)),Vr.prototype.calculateTextPosition.call(this)},NoteDimension.prototype.updateTextPosition=function(e){var t=e.clone().projectOnVector(this.heightDirection),n=e.clone().projectOnVector(this.widthDirection),r=t.angleTo(this.heightDirection)<.01?1:-1,i=n.angleTo(this.widthDirection)<.01?1:-1,a=n.length()*i,o=r*t.length(),s=new _.Vector3(a,o,0);this.dimensionLine.relocateArrowLine(s),this.stubLine.relocate(s,s),this.controlPt1=(new _.Vector3).addVectors(this.controlPt1,s),this.controlPt2=(new _.Vector3).addVectors(this.controlPt2,s);
//text translation
var l=(new _.Matrix4).makeTranslation(a,o,0);this.text3D.applyMatrix(l)},NoteDimension.prototype.updateControlPointInnel=function(e,t){switch(t){case br.ArrowLineStart:case br.StubLineEnd:case br.TextCenter:this.updateTextPosition(e);break;case br.StubLineStart:var n=e.clone().projectOnVector(this.widthDirection),r=n.angleTo(this.widthDirection)>Math.PI/2?-1:1,i=n.length()*r,a=this.stubLine.direction.angleTo(this.widthDirection)<Math.PI/2?-1:1,o=this.stubLine.length+i*a;this.stubLine.setPrimaryLineLength(o),this.stubLineLength=this.stubLine.length/this.getTextScale(),this.controlPt2=(new _.Vector3).fromArray(this.stubLine.startPt),this.calculateTextPosition()}},NoteDimension.prototype.updateComponentPositionInnel=function(){var e=new _.Vector3,t=new _.Vector3,n=new _.Matrix4,i=new _.Quaternion;return function(a,o,s,l){switch(s){
// when drag dimension line, only rotate
case xr.ArrowLine:var c=e.subVectors(o,this.origin).length();if(!r.b._isZero(c)){var u=this.controlPt1.length()/c;t.crossVectors(this.normal,this.controlPt1);var h=e.copy(a).projectOnVector(t);
// scale the drag vector
h.multiplyScalar(u);var d=t.addVectors(this.controlPt1,h).normalize();
// calculate the rotation from the old pt1 to new pt1
i.setFromUnitVectors(e.copy(this.controlPt1).normalize(),d),n.makeRotationFromQuaternion(i);
// rotate pt1 to get the needed pt1
var p=e.copy(this.controlPt1).applyMatrix4(n),f=t.subVectors(p,this.controlPt1);this.updateTextPosition(f)}break;
// when drag stub line, only extend
case xr.StubLine:e.copy(a).projectOnVector(this.controlPt1);var m=e.angleTo(this.controlPt1)>Math.PI/2?-1:1;this.dimensionLine.length+e.length()*m>0&&(this.dimensionLine.setPrimaryLineLength(this.dimensionLine.length+e.length()*m),this.stubLine.relocate(e,e),this.controlPt1.add(e),this.controlPt2.add(e),this.text3D.applyMatrix(n.makeTranslation(e.x,e.y,e.z)))}}}(),NoteDimension.prototype.updateDimensionLine=function(){var e=this.getTextScale();this.stubLine.setPrimaryLineLength(this.stubLineLength*e),this.controlPt2=(new _.Vector3).fromArray(this.stubLine.startPt),this.calculateTextPosition()},
/**
 * Update dimension material.
 * @private
 *
 * @param {Object} updatedMaterials the updated dimension material
 */
NoteDimension.prototype.updateMaterial=function(e){e.extensionLine&&(this.stubLine.material=e.extensionLine),e.dimensionLine&&this.dimensionLine.setMaterial(e.dimensionLine),e.text&&(this.text3D.textObject.material=e.text)};
/* harmony default export */var bi=NoteDimension;
// CONCATENATED MODULE: ./staging/dimension/FontsLoader.js
//Â© 2019 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
function FontsLoader(){this.fonts={},this.loader=new _.FontLoader}FontsLoader.prototype.load=function(e){var t=this;return new Promise(function(n,r){if(e||r("The font path does not exist!"),t.fonts[e])n();else{var i=t.loader;i||(i=new _.FontLoader),i.load(e,
//onLoaded callback
function(r){t.fonts[e]=r,n()},
// onProgress callback
function(e){},
// onError callback
function(e){r(e)})}})},FontsLoader.prototype.getFont=function(e){var t=e;return e&&"string"==typeof e&&this.fonts[e]&&(t=this.fonts[e]),t},FontsLoader.prototype.clearFonts=function(){this.fonts={}},FontsLoader.prototype.removeFont=function(e){this.fonts[e]&&(this.fonts[e]=void 0)};
/* harmony default export */var xi=FontsLoader,_i=o()("PLMVisWeb:error:Dimension");
// CONCATENATED MODULE: ./staging/dimension/Dimension.js
//Â© 2016 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
//var debug = Debug( "PLMVisWeb:debug:Dimension" );
_i.enabled=!0;var wi=o()("PLMVisWeb:warning:Dimension"),Mi=function(e,t,n){return r.b._isNullOrUndefined(e)&&(e=0),t===wr.Dashed?new _.LineDashedMaterial({color:e,dashSize:.001,gapSize:.001}):r.b._createLineMaterial(e,1,n,!1,!1)},Ei=function(e,t,n){n===wr.Solid?e.uniforms.diffuse.value.setHex(t):e.color.setHex(t)},Si=function(e){return Li(e)===wr.Solid?e.uniforms.diffuse.value.getHex():e.color.getHex()},Li=function(e){return e instanceof _.LineDashedMaterial?wr.Dashed:wr.Solid},Ti={HighlightColor:"highlightColor",SelectionColor:"selectionColor",EnableScreenRelativeSize:"enableScreenRelativeSize","ArrowHead.Length":"arrowLength","ArrowHead.Color":"arrowColor","ArrowLine.Color":"dimensionLineColor","ArrowLine.TextGap":"textPadding","ArrowLine.StubLength":"stubLineLength","ExtensionLine.Color":"extensionLineColor","ExtensionLine.Gap":"extensionLineGap","ExtensionLine.GapColor":"extensionLineGapColor","ExtensionLine.GapType":"extensionLineGapType","ExtensionLine.Overhang":"extensionLineOverhang","Text.Orientation":"textOrientation","Text.Color":"textColor","Text.Height":"textDisplayHeight","Text.LineGapFactor":"lineFactor","Text.DimensionLineGapFactor":"textOverFactor"},Ai=function(e){var t,n={},i=null,a=new yr,o=new xi,s=new _.Box3,l=!0,c=!0,u=!0,h={
//color
selectionColor:16777088,highlightColor:255,textColor:0,arrowColor:0,// TODO - doesn't supported yet
extensionLineColor:0,dimensionLineColor:0,extensionLineGapColor:16711680,extensionLineType:wr.Solid,dimensionLineType:wr.Solid,extensionLineGapType:wr.Dashed,
//extensionLine
extensionLineGap:8,//the gap between primary line to anchor point. The gap won't show when secondary line show. A pixel value
extensionLineOverhang:5,//the part over dimension line
// stub line
stubLineLength:50,
//text
textScalar:1,// deprecated, will be removed after v1.5.1
textDisplayHeight:15,textPadding:5,textOrientation:Er.Over,textOverFactor:.25,lineFactor:.25,// line padding for multiline case
arrowLength:15,hasTextBorder:!1,enableScreenRelativeSize:!1},d={text:Mi(h.textColor),extensionLine:Mi(h.extensionLineColor,h.extensionLineType),extensionLineGap:Mi(h.extensionLineGapColor,h.extensionLineGapType),dimensionLine:Mi(h.dimensionLineColor,h.dimensionLineType),selection:Mi(h.selectionColor),highlight:Mi(h.highlightColor)};
/**
     * Generic callback definition
     * @callback PLMVisWeb.Dimension#genericCallback
     * @memberof PLMVisWeb.Dimension
     * @param {Object} eventData - event data, may contains partial of below properties:
     * @param {Number} eventData.dimensionIds - array of dimension ID
     * @param {Number} eventData.dimensionId - single dimension ID
     * @param {Boolean} eventData.visible - visibility status
     * @param {Boolean} eventData.selected - selection status
     * @param {Boolean} eventData.highlight - highlight status
     * @param {PLMVisWeb.DimensionComponentType} eventData.dimensionComponentType - dimension component type
     * @param {PLMVisWeb.DimensionSide} eventData.dimensionSide - dimension side
     * @see [addEventListener]{@link PLMVisWeb.Dimension#addEventListener}
     * @see [removeEventListener]{@link PLMVisWeb.Dimension#removeEventListener}
     * @see [updateEventListener]{@link PLMVisWeb.Dimension#updateEventListener}
     */
/**
     * Adds an event listener of the specified type.
     * @function PLMVisWeb.Dimension#addEventListener
     * @memberof PLMVisWeb.Dimension
     * @param {PLMVisWeb.Dimension.EventTypes}  eventType Name of the event type
     * @param {PLMVisWeb.Dimension#genericCallback} eventListener Listener function to handle an event of the specified type
     * @param {Number} priority - Priority of the event listener, determining its position in the event queue
     * @return {Boolean} true if the listener was added, otherwise false
     */
/**
     * Removes an event listener of the specified type.
     * @function PLMVisWeb.Dimension#removeEventListener
     * @memberof PLMVisWeb.Dimension
     * @param {PLMVisWeb.Dimension.EventTypes}  eventType Name of the event type
     * @param {PLMVisWeb.Dimension#genericCallback} eventListener Listener function to handle an event of the specified type
     * @param {Number} priority - Priority of the event listener, determining its position in the event queue
     * @return {Boolean} true if the listener was removed, otherwise false
     */
/**
     * Updates an existing event listener's queue position via a new priority
     * @function PLMVisWeb.Dimension#updateEventListener
     * @memberof PLMVisWeb.Dimension
     * @param {PLMVisWeb.Dimension.EventTypes} eventType - Name of the event type
     * @param {PLMVisWeb.Dimension#genericCallback} eventListener - Existing listener function
     * @param {Number} priority - Updated priority
     * @return {Boolean} true if the listener was found and its position was updated, otherwise false
     */
//constructor - sets up the private variables
function _Dimension(e){i=e._parent,t=new ze.Container("Dimension"),
// add container to Dimension's scene for rendering:
a._dimensionContainer=t,a.add(t),this._viewer=i,this._scene=a,Yn.makeEventer(this,Object.keys(Ai.EventTypes))}
//This is the prototype call to setup the calls
_Dimension.prototype={constructor:_Dimension},_Dimension.prototype._preRender=function(){i&&this.reorientText()},
/**
     * Reorient (flip) Dimension text as necessary.
     *
     * @function reorientText
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Boolean} [forced=false] - true: forces reorientation, false: relies on autoTextFlipping property value
     * @throws {Error}
     * @see [autoTextFlipping]{@link PLMVisWeb.Dimension.autoTextFlipping}
     */
_Dimension.prototype.reorientText=function(e){
// parameter checks:
r.b._optionalArgCheck(e,r.b._isBoolean),Object.keys(n).forEach(function(t){n[t].flipText(e||c),n[t]._updateScale(u)})};var p=function(e){r.b._notNullOrUndefined(e)&&r.b._notNullOrUndefined(t)&&(t.remove(e),a.octree.remove(e),a.update())},f=function(e,t,n){e.hasOwnProperty(t)&&((n=n||h)[Ti[t]]=e[t])},m=function(e,t){Object.keys(Ti).forEach(n=>{f(t,n,e)})};
/**
     * Creates a simple linear dimension
     * @function createLinearDimension
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Object} params - Object with the following argument properties:
     * @param {String | String[]} params.text - Text to display
     * @param {Number[]} params.length - Length point of the dimension frame from the origin which connect to the second entity
     * @param {Number[]} params.height - Height point of the dimension frame from the origin which intersect dimension line and first extension line
     * @param {Number[]} params.origin - Origin point of the dimension frame which connect to the first entity
     * @param {Number[]} [params.extension] - DEPRECATED. Will be removed after the 1.6.0 release. Use 'extensionOne' instead. End vector for extension line from origin
     * @param {Number[]} [params.extensionOne] - Start point of extension line connects to the origin point
     * @param {Number[]} [params.extensionTwo] - Start point of extension line connects to the length point
     * @param {PLMVisWeb.Dimension#DimensionOptions} [params.options] - Object with the following text display options
     * @param {PLMVisWeb.TextAlign} params.options.textAlign - DEPRECATED. Will be removed after the 1.6.0 release. PLMVisWeb.TextAlign enum value: Center, Left, or Right
     * @param {Number} params.options.textScalar - DEPRECATED. Will be removed after the 1.6.0 release. float scalar value to make text bigger/smaller (default is 2.0)
     * @param {Number} params.options.baselineOffset - DEPRECATED. Will be removed after the 1.6.0 release. distance from baseline to text (default is 25% of the scaled text height)
     * @param {PLMVisWeb.TextOrientation} [params.options."Text.Orientation"=Over] - PLMVisWeb.TextOrientation enum value: Horizontal, Vertical, Aligned, Over, or Perpendicular.
     * @param {Number} [params.options."Text.Height"=15] - pixel size value to make text bigger/smaller (default is 15)
     * @param {Number} [params.options."Text.DimensionLineGapFactor"=0.25] - distance from dimensionLine to text (default is 25% of the scaled text height)
     * @param {Boolean} [params.options."EnableScreenRelativeSize"=false] - flag to enable screen relative size
     * @throws {Error}
     * @returns {Number} ID of the created dimension
     * @example
     * var dimId = dimensionManager.createLinearDimension( {
     *     text: "25mm",
     *     length: [25, 0, 0],
     *     height: [0, 25, 0],
     *     origin: [0, 0, 0],
     *     extensionOne: [0, 0, 10],
     *     extensionTwo: [25, 0, 10],
     *     options: {}
     * });
     **/
return _Dimension.prototype.createLinearDimension=function(e){if(
// parameter checks:
r.b._isObject(e,!0),Array.isArray(e.length)&&3===e.length.length&&Array.isArray(e.height)&&3===e.height.length&&r.b._isString(e.text)){if(Array.isArray(e.origin)&&3===e.origin.length){if(r.b._arrayEqual(e.height,e.origin))// FIXME: use StringTable
return void _i("Invalid Linear Dimension Parameters: the 'height' and 'origin' should not be the same.")}else if(r.b._arrayEqual(e.height,[0,0,0]))// FIXME: use StringTable
return void _i("Invalid Linear Dimension Parameters: the 'height' and 'origin' should not be the same.");e.extension&&(wi("The 'extension' property is deprecated, use 'extensionOne' or 'extensionTwo' instead."),e.extensionOne||(e.extensionOne=e.extension));var t=e.length,n=e.height,i=Array.isArray(e.origin)&&3===e.origin.length?e.origin:[0,0,0],a=Array.isArray(e.extensionOne)&&3===e.extensionOne.length?e.extensionOne:null,s=Array.isArray(e.extensionTwo)&&3===e.extensionTwo.length?e.extensionTwo:null,l=e.text,c={};Object.assign(c,h),e.options&&m(c,e.options),void 0===this.defaultMaterial&&(this.defaultMaterial=d),c.font=o.getFont(c.font);var u=new Wr(this,l,i,t,n,a,s,c);return this._updateDimension(u),u.id}_i("Invalid Linear Dimension Parameters")},
/**
     * Creates a simple angular dimension
     * @function createAngularDimension
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Object} params - Object with the following argument properties:
     * @param {Number[]} params.startOne - Start position of the first extensionLine line
     * @param {Number[]} [params.extensionOne] - Extension position of the first extension line
     * @param {Number[]} params.directionOne - Direction of the first extensionLine line
     * @param {Number[]} params.startTwo - Start position of the second extensionLine line
     * @param {Number[]} [params.extensionTwo] - Extension position of the second extension line
     * @param {Number[]} params.directionTwo - Direction of the second extensionLine line
     * @param {Number} [params.radius=10] - radius of the dimension arc
     * @param {Boolean} [params.majorAngle=false] - Whether to display the larger (>180 degrees) angle
     * @param {String | String[]} params.text - Text to display
     * @param {PLMVisWeb.Dimension#DimensionOptions} [params.options] - Object with the following display options
     * @param {Number} params.options.textScalar - DEPRECATED. Will be removed after the 1.6.0 release. float scalar value to make text bigger/smaller (default is 2.0)
     * @param {Number} params.options.baselineOffset - DEPRECATED. Will be removed after the 1.6.0 release. distance from baseline to text (default is 25% of the scaled text height)
     * @param {Number} [params.options."Text.Height"=15] - pixel size value to make text bigger/smaller (default is 15)
     * @param {Number} [params.options."Text.DimensionLineGapFactor"=0.25] - distance from dimensionLine to text (default is 25% of the scaled text height)
     * @param {Boolean} [params.options."EnableScreenRelativeSize"=false] - flag to enable screen relative size
     * @throws {Error}
     * @returns {Number} ID of the created dimension
     * @example
     * var dimId = dimensionManager.createAngularDimension( {
     *     startOne: [0, 0, 0 ],
     *     extensionOne: [-5, 0, 0],
     *     directionOne: [1, 0, 0],
     *     startTwo: [0, 10, 0],
     *     extensionTwo: [0, 10, 5],
     *     directionTwo: [0, 1, 0],
     *     radius: 3,
     *     majorAngle: false,
     *     text: "90`",
     *     options: {}
     * });
     **/
_Dimension.prototype.createAngularDimension=function(e){if(
// parameter checks:
r.b._isObject(e,!0),Array.isArray(e.directionOne)&&3===e.directionOne.length&&Array.isArray(e.directionTwo)&&3===e.directionTwo.length){var t=(new _.Vector3).fromArray(e.directionOne),n=(new _.Vector3).fromArray(e.directionTwo);if(!r.b._isZero(t.length())&&!r.b._isZero(n.length())){e.startOne||(e.startOne=[0,0,0]),e.startTwo||(e.startTwo=[0,0,0]);var i={};Object.assign(i,h),e.options&&m(i,e.options),void 0===this.defaultMaterial&&(this.defaultMaterial=d),e.parent=this,e.options=i,i.font=o.getFont(i.font);var a=new si(e);return this._updateDimension(a),a.id}_i("Invalid Angular Dimension Parameters: the 'directionOne' and 'directionTwo' should not be zero vector.")}else _i("Invalid Angular Dimension Parameters: 'directionOne' and 'directionTwo' should be array of length 3.")},
/**
     * Create a simple note dimension
     * @function createNoteDimension
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Object} params - Object with the following argument properties:
     * @param {Array} params.origin - origin of the dimension frame
     * @param {Number} params.length1 - first section of the dimension leadline
     * @param {Number} params.length2 - second section of the dimension leadline
     * @param {String | String[]} params.text - Text to display
     * @param {PLMVisWeb.Dimension#DimensionOptions} [params.options] - Object with the following text display options
     * @param {Number} params.options.textScalar - DEPRECATED. Will be removed after the 1.6.0 release. float scalar value to make text bigger/smaller (default is 2.0)
     * @param {Number} params.options.baselineOffset - DEPRECATED. Will be removed after the 1.6.0 release. distance from baseline to text (default is 25% of the scaled text height)
     * @param {Number} [params.options."Text.Height"=15] - pixel size value to make text bigger/smaller (default is 15)
     * @param {Number} [params.options."Text.DimensionLineGapFactor"=0.25] - distance from dimensionLine to text (default is 25% of the scaled text height)
     * @param {Number} [params.options."Text.LineGapFactor"=0.25] - distance between lines for multiline case (default is 25% of the scaled text height)
     * @param {Boolean} [params.options."EnableScreenRelativeSize"=false] - flag to enable screen relative size
     * @throws {Error}
     * @returns {Number} ID of the created dimension
     * @example
     * var dimId = dimensionManager.createNoteDimension( {
     *     origin: [0, 0, 0],
     *     length1: 10.0,
     *     length2: 6.0,
     *     text: "90.125 m^2" || ['text1', 'text2']
     *     options: {}
     * });
     **/
_Dimension.prototype.createNoteDimension=function(e){if(
// parameter checks:
r.b._isObject(e,!0),Array.isArray(e.origin)&&3===e.origin.length&&r.b._isNumber(e.length1)&&r.b._isNumber(e.length2)){void 0===this.defaultMaterial&&(this.defaultMaterial=d);var t={};Object.assign(t,h),e.options&&m(t,e.options),t.font=o.getFont(t.font);var n=new bi(this,(new _.Vector3).fromArray(e.origin),e.length1,e.length2,e.text,t);return this._updateDimension(n),n.id}_i("Invalid Note Dimension Parameters")},
/**
     * Creates a simple radial dimension
     * @function createRadialDimension
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Object} params - Object with the following argument properties:
     * @param {Number[]} params.origin - Location on curve to point towards
     * @param {Number} params.leaderLineLength - DEPRECATED. Will be removed after the 1.6.0 release. Use extensionLineLength. Length of leader line
     * @param {Number} params.extensionLineLength - Length of extension part of dimension line
     * @param {Number[]} params.baselineDirection - Direction of stub line and text
     * @param {Number} params.baselineLength - Length of stub line
     * @param {Object} params.circleDef - Definition of circle curve
     * @param {Number[]} params.circleDef.center - Center point of circle curve
     * @param {Number[]} [params.circleDef.normal] - Normal direction of circle curve (Only used when no start and end parameters)
     * @param {Number[]} params.circleDef.start - Start point of existing circle curve
     * @param {Number[]} params.circleDef.end - End point of existing circle curve
     * @param {Boolean} [params.circleDef.isRadius=false] - Flag true to show radius line, false to show diameter line
     * @param {Boolean} [params.circleDef.alwaysShow=false] - Flag to always show radius or diameter lines
     * @param {Boolean} [params.circleDef.showArrow=false] - Flag to show arrow on radius or diameter line
     * @param {Boolean} [params.circleDef.textInside=false] - Flag to show text inside the circle curve
     * @param {String | String[]} params.text - Text to display
     * @param {PLMVisWeb.Dimension#DimensionOptions} [params.options] - Object with the following text display options
     * @param {Number} params.options.textScalar - DEPRECATED. Will be removed after the 1.6.0 release. float scalar value to make text bigger/smaller (default is 2.0)
     * @param {Number} params.options.baselineOffset - DEPRECATED. Will be removed after the 1.6.0 release. distance from baseline to text (default is 25% of the scaled text height)
     * @param {Number} params.options.insideCircle - DEPRECATED. Will be removed after the 1.6.0 release. the boolean flag to show text inside the circle curve (default is false)
     * @param {Number} [params.options."Text.Height"=15] - pixel size value to make text bigger/smaller (default is 15)
     * @param {Number} [params.options."Text.DimensionLineGapFactor"=0.25] - distance from dimensionLine to text (default is 25% of the scaled text height)
     * @param {Boolean} [params.options."EnableScreenRelativeSize"=false] - flag to enable screen relative size
     * @throws {Error}
     * @returns {Number} ID of the created dimension
     * @example
     * var dimId = dimensionManager.createRadialDimension( {
     *     origin: [0, 0, 0 ],
     *     extensionLineLength: 5,
     *     baselineDirection: [1, 0, 0],
     *     baselineLength: 2,
     *     circleDef: {
     *         center : [0, -1, 0],
     *         normal : [0, 0, 1],
     *         start : [0, 0, 0],
     *         end : [-1, -1, 0],
     *         isRadius : true,
     *         alwaysShow : true,
     *         showArrow : true
     *     },
     *     text: "10.5",
     *     options: { insideCircle : false }
     * });
     **/
_Dimension.prototype.createRadialDimension=function(e){if(
// parameter checks:
r.b._isObject(e,!0),Array.isArray(e.baselineDirection)&&3===e.baselineDirection.length&&e.circleDef&&Array.isArray(e.circleDef.center)&&3===e.circleDef.center.length){e.circleDef&&e.circleDef.normal&&e.circleDef.start&&e.circleDef.end&&!r.b._arrayEqual(e.circleDef.start,e.circleDef.end)&&wi("circleDef.normal may not be used if the normal can be calculated based on the provided parameters."),
// To support old parameter leaderLineLength
void 0!==e.leaderLineLength&&(wi("The 'leaderLineLength' property is deprecated, use 'extensionLineLength' instead."),void 0===e.extensionLineLength&&(e.extensionLineLength=e.leaderLineLength));var t=e.origin||[0,0,0],n=(e.circleDef.isRadius?"R ":"| ")+e.text,i={};Object.assign(i,h),e.options&&(m(i,e.options),i.insideCircle=e.options.insideCircle),void 0===this.defaultMaterial&&(this.defaultMaterial=d),i.font=o.getFont(i.font);var a=new vi(this,n,t,e.baselineDirection,e.extensionLineLength,e.baselineLength,e.circleDef,i);return this._updateDimension(a),a.id}_i("Invalid Radial Dimension Parameters.")},
/**
     * Remove the specified dimension from the scene.
     * @function deleteDimension
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     */
_Dimension.prototype.deleteDimension=function(e){
// parameter checks:
r.b._isNumber(e,!0);var t=n[e];p(t),delete n[e],i[Vp._render]()},_Dimension.prototype._clear=function(){
// this is called by Viewer.clearScene()
this.clearDimensions()},
/**
     * Get the coplanar point of line one for the start point of line two.
     * This function should be used when line one and line two may be not on the same plane.
     *
     * @function getCoplanarPoint
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number[]} line1Start - start point of line one
     * @param {Number[]} line1Direction - direction of line one
     * @param {Number[]} line2Start - start point of line two
     * @param {Number[]} line2Direction - direction of line two
     * @param {Number[]} [projectionDirection] - the direction to project
     * @throws {Error}
     * @returns {Number[]} the projected start point array of line two
     */
_Dimension.prototype.getCoplanarPoint=function(){var e=new _.Vector3,t=new _.Vector3,n=new _.Vector3,i=new _.Vector3,a=new _.Plane,o=new _.Vector3,s=new _.Ray,l=new _.Vector3;return function(c,u,h,d,p){if(
// parameter checks:
r.b._isArray(c,!0,r.b._isNumber),r.b._isArray(u,!0,r.b._isNumber),r.b._isArray(h,!0,r.b._isNumber),r.b._isArray(d,!0,r.b._isNumber),r.b._optionalArgCheck(p,r.b._isArray,r.b._isNumber),c&&3===c.length&&u&&3===u.length&&h&&3===h.length&&d&&3===d.length){e.fromArray(c),t.fromArray(u),n.addVectors(t,e),t.fromArray(d),i.addVectors(t,e),a.setFromCoplanarPoints(e,n,i),e.fromArray(h);var f=h;
// If not on the same plane, project the second line to the same plane with first line
return r.b._isZero(Math.abs(a.distanceToPoint(e)))||(p&&3===p.length?(o.fromArray(p).normalize(),s.set(e,o),s.intersectsPlane(a)?(s.intersectPlane(a,l),f=l.toArray()):(s.set(e,o.negate()),s.intersectsPlane(a)&&(s.intersectPlane(a,l),f=l.toArray()))):(a.projectPoint(e,l),f=l.toArray())),f}_i("Invalid getCoplanarPoint parameters!")}}(),
/**
     * Clear all dimensions from the scene.
     * @function clearDimensions
     * @memberof PLMVisWeb.Dimension.prototype
     */
_Dimension.prototype.clearDimensions=function(){Object.keys(n).forEach(function(e){p(n[e]),delete n[e]}),i[Vp._render]()},
/**
     * Returns the text value of a dimension object
     * @function getDimensionText
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {String} text value for the corresponding dimension
     */
_Dimension.prototype.getDimensionText=function(e){var t;
// parameter checks:
return r.b._isNumber(e,!0),n.hasOwnProperty(e)&&(t=n[e].textValue),t},
/**
     * Returns the text size of a dimension object
     * @function getDimensionTextSize
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Object} the text size of a dimension object with below properties:<br>
     *                   width: text width<br>
     *                   height: text height
     */
_Dimension.prototype.getDimensionTextSize=function(e){
// parameter checks:
r.b._isNumber(e,!0);var t={};return n.hasOwnProperty(e)&&(t=n[e].getTextSize()),t},
/**
     * Replaces the text value of a dimension object
     * @function setDimensionText
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {String} text - new text value
     * @throws {Error}
     */
_Dimension.prototype.setDimensionText=function(e,t){
// parameter checks:
r.b._isNumber(e,!0),r.b._isString(t,!0),n.hasOwnProperty(e)&&(n[e].textValue=t)},
/**
     * Returns the text scalar value of a dimension object
     * @function getDimensionTextScalar
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Number} value of the text scalar for the corresponding dimension
     * @deprecated This method is deprecated and will be will be removed after the 1.6.0 release, call getDimensionOptions instead.
     */
_Dimension.prototype.getDimensionTextScalar=function(e){var t;
// parameter checks:
return r.b._isNumber(e,!0),n.hasOwnProperty(e)&&(t=n[e].textScalar),t},
/**
     * Changes the text scalar value of a dimension object
     *
     * @function setDimensionTextScalar
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Number} value - new text scalar value
     * @throws {Error}
     * @deprecated This method is deprecated and will be will be removed after the 1.6.0 release, call setDimensionOptions instead.
     */
_Dimension.prototype.setDimensionTextScalar=function(e,t){
// parameter checks:
r.b._isNumber(e,!0),r.b._isNumber(t,!0),n[e].textScalar=t},
/**
     * Returns the value of the baseline offset of a dimension object
     * @function getDimensionBaselineOffset
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Number} value of the baseline offset for the corresponding dimension
     * @deprecated This method is deprecated and will be will be removed after the 1.6.0 release, call getDimensionOptions instead.
     */
_Dimension.prototype.getDimensionBaselineOffset=function(e){
// parameter checks:
return r.b._isNumber(e,!0),wi('The "getDimensionBaselineOffset" is deprecated, call "getDimensionOptions" instead.'),this.getDimensionOptions(e)["Text.DimensionLineGapFactor"]},
/**
     * Changes the baseline offset value of a dimension object
     * @function setDimensionBaselineOffset
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Number} value - new baseline offset value
     * @throws {Error}
     * @deprecated This method is deprecated and will be will be removed after the 1.6.0 release. Call setDimensionOptions instead.
     */
_Dimension.prototype.setDimensionBaselineOffset=function(e,t){
// parameter checks:
r.b._isNumber(e,!0),r.b._isNumber(t,!0),wi('The "setDimensionBaselineOffset" is deprecated, call "setDimensionOptions" instead.'),this.setDimensionOptions(e,{"Text.DimensionLineGapFactor":t})},
// internal use only:
_Dimension.prototype._updateModelBoundingBox=function(){a._updateModelBoundingBox(s),
// update viewer's bbox:
i[Vp._updateModelBoundingBox]()},
// internal use only:
_Dimension.prototype._getModelBoundingBox=function(){return s.clone()},
// internal use only:
_Dimension.prototype._render=function(e,t){e.render(a,t)},
// internal use only:
_Dimension.prototype._getScene=function(){return a},
/**
     * Returns the object contains the default colors of text, extensionLine, dimensionLine, selection, and highlight.<br>
     * Each value is the decimal value of the hexidecimal 0xRRGGBB color
     * @function getDefaultColors
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @returns {Object} hexadecimal color value of default text, extensionLine, dimensionLine, selection, and highlight ( see example in setDefaultColor )
     */
_Dimension.prototype.getDefaultColors=function(){var e={};return d&&(d.text&&(e.text=d.text.uniforms.diffuse.value.getHex()),d.extensionLine&&(e.extensionLine=Si(d.extensionLine)),d.extensionLineGap&&(e.extensionLineGap=Si(d.extensionLineGap)),d.dimensionLine&&(e.dimensionLine=Si(d.dimensionLine)),d.selection&&(e.selection=d.selection.uniforms.diffuse.value.getHex()),d.highlight&&(e.highlight=d.highlight.uniforms.diffuse.value.getHex())),e},
/**
     * Sets the default text, extensionLine, dimensionLine, selection, and highlight materials
     * @function setDefaultColors
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Object} colorObject - new default color input
     * @param {Number} colorObject.text - text color
     * @param {Number} colorObject.extensionLine - extension line color
     * @param {Number} colorObject.extensionLineGap - extension line gap color
     * @param {Number} colorObject.dimensionLine - dimension line color
     * @param {Number} colorObject.selection - selection color
     * @param {Number} colorObject.highlight - highlight color
     * @throws {Error}
     * @example
     * // setup color object
     * var colorObj = {
     *      text: 0xff0000,
     *      extensionLine: 0x00ff00,
     *      extensionLineGap: 0xff0000,
     *      dimensionLine: 0x0000ff,
     *      selection: 0xff0000,
     *      highlight: 0xff0000
     * };
     * dimensionManager.setDefaultColors( coloObj );
     */
_Dimension.prototype.setDefaultColors=function(e){
// parameter checks:
r.b._isObject(e,!0),r.b._notNullOrUndefined(e.text)&&h.textColor!==e.text&&(h.textColor=e.text,d.text.uniforms.diffuse.value.setHex(e.text)),r.b._notNullOrUndefined(e.extensionLine)&&h.extensionLineColor!==e.extensionLine&&(h.extensionLineColor=e.extensionLine,Ei(d.extensionLine,e.extensionLine,h.extensionLineType)),r.b._notNullOrUndefined(e.extensionLineGap)&&h.extensionLineGapColor!==e.extensionLineGap&&(h.extensionLineGapColor=e.extensionLineGap,Ei(d.extensionLineGap,e.extensionLineGap,h.extensionLineGapType)),r.b._notNullOrUndefined(e.dimensionLine)&&h.dimensionLineColor!==e.dimensionLine&&(h.dimensionLineColor=e.dimensionLine,Ei(d.dimensionLine,e.dimensionLine,h.dimensionLineType)),r.b._notNullOrUndefined(e.selection)&&h.selectionColor!==e.selection&&(h.selectionColor=e.selection,d.selection.uniforms.diffuse.value.setHex(e.selection)),r.b._notNullOrUndefined(e.highlight)&&h.highlightColor!==e.highlight&&(h.highlightColor=e.highlight,d.highlight.uniforms.diffuse.value.setHex(e.highlight))},
/**
     * Returns object of override materials for a specific dimension
     * @function getDimensionColors
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Object} object of override materials ( see example in setDimensionColors )
     */
_Dimension.prototype.getDimensionColors=function(e){var t;
// parameter checks:
return r.b._isNumber(e,!0),n.hasOwnProperty(e)&&(t=n[e].getDimensionColors()),t},
/**
     * Sets object of override materials for a specific dimension color
     * @function setDimensionColors
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Object} colorObject - object of override materials
     * @param {Number} colorObject.text - text color
     * @param {Number} colorObject.extensionLine - extension line color
     * @param {Number} colorObject.extensionLineGap - extension line gap color
     * @param {Number} colorObject.dimensionLine - dimension line color
     * @throws {Error}
     * @example
     * // setup color object
     * var colorObj = {
     *     text: 0xff0000,
     *     extensionLine: 0x00ff00,
     *     extensionLineGap: 0xdd0000,
     *     dimensionLine: 0x0000ff
     * };
     * dimensionManager.setDimensionColors( coloObj );
     */
_Dimension.prototype.setDimensionColors=function(e,t){
// parameter checks:
r.b._isNumber(e,!0),r.b._isObject(t,!0),n.hasOwnProperty(e)&&n[e].setDimensionColors(t)},
/**
     * Resets object of override materials for a specific dimension
     * @function resetDimensionColors
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     */
_Dimension.prototype.resetDimensionColors=function(e){
// parameter checks:
r.b._isNumber(e,!0),n.hasOwnProperty(e)&&n[e].resetDimensionColors()},
/**
     * Returns whether a dimension object is selected or deselected
     * @function getSelectionByDimId
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Boolean} boolean value of the dimension object's selection
     */
_Dimension.prototype.getSelectionByDimId=function(e){var t;
// parameter checks:
return r.b._isNumber(e,!0),n.hasOwnProperty(e)&&(t=n[e].selected),t},
/**
     * Selects or deselects a dimension object
     * @function setSelectionByDimId
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Boolean} isSelected - true for selecting an object; false for deselecting an object
     * @throws {Error}
     */
_Dimension.prototype.setSelectionByDimId=function(e,t){
// parameter checks:
r.b._isNumber(e,!0),r.b._isBoolean(t,!0),r.b._isBoolean(t)||(t=!0),n.hasOwnProperty(e)&&(n[e].selected=t,i[Vp._render]())},
//clear selections of dimension objects
_Dimension.prototype._clearSelection=function(){Object.keys(n).forEach(function(e){n.hasOwnProperty(e)&&n[e].selected&&(n[e].selected=!1)}),i[Vp._render]()},
/**
     * Highlights or not highlights a dimension object
     * @function setHighlightByDimId
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Boolean} isHighlighted - true for highlight an object; false for not highlight an object
     * @throws {Error}
     */
_Dimension.prototype.setHighlightByDimId=function(e,t){
// parameter checks:
r.b._isNumber(e,!0),r.b._isBoolean(t,!0),r.b._isBoolean(t)||(t=!0),n.hasOwnProperty(e)&&(n[e].highlighted=t,i[Vp._render]())},
/**
     * Flip dimension arrows. Only works for linear and angular dimensions
     * @function flipArrow
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     */
_Dimension.prototype.flipArrow=function(e){
// parameter checks:
r.b._isNumber(e,!0),n.hasOwnProperty(e)&&(n[e].flipArrow(),i[Vp._render]())},
/**
     * Determine whether the dimension arrows have been flipped.
     * @function isArrowFlipped
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Boolean} true if dimension arrows are flipped.
     */
_Dimension.prototype.isArrowFlipped=function(e){if(
// parameter checks:
r.b._isNumber(e,!0),n.hasOwnProperty(e))return n[e].isArrowFlipped()},
/**
     * Get the specified dimension control points. If no pointer types specified, all the applicable control points will be returned.
     * @function getControlPoints
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Object[]} pointTypes - Array of control point types.
     * @param {PLMVisWeb.DimensionControlPointType} pointTypes[].pointType - PLMVisWeb.DimensionControlPointType
     * @param {PLMVisWeb.DimensionSide} [pointTypes[].side] - PLMVisWeb.DimensionSide
     * @param {Number[]} [pointTypes[].value] - Will be overwrited when return.
     * @throws {Error}
     * @returns {Object[]} The "pointTypes" input array with control point value.
     * @example
     *  var pointTypes = [
     *      { pointType: 'TextCenter' },
     *
     *      { pointType: 'ArrowHeadStart', side: 'Side1' },
     *      { pointType: 'ArrowHeadStart', side: 'Side2' },
     *      { pointType: 'ArrowLineStart', side: 'Side1' },
     *      { pointType: 'ArrowLineStart', side: 'Side2' },
     *
     *      { pointType: 'ExtensionLineStart', side: 'Side1' },
     *      { pointType: 'ExtensionLineStart', side: 'Side2' },
     *      { pointType: 'ExtensionLineAnchor', side: 'Side1' },
     *      { pointType: 'ExtensionLineAnchor', side: 'Side2' },
     *
     *      { pointType: 'StubLineStart' },
     *      { pointType: 'StubLineEnd' }
     *   ];
     *  var controlPoints = dimensionManager.getControlPoints( dimensionId, pointTypes );
     */
_Dimension.prototype.getControlPoints=function(e,t){if(
// parameter checks:
r.b._isNumber(e,!0),r.b._isArray(t,!0,r.b._isObject),n.hasOwnProperty(e))return n[e].getControlPoints(t)},
/**
     * Update dimension component or control point position according to a relative drag vector.<br>
     * Some of the dimension component and control points are fixed after been initialed, not allowed to be updated.<br>
     * All the registered dimension position changed event handles will be notified.
     *
     * @function updatePosition
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Object} args - the dimension position update object defines required properties to update dimension. It should have structure as below:<br>
     *                        <b>The 'args' in type of Number array is deprecated, will be removed after PLMVisWeb 1.6.0</b>
     * @param {Number[]} args.dragVector - the drag vector to update dimension. The vector is an array of length 3 in format: [x,y,z].<br>
     *                                    <b>Note: the dragVector is an IO parameter. It will be projected to dimension plane in this method.</b>
     * @param {Number[]} [args.dragStart] - The drag start point on dimension object, typically used for updating dimension component position. The point is an array of length 3 in format: [x,y,z].
     * @param {PLMVisWeb.DimensionComponentType | PLMVisWeb.DimensionControlPointType} args.type - type of dimension component or control point.
     * @param {PLMVisWeb.DimensionSide} [args.side] - dimension side. Dimension side is required only if given dimension support side concept, it's ignored if not appliable to given dimension type.
     * @param {Boolean} [args.isControlPoint=false] - Flag to indicate whether the input type is dimension control point.
     * @throws {Error}
     * @example
     *   // Dimension Component example
     *   var args = {
     *       dragVector: [0,0,1],
     *       dragStart: [0,0,0],
     *       type: PLMVisWeb.DimensionComponentType.Arrow,
     *       side: PLMVisWeb.DimensionSide.Side1
     *    };
     *   dimensionMgr.updatePosition( dimensionId, args );
     *
     *   // Dimension Control Point example
     *   var args = {
     *       dragVector: [0,0,1],
     *       type: PLMVisWeb.DimensionControlPointType.ArrowLineStart,
     *       side: PLMVisWeb.DimensionSide.Side2,
     *       isControlPoint: true
     *    };
     *   dimensionMgr.updatePosition( dimensionId, args );
     */
_Dimension.prototype.updatePosition=function(e,t){if(
// parameter checks:
r.b._isNumber(e,!0),r.b._isObject(t,!0),n.hasOwnProperty(e)){var i=n[e];
//To support legacy API parameter 'args' in Number[] type
if(Array.isArray(t)&&3===t.length)return wi("Number[] of dragVector will be deprecated after PLMVisWeb 1.6.0"),void i.updateComponentPosition((new _.Vector3).fromArray(t),null,xr.Text);
//dragVector, dragStart, type, side, isControlPoint
if(t&&t.dragVector&&t.type){var a=(new _.Vector3).fromArray(t.dragVector);if(t.isControlPoint)i.updateControlPoint(a,t.type,t.side);else{var o=null;t.dragStart&&(o=(new _.Vector3).fromArray(t.dragStart)),i.updateComponentPosition(a,o,t.type,t.side)}
// update the drag vector to dimension plane
t.dragVector=a.toArray(),u&&i.enableScreenRelativeSize&&i.updateTextScale(),this._updateModelBoundingBox();var s={dimensionId:e};this.dispatchEvent(Ai.EventTypes.PositionChanged,s)}else _i("The dimension position update parameter is invalid.")}else _i("The dimension object is invalid.")},
/**
     * Get the dimension visibility
     * @function isDimensionVisible
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @throws {Error}
     * @returns {Boolean} true for visible, false for invisible or invalid dimID
     */
_Dimension.prototype.isDimensionVisible=function(e){
// parameter checks:
return r.b._isNumber(e,!0),!!n.hasOwnProperty(e)&&n[e].visible},
/**
     * Set the dimensions visible
     * @function setDimensionsVisible
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number[]} dimIDs - Array of dimension ID
     * @param {Boolean} visible - is visible or not.
     * @throws {Error}
     */
_Dimension.prototype.setDimensionsVisible=function(e,t){if(
// parameter checks:
r.b._isArray(e,!0,r.b._isNumber),r.b._isBoolean(t,!0),e instanceof Array){var a=[];if(e.forEach(e=>{n.hasOwnProperty(e)&&n[e].visible!==t&&(n[e].visible=t,a.push(e))}),a.length>0){var o={dimensionIds:a,visible:t};this.dispatchEvent(Ai.EventTypes.VisibilityChanged,o),i[Vp._render]()}}},
/**
     * Get the component visibility
     * @function isComponentVisible
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {PLMVisWeb.DimensionComponentType} componentType - dimension component type.
     * @param {PLMVisWeb.DimensionSide} [side] - dimension component side. The side is ignored for single side dimension.
     * @throws {Error}
     * @returns {Boolean} the dimension component visibility status
     */
_Dimension.prototype.isComponentVisible=function(e,t,i){
// parameter checks:
return r.b._isNumber(e,!0),r.b._isString(t,!0),r.b._optionalArgCheck(i,r.b._isString),!!n.hasOwnProperty(e)&&n[e].isComponentVisible(t,i)},
/**
     * Set the component visible
     *
     * @function setComponentVisibility
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - ID of dimension
     * @param {Boolean} visible - is visible or not.
     * @param {PLMVisWeb.DimensionComponentType} componentType - dimension component type.
     * @param {PLMVisWeb.DimensionSide} [side] - dimension component side. The side is ignored for single side dimension.
     * @throws {Error}
     */
_Dimension.prototype.setComponentVisibility=function(e,t,a,o){if(
// parameter checks:
r.b._isNumber(e,!0),r.b._isBoolean(t,!0),r.b._isString(a,!0),r.b._optionalArgCheck(o,r.b._isString),n.hasOwnProperty(e)){n[e].setComponentVisibility(t,a,o);var s={dimensionId:e,visible:t,dimensionComponentType:a,dimensionSide:o};this.dispatchEvent(Ai.EventTypes.VisibilityChanged,s),i[Vp._render]()}},
/**
     * Get the global dimension options.
     *
     * @function getDefaultOptions
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @returns {Object} dimension options, see [setDefaultOptions]{@link PLMVisWeb.Dimension#setDefaultOptions}.
     */
_Dimension.prototype.getDefaultOptions=function(){var e={};return Object.keys(Ti).forEach(t=>{var n=Ti[t];e[t]=h[n]}),e},
/**
     * Set the global dimension options. It will affect new dimension
     *
     * @function setDefaultOptions
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Object} options - the dimension options to update
     * @param {Number} options."SelectionColor" - The selection color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."HighlightColor" - The highlight color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."Text.Color" - The text color. The hexidecimal 0xRRGGBB color
     * @param {Boolean} options."EnableScreenRelativeSize" - flag to enable screen relative size
     * @param {Number} options."Text.Height" - pixel value to make text bigger/smaller (default is 15)
     * @param {Number} options."Text.DimensionLineGapFactor" - distance from dimensionLine to text (default is 25% of the scaled text height)
     * @param {Number} options."Text.LineGapFactor" - The line padding for multiple lines of text
     * @param {PLMVisWeb.TextOrientation} options."Text.Orientation" - PLMVisWeb.TextOrientation enum value - Horizontal, Vertical, Aligned, Over, or Perpendicular.
     * @param {Number} options."ArrowLine.Color" - The dimension line color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."ArrowLine.StubLength" - the length of stub line
     * @param {Number} options."ArrowLine.TextGap" - The text padding
     * @param {Number} options."ExtensionLine.Color" - The extension line color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."ExtensionLine.GapColor" - The gap line color between extension line and anchor point. The hexidecimal 0xRRGGBB color
     * @param {PLMVisWeb.DimensionLineType} options."ExtensionLine.GapType" - PLMVisWeb.DimensionLineType enum value - Solid, Dashed
     * @param {Number} options."ExtensionLine.Gap" - the gap between primary line to anchor point. The gap won't show when secondary line show
     * @param {Number} options."ExtensionLine.Overhang" - the part over dimension line
     * @param {Number} options."ArrowHead.Length" - The arrow length
     * @param {Number} options."ArrowHead.Color" - The arrow color. The hexidecimal 0xRRGGBB color<br>
     *                                            <b>Note: Doesn't take effort in this version. Support in future</b>
     * @throws {Error}
     */
_Dimension.prototype.setDefaultOptions=function(e){
// parameter checks:
r.b._isObject(e,!0);var t={};e.hasOwnProperty("SelectionColor")&&(t.selection=e.SelectionColor),e.hasOwnProperty("HighlightColor")&&(t.highlight=e.HighlightColor),e.hasOwnProperty("Text.Color")&&(t.text=e["Text.Color"]),e.hasOwnProperty("ExtensionLine.GapColor")&&(t.extensionLineGap=e["ExtensionLine.GapColor"]),e.hasOwnProperty("ExtensionLine.Color")&&(t.extensionLine=e["ExtensionLine.Color"]),e.hasOwnProperty("ArrowLine.Color")&&(t.dimensionLine=e["ArrowLine.Color"]),
// set colors
this.setDefaultColors(t),
// set types
e.hasOwnProperty("ExtensionLine.GapType")&&e["ExtensionLine.GapType"]!==h.extensionLineGapType&&(h.extensionLineGapType=e["ExtensionLine.GapType"],d.extensionLineGap=Mi(d.extensionLineGapTypeColor,h.extensionLineGapType)),
// set others using same logic
f(e,"EnableScreenRelativeSize"),f(e,"ExtensionLine.Gap"),f(e,"ExtensionLine.Overhang"),f(e,"ArrowLine.StubLength"),f(e,"ArrowLine.TextGap"),f(e,"Text.Height"),f(e,"Text.Orientation"),f(e,"Text.DimensionLineGapFactor"),f(e,"Text.LineGapFactor"),f(e,"ArrowHead.Color"),f(e,"ArrowHead.Length")},
/**
     * Get the dimension object options.
     *
     * @function getDimensionOptions
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - the dimension id
     * @throws {Error}
     * @returns {Object} the <b>modifiable</b> dimension options, see [setDimensionOptions]{@link PLMVisWeb.Dimension#setDimensionOptions}.
     */
_Dimension.prototype.getDimensionOptions=function(e){
// parameter checks:
r.b._isNumber(e,!0);var t={};if(n.hasOwnProperty(e)){var i=n[e];t={EnableScreenRelativeSize:i.enableScreenRelativeSize,"Text.Height":i.textDisplayHeight,"Text.DimensionLineGapFactor":i.textOverFactor,"ExtensionLine.GapType":Li(i._materials.extensionLineGap)};var a=this.getDimensionColors(e);t["Text.Color"]=a.text,t["ExtensionLine.GapColor"]=a.extensionLineGap,t["ExtensionLine.Color"]=a.extensionLine,t["ArrowLine.Color"]=a.dimensionLine}return t},
/**
     * Set the dimension object options.<br>
     * Similar to setDefaultOptions but some options will take effort at once
     *
     * @function setDimensionOptions
     * @memberof PLMVisWeb.Dimension.prototype
     *
     * @param {Number} dimID - the dimension id
     * @param {Object} options - the dimension options to update.<br>
     *                          <b>Note: Only partial options available in this version!</b>
     * @param {Boolean} options."EnableScreenRelativeSize" - flag to enable screen relative size
     * @param {Number} options."Text.Color" - The text color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."Text.Height" - pixel value to make text bigger/smaller (default is 15)
     * @param {Number} options."Text.DimensionLineGapFactor" - distance from dimensionLine to text (default is 25% of the scaled text height)
     * @param {Number} options."ArrowLine.Color" - The dimension line color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."ExtensionLine.Color" - The extension line color. The hexidecimal 0xRRGGBB color
     * @param {Number} options."ExtensionLine.GapColor" - The gap line color between extension line and anchor point. The hexidecimal 0xRRGGBB color
     * @param {PLMVisWeb.DimensionLineType} options."ExtensionLine.GapType" - PLMVisWeb.DimensionLineType enum value - Solid, Dashed
     *
     * @throws {Error}
     */
// @param {Number} options."Text.LineGapFactor" - The line padding for multiple lines of text<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {PLMVisWeb.TextOrientation} options."Text.Orientation" - PLMVisWeb.TextOrientation enum value - Horizontal, Vertical, Aligned, Over, or Perpendicular.
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {Number} options."ArrowLine.StubLength" - the length of stub line<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {Number} options."ArrowLine.TextGap" - The text padding<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {Number} options."ExtensionLine.Gap" - the gap between primary line to anchor point. The gap won't show when secondary line show<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {Number} options."ExtensionLine.Overhang" - the part over dimension line<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {Number} options."ArrowHead.Length" - The arrow length<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
// @param {Number} options."ArrowHead.Color" - The arrow color. The hexidecimal 0xRRGGBB color<br>
//                                           <b>Note: Doesn't take effort in this version. Support in future</b>
_Dimension.prototype.setDimensionOptions=function(e,t){if(
// parameter checks:
r.b._isNumber(e,!0),r.b._isObject(t,!0),n.hasOwnProperty(e)&&t){var i=n[e];
// set text related
t.hasOwnProperty("Text.Height")&&i.textDisplayHeight!==t["Text.Height"]&&(i.textDisplayHeight=t["Text.Height"]),t.hasOwnProperty("Text.DimensionLineGapFactor")&&i.textOverFactor!==t["Text.DimensionLineGapFactor"]&&(i.textOverFactor=t["Text.DimensionLineGapFactor"]);
// set colors
var a={};t.hasOwnProperty("Text.Color")&&(a.text=t["Text.Color"]),t.hasOwnProperty("ExtensionLine.GapColor")&&(a.extensionLineGap=t["ExtensionLine.GapColor"]),t.hasOwnProperty("ExtensionLine.Color")&&(a.extensionLine=t["ExtensionLine.Color"]),t.hasOwnProperty("ArrowLine.Color")&&(a.dimensionLine=t["ArrowLine.Color"]),this.setDimensionColors(e,a);
// set line type
var o=this.getDimensionOptions(e);t.hasOwnProperty("ExtensionLine.GapType")&&t["ExtensionLine.GapType"]!==o["ExtensionLine.GapType"]&&(i._materials.extensionLineGap=Mi(o["ExtensionLine.GapColor"],t["ExtensionLine.GapType"])),
// set EnableScreenRelativeSize
t.hasOwnProperty("EnableScreenRelativeSize")&&(i.enableScreenRelativeSize=t.EnableScreenRelativeSize)}else _i("setDimensionOptions: invalid parameters!")},_Dimension.prototype._updateDimension=function(e){!function(e){r.b._notNullOrUndefined(e)&&r.b._notNullOrUndefined(t)&&(t.add(e),a.octree.add(e),a.update())}(e),e.flipText(c),e.updateDimensionLine(),n[e.id]=e,this._updateModelBoundingBox(),i[Vp._render]()},_Dimension.prototype.loadFont=function(e){return o.load(e)},Object.defineProperties(_Dimension.prototype,{
/**
         * @property {Boolean} onTop=true - true: dimension will always stay on top of model<br> false: dimension can rotate behind model
         * @memberof PLMVisWeb.Dimension
         */
onTop:{get:function(){return l},set:function(e){r.b._isBoolean(e)&&(l=e),i[Vp._render]()}},
/**
         * @property {Boolean} autoTextFlipping=true - Turn on/off Dimension text flipping post-rotation
         * @memberof PLMVisWeb.Dimension
         */
autoTextFlipping:{get:function(){return c},set:function(e){c=e}},
/**
         * @property {Boolean} enableScreenRelativeSize=true - Turn on/off Dimension text/arrow using screen relative size
         * @memberof PLMVisWeb.Dimension
         */
enableScreenRelativeSize:{get:function(){return u},set:function(e){u=e}},
/**
         * @property {Number} dimensionCount - returns the number of dimension objects
         * @memberof PLMVisWeb.Dimension
         */
dimensionCount:{get:function(){return Object.keys(n).length}}}),new _Dimension(e)};Ai.prototype={constructor:Ai,_name:"Dimension"},Ai.EventTypes={
/** Selection Changed Event */
SelectionChanged:"SelectionChanged",
/** Hover Changed Event */
HoverChanged:"HoverChanged",
/** Position Changed Event */
PositionChanged:"PositionChanged",
/** Visibility Changed Event */
VisibilityChanged:"VisibilityChanged"};
/* harmony default export */var Ci=Ai,Pi=n(139),Ii=/* */n.n(Pi),Oi=n(138),Bi=/* */n.n(Oi),Ri=o()("PLMVisWeb:debug:Selection"),Gi=o()("PLMVisWeb:warning:Selection");
// EXTERNAL MODULE: ./staging/shaders/silhouette_vert.glsl
const Di=Object.freeze({_getSelectedIds:Symbol(),_fireSelectionEvents:Symbol(),_fireSelectionChangeEvents:Symbol(),_clearSelectionBuffer:Symbol(),_clearHighlightBuffer:Symbol(),_setHighlightByPsId:Symbol(),_setHighlightByPsIds:Symbol(),_getHighlightedPsIds:Symbol(),_removeSelection:Symbol(),_setObjectsSelection:Symbol(),_setObjectsHighlight:Symbol(),_setObjectSelection:Symbol(),_setObjectHighlight:Symbol(),_firePickingEvents:Symbol()});var Vi={x:0,y:0,startX:0,startY:0},Ni=function(e){var t=[],n=null,i=null,a=!1,o=null,s=null,l=new _.Frustum,c=new _.BufferGeometry,u=new _.Vector2,h=new _.Vector3,d=new _.Plane,p=new _.Plane,f=new _.Plane,g=new _.Plane,v=new _.Plane,y=new _.Plane,b=new je.a,x=new _.Vector2,w=new _.Vector2,M=new _.Vector3,E=new _.Vector3,S=new _.Vector3;function projectfrustum(e,t,n,r,i,a,o){x.set(n/t._renderer.domElement.width*2-1,-r/t._renderer.domElement.height*2+1),w.set(i/t._renderer.domElement.width*2-1,-a/t._renderer.domElement.height*2+1),M.set(0,0,-1),M.applyEuler(e.rotation),h.set(0,0,-e.near),e.localToWorld(h),d.setFromNormalAndCoplanarPoint(M,h),h.set(0,0,-e.far),e.localToWorld(h),p.setFromNormalAndCoplanarPoint(M,h),p.negate(),u.set(x.x<w.x?x.x:w.x,x.y>w.y?x.y:w.y),b.setFromCamera(u,e);var s=new _.Vector3;b.ray.intersectPlane(d,s);var m=new _.Vector3;b.ray.intersectPlane(p,m),u.set(x.x>w.x?x.x:w.x,x.y>w.y?x.y:w.y),b.setFromCamera(u,e);var E=new _.Vector3;b.ray.intersectPlane(d,E);var S=new _.Vector3;b.ray.intersectPlane(p,S),u.set(x.x<w.x?x.x:w.x,x.y<w.y?x.y:w.y),b.setFromCamera(u,e);var L=new _.Vector3;b.ray.intersectPlane(d,L);var T=new _.Vector3;b.ray.intersectPlane(p,T),u.set(x.x>w.x?x.x:w.x,x.y<w.y?x.y:w.y),b.setFromCamera(u,e);var A=new _.Vector3;b.ray.intersectPlane(d,A);var C=new _.Vector3;b.ray.intersectPlane(p,C),f.setFromCoplanarPoints(S,E,s),g.setFromCoplanarPoints(T,L,A),v.setFromCoplanarPoints(m,s,L),y.setFromCoplanarPoints(A,E,S),l.set(d,p,f,g,v,y),o&&function drawfrustum(e,t,n,r,i,a,o,s,l,u){c.addAttribute("position",new _.BufferAttribute(new Float32Array([e.x,e.y,e.z,t.x,t.y,t.z,n.x,n.y,n.z,r.x,r.y,r.z,i.x,i.y,i.z,a.x,a.y,a.z,o.x,o.y,o.z,s.x,s.y,s.z]),3)),c.setIndex(new _.BufferAttribute(new Uint16Array([0,1,2,3,0,2,1,3,4,5,6,7,4,6,5,7,0,4,1,5,2,6,3,7,0,5,0,3,0,6,1,4,1,2,1,7,6,3,6,0,6,5,7,1,7,4,7,2,2,4,3,5]),1));var h=new _.LineSegments(c,new _.LineBasicMaterial({color:l}));u._scene.add(h),u._render()}(s,m,E,S,L,T,A,C,"red",t)}function containsBox(e,t,n,i){for(var a=n.elements,o=1/(a[3]*t.min.x+a[7]*t.min.y+a[11]*t.min.z+a[15]),s=1/(a[3]*t.max.x+a[7]*t.max.y+a[11]*t.max.z+a[15]),l=(a[0]*t.min.x+a[4]*t.min.y+a[8]*t.min.z+a[12])*o,c=(a[1]*t.min.x+a[5]*t.min.y+a[9]*t.min.z+a[13])*o,u=(a[2]*t.min.x+a[6]*t.min.y+a[10]*t.min.z+a[14])*o,h=(a[0]*t.max.x+a[4]*t.max.y+a[8]*t.max.z+a[12])*s,d=(a[1]*t.max.x+a[5]*t.max.y+a[9]*t.max.z+a[13])*s,p=(a[2]*t.max.x+a[6]*t.max.y+a[10]*t.max.z+a[14])*s,f=e.planes,m=0;m<6;m++){var g=f[m];if(0===g.normal.x&&0===g.normal.y&&0===g.normal.z)return!1;if(S.x=l>h?g.normal.x>0?l:h:g.normal.x>0?h:l,S.y=c>d?g.normal.y>0?c:d:g.normal.y>0?d:c,S.z=u>p?g.normal.z>0?u:p:g.normal.z>0?p:u,g.distanceToPoint(S)<0)return!1;if((r.b._isNullOrUndefined(i)||!i)&&(E.x=l>h?g.normal.x>0?h:l:g.normal.x>0?l:h,E.y=c>d?g.normal.y>0?d:c:g.normal.y>0?c:d,E.z=u>p?g.normal.z>0?p:u:g.normal.z>0?u:p,g.distanceToPoint(E)<0))return!1}return!0}function search(e,t,n,i){if(r.b._isNullOrUndefined(i)&&(i=o.getPickingMode()),r.b._isNullOrUndefined(n)&&(n=o.getPartialAreaSelect()),t.children[0]){var a=[];return function traverse(e,t,n){e=n(e,t);for(var r=t.children,i=0,a=r.length;i<a;i++)traverse(e,r[i],n)}(!1,t,function(t,o){if(o instanceof ce&&!o.isAssembly){var s=i===m.x.FREE,l=(i&m.x.PART)===m.x.PART,c=(i&m.x.BODY)===m.x.BODY,u=(i&m.x.FACE)===m.x.FACE,h=(i&m.x.EDGE)===m.x.EDGE,d=(i&m.x.VERTEX)===m.x.VERTEX;if(r.b._isNullOrUndefined(o.boundingBox)&&o.computeBoundingBox,containsBox(e,o.boundingBox,o.matrixWorld,!0)){var p=containsBox(e,o.boundingBox,o.matrixWorld,!1);if((s||l)&&"Part"===o.type&&(n||p)&&a.push(o),c&&o.type==="Body"(n||p)&&a.push(o),u&&r.b._notNullOrUndefined(o.faces))for(var f in o.faces)if(o.faces[f]){var g=o.faces[f];p?a.push(g):(r.b._isNullOrUndefined(g.boundingBox)&&g.computeBoundingBox,containsBox(e,g.boundingBox,g.matrixWorld,n)&&a.push(g))}if(h&&r.b._notNullOrUndefined(o.edges))for(var v in o.edges)if(o.edges[v]){var y=o.edges[v];p?a.push(y):(r.b._isNullOrUndefined(y.boundingBox)&&y.computeBoundingBox,containsBox(e,y.boundingBox,y.matrixWorld,n)&&a.push(y))}if(d&&r.b._notNullOrUndefined(o.vertices))for(var b,x=o.vertices,w=x.vertices,M=new _.Box3,E=0,S=w.length;E<S;E++)w[E]&&(b=w[E],p?a.push(b):(M.set(b.position,b.position),containsBox(e,M,x.matrixWorld,n)&&a.push(b)))}}}.bind(this)),a}return null}var L=function(e){s=(o=e)._renderer.domElement.parentElement};return(L.prototype={constructor:L}).init=function(e){a=!1,i=e},L.prototype.onSelectStart=function(e){if(!a){t=[],a=!0,e.touches&&e.touches.length>0?(Vi.startX=e.touches[0].pageX,Vi.startY=e.touches[0].pageY):(Vi.startX=e.offsetX,Vi.startY=e.offsetY);var r=document.getElementById("marqueeRectangle");r?n=r:((n=document.createElement("div")).className="marqueeRectangle",n.style.left=Vi.x+"px",n.style.top=Vi.y+"px",n.style.border="1px solid #FF0000",n.style.position="absolute",n.style.zIndex="99",n.style.pointerEvents="none"),s.appendChild(n),s.style.cursor="crosshair"}},L.prototype.onSelectUpdate=function(e){e.touches&&e.touches.length>0?(Vi.x=e.touches[0].pageX,Vi.y=e.touches[0].pageY):(Vi.x=e.offsetX,Vi.y=e.offsetY),a&&null!==n&&(n.style.width=Math.abs(Vi.x-Vi.startX)+"px",n.style.height=Math.abs(Vi.y-Vi.startY)+"px",n.style.left=Vi.x-Vi.startX<0?Vi.x+"px":Vi.startX+"px",n.style.top=Vi.y-Vi.startY<0?Vi.y+"px":Vi.startY+"px")},L.prototype.onSelectStop=function(e){a=!1,null!==s&&(s.style.cursor="default",null!==n&&null!==n.parentNode&&null!==l&&(n.parentNode.removeChild(n),t=this.findObjectsInArea(Vi.startX,Vi.startY,Vi.x,Vi.y)))},L.prototype.findObjectsInArea=function(e,t,n,r,a,s){if(e!==n&&t!==r)return projectfrustum(o[Vp._getCamera](),o,e,t,n,r,!1),search(l,i,a,s)},L.prototype.selected=function(){return t},L.prototype.clear=function(){t=[],null!==n&&null!==n.parentNode&&n.parentNode.removeChild(n),n=null,i=null,a=!1},new L(e)},Ui=function(e){var t=e,n=!1,a=!1,o=[],s=[],l={},c=null,u=null,h=null,d=new Ni(e),p=!1,f=!1,g=[],v=[],y=[],b=new _.Scene,x=new ze.Container("SelectionContainer"),w=new ze.Container("HighlightContainer"),M={};function _getSelectedIds(){return l}function _getId(e){var t;return e.userData&&e.userData.psId?t=e.userData.psId:e.psId?t=e.psId:e.id&&(t=e.id),t}function _setObjectSelection(e,n,a){if(void 0!==e){var o=l,s={object:e};void 0!==a&&(s.intersection=a);var c=_getId(e);if(r.b._notNullOrUndefined(c))var u=!0;switch(e.type){case"Scene":_setObjectSelection(e.modelObject,n,a);break;case"Container":if(e===t._modelObject){e.selected=n;for(var h=e.children.length,d=0;d<h;++d)_setObjectSelection(e.children[d],n,a)}break;case"Assembly":if(e.selected=n,!e.shapes&&r.b._notNullOrUndefined(e.children)&&e.children.length>0)for(var p=0,f=e.children.length;p<f;p++){if((d=e.children[p]).isAssembly)_setObjectSelection(d,n,a);else{d.selected=n;var m={object:d},g=_getId(d);if(r.b._notNullOrUndefined(g)&&(n?o["_"+g.toString()]=m:delete o["_"+g.toString()],_fireSelectionChangeEvents(d)),r.b._notNullOrUndefined(d.shapes)){for(var v=0,y=d.shapes.length;v<y;v++)_setObjectSelection(d.shapes[v],n,a);if(r.b._notNullOrUndefined(d.sectionEdges))for(v=0,y=d.sectionEdges.length;v<y;v++)_setObjectSelection(d.sectionEdges[v],n,a)}if(r.b._notNullOrUndefined(d.children)&&d.children.length>0)for(v=0,y=d.children.length;v<y;v++){for(var b=d.children[v],x=0,_=b.shapes.length;x<_;x++)_setObjectSelection(b.shapes[x],n,a);if(r.b._notNullOrUndefined(b.sectionEdges))for(x=0,_=b.sectionEdges.length;x<_;x++)_setObjectSelection(b.sectionEdges[x],n,a)}}}break;case"Part":case"Body":if(e.selected=n,r.b._notNullOrUndefined(e.shapes))for(p=0,f=e.shapes.length;p<f;p++){var w=e.shapes[p];"PartShape"!==w.type&&"LineShape"!==w.type||_setObjectSelection(w,n,a)}if(r.b._notNullOrUndefined(e.children))for(p=0,f=e.children.length;p<f;p++){_setObjectSelection(d=e.children[p],n,a)}break;case"PartShape":if(e.visible)if(r.b._notNullOrUndefined(e.bodies)&&e.bodies.length>0)for(var M in e.bodies)e.bodies[M]&&_setObjectSelection(e.bodies[M],n,a);else e.selected=n,_appendSelectionBuffer(e.original);break;case"Edge":case"Vertex":case"FaceShape":e.selected=n,_appendSelectionBuffer(e.parent.original);break;case"EdgeShape":if(e.visible)for(var M in e.edges)e.edges[M]&&_setObjectSelection(e.edges[M],n,a);break;case"LineShape":case"OutlineShape":case"SectionEdgeShape":e.selected=n,_appendSelectionBuffer(e.original);break;case"VertexShape":if(e.visible)for(var M in e.vertices)e.vertices[M]&&_setObjectSelection(e.vertices[M],n,a);break;case"PmiPoint":void 0===e.userData.pointIndex?e.setSelectionAll(n):(e.setSelection(e.psIdMap[e.userData.pointIndex],n),delete e.userData.pointIndex),_appendSelectionBuffer(e);break;case"PmiRefPlane":case"PmiSurface":case"PmiLine":case"PmiText":case"PmiArrow":case"PmiArrowLine":case"PmiExtensionLine":case"SectionPlane":case"PointShape":case"LinearDimension":case"AngularDimension":case"NoteDimension":case"RadialDimension":e.selected=n,_appendSelectionBuffer(e);break;case"Point":case"SectionCapShape":case"Sprite":break;default:u=!1,Gi(i.b.stringsByLabel.SELECTION_CONSOLE_warn__setObjectSelection,c)}if(u){n?o["_"+c.toString()]=s:delete o["_"+c.toString()],_fireSelectionChangeEvents(e);var E=t.getExtensionManager(Ci);if(E&&e instanceof Vr){var S={selected:!0,dimensionId:e.id},L=a.dimComponent;L&&(S.dimensionComponentType=L.componentType,S.dimensionSide=L.side),E.dispatchEvent(Ci.EventTypes.HoverChanged,S),E.dispatchEvent(Ci.EventTypes.SelectionChanged,S)}}}}function _setObjectHighlight(e,n){if(r.b._notNullOrUndefined(e)&&(e.visible||e instanceof ze.EdgeShapeBase||e instanceof ze.Vertex))switch(e.type){case"Scene":_setObjectHighlight(e.modelObject,n);break;case"Container":if(e===t._modelObject){e.highlighted=n;for(var a=e.children.length,o=0;o<a;++o)_setObjectHighlight(e.children[o],n)}break;case"Assembly":case"Instance":if(e.isAssembly){if(e.highlighted=n,!e.shapes&&r.b._notNullOrUndefined(e.children)){a=e.children.length;for(var s=0;s<a;++s){if(void 0!==(o=e.children[s]).sectionEdges)for(var l=0;l<o.sectionEdges.length;l++)_setObjectHighlight(o.sectionEdges[l],n);_setObjectHighlight(o,n)}}break}case"Part":case"Body":if(e.highlighted=n,r.b._notNullOrUndefined(e.shapes)){l=0;for(var c=e.shapes.length;l<c;l++){var u=e.shapes[l];"PartShape"!==u.type&&"LineShape"!==u.type||_setObjectHighlight(u,n)}}if(r.b._notNullOrUndefined(e.children))for(l=0,c=e.children.length;l<c;l++){_setObjectHighlight(o=e.children[l],n)}break;case"PartShape":if(e.visible)if(r.b._notNullOrUndefined(e.bodies)&&e.bodies.length>0)for(var h in e.bodies)e.bodies[h]&&_setObjectHighlight(e.bodies[h],n);else e.highlighted=n,_appendHighlightBuffer(e.original);break;case"Edge":case"Vertex":case"FaceShape":e.highlighted=n,n&&_appendHighlightBuffer(e.parent.original);break;case"LineShape":case"OutlineShape":case"SectionEdgeShape":e.highlighted=n,n&&_appendHighlightBuffer(e.original);break;case"EdgeShape":if(e.visible)for(var h in e.edges)e.edges[h]&&_setObjectHighlight(e.edges[h],n);break;case"VertexShape":if(e.highlighted=n,e.visible)for(var h in e.vertices)e.vertices[h]&&_setObjectHighlight(e.vertices[h],n);break;case"LinearDimension":case"AngularDimension":case"NoteDimension":case"RadialDimension":e.highlighted=n,n&&_appendHighlightBuffer(e);break;case"PmiObject":case"PointShape":case"Sprite":break;default:var d="";e.userData&&e.userData.psId?psid=e.userData.psId:e.psId&&(d=e.psId),Gi(i.b.stringsByLabel.SELECTION_CONSOLE_warn__setObjectHighlight,d)}}function _clearSelectionBuffer(e=!0){var n=_getSelectedIds();if(n&&!r.b._isObjectEmpty(n)){var i={selected:!1},a=t.getExtensionManager(Ci);for(var o in n)if(n[o]){var s=n[o].object;if(s)if("PointShape"===s.type&&s.dirty)t._scene.removePoints(),x.remove(s),t[Vp._render]();else if(s.isPmi){var l=t.getExtensionManager(xt);void 0!==l&&l[bt._clearSelection]()}else s.selected=!1,_fireSelectionChangeEvents(s),s instanceof Vr&&(i.dimensionId=s.id,a.dispatchEvent(Ci.EventTypes.SelectionChanged,i));delete n[o]}e&&(_renderSelection(),t[Vp._render]()),g.length>0&&(g=[],x.children=g)}}function _clearHighlightBuffer(e){if(r.b._isBoolean(e)||(e=!0),v.length>0){for(var t=0;t<y.length;t++)_setObjectHighlight(y[t],!1);y=[],e&&_renderSelection(),v=[],w.children=v}}function _appendSelectionBuffer(e){-1===g.indexOf(e)&&g.push(e)}function _appendHighlightBuffer(e){-1===v.indexOf(e)&&v.push(e)}function _renderSelection(){if(t.getTransparentRenderingFlag()||t.getRenderMode()===m.g.Outline||(t._scene.pickingMode&m.x.EDGE)===m.x.EDGE||(t._scene.pickingMode&m.x.VERTEX)===m.x.VERTEX||(t._scene.pickingMode&m.x.DIMENSION)===m.x.DIMENSION)t[Vp._render]();else{if(t._scene.pickingMode===m.x.FREE&&(b._selectionContainer.children.some(function(e){return e instanceof Vr})||b._highlightContainer.children.some(function(e){return e instanceof Vr})))return void t[Vp._render]();if(t._renderer.setViewport(0,0,t._renderer.domElement.width,t._renderer.domElement.height),t._scene.pickingMode&0===m.x.VERTEX)return void t[Vp._render]();t._renderer.render(b,t._currentCamera)}}function _fireSelectionEvents(){var e=l,n=[],r=null,i=o.length,a=(t.getPickingMode()&m.x.FACE)===m.x.FACE,s=(t.getPickingMode(),m.x.BODY,m.x.BODY,[]);for(var c in e)if(e[c]){var u=e[c];if(u&&(!(u.object instanceof ze.FaceShape)||a)){if(u.object&&u.object.userData){var h=u.object.userData.psId;void 0!==h&&null!==h&&n.push(h)}null===r&&u.intersection&&u.intersection.point&&(r=u.intersection.point.toArray()),u.intersection&&s.indexOf(u.intersection)<0&&s.push(u.intersection)}}for(var d={type:m.i.Selection,selectedObjects:s},p=0;p<i;++p)o[p](n,r);t._scene.dispatchEvent(d)}function _fireSelectionChangeEvents(e){if(e.userData&&void 0!==e.userData.selectionChangeEvents)for(var t=e.userData.selectionChangeEvents.length,n=0;n<t;++n)e.userData.selectionChangeEvents[n](e.selected)}M[$n.EventTypes.Down]=1/0,M[$n.EventTypes.Move]=1/0,M[$n.EventTypes.Up]=1/0,function _initializeScene(){b.children.push(t._scene._lights),b.matrixAutoUpdate=!1,b.add(x),b.add(w),b._selectionContainer=x,b._highlightContainer=w,x.matrixAutoUpdate=!1,x.matrixWorldNeedsUpdate=!1,x.children=g,w.matrixAutoUpdate=!1,w.matrixWorldNeedsUpdate=!1,w.children=v}();var E=function(e){t=e,c=function _doMouseDown(e){p&&(t.setMouseNavigationEnabled(!1),this.selectNone(),d.init(t._modelObject.getObjectByPsId("-1",!0)),d.onSelectStart(e))}.bind(this),u=function _doMouseUp(e){if(p){d.onSelectStop(e);var n=d.selected();this[Di._setObjectsSelection](n,!0,!0),t.setMouseNavigationEnabled(!0),this.setPickingMode(m.x.FREE),p=!1}}.bind(this),h=function _doMouseMove(e){p&&d.onSelectUpdate(e)}.bind(this);var n=t.getInputManager();n&&(n.addEventListener($n.EventTypes.Down,c),n.addEventListener($n.EventTypes.Up,u),n.addEventListener($n.EventTypes.Move,h))};(E.prototype={constructor:E}).setAreaSelect=function(e){Ri(i.b.stringsByLabel.SELECTION_LOGGER_setAreaSelect+e),p=e},E.prototype.getAreaSelect=function(){return Ri(i.b.stringsByLabel.SELECTION_LOGGER_getAreaSelect+p),p},E.prototype.setPartialAreaSelect=function(e){f!==e&&(f=e),Ri(i.b.stringsByLabel.SELECTION_LOGGER_setPartialAreaSelect+f)},E.prototype.getPartialAreaSelect=function(){return Ri(i.b.stringsByLabel.SELECTION_LOGGER_getPartialAreaSelect+f),f},E.prototype.findObjectsInArea=function(e,n,a,o,s,l){Ri(i.b.stringsByLabel.SELECTION_LOGGER_findObjectsInArea),d.init(t._modelObject.getObjectByPsId("-1",!0));var c=d.findObjectsInArea(e,n,a,o,s,l);return r.b._isArray(c)&&c.forEach(function(e,t,n){n[t]=e.userData.psId}),c},E.prototype[Di._getSelectedIds]=function(){return _getSelectedIds()},E.prototype[Di._fireSelectionEvents]=function(){_fireSelectionEvents()},E.prototype[Di._fireSelectionChangeEvents]=function(e){_fireSelectionChangeEvents(e)},E.prototype[Di._clearSelectionBuffer]=function(e){_clearSelectionBuffer(e)},E.prototype[Di._clearHighlightBuffer]=function(e){_clearHighlightBuffer(e)},E.prototype[Di._setHighlightByPsId]=function(e,n,i){if(r.b._isString(e)){r.b._isBoolean(i)&&i&&this[Di._clearHighlightBuffer](!1);var a=t._modelObject.getObjectByPsId(e);r.b._notNullOrUndefined(a)&&this[Di._setObjectHighlight](a,n)}else this[Di._clearHighlightBuffer]()},E.prototype[Di._setHighlightByPsIds]=function(e,n,i){if(Array.isArray(e)&&0!==e.length){r.b._isBoolean(i)&&i&&this[Di._clearHighlightBuffer](!1);for(var a=[],o=0,s=e.length;o<s;o++){var l=t._modelObject.getObjectByPsId(e[o]);r.b._notNullOrUndefined(l)&&a.push(l)}this[Di._setObjectsHighlight](a,n)}else this[Di._clearHighlightBuffer]()},E.prototype[Di._getHighlightedPsIds]=function(e,t,n,r){!function _getHighlightedPsIds(e,t,n,r,i){Array.isArray(e)||(e=[]),Array.isArray(t)||(t=[]),Array.isArray(n)||(n=[]),Array.isArray(r)||(r=[]),Array.isArray(i)||(i=[]);for(var a=0,o=y.length;a<o;++a){var s=y[a];if("Part"===s.type||"Assembly"===s.type||s instanceof ze.Container)e.includes(s.userData.psId)||e.push(s.userData.psId);else if("Body"===s.type)t.includes(s.userData.psId)||t.push(s.userData.psId);else if(s instanceof ze.PartShape){var l=s.parent;"Part"!==l.type||e.includes(l.userData.psId)?"Body"!==l.type||t.includes(l.userData.psId)||t.push(l.userData.psId):e.push(l.userData.psId)}else s instanceof ze.FaceShape&&!n.includes(s.userData.psId)?n.push(s.userData.psId):s instanceof ze.Edge&&!r.includes(s.userData.psId)?r.push(s.userData.psId):s instanceof ze.Vertex&&!i.includes(s.userData.psId)&&i.push(s.userData.psId)}}(e,t,n,r)},E.prototype[Di._removeSelection]=function(e){x.remove(e)},E.prototype[Di._setObjectsSelection]=function(e,t,n){if(e.length>0&&(function _firePickingEvents(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];void 0!==r&&null!==r&&this[Di._firePickingEvents](r.userData?r.userData.psId:null,void 0,void 0,void 0)}}.call(this,e),!a)){for(var r=0,i=e.length;r<i;r++){var o=e[r];void 0!==o&&null!==o&&_setObjectSelection(o,t)}n&&_fireSelectionEvents.call(this),_renderSelection()}},E.prototype[Di._setObjectsHighlight]=function(e,t){if(e.length>0){for(var n=0,i=e.length;n<i;n++){var a=e[n];r.b._notNullOrUndefined(a)&&(-1===y.indexOf(a)&&y.push(a),_setObjectHighlight(a,t))}_renderSelection()}},E.prototype[Di._setObjectSelection]=function(e,t,n){_setObjectSelection(e,t,n),_renderSelection()},E.prototype[Di._setObjectHighlight]=function(e,t){-1===y.indexOf(e)&&y.push(e),_setObjectHighlight(e,t),t||y.splice(y.indexOf(e),1),_renderSelection()},E.prototype.registerSelectionEvent=function(e){Ri(i.b.stringsByLabel.SELECTION_LOGGER_registerSelectionEvent),r.b._isFunction(e)&&-1===r.b._eventMapIndex(o,e)&&o.push(e)},E.prototype.unregisterSelectionEvent=function(e){Ri(i.b.stringsByLabel.SELECTION_LOGGER_unregisterSelectionEvent);var t=r.b._eventMapIndex(o,e);-1!==t&&o.splice(t,1)},E.prototype.registerSelectionChangeEventByPsId=function(e,n){Ri(i.b.stringsByLabel.SELECTION_LOGGER_registerSelectionChangeEventByPsId);var a=t._modelObject.getObjectByPsId(e,!0);void 0!==a&&(void 0===a.userData.selectionChangeEvents&&(a.userData.selectionChangeEvents=[]),r.b._isFunction(n)&&-1===r.b._eventMapIndex(a.userData.selectionChangeEvents,n)&&(a.userData.selectionChangeEvents.push(n),Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_registerSelectionChangeEventByPsId)))},E.prototype.unregisterSelectionChangeEventByPsId=function(e,n){Ri(i.b.stringsByLabel.SELECTION_LOGGER_unregisterSelectionChangeEventByPsId);var a=t._modelObject.getObjectByPsId(e,!0);if(void 0!==a&&void 0!==a.userData.selectionChangeEvents){var o=r.b._eventMapIndex(a.userData.selectionChangeEvents,n);-1!==o&&(a.userData.selectionChangeEvents.splice(o,1),Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_unregisterSelectionChangeEventByPsId))}},E.prototype.setSelectionByPsId=function(e,n,a){if(Ri(i.b.stringsByLabel.SELECTION_LOGGER_setSelectionByPsId+e),r.b._isString(e)&&r.b._isBoolean(n)){var o=e===t._modelObject.userData.psId?t._modelObject:t._modelObject.getObjectByPsId(e,!0);r.b._notNullOrUndefined(o)&&_setObjectSelection(o,n),r.b._isBoolean(a)||(a=!1),a&&_fireSelectionEvents.call(this),_renderSelection()}},E.prototype.setSelectionByPsIds=function(e,n,a){if(Ri(i.b.stringsByLabel.SELECTION_LOGGER_setSelectionByPsIds),e.length>0){for(var o=0;o<e.length;++o){var s=e[o],l=s===t._modelObject.userData.psId?t._modelObject:t._modelObject.getObjectByPsId(s,!0);r.b._notNullOrUndefined(l)&&_setObjectSelection(l,n)}a&&_fireSelectionEvents.call(this),_renderSelection()}},E.prototype.getSelectionByPsId=function(e){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectionByPsId+e);var n=e===t._modelObject.userData.psId?t._modelObject:t._modelObject.getObjectByPsId(e,!0);if(void 0!==n&&null!==n)return n.selected},E.prototype.getSelectedParts=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectedParts);var e=_getSelectedIds(),t=[];for(var n in e)if(e[n]){var r=e[n].object;if(r&&(r instanceof ze.Assembly||r instanceof ze.Container)&&(Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedParts+r.userData.psId+".\n"),t.includes(r.userData.psId)||t.push(r.userData.psId)),r&&r instanceof ze.PartShape){var a=r.parent;a&&a instanceof ce&&(Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedParts+a.userData.psId+".\n"),t.includes(a.userData.psId)||t.push(a.userData.psId))}}return t},E.prototype.getSelectedBodies=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectedBodies);var e=_getSelectedIds(),t=[];for(var n in e)if(e[n]){var r=e[n].object;r&&"Body"===r.type&&(Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedBodies+r.userData.psId+".\n"),t.push(r.userData.psId))}return t},E.prototype.getSelectedFaces=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectedFaces);var e=_getSelectedIds(),t=[];for(var n in e)if(e[n]){var r=e[n].object;r&&"FaceShape"===r.type&&(Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedFaces+r.userData.psId+".\n"),t.push(r.userData.psId))}return t},E.prototype.getSelectedEdges=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectedEdges);var e=_getSelectedIds(),t=[];for(var n in e)if(e[n]){var r=e[n].object;r&&"Edge"===r.type&&(Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedEdges+r.userData.psId+".\n"),t.push(r.userData.psId))}return t},E.prototype.getSelectedVertices=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectedVertices);var e=_getSelectedIds(),t=[];for(var n in e)if(e[n]){var r=e[n].object;r&&"Vertex"===r.type&&(Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedVertices+r.userData.psId+".\n"),t.push(r.userData.psId))}return t},E.prototype.getSelectedVerticesInfo=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectedVerticesInfo);var e=_getSelectedIds(),t=[];for(var n in e)if(e[n]){var r=e[n].object;if(r&&"Vertex"===r.type){Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_getSelectedVerticesInfo+r.userData.psId+".\n");var a={psId:r.userData.psId,index:r.index,x:r.position.x,y:r.position.y,z:r.position.z};t.push(a)}}return t},E.prototype.selectNone=function(){Ri(i.b.stringsByLabel.SELECTION_LOGGER_selectNone);var e=null;xt&&t.isExtensionLoaded(xt)&&(e=t.getExtensionManager(xt))&&e[bt._clearSelection]();for(var n=t._scene._pointsContainer.children,r=0;r<n.length;r++)n[r].dirty=!0;_clearHighlightBuffer(),_clearSelectionBuffer(),d.clear()},E.prototype.setPickingModes=function(e){for(Ri(i.b.stringsByLabel.SELECTION_LOGGER_setPickingModes),e.length>=1||(e=[0]);e.length>1;)e[0]=e[0]|e[1],e.splice(1,1);this.setPickingMode(e[0])},E.prototype.setPickingMode=function(e){Ri(i.b.stringsByLabel.SELECTION_LOGGER_setPickingMode);var n=t._scene.pickingMode,a=e;if(r.b._isNumber(a)&&!(a<0||a>255)){if(t.setMouseNavigationEnabled(!0),Hn&&t.isExtensionLoaded(Hn)){var o,s=t.getExtensionManager(Hn);if(s&&s.mode!==m.p.None){switch(s.mode){case m.p.Radius:o=m.r.Radius;break;case m.p.Distance:o=m.r.Distance;break;case m.p.Length:o=m.r.Length;break;case m.p.Angle:o=m.r.Angle;break;case m.p.Volume:o=m.r.Volume;break;case m.p.Area:o=m.r.Area;break;case m.p.BoundingBox:o=m.r.BoundingBox;break;case m.p.PointDistance:o=m.r.Point;break;default:o=1}a=o&e}}Ri(i.b.stringsByLabel.SELECTION_LOGGER_finest_setPickingMode+a),t._scene.pickingMode=a,t[Vp._firePropertyChangedEvent]("pickingMode",n,a)}},E.prototype.getPickingMode=function(){return Ri(i.b.stringsByLabel.SELECTION_LOGGER_getPickingMode),t._scene.pickingMode},E.prototype.setSelectionToggleMode=function(e){Ri(i.b.stringsByLabel.SELECTION_LOGGER_setSelectionToggleMode+e),n=e},E.prototype.getSelectionToggleMode=function(){return Ri(i.b.stringsByLabel.SELECTION_LOGGER_getSelectionToggleMode),n},E.prototype.setSelectionMaterial=function(e,n,a,o,s,l){Ri(i.b.stringsByLabel.SELECTION_LOGGER_setSelectionMaterial),l=r.b._getValidOpacity(l),t._scene.setSelectionMaterial(e,n,a,o,s,l),t[Vp._render]()},E.prototype.setHighlightingMaterial=function(e,n,a,o,s,l){Ri(i.b.stringsByLabel.SELECTION_LOGGER_setHighlightingMaterial),l=r.b._getValidOpacity(l),t._scene.setHighlightingMaterial(e,n,a,o,s,l),t[Vp._render]()},E.prototype.registerPickingEvent=function(e){r.b._isFunction(e)&&-1===r.b._eventMapIndex(s,e)&&s.push(e)},E.prototype.unregisterPickingEvent=function(e){var t=r.b._eventMapIndex(s,e);-1!==t&&s.splice(t,1)},E.prototype[Di._firePickingEvents]=function(e){for(var t=0,n=s.length;t<n;t++)1===s[t].length?s[t](e):s[t](e.psId,e.pickPt,e.ctrl,e.alt)},E.prototype.setPickOnly=function(e){!0!==e&&!1!==e||(a=e)},E.prototype.getPickOnly=function(){return a},E.prototype.setEventPriority=function(e,n){var r=t.getInputManager();r&&(e===$n.EventTypes.Down?(M[$n.EventTypes.Down]=n,r.updateEventListener($n.EventTypes.Down,c,n)):e===$n.EventTypes.Move?(M[$n.EventTypes.Move]=n,r.updateEventListener($n.EventTypes.Move,h,n)):e===$n.EventTypes.Up&&(M[$n.EventTypes.Up]=n,r.updateEventListener($n.EventTypes.Up,u,n)))},E.prototype.getEventPriority=function(e){var t=void 0;return e===$n.EventTypes.Down?t=M[$n.EventTypes.Down]:e===$n.EventTypes.Move?t=M[$n.EventTypes.Move]:e===$n.EventTypes.Up&&(t=M[$n.EventTypes.Up]),t};const S={},L=new _.Scene;L.autoUpdate=!1;const T=new _.Scene;T.autoUpdate=!1;const A=new _.MeshBasicMaterial({colorWrite:!1,polygonOffset:!0,polygonOffsetFactor:.5,polygonOffsetUnits:2}),C=new _.RawShaderMaterial({vertexShader:Ii.a,fragmentShader:Bi.a,side:_.BackSide,uniforms:{sWidth:{value:.05},diffuse:{value:new _.Color(1,1,1)},opacity:{value:1}}}),P=new _.Vector3;var I=function(){var e=new Set;return function(n,i){if(n.forEach(n=>{let r=t.getEdgeIdsById(n);r&&r.forEach(t=>e.add(t))}),r.b._isNullOrUndefined(i))e.forEach(e=>(function removeEdge(e){let t=L.children.findIndex(t=>t.edgeId===e);t>-1&&L.remove(L.children[t])})(e));else{let n=new _.LineBasicMaterial({color:i,depthTest:!1});e.forEach(e=>{let r=t._modelObject.getObjectByPsId(e),i=new _.BufferGeometry;i.addAttribute("position",new _.BufferAttribute(new Float32Array(r.position),3));let a=new _.LineSegments(i,n);a.edgeId=e,a.matrixAutoUpdate=!1,r.matrixWorld.decompose(a.position,a.quaternion,a.scale),a.matrix.copy(r.matrix),a.matrixWorld.copy(r.matrixWorld),L.add(a)},this)}e.clear()}}();return E.prototype.addOnTopEdges=function addOnTopEdges(e,n){I(e,n.color),n.showSilhouettes&&e.forEach(e=>{let r=t._modelObject.getObjectByPsId(e);if(r&&"FaceShape"===r.type&&void 0===S[e]){let t=r.parent.original,i=new _.Mesh(t.geometry.clone(),t.material.slice());i.matrixAutoUpdate=!1,i.matrix.copy(r.matrix),i.matrixWorld.copy(r.matrixWorld),i.type="OutlineShape",i.geometry.groups=[r.original],S[e]=i,function computeSmoothedNormals(e){function findIndexFunc(e){return function verticesSimilarEnough(e,t){return e.distanceTo(t)<=1e-6}(e.vertex,this)}let t=[],n=[],r=e.index.array,i=e.attributes.position,a=e.attributes.normal,o=-1;for(let e=0,s=r.length;e<s;++e){let s=r[e];-1===n.indexOf(s)&&(P.set(i.getX(s),i.getY(s),i.getZ(s)),(o=t.findIndex(findIndexFunc,P))>-1?t[o].normals.push(a.getX(s),a.getY(s),a.getZ(s)):t.push({vertex:P.clone(),normals:[a.getX(s),a.getY(s),a.getZ(s)]}),n.push(s))}const s=new Float32Array(a.array.length),l=i.array;for(let e=0,n=l.length;e<n;e+=3){P.set(l[e+0],l[e+1],l[e+2]);let n=t[t.findIndex(findIndexFunc,P)];if(void 0===n.average){P.set(0,0,0);for(var c=0,u=n.normals.length;c<u;c+=3)P.x+=n.normals[c+0],P.y+=n.normals[c+1],P.z+=n.normals[c+2];P.multiplyScalar(1/3),P.normalize(),n.average=P.toArray()}s[e+0]=n.average[0],s[e+1]=n.average[1],s[e+2]=n.average[2]}e.addAttribute("expandNormal",new _.BufferAttribute(s,3))}(i.geometry),i.edgeColor=n.color}})},E.prototype.removeOnTopEdges=function removeOnTopEdges(e){I(e),e.forEach(e=>{S[e]&&(S[e].geometry.removeAttribute("expandNormal"),delete S[e])})},E.prototype.clearOnTopEdges=function clearOnTopEdges(){Object.keys(S).forEach(e=>delete S[e]),L.children.length=0},E.prototype._render=function renderOnTopEdges(e,t){let n=Object.keys(S);L.children.length>0&&(e.setViewport(0,0,e.domElement.width,e.domElement.height),e.render(L,t),T.children[1]=t,n.forEach(n=>{e.clearDepth(),T.children[0]=S[n],T.overrideMaterial=A,A.polygonOffsetFactor=-A.polygonOffsetFactor,A.side=_.BackSide,e.render(T,t),A.polygonOffsetFactor=-A.polygonOffsetFactor,A.side=_.FrontSide,e.render(T,t),T.overrideMaterial=null,C.uniforms.diffuse.value.setHex(S[n].edgeColor),C.uniforms.opacity.value=1,T.overrideMaterial=C,e.render(T,t),T.overrideMaterial=null}),T.children.length=0)},new E(e)};Ui.prototype={constructor:Ui,_name:"Selection"};
// CONCATENATED MODULE: ./staging/Section.js
var Fi=o()("PLMVisWeb:debug:Section"),zi=o()("PLMVisWeb:warning:Section"),ki=o()("PLMVisWeb:verbose:Section"),ji=function(e,t,n){var r=n.normal,i=n.constant,a=-(e.dot(r)+i)/r.dot(t);return new _.Vector3(e.x+a*t.x,e.y+a*t.y,e.z+a*t.z)},Hi=function(e,t,n,r){return e.normal.x*t+e.normal.y*n+e.normal.z*r+e.constant},Wi=Hi,Xi=function(e,t,n){var i=void 0;switch(e.entityType){case 1:i=function(){var e={entityType:15};return e}();break;case 4:i=function(e,t,n){var i=new _.Vector3(e.axis.x,e.axis.y,e.axis.z),a=new _.Vector3(e.location.x,e.location.y,e.location.z),o=t.normal,s=Math.abs(i.dot(o));if(1==s){var l={},c=ji(a,o,t);l.entityType=11,l.location={x:c.x,y:c.y,z:c.z},l.axis={x:i.x,y:i.y,z:i.z};var u=new _.Vector3(e.apex.x,e.apex.y,e.apex.z),h=c.sub(u).length()/a.sub(u).length();return l.radius=h*e.radius,l}if(0==s)return 0===Hi(t,a.x,a.y,a.z)?l={entityType:15}:void 0;var d=n.length;if(d>6&&r.b._vertexEqual(n[0],n[1],n[2],n[d-3],n[d-2],n[d-1])){u=new _.Vector3(e.apex.x,e.apex.y,e.apex.z),(l={entityType:13}).axis={x:o.x,y:o.y,z:o.z};var p=i.clone().cross(t.normal),f=p.clone().cross(i);f.normalize(),p.normalize();var m=a.clone().addScaledVector(f,e.radius),g=a.clone().addScaledVector(f,-e.radius);m=t.intersectLine(new _.Line3(m,u)),g=t.intersectLine(new _.Line3(g,u));var v=m.clone().add(g).multiplyScalar(.5);l.location={x:v.x,y:v.y,z:v.z},l.majorRadius=.5*m.sub(g).length();var y=new _.Plane;return y.setFromNormalAndCoplanarPoint(i,a),h=(v=ji(v,i,y)).clone().sub(a).length(),h=Math.sqrt(e.radius*e.radius+h*h),m=v.clone().addScaledVector(p,h),g=v.clone().addScaledVector(p,-h),m=t.intersectLine(new _.Line3(m,u)),g=t.intersectLine(new _.Line3(g,u)),l.minorRadius=.5*m.sub(g).length(),l}}(e,t,n);break;case 2:i=function(e,t){var n={},r=new _.Vector3(e.axis.x,e.axis.y,e.axis.z),i=new _.Vector3(e.location.x,e.location.y,e.location.z),a=t.normal,o=Math.abs(r.dot(a));if(1==o)n.entityType=11,n.location=ji(i,t.normal,t),n.axis={x:r.x,y:r.y,z:r.z},n.radius=e.radius;else if(0==o)n.entityType=15;else{var s=ji(i,r,t);n.entityType=13,n.location={x:s.x,y:s.y,z:s.z},n.axis={x:a.x,y:a.y,z:a.z},n.minorRadius=e.radius,n.majorRadius=e.radius/o}return n}(e,t);break;case 3:i=function(e,t,n){var r={entityType:11};r.axis={x:t.normal.x,y:t.normal.y,z:t.normal.z};var i=new _.Vector3(e.location.x,e.location.y,e.location.z),a=ji(i,t.normal,t);return r.location={x:a.x,y:a.y,z:a.z},i.x=n[0],i.y=n[1],i.z=n[2],r.radius=i.sub(a).length(),r}(e,t,n);break;case 5:i=function(e,t,n){var r=new _.Vector3(e.axis.x,e.axis.y,e.axis.z),i=t.normal,a=Math.abs(r.dot(i));if(0===Hi(t,e.location.x,e.location.y,e.location.z)&&0===a){(c={entityType:11}).radius=e.minorRadius,c.axis={x:i.x,y:i.y,z:i.z};var o=r.cross(i),s=new _.Plane(o,-o.dot(e.location)),l=Hi(s,n[0],n[1],n[2])>0?e.majorRadius:-e.majorRadius;return c.location={x:e.location.x+l*o.x,y:e.location.y+l*o.y,z:e.location.z+l*o.z},c}if(1==a){var c={entityType:11},u=new _.Vector3(e.location.x,e.location.y,e.location.z),h=ji(u,r,t);return c.location={x:h.x,y:h.y,z:h.z},u=new _.Vector3(n[0],n[1],n[2]),c.radius=u.sub(h).length(),c.axis={x:i.x,y:i.y,z:i.z},c}}(e,t,n)}return i},qi=Object.freeze([]),Yi=new _.Box3,Zi=new _.Vector3(0,0,1),Ji=[new _.LineBasicMaterial({color:16777088}),new _.LineBasicMaterial({color:8323327}),new _.LineBasicMaterial({color:8421504})];Ji.isGlobal=!0;var Qi=new Uint16Array([0,1,1,2,2,3,3,0]),Ki=function(){var e=new _.BufferGeometry,t=new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0]);e.addAttribute("position",new _.BufferAttribute(t,3)),e.setIndex(new _.BufferAttribute(Qi,1)),e.addGroup(0,t.length,2),ze.GenericShape.call(this,e,Ji,m.A.Line),this.plane=new _.Plane(new _.Vector3(0,0,1),0),this.plane.side=m.z.OFF,this.type="SectionPlane",Object.defineProperties(this,{sectionSide:{get:function(){return this.plane.side},set:function(e){this.plane.side!==e&&(this.plane.side=e)}},sectionDirection:{get:function(){return this.plane.normal},set:function(e){e.normalize(),this.plane.normal.equals(e)||(this.quaternion.setFromUnitVectors(Zi,e),this.plane.setFromNormalAndCoplanarPoint(e,this.position),this.updateMatrix(),this.updateMatrixWorld())}},sectionPosition:{get:function(){return this.position},set:function(e){this.position.equals(e)||(this.position.copy(e),this.plane.setFromNormalAndCoplanarPoint(this.plane.normal,e),this.updateMatrix(),this.updateMatrixWorld())}}})};(Ki.prototype=Object.create(ze.GenericShape.prototype)).constructor=Ki,Ki.prototype.updateTransform=function(e){if(!e.isEmpty()){var t=new _.Matrix4;this.updateMatrixWorld(),t.getInverse(this.matrixWorld),e.applyMatrix4(t);var n=this.geometry.attributes.position.array,r=new _.Vector3;e.getSize(r);var i=r.length()/20;n[0]=e.min.x-i,n[1]=e.max.y+i,n[3]=e.min.x-i,n[4]=e.min.y-i,n[6]=e.max.x+i,n[7]=e.min.y-i,n[9]=e.max.x+i,n[10]=e.max.y+i,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}},Ki.prototype.validateRaycast=function(e,t){return t.pickingMode===m.x.FREE};var $i=function(e){var t=[],n=[],a=null,o=null,s=Yi,l=!0,c=!1,u=null,h=new ze.EventDispatcher,d=function(e,t){e&&(e._renderer.clippingPlanes=t?n:qi)},p=function(e,t){e&&o[Di._setObjectSelection](e,t);var n=!1;if(t?e!==u&&(u&&o[Di._setObjectSelection](u,!1),u=e,n=!0):e?e===u&&(u=null,n=!0):u&&(o[Di._setObjectSelection](u,!1),u=null,n=!0),n){var r={type:"SelectionChanged",selectedPlane:u?u.id:-1};h.dispatchEvent(r)}},f=function(e){for(var n=0,r=t.length;n<r;n++)if(t[n].id===e)return t[n];return null},g=function(e){null!==a&&(p(e,!1),a[Vp._removeAuxShape](e),c=!0)},v=function(e,t){var n=e.side,r=-e.normal.dot(t.point);switch(n){case m.z.POSITIVE:return r>e.constant;case m.z.NEGATIVE:return r<e.constant;case m.z.BOTH:return!0}return!1},y=function(e){if(0!==n.length)for(var t=e.candidates,r=0,i=t.length;r<i;r++){var a=t[r],o=a.object,s=!1;if(o.material&&(Array.isArray(o.material)?o.material.length>0&&(s=o.material[0].clipping):o.material instanceof _.Material&&(s=o.material.clipping)),s)for(var l=0,c=n.length;l<c;l++){var u=n[l];if(v(u,a)){t.splice(r,1),r--,i--;break}}}},b=function(e,t,n,i){if(t===n)return!0;var a=e[t+0],o=e[t+1],s=e[t+2],l=e[n+0],c=e[n+1],u=e[n+2];return r.b._vertexEqual(a,o,s,l,c,u,i)},x=function(e,t,n,r,i){return!b(e,t,n,i)&&!b(e,n,r,i)&&!b(e,r,t,i)},w=function(e,t,n,r,i,a){return e*r+t*i+n*a},M=function(e,t,n,i,a,o,s,l,c,u,h){for(var d=0,p=n.length;d<p;d++){var f=n[d],g=f.plane.side;if(f!==t&&g!==m.z.BOTH&&g!==m.z.OFF){var v=f.plane.clone().applyMatrix4(i),y=Wi(v,a,o,s),b=Wi(v,l,c,u),x=r.b._isZero(y,h),_=r.b._isZero(b,h),M=y>0,E=b>0;if(x&&_)return;if(x)switch(g){case m.z.POSITIVE:if(!E)return;break;case m.z.NEGATIVE:if(E)return}else if(_)switch(g){case m.z.POSITIVE:if(!M)return;break;case m.z.NEGATIVE:if(M)return}else if(M===E)switch(g){case m.z.POSITIVE:if(!M)return;break;case m.z.NEGATIVE:if(E)return}else{var S=v.normal,L=y/w(S.x,S.y,S.z,a-l,o-c,s-u),T=1-L,A=T*a+L*l,C=T*o+L*c,P=T*s+L*u;switch(g){case m.z.POSITIVE:M?(l=A,c=C,u=P):(a=A,o=C,s=P);break;case m.z.NEGATIVE:E?(l=A,c=C,u=P):(a=A,o=C,s=P)}}}}if(!r.b._vertexEqual(a,o,s,l,c,u,h)){var I=e.list.size;e.list.push(a),e.list.push(o),e.list.push(s);var O=e.list.size;e.list.push(l),e.list.push(c),e.list.push(u);var B={v1:I,v2:O,v3:-1,visited:!1},R={v1:O,v2:I,v3:-1,visited:!1};if(B.entry=R,R.entry=B,0===e.map.size)e.map.put(I,B),e.map.put(O,R);else{var G=e.map.tryPut(I,B),D=e.map.tryPut(O,R);if(G&&D&&G.entry===D)return;G&&(G.v3=B.v2),D&&(D.v3=R.v2)}}},E=function(e,t,n,i,a,o,s,l,c,u,h,d,p){var f=t.normal,m=n[i],g=n[i+1],v=n[i+2],y=n[a],b=n[a+1],x=n[a+2],_=n[o],E=n[o+1],S=n[o+2],L=y,T=b,A=x;if(!l){var C=s/w(f.x,f.y,f.z,m-y,g-b,v-x),P=1-C;L=P*m+C*y,T=P*g+C*b,A=P*v+C*x}var I=_,O=E,B=S;if(!c){var R=s/w(f.x,f.y,f.z,m-_,g-E,v-S),G=1-R;I=G*m+R*_,O=G*g+R*E,B=G*v+R*S}r.b._vertexEqual(L,T,A,I,O,B,p)||M(e,u,h,d,L,T,A,I,O,B,p)},S=function(e){this.hash=function(t){var n=0;return n=function(e,t,n){var i=t.getInt32(n+0),a=t.getInt32(n+1),o=t.getInt32(n+2);return e=r.b._combineHash(e,i),e=r.b._combineHash(e,a),e=r.b._combineHash(e,o)}(n,e,t)}},L=function(e,t,n){e.push(t.get(n+0)),e.push(t.get(n+1)),e.push(t.get(n+2))},T=function(e,t){var n=[];t.visited=!0,L(n,e.list,t.v1);for(var r=e.map.get(t.v2);r&&!r.visited;){r.visited=!0,L(n,e.list,r.v1),L(n,e.list,r.v1);var i=e.map.get(r.v3);i&&i.visited&&(i=e.map.get(r.v2)),r=i}return L(n,e.list,t.v1),n},A=function(e,t){var n=t,r=[];do{n.visited=!0;for(var i=-1===n.v3?1:2,a=0;a<i;a++)L(r,e.list,n.v1);var o=e.map.get(n.v2);if(o&&o.visited&&n.v3>=0&&(o=e.map.get(n.v3)),o&&-1===o.v3){L(r,e.list,o.v1),o.visited=!0;break}n=o}while(n&&!n.visited);return r},C=function(e,t){this.equals=function(n,i){return function(e,t,n,i){var a=e.get(t+0),o=e.get(t+1),s=e.get(t+2),l=e.get(n+0),c=e.get(n+1),u=e.get(n+2);return r.b._vertexEqual(a,o,s,l,c,u,i)}(e,n,i,t)}},P=function(e,t,n,i,o,s,l){var c=n.geometry.attributes.position.array,u=n.geometry.index.array;if(c.length>0){for(var h=new ke.a,d={list:h,map:new ke.b(1024,new S(h),new C(h,l))},p=n.start,f=n.start+n.count;p<f;p+=3){var m=3*u[p],g=3*u[p+1],v=3*u[p+2];if(x(c,m,g,v,l)){var y=c[m],b=c[m+1],_=c[m+2],w=c[g],L=c[g+1],P=c[g+2],I=c[v],O=c[v+1],B=c[v+2],R=Wi(t,y,b,_),G=Wi(t,w,L,P),D=Wi(t,I,O,B),V=r.b._isZero(R,l),N=r.b._isZero(G,l),U=r.b._isZero(D,l);if(!(V&&N&&U)){var F=R>0,z=G>0,k=D>0;F==z&&z==k||(V&&N&&k?M(d,i,o,s,y,b,_,w,L,P,l):V&&U&&z?M(d,i,o,s,y,b,_,I,O,B,l):N&&U&&F?M(d,i,o,s,w,L,P,I,O,B,l):z!=k||V?F!=z||U?F!=k||N||E(d,t,c,g,m,v,G,V,U,i,[i],s,l):E(d,t,c,v,m,g,D,V,N,i,[i],s,l):E(d,t,c,m,g,v,R,N,U,i,[i],s,l))}}}if(d.list.size>0){var j=[],H=d.map.values;for(var W in H){if(H[W])if(-1===(X=H[W]).v3&&!X.visited)(q=A(d,X))&&q.length>0&&j.push(q)}for(var W in H){var X,q;if(H[W])if(!(X=H[W]).visited)(q=T(d,X))&&q.length>0&&j.push(q)}j.length>0&&a.getSectionEdges()&&a[Vp._addSectionEdges](e,n,t,Xi,j,i.id)}return j}},I=function(e,t,n){return e.distanceToSquared(t)<5e5*n},O=function(e,t,n){return r.b._vertexEqual(e.x,e.y,e.z,t.x,t.y,t.z,n)},B=function(e,t,n,i){if(e!==t&&e.boundingBox.containsBox(t.boundingBox)){for(var a=i.normal,o=e.clone(),s=r.b._vector3ToVector2(o.vertices,a),l=r.b._earcutTriangulation(s,[]),c=0;c<l.length;c++)o.faces.push(new _.Face3(l[c][0],l[c][1],l[c][2]));for(var u,h=new _.Mesh(o,new _.MeshBasicMaterial({side:_.DoubleSide})),d=t.vertices,p=0,f=0,m=d.length;f<m;f++)if(u=d[f].clone().add(a),new je.a(u,a).intersectObject(h,!0).length>0?p++:new je.a(u,a.clone().negate()).intersectObject(h,!0).length>0&&p++,p/d.length>.9)return h.geometry.dispose(),h.material.dispose(),h=void 0,!0;h.geometry.dispose(),h.material.dispose(),h=void 0}return!1},R=function(e,t,n,r,o){var s=function(e){for(var t,n,r,i,a=[],o=e.length,s=0;s<o;s++){t=e[s].edge,r=e[s].material,n=t.length,i=[];for(var l=0;l<n;l+=3)i.push(new _.Vector3(t[l],t[l+1],t[l+2]));a[s]={material:r,start:i[0],end:i[n/3-1],all:i,edge:t}}return a}(r);(function(e,t,n){var r,i,a;t.forEach(function(e){r=0,t.forEach(function(t){B(e.geometry,t.geometry,0,n)&&r++}),e.nestedCyclesCount=r}),t.sort(function(e,t){return t.nestedCyclesCount-e.nestedCyclesCount});for(var o=[];t.length>0;){i={geometry:t[0].geometry,material:t[0].material,holes:[]},o.push(i),t.splice(0,1);for(var s=0,l=t.length;s<l;){if((a=t[s])&&B(i.geometry,a.geometry,0,n)){if(0===i.holes.length){i.holes.push(a.geometry),t.splice(s,1);continue}if(!i.holes.some(function(e){return B(e,a.geometry,0,n)})){i.holes.push(a.geometry),t.splice(s,1);continue}}s++}}return o})(0,function(e,t,n){for(var r,a,o,s,l,c,u,h=[],d=function(){for(var e=0;e<t.length;e++){if(O(t[e].start,o,n))return o=t[e].end,Array.prototype.push.apply(c,t[e].all),t.splice(t.indexOf(t[e]),1),!0;if(O(t[e].end,o,n))return o=t[e].start,Array.prototype.push.apply(c,t[e].all.reverse()),t.splice(t.indexOf(t[e]),1),!0}return!1},p=function(){for(var e=null,r=null,i=null,a=0;a<t.length;a++)I(o,t[a].start,n)&&(null===e||o.distanceToSquared(t[a].start)<e)&&(e=o.distanceToSquared(t[a].start),r=a,i=!1),I(o,t[a].end,n)&&(null===e||o.distanceToSquared(t[a].end)<e)&&(e=o.distanceToSquared(t[a].end),r=a,i=!0);return null!==e&&(i?(o=t[r].start,Array.prototype.push.apply(c,t[r].all.reverse()),t.splice(t.indexOf(t[r]),1),!0):(o=t[r].end,Array.prototype.push.apply(c,t[r].all),t.splice(t.indexOf(t[r]),1),!0))};t.length>0;)for(c=[],o=t[0].end,l=t[0].material,Array.prototype.push.apply(c,t[0].all),t.splice(t.indexOf(t[0]),1),s=!1;!s;){for(;d(););r=c[0],a=c[c.length-1],(s=!!O(r,a,n)&&((u=new _.Geometry).vertices=c,u.mergeVertices(),u.computeBoundingBox(),h.push({name:e.name,geometry:u,material:l}),!0))||p()||(r=c[0],a=c[c.length-1],(!I(r,a,n)||((u=new _.Geometry).vertices=c,u.mergeVertices(),u.computeBoundingBox(),h.push({name:e.name,geometry:u,material:l}),0))&&zi(i.b.stringsByLabel.SECTION_LOGGER_noCycle+e.name),s=!0)}return h}(e,s,o),t).forEach(function(r){a[Vp._addSectionCaps](e,r.material,r.geometry,r.holes,t,n)})},G=function(e,t,n){if(t.shapes&&t.shapes.length>0){if(t.boundingSphere)if(!function(e,t){return Math.abs(e.center.dot(t.normal)+t.constant)<=e.radius}(t.boundingSphere.clone().applyMatrix4(t.matrixWorld),e.plane))return;if(t.boundingBox)if(!function(e,t){var n,r,i=-t.constant;return t.normal.x>0?(n=t.normal.x*e.min.x,r=t.normal.x*e.max.x):(n=t.normal.x*e.max.x,r=t.normal.x*e.min.x),t.normal.y>0?(n+=t.normal.y*e.min.y,r+=t.normal.y*e.max.y):(n+=t.normal.y*e.max.y,r+=t.normal.y*e.min.y),t.normal.z>0?(n+=t.normal.z*e.min.z,r+=t.normal.z*e.max.z):(n+=t.normal.z*e.max.z,r+=t.normal.z*e.min.z),n<=i&&r>=i}(t.boundingBox.clone().applyMatrix4(t.matrixWorld),e.plane))return;var i=e.plane.clone(),o=new _.Matrix4;o.getInverse(t.matrixWorld),i.applyMatrix4(o);for(var s=r.b._getPartTolerance(t),l=a.getSectionCaps(),c=(a.getSectionEdges(),[]),u=0,h=t.shapes.length;u<h;u++){var d,p=t.shapes[u];if(p instanceof ze.PartShape&&p.faces&&p.faces.length>0)for(var f=0,m=p.faces.length;f<m;f++){var g=p.faces[f],v=P(t,i,g,e,l?[e]:n,o,s);if(v){var y=g.material.uniforms;d={diffuse:null,emissive:null,specular:null,shininess:null,opacity:null,reflectivity:null,envMap:null,hasEnvMap:0};var b=Object.keys(d);for(var x of b)y.hasOwnProperty(x)?d[x]=y[x].value:delete d[x];for(var w=0,M=v.length;w<M;w++)c.push({edge:v[w],material:d})}}}l&&R(t,i,e.id,c,s)}},D=function(e,n){if(e instanceof ce&&!e.isAssembly&&e.visible&&e.isLoaded&&(n||!e.sectionEdges||0===e.sectionEdges.length)){a[Vp._clearSectionShapes](e);var i=a.getSectionCaps(),o=a.getSectionEdges();if(i||o){for(var s=0,l=t.length;s<l;s++)G(t[s],e,t);a._renderer.localClippingEnabled||(a._renderer.localClippingEnabled=!0),r.b._notNullOrUndefined(e.shapes)&&0!==e.shapes.length&&function(e,t){for(var n=0,r=t.shapes.length;n<r;n++){var i=t.shapes[n];if(i instanceof ze.SectionCapShape||i instanceof ze.SectionEdgeShape)for(var a=0,o=i.material.length;a<o;a++){var s=i.material[a];s.clippingPlanes=[],s.needsUpdate=!0;for(var l=0,c=e.length;l<c;l++){var u=e[l],h=i.planeId;u.sectionSide===m.d.Both?(s.clipping=!1,s.clipShadows=!1,l=c):(s.clipping=!0,s.clipShadows=!0,h!==u.id&&s.clippingPlanes.push(u.plane))}}}}(t,e)}}},V=function(e){if(e.selectedObjects.length>0){var t=e.selectedObjects[0];t.object instanceof Ki?p(t.object,!0):p(null)}else p(null)},N=function(e){c||0===t.length||D(e.object,!1)},U=function(e){c||0===t.length||D(e.object,!1)},F=function(e){a=e._parent,o=a._selectionMngr,d(e._parent,l),a&&(a[Vp._addEventListener](m.i.Selection,V),a[Vp._addEventListener](m.i.pickingOverride,y),a[Vp._addEventListener](m.i.visibilityChanged,N),a[Vp._addEventListener](m.i.loadChanged,U))};return(F.prototype={constructor:F})._preRender=function(){if(a){var e=a[Vp._getVisibleModelBoundingBox]();e.equals(s)&&!0!==c||(s=e,c&&(a[Vp._setHashBothSectionSide](t.length>0&&t[0].sectionSide===m.z.BOTH),a._modelObject.traverse(function(e){D(e,!0)})),c=!1)}},F.prototype._clear=function(){this.clear(),s=Yi},F.prototype._sectionPlanesCount=function(){return t.length},F.prototype.registerPlaneSelectionEvent=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_registerPlaneSelectionEvent),h.addEventListener("SelectionChanged",e)},F.prototype.unregisterPlaneSelectionEvent=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_unregisterPlaneSelectionEvent),h.removeEventListener("SelectionChanged",e)},F.prototype.setSectionActive=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_setSectionActive),r.b._isBoolean(e)&&l!==e&&(l=e,d(a,e),c=!0,a[Vp._render]())},F.prototype.getSectionActive=function(){return Fi(i.b.stringsByLabel.SECTION_LOGGER_getSectionActive),l},F.prototype.updateSection=function(){c=!0,a[Vp._render]()},F.prototype.clear=function(){if(Fi(i.b.stringsByLabel.SECTION_LOGGER_clear),0!==t.length){for(var e=0,r=t.length;e<r;e++)g(t[e]);t.length=0,n.length=0,c=!0,a[Vp._updateModelBoundingBox](),a[Vp._render](),a[Vp._render]()}},F.prototype.addSectionPlane=function(e,o,s,l,u,h,d,f){Fi(i.b.stringsByLabel.SECTION_LOGGER_addSectionPlane),r.b._isBoolean(f)||(f=!0);var g=new Ki;return f||g.children.splice(0,1),r.b._isNumber(l)&&r.b._isNumber(u)&&r.b._isNumber(h)&&(g.sectionDirection=new _.Vector3(l,u,h)),r.b._isNumber(e)&&r.b._isNumber(o)&&r.b._isNumber(s)&&(g.sectionPosition=new _.Vector3(e,o,s)),r.b._isNumber(d)&&(g.sectionSide=d),d===m.z.BOTH?(t.splice(0,0,g),n.splice(0,0,g.plane)):(t.push(g),n.push(g.plane)),function(e){if(null!==a){var t=a[Vp._getVisibleModelBoundingBox]();e.updateTransform(t),c=!0,a[Vp._addAuxShape](e),a[Vp._render](),p(e,!0)}}(g),ki(i.b.stringsByLabel.SECTION_LOGGER_finest_addSectionPlane+g.id),g.id},F.prototype.removeSectionPlane=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_addSectionPlane);var r=function(e){for(var n=0,r=t.length;n<r;n++)if(t[n].id===e)return n;return-1}(e);if(r>=0){var o=t[r];t.splice(r,1),n.splice(r,1),g(o)}a[Vp._render](),a[Vp._render]()},F.prototype.setSectionSide=function(e,r){Fi(i.b.stringsByLabel.SECTION_LOGGER_addSectionPlane);var o=f(e);if(null!=o){if(o.sectionSide=r,c=!0,r===m.z.BOTH){var s=t.indexOf(o);if(s>0&&s<t.length){var l=t[0];t[0]=o,n[0]=o.plane,t[s]=l,n[s]=l.plane}}a[Vp._render](),a[Vp._render]()}},F.prototype.getSectionSide=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_addSectionPlane);var t=f(e);if(null!=t)return t.sectionSide;zi(i.b.stringsByLabel.SECTION_LOGGER_warn_getSectionSide)},F.prototype.setSectionDirection=function(e,t,n,r){Fi(i.b.stringsByLabel.SECTION_LOGGER_setSectionDirection);var o=f(e);if(null!=o){var s=new _.Vector3(t,n,r);o.sectionDirection=s;var l=a[Vp._getVisibleModelBoundingBox]();o.updateTransform(l),a[Vp._updateModelBoundingBox](),c=!0,a[Vp._render]()}},F.prototype.getSectionDirection=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_getSectionDirection);var t=f(e);if(null!=t)return t.sectionDirection.clone().toArray();Fi(i.b.stringsByLabel.SECTION_LOGGER_info2_getSectionDirection)},F.prototype.setSectionPosition=function(e,t,n,o,s){Fi(i.b.stringsByLabel.SECTION_LOGGER_setSectionPosition),s=!r.b._isBoolean(s)||s;var l=f(e);if(null!=l){var u=new _.Vector3(t,n,o);l.sectionPosition=u,a[Vp._updateModelBoundingBox](),s&&(c=!0,a[Vp._render](),a[Vp._render]())}},F.prototype.getSectionPosition=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_getSectionPosition);var t=f(e);if(null!=t)return t.sectionPosition.clone().toArray();zi(i.b.stringsByLabel.SECTION_LOGGER_warn_getSectionPosition)},F.prototype.setSelectionById=function(e,t){Fi(i.b.stringsByLabel.SECTION_LOGGER_setSelectionById);var n=f(e);p(n,t)},F.prototype.getSelectionById=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_getSelectionById);var t=f(e);if(t)return ki(i.b.stringsByLabel.SECTION_LOGGER_finest_addSectionPlane+t.id),t.selected;zi(i.b.stringsByLabel.SECTION_LOGGER_warn_getSelectionById)},F.prototype.setSelectionAll=function(e){Fi(i.b.stringsByLabel.SECTION_LOGGER_setSelectionAll);for(var n=0,r=t.length;n<r;n++)p(t[n],e);a[Vp._render]()},F.prototype.getSelectedPlane=function(){return u?u.id:-1},new F(e)};$i.prototype={constructor:$i,_name:"Section"};
// CONCATENATED MODULE: ./staging/Network.js
var ea=o()("PLMVisWeb:debug:Network:NetworkManager"),ta=o()("PLMVisWeb:debug:Network:HttpRequest"),na=o()("PLMVisWeb:verbose:Network:HttpRequest"),ra=o()("PLMVisWeb:error:Network:HttpRequest");ra.enabled=!0;var ia=function(e){return 0===e||e>=200&&e<400},aa=function(e){return e>=500},oa=function(e,t,n,r){ta("constructor",e,t,n,r),this.retryLimit=3,this.url=n;var i=0,a=this;void 0===r?r=!0:"boolean"!=typeof withCredentials&&(r=!1),function requestRun(){ta("requestRun",i.toString()+"/"+a.retryLimit.toString(),t,n);var o=new XMLHttpRequest;o.open(t,n,!0);if(r){var s=e.token;s&&s.length>0&&o.setRequestHeader("Authorization","Bearer "+s)}a.xhr=o;o.onload=function(r){na("requestRun:onload",r),401===o.status?(ra("requestRun:onload:DENY",t,n),i=a.retryLimit,"function"==typeof a.ondeny&&a.ondeny(r),e&&e.deny(a)):void 0!==o.response&&ia(o.status)?(ta("requestRun:onload:SUCCESS",t,n),"function"==typeof a.onsuccess&&a.onsuccess(r)):i!==a.retryLimit&&aa(o.status)||"function"!=typeof a.onerror?i++<a.retryLimit&&(na("requestRun:RETRY",t,n),requestRun(),a.send(a.body)):(ra("requestRun:onload:ERROR",t,n),a.onerror(r))};o.onprogress=function(e){na("requestRun:onprogress",t,n,e),"function"==typeof a.onprogress&&a.onprogress(e)};o.onerror=function(e){ra("requestRun:onerror",t,n,e),i++<a.retryLimit?(requestRun(),a.send(a.body)):"function"==typeof a.onerror&&a.onerror(e)};o.ontimeout=function(e){na("requestRun:ontimeout",t,n,e),i++<a.retryLimit?(requestRun(),a.send(a.body)):"function"==typeof a.ontimeout&&a.ontimeout(e)}}()};Object.defineProperties(oa.prototype,{upload:{get:function(){return this.xhr.upload}},response:{get:function(){return this.xhr.response}},responseText:{get:function(){return this.xhr.responseText}},status:{get:function(){return this.xhr.status}},readyState:{get:function(){return this.xhr.readyState}},responseType:{get:function(){return this.xhr.responseType},set:function(e){this.xhr.responseType=e}},timeout:{get:function(){return this.xhr.timeout},set:function(e){this.xhr.timeout=e}},onreadystatechange:{get:function(){return this.xhr.onreadystatechange},set:function(e){this.xhr.onreadystatechange=e}}}),oa.prototype.setContentType=function(e){ta("setContentType",e),this.xhr.setRequestHeader("content-type",e)},oa.prototype.setRequestHeader=function(e,t){ta("setRequestHeader",e,t),this.xhr.setRequestHeader(e,t)},oa.prototype.abort=function(){ta("abort"),this.xhr.abort()},oa.prototype.send=function(e){ta("send",e),this.body=e,this.xhr.send(e)};var sa=function(){ea("constructor");var e=null;Object.defineProperties(this,{token:{get:function(){return e},set:function(t){e!==t&&(e=t,this.workerPool&&this.workerPool.broadcast({cmd:"token",token:t}))}}}),this.deny=function(e){ea("deny",e),this.worker?this.worker.postMessage({cmd:"deny",request:{url:e.url}}):function(e,t){if(null!==t&&void 0!==t&&null!==t.type&&void 0!==t.type&&void 0!==e._listeners){var n=e._listeners[t.type];if(void 0!==n)for(var r=n.length,i=0;i<r;i++){var a=n[i];a.call(a,t)}}}(this,{type:"onDeny",url:e.url})},this.createHttpRequest=function(e,t,n){return ea("createHttpRequest",e,t,n),new oa(this,e,t,n)},this.addEventListener=function(e,t){ea("addEventListener",e,t),void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},this.removeEventListener=function(e,t){if(ea("removeEventListener",e,t),void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},la=n(137),ca=n(11),ua=o()("PLMVisWeb:debug:CacheLoaderExtension"),ha=o()("PLMVisWeb:error:CacheLoaderExtension"),da=(o()("PLMVisWeb:warning:CacheLoaderExtension"),o()("PLMVisWeb:verbose:CacheLoaderExtension"));
// EXTERNAL MODULE: ./staging/WorkerPool.js
const pa="plmvisweb_data_cache";var fa=function(){this.completed=!1,this.busy=!1,this.cachedRequests={},this.cachedSaves={},this.needsUpdated=null},ma=function(e,t,n){ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToFindCacheRecord+e.value),t.nTotalCompleted++,this.dispatchEvent.call(this,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToFindCacheRecord+e.value,request:e,event:n}),!this.needsUpdated&&(this.needsUpdated=[]),this.needsUpdated.push(e.value),e.callback(null)},ga=function(e){if(e.requests.length>0){var t=e.requests.pop(),n=e.store.get(t.value);e.idle=!1,n.onsuccess=function(n){da(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_finest_retrieved+t.value+", "+e.requests.length),e.nTotalSucceeded++;var r=null;n&&n.currentTarget&&n.currentTarget.result?(r=n.currentTarget.result,e.nTotalCompleted++):ma.call(this,t,e,n),t.callback(r),e.idle=!0,ga.call(this,e)}.bind(this),n.onerror=function(n){ma.call(this,t,e,n),e.idle=!0,ga.call(this,e)}.bind(this)}else e.waitForCompleted&&!this.completed||e.nTotalCompleted!==e.nTotalRequests||(this.busy=!1,this.dispatchEvent.call(this,xa.EventTypes.RequestsFinished,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_fine_readFinished+e.datatype+" nRequests: "+e.nTotalRequests+" nSucceeded "+e.nTotalSucceeded}),ua(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_fine_readFinished)),e.idle=!0},va=function(e){var t=this,n=this.cachedSaves[e];if(n&&n.saves.length>0){var r,a=n.saves.pop();r=n.store.put(a.value),n.idle=!1,r.onsuccess=function(r){n.nTotalSucceeded++,n.nTotalCompleted++,da(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_finest_saved+(a.value.psId||a.value.modelPath)+", "+n.saves.length),a.callback(!0),0===n.saves.length&&(n.idle=!0),va.call(t,e)}.bind(t),r.onerror=function(r){var o=t._db.transaction(n.datatype,"readwrite");n.store=o.objectStore(n.datatype),a.saveAttempts++,a.saveAttempts>3?(this.dispatchEvent.call(t,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToAddCacheRecord+(a.value.psId||a.value.modelPath),request:a,event:r}),ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToAddCacheRecord+a.value.psId+" , "+r),a.callback(!1),0===n.saves.length&&(n.idle=!0)):n.saves.push(a),va.call(t,e)}.bind(t)}else n.waitForCompleted&&!t.completed||n.nTotalCompleted!==n.nTotalSaves||(t.busy=!1,t.dispatchEvent.call(t,xa.EventTypes.SavesFinished,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_fine_cachingFinished+n.datatype+" nSaves: "+n.nTotalSaves+" nSavesSucceeded "+n.nTotalCompleted}),ua(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_fine_cachingFinished)),n.store=null,n.idle=!0},ya=function(){var e=[Int8Array,Int16Array,Int32Array,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,Float32Array,Float64Array],t=["Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","Float32Array","Float64Array"];var n,r=function(n,r){var i,a=r;return(i=function isTypedArray(n){for(var r=0,i=e.length;r<i;r++)if(n instanceof e[r])return t[r];return null}(r))&&(a=Array.from(r)).push("%type%="+i),a};function isStringifiedTypedArray(n){var r=null;if(Array.isArray(n)&&void 0!==n[n.length-1].indexOf&&0===n[n.length-1].indexOf("%type%=")){var i=n[n.length-1].substring(7,n[n.length-1].length);n.length--,r=(i=function getTypeObj(n){for(var r=0,i=t.length;r<i;r++)if(n===t[r])return e[r];return Array}(i)).from(n)}return r}return{clone:function(e){var t=void 0;if(null!==e&&void 0!==e){var i=JSON.stringify(e,r);(function recreateTypedArrays(e){if(n=isStringifiedTypedArray(e))e=n;else for(var t in e)null!=e[t]&&"object"==typeof e[t]?e[t]=recreateTypedArrays(e[t]):(n=isStringifiedTypedArray(e[t]))&&(e[t]=n);return e})(t=JSON.parse(i))}return t}}}(),ba=function(e,t,n,r){var i=null;switch(e){case xa.DataTypes.Structure:i={modelPath:r,structureBlob:ya.clone(n.structure)};break;case xa.DataTypes.Materials:i={modelPath:r,materialsBlob:ya.clone(n.materials)};break;case xa.DataTypes.Part:i={psId:r+" "+t,materialsBlob:ya.clone(n.materials),geometryBlob:ya.clone(n.geometry)}}return i},xa={},_a=function(e){fa.call(this),this._db=null,this.modelIsCached=null,this.modelPath="",this.cachedRequests={},this.cachedSaves={},this.needsUpdated=null,Yn.makeEventer(this,[xa.EventTypes.RequestsFinished,xa.EventTypes.SavesFinished,xa.EventTypes.Error])};(xa=function(e){return(_a.prototype={constructor:_a,_name:"CacheLoaderExtension"}).start=function(e){this.modelIsCached=null,fa.call(this),this.modelPath=e},_a.prototype.open=function(e){var t=this;xa.useCaching?this.modelPath&&(this._db?e(!0):function(){var e=this;return new Promise(function(t,n){var r=indexedDB.open(pa);r.onclose=function(t){e.modelPath="",e.modelIsCached=null,fa(),e._db=null}.bind(e),r.onerror=function(t){e.dispatchEvent.call(e,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_unableToOpenCache+pa,event:t}),n(ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_unableToOpenCache+pa))},r.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore(xa.DataTypes.Structure,{keyPath:"modelPath"}).createIndex("structureBlob","structureBlob",{unique:!1});var t=e.currentTarget.result.createObjectStore(xa.DataTypes.Part,{keyPath:"psId"});t.createIndex("materialsBlob","materialsBlob",{unique:!1}),t.createIndex("geometryBlob","geometryBlob",{unique:!1}),e.currentTarget.result.createObjectStore(xa.DataTypes.Materials,{keyPath:"modelPath"}).createIndex("materialsBlob","materialsBlob",{unique:!1})},r.onsuccess=function(n){da(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_finest_openCacheDB+pa),e._db=n.currentTarget.result,t(!0)}.bind(e)})}.call(this).then(function(t){da(pa+i.b.stringsByLabel.CACHELOADEREXT_LOGGER_finest_db_Open),e(t)}).catch(function(n){t._db=null,ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_cacheOpenFailed),e(!1)})):e(!1)},_a.prototype.removeModel=function(e,t){e&&t&&function(e,t){var n=0,r=IDBKeyRange.bound(e,e+" 9999999999"),i=function(e){3==++n&&t(!1)}.bind(this),a=function(e){3==++n&&t(!0)}.bind(this),o=this._db.transaction(xa.DataTypes.Structure,"readwrite").objectStore(xa.DataTypes.Structure).delete(e);o.onerror=i,o.onsuccess=a;var s=this._db.transaction(xa.DataTypes.Materials,"readwrite").objectStore(xa.DataTypes.Materials).delete(e);s.onerror=i,s.onsuccess=a;var l=this._db.transaction(xa.DataTypes.Part,"readwrite").objectStore(xa.DataTypes.Part).delete(r);l.onerror=i,l.onsuccess=a}.call(this,e,t)},_a.prototype.removeAll=function(e){(function(e){null!==this._db&&(this._db.close(),this._db=null),fa.call(this);var t=indexedDB.deleteDatabase(pa);t.onerror=function(t){ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_purgeError),e(!1)},t.onsuccess=function(t){ua(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_fine_deleteSuccess),e(!0)},t.onblocked=function(t){ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_purgeBlocked),e(!1)}}).call(this,e)},_a.prototype.close=function(){(function(){null!==this._db&&(this._db.close(),this._db=null),fa.call(this)}).call(this)},_a.prototype.isCached=function(e,t){var n=this;if(xa.useCaching)if(this._db)if(e||null===n.modelIsCached){var r=this._db.transaction(xa.DataTypes.Structure).objectStore(xa.DataTypes.Structure);if(r.getAllKeys){var a=r.getKey(e||this.modelPath);a.onsuccess=function(r){if(e){var i=!!r.target.result;t(i)}else n.modelIsCached=!!r.target.result,t(n.modelIsCached)},a.onerror=function(e){ha(n.modelPath+i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_cacheStatusFail),t(!1)}}else{var o=function(r){var i=!1;return e?e===r&&(i=!0,t(!0)):(n.modelIsCached=n.modelPath===r,n.modelIsCached&&(i=!0,t(n.modelIsCached))),i}.bind(this),s=r.openCursor();s?(s.onsuccess=function(e){var n;(n=e.target.result)?o(n.value.modelPath)||n.continue():t(!1)},s.onerror=function(e){this.dispatchEvent.call(this,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToGetModelList,event:e}),ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToGetModelList),t([])}):t([])}}else t(n.modelIsCached);else ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_mustCallOpen),t(!1);else t(!1)},_a.prototype.getCachedList=function(e){if(xa.useCaching&&this._db&&e){var t=this._db.transaction(xa.DataTypes.Structure,"readonly").objectStore(xa.DataTypes.Structure);if(t.getAllKeys){var n=t.getAllKeys();n.onsuccess=function(t){var n=t.target.result;e(n)},n.onerror=function(t){this.dispatchEvent.call(this,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToGetModelList,event:t}),ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToGetModelList),e([])}}else{var r=[],a=t.openCursor();a&&(a.onsuccess=function(t){var n,i;(n=t.target.result)&&(i=n.value.modelPath)?(r.push(i),n.continue()):e(r)},a.onerror=function(t){this.dispatchEvent.call(this,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToGetModelList,event:t}),ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_failedToGetModelList),e([])})}}else ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_mustCallOpen)},_a.prototype.put=function(e,t,n,r){xa.useCaching?e&&r?this.isCached(null,function(i){if(this.needsUpdated){var a=ba(e,t,n,this.modelPath),o=this.needsUpdated.indexOf(a.psId);o>=0&&(this.needsUpdated.splice(o,1),i=!1,0===this.needsUpdated.length&&(this.needsUpdated=null))}!1===i?function(e,t,n,r){if(this.busy=!0,void 0===this.cachedSaves[e]&&(this.cachedSaves[e]={store:null,datatype:null,saves:[],nTotalSaves:0,nTotalCompleted:0,nTotalSucceeded:0,idle:!0},this.cachedSaves[e].datatype=e,this.cachedSaves[e].waitForCompleted=e===xa.DataTypes.Part),xa.useTunedCaching)if(this.cachedSaves[e].idle){var i=this._db.transaction(e,"readwrite");this.cachedSaves[e].store=i.objectStore(e),this.cachedSaves[e].saves.push({saveAttempts:0,value:n,callback:r}),this.cachedSaves[e].nTotalSaves++,va.call(this,e)}else this.cachedSaves[e].nTotalSaves++,this.cachedSaves[e].saves.push({saveAttempts:0,value:n,callback:r});else i=this._db.transaction(e,"readwrite"),this.cachedSaves[e].store=i.objectStore(e),this.cachedSaves[e].saves=[],this.cachedSaves[e].saves.push({saveAttempts:0,value:n,callback:r}),this.cachedSaves[e].nTotalSaves++,va.call(this,e)}.call(this,e,t,ba(e,t,n,this.modelPath),r):r(!0)}.bind(this)):ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_badPut+e+" "+t):r(!1)},_a.prototype.get=function(e,t,n){xa.useCaching?e&&n?this.isCached(null,function(r){!0===r?function(e,t,n){if(this.busy=!0,void 0===this.cachedRequests[e]&&(this.cachedRequests[e]={waitForCompleted:!1,store:null,datatype:null,requests:[],nTotalRequests:0,nTotalCompleted:0,nTotalSucceeded:0,idle:!0},this.cachedRequests[e].datatype=e,this.cachedRequests[e].waitForCompleted=e===xa.DataTypes.Part),xa.useTunedCaching)if(this.cachedRequests[e].idle){var r=this._db.transaction(e,"readonly");this.cachedRequests[e].store=r.objectStore(e),this.cachedRequests[e].requests.push({value:t,callback:n}),this.cachedRequests[e].nTotalRequests++,ga.call(this,this.cachedRequests[e])}else this.cachedRequests[e].nTotalRequests++,this.cachedRequests[e].requests.push({value:t,callback:n});else r=this._db.transaction(e,"readonly"),this.cachedRequests[e].store=r.objectStore(e),this.cachedRequests[e].requests=[],this.cachedRequests[e].requests.push({value:t,callback:n}),this.cachedRequests[e].nTotalRequests++,ga.call(this,this.cachedRequests[e])}.call(this,e,function(e,t,n){var r="";switch(e){case xa.DataTypes.Structure:case xa.DataTypes.Materials:r=n;break;case xa.DataTypes.Part:r=n+" "+t}return r}(e,t,this.modelPath),n):n(null)}.bind(this)):(this.dispatchEvent.call(this,xa.EventTypes.Error,{msg:i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_badGet}),ha(i.b.stringsByLabel.CACHELOADEREXT_LOGGER_warn_badGet)):n(null)},new _a(e)}).prototype={constructor:xa,_name:"CacheLoaderExtension"};xa.EventTypes={RequestsFinished:"requestsFinishedEvent",SavesFinished:"savesFinishedEvent",Error:"error"};xa.DataTypes={Structure:"Structure",Materials:"Material",Part:"Part"},xa.useCaching=!1,xa.useTunedCaching=!0;/* harmony default export */var wa=xa,Ma=o()("PLMVisWeb:debug:BodLoader"),Ea=o()("PLMVisWeb:error:BodLoader");
// CONCATENATED MODULE: ./staging/BodLoader.js
Ea.enabled=!0,Ma("BodWorker",ca.a);var Sa=null;(Sa=function(e){this.manager=void 0!==e?e:_.DefaultLoadingManager}).prototype={constructor:Sa,load:function(e,t,n,r,i){var a=new _.Texture,o=new _.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a,i)},function(e){n(e,i)},function(e){r(e,i)}),a},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}};var La=6,Ta=new _.Texture,Aa=1/255;function _ab2str(e){for(var t=new Uint8Array(e),n="",r=0,i=t.length;r<i;r+=65535)n+=r+65535>i?String.fromCharCode.apply(null,t.subarray(r,r+(i-r))):String.fromCharCode.apply(null,t.subarray(r,r+65535));return n}var Ca=document.createElement("canvas"),Pa=Ca.getContext("2d");function flipImage(e,t){function imageLoaded(e,n){return function(){e.removeEventListener("load",n),e.removeEventListener("error",n),t()}}var n=e.width,r=e.height;Ca.setAttribute("width",n),Ca.setAttribute("height",r),Pa.clearRect(0,0,n,r),Pa.save(),Pa.translate(n,r),Pa.setTransform(-1,0,0,-1,n,r),Pa.drawImage(e,0,0,n,r),Pa.restore(),e.addEventListener("load",imageLoaded(e,imageLoaded)),e.addEventListener("error",imageLoaded(e,imageLoaded)),e.src=Ca.toDataURL(),Pa.clearRect(0,0,n,r)}function flipImages(e,t){var n=0;function imageReady(){6==++n&&t()}for(var r=e.image,i=0;i<6;++i)flipImage(r[i],imageReady)}function getDMBlendMode(e){var t=void 0;switch(e){case He.a.Decal:t="ENVMAP_BLENDING_DM_DECAL";break;case He.a.Modulate:t="ENVMAP_BLENDING_DM_MODULATE";break;case He.a.Replace:t="ENVMAP_BLENDING_DM_REPLACE";break;case He.a.Blend:t="ENVMAP_BLENDING_DM_BLEND";break;case He.a.Add:t="ENVMAP_BLENDING_DM_ADD";break;case He.a.Combine:t="ENVMAP_BLENDING_DM_COMBINE";break;case He.a.None:default:t="ENVMAP_BLENDING_DM_NONE"}return t}var Ia=function(e,t,n){_.Loader.call(this,t),this.viewer=e,this.withCredentials=!1,this.cacheHandler=n};function BodLoader_processMaterials(e,t,n){var i=null,a=0,o=0,s=0,l=0,c=255,u=0,h=-1,d=new _.Color,p=0;p+=e.phong?e.phong.index.length:0,p+=e.flat?e.flat.index.length:0,p+=e.line?e.line.index.length:0,p+=e.texture&&void 0===e.texpair&&void 0===e.textriplet?e.texture.index.length:0,p+=e.texpair?e.texpair.index.length:0,p+=e.textriplet?e.textriplet.index.length:0;var f=0;function materialDone(){++f===p&&n()}if(e.phong)for(a=0,o=(i=e.phong).index.length;a<o;++a)c=(255&i.diffuse[a])*Aa,s=i.diffuse[a]>>8&16777215,l=i.emissive[a]>>8&16777215,u=i.specular[a]>>8&16777215,t[i.index[a]+La]=r.b._createMeshMaterial({diffuse:s,emissive:l,specular:u,shininess:i.shininess[a],opacity:c},!0,!0),materialDone();if(e.flat)for(a=0,o=(i=e.flat).index.length;a<o;++a)c=(255&i.diffuse[a])*Aa,s=i.diffuse[a]>>8&16777215,t[i.index[a]+La]=r.b._createMeshMaterial({diffuse:s,emissive:0,specular:0,shininess:1e-6,opacity:c},!0,!0),materialDone();if(e.line)for(a=0,o=(i=e.line).index.length;a<o;++a)c=(255&i.color[a])*Aa,s=i.color[a]>>8&16777215,t[i.index[a]+La]=r.b._createLineMaterial(s,c,2,!0,!0),materialDone();if(e.texture&&void 0===e.texpair&&void 0===e.textriplet){var m=new Sa;o=(i=e.texture).index.length;var g=function(e,n){t[i.index[n]+La]=r.b._createTextureMaterial(e,!0,!0),materialDone()},v=function(e){return function(t){g(t,e)}},y=function(e){return function(t){Ea(t),g(Ta,e)}};for(a=0;a<o;a++){var b=_ab2str(i.texB64Data[a].buffer);m.load(b,v(a),null,y(a))}}if(e.texpair){m=null;var x=null,w=function(e){e.mapping=_.UVMapping,e.wrapS=_.RepeatWrapping,e.wrapT=_.RepeatWrapping,materialDone()},M=function(e){e.mapping=_.SphericalReflectionMapping,materialDone()},E=function(e){flipImages(e,materialDone)};for(a=0,o=(i=e.texpair).index.length;a<o;a++){switch(h=i.baseMaterialIndex[a],i.baseMaterialType[a]){case 0:c=(255&e.phong.diffuse[h])*Aa,s=e.phong.diffuse[h]>>8&16777215,l=e.phong.emissive[h]>>8&16777215,u=e.phong.specular[h]>>8&16777215,x=r.b._createMeshMaterial({diffuse:s,emissive:l,specular:u,shininess:e.phong.shininess[h],opacity:c},!0,!0);break;case 1:c=(255&e.phong.diffuse[h])*Aa,s=e.phong.diffuse[h]>>8&16777215,x=r.b._createMeshMaterial({diffuse:s,emissive:0,specular:0,shininess:1e-6,opacity:c},!0,!0);break;default:x=r.b._createMeshMaterial({diffuse:16777215,emissive:0,specular:0,shininess:1e-6,opacity:1},!0,!0)}switch(h=i.textureMaterialIndex[a],i.textureMaterialType[a]){case 2:m=new _.TextureLoader,x.uniforms.map={value:m.load(_ab2str(e.texture.texB64Data[h].buffer),w,null,w)},x.defines.USE_MAP="";break;case 4:c=(255&e.spheremap.blendColor[h])*Aa,s=e.spheremap.blendColor[h]>>8&16777215,d.setHex(s),x.uniforms.blendColor={value:new _.Vector4(d.r,d.g,d.b,c)},x.combine=e.spheremap.blendType[h]+_.AddOperation+1,x.defines[getDMBlendMode(e.spheremap.blendType[h])]="",m=new _.TextureLoader,x.uniforms.envMap={value:m.load(_ab2str(e.spheremap.texB64Data[h].buffer),M,null,M)},x.envMap=x.uniforms.envMap.value,x.hasEnvMap=1;break;case 5:c=(255&e.cubemap.blendColor[h])*Aa,s=e.cubemap.blendColor[h]>>8&16777215,d.setHex(s),x.uniforms.blendColor={value:new _.Vector4(d.r,d.g,d.b,c)},x.combine=e.cubemap.blendType[h]+_.AddOperation+1,x.defines[getDMBlendMode(e.cubemap.blendType[h])]="",h*=6,m=new _.CubeTextureLoader,x.uniforms.envMap={value:m.load([_ab2str(e.cubemap.texB64Data[h+1].buffer),_ab2str(e.cubemap.texB64Data[h+0].buffer),_ab2str(e.cubemap.texB64Data[h+2].buffer),_ab2str(e.cubemap.texB64Data[h+3].buffer),_ab2str(e.cubemap.texB64Data[h+4].buffer),_ab2str(e.cubemap.texB64Data[h+5].buffer)],E,null,E)},x.envMap=x.uniforms.envMap.value,x.hasEnvMap=1}t[i.index[a]+La]=x}}if(e.textriplet){m=null,x=null;var S={},L=function(e){S[e]&&S[e].uvLoaded&&S[e].envLoaded&&(materialDone(),delete S[e])};for(w=function(e){return function(t){t.mapping=_.UVMapping,t.wrapS=_.RepeatWrapping,t.wrapT=_.RepeatWrapping,S[e].uvLoaded=!0,L(e)}},M=function(e){return function(t){t.mapping=_.SphericalReflectionMapping,S[e].envLoaded=!0,L(e)}},E=function(e){return function(t){flipImages(t,function(){S[e].envLoaded=!0,L(e)})}},a=0,o=(i=e.textriplet).index.length;a<o;a++){switch(S[a]={uvLoaded:!1,envLoaded:!1},h=i.baseMaterialIndex[a],i.baseMaterialType[a]){case 0:c=(255&e.phong.diffuse[h])*Aa,s=e.phong.diffuse[h]>>8&16777215,l=e.phong.emissive[h]>>8&16777215,u=e.phong.specular[h]>>8&16777215,x=r.b._createMeshMaterial({diffuse:s,emissive:l,specular:u,shininess:e.phong.shininess[h],opacity:c},!0,!0);break;case 1:c=(255&e.phong.diffuse[h])*Aa,s=e.phong.diffuse[h]>>8&16777215,x=r.b._createMeshMaterial({diffuse:s,emissive:0,specular:0,shininess:1e-6,opacity:c},!0,!0);break;default:x=r.b._createMeshMaterial({diffuse:16777215,emissive:0,specular:0,shininess:1e-6,opacity:1},!0,!0)}switch(h=i.uvMaterialIndex[a],m=new _.TextureLoader,x.uniforms.map={value:m.load(_ab2str(e.texture.texB64Data[h].buffer),w(a),null,w(a))},x.defines.USE_MAP="",h=i.envMaterialIndex[a],i.envMaterialType[a]){case 4:c=(255&e.spheremap.blendColor[h])*Aa,s=e.spheremap.blendColor[h]>>8&16777215,d.setHex(s),x.uniforms.blendColor={value:new _.Vector4(d.r,d.g,d.b,c)},x.combine=e.spheremap.blendType[h]+_.AddOperation+1,x.defines[getDMBlendMode(e.spheremap.blendType[h])]="",m=new _.TextureLoader,x.uniforms.envMap={value:m.load(_ab2str(e.spheremap.texB64Data[h].buffer),M(a),null,M(a))},x.envMap=x.uniforms.envMap.value;break;case 5:c=(255&e.cubemap.blendColor[h])*Aa,s=e.cubemap.blendColor[h]>>8&16777215,d.setHex(s),x.uniforms.blendColor={value:new _.Vector4(d.r,d.g,d.b,c)},x.combine=e.cubemap.blendType[h]+_.AddOperation+1,x.defines[getDMBlendMode(e.cubemap.blendType[h])]="",h*=6,m=new _.CubeTextureLoader,x.uniforms.envMap={value:m.load([_ab2str(e.cubemap.texB64Data[h+1].buffer),_ab2str(e.cubemap.texB64Data[h+0].buffer),_ab2str(e.cubemap.texB64Data[h+2].buffer),_ab2str(e.cubemap.texB64Data[h+3].buffer),_ab2str(e.cubemap.texB64Data[h+4].buffer),_ab2str(e.cubemap.texB64Data[h+5].buffer)],E(a),null,E(a))},x.envMap=x.uniforms.envMap.value}t[i.index[a]+La]=x}}}function BodLoader_defineGeometry(e){var t=null;return e.hasVertexColors?(t=new ze.InstancedVertexColorBufferGeometry,r.b._isNumber(e.drawMode)&&e.drawMode>-1&&e.drawMode<3&&(t.drawMode=e.drawMode)):6===e.geometryType?t=new WideLineGeometry:1===e.geometryType?t=new ze.InstancedLineBufferGeometry:(t=new ze.InstancedMeshBufferGeometry,r.b._isNumber(e.drawMode)&&e.drawMode>-1&&e.drawMode<3&&(t.drawMode=e.drawMode)),t}function BodLoader_partBufferToBodyBuffers(e){var t=null;if(1===e.xtBodies.length)(t=e.xtBodies[0]).drawMode=e.drawMode,t.geometryType=e.geometryType,r.b._notNullOrUndefined(e.materialIndexBuffer)&&(t.materialIndexBuffer=e.materialIndexBuffer,e.materialIndexBuffer=null,delete e.materialIndexBuffer),r.b._notNullOrUndefined(e.groupStartBuffer)&&(t.groupStartBuffer=e.groupStartBuffer,e.groupStartBuffer=null,delete e.groupStartBuffer),r.b._notNullOrUndefined(e.groupCountBuffer)&&(t.groupCountBuffer=e.groupCountBuffer,e.groupCountBuffer=null,delete e.groupCountBuffer),r.b._notNullOrUndefined(e.vertexBuffer)&&(t.vertexBuffer=e.vertexBuffer,e.vertexBuffer=null,delete e.vertexBuffer),r.b._notNullOrUndefined(e.indexBuffer)&&(t.indexBuffer=e.indexBuffer,e.indexBuffer=null,delete e.indexBuffer),r.b._notNullOrUndefined(e.normalBuffer)&&(t.normalBuffer=e.normalBuffer,e.normalBuffer=null,delete e.normBuffAtt),r.b._notNullOrUndefined(e.vertexColorBuffer)&&(t.vertexColorBuffer=e.vertexColorBuffer,e.vertexColorBuffer=null,delete e.vertexColorBuffer),r.b._notNullOrUndefined(e.uvCoordinatesBuffer)&&(t.uvCoordinatesBuffer=e.uvCoordinatesBuffer,e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer),e.hasVertexColors&&(t.hasVertexColors=!0,delete e.hasVertexColors),e.hasTextureUVs&&(t.hasTextureUVs=!0,delete e.hasTextureUVs),delete e.drawMode,delete e.geometryType;else{for(var n=0,i=0,a=e.xtBodies.length;i<a;i++){(t=e.xtBodies[i]).drawMode=e.drawMode,t.geometryType=e.geometryType;for(var o,s=0,l=t.faces[0].start,c=n,u=0,h=t.faces.length;u<h;u++)(o=t.faces[u]).start-=l,o.groupIndex=u,s+=o.count,e.groupStartBuffer[n]-=l,n++;t.groupStartBuffer=e.groupStartBuffer.slice(c,n),t.groupCountBuffer=e.groupCountBuffer.slice(c,n),t.materialIndexBuffer=e.materialIndexBuffer.slice(c,n);var d,p=e.indexBuffer[l];d=l+s===e.indexBuffer.length?e.indexBuffer.length:e.indexBuffer[l+s],t.indexBuffer=e.indexBuffer.slice(l,l+s);for(var f=t.indexBuffer[0],m=0;m<t.indexBuffer.length;m++)t.indexBuffer[m]=t.indexBuffer[m]-f;r.b._notNullOrUndefined(e.vertexBuffer)&&(t.vertexBuffer=e.vertexBuffer.slice(3*p,3*d)),r.b._notNullOrUndefined(e.normalBuffer)&&(t.normalBuffer=e.normalBuffer.slice(3*p,3*d)),r.b._notNullOrUndefined(e.vertexColorBuffer)&&(t.vertexColorBuffer=e.vertexColorBuffer.slice(3*p,3*d)),r.b._notNullOrUndefined(e.uvCoordinatesBuffer)&&(t.uvCoordinatesBuffer=e.uvCoordinatesBuffer.slice(2*p,2*d))}r.b._notNullOrUndefined(e.materialIndexBuffer)&&(e.materialIndexBuffer=null,delete e.materialIndexBuffer),r.b._notNullOrUndefined(e.groupStartBuffer)&&(e.groupStartBuffer=null,delete e.groupStartBuffer),r.b._notNullOrUndefined(e.groupCountBuffer)&&(e.groupCountBuffer=null,delete e.groupCountBuffer),r.b._notNullOrUndefined(e.vertexBuffer)&&(e.vertexBuffer=null,delete e.vertexBuffer),r.b._notNullOrUndefined(e.indexBuffer)&&(e.indexBuffer=null,delete e.indexBuffer),r.b._notNullOrUndefined(e.normalBuffer)&&(e.normalBuffer=null,delete e.normalBuffer),r.b._notNullOrUndefined(e.vertexColorBuffer)&&(e.vertexColorBuffer=null,delete e.vertexColorBuffer,delete e.hasVertexColors),r.b._notNullOrUndefined(e.uvCoordinatesBuffer)&&(e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer,delete e.hasTextureUVs),delete e.drawMode,delete e.geometryType}}function BodLoader_processXTBodyBuffer(e,t){var n=BodLoader_defineGeometry(e);n.xtBodies=[e];for(var i=0,a=e.faces.length;i<a;i++){var o=e.materialIndexBuffer[i];o>=0&&(o+=6),n.addGroup(e.groupStartBuffer[i],e.groupCountBuffer[i],o),n.groups[i].face=e.faces[i]}e.materialIndexBuffer=null,e.groupStartBuffer=null,e.groupCountBuffer=null,delete e.materialIndexBuffer,delete e.groupStartBuffer,delete e.groupCountBuffer,6===e.geometryType?(n.setPositions(e.vertexBuffer),e.vertexBuffer=null,delete e.vertexBuffer):(n.addAttribute("position",new _.BufferAttribute(e.vertexBuffer,3)),e.vertexBuffer=null,delete e.vertexBuffer,n.setIndex(new _.BufferAttribute(e.indexBuffer,1)),e.indexBuffer=null,delete e.indexBuffer,1===e.geometryType&&(n.isLines=!0),r.b._notNullOrUndefined(e.normalBuffer)&&(n.addAttribute("normal",new _.BufferAttribute(e.normalBuffer,3)),e.normalBuffer=null,delete e.normalBuffer),e.hasVertexColors&&(n.addAttribute("color",new _.BufferAttribute(e.vertexColorBuffer,3)),e.vertexColorBuffer=null,delete e.vertexColorBuffer,delete e.hasVertexColors),e.hasTextureUVs&&(n.addAttribute("uv",new _.BufferAttribute(e.uvCoordinatesBuffer,2)),e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer,delete e.hasTextureUVs)),t.push(n),e=null}function BodLoader_processNoXTBuffer(e,t){for(var n=BodLoader_defineGeometry(e),i=0,a=e.groupStartBuffer.length;i<a;++i){var o=e.materialIndexBuffer[i];o>=0&&(o+=6),n.addGroup(e.groupStartBuffer[i],e.groupCountBuffer[i],o)}e.materialIndexBuffer=null,e.groupStartBuffer=null,e.groupCountBuffer=null,delete e.materialIndexBuffer,delete e.groupStartBuffer,delete e.groupCountBuffer,6===e.geometryType?(n.setPositions(e.vertexBuffer),e.vertexBuffer=null,delete e.vertexBuffer):(n.addAttribute("position",new _.BufferAttribute(e.vertexBuffer,3)),e.vertexBuffer=null,delete e.vertexBuffer,n.setIndex(new _.BufferAttribute(e.indexBuffer,1)),e.indexBuffer=null,delete e.indexBuffer,1===e.geometryType&&(n.isLines=!0),r.b._notNullOrUndefined(e.normalBuffer)&&(n.addAttribute("normal",new _.BufferAttribute(e.normalBuffer,3)),e.normalBuffer=null,delete e.normalBuffer),e.hasVertexColors&&(n.addAttribute("color",new _.BufferAttribute(e.vertexColorBuffer,3)),e.vertexColorBuffer=null,delete e.vertexColorBuffer,delete e.hasVertexColors),e.hasTextureUVs&&(n.addAttribute("uv",new _.BufferAttribute(e.uvCoordinatesBuffer,2)),e.uvCoordinatesBuffer=null,delete e.uvCoordinatesBuffer,delete e.hasTextureUVs)),t.push(n),e=null}function _processBuffers(e,t,n){for(var i=null,a=0,o=e.length;a<o;++a)if(i=e[a],r.b._notNullOrUndefined(i.xtBodies)){r.b._isNullOrUndefined(i.bufferPerBody)&&(BodLoader_partBufferToBodyBuffers(i),i.bufferPerBody=!0);for(var s=0,l=i.xtBodies.length;s<l;++s){BodLoader_processXTBodyBuffer(i.xtBodies[s],t)}}else BodLoader_processNoXTBuffer(i,t);e=null,n()}function _handleMessage(e,t,n){var r=null,i=null,a=(t.numMaterials>0?1:0)+(t.numBuffers>0?1:0),o=0,s=0,l=function(){if(++s==(t.numMaterials>0&&t.numBuffers>0?3:2)&&t.buffers)for(var e,n=0,r=t.buffers.length;n<r;++n)(e=t.buffers[n]).normalBuffer=null,e.vertexColorBuffer=null,e.uvCoordinatesBuffer=null,e.vertexBuffer=null,e.indexBuffer=null,e.groupStartBuffer=null,e.groupCountBuffer=null,e.materialIndexBuffer=null,e=null}.bind(this),c=function(){a===++o&&n(i,r,t.delta,t.index,t.curvedBuffers)};(t.numMaterials>0||t.numBuffers>0)&&e.put(t.psId?wa.DataTypes.Part:wa.DataTypes.Materials,t.psId||"",{materials:t.materials,geometry:t.buffers},function(){l()}.bind(this)),t.numMaterials>0&&(r=[],BodLoader_processMaterials(t.materials,r,c)),t.numBuffers>0&&(i=[],_processBuffers(t.buffers,i,c))}(Ia.prototype=Object.create(_.Loader.prototype)).constructor=Ia,Ia.prototype.postRequest=function(e,t,n,r,i){this.postMessage(e,"POST",i,null,n,null,t,r)},Ia.prototype.postMessage=function(e,t,n,r,i,a,o,s,l,c){Ma("postMessage",e,t),this.onLoadStart();var u=this;Ma("postMessage worker pool",{cmd:"BodWorker",url:e,lod:s,method:t,arguments:o,modelId:i},ca.a),this.viewer._workerPool.postMessage({cmd:"BodWorker",url:e,lod:s,method:t,arguments:o,modelId:i},null,function(e){if(e&&e.isProgressEvent&&l)n(null,null,null,null,null,e.progressEvent);else if(e)if(e.multiBuffer)for(var t=e.multiBuffer.offsets,r=e.multiBuffer.buffer,a=e.multiBuffer.byteOffset,o=0,s=t.length;o<s;o++){var h=t[o].start+a,d=t[o].length+h,p=r.slice(h,d);Ma("postMessage.doneCallback worker pool","BodWorker"),u.viewer._workerPool.postMessage({binaryData:p,cmd:"BodWorker",index:o},[p],function(e){Ma("postMessage worker pool callback",e),_handleMessage(this.cacheHandler,e,n)})}else e.modelId=i,e.psId=c,_handleMessage(this.cacheHandler,e,n);else n(null,null)}.bind(this))},Ia.prototype.refine=function(e,t,n){if(e.curvedBuffers&&e.curvedBuffers.vertexBuffer.length>0){var r=[],i=e.curvedBuffers;r.push(i.controlPointIndex.buffer),r.push(i.controlPointBuffer.buffer),r.push(i.normalIndex.buffer),r.push(i.normalBuffer.buffer),r.push(i.vertexIndex.buffer),r.push(i.vertexBuffer.buffer),r.push(i.groupCountBuffer.buffer),r.push(i.groupStartBuffer.buffer),this.viewer._workerPool.postMessage({lod:t,shape:e,cmd:"BodWorker"},r,n)}else n()},Ia.prototype.loadFromFile=function(e,t,n,r,i,a,o,s,l){this.cacheHandler.get("materials"===l?wa.DataTypes.Materials:wa.DataTypes.Part,s||"",function(l){if(null!==l){var c={modelId:i,psId:s,buffers:l.geometryBlob,numBuffers:l.geometryBlob?l.geometryBlob.length:0,numMaterials:l.materialsBlob?1:0,materials:l.materialsBlob};_handleMessage(this.cacheHandler,c,t)}else this.postMessage(e,"GET",t,r,i,a,null,n,o,s)}.bind(this))},Ia.prototype.loadFromBinary=function(e,t,n,r,i,a,o){if(this.onLoadStart(),e){var s=function(e){var n=null,r=null;if(e){var i=0===e.numMaterials,a=0===e.numBuffers,o=function(){i&&a&&t(r,n)};e.numMaterials>0&&(n=[],i=!0,BodLoader_processMaterials(e.materials,n,o)),e.numBuffers>0&&(r=[],a=!0,_processBuffers(e.buffers,r,o))}else t(null,null)};"materials"===o?this.cacheHandler.get(wa.DataTypes.Materials,a||"",function(t){if(null===t)this.viewer._workerPool.postMessage({lod:n,binaryData:e,cmd:"BodWorker",modelId:i},null,s);else{var r={numMaterials:t.materialsBlob.length,materials:t.materialsBlob};s(r)}}.bind(this)):this.cacheHandler.get(wa.DataTypes.Part,a||"",function(t){if(null===t)this.viewer._workerPool.postMessage({lod:n,binaryData:e,cmd:"BodWorker",modelId:i},null,s);else{var r={modelId:i,psId:a,buffers:t.geometryBlob,numBuffers:t.geometryBlob?t.geometryBlob.length:0,numMaterials:t.materialsBlob?1:0,materials:t.materialsBlob};s(r)}}.bind(this))}else t(null,null)};/* harmony default export */var Oa=Ia,Ba=function(){var e=null;Object.defineProperties(this,{viewer:{get:function(){return e},set:function(t){e!==t&&(e=t)&&this.attachViewer(e)}}})};
// CONCATENATED MODULE: ./staging/Api.js
Ba.prototype.attachViewer=function(e){},Ba.prototype.refine=function(e){if(e){var t=e.doneCallback;t&&t()}},Ba.prototype.loadShapes=function(e){},Ba.prototype.loadXTShapes=function(e){},Ba.prototype.loadProductStructure=function(e){},Ba.prototype.loadPmiStructure=function(e){};/* harmony default export */var Ra=Ba,Ga=n(133),Da=/* */n.n(Ga),Va=function(e,t,n){const r=e,i=t,a=n;var o,s,l,c,u,h=0,d=h,p=0;const f=Math.PI/180;function computeLayer(e,t,n,r,i,a,o,s){e.applyMatrix4(t);const l=e.radius/(Math.tan(i*f/2)*r.distanceTo(e.center))*n;return s&&l<o?m.e.unloaded:l<a?m.e.hiddenAndLoaded:m.e.visibleAndLoaded}const g=function(){};function maybeRequestNextDataBatch(){const e=d-h;e>0?(p++,r(h,e,handleResponseData)):a()}function handleResponseData(e,t,n,r){p--;const a=new _.Vector3(e[0],e[1],e[2]),f=[];var m;for(m=0;m<r;m++){const e=n[m],r=new _.Matrix4;r.elements=e.worldMatrix;const i=computeLayer(new _.Sphere(new _.Vector3(e.boundingSphere.x,e.boundingSphere.y,e.boundingSphere.z),e.boundingSphere.radius),r,c,a,t,s,l,u);i!==e.currentLayer&&f.push({psid:e.psid,newLayer:i})}f.length>0&&i(f),(h+=r)>=o&&(h%=o,d%=o),maybeRequestNextDataBatch()}return g.prototype.setDirty=function(e,t,n,r,i){s=e,l=t,d=h+n,o=n,c=r,u=i,p<=0&&maybeRequestNextDataBatch()},new g};
// EXTERNAL MODULE: ./node_modules/worker-loader/dist/cjs.js?name=plmvisweb.worker.min.js&inline=true&fallback=false!./staging/CullingWorker.js
// CONCATENATED MODULE: ./staging/CullingSceneApplicator.js
const Na=function(e){const t=function(e){if(!e)throw new Error("Assertion failure")},n="cullingNumInstancesLoadedCount",i="isLoadedForCulling",a=function(){};var o=!0;const s=function(){};function _attemptUnloadObject(t){r.b._isObject(t,!0),t.isLoading||!t[i]&&r.b._isBoolean(t[i])||(t[i]=!1,t.original[n]--,0===t.original[n]&&t.instances.forEach(t=>{e.unloadObj(t)}))}function _loadObjectsInBatches(o,s,l,c,u,h){r.b._isArray(o,!0),t(o.length>0),r.b._isNumber(s,!0),t(s>=0),t(l>=0&&l<=s),t(c>0),u=u||a,h=h||a;const d=s-l,p=Math.min(d,c);p>0?function _loadObjects(o,s,l,c,u){if(r.b._isArray(o,!0),t(o.length>0),r.b._isNumber(s,!0),t(s>=0),t(l>=0&&l<s),t(c>0),s>0){u=u||a;var h=0;const t=function(){h++;const e=this.obj;if(e.visible){const t=function(e){e.visible?r.b._isArray(e.shapes)&&e.shapes.forEach(e=>{e.visible=!0}):e.visible=!0};e.children&&e.children.length>0?e.children.forEach(e=>{t(e)}):t(e)}h===c&&u()};var d;const s=l+c;for(d=l;d<s;d++){const a=o[d],s=a.obj;s[i]=!0,r.b._isNumber(s.original[n])?s.original[n]++:s.original[n]=1,e.loadShapes({object:s,doneCallback:t.bind(a)})}}else u()}(o,s,l,p,function(){u(l);const e=Math.min(l+c,s);_loadObjectsInBatches(o,s,e,c,u,h)}):h()}(s.prototype={constructor:Na}).assignLayers=function(t,n){if(n=r.b._isFunction(n)?n:a,o){const a=[];a.length=Math.max(t.length,a.length);var s=0;for(let n=0;n<t.length;n++){const o=t[n],l=e.getObjectByPsId(o.psid);r.b._isObject(l,!0),l.cullingLayer!==o.newLayer&&(o.newLayer===m.e.unloaded?_attemptUnloadObject(l):l[i]||(a[s++]={obj:l,newLayer:o.newLayer}),l.cullingLayer=o.newLayer)}s>0?_loadObjectsInBatches(a,s,0,250,function(e){l()},function(){l(),n()}):(e.render(),n())}else n()};const l=function(){var t,n;return function(){r.b._isNumber(t)||(r.b._isNumber(n)||(n=0),t=setTimeout(function(){var r=(new Date).getTime();e.render();var i=(new Date).getTime();n=Math.max(i-r,200),t=null},1.5*n))}}();return s.prototype.unCull=function(t,n,i){if(r.b._isArray(t,!0),n=r.b._isArray(n)?n:[],i=r.b._isFunction(i)?i:a,o){const a=[];a.length=Math.max(a.length,t.length);var s,c=0;for(s=0;s<t.length;s++){const i=t[s];if(!t.includes(n)){const t=e.getObjectByPsId(i);r.b._isObject(t,!0);const n=t.cullingLayer;t.cullingLayer=m.e.visibleAndLoaded,n===m.e.unloaded&&(a[c++]={obj:t,newLayer:m.e.visibleAndLoaded,psId:i})}}c>0?_loadObjectsInBatches(a,c,0,250,function(e){l()},function(){l(),i()}):i()}else i()},s.prototype.setEnabled=function(e){r.b._isBoolean(e,!0),o=e},s.prototype.isEnabled=function(){return o},new s(e)};Na.prototype={constructor:Na,_name:"CullingSceneApplicator"};/* harmony default export */var Ua=Na;
// CONCATENATED MODULE: ./staging/Cullables.js
let Fa=0;const za=function(e){const t="cullingLayerCache_"+ ++Fa;let n=[];const i=function(){};return(i.prototype={constructor:za}).setLayer=function(n,i){r.b._isString(n,!0);const a=e.getObjectByPsId(n);r.b._isObject(a,!0),a[t]=i},i.prototype.getLayer=function(n){r.b._isString(n,!0);const i=e.getObjectByPsId(n);r.b._isObject(i,!0);const a=i[t];return r.b._isNumber(a)?a:i.cullingLayer},i.prototype.clear=function(){n.length=0},i.prototype.isClear=function(){return 0===n.length},i.prototype.set=function(e){r.b._isArray(e,!0),n=e.slice(0)},i.prototype.add=function(e){r.b._isArray(e,!0),e.forEach(e=>{r.b._isString(e,!0),n.includes(e)||n.push(e)})},i.prototype.remove=function(e){r.b._isArray(e,!0),e.forEach(e=>{r.b._isString(e,!0);let t=n.indexOf(e);t>-1&&n.splice(t,1)})},i.prototype.contains=function(e){return r.b._isString(e),n.includes(e)},i.prototype.getList=function(){return n},i.prototype.unCull=function(e,t,i){r.b._isArray(e,!0),t=r.b._isArray(t)?t:[],n.forEach(n=>{e.includes(t)||this.setLayer(n,m.e.visibleAndLoaded)})},i.prototype.populate=function(e){r.b._isObject(e,!0),n.length=0;const t=function(e){r.b._isObject(e,!0);const i=function(e){return"Assembly"===e.type||"Container"===e.type};i(e)||i(e.original)?e.children&&e.children.forEach(e=>{t(e)}):n.push(e.userData.psId)};t(e)},new i(e)};za.prototype={constructor:za,_name:"Cullables"};/* harmony default export */var ka=za;
// CONCATENATED MODULE: ./staging/Culling.js
const ja=o()("PLMVisWeb:debug:Culling"),Ha=(o()("PLMVisWeb:error:Culling"),o()("PLMVisWeb:warning:Culling")),Wa=function(e){const t=function(e){if(!e)throw new Error("Assertion failure")};var n=5e3,a=3*n;const o=function(){};var s,l,c,u,h=!1,d=!1,p=!1,f=!1,g=[],v=[],y=.03,b=.005,x=!1,_=!1,w=.05,M=!1;const E=[],S=function(e){try{r.b._isObject(e,!0),l=e,e.registerModuleEvent(this),(s=new Da.a).addEventListener("message",_msgResponseHandler),s.postMessage({type:m.f.init}),c=new ka({getObjectByPsId:e.getObjectByPsId,getRootNode:e.getRootNode}),u=new Ua({unloadObj:e.unloadObj,loadShapes:e.loadShapes,getObjectByPsId:e.getObjectByPsId,render:function(){l.isRenderLoopActive()||(x=!0,l.render(),l.render(),x=!1)}})}catch(e){Ha(i.b.stringsByLabel.CULLING_LOGGER_warn_initialize+e)}};function _setWorkerDirty(e,n){if(r.b._isBoolean(e,!0),r.b._isBoolean(n,!0),c.getList().length>0){const i=l.isRenderLoopActive();if(e||r.b._isObject(l.getCamera())&&h&&!p&&(i&&!f||!i)){t(y>b);const e=l.getHeight(),r=y*e,i=b*e,a=w*e;M=!0,s.postMessage({type:m.f.setDirty,boundarySize1Px:!n&&_?a:r,boundarySize2Px:i,numObjs:c.getList().length,screenHeightPx:e,allowUnloading:d})}}}function _msgResponseHandler(e){r.b._isObject(e,!0);const t=e.data;switch(t.type){case m.f.dataRequest:L(t.startIndex,t.numDirtyObjsRemaining,function(e,t,n,r){s.postMessage({type:m.f.dataResponse,cameraPosition:e,cameraFov:t,data:n,dataUsedLength:r,allowUnloading:d})});break;case m.f.assignLayers:_assignLayers(t.newLayers);break;case m.f.doneDirtyObjects:_doneDirtyObjects()}}function _assignLayers(e){r.b._isArray(e,!0),h&&!p&&u.assignLayers(e),e.forEach(e=>{if(h&&!p){const t=c.getLayer(e.psid);c.setLayer(e.psid,e.newLayer),function _fireLayerChangeEvents(e,t,n){r.b._isString(e,!0),r.b._isNumber(n,!0),v.forEach(r=>{r(e,t,n)})}(e.psid,t,e.newLayer)}}),function _fireLayerChangeBatchEvents(e){r.b._isObject(e,!0),Object.freeze(e),g.forEach(t=>{t(e)})}(e)}function _doneDirtyObjects(){M=!1;const e=E.slice();E.length=0,e.forEach(e=>{r.b._isFunction(e,!0),e()})}S.prototype={constructor:S};const L=function(){const e=[];return function(i,s,u){r.b._isNumber(i,!0),t(i>=0),u=r.b._isFunction(u)?u:o;var h=l.isRenderLoopActive(),d=Math.min(c.getList().length,h?n:a);d=Math.min(d,s),e.length=Math.max(e.length,d);const p=i+d;var f=0;const m=c.getList();for(var g=i;g<p;g++){const t=m[g%m.length],n=l.getObjectByPsId(t);r.b._isObject(n,!0);const i={x:n.boundingSphere.center.x,y:n.boundingSphere.center.y,z:n.boundingSphere.center.z,radius:n.boundingSphere.radius};e[f++]={psid:t,boundingSphere:i,worldMatrix:n.matrixWorld.elements,currentLayer:c.getLayer(t)}}const v=l.getCamera().position;u([v.x,v.y,v.z],l.getCamera().fov,e,f)}}(),T=function(e,t){if(r.b._isBoolean(e,!0),r.b._isFunction(t,!0),e)_setWorkerDirty(!1,!1),this.waitUtilNotBusy(t);else{const e=c.getList();c.unCull(c.getList(),null),u.unCull(e,null,t)}};S.prototype.clear=function(e){c.clear()},S.prototype._isClear=function(){try{return 0===c.getList().length}catch(e){Ha(i.b.stringsByLabel.CULLING_LOGGER_warn_clear+e)}},S.prototype.preRender=function(){var e=null;return function(){try{x||(f||_setWorkerDirty(!1,!l.isRenderLoopActive()),(f||_)&&l.isRenderLoopActive()&&(r.b._isNumber(e)&&clearTimeout(e),e=setTimeout(function(){_setWorkerDirty(!1,!0),e=null},200)))}catch(e){Ha(i.b.stringsByLabel.CULLING_LOGGER_warn_render+e)}}}(),S.prototype.waitUtilNotBusy=function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_waitUtilNotBusy),r.b._isFunction(e,!0),M?E.push(e):e()},S.prototype.getCullingLayer=function(e){return r.b._isString(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_getCullingLayer),r.b._isString(e,!0),c.getLayer(e)},S.prototype.setCullableObjects=function(e,n){r.b._optionalArgCheck(e,r.b._isArray,r.b._isString),r.b._optionalArgCheck(n,r.b._isFunction),ja(i.b.stringsByLabel.CULLING_LOGGER_setCullableObjects);try{t(r.b._isArray(e)||r.b._isNullOrUndefined(e)),n=r.b._isFunction(n)?n:o;const a=c.getList();c.unCull(a,null),u.unCull(a,null,function(){r.b._isArray(e)?c.set(e):c.populate(l.getRootNode());const t=new Va(L,_assignLayers,_doneDirtyObjects),i=l.getHeight();t.setDirty(y*i,b*i,c.getList().length,i,d),n()})}catch(e){Ha(i.b.stringsByLabel.CULLING_LOGGER_warn_setCullableObjects+e)}},S.prototype.getCullableObjects=function(){ja(i.b.stringsByLabel.CULLING_LOGGER_getCullableObjects);const e=[];return c.getList().forEach(t=>{e.push({psId:t,layer:this.getCullingLayerByPsId(t)})}),e},S.prototype.addCullableObjects=function(e){r.b._isArray(e,!0,r.b._isString),ja(i.b.stringsByLabel.CULLING_LOGGER_addCullableObjects),r.b._isArray(e,!0),c.add(e)},S.prototype.removeCullableObjects=function(e,t){r.b._isArray(e,!0,r.b._isString),r.b._optionalArgCheck(t,r.b._isFunction),ja(i.b.stringsByLabel.CULLING_LOGGER_removeCullableObjects),t=r.b._isFunction(t)?t:o,c.remove(e),c.unCull(e,null),u.unCull(e,null,t)},S.prototype.isCullableObject=function(e){return r.b._isString(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_isCullableObject),c.contains(e)},S.prototype.registerLayerChangeBatchEvent=function(e){r.b._isFunction(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_registerLayerChangeBatchEvent),r.b._isFunction(e)&&-1===r.b._eventMapIndex(g,e)&&g.push(e)},S.prototype.unregisterLayerChangeBatchEvent=function(e){r.b._isFunction(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_unregisterLayerChangeBatchEvent);const t=r.b._eventMapIndex(g,e);-1!==t&&g.splice(t,1)},S.prototype.useDefaultActions=function(e,t){r.b._isBoolean(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),ja(i.b.stringsByLabel.CULLING_LOGGER_useDefaultActions),r.b._isBoolean(e,!0),t=r.b._isFunction(t)?t:o,u.setEnabled(e),T.call(this,e,t)},S.prototype.isUsingDefaultActions=function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_isUsingDefaultActions),u.isEnabled()},S.prototype.setUseLoadingUnloading=function(e,t){r.b._isBoolean(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),ja(i.b.stringsByLabel.CULLING_LOGGER_setUseLoadingUnloading),t=r.b._isFunction(t)?t:o,d=e,T.call(this,e,t)},S.prototype.isUsingLoadingUnloading=function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_isUsingLoadingUnloading),d},S.prototype.setActive=function(e,t){r.b._isBoolean(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),ja(i.b.stringsByLabel.CULLING_LOGGER_setActive),t=r.b._isFunction(t)?t:o,h=e,e&&0===c.getList().length&&this.setCullableObjects(),T.call(this,e,t)},S.prototype.isActive=function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_isActive),h},S.prototype.getBatchSizes=function(){return{fetchCountWhileRotating:n,fetchCountWhileIdle:a}},S.prototype._setSuspended=function(e){r.b._isBoolean(e,!0),p=e},S.prototype._isSuspended=function(){return p},S.prototype.processCullableObjectByPsId=function(e){},S.prototype.processCullableObjects=function(){},S.prototype.updateObjects=o,S.prototype.initialize=o,S.prototype.setBatchFrames=o,S.prototype.getBatchFrames=function(){return 1},S.prototype.setBatchSize=o,S.prototype.getBatchSize=function(){return 1},S.prototype.setBoundarySizes=function(e,n){r.b._isNumber(e,!0),r.b._isNumber(n,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_setBoundarySizes),t(r.b._isNumber(e)&&e>=0),t(r.b._isNumber(n)&&n>=0),t(e>n),this.setBoundary1Size(e),this.setBoundary2Size(n)},S.prototype.setBoundary1Size=function(e){r.b._isNumber(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_setBoundary1Size),t(r.b._isNumber(e)&&e>=0),y=e/l.getHeight()},S.prototype.getBoundary1Size=function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getBoundary1Size),y*l.getHeight()},S.prototype.setBoundary2Size=function(e){r.b._isNumber(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_setBoundary2Size),t(r.b._isNumber(e)&&e>=0),b=e/l.getHeight()},S.prototype.getBoundary2Size=function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getBoundary2Size),b*l.getHeight()},S.prototype.addCullableObjectByPsId=function(e){r.b._isString(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_addCullableObjectByPsId),this.addCullableObjects([e])},S.prototype.removeCullableObjectByPsId=function(e,t){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),ja(i.b.stringsByLabel.CULLING_LOGGER_removeCullableObjectByPsId),t=r.b._isFunction(t)?t:o;const n=[e];c.unCull(n,null),c.remove(n),u.unCull(n,null,t)},S.prototype.registerLayerChangeEvent=function(e){r.b._isFunction(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_registerLayerChangeEvent),r.b._isFunction(e)&&-1===r.b._eventMapIndex(v,e)&&v.push(e)},S.prototype.unregisterLayerChangeEvent=function(e){r.b._isFunction(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_unregisterLayerChangeEvent);const t=r.b._eventMapIndex(v,e);-1!==t&&v.splice(t,1)},S.prototype.setSuspendOnMovement=function(e){r.b._isBoolean(e,!0),ja(i.b.stringsByLabel.CULLING_LOGGER_setSuspendOnMovement),this.suspendOnMovement=e},S.prototype.getSuspendOnMovement=function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getSuspendOnMovement),this.suspendOnMovement},S.prototype.getCullingLayerByPsId=function(e){return r.b._isString(e,!0),this.getCullingLayer(e)},Object.defineProperties(S.prototype,{boundary1:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setLayerBoundaries),r.b._isNumber(e,!0),t(e>=0&&e<=100),y=e/100},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getLayerBoundaries),100*y}}}),Object.defineProperties(S.prototype,{boundary2:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setLayerBoundaries),r.b._isNumber(e,!0),t(e>=0&&e<=100),b=e/100},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getLayerBoundaries),100*b}}}),Object.defineProperties(S.prototype,{boundaryMovingFrame:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setLayerBoundaries),r.b._isNumber(e,!0),t(e>=0&&e<=100),w=e/100},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getLayerBoundaries),100*w}}}),Object.defineProperties(S.prototype,{useMovingFrameCulling:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setUseMovingFrameCulling),r.b._isBoolean(e,!0),_=e},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getUseMovingFrameCulling),_}}}),Object.defineProperties(S.prototype,{fetchCountWhileRotating:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setFetchCountWhileRotating),r.b._isNumber(e,!0),n=e},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getFetchCountWhileRotating),n}}}),Object.defineProperties(S.prototype,{fetchCountWhileIdle:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setFetchCountWhileIdle),r.b._isNumber(e,!0),a=e},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getFetchCountWhileIdle),a}}}),Object.defineProperties(S.prototype,{suspendOnMovement:{set:function(e){ja(i.b.stringsByLabel.CULLING_LOGGER_setSuspendOnMovement),r.b._isBoolean(e,!0),f=e},get:function(){return ja(i.b.stringsByLabel.CULLING_LOGGER_getSuspendOnMovement),f}}});const A=r.b._isObject(e._parent)?e._parent:e;return r.b._isObject(A,!0),new S({isRenderLoopActive:function(){return A[Vp._renderLoopActive]()},getObjectByPsId:function(e){return r.b._isString(e,!0),A._modelObject.getObjectByPsId(e)},getCamera:function(){return A._pCamera},unloadObj:function(e){r.b._isObject(e,!0),A._scene.unloadObject(e)},render:function(){A[Vp._render]()},loadShapes:function(e){r.b._isObject(e,!0),A._loader.loadShapes(e)},getHeight:function(){return A._renderer.domElement.height},getRootNode:function(){return A._modelObject},registerModuleEvent:function(e){A[Vp._registerModuleEvent](e)}})};Wa.prototype={constructor:Wa,_name:"Culling"};/* harmony default export */var Xa=Wa,qa=o()("PLMVisWeb:debug:Culling"),Ya=o()("PLMVisWeb:warning:CullingLegacy"),Za=function(e){var t=null,n=[],a=[],o=[],s=!1,l=!1,c=!1,u=!0,h=!1,d=100,p=10,f=100,m=1,g=0,v=null,y=!1,b={psIds:[],oldLayers:[],newLayers:[]};function _fireLayerChangeEvents(e,t,r){for(var i=0,a=n.length;i<a;++i)n[i](e,t,r)}function _clearCullingObjects(){for(var e=0,t=o.length;e<t;++e)o[e].cullingLayer=0;a.length=0,o.length=0}function _defaultLayer1Action(e,n){switch(e.cullingLayer=1,n){case 0:case 2:e.cullingLayer=1;break;case 3:if(e.cullingLayer=1,h){t._loader.loadShapes({object:e,doneCallback:function(){if(e.visible&&e.shapes)for(var t=0,n=e.shapes.length;t<n;t++){var r=e.shapes[t];r instanceof ze.EdgeShape||r instanceof ze.OutlineShape?value?r.visible=e._areEdgesVisible:r.visible=!1:r.visible=!0}}})}}}function _defaultLayer2Action(e,n){switch(n){case 0:case 1:e.cullingLayer=2;break;case 3:if(e.cullingLayer=2,h){t._loader.loadShapes({object:e,doneCallback:function(){if(e.visible&&e.shapes)for(var t=0,n=e.shapes.length;t<n;t++){var r=e.shapes[t];r instanceof ze.EdgeShape||r instanceof ze.OutlineShape?value?r.visible=e._areEdgesVisible:r.visible=!1:r.visible=!0}}})}}}function _defaultLayer3Action(e){e.cullingLayer=3,h&&t._scene.unloadObject(e)}function _indexOfCachePsId(e){for(var t=0,n=a.length;t<n;++t)if(a[t].psId===e)return t;return-1}function _addUpdateCache(e){r.b._calculateDistanceForCulling(e,d,p,t._renderer,t.getCameraInfo().perspective.fov);var n=new _.Vector3;e.boundingBox.getCenter(n),n.applyMatrix4(e.matrixWorld);var i=_indexOfCachePsId(e.userData.psId);-1===i?(a.push({psId:e.userData.psId,cullingLayer:e.cullingLayer||0,boundary1:e.userData.layerBoundary1,boundary2:e.userData.layerBoundary2,position:[n.x,n.y,n.z]}),o.push(e)):-1===e.cullingLayer?(e.cullingLayer=0,a.splice(i,1),o.splice(i,1)):(a[i].cullingLayer=e.cullingLayer,a[i].boundary1=e.userData.layerBoundary1,a[i].boundary2=e.userData.layerBoundary2,a[i].position[0]=n.x,a[i].position[1]=n.y,a[i].position[2]=n.z)}function _processCullableObject(e){var n=o[e],r=a[e],i=new _.Vector3,s=new _.Vector3;n.boundingBox.getCenter(s),i.copy(s),i.applyMatrix4(n.matrixWorld);var l=t._currentCamera.position.distanceTo(i),c=0;if(c=l>=r.boundary2?3:l>=r.boundary1?2:1,u)switch(c){case 1:_defaultLayer1Action(n,r.cullingLayer);break;case 2:_defaultLayer2Action(n,r.cullingLayer);break;case 3:_defaultLayer3Action(n)}else _fireLayerChangeEvents(psId,r.cullingLayer,c);_addUpdateCache(n)}function _processCullingWorkerMessage(e){if(s){if(e.data.done)y=!1;else for(var n=e.data.changes,r=-1,i=(r=-1,0),a=n.length;i<a;++i)(r=b.psIds.indexOf(n[i].psId))>-1?(b.oldLayers[r]=n[i].oldLayer,b.newLayers[r]=n[i].newLayer):(b.psIds.push(n[i].psId),b.oldLayers.push(n[i].oldLayer),b.newLayers.push(n[i].newLayer));0===b.psIds.length||t[Vp._renderLoopActive]()||t[Vp._render]()}}var x=function(e){t=e._parent};return(x.prototype={constructor:x}).initialize=function(){if(qa(i.b.stringsByLabel.CULLING_LOGGER_initialize),null!==v||!window.Worker)return Ya(i.b.stringsByLabel.CULLING_LOGGER_warn2_initialize),!1;var e=new Blob(["self.addEventListener('message', function (messageEvent) {\r\n    if (!messageEvent.data.init) {\r\n        var dataList = messageEvent.data.dataList,\r\n            cameraPosition = messageEvent.data.cameraPosition,\r\n            objPosition = null,\r\n            thisObj = null;\r\n        var changes = [];\r\n\r\n        for (var idx = 0, len = dataList.length; idx < len; ++idx) {\r\n            thisObj = dataList[idx];\r\n\r\n            objPosition = thisObj.position;\r\n\r\n            var dx = objPosition[0] - cameraPosition[0];\r\n            var dy = objPosition[1] - cameraPosition[1];\r\n            var dz = objPosition[2] - cameraPosition[2];\r\n\r\n            var dist = Math.sqrt( dx * dx + dy * dy + dz * dz),\r\n                oldLayer = thisObj.cullingLayer || 0,\r\n                newLayer = 0;\r\n\r\n            if (dist >= thisObj.boundary2) {\r\n                newLayer = 3;\r\n            }\r\n            else if (dist >= thisObj.boundary1) {\r\n                newLayer = 2;\r\n            }\r\n            else {\r\n                newLayer = 1;\r\n            }\r\n\r\n            if (oldLayer !== newLayer) {\r\n                changes.push({ psId: thisObj.psId, oldLayer: oldLayer, newLayer: newLayer });\r\n            }\r\n        }\r\n\r\n        if (changes.length > 0) {\r\n            self.postMessage({ changes: changes });\r\n        }\r\n\r\n        self.postMessage({ done: true });\r\n    }\r\n});"],{type:"application/javascript"});try{(v=new Worker(URL.createObjectURL(e))).addEventListener("message",_processCullingWorkerMessage),v.postMessage({init:!0})}catch(e){return Ya(i.b.stringsByLabel.CULLING_LOGGER_warn_initialize+e),!1}return!0},x.prototype.unregisterLayerChangeEvent=function(e){r.b._isFunction(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_unregisterLayerChangeEvent);var t=r.b._eventMapIndex(n,e);-1!==t&&n.splice(t,1)},x.prototype.registerLayerChangeEvent=function(e){r.b._isFunction(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_registerLayerChangeEvent),r.b._isFunction(e)&&-1===r.b._eventMapIndex(n,e)&&n.push(e)},x.prototype.getCullingLayerByPsId=function(e){r.b._isString(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_getCullingLayerByPsId);var t=_indexOfCachePsId(e);if(t>-1)return a[t].cullingLayer;Ya(i.b.stringsByLabel.CULLING_LOGGER_warn_getCullingLayerByPsId)},x.prototype.setCullableObjects=function(e){if(r.b._optionalArgCheck(e,r.b._isArray,r.b._isString),qa(i.b.stringsByLabel.VIEWER_LOGGER_setEdgesVisibilityByPsId),_clearCullingObjects(),e)for(var n=null,a=0,o=e.length;a<o;++a)(n=t._modelObject.getObjectByPsId(e[a]))&&_addUpdateCache(n);else!function _getParts(e){if(e instanceof ze.Assembly||e instanceof ze.Container||e.original&&(e.original instanceof ze.Assembly||e.original instanceof ze.Container)){if(e.children)for(var t=0,n=e.children.length;t<n;++t)_getParts(e.children[t])}else _addUpdateCache(e)}(t._modelObject)},x.prototype._clear=function(){_clearCullingObjects()},x.prototype._isClear=function(){return 0===o.length},x.prototype._preRender=function(){if(v){if(s&&a.length>0&&a.length===o.length&&!y&&!c){y=!0;var e=[];t._currentCamera.position.toArray(e),v.postMessage({dataList:a,cameraPosition:e})}0===g&&b.psIds.length>0&&!c&&function _processCullableObjectsQueue(){for(var e=-1,t=-1,n=-1,r=-1,i=0,s=f;i<s&&void 0!==e;++i)if(e=b.psIds.shift(),t=b.oldLayers.shift(),n=b.newLayers.shift(),-1!==(r=_indexOfCachePsId(e))&&t!==n){var l=o[r];if(l){if(u)switch(n){case 1:_defaultLayer1Action(l,t);break;case 2:_defaultLayer2Action(l,t);break;case 3:_defaultLayer3Action(l)}else _fireLayerChangeEvents(e,t,n);l.cullingLayer=n,a[r].cullingLayer=n}}}(),++g===m&&(g=0)}else for(var n=0,r=o.length;n<r;n++)_processCullableObject(n)},x.prototype.setBatchFrames=function(e){r.b._isNumber(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setBatchFrames),e>0&&(m=e)},x.prototype.getBatchFrames=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_getBatchFrames),m},x.prototype.setBatchSize=function(e){r.b._isNumber(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setBatchSize),e>0&&(f=e)},x.prototype.getBatchSize=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_getBatchSize),f},x.prototype.setBoundary1Size=function(e){r.b._isNumber(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setBoundary1Size),e>0&&(d=e)},x.prototype.getBoundary1Size=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_getBoundary1Size),d},x.prototype.setBoundary2Size=function(e){r.b._isNumber(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setBoundary2Size),e>0&&(p=e)},x.prototype.getBoundary2Size=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_getBoundary2Size),p},x.prototype.setBoundarySizes=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setBoundarySizes),this.setBoundary1Size(e),this.setBoundary2Size(t)},x.prototype.useDefaultActions=function(e){r.b._isBoolean(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_useDefaultActions),u=e},x.prototype.isUsingDefaultActions=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_isUsingDefaultActions),u},x.prototype.setUseLoadingUnloading=function(e){r.b._isBoolean(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setUseLoadingUnloading),h=e},x.prototype.isUsingLoadingUnloading=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_isUsingLoadingUnloading),h},x.prototype.setActive=function(e){r.b._isBoolean(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setActive),s=e},x.prototype.isActive=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_isActive),s},x.prototype.setSuspendOnMovement=function(e){r.b._isBoolean(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_setSuspendOnMovement),l=e},x.prototype.getSuspendOnMovement=function(){return qa(i.b.stringsByLabel.CULLING_LOGGER_getSuspendOnMovement),l},x.prototype._setSuspended=function(e){c=e},x.prototype._isSuspended=function(){return c},x.prototype.processCullableObjectByPsId=function(e){var t=_indexOfCachePsId(e);-1!==t&&_processCullableObject(t)},x.prototype.processCullableObjects=function(){for(var e=0,t=o.length;e<t;e++)_processCullableObject(e)},x.prototype.updateObjects=function(){qa(i.b.stringsByLabel.CULLING_LOGGER_updateObjects);for(var e=null,n=0,r=a.length;n<r;++n)(e=t._modelObject.getObjectByPsId(a[n].psId))&&_addUpdateCache(e)},x.prototype._updateObject=function(e){if(e instanceof ze.Assembly||e instanceof ze.Container)for(var t=0,n=e.children.length;t<n;++t)this.updateObject(e.children[t]);else _indexOfCachePsId(e.userData.psId)>0&&_addUpdateCache(e)},x.prototype.addCullableObjectByPsId=function(e){r.b._isString(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_addCullableObjectByPsId);var n=t._modelObject.getObjectByPsId(e);n&&_addUpdateCache(n)},x.prototype.removeCullableObjectByPsId=function(e){r.b._isString(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_removeCullableObjectByPsId);var t=_indexOfCachePsId(e);-1!==t&&(a.splice(t,1),o.splice(t,1))},x.prototype.isCullableObject=function(e){return r.b._isString(e,!0),qa(i.b.stringsByLabel.CULLING_LOGGER_isCullableObject),-1!==_indexOfCachePsId(e)},new x(e)};
// CONCATENATED MODULE: ./staging/CullingLegacy.js
Za.prototype={constructor:Za,_name:"CullingLegacy"};/* harmony default export */var Ja=Za,Qa=o()("PLMVisWeb:warning:XTBodLoader"),Ka=function(e,t){var n=function(e,t){this.showStatus=e,this.workerPool=t};return(n.prototype={constructor:n}).loadDescriptions=function(e,t){for(var n={},r=0,i=0,a=e.length;i<a;i++){var o=e[i],s="Body"===o.type?o.parent:o,l={part:s,shapes:{}};n[s.userData.psId]=l;var c=[];for(var u in o.faces)if(o.faces[u]){var h=o.faces[u];h.descriptionLoaded||(c.push(u),l.shapes[u]=h)}for(var d in o.edges)if(o.edges.hasOwnProperty(d)){var p=o.edges[d];p.descriptionLoaded||(c.push(d),l.shapes[d]=p)}c.length>0&&(r++,this.load(s,new Float32Array(c),!1,function(e){var i=n[e.callbackId],a=e.xtDescriptions[i.part.psId];if(a)for(var o in i.shapes)if(i.shapes[o]){var s=i.shapes[o],l=a[o];null!==l&&void 0!==l&&s.setDescription(l),s.descriptionLoaded=!0}0===--r&&t()}))}0===r&&t()},n.prototype.loadEdges=function(e,t,n){this.load(e,t,!0,function(e){n(e.nonManifoldEdges)})},n.prototype.load=function(e,t,n,r){this.loader?this.loader.loadXTShapes({part:e,xtIds:t,parseFacetData:n,doneCallback:r}):r&&r()},n.prototype.loadFromBinary=function(e,t,n,r){if(void 0!==b64data){this.url=_getAbsolutePath(url);var a=[];a.push(t.buffer),this.workerPool.postMessage({psId:e.psId,cmd:"XTBodWorker",base64Data:b64data,xtIds:t,parseXTFacetData:n},a,r)}else Qa(i.b.stringsByLabel.XTBODLOADER_CONSOLE_warn_loadFromBinary),r(null)},new n(e,t)};
// CONCATENATED MODULE: ./staging/XTBodLoader.js
Ka.prototype={constructor:Ka,_name:"XTBODLoader"};/* harmony default export */var $a=Ka,eo=new Float32Array(1),to=new Uint32Array(eo.buffer),no=function(e,t){return eo[0]=t,t=to[0],r.b._combineHash(e,t)},ro=function(e,t,n){if(e===t)return!0;var i=e.x,a=e.y,o=e.z,s=t.x,l=t.y,c=t.z;return r.b._vertexEqual(i,a,o,s,l,c,n)},io=new function(){this.hash=function(e){var t=Math.min(e.f1,e.f2);return(t<<5)+t^Math.max(e.f1,e.f2)}},ao=new function(){this.equals=function(e,t){return e.f1===t.f1&&e.f2===t.f2||e.f1===t.f2&&e.f2===t.f1}},oo=new function(){this.hash=function(e){return function(e,t){e=no(e,t.x),e=no(e,t.y),e=no(e,t.z)}(0,e),0}},so=function(e,t){this.showStatus=e,this.workerPool=t,this.xtBodLoader=new $a(e,t)},lo=function(e){var t=e.manifoldEdgeMap;if(!e.faceEdgeMap&&e.manifoldEdgeMapSize>0){var n=new ke.b(e.manifoldEdgeMapSize,io,ao);for(var r in t){var i=t[r];null!==i&&void 0!==i&&n.put(i,r)}e.faceEdgeMap=n}return e.faceEdgeMap};
// CONCATENATED MODULE: ./staging/EdgeLoader.js
so.prototype.setLoader=function(e){this.xtBodLoader.loader=e},so.prototype.load=function(e,t,n,i){if(e.shapes&&0!==e.shapes.length){var a=r.b._getPartTolerance(e),o=[],s={},l=0;if(!(null===t||void 0===t||0===t.length))for(var c=0,u=t.length;c<u;c++){var h=t[c];e.edges&&e.edges[h]||(s[t[c]]=null,l++)}for(var d=[],p=(c=0,e.shapes.length);c<p;c++){var f=e.shapes[c];if("PartShape"===f.type){var m=f.geometry;if(m.xtBodies&&m.xtBodies.length>0){var g={};i||d.push(g),g.positions=m.getAttribute("position").array,g.normals=m.getAttribute("normal").array,g.indices=m.getIndex().array,g.xtBodies=m.xtBodies;for(var v=0,y=m.xtBodies.length;v<y;v++){var b=m.xtBodies[v],x=lo(b);if(x){var w=x.values;for(var M in w)if(w.hasOwnProperty(M)){if(null===(h=w[M])||void 0===h)continue;if(i){if(h in s)d.indexOf(g)<0&&d.push(g)}else void 0===s[h]&&(s[h]=null,l++)}}if(b.nonManifoldEdgeMapSize>0)for(var h in b.nonManifoldEdgeMap)b.nonManifoldEdgeMap.hasOwnProperty(h)&&(o.push(h),s[h]&&(delete s[h],l--))}}}}if(0!==d.length){var E=null,S=0,L=function(e){if(null==E)E=e;else for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];E[t]=r}if(0===--S){var i=[],o=new ke.b(1024,oo,new function(e){this.equals=function(t,n){return ro(t,n,e)}}(a)),s={},l=0;for(var c in E)if(E.hasOwnProperty(c)){var u=E[c];if(s[c]=[],u&&u.positions&&u.positions.length>0){if(u.isManifold){if(u.vertices&&u.vertices.length>0)for(var h=0,d=u.vertices.length;h<d;h+=3){var p={x:u.vertices[h],y:u.vertices[h+1],z:u.vertices[h+2]};void 0===o.get(p)?(o.put(p,l),i.push(p.x),i.push(p.y),i.push(p.z),s[c].push(l++)):s[c].push(o.get(p))}}else{var f=u.positions.length-1,m={x:u.positions[0],y:u.positions[1],z:u.positions[2]},g={x:u.positions[f-2],y:u.positions[f-1],z:u.positions[f]};ro(m,g)||(void 0===o.get(m)?(o.put(m,l),i.push(m.x),i.push(m.y),i.push(m.z),s[c].push(l++)):s[c].push(o.get(m)),void 0===o.get(g)?(o.put(g,l),i.push(g.x),i.push(g.y),i.push(g.z),s[c].push(l++)):s[c].push(o.get(g)))}var v=new ze.InstancedLineBufferGeometry;v.addGroup(0,u.positions.length,2),v.addAttribute("position",new _.BufferAttribute(u.positions,3)),u.normals&&u.normals.length>0&&v.addAttribute("normal",new _.BufferAttribute(u.normals,3)),E[c]=v}else delete E[c]}e={edges:E};i.length>0&&(e.vertices=new Float32Array(i),e.edgeVertexMap=s),n(e)}};l>0&&(this.workerPool.postMessage({cmd:"EdgeWorker",xtBodies:d,tolerance:a,manifoldEdges:s},null,L),S++),o.length>0&&(t=new Int32Array(o),this.xtBodLoader.loadEdges(e,t,L),S++),0===S&&this.workerPool.defer(function(){n(null)})}else n(null)}};/* harmony default export */var co=so,uo=(o()("PLMVisWeb:debug:AsyncObjectLoader"),o()("PLMVisWeb:error:AsyncObjectLoader"));
// CONCATENATED MODULE: ./staging/AsyncObjectLoader.js
uo.enabled=!0;var ho=o()("PLMVisWeb:warning:AsyncObjectLoader"),po=function(e){var t=null,n=null,i=null,a=null,o=null,s=function(e){Ra.call(this),n=new wa,t=new Oa(null,null,n),(a=new $a(!1,e.workerPool)).loader=this,(o=new co(!1,e.workerPool)).setLoader(this)};function _loadObject(e,n,a,o){if(n instanceof ze.Container||n.isAssembly||r.b._notNullOrUndefined(n.children)&&n.children.length>0){var s=n.children.length,l=0;0===s&&a();for(var c=function(e){for(var t=0,r=0,i=n.children.length;r<i;++r){var a=n.children[r].percentLoaded;t+=n.children[r].isLoaded||void 0===a?1:a}n.percentLoaded=t/s,o(e,n.percentLoaded)},u=function(e){++l===s&&(n.percentLoaded=1,o(e),a())},h=0;h<s;++h)!n.sectionGeometry&&n.children[h].sectionGeometry?u():_loadObject(e,n.children[h],u,c)}if("Part"===n.type&&(r.b._notNullOrUndefined(n.b64data)||r.b._notNullOrUndefined(n.objectFileRef))||"Body"===n.type||"PmiObject"===n.type)if(n.isLoaded||3===n.cullingLayer&&i.isUsingLoadingUnloading()||r.b._isNullOrUndefined(n.b64data)&&r.b._isNullOrUndefined(n.objectFileRef))a();else if(n.isLoading)n.doneLoadingCallbacks.push(a);else{n.isLoading=!0,n.doneLoadingCallbacks=[],n.doneLoadingCallbacks.push(a);var d=function(e){return function(){if(r.b._notNullOrUndefined(e.isLoaded)&&r.b._notNullOrUndefined(e.isLoading)&&(e.isLoaded=!0,e.isLoading=!1,r.b._notNullOrUndefined(e.doneLoadingCallbacks))){for(var t=e.doneLoadingCallbacks.length-1;t>=0;--t)e.doneLoadingCallbacks[t](e);delete e.doneLoadingCallbacks}}}(n);!function _loadGeometry(e,n,i){var a=function(t,r){n&&t&&e.addShapes(n,t,r),i()},o=n instanceof xt;if(n.b64data)t.loadFromBinary(n.b64data,a,null,null,n.userData.psId.split(":")[0],o,n.psId,"geometry");else{var s=n.baseRef||n.userData.modelPath,l=r.b._joinUrls(s,n.objectFileRef?n.objectFileRef:n.userData.objectFileRef);l=r.b._getAbsolutePath(l),t.loadFromFile(l,a,null,null,n.userData.psId.split(":")[0],o,null,n.psId,"geometry")}}(e,n,d)}}(s.prototype={constructor:s}).loadShapes=function(e){null===i&&Ja&&this.viewer.isExtensionLoaded(Ja)?i=this.viewer.getExtensionManager(Ja):null===i&&Xa&&this.viewer.isExtensionLoaded(Xa)&&(i=this.viewer.getExtensionManager(Xa));var t=e.object,r=e.doneCallback||function(){},a=e.progressCallback||function(){};i&&i.isActive()&&i._isClear()&&(i.setCullableObjects(),i.processCullableObjects());_loadObject(this.viewer,t,function(){n.completed=!0,r()},a)},s.prototype.attachViewer=function(e){t.viewer=e},s.prototype.loadEdges=function(e){var t=e.part,n=e.doneCallback;o.load(t,null,function(e){t.edgesLoading=!1,e&&e.edges&&!t.edgesLoaded&&this.viewer.addEdges(t,e.edges,e.vertices,e.edgeVertexMap),t.edgesLoaded=!0,n()}.bind(this),void 0)},s.prototype.loadDescriptions=function(e){a.loadDescriptions(e.parts,e.doneCallback)};var l=function(e,t,n,i,a){var o=!1;(void 0===n.hasLocalMaterials||void 0!==n.hasLocalMaterials&&!1===n.hasLocalMaterials)&&(o=!0),i||o||n.hasMaterial?e.loadMaterials({hasMaterial:n.hasMaterial,mat64binary:i?r.b._decodeBase64ToBinaryBuffer(i):null,url:o?r.b._getAbsolutePath(t+"/materials.bod"):null,doneCallback:function(e,t){a(n,t)}}):a(n)};return s.prototype.loadProductStructure=function(e){var t=e.doneCallback||function(){},r=e.modelPath,i=this;n.start(r),n.open(function(){n.get(wa.DataTypes.Structure,"",function(e){if(null===e)!function(e,t,r){var i=e.networkManager.createHttpRequest("GET",t+"/plm_ps.json");i.responseType="text",i.onsuccess=function(){if(i.response&&i.response.length>0){var a=JSON.parse(i.response);void 0===a.baseRef&&(a.baseRef=t);var o=a.mat64;a.mat64=null,a.hasMaterial=!1,o&&(a.hasMaterial=!0),n.put(wa.DataTypes.Structure,"",{structure:a},function(){}),l(e,t,a,o,r)}else console.warn("Failed to receive HttpRequest response!"),r(null)}.bind(this),i.onerror=function(){uo("Failed to retrieve "+t),r(null)},i.send(null)}(i,r,t);else{var a=e.structureBlob;l(i,r,a,null,t)}}.bind(this))})},s.prototype.loadPmiStructure=function(e){var t=e.doneCallback||function(){},n=e.modelPath+"/plm_pmi.json",r=this.networkManager.createHttpRequest("GET",n);r.responseType="text",r.onsuccess=function(){if(r.response&&r.response.length>0){var e=JSON.parse(r.response);t(e)}else ho("Failed to receive HttpRequest data!"),t(null)}.bind(this),r.onerror=function(){uo("Failed to retrieve "+n),t(null)},r.send(null)},s.prototype.loadXTShapes=function(e){var t=e.part,n=e.xtIds,i=e.parseFacetData,a=e.doneCallback||function(){},o="Body"===t.type?t.parent:t;if(!o||o.edgesLoaded||o.edgesLoading||!o.objectFileRef&&!o.userData.objectFileRef){a({})}else{var s=o.baseRef||o.userData.modelPath,l=r.b._joinUrls(s,o.objectFileRef?o.objectFileRef:o.userData.objectFileRef),c=l.length-3;l=[l.slice(0,c),"xt",l.slice(c)].join(""),l=r.b._getAbsolutePath(l);var u=[];u.push(n.buffer),this.viewer.postMessage({psId:o.psId,cmd:"XTBodWorker",url:l,xtIds:n,parseXTFacetData:i,callbackId:o.userData.psId},u,a)}},s.prototype.loadMaterials=function(e){var n=function(t,n){e.doneCallback(t,n)};e.mat64binary||e.hasMaterial?t.loadFromBinary(e.mat64binary,n,null,null,null,"","materials"):t.loadFromFile(e.url,n,null,null,null,null,null,"","materials")},new s(e)};po.prototype={constructor:po,_name:"AsyncObjectLoader"};/* harmony default export */var fo=po;
// CONCATENATED MODULE: ./node_modules/three/src/core/EventDispatcher.js
/**
 * https://github.com/mrdoob/eventdispatcher.js/
 */function EventDispatcher_EventDispatcher(){}Object.assign(EventDispatcher_EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});
// CONCATENATED MODULE: ./node_modules/three/src/constants.js
var mo=0,go=1,vo=2,yo=1,bo=2,xo=0,_o=1,wo=2,Mo=0,Eo=0,So=1,Lo=2,To=3,Ao=4,Co=5,Po=100,Io=101,Oo=102,Bo=103,Ro=104,Go=200,Do=201,Vo=202,No=203,Uo=204,Fo=205,zo=206,ko=207,jo=208,Ho=209,Wo=210,Xo=0,qo=1,Yo=2,Zo=3,Jo=4,Qo=5,Ko=6,$o=7,es=0,ts=1,ns=2,rs=0,is=1,as=2,os=3,ss=4,ls=301,cs=302,us=303,hs=304,ds=305,ps=306,fs=307,ms=1e3,gs=1001,vs=1002,ys=1003,bs=1004,xs=1005,_s=1006,ws=1007,Ms=1008,Es=1009,Ss=1010,Ls=1011,Ts=1012,As=1013,Cs=1014,Ps=1015,Is=1016,Os=1017,Bs=1018,Rs=1019,Gs=1020,Ds=1021,Vs=1022,Ns=1023,Us=1024,Fs=1025,zs=1026,ks=1027,js=1028,Hs=33776,Ws=33777,Xs=33778,qs=33779,Ys=35840,Zs=35841,Js=35842,Qs=35843,Ks=36196,$s=37808,el=37809,tl=37810,nl=37811,rl=37812,il=37813,al=37814,ol=37815,sl=37816,ll=37817,cl=37818,ul=37819,hl=37820,dl=37821,pl=0,fl=3e3,ml=3001,gl=3007,vl=3002,yl=3004,bl=3005,xl=3006,_l=3200,wl=3201,Ml=1;
// CONCATENATED MODULE: ./node_modules/three/src/math/Vector2.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author philogb / http://blog.thejit.org/
 * @author egraether / http://egraether.com/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 */
function Vector2(e,t){this.x=e||0,this.y=t||0}
// CONCATENATED MODULE: ./node_modules/three/src/math/Matrix3.js
/**
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://clara.io
 * @author tschw
 */
function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){
// assumes min < max, componentwise
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Vector2,t=new Vector2;return function clampScalar(n,r){return e.set(n,n),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){
// computes the angle in radians with respect to the positive x-axis
var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=a*f+o*v+s*x,i[3]=a*m+o*y+s*_,i[6]=a*g+o*b+s*w,i[1]=l*f+c*v+u*x,i[4]=l*m+c*y+u*_,i[7]=l*g+c*b+u*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*_,i[8]=h*g+d*b+p*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,g=i*p+a*f+o*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return r[0]=p*y,r[1]=(o*h-d*a)*y,r[2]=(c*a-o*l)*y,r[3]=f*y,r[4]=(d*i-o*u)*y,r[5]=(o*s-c*i)*y,r[6]=m*y,r[7]=(a*u-h*i)*y,r[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*c,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*c,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});
// CONCATENATED MODULE: ./node_modules/three/src/extras/ImageUtils.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 */
var El=function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var n=t.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")},Sl=0;
// CONCATENATED MODULE: ./node_modules/three/src/textures/Texture.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 */function Texture(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(this,"id",{value:Sl++}),this.uuid=ir.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:gs,this.wrapT=void 0!==r?r:gs,this.magFilter=void 0!==i?i:_s,this.minFilter=void 0!==a?a:Ms,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Ns,this.type=void 0!==s?s:Es,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)
// Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.
//
// Also changing the encoding after already used by a Material will not automatically make the Material
// update.  You need to explicitly call Material.needsUpdate to trigger it to recompile.
this.encoding=void 0!==c?c:fl,this.version=0,this.onUpdate=null}
// CONCATENATED MODULE: ./node_modules/three/src/textures/DataTexture.js
/**
 * @author alteredq / http://alteredqualia.com/
 */
function DataTexture(e,t,n,r,i,a,o,s,l,c,u,h){Texture.call(this,null,a,o,s,l,c,r,i,u,h),this.image={data:e,width:t,height:n},this.magFilter=void 0!==l?l:ys,this.minFilter=void 0!==c?c:ys,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLAnimation.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLAnimation(){var e=null,t=!1,n=null;function onAnimationFrame(r,i){!1!==t&&(n(r,i),e.requestAnimationFrame(onAnimationFrame))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(onAnimationFrame),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}
// CONCATENATED MODULE: ./node_modules/three/src/math/Color.js
/**
 * @author mrdoob / http://mrdoob.com/
 */Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype=Object.assign(Object.create(EventDispatcher_EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){
// TODO: Move to THREE.Image
var r=this.image;if(void 0===r.uuid&&(r.uuid=ir.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){
// process array of images e.g. CubeTexture
i=[];for(var a=0,o=r.length;a<o;a++)i.push(El(r[a]))}else
// process single image
i=El(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ms:e.x=e.x-Math.floor(e.x);break;case gs:e.x=e.x<0?0:1;break;case vs:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ms:e.y=e.y-Math.floor(e.y);break;case gs:e.y=e.y<0?0:1;break;case vs:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var Ll={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Color(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}
// CONCATENATED MODULE: ./node_modules/three/src/core/Face3.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */
function Face3(e,t,n,r,i,a){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}
// CONCATENATED MODULE: ./node_modules/three/src/math/Box3.js
/**
 * @author bhouston / http://clara.io
 * @author WestLangley / http://github.com/WestLangley
 */
function Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}
// CONCATENATED MODULE: ./node_modules/three/src/math/Sphere.js
/**
 * @author bhouston / http://clara.io
 * @author mrdoob / http://mrdoob.com/
 */
function Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}
// CONCATENATED MODULE: ./node_modules/three/src/math/Euler.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://clara.io
 */
function Euler(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||Euler.DefaultOrder}
// CONCATENATED MODULE: ./node_modules/three/src/core/Layers.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Layers(){this.mask=1}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function hue2rgb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function setHSL(e,t,n){if(
// h,s,l ranges are in 0.0 - 1.0
e=ir.euclideanModulo(e,1),t=ir.clamp(t,0,1),n=ir.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=hue2rgb(i,r,e+1/3),this.g=hue2rgb(i,r,e),this.b=hue2rgb(i,r,e-1/3)}return this}}(),setStyle:function(e){function handleAlpha(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var t;if(t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){
// rgb / hsl
var n,r=t[1],i=t[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))
// rgb(255,0,0) rgba(255,0,0,0.5)
return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,handleAlpha(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))
// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)
return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,handleAlpha(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){
// hsl(120,50%,50%) hsla(120,50%,50%,0.5)
var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return handleAlpha(n[5]),this.setHSL(a,o,s)}}}else if(t=/^\#([A-Fa-f0-9]+)$/.exec(e)){
// hex color
var l,c=(l=t[1]).length;if(3===c)
// #ff0
return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)
// #ff0000
return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(l=Ll[e])?
// red
this.setHex(l):
// unknown color
console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}}(),copyLinearToSRGB:function(){function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){
// h,s,l ranges are in 0.0 - 1.0
void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),l=(s+o)/2;if(s===o)t=0,n=0;else{var c=o-s;switch(n=l<=.5?c/(o+s):c/(2-o-s),o){case r:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-r)/c+2;break;case a:t=(r-i)/c+4}t/=6}return e.h=t,e.s=n,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,n,r){return this.getHSL(e),e.h+=t,e.s+=n,e.l+=r,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function lerpHSL(n,r){this.getHSL(e),n.getHSL(t);var i=ir.lerp(e.h,t.h,r),a=ir.lerp(e.s,t.s,r),o=ir.lerp(e.l,t.l,r);return this.setHSL(i,a,o),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Object.assign(Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector3;return function setFromCenterAndSize(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){
// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes
return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){
// Computes the world-axis-aligned bounding box of an object (including its children),
// accounting for both the object's, and children's, world transforms
var e,t,n,r=new Vector3;function traverse(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,n=o.length;t<n;t++)r.copy(o[t]),r.applyMatrix4(i.matrixWorld),e.expandByPoint(r)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,n=s.count;t<n;t++)r.fromBufferAttribute(s,t).applyMatrix4(i.matrixWorld),e.expandByPoint(r)}}return function expandByObject(t){return e=this,t.updateMatrixWorld(!0),t.traverse(traverse),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){
// This can potentially have a divide by zero if the box
// has a size dimension of 0.
return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){
// using 6 splitting planes to rule out intersections.
return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new Vector3;return function intersectsSphere(t){
// If that point is inside the sphere, the AABB and sphere intersect.
// Find the point on the AABB closest to the sphere center.
return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){
// We compute the minimum and maximum dot product values. If those values
// are on the same side (back or front) of the plane, then there is no intersection.
var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(){
// triangle centered vertices
var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3,i=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector3;function satForAxes(r){var i,a;for(i=0,a=r.length-3;i<=a;i+=3){o.fromArray(r,i);
// project the aabb onto the seperating axis
var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),c=e.dot(o),u=t.dot(o),h=n.dot(o);
// project all 3 vertices of the triangle onto the seperating axis
// actual test, basically see if either of the most extreme of the triangle points intersects r
if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)
// points of the projected triangle are outside the projected half-length of the aabb
// the axis is seperating and we can exit
return!1}return!0}return function intersectsTriangle(o){if(this.isEmpty())return!1;
// compute box center and extents
this.getCenter(s),l.subVectors(this.max,s),
// translate triangle to aabb origin
e.subVectors(o.a,s),t.subVectors(o.b,s),n.subVectors(o.c,s),
// compute edge vectors for triangle
r.subVectors(t,e),i.subVectors(n,t),a.subVectors(e,n);
// test against axes that are given by cross product combinations of the edges of the triangle and the edges of the aabb
// make an axis testing of each of the 3 sides of the aabb against each of the 3 sides of the triangle = 9 axis of separation
// axis_ij = u_i x f_j (u0, u1, u2 = face normals of aabb = x,y,z axes vectors since aabb is axis aligned)
var u=[0,-r.z,r.y,0,-i.z,i.y,0,-a.z,a.y,r.z,0,-r.x,i.z,0,-i.x,a.z,0,-a.x,-r.y,r.x,0,-i.y,i.x,0,-a.y,a.x,0];return!!satForAxes(u)&&(!!satForAxes(
// test 3 face normals from the aabb
u=[1,0,0,0,1,0,0,0,1])&&(
// finally testing the face normal of the triangle
// use already existing triangle edge vectors here
c.crossVectors(r,i),satForAxes(u=[c.x,c.y,c.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector3;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Vector3;return function getBoundingSphere(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Sphere),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),
// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.
this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3];return function applyMatrix4(t){
// transform of empty box is an empty box.
return this.isEmpty()?this:(
// NOTE: I am using a binary pattern to specify all 2^3 combinations below
e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),// 000
e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),// 001
e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),// 010
e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),// 011
e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),// 100
e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),// 101
e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),// 110
e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),// 111
this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Box3;return function setFromPoints(t,n){var r=this.center;void 0!==n?r.copy(n):e.setFromPoints(t).getCenter(r);for(var i=0,a=0,o=t.length;a<o;a++)i=Math.max(i,r.distanceToSquared(t[a]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=ir.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Matrix4;return function setFromQuaternion(t,n,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){
// WARNING: this discards revolution information -bhouston
var e=new Quaternion;return function reorder(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});
// CONCATENATED MODULE: ./node_modules/three/src/core/Object3D.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author elephantatwork / www.elephantatwork.ch
 */
var Tl=0;function Object3D(){Object.defineProperty(this,"id",{value:Tl++}),this.uuid=ir.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,n=new Quaternion,r=new Vector3(1,1,1);t.onChange(function onRotationChange(){n.setFromEuler(t,!1)}),n.onChange(function onQuaternionChange(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher_EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){
// assumes axis is normalized
this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){
// assumes q is normalized
this.quaternion.copy(e)},rotateOnAxis:function(){
// rotate object on axis in object space
// axis is assumed to be normalized
var e=new Quaternion;return function rotateOnAxis(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){
// rotate object on axis in world space
// axis is assumed to be normalized
// method assumes no rotated parent
var e=new Quaternion;return function rotateOnWorldAxis(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Vector3(1,0,0);return function rotateX(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Vector3(0,1,0);return function rotateY(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Vector3(0,0,1);return function rotateZ(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){
// translate object by distance along axis in object space
// axis is assumed to be normalized
var e=new Vector3;return function translateOnAxis(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new Vector3(1,0,0);return function translateX(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Vector3(0,1,0);return function translateY(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Vector3(0,0,1);return function translateZ(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Matrix4;return function worldToLocal(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){
// This method does not support objects having non-uniformly-scaled parent(s)
var e=new Quaternion,t=new Matrix4,n=new Vector3,r=new Vector3;return function lookAt(i,a,o){i.isVector3?n.copy(i):n.set(i,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(r,n,this.up):t.lookAt(n,r,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new Vector3,t=new Vector3;return function getWorldQuaternion(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldScale:function(){var e=new Vector3,t=new Quaternion;return function getWorldScale(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(
// update children
var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;
// update children
if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){
// meta is a string when called from JSON.stringify
var t=void 0===e||"string"==typeof e,n={};
// meta is a hash used to collect geometries, materials.
// not providing it implies that this is the root object
// being serialized.
t&&(
// initialize meta obj
e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});
// standard Object3D serialization
var r={};
//
function serialize(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){r.geometry=serialize(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var a=i.shapes;if(Array.isArray(a))for(var o=0,s=a.length;o<s;o++){var l=a[o];serialize(e.shapes,l)}else serialize(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(o=0,s=this.material.length;o<s;o++)c.push(serialize(e.materials,this.material[o]));r.material=c}else r.material=serialize(e.materials,this.material);
//
if(this.children.length>0){r.children=[];for(o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(t){var u=extractFromCache(e.geometries),h=extractFromCache(e.materials),d=extractFromCache(e.textures),p=extractFromCache(e.images);a=extractFromCache(e.shapes);u.length>0&&(n.geometries=u),h.length>0&&(n.materials=h),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),a.length>0&&(n.shapes=a)}return n.object=r,n;
// extract data from the cache hash
// remove metadata on each item
// and return as array
function extractFromCache(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}});
// CONCATENATED MODULE: ./node_modules/three/src/core/Geometry.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author kile / http://kile.stravaganza.org/
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author bhouston / http://clara.io
 */
var Al=0;// Geometry uses even numbers as Id
function Geometry(){Object.defineProperty(this,"id",{value:Al+=2}),this.uuid=ir.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,
// update flags
this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}
// CONCATENATED MODULE: ./node_modules/three/src/math/Vector4.js
/**
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author philogb / http://blog.thejit.org/
 * @author mikael emtinger / http://gomo.se/
 * @author egraether / http://egraether.com/
 * @author WestLangley / http://github.com/WestLangley
 */
function Vector4(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}
// CONCATENATED MODULE: ./node_modules/three/src/core/BufferAttribute.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function BufferAttribute(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}
//
function Int8BufferAttribute(e,t,n){BufferAttribute.call(this,new Int8Array(e),t,n)}function Uint8BufferAttribute(e,t,n){BufferAttribute.call(this,new Uint8Array(e),t,n)}function Uint8ClampedBufferAttribute(e,t,n){BufferAttribute.call(this,new Uint8ClampedArray(e),t,n)}function Int16BufferAttribute(e,t,n){BufferAttribute.call(this,new Int16Array(e),t,n)}function Uint16BufferAttribute(e,t,n){BufferAttribute.call(this,new Uint16Array(e),t,n)}function Int32BufferAttribute(e,t,n){BufferAttribute.call(this,new Int32Array(e),t,n)}function Uint32BufferAttribute(e,t,n){BufferAttribute.call(this,new Uint32Array(e),t,n)}function Float32BufferAttribute(e,t,n){BufferAttribute.call(this,new Float32Array(e),t,n)}function Float64BufferAttribute(e,t,n){BufferAttribute.call(this,new Float64Array(e),t,n)}
//
// CONCATENATED MODULE: ./node_modules/three/src/core/DirectGeometry.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],
// this.lineDistances = [];
this.boundingBox=null,this.boundingSphere=null,
// update flags
this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}
// CONCATENATED MODULE: ./node_modules/three/src/core/BufferGeometry.js
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */Geometry.prototype=Object.assign(Object.create(EventDispatcher_EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function(e){for(var t=(new Matrix3).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){
// rotate geometry around world x-axis
var e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){
// rotate geometry around world y-axis
var e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){
// rotate geometry around world z-axis
var e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){
// translate geometry
var e=new Matrix4;return function translate(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){
// scale geometry
var e=new Matrix4;return function scale(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes,i=r.position.array,a=void 0!==r.normal?r.normal.array:void 0,o=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)t.vertices.push(new Vector3(i[d],i[d+1],i[d+2])),void 0!==a&&c.push(new Vector3(a[d],a[d+1],a[d+2])),void 0!==o&&t.colors.push(new Color(o[d],o[d+1],o[d+2])),void 0!==s&&u.push(new Vector2(s[p],s[p+1])),void 0!==l&&h.push(new Vector2(l[p],l[p+1]));function addFace(e,n,r,i){var d=new Face3(e,n,r,void 0!==a?[c[e].clone(),c[n].clone(),c[r].clone()]:[],void 0!==o?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[],i);t.faces.push(d),void 0!==s&&t.faceVertexUvs[0].push([u[e].clone(),u[n].clone(),u[r].clone()]),void 0!==l&&t.faceVertexUvs[1].push([h[e].clone(),h[n].clone(),h[r].clone()])}var f=e.groups;if(f.length>0)for(d=0;d<f.length;d++)for(var m=f[d],g=m.start,v=(p=g,g+m.count);p<v;p+=3)void 0!==n?addFace(n[p],n[p+1],n[p+2],m.materialIndex):addFace(p,p+1,p+2,m.materialIndex);else if(void 0!==n)for(d=0;d<n.length;d+=3)addFace(n[d],n[d+1],n[d+2]);else for(d=0;d<i.length/3;d+=3)addFace(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Matrix4;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new Vector3;if(e){
// vertex normals weighted by triangle areas
// http://www.iquilezles.org/www/articles/normals/normals.htm
var s,l,c,u=new Vector3,h=new Vector3;for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],s=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)o[(a=this.faces[r]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var d=(a=this.faces[r]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;
// save original normals
// - create temp variables on first access
//   otherwise just copy (for faster repeated calls)
for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();
// use temp geometry to compute face and vertex normals for each morph
var a=new Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){
// create on first access
if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)l=new Vector3,c={a:new Vector3,b:new Vector3,c:new Vector3},o.push(l),s.push(c)}var l,c,u=this.morphNormals[e];
// set vertices to morph target
for(a.vertices=this.morphTargets[e].vertices,
// compute morph normals
a.computeFaceNormals(),a.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}
// restore original normals
for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new Matrix3).getNormalMatrix(t));
// vertices
for(var p=0,f=o.length;p<f;p++){var m=o[p].clone();void 0!==t&&m.applyMatrix4(t),a.push(m)}
// colors
for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());
// faces
for(p=0,f=l.length;p<f;p++){var g,v,y,b=l[p],x=b.vertexNormals,_=b.vertexColors;(g=new Face3(b.a+i,b.b+i,b.c+i)).normal.copy(b.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var w=0,M=x.length;w<M;w++)v=x[w].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(b.color);for(w=0,M=_.length;w<M;w++)y=_[w],g.vertexColors.push(y.clone());g.materialIndex=b.materialIndex+n,s.push(g)}
// uvs
for(p=0,f=u.length;p<f;p++){var E=u[p],S=[];if(void 0!==E){for(w=0,M=E.length;w<M;w++)S.push(E[w].clone());c.push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},
/*
     * Checks for duplicate vertices with hashmap.
     * Duplicated vertices are removed
     * and faces' vertices are updated.
     */
mergeVertices:function(){var e,t,n,r,i,a,o,s,l={},c=[],u=[],h=Math.pow(10,4);// Hashmap for looking up vertices by position coordinates (and making sure they are unique)
for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):
//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);
u[n]=u[l[t]];
// if faces are completely degenerate after merging vertices, we
// have to remove them from the geometry.
var d=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],a=[i.a,i.b,i.c];
// if any duplicate vertices are found in a Face3
// we have to remove the face as nothing can be saved
for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var f=d[n];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}
// Use unique set of vertices
var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){
// tag faces
for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;
// sort faces
e.sort(function materialIndexSort(e,t){return e.materialIndex-t.materialIndex});
// sort uvs
var r,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(a[s]),i&&i.push(o[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};
// standard Geometry serialization
if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}var o=[],s=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=setBit(b=setBit(b=setBit(b=setBit(b=setBit(b=setBit(// isQuad
b=setBit(b=setBit(b,0,0),1,!0),2,!1),3,f),4,m),5,g),6,v),7,y),o.push(b),o.push(p.a,p.b,p.c),o.push(p.materialIndex),f){var x=this.faceVertexUvs[0][i];o.push(getUvIndex(x[0]),getUvIndex(x[1]),getUvIndex(x[2]))}if(m&&o.push(getNormalIndex(p.normal)),g){var _=p.vertexNormals;o.push(getNormalIndex(_[0]),getNormalIndex(_[1]),getNormalIndex(_[2]))}if(v&&o.push(getColorIndex(p.color)),y){var w=p.vertexColors;o.push(getColorIndex(w[0]),getColorIndex(w[1]),getColorIndex(w[2]))}}function setBit(e,t,n){return n?e|1<<t:e&~(1<<t)}function getNormalIndex(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function getColorIndex(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function getUvIndex(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),// temporal backward compatibility
e.data.faces=o,e},clone:function(){
/*
         // Handle primitives

         var parameters = this.parameters;

         if ( parameters !== undefined ) {

         var values = [];

         for ( var key in parameters ) {

         values.push( parameters[ key ] );

         }

         var geometry = Object.create( this.constructor.prototype );
         this.constructor.apply( geometry, values );
         return geometry;

         }

         return new this.constructor().copy( this );
         */
return(new Geometry).copy(this)},copy:function(e){var t,n,r,i,a,o;
// reset
this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,
// name
this.name=e.name;
// vertices
var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());
// colors
var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());
// faces
var c=e.faces;for(t=0,n=c.length;t<n;t++)this.faces.push(c[t].clone());
// face vertex uvs
for(t=0,n=e.faceVertexUvs.length;t<n;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=u.length;r<i;r++){var h=u[r],d=[];for(a=0,o=h.length;a<o;a++){var p=h[a];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}
// morph targets
var f=e.morphTargets;for(t=0,n=f.length;t<n;t++){var m={};
// vertices
if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,i=f[t].vertices.length;r<i;r++)m.vertices.push(f[t].vertices[r].clone());
// normals
if(void 0!==f[t].normals)for(m.normals=[],r=0,i=f[t].normals.length;r<i;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}
// morph normals
var g=e.morphNormals;for(t=0,n=g.length;t<n;t++){var v={};
// vertex normals
if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],r=0,i=g[t].vertexNormals.length;r<i;r++){var y=g[t].vertexNormals[r],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}
// face normals
if(void 0!==g[t].faceNormals)for(v.faceNormals=[],r=0,i=g[t].faceNormals.length;r<i;r++)v.faceNormals.push(g[t].faceNormals[r].clone());this.morphNormals.push(v)}
// skin weights
var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());
// skin indices
var _=e.skinIndices;for(t=0,n=_.length;t<n;t++)this.skinIndices.push(_[t].clone());
// line distances
var w=e.lineDistances;for(t=0,n=w.length;t<n;t++)this.lineDistances.push(w[t]);
// bounding box
var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());
// bounding sphere
var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),
// update flags
this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm
// q is assumed to be normalized
this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){
// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm
// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
var t,n,r,i,// margin to distinguish between 0 and 180 degrees
a=e.elements,o=a[0],s=a[4],l=a[8],c=a[1],u=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){
// singularity found
// first check for identity matrix which must have +1 for all terms
// in leading diagonal and zero in other terms
if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)
// this singularity is identity matrix so angle = 0
return this.set(1,0,0,0),this;// zero angle, arbitrary axis
// otherwise this singularity is angle = 180
t=Math.PI;var m=(o+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+c)/4,b=(l+d)/4,x=(h+p)/4;return m>g&&m>v?
// m11 is the largest diagonal term
m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=b/n):g>v?
// m22 is the largest diagonal term
g<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(g)),i=x/r):
// m33 is the largest diagonal term so base result on this
v<.01?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(v)),r=x/i),this.set(n,r,i,t),this;// return 180 deg rotation
}
// as we have reached here there are no singularities so we can handle normally
var _=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-s)*(c-s));// used to normalize
return Math.abs(_)<.001&&(_=1),
// prevent divide by zero, should not happen if matrix is orthogonal and should be
// caught by singularity test above, but I've left it in just in case
this.x=(p-h)/_,this.y=(l-d)/_,this.z=(c-s)/_,this.w=Math.acos((o+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){
// assumes min < max, componentwise
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function clampScalar(n,r){return void 0===e&&(e=new Vector4,t=new Vector4),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new Color),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new Vector2),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new Vector3),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Vector4),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];
// materials
o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:r})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(c=0;c<d;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}
// skins
var p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,g=f.length===r.length;
//
r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<n.length;c++){var v=n[c];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var x,_=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===a)void 0!==(x=i[0][c])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===o)void 0!==(x=i[1][c])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Vector2,new Vector2,new Vector2));
// morphs
for(var M=0;M<l;M++){var E=s[M].vertices;t[M].data.push(E[v.a],E[v.b],E[v.c])}for(M=0;M<d;M++){var S=h[M].vertexNormals[c];u[M].data.push(S.a,S.b,S.c)}
// skins
m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Cl=1;// BufferGeometry uses odd numbers as Id
function BufferGeometry_BufferGeometry(){Object.defineProperty(this,"id",{value:Cl+=2}),this.uuid=ir.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}
// CONCATENATED MODULE: ./node_modules/three/src/geometries/BoxGeometry.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
// BoxGeometry
function BoxGeometry(e,t,n,r,i,a){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new BoxBufferGeometry(e,t,n,r,i,a)),this.mergeVertices()}
// BoxBufferGeometry
function BoxBufferGeometry(e,t,n,r,i,a){BufferGeometry_BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};var o=this;e=e||1,t=t||1,n=n||1,
// segments
r=Math.floor(r)||1,i=Math.floor(i)||1;
// buffers
var s=[],l=[],c=[],u=[],h=0,d=0;function buildPlane(e,t,n,r,i,a,p,f,m,g,v){var y,b,x=a/m,_=p/g,w=a/2,M=p/2,E=f/2,S=m+1,L=g+1,T=0,A=0,C=new Vector3;
// generate vertices, normals and uvs
for(b=0;b<L;b++){var P=b*_-M;for(y=0;y<S;y++){var I=y*x-w;
// set values to correct vector component
C[e]=I*r,C[t]=P*i,C[n]=E,
// now apply vector to vertex buffer
l.push(C.x,C.y,C.z),
// set values to correct vector component
C[e]=0,C[t]=0,C[n]=f>0?1:-1,
// now apply vector to normal buffer
c.push(C.x,C.y,C.z),
// uvs
u.push(y/m),u.push(1-b/g),
// counters
T+=1}}
// indices
// 1. you need three indices to draw a single face
// 2. a single segment consists of two faces
// 3. so we need to generate six (2*3) indices per segment
for(b=0;b<g;b++)for(y=0;y<m;y++){var O=h+y+S*b,B=h+y+S*(b+1),R=h+(y+1)+S*(b+1),G=h+(y+1)+S*b;
// faces
s.push(O,B,G),s.push(B,R,G),
// increase counter
A+=6}
// add a group to the geometry. this will ensure multi material support
o.addGroup(d,A,v),
// calculate new start value for groups
d+=A,
// update total number of vertices
h+=T}
// build each side of the box geometry
buildPlane("z","y","x",-1,-1,n,t,e,a=Math.floor(a)||1,i,0),// px
buildPlane("z","y","x",1,-1,n,t,-e,a,i,1),// nx
buildPlane("x","z","y",1,1,e,n,t,r,a,2),// py
buildPlane("x","z","y",1,-1,e,n,-t,r,a,3),// ny
buildPlane("x","y","z",1,-1,e,t,n,r,i,4),// pz
buildPlane("x","y","z",-1,-1,e,t,-n,r,i,5),// nz
// build geometry
this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2))}
// CONCATENATED MODULE: ./node_modules/three/src/geometries/PlaneGeometry.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Mugen87 / https://github.com/Mugen87
 */
// PlaneGeometry
function PlaneGeometry(e,t,n,r){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,n,r)),this.mergeVertices()}
// PlaneBufferGeometry
function PlaneBufferGeometry(e,t,n,r){BufferGeometry_BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(n)||1,c=Math.floor(r)||1,u=l+1,h=c+1,d=e/l,p=t/c,f=[],m=[],g=[],v=[];
// generate vertices, normals and uvs
for(a=0;a<h;a++){var y=a*p-s;for(i=0;i<u;i++){var b=i*d-o;m.push(b,-y,0),g.push(0,0,1),v.push(i/l),v.push(1-a/c)}}
// indices
for(a=0;a<c;a++)for(i=0;i<l;i++){var x=i+u*a,_=i+u*(a+1),w=i+1+u*(a+1),M=i+1+u*a;
// faces
f.push(x,_,M),f.push(_,w,M)}
// build geometry
this.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(v,2))}BufferGeometry_BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher_EventDispatcher.prototype),{constructor:BufferGeometry_BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new Matrix3).getNormalMatrix(e).applyToBufferAttribute(n),n.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){
// rotate geometry around world x-axis
var e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){
// rotate geometry around world y-axis
var e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){
// rotate geometry around world z-axis
var e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){
// translate geometry
var e=new Matrix4;return function translate(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){
// scale geometry
var e=new Matrix4;return function scale(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){
// console.log( 'THREE.BufferGeometry.setFromObject(). Converting', object, this );
var t=e.geometry;if(e.isPoints||e.isLine){var n=new Float32BufferAttribute(3*t.vertices.length,3),r=new Float32BufferAttribute(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Float32BufferAttribute(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new BufferAttribute(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new BufferAttribute(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new BufferAttribute(a,2).copyVector2sArray(e.uvs2))}
// groups
// morphs
for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,u=l.length;c<u;c++){var h=l[c],d=new Float32BufferAttribute(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}
// skinning
if(e.skinIndices.length>0){var p=new Float32BufferAttribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Float32BufferAttribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}
//
return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Box3,t=new Vector3;return function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;e.setFromBufferAttribute(n),e.getCenter(r);for(
// hoping to find a boundingSphere with a radius smaller than the
// boundingSphere of the boundingBox: sqrt(3) smaller in the best case
var i=0,a=0,o=n.count;a<o;a++)t.x=n.getX(a),t.y=n.getY(a),t.z=n.getZ(a),i=Math.max(i,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){
// backwards compatibility
},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(n.length),3));else for(
// reset existing normals to zero
var r=t.normal.array,i=0,a=r.length;i<a;i++)r[i]=0;var o,s,l,c=t.normal.array,u=new Vector3,h=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3;
// indexed elements
if(e){var m=e.array;for(i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(n,o),h.fromArray(n,s),d.fromArray(n,l),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[o]+=p.x,c[o+1]+=p.y,c[o+2]+=p.z,c[s]+=p.x,c[s+1]+=p.y,c[s+2]+=p.z,c[l]+=p.x,c[l+1]+=p.y,c[l+2]+=p.z}else
// non-indexed elements (unconnected triangle soup)
for(i=0,a=n.length;i<a;i+=9)u.fromArray(n,i),h.fromArray(n,i+3),d.fromArray(n,i+6),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[i]=p.x,c[i+1]=p.y,c[i+2]=p.z,c[i+3]=p.x,c[i+4]=p.y,c[i+5]=p.z,c[i+6]=p.x,c[i+7]=p.y,c[i+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=0,l=a.itemSize*t;s<o.length;s++,l++)i[l]=o[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Vector3;return function normalizeNormals(){for(var t=this.attributes.normal,n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new BufferGeometry_BufferGeometry,t=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],a=i.array,o=i.itemSize,s=new a.constructor(t.length*o),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*o;for(var d=0;d<o;d++)s[c++]=a[l++]}e.addAttribute(r,new BufferAttribute(s,o))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};
// standard BufferGeometry serialization
if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:i}}var a=this.attributes;for(var n in a){var o=a[n];i=Array.prototype.slice.call(o.array);e.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:i,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){
/*
         // Handle primitives

         var parameters = this.parameters;

         if ( parameters !== undefined ) {

         var values = [];

         for ( var key in parameters ) {

         values.push( parameters[ key ] );

         }

         var geometry = Object.create( this.constructor.prototype );
         this.constructor.apply( geometry, values );
         return geometry;

         }

         return new this.constructor().copy( this );
         */
return(new BufferGeometry_BufferGeometry).copy(this)},copy:function(e){var t,n,r;
// reset
this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,
// name
this.name=e.name;
// index
var i=e.index;null!==i&&this.setIndex(i.clone());
// attributes
var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}
// morph attributes
var s=e.morphAttributes;for(t in s){var l=[],c=s[t];// morphAttribute: array of Float32BufferAttributes
for(n=0,r=c.length;n<r;n++)l.push(c[n].clone());this.morphAttributes[t]=l}
// groups
var u=e.groups;for(n=0,r=u.length;n<r;n++){var h=u[n];this.addGroup(h.start,h.count,h.materialIndex)}
// bounding box
var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());
// bounding sphere
var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),
// draw range
this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,
// user data
this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),BoxGeometry.prototype=Object.create(Geometry.prototype),BoxGeometry.prototype.constructor=BoxGeometry,BoxBufferGeometry.prototype=Object.create(BufferGeometry_BufferGeometry.prototype),BoxBufferGeometry.prototype.constructor=BoxBufferGeometry,PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry_BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;
// CONCATENATED MODULE: ./node_modules/three/src/materials/Material.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */
var Pl=0;function Material(){Object.defineProperty(this,"id",{value:Pl++}),this.uuid=ir.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=So,this.side=xo,this.flatShading=!1,this.vertexColors=Mo,// THREE.NoColors, THREE.VertexColors, THREE.FaceColors
this.opacity=1,this.transparent=!1,this.blendSrc=Uo,this.blendDst=Fo,this.blendEquation=Po,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Zo,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,// override the renderer's default precision for this material
this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,// Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer
this.visible=!0,this.userData={},this.needsUpdate=!0}Material.prototype=Object.assign(Object.create(EventDispatcher_EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)
// for backward compatability if shading is set in the constructor
if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):
// ensure overdraw is backwards-compatible with legacy boolean type
this[t]="overdraw"===t?Number(n):n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};
// standard Material serialization
// TODO: Copied from Object3D.toJSON
function extractFromCache(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,// Scale behind envMap
void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==So&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==xo&&(n.side=this.side),this.vertexColors!==Mo&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,
// rotation (SpriteMaterial)
0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=extractFromCache(e.textures),i=extractFromCache(e.images);r.length>0&&(n.textures=r),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
// CONCATENATED MODULE: ./node_modules/three/src/renderers/shaders/UniformsUtils.js
/**
 * Uniform Utilities
 */
var Il={merge:function(e){for(var t={},n=0;n<e.length;n++){var r=this.clone(e[n]);for(var i in r)t[i]=r[i]}return t},clone:function(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}};
// CONCATENATED MODULE: ./node_modules/three/src/materials/ShaderMaterial.js
/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  defines: { "label" : "value" },
 *  uniforms: { "parameter1": { value: 1.0 }, "parameter2": { value2: 2 } },
 *
 *  fragmentShader: <string>,
 *  vertexShader: <string>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  lights: <bool>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>
 * }
 */function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,// set to use scene fog
this.lights=!1,// set to use scene lights
this.clipping=!1,// set to use user-defined clipping planes
this.skinning=!1,// set to use skinning attribute streams
this.morphTargets=!1,// set to use morph targets
this.morphNormals=!1,// set to use morph normals
this.extensions={derivatives:!1,// set to use derivatives
fragDepth:!1,// set to use fragment depth values
drawBuffers:!1,// set to use draw buffers
shaderTextureLOD:!1},
// When rendered geometry doesn't include these attributes but the material does,
// use these default values in WebGL. This avoids errors when buffer data is missing.
this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}
// CONCATENATED MODULE: ./node_modules/three/src/math/Ray.js
/**
 * @author bhouston / http://clara.io
 */
function Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3}
// CONCATENATED MODULE: ./node_modules/three/src/math/Triangle.js
/**
 * @author bhouston / http://clara.io
 * @author mrdoob / http://mrdoob.com/
 */
function Triangle(e,t,n){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==n?n:new Vector3}
// CONCATENATED MODULE: ./node_modules/three/src/materials/MeshBasicMaterial.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *  lightMapIntensity: <float>
 *
 *  aoMap: new THREE.Texture( <Image> ),
 *  aoMapIntensity: <float>
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>
 * }
 */
function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),// emissive
this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=es,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}
// CONCATENATED MODULE: ./node_modules/three/src/objects/Mesh.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author jonobr1 / http://jonobr1.com/
 */
function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry_BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=pl,this.updateMorphTargets()}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Il.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}return Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Vector3;return function recast(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Vector3;return function distanceSqToPoint(t){var n=e.subVectors(t,this.origin).dot(this.direction);
// point behind the ray
return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function distanceSqToSegment(r,i,a,o){
// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteDistRaySegment.h
// It returns the min distance between the ray and the segment
// defined by v0 and v1
// It can also set two optional targets :
// - The closest point on the ray
// - The closest point on the segment
e.copy(r).add(i).multiplyScalar(.5),t.copy(i).sub(r).normalize(),n.copy(this.origin).sub(e);var s,l,c,u,h=.5*r.distanceTo(i),d=-this.direction.dot(t),p=n.dot(this.direction),f=-n.dot(t),m=n.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(
// The ray and segment are not parallel.
l=d*p-f,u=h*g,(s=d*f-p)>=0)if(l>=-u)if(l<=u){
// region 0
// Minimum at interior points of ray and segment.
var v=1/g;c=(s*=v)*(s+d*(l*=v)+2*p)+l*(d*s+l+2*f)+m}else
// region 1
l=h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else
// region 5
l=-h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l<=-u?c=-(
// region 4
s=Math.max(0,-(-d*h+p)))*s+(l=s>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(
// region 3
s=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(
// region 2
s=Math.max(0,-(d*h+p)))*s+(l=s>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else
// Ray and segment are parallel.
l=d>0?-h:h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new Vector3;return function intersectSphere(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),i=e.dot(e)-r*r,a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i),s=r-o,l=r+o;
// t0 = first intersect point - entrance on front of sphere
// test to see if both t0 and t1 are behind the ray - if so, return null
return s<0&&l<0?null:
// test to see if t0 is behind the ray:
// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,
// in order to always return an intersect point that is in front of the ray.
s<0?this.at(l,n):this.at(s,n)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)
// line is coplanar, return origin
return 0===e.distanceToPoint(this.origin)?0:null;
// Null is preferable to undefined since undefined means.... it is undefined
var n=-(this.origin.dot(e.normal)+e.constant)/t;
// Return if the ray never intersects the plane
return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){
// check if the ray lies on the plane first
var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||i>r?null:(
// These lines also handle the case where tmin or tmax is NaN
// (result of 0 * Infinity). x !== x returns true if x is NaN
(i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),
//return point closest to the ray (positive side)
r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){
// Compute the offset origin, edges, and normal.
var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3;return function intersectTriangle(i,a,o,s,l){
// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h
t.subVectors(a,i),n.subVectors(o,i),r.crossVectors(t,n);
// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,
// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by
//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))
//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))
//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)
var c,u=this.direction.dot(r);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,i);var h=c*this.direction.dot(n.crossVectors(e,n));
// b1 < 0, no intersection
if(h<0)return null;var d=c*this.direction.dot(t.cross(e));
// b2 < 0, no intersection
if(d<0)return null;
// b1+b2 > 1, no intersection
if(h+d>u)return null;
// Line intersects triangle, check if ray does.
var p=-c*e.dot(r);
// t < 0, no intersection
return p<0?null:this.at(p/u,l);
// Ray intersects triangle.
}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Triangle,{getNormal:function(){var e=new Vector3;return function getNormal(t,n,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Vector3),i.subVectors(r,n),e.subVectors(t,n),i.cross(e);var a=i.lengthSq();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}}(),
// static/instance method to calculate barycentric coordinates
// based on: http://www.blackpawn.com/texts/pointinpoly/default.html
getBarycoord:function(){var e=new Vector3,t=new Vector3,n=new Vector3;return function getBarycoord(r,i,a,o,s){e.subVectors(o,i),t.subVectors(a,i),n.subVectors(r,i);var l=e.dot(e),c=e.dot(t),u=e.dot(n),h=t.dot(t),d=t.dot(n),p=l*h-c*c;
// collinear or singular triangle
if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),0===p)
// arbitrary location outside of triangle?
// not sure if this is the best idea, maybe should be returning undefined
return s.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,g=(l*d-c*u)*f;
// barycentric coordinates must always sum to 1
return s.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new Vector3;return function containsPoint(t,n,r,i){return Triangle.getBarycoord(t,n,r,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:function(){var e=new Vector3;return function getUV(t,n,r,i,a,o,s,l){return this.getBarycoord(t,n,r,i,e),l.set(0,0),l.addScaledVector(a,e.x),l.addScaledVector(o,e.y),l.addScaledVector(s,e.z),l}}()}),Object.assign(Triangle.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Vector3,t=new Vector3;return function getArea(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Vector3),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,n,r,i){return Triangle.getUV(e,this.a,this.b,this.c,t,n,r,i)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new Vector3,t=new Vector3,n=new Vector3,r=new Vector3,i=new Vector3,a=new Vector3;return function closestPointToPoint(o,s){void 0===s&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),s=new Vector3);var l,c,u=this.a,h=this.b,d=this.c;
// algorithm thanks to Real-Time Collision Detection by Christer Ericson,
// published by Morgan Kaufmann Publishers, (c) 2005 Elsevier Inc.,
// under the accompanying license; see chapter 5.1.5 for detailed explanation.
// basically, we're distinguishing which of the voronoi regions of the triangle
// the point lies in with the minimum amount of redundant computation.
e.subVectors(h,u),t.subVectors(d,u),r.subVectors(o,u);var p=e.dot(r),f=t.dot(r);if(p<=0&&f<=0)
// vertex region of A; barycentric coords (1, 0, 0)
return s.copy(u);i.subVectors(o,h);var m=e.dot(i),g=t.dot(i);if(m>=0&&g<=m)
// vertex region of B; barycentric coords (0, 1, 0)
return s.copy(h);var v=p*g-m*f;if(v<=0&&p>=0&&m<=0)
// edge region of AB; barycentric coords (1-v, v, 0)
return l=p/(p-m),s.copy(u).addScaledVector(e,l);a.subVectors(o,d);var y=e.dot(a),b=t.dot(a);if(b>=0&&y<=b)
// vertex region of C; barycentric coords (0, 0, 1)
return s.copy(d);var x=y*f-p*b;if(x<=0&&f>=0&&b<=0)
// edge region of AC; barycentric coords (1-w, 0, w)
return c=f/(f-b),s.copy(u).addScaledVector(t,c);var _=m*b-y*g;if(_<=0&&g-m>=0&&y-b>=0)
// edge region of BC; barycentric coords (0, 1-w, w)
return n.subVectors(d,h),c=(g-m)/(g-m+(y-b)),s.copy(h).addScaledVector(n,c);// edge region of BC
// face region
var w=1/(_+x+v);
// u = va * denom
return l=x*w,c=v*w,s.copy(u).addScaledVector(e,l).addScaledVector(t,c)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)n=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}},raycast:function(){var e=new Matrix4,t=new Ray,n=new Sphere,r=new Vector3,i=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector2,u=new Vector2,h=new Vector2,d=new Vector3,p=new Vector3;function checkIntersection(e,t,n,r,i,a,o,s){if(null===(t.side===_o?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==wo,s)))return null;p.copy(s),p.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(p);return l<n.near||l>n.far?null:{distance:l,point:p.clone(),object:e}}function checkBufferGeometryIntersection(e,t,n,o,s,l,p,f,m){r.fromBufferAttribute(s,p),i.fromBufferAttribute(s,f),a.fromBufferAttribute(s,m);var g=checkIntersection(e,t,n,o,r,i,a,d);if(g){l&&(c.fromBufferAttribute(l,p),u.fromBufferAttribute(l,f),h.fromBufferAttribute(l,m),g.uv=Triangle.getUV(d,r,i,a,c,u,h,new Vector2));var v=new Face3(p,f,m);Triangle.getNormal(r,i,a,v.normal),g.face=v}return g}return function raycast(p,f){var m,g=this.geometry,v=this.material,y=this.matrixWorld;if(void 0!==v&&(
// Checking boundingSphere distance to ray
null===g.boundingSphere&&g.computeBoundingSphere(),n.copy(g.boundingSphere),n.applyMatrix4(y),!1!==p.ray.intersectsSphere(n)&&(
//
e.getInverse(y),t.copy(p.ray).applyMatrix4(e),null===g.boundingBox||!1!==t.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var b,x,_,w,M,E,S,L,T,A=g.index,C=g.attributes.position,P=g.attributes.uv,I=g.groups,O=g.drawRange;if(null!==A)
// indexed buffer geometry
if(Array.isArray(v))for(w=0,E=I.length;w<E;w++)for(T=v[(L=I[w]).materialIndex],M=Math.max(L.start,O.start),S=Math.min(L.start+L.count,O.start+O.count);M<S;M+=3)b=A.getX(M),x=A.getX(M+1),_=A.getX(M+2),(m=checkBufferGeometryIntersection(this,T,p,t,C,P,b,x,_))&&(m.faceIndex=Math.floor(M/3),// triangle number in indexed buffer semantics
f.push(m));else for(w=Math.max(0,O.start),E=Math.min(A.count,O.start+O.count);w<E;w+=3)b=A.getX(w),x=A.getX(w+1),_=A.getX(w+2),(m=checkBufferGeometryIntersection(this,v,p,t,C,P,b,x,_))&&(m.faceIndex=Math.floor(w/3),// triangle number in indexed buffer semantics
f.push(m));else if(void 0!==C)
// non-indexed buffer geometry
if(Array.isArray(v))for(w=0,E=I.length;w<E;w++)for(T=v[(L=I[w]).materialIndex],M=Math.max(L.start,O.start),S=Math.min(L.start+L.count,O.start+O.count);M<S;M+=3)(m=checkBufferGeometryIntersection(this,T,p,t,C,P,b=M,x=M+1,_=M+2))&&(m.faceIndex=Math.floor(M/3),// triangle number in non-indexed buffer semantics
f.push(m));else for(w=Math.max(0,O.start),E=Math.min(C.count,O.start+O.count);w<E;w+=3)(m=checkBufferGeometryIntersection(this,v,p,t,C,P,b=w,x=w+1,_=w+2))&&(m.faceIndex=Math.floor(w/3),// triangle number in non-indexed buffer semantics
f.push(m))}else if(g.isGeometry){var B,R,G,D,V=Array.isArray(v),N=g.vertices,U=g.faces,F=g.faceVertexUvs[0];F.length>0&&(D=F);for(var z=0,k=U.length;z<k;z++){var j=U[z],H=V?v[j.materialIndex]:v;if(void 0!==H){if(B=N[j.a],R=N[j.b],G=N[j.c],!0===H.morphTargets){var W=g.morphTargets,X=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),a.set(0,0,0);for(var q=0,Y=W.length;q<Y;q++){var Z=X[q];if(0!==Z){var J=W[q].vertices;r.addScaledVector(o.subVectors(J[j.a],B),Z),i.addScaledVector(s.subVectors(J[j.b],R),Z),a.addScaledVector(l.subVectors(J[j.c],G),Z)}}r.add(B),i.add(R),a.add(G),B=r,R=i,G=a}if(m=checkIntersection(this,H,p,t,B,R,G,d)){if(D&&D[z]){var Q=D[z];c.copy(Q[0]),u.copy(Q[1]),h.copy(Q[2]),m.uv=Triangle.getUV(d,B,R,G,c,u,h,new Vector2)}m.face=j,m.faceIndex=z,f.push(m)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});
// EXTERNAL MODULE: ./node_modules/three/src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl
var Ol=n(132),Bl=/* */n.n(Ol),Rl=n(131),Gl=/* */n.n(Rl),Dl=n(130),Vl=/* */n.n(Dl),Nl=n(129),Ul=/* */n.n(Nl),Fl=n(128),zl=/* */n.n(Fl),kl=n(127),jl=/* */n.n(kl),Hl=n(126),Wl=/* */n.n(Hl),Xl=n(125),ql=/* */n.n(Xl),Yl=n(124),Zl=/* */n.n(Yl),Jl=n(123),Ql=/* */n.n(Jl),Kl=n(122),$l=/* */n.n(Kl),ec=n(121),tc=/* */n.n(ec),nc=n(120),rc=/* */n.n(nc),ic=n(119),ac=/* */n.n(ic),oc=n(118),sc=/* */n.n(oc),lc=n(117),cc=/* */n.n(lc),uc=n(116),hc=/* */n.n(uc),dc=n(115),pc=/* */n.n(dc),fc=n(114),mc=/* */n.n(fc),gc=n(113),vc=/* */n.n(gc),yc=n(112),bc=/* */n.n(yc),xc=n(111),_c=/* */n.n(xc),wc=n(110),Mc=/* */n.n(wc),Ec=n(109),Sc=/* */n.n(Ec),Lc=n(108),Tc=/* */n.n(Lc),Ac=n(107),Cc=/* */n.n(Ac),Pc=n(106),Ic=/* */n.n(Pc),Oc=n(105),Bc=/* */n.n(Oc),Rc=n(104),Gc=/* */n.n(Rc),Dc=n(103),Vc=/* */n.n(Dc),Nc=n(102),Uc=/* */n.n(Nc),Fc=n(101),zc=/* */n.n(Fc),kc=n(100),jc=/* */n.n(kc),Hc=n(99),Wc=/* */n.n(Hc),Xc=n(98),qc=/* */n.n(Xc),Yc=n(97),Zc=/* */n.n(Yc),Jc=n(96),Qc=/* */n.n(Jc),Kc=n(95),$c=/* */n.n(Kc),eu=n(94),tu=/* */n.n(eu),nu=n(93),ru=/* */n.n(nu),iu=n(92),au=/* */n.n(iu),ou=n(91),su=/* */n.n(ou),lu=n(90),cu=/* */n.n(lu),uu=n(89),hu=/* */n.n(uu),du=n(88),pu=/* */n.n(du),fu=n(87),mu=/* */n.n(fu),gu=n(86),vu=/* */n.n(gu),yu=n(85),bu=/* */n.n(yu),xu=n(84),_u=/* */n.n(xu),wu=n(83),Mu=/* */n.n(wu),Eu=n(82),Su=/* */n.n(Eu),Lu=n(81),Tu=/* */n.n(Lu),Au=n(80),Cu=/* */n.n(Au),Pu=n(79),Iu=/* */n.n(Pu),Ou=n(78),Bu=/* */n.n(Ou),Ru=n(77),Gu=/* */n.n(Ru),Du=n(76),Vu=/* */n.n(Du),Nu=n(75),Uu=/* */n.n(Nu),Fu=n(74),zu=/* */n.n(Fu),ku=n(73),ju=/* */n.n(ku),Hu=n(72),Wu=/* */n.n(Hu),Xu=n(71),qu=/* */n.n(Xu),Yu=n(70),Zu=/* */n.n(Yu),Ju=n(69),Qu=/* */n.n(Ju),Ku=n(68),$u=/* */n.n(Ku),eh=n(67),th=/* */n.n(eh),nh=n(66),rh=/* */n.n(nh),ih=n(65),ah=/* */n.n(ih),oh=n(64),sh=/* */n.n(oh),lh=n(63),ch=/* */n.n(lh),uh=n(62),hh=/* */n.n(uh),dh=n(61),ph=/* */n.n(dh),fh=n(60),mh=/* */n.n(fh),gh=n(59),vh=/* */n.n(gh),yh=n(58),bh=/* */n.n(yh),xh=n(57),_h=/* */n.n(xh),wh=n(56),Mh=/* */n.n(wh),Eh=n(55),Sh=/* */n.n(Eh),Lh=n(54),Th=/* */n.n(Lh),Ah=n(53),Ch=/* */n.n(Ah),Ph=n(52),Ih=/* */n.n(Ph),Oh=n(51),Bh=/* */n.n(Oh),Rh=n(50),Gh=/* */n.n(Rh),Dh=n(49),Vh=/* */n.n(Dh),Nh=n(48),Uh=/* */n.n(Nh),Fh=n(47),zh=/* */n.n(Fh),kh=n(46),jh=/* */n.n(kh),Hh=n(45),Wh=/* */n.n(Hh),Xh=n(44),qh=/* */n.n(Xh),Yh=n(43),Zh=/* */n.n(Yh),Jh=n(42),Qh=/* */n.n(Jh),Kh=n(41),$h=/* */n.n(Kh),ed=n(40),td=/* */n.n(ed),nd=n(39),rd=/* */n.n(nd),id=n(38),ad=/* */n.n(id),od=n(37),sd=/* */n.n(od),ld=n(36),cd=/* */n.n(ld),ud=n(35),hd=/* */n.n(ud),dd=n(34),pd=/* */n.n(dd),fd=n(33),md=/* */n.n(fd),gd=n(32),vd=/* */n.n(gd),yd=n(31),bd=/* */n.n(yd),xd=n(30),_d=/* */n.n(xd),wd=n(29),Md=/* */n.n(wd),Ed=n(28),Sd=/* */n.n(Ed),Ld=n(27),Td=/* */n.n(Ld),Ad=n(26),Cd=/* */n.n(Ad),Pd=n(25),Id=/* */n.n(Pd),Od=n(24),Bd=/* */n.n(Od),Rd=n(23),Gd=/* */n.n(Rd),Dd=n(22),Vd=/* */n.n(Dd),Nd=n(21),Ud=/* */n.n(Nd),Fd=n(20),zd=/* */n.n(Fd),kd=n(19),jd=/* */n.n(kd),Hd=n(18),Wd=/* */n.n(Hd),Xd=n(17),qd=/* */n.n(Xd),Yd=n(16),Zd=/* */n.n(Yd),Jd=n(15),Qd=/* */n.n(Jd),Kd=n(14),$d=/* */n.n(Kd),ep={alphamap_fragment:Bl.a,alphamap_pars_fragment:Gl.a,alphatest_fragment:Vl.a,aomap_fragment:Ul.a,aomap_pars_fragment:zl.a,begin_vertex:jl.a,beginnormal_vertex:Wl.a,bsdfs:ql.a,bumpmap_pars_fragment:Zl.a,clipping_planes_fragment:Ql.a,clipping_planes_pars_fragment:$l.a,clipping_planes_pars_vertex:tc.a,clipping_planes_vertex:rc.a,color_fragment:ac.a,color_pars_fragment:sc.a,color_pars_vertex:cc.a,color_vertex:hc.a,common:pc.a,cube_uv_reflection_fragment:mc.a,defaultnormal_vertex:vc.a,displacementmap_pars_vertex:bc.a,displacementmap_vertex:_c.a,emissivemap_fragment:Mc.a,emissivemap_pars_fragment:Sc.a,encodings_fragment:Tc.a,encodings_pars_fragment:Cc.a,envmap_fragment:Ic.a,envmap_pars_fragment:Bc.a,envmap_pars_vertex:Gc.a,envmap_physical_pars_fragment:ru.a,envmap_vertex:Vc.a,fog_vertex:Uc.a,fog_pars_vertex:zc.a,fog_fragment:jc.a,fog_pars_fragment:Wc.a,gradientmap_pars_fragment:qc.a,lightmap_fragment:Zc.a,lightmap_pars_fragment:Qc.a,lights_lambert_vertex:$c.a,lights_pars_begin:tu.a,lights_phong_fragment:au.a,lights_phong_pars_fragment:su.a,lights_physical_fragment:cu.a,lights_physical_pars_fragment:hu.a,lights_fragment_begin:pu.a,lights_fragment_maps:mu.a,lights_fragment_end:vu.a,logdepthbuf_fragment:bu.a,logdepthbuf_pars_fragment:_u.a,logdepthbuf_pars_vertex:Mu.a,logdepthbuf_vertex:Su.a,map_fragment:Tu.a,map_pars_fragment:Cu.a,map_particle_fragment:Iu.a,map_particle_pars_fragment:Bu.a,metalnessmap_fragment:Gu.a,metalnessmap_pars_fragment:Vu.a,morphnormal_vertex:Uu.a,morphtarget_pars_vertex:zu.a,morphtarget_vertex:ju.a,normal_fragment_begin:Wu.a,normal_fragment_maps:qu.a,normalmap_pars_fragment:Zu.a,packing:Qu.a,premultiplied_alpha_fragment:$u.a,project_vertex:th.a,dithering_fragment:rh.a,dithering_pars_fragment:ah.a,roughnessmap_fragment:sh.a,roughnessmap_pars_fragment:ch.a,shadowmap_pars_fragment:hh.a,shadowmap_pars_vertex:ph.a,shadowmap_vertex:mh.a,shadowmask_pars_fragment:vh.a,skinbase_vertex:bh.a,skinning_pars_vertex:_h.a,skinning_vertex:Mh.a,skinnormal_vertex:Sh.a,specularmap_fragment:Th.a,specularmap_pars_fragment:Ch.a,tonemapping_fragment:Ih.a,tonemapping_pars_fragment:Bh.a,uv_pars_fragment:Gh.a,uv_pars_vertex:Vh.a,uv_vertex:Uh.a,uv2_pars_fragment:zh.a,uv2_pars_vertex:jh.a,uv2_vertex:Wh.a,worldpos_vertex:qh.a,background_frag:Zh.a,background_vert:Qh.a,cube_frag:$h.a,cube_vert:td.a,depth_frag:rd.a,depth_vert:ad.a,distanceRGBA_frag:sd.a,distanceRGBA_vert:cd.a,equirect_frag:hd.a,equirect_vert:pd.a,linedashed_frag:md.a,linedashed_vert:vd.a,meshbasic_frag:bd.a,meshbasic_vert:_d.a,meshlambert_frag:Md.a,meshlambert_vert:Sd.a,meshmatcap_frag:Td.a,meshmatcap_vert:Cd.a,meshphong_frag:Id.a,meshphong_vert:Bd.a,meshphysical_frag:Gd.a,meshphysical_vert:Vd.a,normal_frag:Ud.a,normal_vert:zd.a,points_frag:jd.a,points_vert:Wd.a,shadow_frag:qd.a,shadow_vert:Zd.a,sprite_frag:Qd.a,sprite_vert:$d.a},tp={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},
// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src
rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Matrix3}}},np={basic:{uniforms:Il.merge([tp.common,tp.specularmap,tp.envmap,tp.aomap,tp.lightmap,tp.fog]),vertexShader:ep.meshbasic_vert,fragmentShader:ep.meshbasic_frag},lambert:{uniforms:Il.merge([tp.common,tp.specularmap,tp.envmap,tp.aomap,tp.lightmap,tp.emissivemap,tp.fog,tp.lights,{emissive:{value:new Color(0)}}]),vertexShader:ep.meshlambert_vert,fragmentShader:ep.meshlambert_frag},phong:{uniforms:Il.merge([tp.common,tp.specularmap,tp.envmap,tp.aomap,tp.lightmap,tp.emissivemap,tp.bumpmap,tp.normalmap,tp.displacementmap,tp.gradientmap,tp.fog,tp.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ep.meshphong_vert,fragmentShader:ep.meshphong_frag},standard:{uniforms:Il.merge([tp.common,tp.envmap,tp.aomap,tp.lightmap,tp.emissivemap,tp.bumpmap,tp.normalmap,tp.displacementmap,tp.roughnessmap,tp.metalnessmap,tp.fog,tp.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ep.meshphysical_vert,fragmentShader:ep.meshphysical_frag},matcap:{uniforms:Il.merge([tp.common,tp.bumpmap,tp.normalmap,tp.displacementmap,tp.fog,{matcap:{value:null}}]),vertexShader:ep.meshmatcap_vert,fragmentShader:ep.meshmatcap_frag},points:{uniforms:Il.merge([tp.points,tp.fog]),vertexShader:ep.points_vert,fragmentShader:ep.points_frag},dashed:{uniforms:Il.merge([tp.common,tp.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ep.linedashed_vert,fragmentShader:ep.linedashed_frag},depth:{uniforms:Il.merge([tp.common,tp.displacementmap]),vertexShader:ep.depth_vert,fragmentShader:ep.depth_frag},normal:{uniforms:Il.merge([tp.common,tp.bumpmap,tp.normalmap,tp.displacementmap,{opacity:{value:1}}]),vertexShader:ep.normal_vert,fragmentShader:ep.normal_frag},sprite:{uniforms:Il.merge([tp.sprite,tp.fog]),vertexShader:ep.sprite_vert,fragmentShader:ep.sprite_frag},background:{uniforms:{t2D:{value:null}},vertexShader:ep.background_vert,fragmentShader:ep.background_frag},
/* -------------------------------------------------------------------------
    //  Cube map shader
     ------------------------------------------------------------------------- */
cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ep.cube_vert,fragmentShader:ep.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ep.equirect_vert,fragmentShader:ep.equirect_frag},distanceRGBA:{uniforms:Il.merge([tp.common,tp.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ep.distanceRGBA_vert,fragmentShader:ep.distanceRGBA_frag},shadow:{uniforms:Il.merge([tp.lights,tp.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ep.shadow_vert,fragmentShader:ep.shadow_frag}};
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLMorphtargets.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}np.physical={uniforms:Il.merge([np.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ep.meshphysical_vert,fragmentShader:ep.meshphysical_frag};var rp=0;function WebGLLights(){var e=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLLights.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function UniformsCache(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":n={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":n={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":n={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=n,n}}},t={id:rp++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new Vector3,r=new Matrix4,i=new Matrix4;return{setup:function setup(a,o,s){for(var l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=s.matrixWorldInverse,v=0,y=a.length;v<y;v++){var b=a[v],x=b.color,_=b.intensity,w=b.distance,M=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)l+=x.r*_,c+=x.g*_,u+=x.b*_;else if(b.isDirectionalLight){if((S=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),S.direction.setFromMatrixPosition(b.matrixWorld),n.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.shadow=b.castShadow,b.castShadow){var E=b.shadow;S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize}t.directionalShadowMap[h]=M,t.directionalShadowMatrix[h]=b.shadow.matrix,t.directional[h]=S,h++}else if(b.isSpotLight)(S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(x).multiplyScalar(_),S.distance=w,S.direction.setFromMatrixPosition(b.matrixWorld),n.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.coneCos=Math.cos(b.angle),S.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),S.decay=b.decay,S.shadow=b.castShadow,b.castShadow&&(E=b.shadow,S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize),t.spotShadowMap[p]=M,t.spotShadowMatrix[p]=b.shadow.matrix,t.spot[p]=S,p++;else if(b.isRectAreaLight)
// (a) intensity is the total visible light emitted
//uniforms.color.copy( color ).multiplyScalar( intensity / ( light.width * light.height * Math.PI ) );
// (b) intensity is the brightness of the light
(S=e.get(b)).color.copy(x).multiplyScalar(_),S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),
// extract local rotation of light to derive width/height half vectors
i.identity(),r.copy(b.matrixWorld),r.premultiply(g),i.extractRotation(r),S.halfWidth.set(.5*b.width,0,0),S.halfHeight.set(0,.5*b.height,0),S.halfWidth.applyMatrix4(i),S.halfHeight.applyMatrix4(i),
// TODO (abelnation): RectAreaLight distance?
// uniforms.distance = distance;
t.rectArea[f]=S,f++;else if(b.isPointLight)(S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(b.color).multiplyScalar(b.intensity),S.distance=b.distance,S.decay=b.decay,S.shadow=b.castShadow,b.castShadow&&(E=b.shadow,S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize,S.shadowCameraNear=E.camera.near,S.shadowCameraFar=E.camera.far),t.pointShadowMap[d]=M,t.pointShadowMatrix[d]=b.shadow.matrix,t.point[d]=S,d++;else if(b.isHemisphereLight){var S;(S=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(g),S.direction.normalize(),S.skyColor.copy(b.color).multiplyScalar(_),S.groundColor.copy(b.groundColor).multiplyScalar(_),t.hemi[m]=S,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=p,t.rectArea.length=f,t.point.length=d,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=d,t.hash.spotLength=p,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLRenderStates.js
/**
 * @author Mugen87 / https://github.com/Mugen87
 */function WebGLRenderState(){var e=new WebGLLights,t=[],n=[];return{init:function init(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function setupLights(r){e.setup(t,n,r)},pushLight:function pushLight(e){t.push(e)},pushShadow:function pushShadow(e){n.push(e)}}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/WebGLRenderTarget.js
/**
 * @author szimek / https://github.com/szimek/
 * @author alteredq / http://alteredqualia.com/
 * @author Marius Kintel / https://github.com/kintel
 */
/*
 In options, we can specify:
 * Texture parameters for an auto-generated target texture
 * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers
*/
function WebGLRenderTarget(e,t,n){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),void 0===(n=n||{}).minFilter&&(n.minFilter=_s),this.texture=new Texture(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.generateMipmaps=void 0===n.generateMipmaps||n.generateMipmaps,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}
// CONCATENATED MODULE: ./node_modules/three/src/materials/MeshDepthMaterial.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author bhouston / https://clara.io
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>
 * }
 */
function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=_l,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}
// CONCATENATED MODULE: ./node_modules/three/src/materials/MeshDistanceMaterial.js
/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * parameters = {
 *
 *  referencePosition: <float>,
 *  nearDistance: <float>,
 *  farDistance: <float>,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  displacementMap: new THREE.Texture( <Image> ),
 *  displacementScale: <float>,
 *  displacementBias: <float>
 *
 * }
 */
function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}
// CONCATENATED MODULE: ./node_modules/three/src/math/Plane.js
/**
 * @author bhouston / http://clara.io
 */
function Plane(e,t){
// normal is assumed to be normalized
this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}
// CONCATENATED MODULE: ./node_modules/three/src/math/Frustum.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author bhouston / http://clara.io
 */
function Frustum(e,t,n,r,i,a){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==n?n:new Plane,void 0!==r?r:new Plane,void 0!==i?i:new Plane,void 0!==a?a:new Plane]}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLTextures.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLTextures(e,t,n,r,i,a,o){var s,l={};
//
function clampToMaxSize(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");
// Warning: Scaling through the canvas will only work with images that use
// premultiplied alpha.
var n=t/Math.max(e.width,e.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=Math.floor(e.width*n),r.height=Math.floor(e.height*n),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height),r}return e}function isPowerOfTwo(e){return ir.isPowerOfTwo(e.width)&&ir.isPowerOfTwo(e.height)}function textureNeedsGenerateMipmaps(e,t){return e.generateMipmaps&&t&&e.minFilter!==ys&&e.minFilter!==_s}function generateMipmap(t,n,i,a){e.generateMipmap(t),
// Note: Math.log( x ) * Math.LOG2E used instead of Math.log2( x ) which is not supported by IE11
r.get(n).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function getInternalFormat(t,n){if(!i.isWebGL2)return t;if(t===e.RED){if(n===e.FLOAT)return e.R32F;if(n===e.HALF_FLOAT)return e.R16F;if(n===e.UNSIGNED_BYTE)return e.R8}if(t===e.RGB){if(n===e.FLOAT)return e.RGB32F;if(n===e.HALF_FLOAT)return e.RGB16F;if(n===e.UNSIGNED_BYTE)return e.RGB8}if(t===e.RGBA){if(n===e.FLOAT)return e.RGBA32F;if(n===e.HALF_FLOAT)return e.RGBA16F;if(n===e.UNSIGNED_BYTE)return e.RGBA8}return t}
// Fallback filters for non-power-of-2 textures
function filterFallback(t){return t===ys||t===bs||t===xs?e.NEAREST:e.LINEAR}
//
function onTextureDispose(t){var n=t.target;n.removeEventListener("dispose",onTextureDispose),
//
function deallocateTexture(t){var n=r.get(t);if(t.image&&n.__image__webglTextureCube)
// cube texture
e.deleteTexture(n.__image__webglTextureCube);else{
// 2D texture
if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture)}
// remove all webgl properties
r.remove(t)}(n),n.isVideoTexture&&delete l[n.id],o.memory.textures--}function onRenderTargetDispose(t){var n=t.target;n.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}
//
(n),o.memory.textures--}function setTexture2D(t,i){var a=r.get(t);if(t.isVideoTexture&&function updateVideoTexture(e){var t=e.id,n=o.render.frame;
// Check the last frame we updated the VideoTexture
l[t]!==n&&(l[t]=n,e.update())}(t),t.version>0&&a.__version!==t.version){var s=t.image;if(void 0===s)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==s.complete)return void uploadTexture(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function setTextureParameters(n,o,s){var l;if(s?(e.texParameteri(n,e.TEXTURE_WRAP_S,a.convert(o.wrapS)),e.texParameteri(n,e.TEXTURE_WRAP_T,a.convert(o.wrapT)),e.texParameteri(n,e.TEXTURE_MAG_FILTER,a.convert(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a.convert(o.minFilter))):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o.wrapS===gs&&o.wrapT===gs||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,filterFallback(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,filterFallback(o.minFilter)),o.minFilter!==ys&&o.minFilter!==_s&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(o.type===Ps&&null===t.get("OES_texture_float_linear"))return;if(o.type===Is&&null===(i.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function uploadTexture(t,r,l){var c;c=r.isDataTexture3D?e.TEXTURE_3D:e.TEXTURE_2D,void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",onTextureDispose),t.__webglTexture=e.createTexture(),o.memory.textures++),n.activeTexture(e.TEXTURE0+l),n.bindTexture(c,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var u=clampToMaxSize(r.image,i.maxTextureSize);(function textureNeedsPowerOfTwo(e){return!i.isWebGL2&&(e.wrapS!==gs||e.wrapT!==gs||e.minFilter!==ys&&e.minFilter!==_s)})(r)&&!1===isPowerOfTwo(u)&&(u=function makePowerOfTwo(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=ir.floorPowerOfTwo(e.width),s.height=ir.floorPowerOfTwo(e.height),s.getContext("2d").drawImage(e,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+s.width+"x"+s.height),s):e}(u));var h=isPowerOfTwo(u),d=a.convert(r.format),p=a.convert(r.type),f=getInternalFormat(d,p);setTextureParameters(c,r,h);var m,g=r.mipmaps;if(r.isDepthTexture){if(
// populate depth texture with dummy data
f=e.DEPTH_COMPONENT,r.type===Ps){if(!i.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");f=e.DEPTH_COMPONENT32F}else i.isWebGL2&&(
// WebGL 2.0 requires signed internalformat for glTexImage2D
f=e.DEPTH_COMPONENT16);r.format===zs&&f===e.DEPTH_COMPONENT&&r.type!==Ts&&r.type!==Cs&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ts,p=a.convert(r.type)),
// Depth stencil textures need the DEPTH_STENCIL internal format
// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
r.format===ks&&(f=e.DEPTH_STENCIL,
// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are
// DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.
// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
r.type!==Gs&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Gs,p=a.convert(r.type))),n.texImage2D(e.TEXTURE_2D,0,f,u.width,u.height,0,d,p,null)}else if(r.isDataTexture)
// use manually created mipmaps if available
// if there are no manual mipmaps
// set 0 level mipmap and then use GL to generate other mipmap levels
if(g.length>0&&h){for(var v=0,y=g.length;v<y;v++)m=g[v],n.texImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,d,p,m.data);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(e.TEXTURE_2D,0,f,u.width,u.height,0,d,p,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(v=0,y=g.length;v<y;v++)m=g[v],r.format!==Ns&&r.format!==Vs?n.getCompressedTextureFormats().indexOf(d)>-1?n.compressedTexImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,v,f,m.width,m.height,0,d,p,m.data);t.__maxMipLevel=g.length-1}else if(r.isDataTexture3D)n.texImage3D(e.TEXTURE_3D,0,f,u.width,u.height,u.depth,0,d,p,u.data),t.__maxMipLevel=0;else
// regular Texture (image, video, canvas)
// use manually created mipmaps if available
// if there are no manual mipmaps
// set 0 level mipmap and then use GL to generate other mipmap levels
if(g.length>0&&h){for(v=0,y=g.length;v<y;v++)m=g[v],n.texImage2D(e.TEXTURE_2D,v,f,d,p,m);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(e.TEXTURE_2D,0,f,d,p,u),t.__maxMipLevel=0;textureNeedsGenerateMipmaps(r,h)&&generateMipmap(e.TEXTURE_2D,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}
// Render targets
// Setup storage for target texture and bind it to correct framebuffer
function setupFrameBufferTexture(t,i,o,s){var l=a.convert(i.texture.format),c=a.convert(i.texture.type),u=getInternalFormat(l,c);n.texImage2D(s,0,u,i.width,i.height,0,l,c,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}
// Setup storage for internal depth/stencil buffers and bind to correct framebuffer
function setupRenderBufferStorage(t,n){e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):n.depthBuffer&&n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):
// FIXME: We don't support !depth !stencil
e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,n.width,n.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}
// Setup resources for a Depth Texture for a FBO (needs an extension)
// Setup GL resources for a non-texture depth buffer
function setupDepthRenderbuffer(t){var n=r.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");
// upload an empty depth texture with framebuffer size
r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),setTexture2D(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===zs)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(n.depthTexture.format!==ks)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),setupRenderBufferStorage(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),setupRenderBufferStorage(n.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}
// Set up GL resources for the render target
this.setTexture2D=setTexture2D,this.setTexture3D=function setTexture3D(t,i){var a=r.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_3D,a.__webglTexture))},this.setTextureCube=function setTextureCube(t,s){var l=r.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",onTextureDispose),l.__image__webglTextureCube=e.createTexture(),o.memory.textures++),n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var c=t&&t.isCompressedTexture,u=t.image[0]&&t.image[0].isDataTexture,h=[],d=0;d<6;d++)h[d]=c||u?u?t.image[d].image:t.image[d]:clampToMaxSize(t.image[d],i.maxCubemapSize);var p=h[0],f=isPowerOfTwo(p),m=a.convert(t.format),g=a.convert(t.type),v=getInternalFormat(m,g);for(setTextureParameters(e.TEXTURE_CUBE_MAP,t,f),d=0;d<6;d++)if(c)for(var y,b=h[d].mipmaps,x=0,_=b.length;x<_;x++)y=b[x],t.format!==Ns&&t.format!==Vs?n.getCompressedTextureFormats().indexOf(m)>-1?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,x,v,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,x,v,y.width,y.height,0,m,g,y.data);else u?n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,v,h[d].width,h[d].height,0,m,g,h[d].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,v,m,g,h[d]);l.__maxMipLevel=c?b.length-1:0,textureNeedsGenerateMipmaps(t,f)&&
// We assume images for cube map have the same size.
generateMipmap(e.TEXTURE_CUBE_MAP,t,p.width,p.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function setTextureCubeDynamic(t,i){n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function setupRenderTarget(t){var i=r.get(t),a=r.get(t.texture);t.addEventListener("dispose",onRenderTargetDispose),a.__webglTexture=e.createTexture(),o.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,l=isPowerOfTwo(t);
// Setup framebuffer
if(s){i.__webglFramebuffer=[];for(var c=0;c<6;c++)i.__webglFramebuffer[c]=e.createFramebuffer()}else i.__webglFramebuffer=e.createFramebuffer();
// Setup color buffer
if(s){for(n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture),setTextureParameters(e.TEXTURE_CUBE_MAP,t.texture,l),c=0;c<6;c++)setupFrameBufferTexture(i.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c);textureNeedsGenerateMipmaps(t.texture,l)&&generateMipmap(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else n.bindTexture(e.TEXTURE_2D,a.__webglTexture),setTextureParameters(e.TEXTURE_2D,t.texture,l),setupFrameBufferTexture(i.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),textureNeedsGenerateMipmaps(t.texture,l)&&generateMipmap(e.TEXTURE_2D,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null);
// Setup depth and stencil buffers
t.depthBuffer&&setupDepthRenderbuffer(t)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){var i=t.texture;if(textureNeedsGenerateMipmaps(i,isPowerOfTwo(t))){var a=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=r.get(i).__webglTexture;n.bindTexture(a,o),generateMipmap(a,i,t.width,t.height),n.bindTexture(a,null)}}}
// CONCATENATED MODULE: ./node_modules/three/src/textures/CubeTexture.js
/**
 * @author mrdoob / http://mrdoob.com/
 */function CubeTexture(e,t,n,r,i,a,o,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:ls,Texture.call(this,e,t,n,r,i,a,o,s,l,c),this.flipY=!1}
// CONCATENATED MODULE: ./node_modules/three/src/textures/DataTexture3D.js
/**
 * @author Artur Trzesiok
 */
function DataTexture3D(e,t,n,r){
// We're going to add .setXXX() methods for setting properties later.
// Users can still set in DataTexture3D directly.
//
//  var texture = new THREE.DataTexture3D( data, width, height, depth );
//  texture.anisotropy = 16;
//
// See #14839
Texture.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=ys,this.minFilter=ys,this.generateMipmaps=!1,this.flipY=!1}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher_EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Object.assign(Plane.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Vector3,t=new Vector3;return function setFromCoplanarPoints(n,r,i){var a=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();
// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?
return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){
// Note: will lead to a divide by zero if the plane is invalid.
var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Vector3;return function intersectLine(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new Vector3);var r=t.delta(e),i=this.normal.dot(r);if(0===i)
// line is coplanar, return origin
return 0===this.distanceToPoint(t.start)?n.copy(t.start):
// Unsure if this is the correct method to handle this case.
void 0;var a=-(t.start.dot(this.normal)+this.constant)/i;return a<0||a>1?void 0:n.copy(r).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){
// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.
var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Vector3,t=new Matrix3;return function applyMatrix4(n,r){var i=r||t.getNormalMatrix(n),a=this.coplanarPoint(e).applyMatrix4(n),o=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Frustum.prototype,{set:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-r,u-s,f-h,y-m).normalize(),t[1].setComponents(o+r,u+s,f+h,y+m).normalize(),t[2].setComponents(o+i,u+l,f+d,y+g).normalize(),t[3].setComponents(o-i,u-l,f-d,y-g).normalize(),t[4].setComponents(o-a,u-c,f-p,y-v).normalize(),t[5].setComponents(o+a,u+c,f+p,y+v).normalize(),this},intersectsObject:function(){var e=new Sphere;return function intersectsObject(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Sphere;return function intersectsSprite(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){for(var n=this.planes,r=0;r<6;r++){var i=n[r];
// corner at max distance
if(e.x=i.normal.x>0?t.max.x:t.min.x,e.y=i.normal.y>0?t.max.y:t.min.y,e.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(e)<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}),CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLUniforms.js
/**
 * @author tschw
 * @author Mugen87 / https://github.com/Mugen87
 * @author mrdoob / http://mrdoob.com/
 *
 * Uniforms of a program.
 * Those form a tree structure with a special top-level container for the root,
 * which you get by calling 'new WebGLUniforms( gl, program, renderer )'.
 *
 *
 * Properties of inner nodes including the top-level container:
 *
 * .seq - array of nested uniforms
 * .map - nested uniforms by name
 *
 *
 * Methods of all nodes except the top-level container:
 *
 * .setValue( gl, value, [renderer] )
 *
 *      uploads a uniform value(s)
 *      the 'renderer' parameter is needed for sampler uniforms
 *
 *
 * Static methods of the top-level container (renderer factorizations):
 *
 * .upload( gl, seq, values, renderer )
 *
 *      sets uniforms in 'seq' to 'values[id].value'
 *
 * .seqWithValue( seq, values ) : filteredSeq
 *
 *      filters 'seq' entries with corresponding entry in values
 *
 *
 * Methods of the top-level container (renderer factorizations):
 *
 * .setValue( gl, name, value )
 *
 *      sets uniform with  name 'name' to 'value'
 *
 * .set( gl, obj, prop )
 *
 *      sets uniform from object and property with same name than uniform
 *
 * .setOptional( gl, obj, prop )
 *
 *      like .set for an optional property of the object
 *
 */
var ip=new Texture,ap=new DataTexture3D,op=new CubeTexture;
// --- Base for inner nodes (including the root) ---
function UniformContainer(){this.seq=[],this.map={}}
// --- Utilities ---
// Array Caches (provide typed arrays for temporary by size)
var sp=[],lp=[],cp=new Float32Array(16),up=new Float32Array(9),hp=new Float32Array(4);
// Flattening for arrays of vectors and matrices
function flatten(e,t,n){var r=e[0];if(r<=0||r>0)return e;
// unoptimized: ! isNaN( firstElem )
// see http://jacksondunstan.com/articles/983
var i=t*n,a=sp[i];if(void 0===a&&(a=new Float32Array(i),sp[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function copyArray(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}
// Texture unit allocation
function allocTexUnits(e,t){var n=lp[t];void 0===n&&(n=new Int32Array(t),lp[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocTextureUnit();return n}
// --- Setters ---
// Note: Defining these methods externally, because they come in a bunch
// and this way their names minify.
// Single scalar
function setValue1f(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function setValue1i(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}
// Single float vector (from flat array or THREE.VectorN)
function setValue2fv(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(arraysEqual(n,t))return;e.uniform2fv(this.addr,t),copyArray(n,t)}}function setValue3fv(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(arraysEqual(n,t))return;e.uniform3fv(this.addr,t),copyArray(n,t)}}function setValue4fv(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(arraysEqual(n,t))return;e.uniform4fv(this.addr,t),copyArray(n,t)}}
// Single matrix (from flat array or MatrixN)
function setValue2fm(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(n,t)}else{if(arraysEqual(n,r))return;hp.set(r),e.uniformMatrix2fv(this.addr,!1,hp),copyArray(n,r)}}function setValue3fm(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(n,t)}else{if(arraysEqual(n,r))return;up.set(r),e.uniformMatrix3fv(this.addr,!1,up),copyArray(n,r)}}function setValue4fm(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(n,t)}else{if(arraysEqual(n,r))return;cp.set(r),e.uniformMatrix4fv(this.addr,!1,cp),copyArray(n,r)}}
// Single texture (2D / Cube)
function setValueT1(e,t,n){var r=this.cache,i=n.allocTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||ip,i)}function setValueT3D1(e,t,n){var r=this.cache,i=n.allocTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ap,i)}function setValueT6(e,t,n){var r=this.cache,i=n.allocTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||op,i)}
// Integer / Boolean vectors or arrays thereof (always flat arrays)
function setValue2iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform2iv(this.addr,t),copyArray(n,t))}function setValue3iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform3iv(this.addr,t),copyArray(n,t))}function setValue4iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform4iv(this.addr,t),copyArray(n,t))}
// Helper to pick the right setter for the singular case
// Array of scalars
function setValue1fv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform1fv(this.addr,t),copyArray(n,t))}function setValue1iv(e,t){var n=this.cache;arraysEqual(n,t)||(e.uniform1iv(this.addr,t),copyArray(n,t))}
// Array of vectors (flat or from THREE classes)
function setValueV2a(e,t){var n=this.cache,r=flatten(t,this.size,2);arraysEqual(n,r)||(e.uniform2fv(this.addr,r),this.updateCache(r))}function setValueV3a(e,t){var n=this.cache,r=flatten(t,this.size,3);arraysEqual(n,r)||(e.uniform3fv(this.addr,r),this.updateCache(r))}function setValueV4a(e,t){var n=this.cache,r=flatten(t,this.size,4);arraysEqual(n,r)||(e.uniform4fv(this.addr,r),this.updateCache(r))}
// Array of matrices (flat or from THREE clases)
function setValueM2a(e,t){var n=this.cache,r=flatten(t,this.size,4);arraysEqual(n,r)||(e.uniformMatrix2fv(this.addr,!1,r),this.updateCache(r))}function setValueM3a(e,t){var n=this.cache,r=flatten(t,this.size,9);arraysEqual(n,r)||(e.uniformMatrix3fv(this.addr,!1,r),this.updateCache(r))}function setValueM4a(e,t){var n=this.cache,r=flatten(t,this.size,16);arraysEqual(n,r)||(e.uniformMatrix4fv(this.addr,!1,r),this.updateCache(r))}
// Array of textures (2D / Cube)
function setValueT1a(e,t,n){var r=this.cache,i=t.length,a=allocTexUnits(n,i);!1===arraysEqual(r,a)&&(e.uniform1iv(this.addr,a),copyArray(r,a));for(var o=0;o!==i;++o)n.setTexture2D(t[o]||ip,a[o])}function setValueT6a(e,t,n){var r=this.cache,i=t.length,a=allocTexUnits(n,i);!1===arraysEqual(r,a)&&(e.uniform1iv(this.addr,a),copyArray(r,a));for(var o=0;o!==i;++o)n.setTextureCube(t[o]||op,a[o])}
// Helper to pick the right setter for a pure (bottom-level) array
// --- Uniform Classes ---
function SingleUniform(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function getSingularSetter(e){switch(e){case 5126:return setValue1f;// FLOAT
case 35664:return setValue2fv;// _VEC2
case 35665:return setValue3fv;// _VEC3
case 35666:return setValue4fv;// _VEC4
case 35674:return setValue2fm;// _MAT2
case 35675:return setValue3fm;// _MAT3
case 35676:return setValue4fm;// _MAT4
case 35678:case 36198:return setValueT1;// SAMPLER_2D, SAMPLER_EXTERNAL_OES
case 35679:return setValueT3D1;// SAMPLER_3D
case 35680:return setValueT6;// SAMPLER_CUBE
case 5124:case 35670:return setValue1i;// INT, BOOL
case 35667:case 35671:return setValue2iv;// _VEC2
case 35668:case 35672:return setValue3iv;// _VEC3
case 35669:case 35673:return setValue4iv;// _VEC4
}}(t.type)}function PureArrayUniform(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function getPureArraySetter(e){switch(e){case 5126:return setValue1fv;// FLOAT
case 35664:return setValueV2a;// _VEC2
case 35665:return setValueV3a;// _VEC3
case 35666:return setValueV4a;// _VEC4
case 35674:return setValueM2a;// _MAT2
case 35675:return setValueM3a;// _MAT3
case 35676:return setValueM4a;// _MAT4
case 35678:return setValueT1a;// SAMPLER_2D
case 35680:return setValueT6a;// SAMPLER_CUBE
case 5124:case 35670:return setValue1iv;// INT, BOOL
case 35667:case 35671:return setValue2iv;// _VEC2
case 35668:case 35672:return setValue3iv;// _VEC3
case 35669:case 35673:return setValue4iv;// _VEC4
}}(t.type)}function StructuredUniform(e){this.id=e,UniformContainer.call(this)}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};
// --- Top-level ---
// Parser - builds up the property tree from the path strings
var dp=/([\w\d_]+)(\])?(\[|\.)?/g;
// extracts
//  - the identifier (member name or array index)
//  - followed by an optional right bracket (found when array index)
//  - followed by an optional left bracket or dot (type of subscript)
//
// Note: These portions can be read in a non-overlapping fashion and
// allow straightforward parsing of the hierarchy that WebGL encodes
// in the uniform names.
function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,n){var r=e.name,i=r.length;
// reset RegExp object, because of the early exit of a previous run
for(dp.lastIndex=0;;){var a=dp.exec(r),o=dp.lastIndex,s=a[1],l="]"===a[2],c=a[3];// convert to integer
if(l&&(s|=0),void 0===c||"["===c&&o+2===i){
// bare name or "pure" bottom-level array "[0]" suffix
addUniform(n,void 0===c?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}
// step into inner node / create it in case it doesn't exist
var u=n.map[s];void 0===u&&addUniform(n,u=new StructuredUniform(s)),n=u}}
// Root Container
function WebGLUniforms(e,t,n){UniformContainer.call(this),this.renderer=n;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;++i){var a=e.getActiveUniform(t,i);parseUniform(a,e.getUniformLocation(t,a.name),this)}}
// CONCATENATED MODULE: ./node_modules/three/src/objects/Group.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function Group_Group(){Object3D.call(this),this.type="Group"}
// CONCATENATED MODULE: ./node_modules/three/src/cameras/Camera.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 * @author WestLangley / http://github.com/WestLangley
*/
function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}
// CONCATENATED MODULE: ./node_modules/three/src/cameras/PerspectiveCamera.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author greggman / http://games.greggman.com/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author tschw
 */
function PerspectiveCamera(e,t,n,r){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,// width of the film (default in millimeters)
this.filmOffset=0,// horizontal film offset (same unit as gauge)
this.updateProjectionMatrix()}
// CONCATENATED MODULE: ./node_modules/three/src/cameras/ArrayCamera.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webvr/WebVRManager.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebVRManager(e){var t=this,n=null,r=null,i=null,a=[],o=new Matrix4,s=new Matrix4,l="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",onVRDisplayPresentChange,!1));var c=new Matrix4,u=new Quaternion,h=new Vector3,d=new PerspectiveCamera;d.bounds=new Vector4(0,0,.5,1),d.layers.enable(1);var p=new PerspectiveCamera;p.bounds=new Vector4(.5,0,.5,1),p.layers.enable(2);var f,m,g=new ArrayCamera([d,p]);
//
function isPresenting(){return null!==n&&!0===n.isPresenting}function onVRDisplayPresentChange(){if(isPresenting()){var r=n.getEyeParameters("left"),i=r.renderWidth,a=r.renderHeight;m=e.getPixelRatio(),f=e.getSize(),e.setDrawingBufferSize(2*i,a,1),y.start()}else t.enabled&&e.setDrawingBufferSize(f.width,f.height,m),y.stop()}
//
g.layers.enable(1),g.layers.enable(2);var v=[];function findGamepad(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),n=0,r=0,i=t.length;n<i;n++){var a=t[n];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(r===e)return a;r++}}}
//
this.enabled=!1,this.getController=function(e){var t=a[e];return void 0===t&&((t=new Group_Group).matrixAutoUpdate=!1,t.visible=!1,a[e]=t),t},this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e),y.setContext(e)},this.setFrameOfReferenceType=function(e){l=e},this.setPoseTarget=function(e){void 0!==e&&(i=e)},this.getCamera=function(e){var t="stage"===l?1.6:0;if(null===n)return e.position.set(0,t,0),e;
//
if(n.depthNear=e.near,n.depthFar=e.far,n.getFrameData(r),"stage"===l){var f=n.stageParameters;f?o.fromArray(f.sittingToStandingTransform):o.makeTranslation(0,t,0)}var m=r.pose,y=null!==i?i:e;if(
// We want to manipulate poseObject by its position and quaternion components since users may rely on them.
y.matrix.copy(o),y.matrix.decompose(y.position,y.quaternion,y.scale),null!==m.orientation&&(u.fromArray(m.orientation),y.quaternion.multiply(u)),null!==m.position&&(u.setFromRotationMatrix(o),h.fromArray(m.position),h.applyQuaternion(u),y.position.add(h)),y.updateMatrixWorld(),!1===n.isPresenting)return e;
//
d.near=e.near,p.near=e.near,d.far=e.far,p.far=e.far,g.matrixWorld.copy(e.matrixWorld),g.matrixWorldInverse.copy(e.matrixWorldInverse),d.matrixWorldInverse.fromArray(r.leftViewMatrix),p.matrixWorldInverse.fromArray(r.rightViewMatrix),
// TODO (mrdoob) Double check this code
s.getInverse(o),"stage"===l&&(d.matrixWorldInverse.multiply(s),p.matrixWorldInverse.multiply(s));var b=y.parent;null!==b&&(c.getInverse(b.matrixWorld),d.matrixWorldInverse.multiply(c),p.matrixWorldInverse.multiply(c)),
// envMap and Mirror needs camera.matrixWorld
d.matrixWorld.getInverse(d.matrixWorldInverse),p.matrixWorld.getInverse(p.matrixWorldInverse),d.projectionMatrix.fromArray(r.leftProjectionMatrix),p.projectionMatrix.fromArray(r.rightProjectionMatrix),
// HACK (mrdoob)
// https://github.com/w3c/webvr/issues/203
g.projectionMatrix.copy(d.projectionMatrix);
//
var x=n.getLayers();if(x.length){var _=x[0];null!==_.leftBounds&&4===_.leftBounds.length&&d.bounds.fromArray(_.leftBounds),null!==_.rightBounds&&4===_.rightBounds.length&&p.bounds.fromArray(_.rightBounds)}return function updateControllers(){for(var e=0;e<a.length;e++){var t=a[e],n=findGamepad(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;
//  Pose
var r=n.pose;!1===r.hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(o),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;
//  Trigger
var i="Daydream Controller"===n.id?0:1;v[e]!==n.buttons[i].pressed&&(v[e]=n.buttons[i].pressed,!0===v[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return o},this.isPresenting=isPresenting;
// Animation Loop
var y=new WebGLAnimation;this.setAnimationLoop=function(e){y.setAnimationLoop(e)},this.submitFrame=function(){isPresenting()&&n.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",onVRDisplayPresentChange)}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webvr/WebXRManager.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLAttributes.js
/**@preserve
 * @author mrdoob / http://mrdoob.com/
 * @author Rob Hofford / https://www.siemens.com/plm
 *
 * Change Log:
 * 2018-09-04   Rob Hofford Updated the following methods: createBuffer, update, updateBuffer
 *              Switched console messages to use string table.
 * 2019-01-15   Rob Hofford     Removed dead code.
 */
function WebGLAttributes(e){var t=new WeakMap;function createBuffer(t,n){
//var array = attribute.array;
var r=t.data?t.data.array:t.array,i=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,r,i),t.onUploadCallback();var o=e.FLOAT;return r instanceof Float32Array?o=e.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=e.UNSIGNED_SHORT:r instanceof Int16Array?o=e.SHORT:r instanceof Uint32Array?o=e.UNSIGNED_INT:r instanceof Int32Array?o=e.INT:r instanceof Int8Array?o=e.BYTE:r instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,bufferSize:r.length}}function remove(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))}return{get:
//
function get(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:remove,update:function update(n,r){n.isInterleavedBufferAttribute&&(n=n.data);var a=t.get(n);void 0===a?t.set(n,createBuffer(n,r)):a.version<n.version&&(
//updateBuffer( data, attribute, bufferType );
a.bufferSize!==n.array.length?(
// delete webgl buffer.
// TODO: [perf] use pooled buffer or over-dimension the buffer
// to avoid creating and deleting buffers too frequently.
remove(n),//remove from map and delete the buffer
t.set(n,createBuffer(n,r))):function updateBuffer(t,n,r){var a=n.array,o=n.updateRange;e.bindBuffer(r,t),!1===n.dynamic?e.bufferData(r,a,e.STATIC_DRAW):-1===o.count?
// Not using update ranges
e.bufferSubData(r,0,a):0===o.count?console.error(i.b.stringsByLabel.THREEEXTENSIONS_CONSOLE_err_updateBuffer):(e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),t.version=n.version}(a.buffer,n,r),a.version=n.version)}}}
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLClipping.js
/**@preserve
 * @author tschw
 * @author Rob Hofford / https://www.siemens.com/plm
 *
 * Change Log:
 * 2018-09-04   Rob Hofford     Updated several methods with our r76 override terms.
 */
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLRenderLists.js
/**
 * @author mrdoob / http://mrdoob.com/
 * @author Rob Hofford / https://www.siemens.com/plm
 *
 * Change Log:
 * 2018-09-05   Rob Hofford         Updated reversePainterSortStable using terms from our r76 overload.
 * 2019-06-25   Jesse Perlstein     Clear renderItems array during init call.
 */
function painterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}function WebGLRenderLists(){var e={};return{get:function get(t,n){var r=t.id+","+n.id,i=e[r];return void 0===i&&(
// console.log( 'THREE.WebGLRenderLists:', hash );
i=new function WebGLRenderList(){var e=[],t=0,n=[],r=[];return{opaque:n,transparent:r,init:function init(){e=[],t=0,n.length=0,r.length=0},push:function push(i,a,o,s,l,c){var u=e[t];void 0===u?(u={id:i.id,object:i,geometry:a,material:o,program:o.program,renderOrder:c,z:s,group:l},e[t]=u):(u.id=i.id,u.object=i,u.geometry=a,u.material=o,u.program=o.program,u.renderOrder=c,u.z=s,u.group=l),(!0===o.transparent?r:n).push(u),t++},sort:function sort(){n.length>1&&n.sort(painterSortStable),r.length>1&&r.sort(reversePainterSortStable)}}},e[r]=i),i},dispose:function dispose(){e={}}}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLShader.js
/**
 * @author mrdoob / http://mrdoob.com/
 */function WebGLShader(e,t,n){var r=e.createShader(t);
// --enable-privileged-webgl-extension
// console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );
return e.shaderSource(r,n),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),function addLineNumbers(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n)),r}
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLProgram.js
/**@preserve
 * @author mrdoob / http://mrdoob.com/
 * @author Rob Hofford
 *
 * Change Log:
 * 2018-09-05   Rob Hofford     Changed location of ShaderChunk import.
 */WebGLUniforms.prototype.setValue=function(e,t,n){var r=this.map[t];void 0!==r&&r.setValue(e,n,this.renderer)},WebGLUniforms.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},
// Static interface
WebGLUniforms.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&
// note: always updating when .needsUpdate is undefined
o.setValue(e,s.value,r)}},WebGLUniforms.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n},Group_Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group_Group,isGroup:!0}),Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},
/**
     * Sets the FOV by focal length in respect to the current .filmGauge.
     *
     * The default film gauge is 35, so that the focal length can be specified for
     * a 35mm (full frame) camera.
     *
     * Values for focal length and film gauge must have the same unit.
     */
setFocalLength:function(e){
// see http://www.bobatkins.com/photography/technical/field_of_view.html
var t=.5*this.getFilmHeight()/e;this.fov=2*ir.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},
/**
     * Calculates the focal length from the current .fov and .filmGauge.
     */
getFocalLength:function(){var e=Math.tan(.5*ir.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*ir.RAD2DEG*Math.atan(Math.tan(.5*ir.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){
// film not completely covered in portrait format (aspect < 1)
return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){
// film not completely covered in landscape format (aspect > 1)
return this.filmGauge/Math.max(this.aspect,1)},
/**
     * Sets an offset in a larger frustum. This is useful for multi-window or
     * multi-monitor/multi-machine setups.
     *
     * For example, if you have 3x2 monitors and each monitor is 1920x1080 and
     * the monitors are in grid like this
     *
     *   +---+---+---+
     *   | A | B | C |
     *   +---+---+---+
     *   | D | E | F |
     *   +---+---+---+
     *
     * then for each monitor you would call it like this
     *
     *   var w = 1920;
     *   var h = 1080;
     *   var fullWidth = w * 3;
     *   var fullHeight = h * 2;
     *
     *   --A--
     *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );
     *   --B--
     *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );
     *   --C--
     *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );
     *   --D--
     *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );
     *   --E--
     *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );
     *   --F--
     *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );
     *
     *   Note there is no reason monitors have to be the same size or in a grid.
     */
setViewOffset:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*ir.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0});var pp=0;function getEncodingComponents(e){switch(e){case fl:return["Linear","( value )"];case ml:return["sRGB","( value )"];case vl:return["RGBE","( value )"];case yl:return["RGBM","( value, 7.0 )"];case bl:return["RGBM","( value, 16.0 )"];case xl:return["RGBD","( value, 256.0 )"];case gl:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function getTexelDecodingFunction(e,t){var n=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function parseIncludes(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function replace(e,t){var n=He.b[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return parseIncludes(n)})}function unrollLoops(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function replace(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[ i \]/g,"[ "+a+" ]");return i})}function WebGLProgram(e,t,n,r,i,a,o){var s=e.context,l=r.defines,c=i.vertexShader,u=i.fragmentShader,h="SHADOWMAP_TYPE_BASIC";a.shadowMapType===yo?h="SHADOWMAP_TYPE_PCF":a.shadowMapType===bo&&(h="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(r.envMap.mapping){case ls:case cs:d="ENVMAP_TYPE_CUBE";break;case ps:case fs:d="ENVMAP_TYPE_CUBE_UV";break;case us:case hs:d="ENVMAP_TYPE_EQUIREC";break;case ds:d="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case cs:case hs:p="ENVMAP_MODE_REFRACTION"}switch(r.combine){case es:f="ENVMAP_BLENDING_MULTIPLY";break;case ts:f="ENVMAP_BLENDING_MIX";break;case ns:f="ENVMAP_BLENDING_ADD"}}var m,g,v=e.gammaFactor>0?e.gammaFactor:1,y=o.isWebGL2?"":function generateExtensions(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(r.extensions,a,t),b=function generateDefines(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(l),x=s.createProgram();
// console.log( 'building new program ' );
//
if(r.isRawShaderMaterial?((m=[b].filter(filterEmptyLine).join("\n")).length>0&&(m+="\n"),(g=[y,b].filter(filterEmptyLine).join("\n")).length>0&&(g+="\n")):(m=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,b,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),g=[y,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,b,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"",// add '.0' if integer
"#define GAMMA_FACTOR "+v,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+p:"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==rs?"#define TONE_MAPPING":"",a.toneMapping!==rs?He.b.tonemapping_pars_fragment:"",// this code is required here because it is used by the toneMapping() function defined below
a.toneMapping!==rs?function getToneMappingFunction(e,t){var n;switch(t){case is:n="Linear";break;case as:n="Reinhard";break;case os:n="Uncharted2";break;case ss:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?He.b.encodings_pars_fragment:"",// this code is required here because it is used by the various encoding/decoding function defined below
a.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?function getTexelEncodingFunction(e,t){var n=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),c=replaceClippingPlaneNums(c=replaceLightNums(c=parseIncludes(c),a),a),u=replaceClippingPlaneNums(u=replaceLightNums(u=parseIncludes(u),a),a),c=unrollLoops(c),u=unrollLoops(u),o.isWebGL2&&!r.isRawShaderMaterial){var _=!1,w=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==c.match(w)&&null!==u.match(w)&&(_=!0,c=c.replace(w,""),u=u.replace(w,"")),
// GLSL 3.0 conversion
m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#version 300 es\n","#define varying in",_?"":"out highp vec4 pc_fragColor;",_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g}var M=m+c,E=g+u,S=WebGLShader(s,s.VERTEX_SHADER,M),L=WebGLShader(s,s.FRAGMENT_SHADER,E);s.attachShader(x,S),s.attachShader(x,L),
// Force a particular attribute to index 0.
void 0!==r.index0AttributeName?s.bindAttribLocation(x,0,r.index0AttributeName):!0===a.morphTargets&&
// programs with morphTargets displace position out of attribute 0
s.bindAttribLocation(x,0,"position"),s.linkProgram(x);var T,A,C=s.getProgramInfoLog(x).trim(),P=s.getShaderInfoLog(S).trim(),I=s.getShaderInfoLog(L).trim(),O=!0,B=!0;
// console.log( '**VERTEX**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );
// console.log( '**FRAGMENT**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );
return!1===s.getProgramParameter(x,s.LINK_STATUS)?(O=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(x,s.VALIDATE_STATUS),"gl.getProgramInfoLog",C,P,I)):""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==P&&""!==I||(B=!1),B&&(this.diagnostics={runnable:O,material:r,programLog:C,vertexShader:{log:P,prefix:m},fragmentShader:{log:I,prefix:g}}),
// clean up
s.deleteShader(S),s.deleteShader(L),this.getUniforms=function(){return void 0===T&&(T=new WebGLUniforms(s,x,e)),T},this.getAttributes=function(){return void 0===A&&(A=function fetchAttributeLocations(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var a=e.getActiveAttrib(t,i).name;
// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );
n[a]=e.getAttribLocation(t,a)}return n}(s,x)),A},
// free resource
this.destroy=function(){s.deleteProgram(x),this.program=void 0},
// DEPRECATED
Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),
//
this.name=i.name,this.id=pp++,this.code=n,this.usedTimes=1,this.program=x,this.vertexShader=S,this.fragmentShader=L,this}
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLPrograms.js
/**@preserve
 * @author mrdoob / http://mrdoob.com/
 * @author Rob Hofford / https://www.siemens.com/plm
 *
 * Change Log:
 * 2018-09-05   Rob Hofford     Changed import location of the imports, and to use the WebGLProgram.js override.
 */function WebGLPrograms(e,t,n){var r=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function getTextureEncodingFromMap(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=fl,
// add backwards compatibility for WebGLRenderer.gammaInput/gammaOutput parameter, should probably be removed at some point.
n===fl&&t&&(n=gl),n}this.getParameters=function(t,r,a,o,s,l,c){var u=i[t.type],h=c.isSkinnedMesh?function allocateBones(e){var t=e.skeleton.bones;if(n.floatVertexTextures)return 1024;
// default for when object is not specified
// ( for example when prebuilding shader to be used with multiple objects )
//
//  - leave some extra space for other uniforms
//  - limit here is ANGLE's 254 max uniform vectors
//    (up to 54 should be safe)
var r=n.maxVertexUniforms,i=Math.floor((r-20)/4),a=Math.min(i,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(c):0,d=n.precision;
// heuristics to create shader parameters according to lights in the scene
// (not to blow over maxLights budget)
null!==t.precision&&(d=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",d,"instead.");var p=e.getRenderTarget();return{shaderID:u,precision:d,supportsVertexTextures:n.vertexTextures,outputEncoding:getTextureEncodingFromMap(p?p.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:getTextureEncodingFromMap(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===ps||t.envMap.mapping===fs),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===Ml,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!o,useFog:t.fog,fogExp:o&&o.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:t.skinning&&h>0,maxBones:h,useVertexTexture:n.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:s,numClipIntersection:l,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===wo,flipSided:t.side===_o,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)r.push(i),r.push(t.defines[i]);for(var o=0;o<a.length;o++)r.push(n[a[o]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.join()},this.acquireProgram=function(i,a,o,s){
// Check if code has been already compiled
for(var l,c=0,u=r.length;c<u;c++){var h=r[c];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new WebGLProgram(e,t,s,i,a,o,n),r.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){
// Remove from unordered set
var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),
// Free WebGL resources
e.destroy()}},
// Exposed for resource monitoring & error feedback via renderer.info:
this.programs=r}
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLRenderer.js
/**@preserve
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 * @author tschw
 * @author Marco Zhou / http://www.plm.automation.siemens.com/
 * @author Rob Hofford / https://www.siemens.com/plm
 * @author Mark Doud   / https://www.siemens.com/plm
 * @author Anthony Scharf    / https://www.siemens.com/plm
 *
 * Change Log:
 * 2018-09-05   Rob Hofford         Updated several methods using terms from our r76 overload.
 *                                  Changed imports to pull in override modules.
 * 2018-09-26   Mark Doud           Fixed undefined variable in strict mode.
 * 2019-01-10   Anthony Scharf      Remove console log statement
 * 2019-01-10   Jesse Perlstein     Update object type check in project object.
 * 2019-01-10   Jesse Perlstein     Project object checks for multiple edge shapes on parts now for rebuild draw groups.
 * 2019-02-18   Jesse Perlstein     All part meshes now render as instances.
 * 2019-02-25   Jesse Perlstein     Slight refactor of projectObject.
 * 2019-04-12   Jesse Perlstein     Update for XT check to rebuildDrawGroups in project object.
 * 2019-04-15   Rob Hofford         Only recompile the program if necessary (initMaterial).
 * 2019-04-12   Jesse Perlstein     Re-structure logic checking when to call rebuildDrawGroups.
 * 2019-05-17   Jesse Perlstein     Refactor projectObject to handle rebuildDrawGroups now being a method of the geometry.
 **/
// three.js exports
// three.js doesn't export these...
// overloads:
// export uses a different name:
// plmvisweb
function WebGLRenderer(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,a=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",h=null,d=null;
// public properties
this.domElement=t,this.context=null,
// clearing
this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,
// scene graph
this.sortObjects=!0,
// user-defined clipping
this.clippingPlanes=[],this.localClippingEnabled=!1,
// physically based shading
this.gammaFactor=2,// for backwards compatibility
this.gammaInput=!1,this.gammaOutput=!1,
// physical lights
this.physicallyCorrectLights=!1,
// tone mapping
this.toneMapping=_.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,
// morphs
this.maxMorphTargets=8,this.maxMorphNormals=4,this.materialSide=_.FrontSide,this.renderMode=m.g.Shaded,this.renderModeNeedsUpdate=!1,this.pixelTolerance=1;
// internal properties
var p,f,g,v,y,b,x,w,M,E,S,L,T,A,C,P,I,O,B=this,R=!1,
// internal state cache
G=null,D=null,V=null,N=-1,
// geometry and program caching
U={geometry:null,program:null,wireframe:!1},F=null,z=null,k=new _.Vector4,j=new _.Vector4,H=null,
//
W=0,
//
X=t.width,q=t.height,Y=1,Z=new _.Vector4(0,0,X,q),J=new _.Vector4(0,0,X,q),Q=!1,
// frustum
K=new _.Frustum,
// clipping
$=new function WebGLClipping(){var e=this,t=null,n=0,r=!1,i=!1,a=new _.Plane,o=new _.Matrix3,s={value:null,needsUpdate:!1},l={type:"fv",value:null,needsUpdate:!1};function resetGlobalState(){
//if ( uniform.value !== globalState ) {
//
//  uniform.value = globalState;
//  uniform.needsUpdate = numGlobalPlanes > 0;
//
//}
t?(s.value!==t.clippingPlanes&&(s.value=t.clippingPlanes),l.value!==t.clippingSides&&(l.value=t.clippingSides)):(// +++++ THIS BLOCK IS NEW +++++
s.value=null,l.value=null),s.needsUpdate=n>0,l.needsUpdate=n>0,e.numPlanes=n,e.numIntersection=0}function projectPlanes(t,n,r,i){var c=null!==t?t.length:0,u=null,h=null;if(0!==c){if(u=s.value,h=l.value,!0!==i||null===u){var d=r+4*c,p=d/4,f=n.matrixWorldInverse;o.getNormalMatrix(f),(null===u||u.length<d)&&(u=new Float32Array(d)),(null===h||h.length<p)&&(// +++++ THIS BLOCK IS NEW +++++
h=new Float32Array(p));for(var m=0,g=r;m!==c;++m,g+=4)a.copy(t[m]).applyMatrix4(f,o),a.normal.toArray(u,g),u[g+3]=a.constant,h[g/4]=t[m].side}s.value=u,s.needsUpdate=!0,l.value=h,l.needsUpdate=!0}
//return dstArray;
return e.numPlanes=c,{clippingPlanes:u,clippingSides:h}}this.uniform=s,this._clippingSidesUniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||
// enable state of previous frame - the clipping code has to
// run another frame in order to reset the state:
0!==n||r;return r=i,t=projectPlanes(e,a,0),n=e.length,o},this.beginShadows=function(){i=!0,projectPlanes(null)},this.endShadows=function(e){i=!1,e||resetGlobalState()},this.setState=function(e,a,o,c,u,h){if(!r||null===e||0===e.length||i&&!o)
// there's no local clipping
i?
// there's no global clipping
projectPlanes(null):resetGlobalState();else{var d=i?0:n,p=4*d,f=u.clippingState?u.clippingState.clippingPlanes:null;s.value=f,// ensure unique state
l.value=null;
//for ( var i = 0; i !== lGlobal; ++ i ) {
//
//  dstArray[ i ] = globalState[ i ];
//
//}
for(
//dstArray = projectPlanes( planes, camera, lGlobal, fromCache );
var m=projectPlanes(e,c,p,h),g=0;g!==p;++g)m.clippingPlanes[g]=t.clippingPlanes[g],m.clippingSides[g]=t.clippingSides[g];
//cache.clippingState = dstArray;
u.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=d}}}
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLObjects.js
/**
 * @author mrdoob / http://mrdoob.com/
 */,ee=!1,te=!1,ne={type:"f",value:1,needsUpdate:!1},
// camera matrices cache
re=new _.Matrix4,ie=new _.Sphere,ae=new _.Vector3;function getTargetPixelRatio(){return null===D?Y:1}
// initialize
try{var oe={alpha:r,depth:a,stencil:o,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u};
// event listeners must be registered before WebGL context is created, see #12753
if(t.addEventListener("webglcontextlost",onContextLost,!1),t.addEventListener("webglcontextrestored",onContextRestore,!1),null===(p=n||t.getContext("webgl",oe)||t.getContext("experimental-webgl",oe)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");
// Some experimental-webgl implementations do not have getShaderPrecisionFormat
void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){
//console.error( 'THREE.WebGLRenderer: ' + error.message );
console.error(i.b.stringsByLabel.THREEEXTENSIONS_CONSOLE_err_WebGLRenderer+e)}function initGLContext(){f=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLExtensions.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLExtensions(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLGeometries.js
/**
 * @author mrdoob / http://mrdoob.com/
 */(p),(g=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLCapabilities.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLCapabilities(e,t,n){var r;function getMaxPrecision(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var i="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==n.precision?n.precision:"highp",o=getMaxPrecision(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);var s=!0===n.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_TEXTURE_SIZE),h=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=c>0,v=i||!!t.get("OES_texture_float");return{isWebGL2:i,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:a,logarithmicDepthBuffer:s,maxTextures:l,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:h,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v}}(p,f,e)).isWebGL2||(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),O=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLUtils.js
/**
 * @author thespite / http://www.twitter.com/thespite
 */
function WebGLUtils(e,t,n){return{convert:function convert(r){var i;if(r===ms)return e.REPEAT;if(r===gs)return e.CLAMP_TO_EDGE;if(r===vs)return e.MIRRORED_REPEAT;if(r===ys)return e.NEAREST;if(r===bs)return e.NEAREST_MIPMAP_NEAREST;if(r===xs)return e.NEAREST_MIPMAP_LINEAR;if(r===_s)return e.LINEAR;if(r===ws)return e.LINEAR_MIPMAP_NEAREST;if(r===Ms)return e.LINEAR_MIPMAP_LINEAR;if(r===Es)return e.UNSIGNED_BYTE;if(r===Os)return e.UNSIGNED_SHORT_4_4_4_4;if(r===Bs)return e.UNSIGNED_SHORT_5_5_5_1;if(r===Rs)return e.UNSIGNED_SHORT_5_6_5;if(r===Ss)return e.BYTE;if(r===Ls)return e.SHORT;if(r===Ts)return e.UNSIGNED_SHORT;if(r===As)return e.INT;if(r===Cs)return e.UNSIGNED_INT;if(r===Ps)return e.FLOAT;if(r===Is){if(n.isWebGL2)return e.HALF_FLOAT;if(null!==(i=t.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(r===Ds)return e.ALPHA;if(r===Vs)return e.RGB;if(r===Ns)return e.RGBA;if(r===Us)return e.LUMINANCE;if(r===Fs)return e.LUMINANCE_ALPHA;if(r===zs)return e.DEPTH_COMPONENT;if(r===ks)return e.DEPTH_STENCIL;if(r===js)return e.RED;if(r===Po)return e.FUNC_ADD;if(r===Io)return e.FUNC_SUBTRACT;if(r===Oo)return e.FUNC_REVERSE_SUBTRACT;if(r===Go)return e.ZERO;if(r===Do)return e.ONE;if(r===Vo)return e.SRC_COLOR;if(r===No)return e.ONE_MINUS_SRC_COLOR;if(r===Uo)return e.SRC_ALPHA;if(r===Fo)return e.ONE_MINUS_SRC_ALPHA;if(r===zo)return e.DST_ALPHA;if(r===ko)return e.ONE_MINUS_DST_ALPHA;if(r===jo)return e.DST_COLOR;if(r===Ho)return e.ONE_MINUS_DST_COLOR;if(r===Wo)return e.SRC_ALPHA_SATURATE;if((r===Hs||r===Ws||r===Xs||r===qs)&&null!==(i=t.get("WEBGL_compressed_texture_s3tc"))){if(r===Hs)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Ws)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Xs)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===qs)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===Ys||r===Zs||r===Js||r===Qs)&&null!==(i=t.get("WEBGL_compressed_texture_pvrtc"))){if(r===Ys)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Zs)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Js)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Qs)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===Ks&&null!==(i=t.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((r===$s||r===el||r===tl||r===nl||r===rl||r===il||r===al||r===ol||r===sl||r===ll||r===cl||r===ul||r===hl||r===dl)&&null!==(i=t.get("WEBGL_compressed_texture_astc")))return r;if(r===Bo||r===Ro){if(n.isWebGL2){if(r===Bo)return e.MIN;if(r===Ro)return e.MAX}if(null!==(i=t.get("EXT_blend_minmax"))){if(r===Bo)return i.MIN_EXT;if(r===Ro)return i.MAX_EXT}}if(r===Gs){if(n.isWebGL2)return e.UNSIGNED_INT_24_8;if(null!==(i=t.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}(p,f,g),(v=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLState.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLState(e,t,n,r){
//
var i=new function ColorBuffer(){var t=!1,n=new Vector4,r=null,i=new Vector4(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function DepthBuffer(){var t=!1,n=null,r=null,i=null;return{setTest:function(t){t?enable(e.DEPTH_TEST):disable(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case Xo:e.depthFunc(e.NEVER);break;case qo:e.depthFunc(e.ALWAYS);break;case Yo:e.depthFunc(e.LESS);break;case Zo:e.depthFunc(e.LEQUAL);break;case Jo:e.depthFunc(e.EQUAL);break;case Qo:e.depthFunc(e.GEQUAL);break;case Ko:e.depthFunc(e.GREATER);break;case $o:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},o=new function StencilBuffer(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(t){t?enable(e.STENCIL_TEST):disable(e.STENCIL_TEST)},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}},s=e.getParameter(e.MAX_VERTEX_ATTRIBS),l=new Uint8Array(s),c=new Uint8Array(s),u=new Uint8Array(s),h={},d=null,p=null,f=null,m=null,g=null,v=null,y=null,b=null,x=null,_=null,w=!1,M=null,E=null,S=null,L=null,T=null,A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),C=!1,P=0,I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(P=parseFloat(/^WebGL\ ([0-9])/.exec(I)[1]),C=P>=1):-1!==I.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(I)[1]),C=P>=2);var O=null,B={},R=new Vector4,G=new Vector4;function createTexture(t,n,r){var i=new Uint8Array(4),a=e.createTexture();// 4 is required to match default unpack alignment of 4.
e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<r;o++)e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return a}var D={};function enableAttributeAndDivisor(n,i){l[n]=1,0===c[n]&&(e.enableVertexAttribArray(n),c[n]=1),u[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),u[n]=i)}function enable(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function disable(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}function setBlending(t,r,i,a,o,s,l,c){if(t!==Eo){if(f||(enable(e.BLEND),f=!0),t===Co)
// custom blending
o=o||r,s=s||i,l=l||a,r===g&&o===b||(e.blendEquationSeparate(n.convert(r),n.convert(o)),g=r,b=o),i===v&&a===y&&s===x&&l===_||(e.blendFuncSeparate(n.convert(i),n.convert(a),n.convert(s),n.convert(l)),v=i,y=a,x=s,_=l),m=t,w=null;else if(t!==m||c!==w){if(g===Po&&b===Po||(e.blendEquation(e.FUNC_ADD),g=Po,b=Po),c)switch(t){case So:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Lo:e.blendFunc(e.ONE,e.ONE);break;case To:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case Ao:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case So:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Lo:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case To:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case Ao:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,_=null,m=t,w=c}}else f&&(disable(e.BLEND),f=!1)}
//
function setFlipSided(t){M!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),M=t)}function setCullFace(t){t!==mo?(enable(e.CULL_FACE),t!==E&&(t===go?e.cullFace(e.BACK):t===vo?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):disable(e.CULL_FACE),E=t}function setPolygonOffset(t,n,r){t?(enable(e.POLYGON_OFFSET_FILL),L===n&&T===r||(e.polygonOffset(n,r),L=n,T=r)):disable(e.POLYGON_OFFSET_FILL)}
// texture
function activeTexture(t){void 0===t&&(t=e.TEXTURE0+A-1),O!==t&&(e.activeTexture(t),O=t)}return D[e.TEXTURE_2D]=createTexture(e.TEXTURE_2D,e.TEXTURE_2D,1),D[e.TEXTURE_CUBE_MAP]=createTexture(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),
// init
i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),enable(e.DEPTH_TEST),a.setFunc(Zo),setFlipSided(!1),setCullFace(go),enable(e.CULL_FACE),setBlending(Eo),{buffers:{color:i,depth:a,stencil:o},initAttributes:
//
function initAttributes(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function enableAttribute(e){enableAttributeAndDivisor(e,0)},enableAttributeAndDivisor:enableAttributeAndDivisor,disableUnusedAttributes:function disableUnusedAttributes(){for(var t=0,n=c.length;t!==n;++t)c[t]!==l[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function getCompressedTextureFormats(){if(null===d&&(d=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)d.push(n[r]);return d},useProgram:function useProgram(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,n){t.side===wo?disable(e.CULL_FACE):enable(e.CULL_FACE);var r=t.side===_o;n&&(r=!r),setFlipSided(r),t.blending===So&&!1===t.transparent?setBlending(Eo):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),i.setMask(t.colorWrite),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(t){t!==S&&(C&&e.lineWidth(t),S=t)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(e.SCISSOR_TEST):disable(e.SCISSOR_TEST)},activeTexture:activeTexture,bindTexture:function bindTexture(t,n){null===O&&activeTexture();var r=B[O];void 0===r&&(r={type:void 0,texture:void 0},B[O]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||D[t]),r.type=t,r.texture=n)},compressedTexImage2D:function compressedTexImage2D(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function texImage2D(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function texImage3D(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}
//
,scissor:function scissor(t){!1===R.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),R.copy(t))},viewport:function viewport(t){!1===G.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))}
//
,reset:function reset(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);h={},d=null,O=null,B={},p=null,m=null,M=null,E=null,i.reset(),a.reset(),o.reset()}}}(p,f,O,g)).scissor(j.copy(J).multiplyScalar(Y)),v.viewport(k.copy(Z).multiplyScalar(Y)),y=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLInfo.js
/**
 * @author Mugen87 / https://github.com/Mugen87
 */
function WebGLInfo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function reset(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function update(n,r,i){switch(i=i||1,t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=i*(n-2);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}(p),b=new
// CONCATENATED MODULE: ./staging/ThreeExtensions/WebGLProperties.js
/**
 * @author fordacious / fordacious.github.io
 */
function WebGLProperties(){var e=new WeakMap;return{get:function get(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function remove(t){e.delete(t)},update:function update(t,n,r){e.get(t)[n]=r},dispose:function dispose(){e=new WeakMap}}},x=new WebGLTextures(p,f,v,b,g,O,y),w=new WebGLAttributes(p),M=new function WebGLGeometries(e,t,n){var r={},i={};function onGeometryDispose(e){var a=e.target,o=r[a.id];for(var s in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[s]);a.removeEventListener("dispose",onGeometryDispose),delete r[a.id];var l=i[o.id];l&&(t.remove(l),delete i[o.id]),
//
n.memory.geometries--}return{get:function get(e,t){var i=r[t.id];return i||(t.addEventListener("dispose",onGeometryDispose),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry_BufferGeometry).setFromObject(e)),i=t._bufferGeometry),r[t.id]=i,n.memory.geometries++,i)},update:function update(n){var r=n.index,i=n.attributes;for(var a in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),i)t.update(i[a],e.ARRAY_BUFFER);
// morph targets
var o=n.morphAttributes;for(var a in o)for(var s=o[a],l=0,c=s.length;l<c;l++)t.update(s[l],e.ARRAY_BUFFER)},getWireframeAttribute:function getWireframeAttribute(n){var r=i[n.id];if(r)return r;var a,o=[],s=n.index,l=n.attributes;
// console.time( 'wireframe' );
if(null!==s)for(var c=0,u=(a=s.array).length;c<u;c+=3){var h=a[c+0],d=a[c+1],p=a[c+2];o.push(h,d,d,p,p,h)}else for(c=0,u=(a=l.position.array).length/3-1;c<u;c+=3)h=c+0,d=c+1,p=c+2,o.push(h,d,d,p,p,h);
// console.timeEnd( 'wireframe' );
return r=new(arrayMax(o)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(o,1),t.update(r,e.ELEMENT_ARRAY_BUFFER),i[n.id]=r,r}}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLIndexedBufferRenderer.js
/**
 * @author mrdoob / http://mrdoob.com/
 */(p,w,y),E=new function WebGLObjects(e,t){var n={};return{update:function update(r){var i=t.render.frame,a=r.geometry,o=e.get(r,a);
// Update once per frame
return n[o.id]!==i&&(a.isGeometry&&o.updateFromObject(r),e.update(o),n[o.id]=i),o},dispose:function dispose(){n={}}}}(M,y),C=new function WebGLMorphtargets(e){var t={},n=new Float32Array(8);return{update:function update(r,i,a,o){var s=r.morphTargetInfluences,l=s.length,c=t[i.id];if(void 0===c){
// initialise list
c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[i.id]=c}var h=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal;
// Remove current morphAttributes
for(u=0;u<l;u++)0!==(p=c[u])[1]&&(h&&i.removeAttribute("morphTarget"+u),d&&i.removeAttribute("morphNormal"+u));
// Collect influences
for(u=0;u<l;u++)(p=c[u])[0]=u,p[1]=s[u];
// Add morphAttributes
for(c.sort(absNumericalSort),u=0;u<8;u++){var p;if(p=c[u]){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+u,h[f]),d&&i.addAttribute("morphNormal"+u,d[f]),n[u]=m;continue}}n[u]=0}o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}(p),S=new WebGLPrograms(B,f,g),L=new WebGLRenderLists,T=new function WebGLRenderStates(){var e={};return{get:function get(t,n){var r;return void 0===e[t.id]?(r=new WebGLRenderState,e[t.id]={},e[t.id][n.id]=r):void 0===e[t.id][n.id]?(r=new WebGLRenderState,e[t.id][n.id]=r):r=e[t.id][n.id],r},dispose:function dispose(){e={}}}},A=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLBackground.js
/**
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLBackground(e,t,n,r){var i,a,o=new Color(0),s=0;function setClear(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),setClear(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){setClear(o,s=e)},render:function render(t,r,l,c){var u=r.background;null===u?setClear(o,s):u&&u.isColor&&(setClear(u,1),c=!0),(e.autoClear||c)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),u&&u.isCubeTexture?(void 0===a&&((a=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({uniforms:Il.clone(np.cube.uniforms),vertexShader:np.cube.vertexShader,fragmentShader:np.cube.fragmentShader,side:_o,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},n.update(a)),a.material.uniforms.tCube.value=u,t.push(a,a.geometry,a.material,0,null)):u&&u.isTexture&&(void 0===i&&((i=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({uniforms:Il.clone(np.background.uniforms),vertexShader:np.background.vertexShader,fragmentShader:np.background.fragmentShader,side:xo,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),n.update(i)),i.material.uniforms.t2D.value=u,t.push(i,i.geometry,i.material,0,null))}}}
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLBufferRenderer.js
/**
 * @author mrdoob / http://mrdoob.com/
 */(B,v,E,l),P=new function WebGLBufferRenderer(e,t,n,r){var i;
//
this.setMode=function setMode(e){i=e},this.render=function render(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function renderInstances(a,o,s){var l;if(r.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[r.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](i,o,s,a.maxInstancedCount),n.update(s,i,a.maxInstancedCount)}}(p,f,y,g),I=new function WebGLIndexedBufferRenderer(e,t,n,r){var i,a,o;
//
this.setMode=function setMode(e){i=e},this.setIndex=function setIndex(e){a=e.type,o=e.bytesPerElement},this.render=function render(t,r){e.drawElements(i,r,a,t*o),n.update(r,i)},this.renderInstances=function renderInstances(s,l,c){var u;if(r.isWebGL2)u=e;else if(null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[r.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](i,c,a,l*o,s.maxInstancedCount),n.update(c,i,s.maxInstancedCount)}}(p,f,y,g),y.programs=S.programs,B.context=p,B.capabilities=g,B.extensions=f,B.properties=b,B.renderLists=L,B.state=v,B.info=y}initGLContext();
// plmvisweb
var se=p.getParameter(p.ALIASED_LINE_WIDTH_RANGE);
// vr
var le="xr"in navigator?new function WebXRManager(e){var t=e.context,n=null,r=null,i=null,a="stage",o=null,s=[],l=[];function isPresenting(){return null!==r&&null!==i}
//
var c=new PerspectiveCamera;c.layers.enable(1),c.viewport=new Vector4;var u=new PerspectiveCamera;u.layers.enable(2),u.viewport=new Vector4;var h=new ArrayCamera([c,u]);
//
function onSessionEvent(e){var t=s[l.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function onSessionEnd(){e.setFramebuffer(null),p.stop()}function updateCamera(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}h.layers.enable(1),h.layers.enable(2),
//
this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new Group_Group).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e),e instanceof XRDevice&&t.setCompatibleXRDevice(e)},this.setFrameOfReferenceType=function(e){a=e},this.setSession=function(n){null!==(r=n)&&(r.addEventListener("select",onSessionEvent),r.addEventListener("selectstart",onSessionEvent),r.addEventListener("selectend",onSessionEvent),r.addEventListener("end",onSessionEnd),r.baseLayer=new XRWebGLLayer(r,t),r.requestFrameOfReference(a).then(function(t){i=t,e.setFramebuffer(r.baseLayer.framebuffer),p.setContext(r),p.start()}),
//
l=r.getInputSources(),r.addEventListener("inputsourceschange",function(){l=r.getInputSources(),console.log(l)}))},this.getCamera=function(e){if(isPresenting()){var t=e.parent,n=h.cameras;
// apply camera.parent to cameraVR
updateCamera(h,t);for(var r=0;r<n.length;r++)updateCamera(n[r],t);
// update camera and its children
e.matrixWorld.copy(h.matrixWorld);for(var i=e.children,a=(r=0,i.length);r<a;r++)i[r].updateMatrixWorld(!0);return h}return e},this.isPresenting=isPresenting;
// Animation Loop
var d=null,p=new WebGLAnimation;p.setAnimationLoop(function onAnimationFrame(e,t){if(null!==(o=t.getDevicePose(i)))for(var n=r.baseLayer,a=t.views,c=0;c<a.length;c++){var u=a[c],p=n.getViewport(u),f=o.getViewMatrix(u),m=h.cameras[c];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(u.projectionMatrix),m.viewport.set(p.x,p.y,p.width,p.height),0===c&&(h.matrix.copy(m.matrix),
// HACK (mrdoob)
// https://github.com/w3c/webvr/issues/203
h.projectionMatrix.copy(m.projectionMatrix))}
//
for(c=0;c<s.length;c++){var g=s[c],v=l[c];if(v){var y=t.getInputPose(v,i);if(null!==y){"targetRay"in y?g.matrix.elements=y.targetRay.transformMatrix:"pointerMatrix"in y&&(
// DEPRECATED
g.matrix.elements=y.pointerMatrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.visible=!0;continue}}g.visible=!1}d&&d(e)}),this.setAnimationLoop=function(e){d=e},this.dispose=function(){},
// DEPRECATED
this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}(B):new WebVRManager(B);this.vr=le;
// shadow map
var ce=new
// CONCATENATED MODULE: ./node_modules/three/src/renderers/webgl/WebGLShadowMap.js
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */
function WebGLShadowMap(e,t,n){
// init
for(var r=new Frustum,i=new Matrix4,a=new Vector2,o=new Vector2(n,n),s=new Vector3,l=new Vector3,c=1,u=2,h=1+(c|u),d=new Array(h),p=new Array(h),f={},m={0:_o,1:xo,2:wo},g=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],v=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],y=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],b=0;b!==h;++b){var x=0!=(b&c),_=0!=(b&u),w=new MeshDepthMaterial({depthPacking:wl,morphTargets:x,skinning:_});d[b]=w;
//
var M=new MeshDistanceMaterial({morphTargets:x,skinning:_});p[b]=M}
//
var E=this;function getDepthMaterial(t,n,r,i,a,o){var s=t.geometry,l=null,h=d,g=t.customDepthMaterial;if(r&&(h=p,g=t.customDistanceMaterial),g)l=g;else{var v=!1;n.morphTargets&&(s&&s.isBufferGeometry?v=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(v=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var y=t.isSkinnedMesh&&n.skinning,b=0;v&&(b|=c),y&&(b|=u),l=h[b]}if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){
// in this case we need a unique material instance reflecting the
// appropriate state
var x=l.uuid,_=n.uuid,w=f[x];void 0===w&&(w={},f[x]=w);var M=w[_];void 0===M&&(M=l.clone(),w[_]=M),l=M}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=null!=n.shadowSide?n.shadowSide:m[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,r&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=a,l.farDistance=o),l}function renderObject(n,i,a,o){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var s=t.update(n),c=n.material;if(Array.isArray(c))for(var u=s.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=c[p.materialIndex];if(f&&f.visible){var m=getDepthMaterial(n,f,o,l,a.near,a.far);e.renderBufferDirect(a,null,s,m,n,p)}}else c.visible&&(m=getDepthMaterial(n,c,o,l,a.near,a.far),e.renderBufferDirect(a,null,s,m,n,null))}for(var g=n.children,v=0,y=g.length;v<y;v++)renderObject(g[v],i,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=yo,this.render=function(t,n,c){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==t.length){
// TODO Clean up (needed in case of contextlost)
var u,h=e.context,d=e.state;
// Set GL state for depth map.
d.disable(h.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],b=m.shadow,x=m&&m.isPointLight;if(void 0!==b){var _=b.camera;if(a.copy(b.mapSize),a.min(o),x){var w=a.x,M=a.y;
// These viewports map a cube-map onto a 2D texture with the
// following orientation:
//
//  xzXZ
//   y Y
//
// X - Positive x direction
// x - Negative x direction
// Y - Positive y direction
// y - Negative y direction
// Z - Positive z direction
// z - Negative z direction
// positive X
y[0].set(2*w,M,w,M),
// negative X
y[1].set(0,M,w,M),
// positive Z
y[2].set(3*w,M,w,M),
// negative Z
y[3].set(w,M,w,M),
// positive Y
y[4].set(3*w,0,w,M),
// negative Y
y[5].set(w,0,w,M),a.x*=4,a.y*=2}if(null===b.map){var S={minFilter:ys,magFilter:ys,format:Ns};b.map=new WebGLRenderTarget(a.x,a.y,S),b.map.texture.name=m.name+".shadowMap",_.updateProjectionMatrix()}b.isSpotLightShadow&&b.update(m);var L=b.map,T=b.matrix;l.setFromMatrixPosition(m.matrixWorld),_.position.copy(l),x?(u=6,
// for point lights we set the shadow matrix to be a translation-only matrix
// equal to inverse of the light's position
T.makeTranslation(-l.x,-l.y,-l.z)):(u=1,s.setFromMatrixPosition(m.target.matrixWorld),_.lookAt(s),_.updateMatrixWorld(),
// compute shadow matrix
T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(_.projectionMatrix),T.multiply(_.matrixWorldInverse)),e.setRenderTarget(L),e.clear();
// render shadow map for each cube face (if omni-directional) or
// run a single pass if not
for(var A=0;A<u;A++){if(x){s.copy(_.position),s.add(g[A]),_.up.copy(v[A]),_.lookAt(s),_.updateMatrixWorld();var C=y[A];d.viewport(C)}
// update camera matrices and frustum
i.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),r.setFromMatrix(i),
// set object matrices & frustum culling
renderObject(n,c,_,x)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}E.needsUpdate=!1}}}(B,E,g.maxTextureSize);
// Events
function onContextLost(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1,initGLContext()}function onMaterialDispose(e){var t=e.target;t.removeEventListener("dispose",onMaterialDispose),
// Buffer deallocation
function deallocateMaterial(e){releaseMaterialProgramReference(e),b.remove(e)}(t)}function releaseMaterialProgramReference(e){var t=b.get(e).program;e.program=void 0,void 0!==t&&S.releaseProgram(t)}
// Buffer rendering
this.shadowMap=ce,
// API
this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){void 0!==e&&(Y=e,this.setSize(X,q,!1))},this.getSize=function(){return{width:X,height:q}},this.setSize=function(e,n,r){le.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(X=e,q=n,t.width=e*Y,t.height=n*Y,!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(){return{width:X*Y,height:q*Y}},this.setDrawingBufferSize=function(e,n,r){X=e,q=n,Y=r,t.width=e*r,t.height=n*r,this.setViewport(0,0,e,n)},this.getCurrentViewport=function(){return k},this.setViewport=function(e,t,n,r){Z.set(e,q-t-r,n,r),v.viewport(k.copy(Z).multiplyScalar(Y))},this.setScissor=function(e,t,n,r){J.set(e,q-t-r,n,r),v.scissor(j.copy(J).multiplyScalar(Y))},this.setScissorTest=function(e){v.setScissorTest(Q=e)},
// Clearing
this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=p.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=p.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=p.STENCIL_BUFFER_BIT),p.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},
//
this.dispose=function(){t.removeEventListener("webglcontextlost",onContextLost,!1),t.removeEventListener("webglcontextrestored",onContextRestore,!1),L.dispose(),T.dispose(),b.dispose(),E.dispose(),le.dispose(),de.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var n=b.get(e);e.hasPositions&&!n.position&&(n.position=p.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=p.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=p.createBuffer()),e.hasColors&&!n.color&&(n.color=p.createBuffer());var r=t.getAttributes();e.hasPositions&&(p.bindBuffer(p.ARRAY_BUFFER,n.position),p.bufferData(p.ARRAY_BUFFER,e.positionArray,p.DYNAMIC_DRAW),v.enableAttribute(r.position),p.vertexAttribPointer(r.position,3,p.FLOAT,!1,0,0)),e.hasNormals&&(p.bindBuffer(p.ARRAY_BUFFER,n.normal),p.bufferData(p.ARRAY_BUFFER,e.normalArray,p.DYNAMIC_DRAW),v.enableAttribute(r.normal),p.vertexAttribPointer(r.normal,3,p.FLOAT,!1,0,0)),e.hasUvs&&(p.bindBuffer(p.ARRAY_BUFFER,n.uv),p.bufferData(p.ARRAY_BUFFER,e.uvArray,p.DYNAMIC_DRAW),v.enableAttribute(r.uv),p.vertexAttribPointer(r.uv,2,p.FLOAT,!1,0,0)),e.hasColors&&(p.bindBuffer(p.ARRAY_BUFFER,n.color),p.bufferData(p.ARRAY_BUFFER,e.colorArray,p.DYNAMIC_DRAW),v.enableAttribute(r.color),p.vertexAttribPointer(r.color,3,p.FLOAT,!1,0,0)),v.disableUnusedAttributes(),p.drawArrays(p.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,a,o){var s=a.isMesh&&a.normalMatrix.determinant()<0;v.setMaterial(r,s);var l=setProgram(e,t,r,a),c=!1,u=!1;U.geometry===n.id&&U.program===l.id&&U.wireframe===(!0===r.wireframe)||(U.geometry=n.id,U.program=l.id,U.wireframe=!0===r.wireframe,c=!0),o&&n.maxInstancedCount>0&&(o,u=!0),a.morphTargetInfluences&&(C.update(a,n,r,l),c=!0);
//
var h,d=n.index,m=n.attributes.position,y=1;!0===r.wireframe&&(d=M.getWireframeAttribute(n),y=2);var b=P;if(null!==d&&(h=w.get(d),(b=I).setIndex(h)),u&&n.updateGroup(o)&&o.attributes)
//Hack??
for(var x in E.update(a),o.attributes)if(o.attributes.hasOwnProperty(x)){var S=o.attributes[x];w.update(S,p.ARRAY_BUFFER)}c&&(!function setupVertexAttributes(e,t,n){if(n&&n.isInstancedBufferGeometry&!g.isWebGL2&&null===f.get("ANGLE_instanced_arrays"))
//console.error( 'THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );
return void console.error(i.b.stringsByLabel.THREEEXTENSIONS_CONSOLE_err_setupVertexAttributes);ue.length=0,v.initAttributes();var r=n.attributes,a=t.getAttributes(),o=e.defaultAttributeValues;for(var s in a){var l=a[s];if(l>=0){var c=r[s];if(void 0!==c){var u=c.normalized,h=c.itemSize,d=w.get(c);
// TODO Attribute may not be available on context restore
if(void 0===d)continue;var m=d.buffer,y=d.type,b=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var x=c.data,_=x.stride,M=c.offset;x&&x.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(l,x.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=x.meshPerAttribute*x.count)):v.enableAttribute(l),
//_gl.bindBuffer( _gl.ARRAY_BUFFER, buffer );
ue.indexOf(m)<0&&(// +++++ REPLACES THE ABOVE COMMENTED SECTION +++++
p.bindBuffer(p.ARRAY_BUFFER,m),ue.push(m)),p.vertexAttribPointer(l,h,y,u,_*b,M*b)}else c.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=c.meshPerAttribute*c.count)):v.enableAttribute(l),
//_gl.bindBuffer( _gl.ARRAY_BUFFER, buffer );
ue.indexOf(m)<0&&(// +++++ REPLACES THE ABOVE COMMENTED SECTION +++++
p.bindBuffer(p.ARRAY_BUFFER,m),ue.push(m)),p.vertexAttribPointer(l,h,y,u,0,0)}else if(void 0!==o){var E=o[s];if(void 0!==E)switch(E.length){case 2:p.vertexAttrib2fv(l,E);break;case 3:p.vertexAttrib3fv(l,E);break;case 4:p.vertexAttrib4fv(l,E);break;default:p.vertexAttrib1fv(l,E)}}}}v.disableUnusedAttributes()}
// Compile
(r,l,n),null!==d&&p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,h.buffer));
//
var L=1/0;null!==d?L=d.count:void 0!==m&&(L=m.count);var T=n.drawRange.start*y,A=n.drawRange.count*y,O=null!==o?o.start*y:0,B=null!==o?o.count*y:1/0,R=Math.max(T,O),G=Math.min(L,T+A,O+B)-1,D=Math.max(0,G-R+1);if(0!==D){
//
if(a.isMesh)if(!0===r.wireframe)v.setLineWidth(r.wireframeLinewidth*getTargetPixelRatio()),b.setMode(p.LINES);else switch(a.drawMode){case _.TrianglesDrawMode:b.setMode(p.TRIANGLES);break;case _.TriangleStripDrawMode:b.setMode(p.TRIANGLE_STRIP);break;case _.TriangleFanDrawMode:b.setMode(p.TRIANGLE_FAN)}else if(a.isLine){
//var lineWidth = material.linewidth;
//
//if ( lineWidth === undefined ) lineWidth = 1; // Not using Line*Material
var V=function getNearestLineWidth(e){if(void 0===e||null===e)return 1;if(void 0===se||null===se&&0===se.length)return e;for(var t=0,n=se.length-1;n>t;){var r=t+n>>1;// NOSONAR
if((i=se[r])===e)return i;i>e?n=r-1:t=r+1}for(;t>=0;){var i;if((i=se[t])<e)return i;t--}return se[0]}(r.linewidth);v.setLineWidth(V*getTargetPixelRatio()),a.isLineSegments?b.setMode(p.LINES):a.isLineLoop?b.setMode(p.LINE_LOOP):b.setMode(p.LINE_STRIP)}else a.isPoints?b.setMode(p.POINTS):a.isSprite&&b.setMode(p.TRIANGLES);n&&n.isInstancedBufferGeometry&&n.maxInstancedCount>0?b.renderInstances(n,R,D):b.render(R,D)}};var ue=[];this.compile=function(e,t){(d=T.get(e,t)).init(),e.traverse(function(e){e.isLight&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))}),d.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)initMaterial(t.material[n],e.fog,t);else initMaterial(t.material,e.fog,t)})};
// Animation Loop
var he=null;var de=new WebGLAnimation;function pushRenderItem(e,t,n,r,i,a){
// force edge render order
"Edge"!==e.type&&"EdgeShape"!==e.type||(B.renderMode===m.g.Outline?e.renderOrder=1:e.renderOrder=-1),void 0===a&&(a=e.renderOrder),
//object, geometry, material, z, group
h.push(e,t,n,r,i,a)}
/*
    // TODO Duplicated code (Frustum)

    var _sphere = new Sphere();

    function isObjectViewable( object ) {

        var geometry = object.geometry;

        if ( geometry.boundingSphere === null )
            geometry.computeBoundingSphere();

        _sphere.copy( geometry.boundingSphere ).
        applyMatrix4( object.matrixWorld );

        return isSphereViewable( _sphere );

    }

    function isSpriteViewable( sprite ) {

        _sphere.center.set( 0, 0, 0 );
        _sphere.radius = 0.7071067811865476;
        _sphere.applyMatrix4( sprite.matrixWorld );

        return isSphereViewable( _sphere );

    }

    function isSphereViewable( sphere ) {

        if ( ! _frustum.intersectsSphere( sphere ) ) return false;

        var numPlanes = _clipping.numPlanes;

        if ( numPlanes === 0 ) return true;

        var clipping = false;
        if ( object.material ) {
            if ( Array.isArray(object.material) ) {
                if ( object.material.length > 0 ) {
                    clipping = object.material[ 0 ].clipping;
                }
            } else if ( object.material instanceof THREE.Material ) {
                clipping = object.material.clipping;
            }
        }

        //var planes = _this.clippingPlanes,
        //
        //  center = sphere.center,
        //  negRad = - sphere.radius,
        //  i = 0;

        //do {
        //
        //  // out when deeper than radius in the negative halfspace
        //  if ( planes[ i ].distanceToPoint( center ) < negRad ) return false;
        //
        //} while ( ++ i !== numPlanes );
        if ( clipping === true ) {
            var planes = _this.clippingPlanes,
                center = sphere.center,
                negRad = -sphere.radius,
                length = planes.length;

            for ( var i = 0; i < length; i++ ) {
                var side = planes[ i ].side;
                if ( side === ClippingSide.Both ) {
                    return false;
                }

                switch ( planes[ i ].side ) { //NOSONAR
                    case ClippingSide.Positive:
                        // out when deeper than radius in the negative halfspace
                        if ( planes[ i ].distanceToPoint( center ) < negRad ) {
                            return false;
                        }
                        break;
                    case ClippingSide.Negative:
                        // out when deeper than radius in the positive halfspace
                        if ( planes[ i ].distanceToPoint( center ) > sphere.radius ) {
                            return false;
                        }
                        break;
                }
            }
        }

        return true;

    }
    */function isObjectViewable(e){// NOSONAR
var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere();var n=ie.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);if(!K.intersectsSphere(n))return!1;if(0===$.numPlanes)return!0;var r=!1;if(e.material&&(Array.isArray(e.material)&&e.material.length>0?r=e.material[0].clipping:e.material instanceof _.Material&&(r=e.material.clipping)),!0===r)for(var i=B.clippingPlanes,a=n.center,o=-n.radius,s=i.length,l=0;l<s;l++){if(i[l].side===m.d.Both)return!1;switch(i[l].side){//NOSONAR
case m.d.Positive:
// out when deeper than radius in the negative halfspace
if(i[l].distanceToPoint(a)<o)return!1;break;case m.d.Negative:
// out when deeper than radius in the positive halfspace
if(i[l].distanceToPoint(a)>n.radius)return!1}}return!0}function renderObjects(e,t,n,r){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,c=void 0===r?o.material:r,u=o.group;if(n.isArrayCamera){z=n;for(var h=n.cameras,p=0,f=h.length;p<f;p++){var m=h[p];if(s.layers.test(m.layers)){if("viewport"in m)// XR
v.viewport(k.copy(m.viewport));else{var g=m.bounds,y=g.x*X,b=g.y*q,x=g.z*X,_=g.w*q;v.viewport(k.set(y,b,x,_).multiplyScalar(Y))}d.setupLights(m),renderObject(s,t,m,l,c,u)}}}else z=null,renderObject(s,t,n,l,c,u)}}function renderObject(e,t,n,r,i,a){if(e.onBeforeRender(B,t,n,r,i,a),d=T.get(t,z||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){v.setMaterial(i);var o=setProgram(n,t.fog,i,e);U.geometry=null,U.program=null,U.wireframe=!1,function renderObjectImmediate(e,t){e.render(function(e){B.renderBufferImmediate(e,t)})}(e,o)}else B.renderBufferDirect(n,t.fog,r,i,e,a);e.onAfterRender(B,t,n,r,i,a),d=T.get(t,z||n)}function initMaterial(e,t,n){var r=b.get(e),i=d.state.lights,a=d.state.shadowsArray,o=r.lightsHash,s=i.state.hash,l=S.getParameters(e,i.state,a,t,$.numPlanes,$.numIntersection,n),c=r.program,u=!0;if(!c||0===Object.keys(c).length||e.needsUpdate){var h=S.getProgramCode(e,l);if(void 0===c)
// new material
e.addEventListener("dispose",onMaterialDispose);else if(c.code!==h)
// changed glsl or parameters
releaseMaterialProgramReference(e);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,u=!1;else{if(void 0!==l.shaderID)
// same glsl and uniform list
return;
// only rebuild uniform list
u=!1}if(u){if(l.shaderID){var p=_.ShaderLib[l.shaderID];r.shader={name:e.type,uniforms:_.UniformsUtils.clone(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,B),
// Computing code again as onBeforeCompile may have changed the shaders
h=S.getProgramCode(e,l),c=S.acquireProgram(e,r.shader,l,h),r.program=c,e.program=c}var f=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<B.maxMorphTargets;m++)f["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(m=0;m<B.maxMorphNormals;m++)f["morphNormal"+m]>=0&&e.numSupportedMorphNormals++}var g=r.shader.uniforms;
//if ( ! material.isShaderMaterial &&
//  ! material.isRawShaderMaterial ||
//  material.clipping === true ) {
//
//  materialProperties.numClippingPlanes = _clipping.numPlanes;
//  materialProperties.numIntersection = _clipping.numIntersection;
//  uniforms.clippingPlanes = _clipping.uniform;
//
//}
!0===e.clipping&&(r.numClippingPlanes=$.numPlanes,g.clippingPlanes=$.uniform,g.clippingSides=$._clippingSidesUniform),g.pixelTolerance=ne,r.fog=t,
// store the light setup it was created for
void 0===o&&(r.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(
// wire up the material to this renderer's lighting state
g.ambientLightColor.value=i.state.ambient,g.directionalLights.value=i.state.directional,g.spotLights.value=i.state.spot,g.rectAreaLights.value=i.state.rectArea,g.pointLights.value=i.state.point,g.hemisphereLights.value=i.state.hemi,g.directionalShadowMap.value=i.state.directionalShadowMap,g.directionalShadowMatrix.value=i.state.directionalShadowMatrix,g.spotShadowMap.value=i.state.spotShadowMap,g.spotShadowMatrix.value=i.state.spotShadowMatrix,g.pointShadowMap.value=i.state.pointShadowMap,g.pointShadowMatrix.value=i.state.pointShadowMatrix);var v=r.program.getUniforms(),y=WebGLUniforms.seqWithValue(v.seq,g);r.uniformsList=y}}function setProgram(e,t,n,r){W=0;var i=b.get(n),a=d.state.lights,o=i.lightsHash,s=a.state.hash;if(ee&&(te||e!==F)){var l=e===F&&n.id===N;
// we might want to call this function with some ClippingGroup
// object instead of the material, once it becomes feasible
// (#8465, #8379)
//_clipping.setState(
//  material.clippingPlanes, material.clipIntersection, material.clipShadows,
//  camera, materialProperties, useCache );
n.clippingPlanes?($.beginShadows(),$.setState(n.clippingPlanes,n.clipIntersection,!0,e,i,!1),$.endShadows(!0)):$.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,i,l)}!1===n.needsUpdate&&(void 0===i.program?n.needsUpdate=!0:n.fog&&i.fog!==t?n.needsUpdate=!0:(!n.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===i.numClippingPlanes||i.numClippingPlanes===$.numPlanes&&i.numIntersection===$.numIntersection)||(n.needsUpdate=!0)),n.side!==B.materialSide&&"OutlineShape"!==r.type&&(n.side=B.materialSide,n.needsUpdate=!0),n.needsUpdate&&(initMaterial(n,t,r),n.needsUpdate=!1);var c=!1,u=!1,h=!1,f=i.program,y=f.getUniforms(),x=i.shader.uniforms;if(v.useProgram(f.program)&&(c=!0,u=!0,h=!0),n.id!==N&&(N=n.id,u=!0),c||F!==e){
// load material specific uniforms
// (shader material also gets them for the sake of genericity)
if(y.setValue(p,"projectionMatrix",e.projectionMatrix),g.logarithmicDepthBuffer&&y.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),F!==e&&(F=e,
// lighting uniforms depend on the camera so enforce an update
// now, in case this material supports lights - or later, when
// the next material that does gets activated:
u=!0,// set to true on material change
h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var w=y.map.cameraPosition;void 0!==w&&w.setValue(p,ae.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&y.setValue(p,"viewMatrix",e.matrixWorldInverse)}
// skinning uniforms must be set even if material didn't change
// auto-setting of texture unit for bone texture must go before other textures
// not sure why, but otherwise weird things happen
if(n.skinning){y.setOptional(p,r,"bindMatrix"),y.setOptional(p,r,"bindMatrixInverse");var M=r.skeleton;if(M){var E=M.bones;if(g.floatVertexTextures){if(void 0===M.boneTexture){
// layout (1 matrix = 4 pixels)
//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)
//  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)
//       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)
//       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)
//       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)
var S=Math.sqrt(4*E.length);// 4 pixels needed for 1 matrix
S=_.Math.ceilPowerOfTwo(S),S=Math.max(S,4);var L=new Float32Array(S*S*4);// 4 floats per RGBA pixel
L.set(M.boneMatrices);// copy current values
var T=new DataTexture(L,S,S,_.RGBAFormat,_.FloatType);T.needsUpdate=!0,M.boneMatrices=L,M.boneTexture=T,M.boneTextureSize=S}y.setValue(p,"boneTexture",M.boneTexture),y.setValue(p,"boneTextureSize",M.boneTextureSize)}else y.setOptional(p,M,"boneMatrices")}}
// Handle render modes
if(u&&(y.setValue(p,"toneMappingExposure",B.toneMappingExposure),y.setValue(p,"toneMappingWhitePoint",B.toneMappingWhitePoint),n.lights&&
// the current material requires lighting info
// note: all lighting uniforms are always set correctly
// they simply reference the renderer's state for their
// values
//
// use the current material's .needsUpdate flags to set
// the GL state when required
// If uniforms are marked as clean, they don't need to be loaded to the GPU.
function markUniformsLightsNeedsUpdate(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}
// Textures
(x,h),
// refresh uniforms common to several materials
t&&n.fog&&function refreshUniformsFog(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(x,t),n.isMeshBasicMaterial?refreshUniformsCommon(x,n):n.isMeshLambertMaterial?(refreshUniformsCommon(x,n),function refreshUniformsLambert(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(x,n)):n.isMeshPhongMaterial?(refreshUniformsCommon(x,n),n.isMeshToonMaterial?function refreshUniformsToon(e,t){refreshUniformsPhong(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(x,n):refreshUniformsPhong(x,n)):n.isMeshStandardMaterial?(refreshUniformsCommon(x,n),n.isMeshPhysicalMaterial?function refreshUniformsPhysical(e,t){refreshUniformsStandard(e,t),e.reflectivity.value=t.reflectivity,// also part of uniforms common
e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(x,n):refreshUniformsStandard(x,n)):n.isMeshDepthMaterial?(refreshUniformsCommon(x,n),function refreshUniformsDepth(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isMeshDistanceMaterial?(refreshUniformsCommon(x,n),function refreshUniformsDistance(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(x,n)):n.isMeshNormalMaterial?(refreshUniformsCommon(x,n),function refreshUniformsNormal(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_.BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_.BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isLineBasicMaterial?(!function refreshUniformsLine(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(x,n),n.isLineDashedMaterial&&function refreshUniformsDash(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(x,n)):n.isPointsMaterial?function refreshUniformsPoints(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*Y,e.scale.value=.5*q,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(x,n):n.isSpriteMaterial?function refreshUniformsSprites(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(x,n):n.isShadowMaterial&&(x.color.value=n.color,x.opacity.value=n.opacity),
// RectAreaLight Texture
// TODO (mrdoob): Find a nicer implementation
void 0!==x.ltc_1&&(x.ltc_1.value=_.UniformsLib.LTC_1),void 0!==x.ltc_2&&(x.ltc_2.value=_.UniformsLib.LTC_2),WebGLUniforms.upload(p,i.uniformsList,x,B)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(WebGLUniforms.upload(p,i.uniformsList,x,B),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&y.setValue(p,"center",r.center),B.renderModeNeedsUpdate)
// Force  part transparency, opacity properties
if(B.renderMode!==m.g.Shaded&&r instanceof _.Mesh&&void 0===r.userData.ignoreRenderMode)
// Force all materials, we don't know what material instanced groups are using
if(n.isInstanced)for(var A=0,C=(P=r.material).length;A<C;A++)P[A]&&(P[A].uniforms.opacity.value=0,P[A].originalTransparentState=P[A].transparent,// D-52155
P[A].transparent=!0,P[A].needsUpdate=!0);else x.opacity.value=0,n.transparent=!0;else if(r instanceof _.Mesh&&"OutlineShape"!==r.type)
// Restore all materials
if(n.isInstanced){var P;for(A=0,C=(P=r.material).length;A<C;A++)P[A]&&(P[A].uniforms.opacity.value=P[A].opacity,P[A].transparent=P[A].originalTransparentState?P[A].originalTransparentState:P[A].transparent,// D-52155
P[A].needsUpdate=!0)}else x.opacity.value=n.opacity,n.transparent=!(1===n.opacity);
// common matrices
return y.setValue(p,"modelViewMatrix",r.modelViewMatrix),y.setValue(p,"normalMatrix",r.normalMatrix),y.setValue(p,"modelMatrix",r.matrixWorld),f}
// Uniforms (refresh uniforms objects)
function refreshUniformsCommon(e,t){
// uv repeat and offset setting priorities
// 1. color map
// 2. specular map
// 3. normal map
// 4. bump map
// 5. alpha map
// 6. emissive map
var n;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,
// don't flip CubeTexture envMaps, flip everything else:
//  WebGLRenderTargetCube will be flipped for backwards compatibility
//  WebGLRenderTargetCube.texture will be flipped because it's a Texture and NOT a CubeTexture
// this check must be handled differently, or removed entirely, if WebGLRenderTargetCube uses a CubeTexture in the future
e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=b.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(
// backwards compatibility
n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function refreshUniformsPhong(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),// to prevent pow( 0.0, 0.0 )
t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_.BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_.BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function refreshUniformsStandard(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_.BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_.BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(
//uniforms.envMap.value = material.envMap; // part of uniforms common
e.envMapIntensity.value=t.envMapIntensity)}de.setAnimationLoop(function onAnimationFrame(e){le.isPresenting()||he&&he(e)}),"undefined"!=typeof window&&de.setContext(window),this.setAnimationLoop=function(e){he=e,le.setAnimationLoop(e),de.start()},this.supportGpuInstancing=function(){return null!=f.get("ANGLE_instanced_arrays")},
// Rendering
this.render=function(e,t,n,r){if(t&&t.isCamera){if(!R){
// reset caching for this frame
U.geometry=null,U.program=null,U.wireframe=!1,N=-1,F=null,
// update scene graph
!0===e.autoUpdate&&e.updateMatrixWorld(),
// update camera matrices and frustum
null===t.parent&&t.updateMatrixWorld(),le.enabled&&(t=le.getCamera(t)),(
//
d=T.get(e,t)).init(),e.onBeforeRender(B,e,t,n),re.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),K.setFromMatrix(re),te=this.localClippingEnabled,ee=$.init(B.clippingPlanes,te,t),(h=L.get(e,t)).init(),function projectObject(e,t){if(!1===e.visible||e.cullingLayer<=-1&&!(e instanceof _.Mesh))return;var n=e.layers.test(t.layers);if(n)if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||isObjectViewable(e)){B.sortObjects&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);var r=E.update(e),i=e.material;pushRenderItem(e,r,i,ae.z,null)}}else if(e.isImmediateRenderObject)B.sortObjects&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re),pushRenderItem(e,null,e.material,ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),
// Rebuild Face/Edge/Vertex draw groups as needed
e.needsUpdate&&"function"==typeof e.geometry.rebuildDrawGroups&&("Mesh"===e.type&&e.geometry.xtBodies&&0===e.geometry.drawMode||// Only rebuild face groups if using triangles (not strip/fan)
"EdgeShape"===e.type&&e.isLineSegments||// Only rebuild edge groups if using line segments (not strip/loop)
"VertexShape"===e.type)&&e.geometry.rebuildDrawGroups(),!e.frustumCulled||isObjectViewable(e))){B.sortObjects&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);var r=E.update(e),i=e.material;if(Array.isArray(i))for(var a=r.groups,o=0,s=a.length;o<s;o++){var l=a[o],c=i[l.materialIndex];c&&c.visible&&(pushRenderItem(e,r,c,ae.z,l),
// Handle hidden edges
"EdgeShape"===e.type&&B.renderMode===m.g.Hidden&&(c=i[3],pushRenderItem(e,r,c,ae.z,l,1)))}else i&&i.visible&&
/*currentRenderList.push*/pushRenderItem(e,r,i,ae.z,null)}
// Update culling on a visible part's shapes
var u=e.shapes;if(u&&u.length>0)for(var o=0,s=u.length;o<s;o++){var h=u[o];h.updateCulling(!(!1===h.frustumCulled||!0===isObjectViewable(h)))}
// Recurse through children
var p=e.children;if(p&&p.length>0)for(var o=0,s=p.length;o<s;o++)projectObject(p[o],t)}(e,t),!0===B.sortObjects&&h.sort(),
//
ee&&$.beginShadows();var a=d.state.shadowsArray;ce.render(a,e,t),d.setupLights(t),ee&&$.endShadows(),
//
this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n);var o=function clampPixelTolerance(e,t){if(!(t instanceof _.PerspectiveCamera))return e;var n=t.far,r=t.near,i=Math.abs(n*n/(65535*(1-r)));return Math.max(e,i)}(this.pixelTolerance,t);ne.value!==o&&(ne.value=o,ne.needsUpdate=!0),
//
A.render(h,e,t,r);
// render scene
var s=h.opaque,l=h.transparent;if(e.overrideMaterial){var c=e.overrideMaterial;s.length&&renderObjects(s,e,t,c),l.length&&renderObjects(l,e,t,c)}else
// opaque pass (front-to-back order)
s.length&&renderObjects(s,e,t),
// transparent pass (back-to-front order)
l.length&&renderObjects(l,e,t);this.renderModeNeedsUpdate&&(this.renderModeNeedsUpdate=!1),
// Generate mipmap if we're using any kind of mipmap filtering
n&&x.updateRenderTargetMipmap(n),
// Ensure depth buffer writing is enabled so it can be cleared on next render
v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),e.onAfterRender(B,e,t),le.enabled&&le.submitFrame(),
// _gl.finish();
h=null,d=null}}else
//console.error( 'THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.' );
console.error(i.b.stringsByLabel.THREEEXTENSIONS_CONSOLE_err_render)},this.allocTextureUnit=function allocTextureUnit(){var e=W;return e>=g.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+g.maxTextures),W+=1,e},
// this.setTexture2D = setTexture2D;
this.setTexture2D=function(){var e=!1;
// backwards compatibility: peel texture.texture
return function setTexture2D(t,n){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),x.setTexture2D(t,n)}}(),this.setTexture=function(){var e=!1;return function setTexture(t,n){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),x.setTexture2D(t,n)}}(),this.setTextureCube=function(){var e=!1;return function setTextureCube(t,n){
// backwards compatibility: peel texture.texture
t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),
// currently relying on the fact that WebGLRenderTargetCube.texture is a Texture and NOT a CubeTexture
// TODO: unify these code paths
t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?
// CompressedTexture can have Array in image :/
// this function alone should take care of cube textures
x.setTextureCube(t,n):
// assumed: texture property of THREE.WebGLRenderTargetCube
x.setTextureCubeDynamic(t,n)}}(),
//
this.setFramebuffer=function(e){G=e},this.getRenderTarget=function(){return D},this.setRenderTarget=function(e){D=e,e&&void 0===b.get(e).__webglFramebuffer&&x.setupRenderTarget(e);var t=G,n=!1;if(e){var r=b.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=r[e.activeCubeFace],n=!0):t=r,k.copy(e.viewport),j.copy(e.scissor),H=e.scissorTest}else k.copy(Z).multiplyScalar(Y),j.copy(J).multiplyScalar(Y),H=Q;if(V!==t&&(p.bindFramebuffer(p.FRAMEBUFFER,t),V=t),v.viewport(k),v.scissor(j),v.setScissorTest(H),n){var i=b.get(e.texture);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,n,r,i,a){if(e&&e.isWebGLRenderTarget){var o=b.get(e).__webglFramebuffer;if(o){var s=!1;o!==V&&(p.bindFramebuffer(p.FRAMEBUFFER,o),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==_.RGBAFormat&&O.convert(c)!==p.getParameter(p.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===_.UnsignedByteType||O.convert(u)===p.getParameter(p.IMPLEMENTATION_COLOR_READ_TYPE)||u===_.FloatType&&(g.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||u===_.HalfFloatType&&(g.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE?
// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)
t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&p.readPixels(t,n,r,i,O.convert(c),O.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&p.bindFramebuffer(p.FRAMEBUFFER,V)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var r=t.image.width,i=t.image.height,a=O.convert(t.format);this.setTexture2D(t,0),p.copyTexImage2D(p.TEXTURE_2D,n||0,a,e.x,e.y,r,i,0)},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,a=t.image.height,o=O.convert(n.format),s=O.convert(n.type);this.setTexture2D(n,0),t.isDataTexture?p.texSubImage2D(p.TEXTURE_2D,r||0,e.x,e.y,i,a,o,s,t.image.data):p.texSubImage2D(p.TEXTURE_2D,r||0,e.x,e.y,o,s,t.image)}}
// CONCATENATED MODULE: ./staging/SGO/WCSTrihedron.js
//Â© 2016 SIEMENS PRODUCT LIFECYCLE MANAGEMENT SOFTWARE INC
// ( function () {
//  "use strict";
/**
 * @class WCS Trihedron
 * @classdesc Represents the World Coordinate System (trihedron) for the PLMVisWeb Viewer.<br><br>
 */var fp=function(){//NOSONAR
// Private variables
var e=null,t=null,n=null,r=null,
// Default variables to set
i=100,a=100,o=10,s=10,
// User-defined variables
l=[],c=function(){!function _createObject(){var t;
// Arrows - X
e=new _.Group;var n=new _.LineBasicMaterial({color:16711680}),r=[0,0,0,20,0,0],i=[0,1];(t=new _.BufferGeometry).setIndex(new _.BufferAttribute(new Uint16Array(i),1)),t.addAttribute("position",new _.BufferAttribute(new Float32Array(r),3)),r.length=0,i.length=0;var a=new _.LineSegments(t,n),o=new _.LineBasicMaterial({color:65280});
// Arrows - Y
t=new _.BufferGeometry,r=[0,0,0,0,20,0],i=[0,1],t.setIndex(new _.BufferAttribute(new Uint16Array(i),1)),t.addAttribute("position",new _.BufferAttribute(new Float32Array(r),3)),r.length=0,i.length=0;var s=new _.LineSegments(t,o),c=new _.LineBasicMaterial({color:255});
// Arrows - Z
t=new _.BufferGeometry,r=[0,0,0,0,0,20],i=[0,1],t.setIndex(new _.BufferAttribute(new Uint16Array(i),1)),t.addAttribute("position",new _.BufferAttribute(new Float32Array(r),3)),r.length=0,i.length=0;var u=new _.LineSegments(t,c),r=[1,4,0,2,4,0,3,4,0,4,4,0,1,1,0,2,1,0,3,1,0,4,1,0,1.5,1,0,3.5,4,0,1.5,4,0,3.5,1,0],i=[0,1,2,3,4,5,6,7,8,9,10,11];
// Letters - X
(t=new _.BufferGeometry).setIndex(new _.BufferAttribute(new Uint16Array(i),1)),t.addAttribute("position",new _.BufferAttribute(new Float32Array(r),3)),r.length=0,i.length=0;var h=new _.LineSegments(t,n);h.position.set(20,0,0),
// Letters - Y
t=new _.BufferGeometry,r=[1,4,0,2,4,0,3,4,0,4,4,0,2,1,0,3,1,0,2.5,1,0,2.5,2.5,0,1.5,4,0,2.5,2.5,0,3.5,4,0],i=[0,1,2,3,4,5,6,7,8,9,9,10],t.setIndex(new _.BufferAttribute(new Uint16Array(i),1)),t.addAttribute("position",new _.BufferAttribute(new Float32Array(r),3)),r.length=0,i.length=0;var d=new _.LineSegments(t,o);d.position.set(0,20,0),
// Letters - Z
t=new _.BufferGeometry,r=[1,3.5,0,1,4,0,4,4,0,1,1,0,4,1,0,4,1.5,0],i=[0,1,1,2,2,3,3,4,4,5],t.setIndex(new _.BufferAttribute(new Uint16Array(i),1)),t.addAttribute("position",new _.BufferAttribute(new Float32Array(r),3)),r.length=0,i.length=0;var p=new _.LineSegments(t,c);p.position.set(0,0,20),e.add(a),e.add(s),e.add(u),e.add(h),e.add(d),e.add(p),l.push(h),l.push(d),l.push(p),n=null,o=null,c=null}(),function _createScene(){t=new _.Scene,i=100,a=100,n=new _.OrthographicCamera(-.25*i,.25*i,.25*a,-.25*a,-100,100),t.add(n),t.add(e)}(),function _createEventVariables(){this.mouseDown.bind(this),this.mouseUp.bind(this),this.mouseMove.bind(this)}
/**
     * Defines how to render the WCSTrihedron
     *
     * @function render
     * @memberof WCSTrihedron.prototype
     *
     */.call(this),this.original=e,this.scene=t,this.camera=n,this.size={width:i,height:a},this.position={x:o,y:s},this.boundingBox=(new _.Box3).setFromObject(e),this.boundingSphere=new _.Sphere,this.boundingBox.getBoundingSphere(this.boundingSphere),this.visible=!0,this.onTop=!0,this.front=!0,this.original.userData.ignoreRenderMode=!0};return c.prototype={constructor:c},Object.defineProperties(c.prototype,{camera:{get:function(){return n},set:function(e){n=e}},scene:{get:function(){return t},set:function(e){t=e}},viewer:{set:function(e){r=e}},visible:{get:function(){return e.visible},set:function(t){e.visible=t,r&&r.draw()}}}),c.prototype.render=function(e,r){e.setViewport(o,e.getSize().height-a-s,i,a);var c=(new _.Vector3).fromArray(r.perspective.pos),u=(new _.Vector3).fromArray(r.perspective.tgt);if(c.sub(u),c.normalize(),this.boundingSphere?c.setLength(this.boundingSphere.radius):c.setLength(50),n.position.copy(c),n.up.fromArray(r.perspective.up),n.lookAt(t.position),l&&0!==l.length)for(var h=0,d=l.length;h<d;h++)l[h].up.copy(n.up),l[h].lookAt((new _.Vector3).addVectors(n.position,l[h].position));e.render(t,n)},
/**
     * Removes attached events
     *
     * @function removeEvents
     * @memberof _WCSTrihedron.prototype
     *
     */
c.prototype.removeEvents=function(){},
/**
     * Repositions the WCS trihedron.
     *
     * @function setPosition
     * @memberof WCSTrihedron.prototype
     *
     * @param {Number} x - horizontal position in pixels from the bottom left of the viewport.
     * @param {Number} y - vertical position in pixels from the bottom left of the viewport.
     */
c.prototype.setPosition=function(e,t){o=e,s=t,this.position.x=e,this.position.y=t,null!==r&&r.draw()},
/**
     * Queries the position of the WCS
     *
     * @function getPosition
     * @memberof WCSTrihedron.prototype
     *
     * @returns {Number[]} represents the X (0) and Y (1) coordinates as measured from the bottom left of the viewport.
     */
c.prototype.getPosition=function(){return this.position},
/**
     * Sets the size of the WCS.
     *
     * @function setSize
     * @memberof WCSTrihedron.prototype
     *
     * @param {Number} w - a number used to set the width of the WCS render area.
     * @param {Number} h - a number used to set the height of the WCS render area.
     */
c.prototype.setSize=function(e,t){i=e,a=t,this.size.width=e,this.size.height=t,null!==r&&r.draw()},
/**
     * Queries the size of the WCS.
     *
     * @function getSize
     * @memberof WCSTrihedron.prototype
     *
     * @returns {Object} an object that contains the height and width (each as a number) of the WCS render area.
     */
c.prototype.getSize=function(){return this.size},
/**
     * Sets whether the WCS is rendered on top of or behind the scene geometry.
     *
     * @function setOnTop
     * @memberof WCSTrihedron.prototype
     *
     * @params {Boolean} onTop - true if on top, false if behind.
     */
c.prototype.setOnTop=function(e){this.onTop===e&&void 0!==this.onTop||(this.onTop=e,e?(this.front=!0,this.back=!1):(this.back=!0,this.front=!1),r&&r.renderOrderSGO(this))},
/**
     * Queries whether the WCS is rendered on top of or behind the scene geometry.
     *
     * @function getOnTop
     * @memberof WCSTrihedron.prototype
     *
     * @returns {Boolean} true if on top, false if behind.
     */
c.prototype.getOnTop=function(){return this.onTop},c.prototype.mouseUp=function(e){},c.prototype.mouseDown=function(e){},c.prototype.mouseMove=function(e){},new c};fp.prototype={constructor:fp,_name:"WCSTrihedron"},self.WCSTrihedron=fp;
// } )();
/* harmony default export */var mp=fp,gp=[],vp=function(e,t,n){var i=n,a=e,o=t,s=!0,l={enabled:!0,speed:1,aroundTarget:!1},c={enabled:!0,speed:.3},u={enabled:!0,speed:1.2},h={enabled:!0},d={pan:c,zoom:u,rotate:l,roll:h,clone:function(){return{pan:{enabled:c.enabled,speed:c.speed},zoom:{enabled:u.enabled,speed:u.speed},rotate:{enabled:l.enabled,speed:l.speed,aroundTarget:l.aroundTarget},roll:{enabled:h.enabled}}}},p=new _.Vector3,f=a.position.clone(),m=function(){};m.prototype={constructor:m,_name:"childApis"},Object.defineProperties(m.prototype,{navSettings:{get:function(){return d.clone()}},target:{get:function(){return p}},canvas:{get:function(){return o}},inputManager:{get:function(){return i.getInputManager()}},camera:{get:function(){return i[Vp._getCamera]()}},prevCameraPosition:{get:function(){return f}},viewer:{get:function(){return i}}}),m.prototype.updateCamera=function(e){if(e){var t=(new _.Matrix4).fromArray(e).transpose(),n=new _.Vector3,r=new _.Quaternion,a=new _.Vector3;t.decompose(n,r,a);var o=i[Vp._getCamera]();f.copy(o.position),o.position.copy(n),o.quaternion.copy(r),o.scale.copy(a),o.updateMatrixWorld(!0);var s=new _.Vector3;i._modelBBox.getCenter(s),o.worldToLocal(s),s.x=0,s.y=0,o.localToWorld(s),p.copy(s),o.lookAt(p),i[Vp._render]()}};var g,v=[],y=Object.create(m.prototype);!function(){if(vp.disableDefault)if("Navigator"===gp[gp.length-1]._name)gp.length--;else for(var e=0,t=gp.length-1;e<t;e++)if("Navigator"===gp[e].name){gp.splice(e,1);break}}();for(var b=0;b<gp.length;b++){var x;void 0!==(x=Object.create(gp[b]))._initialize&&void 0!==(g=x._initialize(y))&&v.push(g)}var w=function(){this};return(w.prototype={constructor:w}).reset=function(){for(var e=0;e<v.length;e++){var t=v[e];void 0!==t.reset&&t.reset()}},w.prototype.preupdate=function(){for(var e=0;e<v.length;e++){var t=v[e];void 0!==t.preupdate&&t.preupdate()}},w.prototype.update=function(){for(var e=0;e<v.length;e++){var t=v[e];void 0!==t.update&&t.update()}},w.prototype.dispose=function(){for(var e=0;e<v.length;e++){var t=v[e];void 0!==t.dispose&&t.dispose()}},w.prototype.handleResize=function(){for(var e=0;e<v.length;e++){var t=v[e];void 0!==t.handleResize&&t.handleResize()}},w.prototype.overrideMouseNavigationInput=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0);for(var n=0;n<v.length;n++){var i=v[n];void 0!==i.overrideMouseNavigationInput&&i.overrideMouseNavigationInput(e,t)}},w.prototype.registerCameraChangedEvent=function(e,t){r.b._isFunction(e,!0),r.b._optionalArgCheck(t,r.b._isNumber);for(var n=0;n<v.length;n++){var i=v[n];void 0!==i.registerCameraChangedEvent&&i.registerCameraChangedEvent(e,t)}},w.prototype.unregisterCameraChangedEvent=function(e,t){r.b._isFunction(e,!0),r.b._optionalArgCheck(t,r.b._isNumber);for(var n=0;n<v.length;n++){var i=v[n];void 0!==i.unregisterCameraChangedEvent&&i.unregisterCameraChangedEvent(e,t)}},w.prototype.setEventPriority=function(e,t,n){r.b._isString(e,!0),r.b._isNumber(t,!0),r.b._isString(n,!0);for(var i=!1,a=0;a<v.length&&!i;a++){var o=v[a];o.name===n&&(void 0!==o.setEventPriority&&o.setEventPriority(e,t),i=!0)}},w.prototype.getEventPriority=function(e,t){r.b._isString(e,!0),r.b._isString(t,!0);for(var n=void 0,i=!1,a=0;a<v.length&&!i;a++){var o=v[a];o.name===t&&(void 0!==o.getEventPriority&&(n=o.getEventPriority(e)),i=!0)}return n},w.prototype.setMouseEasing=function(e){if(r.b._isNumber(e,!0),e>=0&&e<=1)for(var t=!1,n=0;n<v.length&&!t;n++){var i=v[n];"Navigator"===i.name&&(void 0!==i.setMouseEasing&&i.setMouseEasing(e),t=!0)}},w.prototype.getMouseEasing=function(){for(var e=void 0,t=!1,n=0;n<v.length&&!t;n++){var r=v[n];"Navigator"===r.name&&(void 0!==r.getEventPriority&&(e=r.getMouseEasing()),t=!0)}return e},Object.defineProperties(w.prototype,{type:{value:vp,writable:!1,configurable:!1},navSettings:{enumerable:!0,get:function(){return d}},target:{enumerable:!0,get:function(){return p},set:function(e){void 0!==e.x&&void 0!==e.y&&void 0!==e.z?p.copy(e):e instanceof Array&&3==e.length&&p.fromArray(e)}},enabled:{enumerable:!0,get:function(){return s},set:function(e){s=e;for(var t=0;t<v.length;t++){var n=v[t];void 0!==n.enabled&&(n.enabled=s)}}}}),new w};
// CONCATENATED MODULE: ./staging/NavigationManager.js
vp.contribute=function(e){r.b._isObject(e,!0),gp&&-1===gp.indexOf(e)&&gp.push(e)},Object.defineProperties(vp,{disableDefault:{value:!1,writable:!0}}),vp.prototype={constructor:vp,_name:"NavigationManager"},Yn.makeContributionContainer(vp);/* harmony default export */var yp=vp,bp=o()("PLMVisWeb:debug:Shapes");
// CONCATENATED MODULE: ./staging/Shapes.js
o()("PLMVisWeb:error:Shapes").enabled=!0;o()("PLMVisWeb:warning:Shapes"),o()("PLMVisWeb:verbose:Shapes");const xp=Object.freeze({_clear:Symbol()});var _p=function(e){var t={},n=null;function _Shapes(e){n=e._parent,this._viewer=n}_Shapes.prototype={constructor:_Shapes},_Shapes.prototype.addBox=function(e){r.b._isObject(e,!0),bp("addBox",i.b.stringsByLabel.SHAPES_LOGGER_addBox+e.minX+" "+e.minY+" "+e.minZ+" "+e.maxX+" "+e.maxY+" "+e.maxZ+" "+e.color);var a=void 0;if(r.b._isNumber(e.minX)&&r.b._isNumber(e.minY)&&r.b._isNumber(e.minZ)&&r.b._isNumber(e.maxX)&&r.b._isNumber(e.maxY)&&r.b._isNumber(e.maxZ)&&r.b._isNumber(e.color)){var s=new o(e);t[s.id]=s,a=s.id,n[Vp._addAuxShape](s)}else bp("addBox",i.b.stringsByLabel.SHAPES_LOGGER_err_addBox);return a},_Shapes.prototype.addSolidBox=function(e,o,s){bp("addSolidBox",i.b.stringsByLabel.SHAPES_LOGGER_addSolidBox+e.minX+" "+e.minY+" "+e.minZ+" "+e.maxX+" "+e.maxY+" "+e.maxZ+" "+e.color),r.b._isNumber(e.depth)&&r.b._isNumber(e.width)&&r.b._isNumber(e.height)&&r.b._isArray(e.position)&&r.b._isObject(o)&&r.b._isFunction(s)?new a(e,o,function(e){t[e.id]=e,n[Vp._addAuxShape](e),s(e.id)}):bp("addSolidBox",i.b.stringsByLabel.SHAPES_LOGGER_err_addSolidBox)};var a=function(e,t,n){var i=new _.BoxBufferGeometry(e.width,e.height,e.depth),a=He.c.phongSection,o=_.UniformsUtils.clone(a.uniforms),s=r.b._isNullOrUndefined(t.diffuse)?16777215:t.diffuse,l=r.b._isNullOrUndefined(t.emissive)?[]:t.emissive,c=r.b._isNullOrUndefined(t.specular)?[]:t.specular,u=r.b._isNullOrUndefined(t.shininess)?0:t.shininess,h=r.b._isNullOrUndefined(t.opacity)?0:t.opacity;o.diffuse.value.setHex(s),o.emissive.value.setHex(l),o.specular.value.setHex(c),o.shininess.value=u,o.opacity.value=h;var d={fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:o,lights:!0,fog:!1,side:null,transparent:!1};if(r.b._notNullOrUndefined(t.texture)){var p=new _.TextureLoader,f=function(t){t.wrapS=_.RepeatWrapping,t.wrapT=_.RepeatWrapping,void 0!==t&&null!==t&&(d.uniforms.map.value=t);var r=new _.ShaderMaterial(d);r.map=t,ze.GenericShape.call(this,i,r),this.type="Box",this.position.copy((new _.Vector3).fromArray(e.position)),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),t.needsUpdate=!0,n(this)}.bind(this);p.load(t.texture,f)}else{var m=new _.ShaderMaterial(d);ze.GenericShape.call(this,i,m),this.type="Box",this.position.copy((new _.Vector3).fromArray(e.position)),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),n(this)}};a.prototype=Object.create(ze.GenericShape.prototype),a.prototype.constructor=a;var o=function(e){var t=new _.BufferGeometry,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,7,3,2,6,5,1]),r=new Float32Array([e.maxX,e.maxY,e.maxZ,e.minX,e.maxY,e.maxZ,e.minX,e.minY,e.maxZ,e.maxX,e.minY,e.maxZ,e.maxX,e.maxY,e.minZ,e.minX,e.maxY,e.minZ,e.minX,e.minY,e.minZ,e.maxX,e.minY,e.minZ]);t.addAttribute("position",new _.BufferAttribute(r,3)),t.setIndex(new _.BufferAttribute(n,1)),ze.GenericShape.call(this,t,new _.LineBasicMaterial({color:e.color}),m.A.Line),this.type="Box",this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()};o.prototype=Object.create(ze.GenericShape.prototype),o.prototype.constructor=o,_Shapes.prototype.addLine=function(e,a){r.b._isArray(e,!0,r.b._isNumber),r.b._isObject(a,!0),bp("addLine",i.b.stringsByLabel.SHAPES_LOGGER_addLine);var o=void 0;if(e.length>0&&r.b._isNumber(a.color)){var l=new s(e,a);t[l.id]=l,o=l.id,n[Vp._addAuxShape](l)}else bp("addLine",i.b.stringsByLabel.SHAPES_LOGGER_err_addLine);return o};var s=function(e,t){for(var n=new _.BufferGeometry,r=new Uint16Array(e.length/3),i=new Float32Array(e.length),a=0;a<e.length;a++)i[a]=e[a];for(a=0;a<e.length/3;a++)r[a]=a;n.addAttribute("position",new _.BufferAttribute(i,3)),n.setIndex(new _.BufferAttribute(r,1)),ze.GenericShape.call(this,n,new _.LineBasicMaterial({color:t.color}),m.A.Line),this.type="Line",this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()};s.prototype=Object.create(ze.GenericShape.prototype),s.prototype.constructor=s,_Shapes.prototype.addPlane=function(e,a,o){r.b._isArray(e,!0,r.b._isNumber),r.b._isObject(a,!0),r.b._isFunction(o,!0),bp("addPlane",i.b.stringsByLabel.SHAPES_LOGGER_addPlane);var c=void 0;if(a.opacity=r.b._isNumber(a.opacity)?a.opacity:.25,e.length>0&&r.b._isNumber(a.color)&&r.b._isNumber(a.opacity)&&r.b._isNumber(a.borderColor)&&r.b._isFunction(o)){var u=new _.Object3D,h=[];(h=e.slice(0)).push(e[0]),h.push(e[1]),h.push(e[2]);var d={};d.color=a.borderColor;var p=new s(h,d);new l(e,a,function(e){return u.add(p),u.add(e),t[u.id]=u,c=u.id,n[Vp._addAuxShape](u),o&&o(c),c})}else bp("addPlane",i.b.stringsByLabel.SHAPES_LOGGER_err_addPlane)};var l=function(e,t,n){for(var i=new _.BufferGeometry,a=new Uint16Array([0,1,3,1,2,3]),o=new Float32Array(e.length),s=0;s<e.length;s++)o[s]=e[s];if(i.addAttribute("position",new _.BufferAttribute(o,3)),i.setIndex(new _.BufferAttribute(a,1)),r.b._notNullOrUndefined(t.texture)){(new _.TextureLoader).load(t.texture,function(e){e.wrapS=_.RepeatWrapping,e.wrapT=_.RepeatWrapping;var t=new _.MeshBasicMaterial({map:e});i.addAttribute("uv",new _.BufferAttribute(new Float32Array([0,0,1,0,1,1,0,1]),2)),ze.GenericShape.call(this,i,t),this.type="Plane",this.geometry.computeVertexNormals(),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),e.needsUpdate=!0,n(this)}.bind(this))}else{var l=t.color,c=l>>16&255,u=l>>8&255,h=255&l,d=_.UniformsUtils.clone(_.ShaderLib.basic.uniforms);d.diffuse.value.setRGB(c,u,h),d.opacity.value=t.opacity;var p={fragmentShader:_.ShaderLib.basic.fragmentShader,vertexShader:_.ShaderLib.basic.vertexShader,uniforms:d,transparent:d.opacity.value<1,flatShading:!0,side:_.DoubleSide},f=new _.ShaderMaterial(p);f.opacity=d.opacity.value,ze.GenericShape.call(this,i,f),this.type="Plane",this.geometry.computeVertexNormals(),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),n(this)}};return l.prototype=Object.create(ze.GenericShape.prototype),l.prototype.constructor=l,_Shapes.prototype.removeShape=function(e){if(r.b._isNumber(e,!0),bp("removeShape",i.b.stringsByLabel.SHAPES_LOGGER_removeShape),t.hasOwnProperty(e)){var a=t[e];n[Vp._removeAuxShape](a),delete t[e],n[Vp._render]()}},_Shapes.prototype.setVisibilityById=function(e,a){(r.b._isNumber(e,!0),r.b._isBoolean(a,!0),bp("setVisibilityById",i.b.stringsByLabel.SHAPES_LOGGER_setVisibilityById),t.hasOwnProperty(e))&&(t[e].visible=a,n[Vp._render]())},_Shapes.prototype.getVisibilityById=function(e){if(r.b._isNumber(e,!0),bp("getVisibilityById",i.b.stringsByLabel.SHAPES_LOGGER_getVisibilityById),t.hasOwnProperty(e))return t[e].visible},_Shapes.prototype[xp._clear]=function(){this.clearShapes()},_Shapes.prototype.clearShapes=function(){bp("clearShapes",i.b.stringsByLabel.SHAPES_LOGGER_clearShapes),Object.keys(t).forEach(function(e){n[Vp._removeAuxShape](t[e]),delete t[e]}),n[Vp._render]()},Object.defineProperties(_Shapes.prototype,{shapeCount:{get:function(){return Object.keys(t).length}}}),new _Shapes(e)};_p.prototype={constructor:_p,_name:"Shapes"};
// CONCATENATED MODULE: ./staging/Original.js
var wp=function(e,t,n){_.Object3D.call(this),n||(n=m.E.UNKNOWN),this.name=e,this.unit=n,this.boundingBox=t,this.boundingSphere=new _.Sphere,this.boundingSphere=t?t.getBoundingSphere(this.boundingSphere):void 0,this.type="Original",this.expectedInstanceCount=0,this.instances=[],this.shapes=[]};(wp.prototype=Object.create(_.Object3D.prototype)).constructor=wp,B.prototype.apply(wp.prototype),Object.defineProperties(wp.prototype,{isLoaded:{enumerable:!0,writable:!0,value:!1},isLoading:{enumerable:!0,writable:!0,value:!1},shapesLoaded:{enumerable:!0,writable:!0,value:!1},edgesLoaded:{enumerable:!0,writable:!0,value:!1},instanceCount:{get:function(){return this.instances.length}}}),wp.prototype.dispose=function(){if(r.b._notNullOrUndefined(this.children))for(;this.children.length>0;)this.children[0].dispose();if(r.b._notNullOrUndefined(this.instances))for(;this.instances.length>0;)this.instances[0].dispose();delete this.children,delete this.instances,delete this.shapes,r.b._notNullOrUndefined(this.protoId)&&this.getScene()._prototypeContainer.removeProtoIdToObjectMap(this.protoId)};/* harmony default export */var Mp=wp;
// EXTERNAL MODULE: ./staging/InstancedShaderMaterial.js
n(9);
// CONCATENATED MODULE: ./staging/events/ObjectEvent.js
const Ep=Symbol(),Sp=Symbol(),Lp=Symbol(),Tp=Symbol(),Ap=Symbol(),Cp=Symbol(),Pp=Symbol();function ObjectEvent(e,t){if(0===arguments.length)throw new TypeError("Failed to construct 'ObjectEvent': 1 argument required, but only 0 present.");if(void 0!==t&&typeof t!=typeof{})throw new TypeError("Failed to construct 'Event': parameter 2 ('eventInitDict') is not an object.");Object.defineProperty(this,Ep,{value:{},enumerable:!1,writable:!1,configurable:!1});const n=this[Ep];n[Tp]=Date.now(),n[Lp]=null===e?"null":void 0===e?typeof e:e.toString(),n[Sp]=!1,n[Ap]=!(!t||!t.cancelable),n[Cp]=!(!t||!t.consumable),n[Pp]=!1}Object.assign(ObjectEvent.prototype,{constructor:ObjectEvent,preventDefault:function(){this[Ep][Ap]&&!this[Ep][Sp]&&(this[Ep][Sp]=!0)},consume:function(){this[Ep][Cp]&&!this[Ep][Pp]&&(this[Ep][Pp]=!0)}}),Object.defineProperties(ObjectEvent.prototype,{type:{enumerable:!0,configurable:!1,get:function(){return this[Ep][Lp]}},defaultPrevented:{enumerable:!0,configurable:!1,get:function(){return this[Ep][Sp]}},cancelable:{enumerable:!0,configurable:!1,get:function(){return this[Ep][Ap]}},consumable:{enumerable:!0,configurable:!1,get:function(){return this[Ep][Cp]}},consumed:{enumerable:!0,configurable:!1,get:function(){return this[Ep][Pp]}}})
/* harmony default export */;var Ip=ObjectEvent;
// CONCATENATED MODULE: ./staging/events/ObjectEventTarget.js
const Op=Symbol();function ObjectEventTarget(){this[Op]={}}Object.assign(ObjectEventTarget.prototype,{addEventListener:function(e,t){(function ObjectEventTarget_addEventListener(e,t){const n=this[Op];void 0===n[e]&&(n[e]=[]);let r=n[e].indexOf(t);return-1===r&&(n[e].push(t),r=n[e].length-1),r}).call(this,e,t)},removeEventListener:function(e,t){(function ObjectEventTarget_removeEventListener(e,t){const n=this[Op][e];if(void 0!==n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}).call(this,e,t)},dispatchEvent:function(e){(function ObjectEventTarget_dispatchEvent(e){const t=this[Op];return void 0===t[e.type]||(t[e.type].forEach(t=>{e.defaultPrevented||t.call(this,e)}),!e.defaultPrevented)}).call(this,e)}});
// CONCATENATED MODULE: ./staging/events/JavaScriptObjectEvents.js
// CONCATENATED MODULE: ./staging/Viewer.js
var Bp=o()("PLMVisWeb:debug:Viewer"),Rp=o()("PLMVisWeb:error:Viewer");Rp.enabled=!0;var Gp=o()("PLMVisWeb:warning:Viewer"),Dp=o()("PLMVisWeb:verbose:Viewer");const Vp=Object.freeze({_stopRenderLoopDeferred:Symbol(),_addEventListener:Symbol(),_removeEventListener:Symbol(),_render:Symbol(),_ignoreSGO:Symbol(),_animationLoop:Symbol(),_renderLoopActive:Symbol(),_updateModelBoundingBox:Symbol(),_expandModelBoundingBox:Symbol(),_setSize:Symbol(),_getCamera:Symbol(),_getVisibleModelBoundingBox:Symbol(),_fireMouseOverEvents:Symbol(),_fireProgressEvents:Symbol(),_firePropertyChangedEvent:Symbol(),_registerModuleEvent:Symbol(),_unregisterModuleEvent:Symbol(),_fireModuleEvent:Symbol(),_addAuxShape:Symbol(),_removeAuxShape:Symbol(),_updateAuxShape:Symbol(),_getBBox:Symbol(),_getVisiblePartCount:Symbol(),_fireObjectLoadedCallbacks:Symbol(),_getStructureHelper:Symbol(),_clearSectionShapes:Symbol(),_setHashBothSectionSide:Symbol(),_addSectionEdges:Symbol(),_addSectionCaps:Symbol(),_loadGeometryHelper:Symbol()});var Np=function(e){var t="-1",n=0,a={},o=null,s=null,l=null,c=null,u=m.c.PERSPECTIVE,h=m.t.CONTEXT,d=!0,p=null,f=null,g=null,v=null,b=null,w=null,M=null,E=null,S=!1,L=!1,T=!1,A=!1,C=new _.Vector3,P=!1,I=!1,O="XYZ",B=!1,R=0,G={color:new _.Color(0),alpha:0},D=0,V=0,N=[],U=[],F={},z=[],k=[],j=[],H={},W=!1,X=null,q=!1,Y=!1,Z=void 0,J=null,Q=!1,K=null,$=null,ee=null,te=null,ne=_.DoubleSide,re=m.C.NEGATIVE_Z,ie=!0,ae=25,oe=!1,se=m.g.Shaded,le=!1,ue=null,he=null,de=null,pe=null,fe=null,me=!1,ge=!1,ve=m.j.Distance,ye=-1,be=1e3/60,xe=Date.now(),_e=[],we=[],Me=[],Ee=[],Se=null,Le=!1,Te=!1,Ae=!1,Pe=new Ip("resize",{cancelable:!1,consumable:!1}),Ie={},Oe=null,Be=null,Re=null,De=null,Ve=null,Ne={};function renderLoopControlMouseWheel(){this.startRenderLoop(),this.stopRenderLoop()}function _Viewer(t){if(Bp(i.b.stringsByLabel.VIEWER_LOGGER_Constructor),ObjectEventTarget.call(this),this._networkManager=t.networkManager||new sa,t.customLoader)this.setLoader(t.customLoader);else{this._workerPool=new la.a(this,["BodWorker","XTBodWorker","EdgeWorker"],this._networkManager,t.webworkerCount);var n=new fo({workerPool:this._workerPool});Oe=n,n.viewer=this,n.networkManager=this._networkManager,this._loader=n}o=t._parent,this._parentControl=o;var a=t&&void 0!==t.width?t.width:1,l=t&&void 0!==t.height?t.height:1;s=t&&void 0!==t.jt2go?new WebGLRenderer({antialias:!0}):new WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),function _setInElement(e){e.appendChild(s.domElement),s.domElement.style.position="relative",s.domElement.style.zIndex=r.b._getZ(e)+1}(t.domElement),s.autoClear=!1,t&&void 0!==t.bgcolor&&s.setClearColor(t.bgcolor),Ve=t&&void 0!==t.inputManager&&void 0!==t.inputManager.initialize?t.inputManager.initialize(this):new $n(this),this._inputManager=Ve,this._inputManager.addEventListener($n.EventTypes.Scroll,renderLoopControlMouseWheel.bind(this)),s.setSize(a,l),s.domElement.position="relative",s.domElement.top="0",s.domElement.left="0",s.context.depthRange(.1,1);var h=s.supportGpuInstancing();r.b._isBoolean(e.useGpuInstancing)&&(h=h&&e.useGpuInstancing),c=new yr(h),(p=new _.PerspectiveCamera(28,a/l,1,1e4)).position.z=99999,c.add(p),g=p,f=new _.OrthographicCamera(a/l*-12,a/l*12,12,-12,1,1e4),c.add(f),(v=new yp(g,s.domElement,this)).dynamicDampingFactor=.3,v.target=[0,0,0],v.enabled=!1;for(var y=new MutationObserver(function(e){e.forEach(function(e){"style"===e.attributeName&&"none"!==e.target.style.display&&v.handleResize()})}),x=t.domElement;null!==x.parentElement&&"body"!==x.parentElement.localName;)x=x.parentElement;y.observe(x,{attributes:!0,attributeFilter:["style"],subtree:!0}),K=function _doMouseDown(e){0!==e.button&&1!==e.button||(S=!1,C.x=e.offsetX,C.y=e.offsetY);var t={type:m.i.MouseDown,event:e,override:!1};if(c.dispatchEvent(t),t.override)return;A=!0,!0===W&&function _selectObjectForDrag(e){var t=this[Vp._getCamera](),n=r.b._getObjectAtViewportCoordinate(e.offsetX,e.offsetY,s.domElement,c,De,t,m.x.FREE,B),i=null;xt&&this.isExtensionLoaded(xt)&&(i=this.getExtensionManager(xt));if(n){var a=n.object;if("SectionPlane"===a.type)return;if(i&&a.isPmi)return void i[bt._setObjectSelection](a,!a.selected);if(a instanceof _.Sprite){var o=n.point.clone(),l=v.target.clone(),u=l.sub(t.position).normalize(),h=(new _.Plane).setFromNormalAndCoplanarPoint(u,o),d=n.ray.intersectPlane(h);n.point=d}(function _getSelectedObject(e){var t=e.object;if(t instanceof _.Sprite)_addToMovableObjects(t),_setPlanePosition(e);else{for(t.sectionEdges&&this[Vp._clearSectionShapes](t),(c.pickingMode&m.x.PART)!==m.x.PART&&(c.pickingMode&m.x.FREE)!==m.x.FREE||!("PartShape"===t.type||t instanceof _.LineSegments)||(t=t.parent);t&&t.selected&&t.id!==b.id;)t=t.parent;t.id===b.id&&t.selected?Re[Di._setObjectSelection](t,t.selected):t&&null!==t.id&&void 0!==t.id&&Re[Di._setObjectSelection](t,!t.selected)}t.selected&&(_addToMovableObjects(t),_setPlanePosition(e));this[Vp._render]()}).call(this,n,e)}else{var p=Ie;for(var f in p)p[f]&&(p[f].selected=!1,Re[Di._fireSelectionChangeEvents](p[f]),delete p[f]);Re[Di._setObjectSelection](b,!1),i&&i[bt._clearSelection]()}Re[Di._fireSelectionEvents].call(this)}.call(this,e);var n=!1,i=null;$i&&this.isExtensionLoaded($i)&&0!==(i=this.getExtensionManager($i))._sectionPlanesCount()&&(n=!0);n&&(function _selectSectionForDrag(e){var t,n;e.touches&&e.touches.length>0?(t=e.touches[0].pageX,n=e.touches[0].pageY):(t=e.offsetX,n=e.offsetY);var i,a=this[Vp._getCamera](),o=r.b._getObjectAtViewportCoordinate(t,n,s.domElement,c,De,a,m.x.FREE,!1,!0);$i&&this.isExtensionLoaded($i)&&(i=this.getExtensionManager($i));if(o){var l=o.object;if(ue&&ue!==l&&ue.selected&&i.setSelectionById(ue.id,!1),"SectionPlane"===l.type){ue=l,pe=o.point,i.setSelectionById(ue.id,!0),_setPlanePosition(o);var u=Ie;for(var h in u)u[h]&&(u[h].selected=!1,Re[Di._fireSelectionChangeEvents](u[h]),delete u[h])}}else ue&&(i.setSelectionById(ue.id,!1),ue=null),this.setMouseNavigationEnabled(d)}.call(this,e),null!==ue&&i&&(L=me,T=ge,me=!1,ge=!1,i.updateSection()));if(Ci&&this.isExtensionLoaded(Ci)){var a=this.getExtensionManager(Ci);a.dimensionCount>0&&function _selectDimensionForDrag(e){var t=this[Vp._getCamera](),n=r.b._getObjectAtViewportCoordinate(e.offsetX,e.offsetY,s.domElement,c,De,t,c.pickingMode,!1,!1);if(n){var i=n.object;if(i instanceof Vr){he={obj:i,dimComponent:n.dimComponent},de=null;var a=new _.Vector3;n.ray.closestPointToPoint(n.point,a),pe=a,fe=n.point,e.override=!0}}else he&&(he=null),this.setMouseNavigationEnabled(d)}.call(this,e)}}.bind(this),$=function _doMouseUp(e){var t={type:m.i.MouseUp,event:e,override:!1};if(c.dispatchEvent(t),t.override)return;if(A){if(!0===W){if(X=null,this.setMouseNavigationEnabled(d),S){for(var n in Ie)Ie[n]&&this._scene.updateIndexedObject(Ie[n]);S=!1}this.stopRenderLoop()}else 0!==e.button&&1!==e.button||(!S&&E?function _pickObject(e){if(S||Re.getAreaSelect())return;var t=this.getExtensionManager(Ci);t&&(De=t._getScene());var n=r.b._getObjectAtViewportCoordinate(e.offsetX,e.offsetY,s.domElement,c,De,this[Vp._getCamera](),c.pickingMode),i=null===n?null:n.object,a=null===n?null:n.point,o=null===n?null:n.parent,l=this.getExtensionManager(xt),u=this.getExtensionManager(Hn),h=e.ctrlKey||Re.getSelectionToggleMode(),d={ctrl:e.ctrlKey,alt:e.altKey};n&&n.pointIndex&&(d.pickIndex=n.pointIndex);i instanceof _.Sprite&&(d.psId=i.name);if(oe){var p=this.getCameraOrientationInfo(),f=[];return f.push(a.x-p.tgt[0]+p.pos[0]),f.push(a.y-p.tgt[1]+p.pos[1]),f.push(a.z-p.tgt[2]+p.pos[2]),p.pos=f,p.tgt=a.clone().toArray(),void this.setCameraOrientationInfo(p)}var g=l&&i&&i.isPmi;if(t&&i instanceof Vr){d.dimensionId=i.id;var v=n.dimComponent;v&&(d.dimensionComponentType=v.componentType,d.dimensionSide=v.side)}else g&&(i=l[bt._getPmiObject](i),n.pointIndex&&(i.userData.pointIndex=n.pointIndex));if(i){if(i.userData&&(d.psId=i.userData.psId),a&&(d.pickPt=a.toArray()),Re[Di._firePickingEvents](d),Re.getPickOnly())return;if(g)return void l.setSelectionByPsId(i.userData.psId,!i.selected,!0,h);if(Re[Di._clearHighlightBuffer](),!h&&(i.selected||Re[Di._clearSelectionBuffer](),Re.getPickingMode()===m.x.FREE))for(;i&&i.selected&&i.id!==b.id;)i=i.parent;u&&u.mode===m.p.PointDistance&&(n.object=c.setPoint(o,i,n.face.normal),i=n.object),i.id===b.id&&i.selected?Re[Di._setObjectSelection](i,i.selected,n):i&&null!==i.id&&void 0!==i.id&&Re[Di._setObjectSelection](i,!i.selected,n)}else(!Re.getSelectionToggleMode()||Re.getSelectionToggleMode()&&null===n)&&(Re.selectNone(),Re[Di._firePickingEvents](d));Re[Di._fireSelectionEvents]()}.call(this,e):(S=!1,this.stopRenderLoop()));if($i&&this.isExtensionLoaded($i)&&null!==ue){var i=this.getExtensionManager($i);me=L,ge=T,i.updateSection(),ue=null}A=!1,he&&(he=null),v.enabled=d}}.bind(this),ee=function _doMouseMove(e){var t={type:m.i.MouseMove,event:e,override:!1};if(c.dispatchEvent(t),t.override)return;if(A)e.offsetX===C.x&&e.offsetY===C.y||(this.startRenderLoop(),S=!0,((W||ue)&&X||he)&&function _doDrag(e){var t,n,r=this[Vp._getCamera](),i=s.domElement;e.touches&&e.touches.length>0?(t=e.touches[0].pageX,n=e.touches[0].pageY):(t=e.offsetX,n=e.offsetY);C.set(t/i.offsetWidth*2-1,1-n/i.offsetHeight*2,1),C.unproject(r);var a=new je.a(r.position,C.sub(r.position).normalize());if(0!==Object.keys(Ie).length)(function _objectRelocation(e,t){var n=t.ray.intersectPlane(X,We),r=Ie;for(var i in r)if(r[i]){var a=r[i];if(a!==b){var o=n.clone().sub(a.userData._dragOffset);_setObjectPosition.call(this,e,t,o,a)}else{for(var s=0;s<b.children.length;s++){a=b.children[s];var o=n.clone().sub(a.userData._dragOffset);_setObjectPosition.call(this,e,t,o,a)}a=b}}}).call(this,O,a);else{var o=new _.Vector3;if(ue&&!he){var l=new _.Vector3,c=l.subVectors(b.position,r.position),u=c.angleTo(ue.sectionDirection);if(u>.1*Math.PI&&u<.9*Math.PI){l.crossVectors(a.ray.direction,ue.sectionDirection);var h=l.cross(ue.sectionDirection).normalize(),d=(new _.Plane).setFromNormalAndCoplanarPoint(h,pe);a.ray.intersectPlane(d,l),o.subVectors(l,pe),o.projectOnVector(ue.sectionDirection);var p=(new _.Vector3).copy(ue.sectionPosition).add(o);ue.sectionPosition=p}}else if(he){a.ray.closestPointToPoint(pe,o),o.sub(pe);var f=this.getExtensionManager(Ci),m=he.dimComponent;if(f&&m){var g={dragVector:o.toArray(),dragStart:fe.toArray(),type:m.componentType,side:m.side};f.updatePosition(he.obj.id,g),o.fromArray(g.dragVector)}}pe.add(o),this[Vp._updateModelBoundingBox]()}v.enabled=!1}.call(this,e));else if(e.currentTarget===s.domElement){var n,i=this.getExtensionManager(Ci);i&&(De=i._getScene());var a=q||Y;(a||N.length>0)&&(n=r.b._getObjectAtViewportCoordinate(e.offsetX,e.offsetY,s.domElement,c,De,this[Vp._getCamera](),c.pickingMode));var o=!0,l=n?n.object:null,u={};if(a)if(Re[Di._clearHighlightBuffer](),i&&de&&(i.setHighlightByDimId(de.id,!1),l!==de&&(u.dimensionId=de.id,u.highlight=!1,i.dispatchEvent(Ci.EventTypes.HoverChanged,u))),de=null,l instanceof Vr){if(i&&!i.getSelectionByDimId(l.id)&&Y){de=l,i.setHighlightByDimId(de.id,!0),u.dimensionId=l.id;var h=n.dimComponent;h&&(u.dimensionComponentType=h.componentType,u.dimensionSide=h.side),u.highlight=!0,u.point=n.point,i.dispatchEvent(Ci.EventTypes.HoverChanged,u)}}else q&&l&&Re[Di._setObjectHighlight](l,!0);(N.length>0||U.length>0)&&(n&&(u.point=n.point.toArray()),l&&l.userData&&l.userData.psId?((o=Z!==l.userData.psId)&&(u.psId=l.userData.psId,u.type=l.type),Z=l.userData.psId):Z&&(Z=void 0),o&&this[Vp._fireMouseOverEvents](u))}}.bind(this),this._inputManager.addEventListener($n.EventTypes.Move,ee),this._inputManager.addEventListener($n.EventTypes.Down,K),this._inputManager.addEventListener($n.EventTypes.Up,$),this.setMouseNavigationEnabled(d),b=c.modelObject,(w=new _.Box3).min.set(0,0,0),w.max.set(0,0,0),M=[new _.Vector3(0,0,0),new _.Vector3(0,0,0),new _.Vector3(0,0,0),new _.Vector3(0,0,0),new _.Vector3(0,0,0),new _.Vector3(0,0,0),new _.Vector3(0,0,0),new _.Vector3(0,0,0)],_updateLightRig(),null===E&&this.setPickingEnabled(!0),this._scene=c,this._renderer=s,this._pCamera=p,this._oCamera=f,this._currentCamera=g,this._cameraControls=v,this._modelObject=b,this._modelBBox=w,this._loader=Oe,this._renderer=s,te=this[Vp._animationLoop].bind(this),Re=new Ui(this,c,b),this._selectionMngr=Re,this.setCameraMode(u),r.b._isFunction(mp)&&(Se=new mp,this.addSGO(Se)),r.b._isNumber(t.standardView)&&(re=t.standardView),this.setCameraToStandardView(re,!1,!1),this[Vp._render]()}function _updateLightRig(){c.updateLights(g)}function _updateOrthoCamera(){if(f){f.position.copy(p.position),f.up.copy(p.up),f.lookAt(v.target);var e=(new _.Vector3).subVectors(v.target.clone(),p.position).length(),t=Math.tan(Math.PI/180*p.fov/2)*e,n=t*p.aspect;f.left=-n,f.right=n,f.top=t,f.bottom=-t,f.zoom=p.zoom,f.updateProjectionMatrix()}}function _updatePerspectiveCamera(){p&&(p.position.copy(f.position),p.up.copy(f.up),p.lookAt(v.target),p.zoom=f.zoom,p.updateProjectionMatrix())}function _setTransparencyFlag(e){le=!1;for(var t=0,n=e.length;t<n&&!le;t++)e[t]&&!0===e[t].transparent&&(le=!0)}Ne[$n.EventTypes.Down]=1/0,Ne[$n.EventTypes.Move]=1/0,Ne[$n.EventTypes.Up]=1/0,Ne[$n.EventTypes.Scroll]=1/0,Object.assign(_Viewer.prototype,ObjectEventTarget.prototype,{constructor:_Viewer,psId:t}),_Viewer.prototype.getInputManager=function(){return this._inputManager},_Viewer.prototype.getNavigationManager=function(){return this._cameraControls},y.prototype._apply(_Viewer),Object.defineProperties(_Viewer.prototype,{_extensions:{get:function(){return a}},domElement:{get:function(){return s.domElement}}}),_Viewer.prototype.startRenderLoop=function(){if(Bp("startRenderLoop",i.b.stringsByLabel.VIEWER_LOGGER_startRenderLoop),null!==c)if(null===l){if(Xa&&this.isExtensionLoaded(Xa)){var e=this.getExtensionManager(Xa);e._setSuspended(e.getSuspendOnMovement())}te()}else null!==Be&&(clearTimeout(Be),clearTimeout(J),Be=null,J=null);else Gp(i.b.stringsByLabel.VIEWER_CONSOLE_startRenderLoop)},_Viewer.prototype[Vp._stopRenderLoopDeferred]=function(){null!==l&&(cancelAnimationFrame(l),l=null,Be=null)},_Viewer.prototype.stopRenderLoop=function(){Bp("stopRenderLoop",i.b.stringsByLabel.VIEWER_LOGGER_stopRenderLoop),null!==l&&null===Be&&!0!==Ae&&(Be=setTimeout(this[Vp._stopRenderLoopDeferred].bind(this),400),J=setTimeout(function(){if(Xa&&this.isExtensionLoaded(Xa)){var e=this.getExtensionManager(Xa);e.getSuspendOnMovement()&&(e._setSuspended(!1),this[Vp._render]())}J=null}.bind(this),375))},_Viewer.prototype.setMouseNavigationEnabled=function(e){r.b._optionalArgCheck(e,r.b._isBoolean),Bp("setMouseNavigationEnabled",i.b.stringsByLabel.VIEWER_LOGGER_setMouseNavigationEnabled+e),r.b._isBoolean(e)||(e=!0),null!==v?v.enabled=e:Dp("setMouseNavigationEnabled",i.b.stringsByLabel.VIEWER_LOGGER_warn_setMouseNavigationEnabled),d=e},_Viewer.prototype.zoomToCursor=function(e){r.b._optionalArgCheck(e,r.b._isBoolean),Bp("zoomToCursor",i.b.stringsByLabel.VIEWER_LOGGER_zoomToCursor+e),r.b._isBoolean(e)||(e=!1),null!==v?v.navSettings.zoom.enabled=!e:Dp("zoomToCursor",i.b.stringsByLabel.VIEWER_LOGGER_warn_zoomToCursor)},_Viewer.prototype.rotateAroundTheCameraTarget=function(e){r.b._optionalArgCheck(e,r.b._isBoolean),Bp("rotateAroundTheCameraTarget",i.b.stringsByLabel.VIEWER_LOGGER_rotateAroundTheCameraTarget+e),r.b._isBoolean(e)||(e=!1),null!==v?v.navSettings.rotate.aroundTarget=e:Dp("rotateAroundTheCameraTargetursor",i.b.stringsByLabel.VIEWER_LOGGER_warn_rotateAroundTheCameraTarget)},_Viewer.prototype.isZoomingToCursor=function(){return Bp("isZoomingToCursor",i.b.stringsByLabel.VIEWER_LOGGER_isZoomingToCursor),!v.navSettings.zoom.enabled},_Viewer.prototype.getMouseNavigationEnabled=function(){return Bp("getMouseNavigationEnabled",i.b.stringsByLabel.VIEWER_LOGGER_getMouseNavigationEnabled),d},_Viewer.prototype[Vp._registerModuleEvent]=function(e){r.b._isObject(e,!0),-1===r.b._eventMapIndex(j,e)&&j.push(e)},_Viewer.prototype[Vp._unregisterModuleEvent]=function(e){r.b._isObject(e,!0),-1!==r.b._eventMapIndex(j,e)&&j.splice(idx,1)},_Viewer.prototype[Vp._fireModuleEvent]=function(e,t){j.forEach(n=>{r.b._isFunction(n[e])&&n[e](t)})},_Viewer.prototype.clearScene=function(){Bp("clearScene",i.b.stringsByLabel.VIEWER_LOGGER_clearScene);var e=Object.keys(a),t=e.length||0;Dp("clearScene",i.b.stringsByLabel.VIEWER_LOGGER_fine_clearScene+t);for(var n=0;n<t;++n)r.b._isFunction(a[e[n]]._clear)?(Dp("clearScene",i.b.stringsByLabel.VIEWER_LOGGER_finest_clearScene+n),a[e[n]]._clear()):r.b._isFunction(a[e[n]].clear)?(Dp("clearScene",i.b.stringsByLabel.VIEWER_LOGGER_finest_clearScene+n),a[e[n]].clear()):Dp("clearScene",i.b.stringsByLabel.VIEWER_LOGGER_finest2_clearScene+n);if(this[Vp._fireModuleEvent]("clear",null),b.selected=!1,b.visibilityState=m.D.None,b.visible=P,F={},r.b._notNullOrUndefined(b.children))for(var o=b.children.length-1;o>=0;--o)r.b._isFunction(b.children[o].dispose)&&b.children[o].dispose();c.clear(),R=0,D=0,V=0,this.setCameraToStandardView(re,!1,!1),b.clearPsIdToObjectMap(),Re.clearOnTopEdges(),this[Vp._render](),Bp("clearScene",i.b.stringsByLabel.VIEWER_LOGGER_info2_clearScene)},_Viewer.prototype.registerCameraChangedEvent=function(e,t){r.b._isFunction(e,!0),r.b._optionalArgCheck(t,r.b._isNumber),Bp("registerCameraChangedEvent",i.b.stringsByLabel.VIEWER_LOGGER_registerCameraChangedEvent),v.registerCameraChangedEvent(e,t)},_Viewer.prototype.unregisterCameraChangedEvent=function(e,t){r.b._isFunction(e,!0),r.b._optionalArgCheck(t,r.b._isNumber),Bp("unregisterCameraChangedEvent",i.b.stringsByLabel.VIEWER_LOGGER_unregisterCameraChangedEvent),v.unregisterCameraChangedEvent(e,t)},_Viewer.prototype.registerSelectionEvent=function(e){r.b._isFunction(e,!0),Re.registerSelectionEvent(e)},_Viewer.prototype[Vp._addEventListener]=function(e,t){c.addEventListener(e,t)},_Viewer.prototype[Vp._removeEventListener]=function(e,t){c.removeEventListener(e,t)},_Viewer.prototype.unregisterSelectionEvent=function(e){r.b._isFunction(e,!0),Re.unregisterSelectionEvent(e)},_Viewer.prototype.registerSelectionChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),Re.registerSelectionChangeEventByPsId(e,t)},_Viewer.prototype.unregisterSelectionChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),Re.unregisterSelectionChangeEventByPsId(e,t)},_Viewer.prototype.setSelectionByPsId=function(e,t,n){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isBoolean),Re.setSelectionByPsId(e,t,n)},_Viewer.prototype.setSelectionByPsIds=function(e,t,n){r.b._isArray(e,!0,r.b._isString),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isBoolean),Re.setSelectionByPsIds(e,t,n)},_Viewer.prototype.clearSelection=function(e){r.b._optionalArgCheck(e,r.b._isBoolean),Re&&Re[Di._clearSelectionBuffer](e)},_Viewer.prototype.getSelectionByPsId=function(e){return r.b._isString(e,!0),Re.getSelectionByPsId(e)},_Viewer.prototype.getSelectedParts=function(){return Re.getSelectedParts()},_Viewer.prototype.getSelectedBodies=function(){return Re.getSelectedBodies()},_Viewer.prototype.getSelectedFaces=function(){return Re.getSelectedFaces()},_Viewer.prototype.getSelectedEdges=function(){return Re.getSelectedEdges()},_Viewer.prototype.getSelectedVerticesInfo=function(){return Re.getSelectedVerticesInfo()},_Viewer.prototype.selectNone=function(){Re.selectNone(),he&&(he=null)},_Viewer.prototype.setPickingModes=function(e){r.b._isArray(e,!0,r.b._isNumber),Re.setPickingModes(e)},_Viewer.prototype.setPickingMode=function(e){r.b._isNumber(e,!0),Re.setPickingMode(e)},_Viewer.prototype.getPickingMode=function(){return Re.getPickingMode()},_Viewer.prototype.setPartialAreaSelect=function(e){r.b._isBoolean(e,!0),Re.setPartialAreaSelect(e)},_Viewer.prototype.getPartialAreaSelect=function(){return Re.getPartialAreaSelect()},_Viewer.prototype.findObjectsInArea=function(e,t,n,i,a,o){return r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(i,!0),r.b._optionalArgCheck(a,r.b._isBoolean),r.b._optionalArgCheck(o,r.b._isNumber),Re.findObjectsInArea(e,t,n,i,a,o)},_Viewer.prototype.setAreaSelect=function(e){r.b._isBoolean(e,!0),Re.setAreaSelect(e)},_Viewer.prototype.setSelectionToggleMode=function(e){r.b._isBoolean(e,!0),Re.setSelectionToggleMode(e)},_Viewer.prototype.getSelectionToggleMode=function(){return Re.getSelectionToggleMode()},_Viewer.prototype.getAreaSelect=function(){return Re.getAreaSelect()},_Viewer.prototype.setSelectionMaterial=function(e){r.b._isObject(e,!0),Re.setSelectionMaterial(e.color,e.ambient,e.emissive,e.specular,e.shininess,e.opacity),e.opacity&&e.opacity<1&&this.setTransparentRenderingFlag(!0)},_Viewer.prototype.setHighlightingMaterial=function(e){r.b._isObject(e,!0),Re.setHighlightingMaterial(e.color,e.ambient,e.emissive,e.specular,e.shininess,e.opacity),e.opacity&&e.opacity<1&&this.setTransparentRenderingFlag(!0)},_Viewer.prototype[Vp._render]=function(e,t){if(u===m.c.ORTHOGRAPHIC&&_updatePerspectiveCamera(),_updateOrthoCamera(),ie||t){s.materialSide=ne,(e=void 0===e||e)&&s.clear(!0,!0,!0),_updateLightRig(),function _updateDepthBuffer(){if(g&&w){M[0].set(w.min.x,w.min.y,w.min.z),M[1].set(w.min.x,w.min.y,w.max.z),M[2].set(w.min.x,w.max.y,w.min.z),M[3].set(w.max.x,w.min.y,w.min.z),M[4].set(w.max.x,w.max.y,w.min.z),M[5].set(w.max.x,w.min.y,w.max.z),M[6].set(w.min.x,w.max.y,w.max.z),M[7].set(w.max.x,w.max.y,w.max.z);var e=new _.Vector3;e.copy(p.position),e.sub(v.target);for(var t=-1,n=-1,r=0,i=0,a=0;a<8;++a)M[a].sub(v.target),M[a].projectOnVector(e),r=M[a].length()*(M[a].dot(e)/e.length()>=0?1:-1),i=e.length()-r,(-1==t||i<t)&&(t=i),(-1==n||i>n)&&(n=i);var o=Math.max(t,.1);p.near=Math.min(o,.1*n),p.far=n,p.updateProjectionMatrix(),f.near=t<0?t:.8*t,f.far=1.2*n,f.updateProjectionMatrix()}}();for(var n=Object.keys(a),i=0,o=n.length;i<o;++i)void 0!==a[n[i]]._preRender&&a[n[i]]._preRender();this[Vp._fireModuleEvent]("preRender",null);var l=this.getCameraInfo(!1);if(!Le)for(var h=0,d=we.length;h<d;h++)we[h].scene.updateMatrixWorld(!0),we[h].render(s,l);s.clear(!1,!0,!1),s.setViewport(0,0,s.domElement.width,s.domElement.height),s.pixelTolerance=r.b._calculatePixelScale(g,s.domElement),s.render(c,g),this.isExtensionLoaded(Ci)&&!this.getExtensionManager(Ci).onTop&&this.getExtensionManager(Ci)._render(s,g);for(i=0,o=n.length;i<o;++i)void 0!==a[n[i]]._postRender&&a[n[i]]._postRender();if(this[Vp._fireModuleEvent]("postRender",null),Le)Re._render(s,g),this.isExtensionLoaded(Ci)&&this.getExtensionManager(Ci).onTop&&(s.context.depthRange(.05,.1),this.getExtensionManager(Ci)._render(s,g),s.context.depthRange(.1,1));else{for(h=0,d=Me.length;h<d;h++)Me[h].scene.updateMatrixWorld(!0),Me[h].render(s,l);Re._render(s,g),this.isExtensionLoaded(Ci)&&this.getExtensionManager(Ci).onTop&&(s.setViewport(0,0,s.domElement.width,s.domElement.height),s.context.depthRange(.05,.1),this.getExtensionManager(Ci)._render(s,g)),s.context.depthRange(0,.05);for(h=0,d=Ee.length;h<d;h++)Ee[h].scene.updateMatrixWorld(!0),Ee[h].render(s,l);s.context.depthRange(.1,1)}v.update(),c.pixelScale=s.pixelTolerance,c.update()}},_Viewer.prototype.getTransparentRenderingFlag=function(){return Bp("getTransparentRenderingFlag",i.b.stringsByLabel.VIEWER_LOGGER_getTransparentRenderingFlag+le),le},_Viewer.prototype.setTransparentRenderingFlag=function(e){r.b._isBoolean(e,!0),Bp("setTransparentRenderingFlag",i.b.stringsByLabel.VIEWER_LOGGER_setTransparentRenderingFlag+e),le=e},_Viewer.prototype.setFPS=function(e){r.b._isNumber(e,!0),Bp("setFPS",i.b.stringsByLabel.VIEWER_LOGGER_setFPS+e),e>=1&&e<=60?be=1e3/e:Dp("setFPS",i.b.stringsByLabel.VIEWER_LOGGER_setFPS_warn)},_Viewer.prototype.getFPS=function(){var e=Math.round(1e3/be);return Bp("getFPS",i.b.stringsByLabel.VIEWER_LOGGER_getFPS+e),e},_Viewer.prototype[Vp._ignoreSGO]=function(e){e!==Le&&(Le=e)},_Viewer.prototype.addSGO=function(e){r.b._isObject(e,!0),Bp("addSGO",i.b.stringsByLabel.VIEWER_LOGGER_addSGO),e.viewer=this,_e.push(e),e.front?Ee.push(e):e.back?we.push(e):(Me.push(e),this[Vp._updateModelBoundingBox]()),this[Vp._render]()},_Viewer.prototype.removeSGO=function(e){r.b._isObject(e,!0),Bp("removeSGO",i.b.stringsByLabel.VIEWER_LOGGER_removeSGO);var t=_e.indexOf(e);-1!==t&&_e.splice(t,1),e.front?(t=Ee.indexOf(e),Ee.splice(t,1)):e.back?(t=we.indexOf(e),we.splice(t,1)):(t=Me.indexOf(e),Me.splice(t,1)),r.b._isFunction(e.removeEvents)&&e.removeEvents(),e.viewer=null,delete e.original,this[Vp._render]()},_Viewer.prototype.getSGOs=function(){Bp("getSGOs",i.b.stringsByLabel.VIEWER_LOGGER_getSGOs);for(var e=[],t=0;t<_e.length;t++)e.push(_e[t]);return e},_Viewer.prototype.renderOrderSGO=function(e){var t;r.b._isObject(e,!0),Bp(i.b.stringsByLabel.VIEWER_LOGGER_renderOrderSGO),-1!==(t=Ee.indexOf(e))?Ee.splice(t,1):-1!==(t=we.indexOf(e))?we.splice(t,1):-1!==(t=Me.indexOf(e))&&Me.splice(t,1),e.front?Ee.push(e):e.back?we.push(e):Me.push(e),this[Vp._render]()},_Viewer.prototype.getWCS=function(){return Bp("getWCS",i.b.stringsByLabel.VIEWER_LOGGER_getWCS),Se},_Viewer.prototype[Vp._animationLoop]=function(){l=requestAnimationFrame(te);var e=Date.now(),t=e-xe;if(Te&&x.update(),t>be){xe=e-t%be;for(var n=!1,i=Object.keys(a),o=0,s=i.length;o<s&&!n;++o)r.b._isFunction(a[i[o]].overrideRender)&&(n=a[i[o]].overrideRender());n||this[Vp._render]()}},_Viewer.prototype[Vp._renderLoopActive]=function(){return r.b._notNullOrUndefined(l)},_Viewer.prototype.getCameraMode=function(){return Bp("getCameraMode",i.b.stringsByLabel.VIEWER_LOGGER_getCameraMode),u},_Viewer.prototype.setCameraMode=function(e,t){switch(r.b._isNumber(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean),Bp("setCameraMode",i.b.stringsByLabel.VIEWER_LOGGER_setCameraMode+e),t=!r.b._isBoolean(t)||t,e){case m.c.PERSPECTIVE:u=e,g=p,this._currentCamera=p,t&&this[Vp._render]();break;case m.c.ORTHOGRAPHIC:u=e,g=f,this._currentCamera=f,t&&this[Vp._render]()}},_Viewer.prototype.setMouseNavigationMode=function(e){switch(r.b._isNumber(e,!0),Bp("setMouseNavigationMode",i.b.stringsByLabel.VIEWER_LOGGER_setMouseNavigationMode+e),h=e,v.preupdate(),e){case m.t.ROTATE:v.navSettings.rotate.enabled=!0,v.navSettings.zoom.enabled=!1,v.navSettings.pan.enabled=!1,v.navSettings.roll.enabled=!1;break;case m.t.PAN:v.navSettings.rotate.enabled=!1,v.navSettings.zoom.enabled=!1,v.navSettings.pan.enabled=!0,v.navSettings.roll.enabled=!1;break;case m.t.ZOOM:v.navSettings.rotate.enabled=!1,v.navSettings.zoom.enabled=!0,v.navSettings.pan.enabled=!1,v.navSettings.roll.enabled=!1;break;case m.t.CONTEXT:default:v.navSettings.rotate.enabled=!0,v.navSettings.zoom.enabled=!0,v.navSettings.pan.enabled=!0,v.navSettings.roll.enabled=!0}v.update()},_Viewer.prototype.getMouseNavigationMode=function(){return Bp("getMouseNavigationMode",i.b.stringsByLabel.VIEWER_LOGGER_getMouseNavigationMode),h},_Viewer.prototype.setMouseNavigationModeSensitivity=function(e,t){switch(r.b._isNumber(e,!0),r.b._isNumber(t,!0),Bp("setMouseNavigationModeSensitivity",i.b.stringsByLabel.VIEWER_LOGGER_setMouseNavigationModeSensitivity+e+"  "+t),e){case m.t.ROTATE:v.navSettings.rotate.speed=t;break;case m.t.PAN:v.navSettings.pan.speed=t;break;case m.t.ZOOM:v.navSettings.zoom.speed=t;break;case m.t.CONTEXT:}},_Viewer.prototype[Vp._updateModelBoundingBox]=function(){if(0!==b.children.length){if(this._scene._updateModelBoundingBox(this._modelBBox),this.isExtensionLoaded(Ci)){var e=this.getExtensionManager(Ci)._getModelBoundingBox();this._modelBBox.union(e)}if(Me.length>0)for(var t=0;t<Me.length;t++)r.b._notNullOrUndefined(Me[t].updateBBox)&&!0===Me[t].updateBBox&&this[Vp._expandModelBoundingBox](Me[t].original)}},_Viewer.prototype[Vp._expandModelBoundingBox]=function(e){if((e=null===e||void 0===e?b:e)instanceof _.Mesh||e instanceof _.Line||e instanceof _.LineSegments||e instanceof ze.PartShape)e.geometry.boundingBox||e.geometry.computeBoundingBox(),r.b._unionModelBBox(this._modelBBox,e.geometry.boundingBox,e.matrixWorld);else{if(void 0!==e.children)for(var t=e.children.length,n=0;n<t;++n)this[Vp._expandModelBoundingBox](e.children[n]);if(e.shapes)for(var i=0,a=e.shapes.length;i<a;i++)this[Vp._expandModelBoundingBox](e.shapes[i])}};var Ue=new _.Box3,Fe=new _.Vector3,ke=new _.Sphere;function _fitToBoundingBox(e){if(e.isEmpty())Dp("_fitToBoundingBox",i.b.stringsByLabel.VIEWER_LOGGER_warn_fitAll);else{v.preupdate(),p.zoom=1,f.zoom=1,e.getCenter(Fe),e.getBoundingSphere(ke),v.target.copy(Fe),p.position.copy(Fe);var t=parseInt(s.domElement.height);s.domElement.width<s.domElement.height&&(t=parseInt(s.domElement.width));var n=p.fov*(Math.PI/180),r=parseInt(s.domElement.height)*ke.radius/(t*Math.tan(n/2));p.translateZ(r),p.lookAt(v.target),_updateOrthoCamera(),v.update(),this[Vp._render](),this[Vp._render]()}}function _fitModel(){Bp("_fitModel",i.b.stringsByLabel.VIEWER_LOGGER_fitAll),Ue.makeEmpty(),_getModelBoundingBox.call(this,Ue,b,!0),_fitToBoundingBox.call(this,Ue)}function _addToMovableObjects(e){if(null!==e.children&&void 0!==e.children)for(var t=0;t<e.children.length;t++){var n=Ie;for(var r in n)n[r]===e.children[t]&&delete Ie[r]}"SectionPlane"===e.type?Ie[e.id]=e:Ie[e.userData.psId]=e}function _setPlanePosition(e){var t,n,r=Ie;for(var i in r)if(r[i]){var a=new _.Vector3,o=new _.Quaternion,s=new _.Vector3,l=r[i];if(r[i]===b)for(var c=0;c<b.children.length;c++)l.children[c].matrix.decompose(a,o,s),l.localToWorld(a),l.children[c].userData._dragOffset=new _.Vector3,l.children[c].userData._dragOffset.copy(e.point).sub(a);else l.userData._dragOffset=new _.Vector3,l.matrix.decompose(a,o,s),l.parent.localToWorld(a),l.userData._dragOffset.copy(e.point).sub(a)}if(ue){a=new _.Vector3,o=new _.Quaternion,s=new _.Vector3;(l=ue).userData._dragOffset=new _.Vector3,l.matrix.decompose(a,o,s),l.parent.localToWorld(a),l.userData._dragOffset.copy(e.point).sub(a)}t=g,(n=v).enabled=!1;var u=n.target.clone().sub(t.position).normalize();X=(new _.Plane).setFromNormalAndCoplanarPoint(u,e.point)}_Viewer.prototype.fitToVisible=function _fitVisible(){if(Bp("_fitVisible",i.b.stringsByLabel.VIEWER_LOGGER_info2_fitAll),Ue.makeEmpty(),r.b._getVisibleBBox(b,Ue),xt&&this.isExtensionLoaded(xt)&&r.b._getVisibleBBox(this._scene._pmiShapeContainer,Ue),Ci&&this.isExtensionLoaded(Ci)){var e=this.getExtensionManager(Ci);r.b._getVisibleBBox(e._scene._dimensionContainer,Ue)}if(Me.length>0)for(var t=0;t<Me.length;t++)r.b._isBoolean(Me[t].updateBBox)&&Me[t].updateBBox&&r.b._getVisibleBBox(Me[t].original,Ue);Ue.isEmpty()?_fitModel.call(this):_fitToBoundingBox.call(this,Ue)},_Viewer.prototype.fitToModel=_fitModel,_Viewer.prototype.fitToPsId=function _fitToPsId(e){r.b._isString(e,!0),Ue.makeEmpty();var t=b.getObjectByPsId(e);t&&t.boundingBox&&(Ue.copy(t.boundingBox),Ue.applyMatrix4(t.matrixWorld),_fitToBoundingBox.call(this,Ue))},_Viewer.prototype[Vp._setSize]=function(e,t){s.setSize(e,t,!0),p.aspect=e/t,p.updateProjectionMatrix(),null!==v&&v.handleResize(),this[Vp._render](),Pe.width=e,Pe.height=t,this.dispatchEvent(Pe)},_Viewer.prototype.getWebGLContext=function(){return Bp("getWebGLContext",i.b.stringsByLabel.VIEWER_LOGGER_getWebGLContext),s.getContext()},_Viewer.prototype.setPickingEnabled=function(e){r.b._isBoolean(e,!0),Bp("setPickingEnabled",i.b.stringsByLabel.VIEWER_LOGGER_setPickingEnabled),E=e},_Viewer.prototype.getPickingEnabled=function(){return Bp("getPickingEnabled",i.b.stringsByLabel.VIEWER_LOGGER_getPickingEnabled),E};var We=new _.Vector3;function _setObjectPosition(e,t,n,r){v.preupdate();var i=r,a=new _.Vector3,o=new _.Quaternion,s=new _.Vector3;i.matrix.decompose(a,o,s);var l=i.parent.localToWorld(a),c=new _.Vector3(l.x,l.y,l.z);e.indexOf("X")>-1&&c.setX(n.x),e.indexOf("Y")>-1&&c.setY(n.y),e.indexOf("Z")>-1&&c.setZ(n.z),i.parent.worldToLocal(c),i.matrix.compose(c,o,s),i.updateMatrixWorld(),v.update(),this[Vp._updateModelBoundingBox](),this[Vp._render]()}function _getModelBoundingBox(e,t,n){if(t.boundingBox&&t!==b&&e.union(t.boundingBox),n&&t.children)for(var r=t.children.length,i=0;i<r;++i)_getModelBoundingBox.call(this,e,b.children[i],!1)}function _getMaterials(e,t){for(var n=e,i={inheritedMatIdx:-1};n&&n.parent&&!(n.parent instanceof ze.Container);)n=n.parent,r.b._notNullOrUndefined(n.userData.matIdx)&&(i.inheritedMatIdx=n.userData.matIdx);if(r.b._notNullOrUndefined(t))(t=t||[])[0]=c._instancedSelectionMaterial,t[1]=c._instancedLineSelectionMaterial,t[2]=c._instancedHighlightMaterial,t[3]=c._instancedLineHighlightingMaterial,t[4]=c._defaultInstancedMeshMaterial,t[5]=c._defaultInstancedLineMaterial,i.materials=t;else if(n.userData.materialsPool){if(void 0===n.userData.instancedMultiMaterial){var a=n.userData.materialsPool.length,o=[];o[0]=c._instancedSelectionMaterial,o[1]=c._instancedLineSelectionMaterial,o[2]=c._instancedHighlightMaterial,o[3]=c._instancedLineHighlightingMaterial,o[4]=c._defaultInstancedMeshMaterial,o[5]=c._defaultInstancedLineMaterial;for(var s=6;s<a;s++)o[s]=n.userData.materialsPool[s];n.userData.instancedMultiMaterial=o}i.materials=n.userData.instancedMultiMaterial,i.materials.isGlobal=!0}else i.materials=null;return i}function _getPrototypeById(e){var t=null;if(r.b._isString(e)&&e.indexOf(":")>0){var n=r.b._parsePsId(e);r.b._notNullOrUndefined(n)&&b.inPsIdToObjectMap(n.psId)&&(t=b.getObjectByPsId(e).original)}return r.b._isNullOrUndefined(t)&&c._prototypeContainer.inProtoIdToObjectMap(e)&&(t=c._prototypeContainer.getObjectByProtoId(e)),t}function _openHelper(e,t,n){Oe?Oe.loadProductStructure({modelPath:e,doneCallback:function(e,r){_jsonHandler.call(this,e,function(e,n){e&&r&&(b.getObjectByPsId(n).userData.materialsPool=r,_setTransparencyFlag(r));t(e,n)},n)}.bind(this)}):t(!1,null)}function _jsonHandler(e,t,n){if(t=t||function(){},n=!!r.b._isNullOrUndefined(n)||n,e&&e.psId){if(void 0!==e.bboxMin&&null!==e.bboxMin&&void 0!==e.bboxMax&&null!==e.bboxMax){if(w.min.set(e.bboxMin[0],e.bboxMin[1],e.bboxMin[2]),w.max.set(e.bboxMax[0],e.bboxMax[1],e.bboxMax[2]),e.xform){var i=(new _.Matrix4).set(e.xform[0],e.xform[3],e.xform[6],e.xform[9],e.xform[1],e.xform[4],e.xform[7],e.xform[10],e.xform[2],e.xform[5],e.xform[8],e.xform[11],0,0,0,1);w.applyMatrix4(i)}if(D++,function _loadProductStructure(e,t,n,i){var a=function _createPart(e,t){if(void 0!==e.instanceId&&null!==e.instanceId){var n=b.getObjectByPsId(t+":"+e.instanceId.toString(),!0);return n.isAssembly?new ze.Assembly(e.title,n.boundingBox,n.units):new ze.Part(n.original)}return e.children?new ze.Assembly(e.title,this[Vp._getBBox](e),e.units):new ze.Part(new Mp(e.title,this[Vp._getBBox](e),e.units))}.call(this,e,i);a.userData.modelHasPmi=e.hasPMI||!1;e.baseRef&&(a.userData.modelPath=e.baseRef);a.userData.psId=i+":"+e.psId;a.psId=e.psId;a.visible=I&&P;a.selected=!1;b.addPsIdToObjectMap(a.userData.psId,a);e.baseRef&&(a.baseRef=e.baseRef,"/"!==a.baseRef[a.baseRef.length-1]&&(a.baseRef+="/"),n=a.baseRef);a.percentLoaded=0;a.name=e.title;("Section Geometry"===a.name||t.sectionGeometry)&&(a.sectionGeometry=!0);void 0!==e.color&&(a.userData.overrideColor=e.color);a.objectHasXT=!1;(r.b._isBoolean(e.hasXT)&&e.hasXT||t.objectHasXT)&&(a.objectHasXT=!0,e.XTfileRef&&(a.xtFileRef=e.XTfileRef,e.XTfileLen&&(a.xtFileLen=e.XTfileLen)));if(void 0===e.instanceId||null===e.instanceId)if(e.fileRef||e.b64data)t.add(a),a.userData.cbQueue=[],e.fileRef?(a.baseRef=n,a.objectFileRef=e.fileRef):a.b64data=r.b._decodeBase64ToBinaryBuffer(e.b64data),e.fileLen&&(a.objectFileLen=e.fileLen),e.xtData&&(a.xtb64data=r.b._decodeBase64ToBinaryBuffer(e.xtData));else{t.add(a);for(var o=e.children.length,s=0;s<o;++s)_loadProductStructure.call(this,e.children[s],a,n,i)}else{var l=b.getObjectByPsId(i+":"+e.instanceId.toString(),!0);l&&(a.setOriginal(l,a.userData.psId),a.visible=I&&P,a.userData.objectInstanceId=l.userData.psId,t.add(a))}e.xform?a.matrix.set(e.xform[0],e.xform[3],e.xform[6],e.xform[9],e.xform[1],e.xform[4],e.xform[7],e.xform[10],e.xform[2],e.xform[5],e.xform[8],e.xform[11],0,0,0,1):a.matrix.identity()}.call(this,e,b,e.baseRef,D),c.updateMatrixWorld(),n){null!==b&&(v.target.addVectors(w.min,w.max),v.target.divideScalar(2),g.position.copy(v.target),g.translateZ(99999),g.lookAt(v.target));var a=(new _.Vector3).copy(g.position);a.sub(v.target);var o=new _.Sphere;o.setFromPoints([w.min,w.max],v.target);var l=o.radius/Math.sin(p.fov*Math.PI/180/2);if(a.setLength(l),a.add(v.target),g.position.copy(a),s.domElement.width<s.domElement.height){var u=new _.Object3D;u.position.set(0,0,0),g.add(u),u.translateX(o.radius),u.translateZ(-1*g.position.distanceTo(v.target));var h=u.position.clone();g.localToWorld(h),h.project(g),h.x>1&&(a.copy(g.position),a.sub(v.target),l*=h.x,a.setLength(l),a.add(v.target),g.position.copy(a)),g.remove(u),u=null,h=null}}}t(!0,D+":"+e.psId)}else t(!1)}function _setVisibilityByPsId(e,n,a,o){a=a||function(){},o=!r.b._isNullOrUndefined(o)&&o,F={},Bp("_setVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_setVisibilityByPsId+e);var s=r.b._parsePsId(e);if(s&&s.psId){var l=b.getObjectByPsId(e,!0);if(l){var c=function(){if(null===s.xtId||void 0===s.xtId)a(l);else{var e={};e[s.xtId]=s.xtId,function _setVisibilityByXtIds(e,t,n,r,i){if(null!==t&&void 0!==t){var a=[];for(var o in t)if(t[o]){var s=e.getObjectByXtId(o);s?s.visible=n:a.push(o)}if(a.length>0){var l=!0;r||(r={objectCount:0,completedCount:0},l=!1),n&&l&&this[Vp._fireProgressEvents](-1),_loadEdgesAndVertices.call(this,e,r,function(){if(null!==a&&void 0!==a&&a.length>0)for(var t=0,r=a.length>0;t<r;t++){var o=e.getObjectByXtId(a[t]);o&&o instanceof ze.EdgeShape&&(o.visible=n)}i()})}else i()}else i()}.call(this,l,e,!0,null,a)}this[Vp._render]()}.bind(this);if(e===t)for(var u=l.children.length,h=0,d=function(){++h===u&&(Dp("_setVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_setVisibilityByPsId),c())},p=0;p<u;++p)Dp("_setVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest2_setVisibilityByPsId+l.children[p].userData.psId),this.setVisibilityByPsId(l.children[p].userData.psId,n,d,o);else{var f=1;if(n&&!1===l.isLoaded){var m=function(){this[Vp._fireProgressEvents](101),_setObjectVisibility(l,n,o),this[Vp._updateModelBoundingBox](),this[Vp._render](),c()}.bind(this),g=function(e,t){this[Vp._fireProgressEvents](t),e&&P&&(_setObjectVisibility(e,n,o,l!==e),f===ae&&(f=1,this[Vp._render]()),f++)}.bind(this);this[Vp._loadGeometryHelper](l,m,g)}else _setObjectVisibility(l,n,l.sectionGeometry),c()}}else Dp("_setVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_setVisibilityByPsId),a()}}_Viewer.prototype[Vp._getCamera]=function(){return g},_Viewer.prototype.setMouseHighlightEnabled=function(e){r.b._isBoolean(e,!0),q=!0===e},_Viewer.prototype.setDimensionHighlightEnabled=function(e){r.b._isBoolean(e,!0),Y=!0===e},_Viewer.prototype[Vp._getVisibleModelBoundingBox]=function(){var e=c.visibleModelBoundingBox;return e.isEmpty()&&(e=c.modelBoundingBox),e.clone()},_Viewer.prototype.getObjectIdsAtViewCoordinate=function(e,t,n){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._optionalArgCheck(n,r.b._isNumber),r.b._isNumber(n)||(n=m.x.FACE+m.x.EDGE+m.x.VERTEX+m.x.PMI+m.x.DIMENSION);var i=r.b._getIntersectionsAtViewportCoordinate(e,t,s.domElement,c,De,this[Vp._getCamera](),n,!1,!1);if(r.b._isNullOrUndefined(i))return[];for(var a=function(e,t,n){n[t]=e.userData.psId},o=[],l=0;l<i.length;l++){var u={},h=i[l];h.point instanceof _.Vector3&&(u.modelPoint=[h.point.x,h.point.y,h.point.z]),(n&m.x.FACE)>0&&"PartShape"===h.object.type?(r.b._notNullOrUndefined(h.xtBody)?(u.type="face",u.faceId=h.xtFace.userData.psId,u.bodyId=h.xtBody.userData.psId):(u.type="part",u.id=h.object.parent.userData.psId),o.push(u)):(n&m.x.EDGE)>0&&("Edge"===h.object.type||"EdgeShapeBase"===h.object.type)?(u.type="edge",u.id=h.object.userData.psId,u.edgeId=h.object.userData.psId,h.object.bodies&&h.object.bodies.length>0&&(u.bodyIds=h.object.bodies,u.bodyIds.forEach(a)),h.object.faces&&h.object.faces.length>0&&(u.faceIds=h.object.faces,u.faceIds.forEach(a)),o.push(u)):(n&m.x.VERTEX)>0&&"VertexShape"===h.object.type?(u.type="vertex",u.id=h.object.userData.psId,o.push(u)):(n&m.x.PMI)>0&&h.object instanceof Ce||h.object instanceof Ge?(u.type="PMI",u.id=h.object.owner.userData.psId,o.push(u)):(n&m.x.DIMENSION)>0&&"Dimension"===h.object.parent.name&&(u.type="dimension",u.id=h.object.id,o.push(u))}return o},_Viewer.prototype.registerMouseOverEvent=function(e,t){r.b._isFunction(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean),Bp("registerMouseOverEvent",i.b.stringsByLabel.VIEWER_LOGGER_registerMouseOverEvent+t),t=!r.b._isBoolean(t)||t,r.b._isFunction(e)&&(t?-1===r.b._eventMapIndex(U,e)&&U.push(e):-1===r.b._eventMapIndex(N,e)&&N.push(e))},_Viewer.prototype.unregisterMouseOverEvent=function(e,t){var n;(r.b._isFunction(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean),Bp("unregisterMouseOverEvent",i.b.stringsByLabel.VIEWER_LOGGER_unregisterMouseOverEvent+t),t=!r.b._isBoolean(t)||t,r.b._isFunction(e))&&(t?-1!==(n=r.b._eventMapIndex(U,e))&&U.splice(n,1):-1!==(n=r.b._eventMapIndex(N,e))&&N.splice(n,1))},_Viewer.prototype[Vp._fireMouseOverEvents]=function(e,t){var n=0;if(t){n=U.length;for(var r=0;r<n;++r)U[r](e)}n=N.length;for(r=0;r<n;++r)N[r](e)},_Viewer.prototype.registerPickingEvent=function(e){r.b._isFunction(e,!0),Bp("registerPickingEvent",i.b.stringsByLabel.VIEWER_LOGGER_registerPickingEvent),Re.registerPickingEvent(e)},_Viewer.prototype.unregisterPickingEvent=function(e){r.b._isFunction(e,!0),Bp("unregisterPickingEvent",i.b.stringsByLabel.VIEWER_LOGGER_unregisterPickingEvent),Re.unregisterPickingEvent(e)},_Viewer.prototype.registerProgressEvent=function(e){r.b._isFunction(e,!0),Bp("registerProgressEvent",i.b.stringsByLabel.VIEWER_LOGGER_registerProgressEvent),r.b._isFunction(e)&&-1===r.b._eventMapIndex(k,e)&&k.push(e)},_Viewer.prototype.unregisterProgressEvent=function(e){r.b._isFunction(e,!0),Bp("unregisterProgressEvent",i.b.stringsByLabel.VIEWER_LOGGER_unregisterProgressEvent);var t=r.b._eventMapIndex(k,e);-1!==t&&k.splice(t,1)},_Viewer.prototype[Vp._fireProgressEvents]=function(e){for(var t=k.length,n=0;n<t;++n)k[n](e)},_Viewer.prototype.registerPropertyChangedEvent=function(e,t){if(r.b._isFunction(e,!0),r.b._isString(t,!0),Bp("registerPropertyChangedEvent",i.b.stringsByLabel.VIEWER_LOGGER_registerPropertyChangedEvent),r.b._notNullOrUndefined(t)&&r.b._isFunction(e)){var n=[];if(void 0!==H[t])n=H[t],-1===r.b._eventMapIndex(n,e)&&n.push(e);else n.push(e),H[t]=n}},_Viewer.prototype.unregisterPropertyChangedEvent=function(e,t){if(r.b._isFunction(e,!0),r.b._isString(t,!0),Bp("unregisterPropertyChangedEvent",i.b.stringsByLabel.VIEWER_LOGGER_unregisterPropertyChangedEvent),r.b._notNullOrUndefined(t)&&r.b._isFunction(e)&&void 0!==H[t]){var n=H[t],a=r.b._eventMapIndex(n,e);-1!==a&&n.splice(a,1)}},_Viewer.prototype[Vp._firePropertyChangedEvent]=function(e,t,n){if(void 0!==e&&null!==e&&void 0!==H[e])for(var r=H[e].slice(0),i=r.length,a=0;a<i;++a)r[a](t,n)},_Viewer.prototype.getNetworkManager=function(){return this._networkManager},_Viewer.prototype.setLoader=function(e){Oe=e,e.viewer=this,e.networkManager=this._networkManager,this._loader=e},_Viewer.prototype.getLoader=function(){return Oe},_Viewer.prototype.getLod=function(){return n},_Viewer.prototype.setLod=function(e,t){if(n=e,Oe){var r=function(){this[Vp._render](),t&&t()}.bind(this);Oe.refine({lod:e,doneCallback:function(e){if(e)if(e.areEdgesVisible){var t=e.areEdgesVisible;e.areEdgesVisible=!1,this.setEdgesVisibilityByPsId(e.userData.psId,t,function(){r()},e.wireframeVisible)}else r();else r()}.bind(this)})}},_Viewer.prototype.traverseTriShape=function(e){c.traverseTriShape(e)},_Viewer.prototype.refineShape=function(e,t){c.refineShape(e,t)},_Viewer.prototype.processMaterial=function(e,t,n){c.processMaterial(e,t,n)},_Viewer.prototype.processGeometry=function(e,t,n){c.processGeometry(r.b._notNullOrUndefined(e.buffersList)?e.buffersList:e,t,r.b._notNullOrUndefined(n)?n:function(){})},_Viewer.prototype.postMessage=function(e,t,n){this._workerPool.postMessage(e,t,n)},_Viewer.prototype.addShapes=function(e,t,n,i){var a,o;if("Original"===e.type){o=null,a=e;var s=_getMaterials(b.children[0],n);a.isLoaded||c.setShapesOnPrototype(a,t,s,i);for(var l=0,u=a.instances.length;l<u;l++)c.setShapesOnInstance(a.instances[l]);a.isLoaded=!0,a.isLoading=!1}else if("Body"===e.type){o=e,a=e.original;s=_getMaterials(o,n);a.isLoaded||c.setShapesOnPrototype(a,t,s,i);for(l=0,u=a.instances.length;l<u;l++)c.setShapesOnInstance(a.instances[l]);a.isLoaded=!0,a.isLoading=!1}else if("Part"===e.type||"Assembly"===e.type){o=e,a=e.original;s=_getMaterials(o,n);for(var h=0;t.length>h;){var d,p,f;if(r.b._notNullOrUndefined(t[0].xtBodies)&&t[0].xtBodies.length>=1){(d=t[0]).computeBoundingBox(),f=new Mp(a.name+" Body",d.boundingBox,a.unit);for(l=0,u=a.instances.length;l<u;l++)(p=new Xn(f)).userData.psId=a.instances[l].userData.psId+"|"+d.xtBodies[0].bodyId,p.psId=d.xtBodies[0].bodyId,a.instances[l].add(p),p.updateMatrixWorld(!0);c.setShapesOnPrototype(f,[d],s,i);for(l=0,u=f.instances.length;l<u;l++)c.setShapesOnInstance(f.instances[l]);f.isLoaded=!0,f.isLoading=!1,t.splice(0,1)}else h++}a.isLoaded||c.setShapesOnPrototype(a,t,s,i);for(l=0,u=a.instances.length;l<u;l++)c.setShapesOnInstance(a.instances[l]);a.isLoaded=!0,a.isLoading=!1}else if("PmiObject"===e.type&&xt&&this.isExtensionLoaded(xt)){var m=this.getExtensionManager(xt);m&&(m.addPmiShapes(e.userData.psId,{geometries:t}),e.isLoaded&&(e.isLoading=!1))}},_Viewer.prototype.addEdges=function(e,t,n,i){var a,o;if(r.b._notNullOrUndefined(t))if("Original"===e.type){a=null,o=e,c.setEdgesOnPrototype(o,t,n,i);for(var s=0,l=o.instances.length;s<l;s++)c.setEdgesOnInstance(o.instances[s],o.instances[s].visible);o.edgesLoaded=!0}else if("Part"===e.type||"Body"===e.type)if(a=e,o=e.original,r.b._notNullOrUndefined(a.children)&&a.children.length>0){var u=a.children[a.children.length-1].original;c.setEdgesOnPrototype(u,t,n,i);for(s=0,l=u.instances.length;s<l;s++)c.setEdgesOnInstance(u.instances[s],u.instances[s].visible);u.edgesLoaded=!0}else{c.setEdgesOnPrototype(o,t,n,i);for(s=0,l=o.instances.length;s<l;s++)c.setEdgesOnInstance(o.instances[s],o.instances[s].visible);o.edgesLoaded=!0}},_Viewer.prototype.addShapesById=function(e,t,n,i){var a=null;r.b._isString(e)&&e.indexOf(":")>0&&b.inPsIdToObjectMap(e)&&(a=b.getObjectByPsId(e)),r.b._isNullOrUndefined(a)&&c._prototypeContainer.inProtoIdToObjectMap(e)&&(a=c._prototypeContainer.getObjectByProtoId(e)),this.addShapes(a,t,n,i)},_Viewer.prototype.addEdgesById=function(e,t,n,i){var a=null;r.b._isString(e)&&e.indexOf(":")>0&&b.inPsIdToObjectMap(e)&&(a=b.getObjectByPsId(e)),r.b._isNullOrUndefined(a)&&c._prototypeContainer.inProtoIdToObjectMap(e)&&(a=c._prototypeContainer.getObjectByProtoId(e)),this.addEdges(a,t,n,i)},_Viewer.prototype.updateShapesById=function(e,t,n){var i=_getPrototypeById(e);if(r.b._notNullOrUndefined(i)){var a=_getMaterials(i.instanceCount>0?i.instances[0]:b,n),o=null;if(i.isLoaded)for(var s=0;s<i.shapes.length;){var l=i.shapes[s];if("Mesh"===l.type||"LineSegments"===l.type)if(o=l.material,l.instances)for(;l.instances.length>0;){var u=l.instances[0];c.removeShape(u.parent,u)}else{c._shapeContainer.removeShape(i,l);var h=i.shapes.indexOf(l);-1!==h&&i.shapes.splice(h,1),l.material.instanceCount--,r.b._clearObject3D(i)}else s++}null===a.materials&&(a.materials=o),c.setShapesOnPrototype(i,t,a);for(var d=0,p=i.instances.length;d<p;d++)c.setShapesOnInstance(i.instances[d],i.instances[d].visible),this[Vp._expandModelBoundingBox](i.instances[d]);this[Vp._render]()}else console.error("Bad Ids")},_Viewer.prototype.updateEdgesById=function(e,t,n,i){var a=_getPrototypeById(e);if(r.b._notNullOrUndefined(a)){if(a.edgesLoaded)for(var o=0;o<a.shapes.length;){var s=a.shapes[o];if("EdgeShape"===s.type||"OutlineShape"===s.type||"VertexShape"===s.type)if(s.instances)for(;s.instances.length>0;){var l=s.instances[0];c.removeShape(l.parent,l)}else{var u=a.shapes.indexOf(s);-1!==u&&a.shapes.splice(u,1),a.material.instanceCount--,r.b._clearObject3D(a)}else o++}c.setEdgesOnPrototype(a,t,n,i);for(var h=0,d=a.instances.length;h<d;h++)c.setEdgesOnInstance(a.instances[h],this),this[Vp._expandModelBoundingBox](a.instances[h],a.instances[h].visible);this[Vp._render]()}else console.error("Bad Ids")},_Viewer.prototype.open=function(e,t){r.b._optionalArgCheck(t,r.b._isFunction),Bp("open",i.b.stringsByLabel.VIEWER_LOGGER_open),t=t||function(){},this.clearScene(),Dp("open API: model path given is:"+e),_openHelper.call(this,e,t)},_Viewer.prototype.importModel=function(e,t,n){r.b._optionalArgCheck(t,r.b._isFunction),r.b._optionalArgCheck(n,r.b._isBoolean),Bp("importModel",i.b.stringsByLabel.VIEWER_LOGGER_importModel),t=t||function(){},Dp("importModel API: model path given is:"+e),_openHelper.call(this,e,t,n)},_Viewer.prototype.openWithObject=function(e,t){r.b._isObject(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),Bp("openWithObject",i.b.stringsByLabel.VIEWER_LOGGER_setSelectionByPsId+e),t=t||function(){},this.clearScene(),_jsonHandler.call(this,e,function(n,a){n&&e.mat64&&Oe?Oe.loadMaterials({mat64binary:r.b._decodeBase64ToBinaryBuffer(e.mat64),doneCallback:function(e,r){null!==r&&(b.getObjectByPsId(a).userData.materialsPool=r,_setTransparencyFlag(r));Dp("openWithObject",i.b.stringsByLabel.VIEWER_LOGGER_openWithObject+a),t(n,a)}}):(Dp("openWithObject",i.b.stringsByLabel.VIEWER_LOGGER_finest_openWithObject+a),t(n,a))})},_Viewer.prototype.importModelWithObject=function(e,t,n){r.b._isObject(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),r.b._optionalArgCheck(n,r.b._isBoolean),Bp("importModelWithObject",i.b.stringsByLabel.VIEWER_LOGGER_importModelWithObject+e),t=t||function(){},_jsonHandler.call(this,e,function(n,a){n&&e.mat64?Oe.loadMaterials({mat64binary:r.b._decodeBase64ToBinaryBuffer(e.mat64),doneCallback:function(e,r){null!==r&&(b.getObjectByPsId(a).userData.materialsPool=r,_setTransparencyFlag(r));Dp("importModelWithObject",i.b.stringsByLabel.VIEWER_LOGGER_finest_openWithObject+a),t(n,a)}}):(Dp("importModelWithObject",i.b.stringsByLabel.VIEWER_LOGGER_finest_openWithObject+a),t(n,a))},n)},_Viewer.prototype[Vp._addAuxShape]=function(e){e instanceof _.Object3D&&(c.addAuxShape(e),this[Vp._expandModelBoundingBox](e)),this[Vp._render]()},_Viewer.prototype[Vp._removeAuxShape]=function(e){if(e instanceof _.Object3D){var t=Re[Di._getSelectedIds]();for(var n in t)t[n]&&t[n].object===e&&delete t[n];if("SectionPlane"===e.type)b.getObjectByPsId("-1",!0).traverse(function(e){if(e.shapes)for(var t=e.shapes,n=0,r=t.length;n<r;n++){var i=t[n];if(i.material)for(var a=0,o=i.material.length;a<o;a++)i.material[a]&&(i.material[a].needsUpdate=!0);else i.material.needsUpdate=!0}});c.removeAuxShape(e),Re[Di._removeSelection](e)}},_Viewer.prototype[Vp._updateAuxShape]=function(e){e instanceof _.Object3D&&(c.updateAuxShape(e),this[Vp._expandModelBoundingBox](),this[Vp._render]())},_Viewer.prototype[Vp._getBBox]=function(e){if(e.bboxMin&&e.bboxMax){var t=new _.Vector3(e.bboxMin[0],e.bboxMin[1],e.bboxMin[2]),n=new _.Vector3(e.bboxMax[0],e.bboxMax[1],e.bboxMax[2]);return new _.Box3(t,n)}},_Viewer.prototype.setVisibilityByPsId=function(e,t,n,i){if(r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isFunction),n=n||function(){},t){var a=b.getObjectByPsId(e,!0);a&&a.sectionGeometry&&(i=!0)}var o=function(e){e&&void 0===e.boundingBox&&function _updateObjectBoudingBox(e){var t=e.children;var n=0,i=0,a=0,o=0,s=0,l=0;if(r.b._notNullOrUndefined(e.boundingBox))if(Array.isArray(t)&&t.length>0){for(var c=0;c<t.length;++c){var u=t[c];_updateObjectBoudingBox(u);var h=u.boundingBox;r.b._notNullOrUndefined(h)&&(n=Math.min(n,h.min.x),i=Math.max(i,h.max.x),a=Math.min(a,h.min.y),o=Math.max(o,h.max.y),s=Math.min(s,h.min.z),l=Math.max(l,h.max.z))}e.boundingBox=new _.Box3(new _.Vector3(n,a,s),new _.Vector3(i,o,l))}else if(!0===e.shapesLoaded){var d=e.shapes;if(Array.isArray(d)&&d.length>0)for(var c=0;c<d.length;++c){var h=shape[c].boundingBox;r.b._notNullOrUndefined(h)&&(n=Math.min(n,h.min.x),i=Math.max(i,h.max.x),a=Math.min(a,h.min.y),o=Math.max(o,h.max.y),s=Math.min(s,h.min.z),l=Math.max(l,h.max.z))}e.boundingBox=new _.Box3(new _.Vector3(n,a,s),new _.Vector3(i,o,l))}}(e),_fireVisibilityEvents(),n()}.bind(this);_setVisibilityByPsId.call(this,e,t,o,i)},_Viewer.prototype.setVisibilityByPsIds=function(e,t,n){r.b._isArray(e,!0,r.b._isString),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isFunction),n=n||function(){},Bp("setVisibilityByPsIds",i.b.stringsByLabel.VIEWER_LOGGER_setVisibilityByPsIds);var a=ie;ie=!1;for(var o=0,s=function(){++o===e.length&&(ie=a,this[Vp._render](),_fireVisibilityEvents(),n())}.bind(this),l=0;l<e.length;++l){var c=e[l];_setVisibilityByPsId.call(this,c,t,s)}},_Viewer.prototype.getHighlightedPsIds=function(e,t,n,i,a){r.b._optionalArgCheck(e,r.b._isArray,r.b._isString),r.b._optionalArgCheck(t,r.b._isArray,r.b._isString),r.b._optionalArgCheck(n,r.b._isArray,r.b._isString),r.b._optionalArgCheck(i,r.b._isArray,r.b._isString),r.b._optionalArgCheck(a,r.b._isArray,r.b._isString),Re&&Re[Di._getHighlightedPsIds](e,t,n,i,a)},_Viewer.prototype.setHighlightByPsId=function(e,t,n){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isBoolean),Re&&Re[Di._setHighlightByPsId](e,t,n)},_Viewer.prototype.setHighlightByPsIds=function(e,t,n){r.b._optionalArgCheck(e,r.b._isArray,r.b._isString),r.b._optionalArgCheck(t,r.b._isBoolean),r.b._optionalArgCheck(n,r.b._isBoolean),Re&&Re[Di._setHighlightByPsIds](e,t,n)},_Viewer.prototype.clearHighlight=function(e){r.b._optionalArgCheck(e,r.b._isBoolean),Re&&Re[Di._clearHighlightBuffer](e)};var Xe=function(e){var t=0,n=b;return r.b._notNullOrUndefined(e)&&(n=b.getObjectByPsId(e)),r.b._notNullOrUndefined(n)&&("Body"===n.type?t=1:n.traverse(function(e){"Part"!==e.type&&"Body"!==e.type||t++})),t};function _loadEdgesAndVertices(e,t,n){if((r.b._isNullOrUndefined(t.objectCount)||0===t.objectCount)&&(t.objectCount=Xe(e.userData?e.userData.psId:"-1")),0===t.objectCount)return this[Vp._fireProgressEvents](101),void n();if("Part"===e.type||"Body"===e.type){var i=!1;if(r.b._notNullOrUndefined(e.shapes))for(var a=0;a<e.shapes.length;a++)e.shapes[a]instanceof ze.PartShape&&(i=!0);var o=function(e=!0){t.completedCount+=1,this[Vp._fireProgressEvents](t.completedCount/t.objectCount),t.completedCount===t.objectCount&&(n&&n(),this[Vp._fireProgressEvents](101),e&&this[Vp._render]())}.bind(this);if(i){var s=e;if(s.edgesLoaded||s.edgesLoading)this._workerPool?this._workerPool.defer(function(){o(!1)}.bind(this)):o(!1);else if(s.edgesLoading=!0,r.b._isFunction(this._loader.loadEdges)){var l={part:s,doneCallback:o};this._loader.loadEdges(l)}}else o(!1)}if(r.b._notNullOrUndefined(e.children)){a=0;for(var c=e.children.length;a<c;a++)_loadEdgesAndVertices.call(this,e.children[a],t,n)}}function _fireVisibilityChangeEvents(e){if(void 0!==e.userData.visibilityChangeEvents)for(var t=e.userData.visibilityChangeEvents.length,n=0;n<t;++n)e.userData.visibilityChangeEvents[n](e.visibilityState)}function _fireVisibilityEvents(){var e=[],t=F;for(var n in t)if(t[n]){var r={};r.psId=t[n].userData.psId,r.TriState=t[n].visibilityState,e.push(r)}for(var i=0;i<z.length;++i)z[i](e);F={}}function _setObjectVisibility(e,t,n,r){var i=e.visibilityState;if(e.children&&e.children.length>0&&void 0===e.children[0].geometry){for(var a,o=e.children.length,s=0;s<o;++s)if(t&&!n&&e.children[s].sectionGeometry||_setObjectVisibility(e.children[s],t,n,!0),e.children[s].visibilityState!==a)switch(a){case void 0:a=e.children[s].visibilityState;break;case m.D.All:case m.D.None:a=m.D.Some;break;case m.D.Some:}e.visibilityState=a,e.visible=e.visibilityState!==m.D.None}else e instanceof ce&&(e.sectionGeometry||(t&&!e.visibilityState?R++:!t&&e.visibilityState&&R--),e.visibilityState=t?m.D.All:m.D.None,e.visible=t);if(i!==e.visibilityState&&(F["_"+e.id.toString()]=e,_fireVisibilityChangeEvents(e)),!r)for(var l=e.parent;!(l instanceof _.Scene)&&null!==l;){var c=l.visibilityState,u=!0;l.visibilityState=l.children[0].visibilityState;for(s=1;s<l.children.length&&u;++s)if(l.children[s].visibilityState!==l.visibilityState)switch(l.visibilityState){case m.D.All:case m.D.None:l.visibilityState=m.D.Some,u=!1;break;case m.D.Some:u=!1}if(l.visible=l.visibilityState!==m.D.None,c===l.visibilityState)break;_fireVisibilityChangeEvents(l),l=l.parent}}function _setMaterialObject(e,t,n,r){for(var i={parts:[],faces:[],edges:[],vertices:[]},a=0;a<e.length;a++)i.parts.push(this.getMaterialByPsId(e[a]));for(a=0;a<t.length;a++)i.faces.push(this.getMaterialByPsId(t[a]));for(a=0;a<n.length;a++)i.edges.push(this.getMaterialByPsId(n[a]));for(a=0;a<r.length;a++)i.vertices.push(this.getMaterialByPsId(r[a]));return i}function _geometryCountHelper(e){for(var t=0,n=0,i=0,a=0,o=[],s={},l=0;l<e.shapes.length;l++){var c=e.shapes[l],u={};if(u.shapeType=c.type,u.shapeObjectId=c.id,c instanceof ze.PartShape){u.faceObjects=[];for(var h=0;h<c.groups.length;h++){var d={};d.faceObjectId=c.groups[h].original.face.faceId,d.materialIndex=c.groups[h].original._originalMaterialIndex,d.triangleCount=c.groups[h].original._count/3,u.faceObjects.push(d)}t+=c.faces.length}else if(c instanceof ze.EdgeShape&&r.b._notNullOrUndefined(c.edges)){u.edgeObjects=[];for(h=0;h<c.groups.length;h++){var p={};p.edgeObjectId=c.groups[h].original.edgeId,u.edgeObjects.push(p)}n+=c.edges.length}else c instanceof ze.LineShape?a+=c.groups[0].original._count/2:c instanceof ze.VertexShape&&r.b._notNullOrUndefined(c.vertices)&&(i+=c.vertices.length);o.push(u)}return s.shapes=o,s.numFace=t,s.numEdge=n,s.numVertex=i,s.numLineSegment=a,s}function _isNumberCallback(e,t){return e&&r.b._isNumber(t)}function _setUserCapColor(e){var t=c._sectionCapMaterial.userCapColor;t.diffuse=r.b._notNullOrUndefined(e.diffuse)?e.diffuse:t.diffuse,t.emissive=r.b._notNullOrUndefined(e.emissive)?e.emissive:t.emissive,t.specular=r.b._notNullOrUndefined(e.specular)?e.specular:t.specular,t.shininess=r.b._notNullOrUndefined(e.shininess)?e.shininess:t.shininess,t.opacity=r.b._notNullOrUndefined(e.opacity)?e.opacity:t.opacity,t.opacity=r.b._getValidOpacity(t.opacity),t.transparent=!!(e.opacity&&e.opacity<1)}function startTween(e,t,n,r){var i=this.getMouseNavigationMode();Te=!0,this.startRenderLoop(),Ae=!0,v.navSettings.rotate.enabled=!1,v.navSettings.zoom.enabled=!1,v.navSettings.pan.enabled=!1,v.navSettings.roll.enabled=!1;var a=function(){g.position.copy(e),g.up.copy(n),v.target.copy(t),g.lookAt(t),g.updateMatrix(),g.updateMatrixWorld(),x.removeAll(),Te=!1,Ae=!1,this.setMouseNavigationMode(i),this.stopRenderLoop()}.bind(this);new x.Tween(g.position.clone()).to({x:e.x,y:e.y,z:e.z},750).easing(r).onUpdate(function(){g.position.set(this.x,this.y,this.z)}).start(),new x.Tween(g.up.clone()).to({x:n.x,y:n.y,z:n.z},750).easing(r).onUpdate(function(){g.up.set(this.x,this.y,this.z)}).start(),new x.Tween(v.target.clone()).to({x:t.x,y:t.y,z:t.z},750).easing(r).onUpdate(function(){v.preupdate();var e=new _.Vector3(this.x,this.y,this.z);g.lookAt(e),v.target=[this.x,this.y,this.z],v.update()}).onComplete(a).start()}function _getPlaneCoordinateAtViewPort(e,t,n,r,i,a,o,s){var l=new _.Vector3;l.set(t/r*2-1,1-n/i*2,1);var c=new _.Ray(a,l);o&&o.isPerspectiveCamera?(c.origin.setFromMatrixPosition(o.matrixWorld),c.direction.set(l.x,l.y,.5).unproject(o).sub(c.origin).normalize()):o&&o.isOrthographicCamera&&(c.origin.set(l.x,l.y,(o.near+o.far)/(o.near-o.far)).unproject(o),c.direction.set(0,0,-1).transformDirection(o.matrixWorld)),c.intersectPlane(s,e)}return _Viewer.prototype.setEdgesVisibilityByPsId=function(e,t,n){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isFunction),Bp("setEdgesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_setEdgesVisibilityByPsId+e),n=n||function(){};var a=b.getObjectByPsId(e,!0);if(a){t?(this[Vp._fireProgressEvents](-1),Dp("setEdgesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_setEdgesVisibilityByPsId+a),_loadEdgesAndVertices.call(this,a,{completedCount:0},function(){a.visibilityState&&(a.traverse(function(e){"Part"!==e.type&&"Body"!==e.type||(e.areEdgesVisible=!0)}),this[Vp._render]()),n()}.bind(this))):(a.traverse(function(e){"Part"!==e.type&&"Body"!==e.type||(e.areEdgesVisible=!1)}),this[Vp._render](),n())}else n()},_Viewer.prototype.getEdgesVisibilityByPsId=function(e){r.b._isString(e,!0),Bp("getEdgesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_getEdgesVisibilityByPsId+e);var t=b.getObjectByPsId(e,!0);if(t)return t.areEdgesVisible;Dp("getEdgesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_warn_getEdgesVisibilityByPsId)},_Viewer.prototype.getEdgeGeometryByPsId=function(e){r.b._isString(e,!0),Bp("getEdgeGeometryByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_getEdgeGeometryByPsId+e);var t=b.getObjectByPsId(e,!0);if(t)return t.position;Dp("getEdgeGeometryByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_warn_getEdgeGeometryByPsId)},_Viewer.prototype.setRenderMode=function(e){switch(r.b._isNumber(e,!0),Bp("setRenderMode",i.b.stringsByLabel.VIEWER_LOGGER_setRenderMode),e){case m.g.Shaded:case m.g.Outline:case m.g.Visible:case m.g.Hidden:case m.g.Wireframe:se=e,Re.selectNone(),s.renderMode=se,s.renderModeNeedsUpdate=!0,this[Vp._render](),this[Vp._render]()}},_Viewer.prototype.getRenderMode=function(){return Bp("getRenderMode",i.b.stringsByLabel.VIEWER_LOGGER_finest_getRenderMode),se},_Viewer.prototype.setExplodeMode=function(e){r.b._isNumber(e,!0),Bp("setExplodeMode",i.b.stringsByLabel.VIEWER_LOGGER_setExplodeMode),e===ve||e!==m.j.Distance&&e!==m.j.Volume&&e!==m.j.Radial||(ve=e)},_Viewer.prototype.getExplodeMode=function(){return Bp("getExplodeMode",i.b.stringsByLabel.VIEWER_LOGGER_getExplodeMode),ve},_Viewer.prototype.autoExplode=function(e){r.b._isNumber(e,!0),Bp("autoExplode",i.b.stringsByLabel.VIEWER_LOGGER_finest_autoExplode,100*e),this.startRenderLoop();var t=b;if(r.b._isNumber(e)&&(ye=e<0||e>1?0:e,t.children[0])){void 0===t.children[0].userData.setInfo&&(t.userData.modelWorldCenter=t.children[0].boundingSphere.center,t.userData.modelVolume=function _getBBoxVolume(e){return void 0===e&&(e=w),Math.max(e.max.x-e.min.x,1e-6)*Math.max(e.max.y-e.min.y,1e-6)*Math.max(e.max.z-e.min.z,1e-6)}(),t.userData.range=10*Math.pow(t.userData.modelVolume,1/3),t.children[0].userData.setInfo=!0);var n=ye*t.userData.range,a=new _.Vector3;t.traverse(function(e){if("Part"===e.type&&0===e.children.length||"Body"===e.type){if(void 0===e.userData.dir){r.b._isNullOrUndefined(e.boundingBox)&&e.computeBoundingBox();var i=e.boundingBox.clone().applyMatrix4(e.matrixWorld),o=Math.abs(i.max.x-i.min.x)*Math.abs(i.max.y-i.min.y)*Math.abs(i.max.z-i.min.z);i.getCenter(a),e.parent.worldToLocal(a);var s=t.userData.modelWorldCenter.clone();e.parent.worldToLocal(s);var l=Math.pow(o,.1)/Math.pow(t.userData.modelVolume,.1),c=a.distanceTo(s)/Math.pow(t.userData.modelVolume,1/3);e.userData.dir=new _.Vector3(a.x-s.x,a.y-s.y,a.z-s.z).normalize(),e.userData.x=e.matrix.elements[12],e.userData.y=e.matrix.elements[13],e.userData.z=e.matrix.elements[14],e.userData.distanceRatio=c>.025?c:.025,e.userData.volumeRatio=l>.025?l:.025}var u,h=e.userData.dir.clone();switch(ve){case m.j.Distance:u=e.userData.distanceRatio;break;case m.j.Volume:u=e.userData.volumeRatio;break;case m.j.Radial:u=1}var d=h.multiplyScalar(n*u);d.x+=e.userData.x,d.y+=e.userData.y,d.z+=e.userData.z,e.matrix.setPosition(d),e.wireframes&&(e.updateMatrixWorld(!0),e.wireframes[0].matrixAutoUpdate=!1,e.wireframes[0].matrix.copy(e.matrixWorld),e.wireframes[0].matrixWorld.copy(e.matrixWorld)),e.sectionEdges&&this[Vp._clearSectionShapes](e)}}.bind(this)),c.updateMatrixWorld(),this[Vp._updateModelBoundingBox](),this.stopRenderLoop()}},_Viewer.prototype.rebuild=function(){var e=b.getObjectByPsId("-1",!0).children[0];e&&e.traverse(function(e){c.updateIndexedObject(e)})},_Viewer.prototype.setVerticesVisibilityByPsId=function(e,t,n){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isFunction),Bp("setVerticesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_setVerticesVisibilityByPsId+e),n=n||function(){};var a=b.getObjectByPsId(e,!0);if(a){t?(this[Vp._fireProgressEvents](-1),Dp("setVerticesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_setVerticesVisibilityByPsId+a),_loadEdgesAndVertices.call(this,a,{completedCount:0},function(){a.visibilityState&&(a.traverse(function(e){e instanceof ce&&(e.areVerticesVisible=!0)}),this[Vp._render]()),n()}.bind(this))):(a.traverse(function(e){e instanceof ce&&(e.areVerticesVisible=!1)}),this[Vp._render](),n())}else n()},_Viewer.prototype.getVerticesVisibilityByPsId=function(e){r.b._isString(e,!0),Bp("getVerticesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getVerticesVisibilityByPsId+e);var t=b.getObjectByPsId(e,!0);if(void 0!==t)return t.areVerticesVisible;Dp("getVerticesVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_getVerticesVisibilityByPsId)},_Viewer.prototype[Vp._getVisiblePartCount]=function(){return R},_Viewer.prototype.getPartCount=function(e){r.b._optionalArgCheck(e,r.b._isString);var t=0,n=b;return r.b._notNullOrUndefined(e)&&(n=b.getObjectByPsId(e)),r.b._notNullOrUndefined(n)&&("Part"===n.type||"Body"===n.type?t=1:n.traverse(function(e){e instanceof ce&&!e.isAssembly&&t++})),t},_Viewer.prototype.getVisibilityStateByPsId=function(e){r.b._isString(e,!0),Bp("getVisibilityStateByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getVisibilityStateByPsId+e);var t=b.getObjectByPsId(e,!0);if(void 0!==t)return t.visibilityState;Dp("getVisibilityStateByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_getVisibilityStateByPsId)},_Viewer.prototype.getNameByPsId=function(e){r.b._isString(e,!0),Bp("getNameByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getNameByPsId+e);var t=b.getObjectByPsId(e,!0);return void 0!==t?t.name:void Dp("getNameByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_getNameByPsId)},_Viewer.prototype.rotateAboutSelectedPoint=function(e){r.b._isBoolean(e,!0),Bp("rotateAboutSelectedPoint",i.b.stringsByLabel.VIEWER_LOGGER_rotateAboutSelectedPoint+e),this.setDragFlag(!1),oe=e},_Viewer.prototype.isRotatingAboutSelectedPoint=function(){return Bp("isRotatingAboutSelectedPoint",i.b.stringsByLabel.VIEWER_LOGGER_isRotatingAboutSelectedPoint),oe},_Viewer.prototype.setPickOnly=function(e){r.b._isBoolean(e,!0),r.b._isBoolean(e)&&(Bp("setPickOnly",i.b.stringsByLabel.VIEWER_LOGGER_setPickOnly+e),Re.setPickOnly(e))},_Viewer.prototype.getPickOnly=function(){return Bp("getPickOnly",i.b.stringsByLabel.VIEWER_LOGGER_getPickOnly),Re.getPickOnly()},_Viewer.prototype.draw=function(){Bp("draw",i.b.stringsByLabel.VIEWER_LOGGER_draw),this[Vp._render](!0,!0)},_Viewer.prototype.translateByPsId=function(e,t,n,a){r.b._isString(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Bp("translateByPsId",i.b.stringsByLabel.VIEWER_LOGGER_translateByPsId);var o=b.getObjectByPsId(e,!0);if(r.b._notNullOrUndefined(o)){Dp("translateByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_translateByPsId);var s=(new _.Matrix4).makeTranslation(t,n,a);o.applyMatrix(s),o.updateMatrixWorld(!0),this[Vp._updateModelBoundingBox]()}this[Vp._render]()},_Viewer.prototype.rotateByPsId=function(e,t,n,a){r.b._isString(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Bp("rotateByPsId",i.b.stringsByLabel.VIEWER_LOGGER_rotateByPsId);var o=b.getObjectByPsId(e,!0);if(r.b._notNullOrUndefined(o)){var s=(new _.Matrix4).makeRotationX(t);o.applyMatrix(s),s.makeRotationY(n),o.applyMatrix(s),s.makeRotationZ(a),o.applyMatrix(s),o.updateMatrixWorld(!0),this[Vp._updateModelBoundingBox]()}this[Vp._render]()},_Viewer.prototype.scaleByPsId=function(e,t,n,a){r.b._isString(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Bp("scaleByPsId",i.b.stringsByLabel.VIEWER_LOGGER_scaleByPsId);var o=b.getObjectByPsId(e,!0);if(r.b._notNullOrUndefined(o)){Dp("scaleByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_scaleByPsId);var s=(new _.Matrix4).makeScale(t,n,a);o.applyMatrix(s),o.updateMatrixWorld(!0),this[Vp._updateModelBoundingBox]()}this[Vp._render]()},_Viewer.prototype.getMaterialByPsId=function(e){var t;r.b._isString(e,!0),Bp("getMaterialByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getMaterialByPsId);var n=b.getObjectByPsId(e,!0);return r.b._notNullOrUndefined(n)&&(n instanceof ze.Part||n instanceof ze.FaceShape||n instanceof ze.Edge||n instanceof ze.Vertex)?t=c.getUserMaterial(n):Rp("Do not support this psId type"),t},_Viewer.prototype.getSelectionMaterial=function(){var e=Re.getSelectedParts(),t=Re.getSelectedFaces(),n=Re.getSelectedEdges(),r=Re.getSelectedVertices();return _setMaterialObject.call(this,e,t,n,r)},_Viewer.prototype.getHighlightingMaterial=function(){var e=[],t=[],n=[],r=[];return Re[Di._getHighlightedPsIds](e,null,t,n,r),_setMaterialObject.call(this,e,t,n,r)},_Viewer.prototype.setMaterialByPsId=function(e,t,n,a){r.b._isString(e,!0),r.b._isObject(t,!0),r.b._optionalArgCheck(n,r.b._isBoolean),r.b._optionalArgCheck(a,r.b._isFunction),Bp("setMaterialByPsId",i.b.stringsByLabel.VIEWER_LOGGER_setMaterialByPsId),n=!!r.b._isBoolean(n)&&n,a=a||function(){};var o,s=this;if(o=e===b.userData.psId?b:b.getObjectByPsId(e,!0)){!function _checkMaterialDefinition(e,t){var n=0,i=0;(r.b._notNullOrUndefined(e.refractionUrls)||r.b._notNullOrUndefined(e.reflectionUrls))&&n++;r.b._notNullOrUndefined(e.bumpMapUrl)&&n++;if(n>0){var a=function(r){e.envMap=r,e.hasEnvMap=!0,++i===n&&t(e)};r.b._notNullOrUndefined(e.refractionUrls)?r.b._createRefractionCube(e.refractionUrls,a):r.b._notNullOrUndefined(e.reflectionUrls)&&r.b._createReflectionCube(e.reflectionUrls,a),r.b._notNullOrUndefined(e.bumpMapUrl)&&r.b._createBumpMap(e.bumpMapUrl,function(r){e.bumpMap=r,++i===n&&t(e)})}else t(e)}(t,function(e){!function _setMaterialByPsId(e,t,n,r){if(e.children&&0!==e.children.length||c.setUserMaterial(e,t,n),r&&e.children)for(var i=e.children.length,a=0;a<i;++a)_setMaterialByPsId(e.children[a],t,n,r)}(o,e,n,!0),e.opacity&&e.opacity<1&&s.setTransparentRenderingFlag(!0),s[Vp._render](),s[Vp._render](),a()})}},_Viewer.prototype.resetMaterialByPsId=function(e){var t;r.b._isString(e,!0),Bp("resetMaterialByPsId",i.b.stringsByLabel.VIEWER_LOGGER_resetMaterialByPsId),t=e===b.userData.psId?b:b.getObjectByPsId(e,!0),r.b._notNullOrUndefined(t)&&function _resetMaterialByPsId(e,t){if(e.children&&0!==e.children.length||c.resetUserMaterial(e),t&&e.children)for(var n=e.children.length,r=0;r<n;++r)_resetMaterialByPsId(e.children[r],t)}(t,!0),this[Vp._render]()},_Viewer.prototype.setCameraOrientation=function(e,t){if(r.b._isArray(e,!0,r.b._isNumber),r.b._optionalArgCheck(t,r.b._isNumber),Bp("setCameraOrientation",i.b.stringsByLabel.VIEWER_LOGGER_setCameraOrientation+e),10===e.length){v.preupdate(),g.matrix.identity(),g.matrixWorld.identity(),g.up.set(0,1,0),g.lookAt(new _.Vector3(0,0,-1));var n=new _.Vector3(e[0],e[1],e[2]),a=new _.Vector3(e[3],e[4],e[5]),o=e[6],s=new _.Vector3(e[7],e[8],e[9]),l=new _.Vector3(0,1,0),c=(new _.Vector3).subVectors(n,s),h=c.length();c.normalize(),a.normalize();var d=l.clone().sub(a).length();d*d<1e-5?l.set(0,0,-1):d>1.99999&&l.set(0,0,1),(d=l.clone().sub(c).length())*d<1e-5?l.set(-1,0,0):d>1.99999&&l.set(1,0,0),a.negate(),g.lookAt(a),g.up.copy(l),g.up.applyAxisAngle(a,o),a.negate();var f=(new _.Vector3).addVectors(s,c.clone().multiplyScalar(1.2*h));if(g.position.copy(f),g.lookAt(s),v.target.copy(s),u===m.c.ORTHOGRAPHIC){var y=1.2*(h=(c=(new _.Vector3).subVectors(n,s)).length())*Math.tan(Math.PI/180*p.fov);t&&t>p.aspect&&t>1&&(y*=t/p.aspect);var b=y/(2*Math.tan(Math.PI/180*p.fov/2));c.normalize(),c.multiplyScalar(b),f=c.addVectors(c,s),g.position.copy(f)}this[Vp._render](),Dp("setCameraOrientation",i.b.stringsByLabel.VIEWER_LOGGER_finest_setCameraOrientation)}},_Viewer.prototype.registerVisibilityEvent=function(e){r.b._isFunction(e,!0),Bp("registerVisibilityEvent",i.b.stringsByLabel.VIEWER_LOGGER_registerVisibilityEvent),r.b._isFunction(e)&&-1===r.b._eventMapIndex(z,e)&&z.push(e)},_Viewer.prototype.unregisterVisibilityEvent=function(e){r.b._isFunction(e,!0),Bp("unregisterVisibilityEvent",i.b.stringsByLabel.VIEWER_LOGGER_unregisterVisibilityEvent);var t=r.b._eventMapIndex(z,e);-1!==t&&z.splice(t,1)},_Viewer.prototype.registerVisibilityChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),Bp("registerVisibilityChangeEventByPsId",i.b.stringsByLabel.VIEWER_LOGGER_registerVisibilityChangeEventByPsId);var n=b.getObjectByPsId(e,!0);void 0!==n&&(void 0===n.userData.visibilityChangeEvents&&(n.userData.visibilityChangeEvents=[]),r.b._isFunction(t)&&-1===r.b._eventMapIndex(n.userData.visibilityChangeEvents,t)&&(Dp("registerVisibilityChangeEventByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_registerVisibilityChangeEventByPsId),n.userData.visibilityChangeEvents.push(t)))},_Viewer.prototype.unregisterVisibilityChangeEventByPsId=function(e,t){r.b._isString(e,!0),r.b._isFunction(t,!0),Bp("unregisterVisibilityChangeEventByPsId",i.b.stringsByLabel.VIEWER_LOGGER_unregisterVisibilityChangeEventByPsId);var n=b.getObjectByPsId(e,!0);if(void 0!==n&&void 0!==n.userData.visibilityChangeEvents){var a=r.b._eventMapIndex(n.userData.visibilityChangeEvents,t);-1!==a&&(n.userData.visibilityChangeEvents.splice(a,1),Dp("unregisterVisibilityChangeEventByPsId",i.b.stringsByLabel.VIEWER_LOGGER_finest_unregisterVisibilityChangeEventByPsId))}},_Viewer.prototype.getProductStructureInfo=function(e,t,n,a){r.b._optionalArgCheck(e,r.b._isString),r.b._optionalArgCheck(t,r.b._isArray,r.b._isNumber),r.b._optionalArgCheck(n,r.b._isNumber),r.b._optionalArgCheck(a,r.b._isBoolean),Bp("getProductStructureInfo",i.b.stringsByLabel.VIEWER_LOGGER_getProductStructureInfo),e=r.b._isNullOrUndefined(e)?this.psId:e,t=r.b._isNullOrUndefined(t)?[]:t,n=r.b._isNullOrUndefined(n)?1/0:n,a=!r.b._isNullOrUndefined(a)&&a;var o=b?b.getObjectByPsId(e,!0):null;return r.b._notNullOrUndefined(o)&&(a||"Body"!==o.type)?this[Vp._getStructureHelper](o,t,n,a):{ERROR:"Failed to get object for psId:"+e}},_Viewer.prototype[Vp._getStructureHelper]=function(e,t,n,i,a){var o={name:e.name,psId:e.userData.psId};if(t.forEach(function(t){switch(t){case m.a.UNITS:r.b._notNullOrUndefined(e.unit)&&(o.units=e.unit);break;case m.a.BOUNDING_BOX:r.b._notNullOrUndefined(e.boundingBox)&&(o.bbox={min:{x:e.boundingBox.min.x,y:e.boundingBox.min.y,z:e.boundingBox.min.z},max:{x:e.boundingBox.max.x,y:e.boundingBox.max.y,z:e.boundingBox.max.z}});break;case m.a.LOCAL_MATRIX:r.b._notNullOrUndefined(e.matrix)&&!r.b._isIdentity(e.matrix)&&(o.local=[e.matrix.elements[0],e.matrix.elements[4],e.matrix.elements[8],e.matrix.elements[12],e.matrix.elements[1],e.matrix.elements[5],e.matrix.elements[9],e.matrix.elements[13],e.matrix.elements[2],e.matrix.elements[6],e.matrix.elements[10],e.matrix.elements[14],e.matrix.elements[3],e.matrix.elements[7],e.matrix.elements[11],e.matrix.elements[15]]);break;case m.a.WORLD_MATRIX:r.b._notNullOrUndefined(e.matrixWorld)&&!r.b._isIdentity(e.matrixWorld)&&(o.world=[e.matrixWorld.elements[0],e.matrixWorld.elements[4],e.matrixWorld.elements[8],e.matrixWorld.elements[12],e.matrixWorld.elements[1],e.matrixWorld.elements[5],e.matrixWorld.elements[9],e.matrixWorld.elements[13],e.matrixWorld.elements[2],e.matrixWorld.elements[6],e.matrixWorld.elements[10],e.matrixWorld.elements[14],e.matrixWorld.elements[3],e.matrixWorld.elements[7],e.matrixWorld.elements[11],e.matrixWorld.elements[15]]);break;case m.a.VISIBILITY:r.b._notNullOrUndefined(e.visibilityState)&&(o.visibility=e.visibilityState);break;case m.a.SELECTION:r.b._notNullOrUndefined(e.selected)&&(o.selection=e.selected);break;case m.a.PMI_ASSOCIATIONS:var n=e.userData;r.b._notNullOrUndefined(n)&&(r.b._notNullOrUndefined(n.pmiIds)&&(o.pmiIds=n.pmiIds.slice(0)),r.b._notNullOrUndefined(n.nrPmiIds)&&(o.nrPmiIds=n.nrPmiIds.slice(0)),r.b._notNullOrUndefined(n.xtIds)&&(o.xtIds=n.xtIds.slice(0)));break;case m.a.GEOMETRY_COUNT:if(i){if(r.b._notNullOrUndefined(e.shapes)){u=_geometryCountHelper(e);o.geometryCount={},u.shapes.length>0&&(o.geometryCount.shapes=u.shapes),u.numLineSegment>0&&(o.geometryCount.numLineSegment=u.numLineSegment),u.numFace>0&&(o.geometryCount.numFace=u.numFace),u.numEdge>0&&(o.geometryCount.numEdge=u.numEdge),u.numVertex>0&&(o.geometryCount.numVertex=u.numVertex)}}else if(e instanceof ze.Part&&e.children.length>0){for(var s=[],l=0;l<e.children.length;l++){var c=e.children[l];if(r.b._notNullOrUndefined(c.shapes)){var u,h={};(u=_geometryCountHelper(c)).shapes.length>0&&(h.shapes=u.shapes),u.numLineSegment>0&&(h.numLineSegment=u.numLineSegment),u.numFace>0&&(h.numFace=u.numFace),u.numEdge>0&&(h.numEdge=u.numEdge),u.numVertex>0&&(h.numVertex=u.numVertex),s.push(h)}}o.geometryCount={},s.length>0&&(o.geometryCount.bodies=s)}if(e instanceof st&&r.b._notNullOrUndefined(e.shapes)){o.geometryCount={},o.geometryCount.pmiObjects=[];for(l=0;l<e.shapes.length;l++)if(r.b._notNullOrUndefined(e.shapes[l].geometry)){var d={};d.type=e.shapes[l].type,e.shapes[l]instanceof ze.PmiLine?d.lineSegmentCount=e.shapes[l].geometry.index.count/2:e.shapes[l]instanceof ze.PmiSurface&&(d.triangleCount=e.shapes[l].geometry.index.count/3),r.b._isObjectEmpty(d)||o.geometryCount.pmiObjects.push(d)}}break;case m.a.MATERIALS:if(r.b._isNullOrUndefined(a)&&(o.materialObjects=[],a=o.materialObjects),0===a.length&&r.b._notNullOrUndefined(e.shapes)){var p=e.shapes[0];if(p instanceof ze.PartShape)for(l=0;l<p.material.length;l++){var f={};r.b._isNullOrUndefined(p.material[l])?f=void 0:r.b._notNullOrUndefined(p.material[l].vertexShader)&&p.material[l].vertexShader.includes("PHONG")?(f.colorType="Phong",f.diffuseColor=p.material[l].uniforms.diffuse.value,f.emissiveColor=p.material[l].uniforms.emissive.value,f.specularColor=p.material[l].uniforms.specular.value,f.shininess=p.material[l].uniforms.shininess.value,f.opacity=p.material[l].uniforms.opacity.value):(f.type="Basic",f.diffuseColor=p.material[l].uniforms.diffuse.value,f.opacity=p.material[l].uniforms.opacity.value),r.b._isObjectEmpty(f)||a.push(f)}}}}),r.b._notNullOrUndefined(e.children)&&e.children.length>0){var s=e.children.length;if(n>0){o.children=[];for(var l=0;l<s;++l){var c=e.children[l];(i||"Body"!==c.type)&&(c instanceof ce||c instanceof st)&&o.children.push(this[Vp._getStructureHelper](e.children[l],t,n-1,i,a))}0===o.children.length&&delete o.children}else{o.childrenIds=[];for(l=0;l<s;++l){c=e.children[l];(i||"Body"!==c.type)&&o.childrenIds.push(c.userData.psId)}0===o.childrenIds.length&&delete o.childrenIds}}return o},_Viewer.prototype.setCameraOrientationInfo=function(e){if(r.b._isObject(e,!0),Bp("setCameraOrientationInfo",i.b.stringsByLabel.VIEWER_LOGGER_setCameraOrientationInfo),e&&e.pos&&3===e.pos.length&&e.tgt&&3===e.tgt.length&&e.rot&&4===e.rot.length){v.preupdate(),v.reset(),g.position.fromArray(e.pos);var t=(new _.Vector3).fromArray(e.tgt),n=(new _.Quaternion).fromArray(e.rot);g.up.applyQuaternion(n),g.lookAt(t),v.target.copy(t),g.updateMatrix(),g.updateMatrixWorld(),this[Vp._render]()}},_Viewer.prototype.getCameraOrientationInfo=function(){return Bp("getCameraOrientationInfo",i.b.stringsByLabel.VIEWER_LOGGER_getCameraOrientationInfo),{pos:g.position.toArray(),rot:g.quaternion.toArray(),tgt:v.target.toArray()}},_Viewer.prototype.getCameraInfo=function(e=!0){Bp("getCameraInfo",i.b.stringsByLabel.VIEWER_LOGGER_getCameraInfo),e&&(u===m.c.ORTHOGRAPHIC&&_updatePerspectiveCamera(),_updateOrthoCamera());var t={};return t.perspective={pos:p.position.toArray(),rot:p.quaternion.toArray(),tgt:v.target.toArray(),up:p.up.toArray(),zoom:p.zoom,fov:p.fov,aspect:p.aspect,near:p.near,far:p.far},t.orthographic={pos:f.position.toArray(),rot:f.quaternion.toArray(),tgt:v.target.toArray(),up:f.up.toArray(),near:f.near,far:f.far,left:f.left,right:f.right,top:f.top,bottom:f.bottom},t},_Viewer.prototype.modelHasPmi=function(e){r.b._isString(e,!0),Bp("modelHasPmi",i.b.stringsByLabel.VIEWER_LOGGER_modelHasPmi);var t=b.getObjectByPsId(e,!0);return!!t&&t.userData.modelHasPmi},_Viewer.prototype.modelHasXt=function(e){r.b._isString(e,!0),Bp("modelHasXt",i.b.stringsByLabel.VIEWER_LOGGER_modelHasXt);var t=b.getObjectByPsId(e,!0);return t&&r.b._isBoolean(t.objectHasXT)?t.objectHasXT:(Dp("modelHasXt",i.b.stringsByLabel.VIEWER_LOGGER_warn_modelHasXt),!1)},_Viewer.prototype.doesPrototypeExist=function(e){return r.b._isNullOrUndefined(e)?(Bp("doesPrototypeExist API: ",i.b.stringsByLabel.VIEWER_LOGGER_error_PrototypeId),null):c._prototypeContainer.inProtoIdToObjectMap(e)},_Viewer.prototype.doesNodeExist=function(e){return r.b._isNullOrUndefined(e)?(Bp("doesNodeExist API: ",i.b.stringsByLabelVIEWER_LOGGER_error_PsId),null):b.inPsIdToObjectMap(e)},_Viewer.prototype.createPrototype=function(e){if(!r.b._notNullOrUndefined(e.protoId))return Gp("createPrototype API: ",i.b.stringsByLabel.VIEWER_LOGGER_error_PrototypeId),null;var t=new Mp(e.title,this[Vp._getBBox](e),e.units);if(t.protoId=e.protoId,r.b._notNullOrUndefined(e.parent)&&r.b._isNullOrUndefined(t.parent)){if(!c._prototypeContainer.inProtoIdToObjectMap(e.parent))return Gp("createPrototype",i.b.stringsByLabel.VIEWER_DAC_LOGGER_ERROR_invalidParent+e.parent),null;var n=c._prototypeContainer.getObjectByProtoId(e.parent);if("Original"===n.parent.type)return Gp("createPrototype: cannot add children to a body prototype"),null;n.add(t)}else c._prototypeContainer.add(t);if(c._prototypeContainer.addProtoIdToObjectMap(t.protoId,t),r.b._notNullOrUndefined(e.xtFileRef)&&(t.objectHasXT=!0,t.xtFileRef=e.xtFileRef,e.xtFileLen&&(t.xtFileLen=e.xtFileLen)),r.b._notNullOrUndefined(e.fileRef)?(r.b._notNullOrUndefined(e.baseRef)&&(t.baseRef=e.baseRef),t.objectFileRef=e.fileRef):r.b._notNullOrUndefined(e.b64data)&&(t.b64data=r.b._decodeBase64ToBinaryBuffer(e.b64data)),r.b._notNullOrUndefined(e.fileLen)&&(t.objectFileLen=e.fileLen),r.b._notNullOrUndefined(e.xtData)&&(t.xtb64data=r.b._decodeBase64ToBinaryBuffer(e.xtData)),r.b._notNullOrUndefined(n)&&r.b._notNullOrUndefined(n.instances))for(var a=0,o=n.instances.length;a<o;a++){var s=n.instances[a],l=new Xn(t);l.userData.psId=s.userData.psId+"|"+e.protoId,l.psId=e.protoId,s.add(l)}return e.protoId},_Viewer.prototype.updatePrototype=function(e,t){if(r.b._isString(e,!0),r.b._isObject(t,!0),!c._prototypeContainer.inProtoIdToObjectMap(e))return Gp("update API: ",i.b.stringsByLabel.VIEWER_LOGGER_error_PrototypeId),null;var n=!1,a=c._prototypeContainer.getObjectByProtoId(e);r.b._notNullOrUndefined(t.title)&&(a.name=t.title),r.b._notNullOrUndefined(t.unit)&&(a.unit=t.unit);var o=this[Vp._getBBox](t);if(r.b._notNullOrUndefined(o)&&!o.equals(a.boundingBox)&&(a.boundingBox=o,n=!0),r.b._notNullOrUndefined(t.fileRef)&&(a.objectFileRef=t.fileRef),r.b._notNullOrUndefined(t.b64data)&&(a.b64data=r.b._decodeBase64ToBinaryBuffer(t.b64data)),n){for(var s=0,l=a.instances.length;s<l;s++)a.instances[s].updateMatrixWorld(!0),this[Vp._expandModelBoundingBox](a.instances[s]);this[Vp._render]()}},_Viewer.prototype.createNode=function(e){r.b._isObject(e,!0);var t=null,n=null,a=null,o=b,s=null,l=D;if(r.b._notNullOrUndefined(e.parent)&&"-1"!==e.parent){if(o=b.getObjectByPsId(e.parent,!0),r.b._isNullOrUndefined(o))return Bp("createNode",i.b.stringsByLabel.VIEWER_DAC_LOGGER_ERROR_invalidParent+e.parent),null;l=function _parseModelId(e){var t=e.indexOf(":");return t<=0?null:e.substring(0,t)}(o.userData.psId)}else l=++D;if(r.b._notNullOrUndefined(e.instanceId))t=(n=b.getObjectByPsId(e.instanceId.toString(),!0)).original?n.original:null,a="Part"===n.type?new ze.Part(t):"Body"===n.type?new Xn(t):new ze.Assembly(e.title,n.boundingBox,n.units);else if(r.b._notNullOrUndefined(e.protoId)){t=c._prototypeContainer.getObjectByProtoId(e.protoId,!0);a="Part"===o.type?new Xn(t):new ze.Part(t)}else a=r.b._notNullOrUndefined(e.fileRef)||r.b._notNullOrUndefined(e.b64data)?"Part"===o.type?new Xn(new Mp(e.title,this[Vp._getBBox](e),e.units)):new ze.Part(new Mp(e.title,this[Vp._getBBox](e),e.units)):new ze.Assembly(e.title,this[Vp._getBBox](e),e.units);if(s=r.b._notNullOrUndefined(e.psId)&&!b.inPsIdToObjectMap(e.psId)?e.psId:function _getNextDacPsid(){for(var e=V+++"_D";b.inPsIdToObjectMap(D+":"+e);)e=V+++"_D";return e}(),a.userData.psId=l+":"+s,a.psId=s,"Body"!==a.type&&b.addPsIdToObjectMap(a.userData.psId,a),r.b._isNullOrUndefined(a.baseRef)&&(r.b._notNullOrUndefined(e.baseRef)?(a.userData.modelPath=e.baseRef,a.baseRef=e.baseRef,"/"!==a.baseRef[a.baseRef.length-1]&&(a.baseRef+="/")):a.baseRef=r.b._notNullOrUndefined(o.baseRef)?o.baseRef:""),a.percentLoaded=0,a.name=e.title,r.b._notNullOrUndefined(e.color)&&(a.userData.overrideColor=e.color),("Section Geometry"===a.name||a.sectionGeometry)&&(a.sectionGeometry=!0),r.b._notNullOrUndefined(e.color)&&(a.userData.overrideColor=e.color),a.objectHasXT=!1,r.b._notNullOrUndefined(n))a.userData.objectInstanceId=n.userData.psId,"Assembly"===n.type?(a.setOriginal(n,a.userData.psId),a.traverse(function(e){"Body"!==e.type&&"Part"!==e.type||(c.setShapesOnInstance(e),c.setEdgesOnInstance(e))})):(c.setShapesOnInstance(a),c.setEdgesOnInstance(a));else if(r.b._notNullOrUndefined(t)){if(a.userData.objectInstanceId=t.protoId,c.setShapesOnInstance(a),c.setEdgesOnInstance(a),r.b._notNullOrUndefined(t.children)&&t.children.length>0)for(var u,h,d=0,p=t.children.length;d<p;d++)u=t.children[d],(h=new Xn(u)).userData.psId=a.userData.psId+"|"+u.protoId,h.psId=u.protoId,a.add(h),c.setShapesOnInstance(h),c.setEdgesOnInstance(h)}else"Part"!==a.type&&"Body"!==a.type||(r.b._notNullOrUndefined(e.xtFileRef)&&(a.objectHasXT=!0,a.xtFileRef=e.xtFileRef,e.xtFileLen&&(a.xtFileLen=e.xtFileLen)),a.userData.cbQueue=[],r.b._notNullOrUndefined(e.fileRef)?(r.b._notNullOrUndefined(e.baseRef)?a.baseRef=e.baseRef:o.userData&&o.baseRef&&(a.baseRef=o.baseRef),a.objectFileRef=e.fileRef):r.b._notNullOrUndefined(e.b64data)&&(a.b64data=r.b._decodeBase64ToBinaryBuffer(e.b64data)),r.b._notNullOrUndefined(e.fileLen)&&(a.objectFileLen=e.fileLen),r.b._notNullOrUndefined(e.xtData)&&(a.xtb64data=r.b._decodeBase64ToBinaryBuffer(e.xtData)));return r.b._notNullOrUndefined(e.xform)&&16===e.xform.length&&e.xform.reduce(_isNumberCallback,!0)?a.matrix.set(e.xform[0],e.xform[4],e.xform[8],e.xform[12],e.xform[1],e.xform[5],e.xform[9],e.xform[13],e.xform[2],e.xform[6],e.xform[10],e.xform[14],e.xform[3],e.xform[7],e.xform[11],e.xform[15]):a.matrix.identity(),o.add(a),a.updateMatrixWorld(!0),r.b._notNullOrUndefined(a.boundingBox)&&r.b._unionModelBBox(w,a.boundingBox,a.matrixWorld),Dp("createNode",i.b.stringsByLabel.VIEWER_DAC_LOGGER_createNode+a.userData.psId),a.userData.psId},_Viewer.prototype.updateNode=function(e,t){if(r.b._isString(e,!0),r.b._isObject(t,!0),b.inPsIdToObjectMap(e)){var n=!1,a=b.getObjectByPsId(e),o=a.original;if(r.b._notNullOrUndefined(t.title)&&(o.name=t.title),r.b._notNullOrUndefined(t.parent)&&r.b._notNullOrUndefined(a.parent)&&a.parent.psId!==t.parent){var s=b.getObjectByPsId(t.parent);r.b._notNullOrUndefined(s)&&(s.add(a),n=!0)}if(r.b._notNullOrUndefined(t.unit)&&(o.unit=t.unit),r.b._notNullOrUndefined(t.xform)&&16===t.xform.length&&t.xform.reduce(_isNumberCallback,!0)){var l=(new _.Matrix4).set(t.xform[0],t.xform[4],t.xform[8],t.xform[12],t.xform[1],t.xform[5],t.xform[9],t.xform[13],t.xform[2],t.xform[6],t.xform[10],t.xform[14],t.xform[3],t.xform[7],t.xform[11],t.xform[15]);a.matrix.equals(l)||(a.matrix=l,n=!0)}var c=this[Vp._getBBox](t);if(r.b._notNullOrUndefined(c)&&!c.equals(o.boundingBox)&&(o.boundingBox=c,n=!0),r.b._notNullOrUndefined(t.color)&&(a.userData.overrideColor=t.color),("Part"===a.type||"Body"===a.type&&r.b._notNullOrUndefined(t.fileRef))&&(o.objectFileRef=t.fileRef),("Part"===a.type||"Body"===a.type&&r.b._notNullOrUndefined(t.b64data))&&(o.b64data=t.b64data),n){for(var u=0,h=o.instances.length;u<h;u++)o.instances[u].updateMatrixWorld(!0),this[Vp._expandModelBoundingBox](o.instances[u]);this[Vp._render]()}}else Bp("updateNode",i.b.stringsByLabel.VIEWER_DAC_LOGGER_ERROR_invalidNode+e)},_Viewer.prototype.deleteNode=function(e,t=!0){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean);var n=b.getObjectByPsId(e);if(xt&&this.isExtensionLoaded(xt)){var a=this.getExtensionManager(xt);n===b?a[bt._removeNode](a.psId):a[bt._removeNode](e)}if(r.b._notNullOrUndefined(n)){if(n.visible=!1,n.visibilityState=m.D.None,_fireVisibilityChangeEvents(n),!t&&r.b._notNullOrUndefined(n.children)&&n.children.length>0)for(;n.children.length>0;)n.parent.add(n.children[0]);n.dispose()}else Bp("deleteNode",i.b.stringsByLabel.VIEWER_DAC_LOGGER_ERROR_invalidNode+e);this[Vp._render]()},_Viewer.prototype.deletePrototype=function(e){r.b._isString(e,!0);var t=c._prototypeContainer.getObjectByProtoId(e);r.b._notNullOrUndefined(t)?t.dispose():console.error("Error: Bad Protoype Id"),this[Vp._render]()},_Viewer.prototype.removeNode=function(e){r.b._isString(e,!0),this.deleteNode(e,!0)},_Viewer.prototype.createAssemblyNode=function(e,t){r.b._isString(e,!0),r.b._isObject(t,!0);var n=t||{};return n.title=e,this.createNode(n)},_Viewer.prototype.createPartNode=function(e,t){r.b._isString(e,!0),r.b._isObject(t,!0);var n=t||{};return n.title=e,this.createNode(n)},_Viewer.prototype.createInstanceNode=function(e,t){r.b._isString(e,!0),r.b._isObject(t,!0);var n=t||{};return n.instanceId=e,n.title=n.name,delete n.name,this.createNode(n)},_Viewer.prototype.getParentPsId=function(e){if(r.b._isString(e,!0),void 0!==e){var t=b.getObjectByPsId(e,!0);if(t)return t.parent.userData.psId}return null},_Viewer.prototype.unloadGeometryByPsId=function(e){r.b._isString(e,!0),Bp("unloadGeometryByPsId",i.b.stringsByLabel.VIEWER_LOGGER_unloadGeometryByPsId);var t=e===b.userData.psId?b:b.getObjectByPsId(e,!0);void 0!==t&&null!==t&&c.unloadObject(t),t.visibilityState&&_setObjectVisibility(t,!1),this[Vp._render]()},_Viewer.prototype.loadGeometryByPsId=function(e,t){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),Bp("loadGeometryByPsId",i.b.stringsByLabel.VIEWER_LOGGER_loadGeometryByPsId),t=t||function(){};var n=e===b.userData.psId?b:b.getObjectByPsId(e,!0);if(n&&(void 0===n.isLoading||void 0!==n.isLoading&&!n.isLoading))if(n.shapesLoaded){var a=function(){this[Vp._render](),t()}.bind(this);Oe.loadShapes({object:n,doneCallback:a})}else{var o=function(){this[Vp._fireProgressEvents](101),t()}.bind(this);this[Vp._loadGeometryHelper](n,o)}else this[Vp._render](),t()},_Viewer.prototype[Vp._loadGeometryHelper]=function(e,t,n){void 0===t&&(t=function(){this[Vp._fireProgressEvents](101)}.bind(this)),void 0===n&&(n=function(){this[Vp._fireProgressEvents](e.percentLoaded)}.bind(this)),this[Vp._fireProgressEvents](-1),Oe.loadShapes({object:e,doneCallback:t,progressCallback:n})},_Viewer.prototype.setDrawWhileLoading=function(e){r.b._isBoolean(e,!0),Bp("setDrawWhileLoading",i.b.stringsByLabel.VIEWER_LOGGER_setDrawWhileLoading+e),P=e},_Viewer.prototype.getDrawWhileLoading=function(){return Bp("getDrawWhileLoading",i.b.stringsByLabel.VIEWER_LOGGER_getDrawWhileLoading),P},_Viewer.prototype.setAutoDraw=function(e){r.b._isBoolean(e,!0),Bp("setAutoDraw",i.b.stringsByLabel.VIEWER_LOGGER_setAutoDraw+e),ie=e},_Viewer.prototype.getAutoDraw=function(){return Bp("getAutoDraw",i.b.stringsByLabel.VIEWER_LOGGER_getAutoDraw),ie},_Viewer.prototype.setDrawPerParts=function(e){r.b._isNumber(e,!0),Bp("setDrawPerParts",i.b.stringsByLabel.VIEWER_LOGGER_setDrawPerParts),r.b._isNumber(e)&&e>0&&(ae=e)},_Viewer.prototype.getDrawPerParts=function(){return Bp("getDrawPerParts",i.b.stringsByLabel.VIEWER_LOGGER_getDrawPerParts),ae},_Viewer.prototype.applyTransformationMatrixByPsId=function(e,t){if(r.b._isString(e,!0),r.b._isArray(t,!0,r.b._isNumber),Bp("applyTransformationMatrixByPsId",i.b.stringsByLabel.VIEWER_LOGGER_applyTransformationMatrixByPsId),e!==this.psId&&Array.isArray(t)&&16===t.length){var n=b.getObjectByPsId(e,!0);if(n){var a=(new _.Matrix4).fromArray(t);n.matrixAutoUpdate=!1,n.applyMatrix(a),n.updateMatrixWorld(!0),this[Vp._updateModelBoundingBox]()}this[Vp._render]()}},_Viewer.prototype.setSectionCaps=function(e){(r.b._isBoolean(e,!0),Bp("setSectionCaps",i.b.stringsByLabel.VIEWER_LOGGER_setSectionCaps),r.b._isBoolean(e)&&e!==me)&&(me=e,$i&&this.isExtensionLoaded($i)&&this.getExtensionManager($i).updateSection())},_Viewer.prototype.getSectionEdges=function(){return ge},_Viewer.prototype.setSectionEdges=function(e){(r.b._isBoolean(e,!0),r.b._isBoolean(e)&&e!==ge)&&(ge=e,$i&&this.isExtensionLoaded($i)&&this.getExtensionManager($i).updateSection())},_Viewer.prototype.getSectionCaps=function(){return Bp("getSectionCaps",i.b.stringsByLabel.VIEWER_LOGGER_getSectionCaps),me},_Viewer.prototype.setUserCapColor=function(e){(r.b._isObject(e,!0),_setUserCapColor(e),$i&&this.isExtensionLoaded($i))&&this.getExtensionManager($i).updateSection()},_Viewer.prototype.resetUserCapColor=function(){(_setUserCapColor({diffuse:10066329,emissive:0,specular:0,shininess:1,opacity:1}),$i&&this.isExtensionLoaded($i))&&this.getExtensionManager($i).updateSection()},_Viewer.prototype.setUserCapColorEnabled=function(e){(r.b._isBoolean(e,!0),r.b._isBoolean(e))&&(this._scene._sectionCapMaterial.enabled!==e&&(this._scene._sectionCapMaterial.enabled=e,$i&&this.isExtensionLoaded($i)&&this.getExtensionManager($i).updateSection()))},_Viewer.prototype.getUserCapColorEnabled=function(){return!(void 0===c._sectionCapMaterial.enabled||!1===c._sectionCapMaterial.enabled)},_Viewer.prototype.setDragFlag=function(e){r.b._isBoolean(e,!0),Bp("setDragFlag",i.b.stringsByLabel.VIEWER_LOGGER_setDragFlag),r.b._isBoolean(e)&&(W=e)},_Viewer.prototype.getDragFlag=function(){return Bp("getDragFlag",i.b.stringsByLabel.VIEWER_LOGGER_getDragFlag),W},_Viewer.prototype.setDragAxes=function(e){r.b._isString(e,!0),Bp("setDragAxes",i.b.stringsByLabel.VIEWER_LOGGER_setDragAxes+e);O=r.b._isString(e)&&null===/[^xyzXYZ]/.exec(e)?e:"XYZ"},_Viewer.prototype.getDragAxes=function(){return Bp("getDragAxes",i.b.stringsByLabel.VIEWER_LOGGER_getDragAxes),O},_Viewer.prototype.setDragSpriteOnly=function(e){r.b._isBoolean(e,!0),Bp("setDragSpriteOnly",i.b.stringsByLabel.VIEWER_LOGGER_setDragSpriteOnly),void 0!==e&&null!==e&&(B=e)},_Viewer.prototype.getDragSpriteOnly=function(){return Bp("getDragSpriteOnly",i.b.stringsByLabel.VIEWER_LOGGER_getDragSpriteOnly),B},_Viewer.prototype.isRendering=function(){return Bp("isRendering",i.b.stringsByLabel.VIEWER_LOGGER_isRendering),null!==l},_Viewer.prototype.overrideMouseNavigationControls=function(e,t){if(r.b._isObject(e,!0),r.b._isObject(t,!0),Bp("overrideMouseNavigationControls",i.b.stringsByLabel.VIEWER_LOGGER_overrideMouseNavigationControls),r.b._isFunction(v.dispose)&&v.dispose(),v=new e(g,s.domElement),t instanceof Object)for(var n=Object.keys(t),a=0;a<n.length;a++)v[n[a]]=t[n[a]]},_Viewer.prototype.overrideMouseNavigationInput=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0),Bp("overrideMouseNavigationInput",i.b.stringsByLabel.VIEWER_LOGGER_overrideMouseNavigationInput),v.overrideMouseNavigationInput(e,t)},_Viewer.prototype.addImageToScene=function(e,t,n){r.b._isString(e,!0),r.b._isArray(t,!0,r.b._isNumber),r.b._optionalArgCheck(n,r.b._isFunction),Bp("addImageToScene",i.b.stringsByLabel.VIEWER_LOGGER_addImageToScene),n=n||function(){};var a,o=new _.TextureLoader;o.load(e,function(e){if(e.wrapS=_.RepeatWrapping,e.wrapT=_.RepeatWrapping,void 0!==a&&a instanceof _.Mesh)a.material.uniforms.tImage.value=e;else{var r,i,s=He.c.phongSection;(r=_.UniformsUtils.clone(s.uniforms)).diffuse.value.setHex(16777215),r.emissive.value.setHex(0),r.specular.value.setHex(0),r.shininess.value=0,r.opacity.value=0,void 0!==e&&null!==e&&(r.map.value=e),i={fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:r,lights:!0,fog:!1,side:null,blending:_.NormalBlending,transparent:!1};var l=new _.ShaderMaterial(i),c=new _.BufferGeometry;l.side=_.DoubleSide;var u=[-e.image.width/2,-e.image.height/2,0,e.image.width/2,-e.image.height/2,0,e.image.width/2,e.image.height/2,0,-e.image.width/2,e.image.height/2,0];c.setIndex(new _.BufferAttribute(new Uint32Array([0,1,2,2,3,0]),1)),c.addAttribute("position",new _.BufferAttribute(new Float32Array(u),3)),c.addAttribute("normal",new _.BufferAttribute(new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),3)),c.addAttribute("uv",new _.BufferAttribute(new Float32Array([0,0,1,0,1,1,0,1]),2)),l.map=e,a=new _.Mesh(c,l),e.needsUpdate=!0,a.geometry.computeBoundingBox(),a.geometry.boundingBox.max.z=1,a.geometry.boundingBox.min.z=-1,b.add(a),Bp("addImageToScene API:Image has been added to the scene.");var h=(new _.Matrix4).fromArray(t);a.matrixAutoUpdate=!1,a.applyMatrix(h),a.updateMatrixWorld(!0),this[Vp._expandModelBoundingBox](a),this[Vp._render]()}n(!0,a.id),e.needsUpdate=!0,a.visible=!0,o=null}.bind(this))},_Viewer.prototype.updateRaycaster=function(e){var t=r.b._calculatePixelScale(this[Vp._getCamera](),s.domElement),n=this[Vp._getVisibleModelBoundingBox](),i=new _.Sphere;n.getBoundingSphere(i),t=Math.max(t,.001*i.radius),e.linePrecision=r.b._getRaycasterLinePrecision()*t,e.params.Points.threshold=r.b._getRaycasterPointSize()*t},_Viewer.prototype.getPsIdAtViewCoordinate=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0),Bp("getPsIdAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_getPsIdAtViewCoordinate);var n=r.b._getObjectAtViewportCoordinate(e,t,s.domElement,c,De,this[Vp._getCamera](),c.pickingMode),a=null===n?null:n.object;return null!==a?a.isPmi?(Dp("getPsIdAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_finest_getPsIdAtViewCoordinate+a.userData.psId),{psId:a.userData.psId,type:m.y.PMI}):(a instanceof _.Mesh||a instanceof _.LineSegments?a=a.parent:a instanceof _.Vector3&&(a=n.parent),Dp("getPsIdAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_finest_getPsIdAtViewCoordinate+a.userData.psId),{psId:a.userData?a.userData.psId:null,type:m.y.PART}):null},_Viewer.prototype.getFaceNormalAtViewCoordinate=function(e,t){r.b._isNumber(e,!0),r.b._isNumber(t,!0),Bp("getFaceNormalAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_getFaceNormalAtViewCoordinate);var n=new _.Vector3,a=new je.a,o={type:m.i.pickingOverride},l=this[Vp._getCamera]();n.set(e/s.domElement.offsetWidth*2-1,1-t/s.domElement.offsetHeight*2,1),this.updateRaycaster(a);var u={};u.pickingMode=m.x.FACE,u.spriteOnly=!1,a.setFromCamera(n,l);var h=c.search(a);if(!h||0===h.length)return Dp("getFaceNormalAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_warn_getFaceNormalAtViewCoordinate),null;var d=a.intersectOctreeObjects(h,u,!0);return d.length>0&&(o.candidates=d,c.dispatchEvent(o)),d[0]&&d[0].face?(Dp("getFaceNormalAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_finest_getFaceNormalAtViewCoordinate+d[0].face.normal),d[0].face.normal.toArray()):(Dp("getFaceNormalAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_warn_getFaceNormalAtViewCoordinate),null)},_Viewer.prototype.getFaceNormalAtModelCoordinate=function(e,t,n,a){var o;r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._optionalArgCheck(a,r.b._isString),r.b._isNullOrUndefined(a)||"FaceShape"!==(o=b.getObjectByPsId(a)).type&&(o=null),Bp("getFaceNormalAtModelCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_getFaceNormalAtModelCoordinate);var l=null,u=new _.Vector3,h=new je.a,d={type:m.i.pickingOverride},p=this[Vp._getCamera](),f=this.projectModelPointToViewCoordinate(e,t,n);u.set(f[0]/s.domElement.offsetWidth*2-1,1-f[1]/s.domElement.offsetHeight*2,1),this.updateRaycaster(h);var g,v={};if(v.pickingMode=m.x.FACE,v.spriteOnly=!1,h.setFromCamera(u,p),o)(g=h.intersectObject(o.parent,v,!1)).length>0&&(d.candidates=g,c.dispatchEvent(d));else{var y=c.search(h);if(!y||0===y.length)return Dp("getFaceNormalAtModelCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_warn_getFaceNormalAtModelCoordinate),null;(g=h.intersectOctreeObjects(y,v,!0)).length>0&&(d.candidates=g,c.dispatchEvent(d))}for(var x=!1,w=0,M=g.length;w<M&&!x;++w)Math.abs(g[w].point.x-e)<=1e-6&&Math.abs(g[w].point.y-t)<=1e-6&&Math.abs(g[w].point.z-n)<=1e-6&&(l=g[w].face.normal.toArray(),x=!0);return x?Dp("getFaceNormalAtModelCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_finest_getFaceNormalAtModelCoordinate+l[0],l[1],l[2]):Dp("getFaceNormalAtModelCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_warn_getFaceNormalAtModelCoordinate),l},_Viewer.prototype.getModelPointAtViewCoordinate=function(e,t,n=!1){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._optionalArgCheck(n,r.b._isBoolean),Bp("getModelPointAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_getModelPointAtViewCoordinate);var a={type:m.i.pickingOverride},o=r.b._getIntersectionsAtViewportCoordinate(e,t,s.domElement,c,De,this[Vp._getCamera](),this.getPickingMode(),!1,!1);return r.b._notNullOrUndefined(o)?(o.length>0&&(a.candidates=o,c.dispatchEvent(a)),o.length>0&&o[0].object?(Dp("getModelPointAtViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_finest_getModelPointAtViewCoordinate+o[0].point.toArray()),n&&o[0].modelPoint?o[0].modelPoint.toArray():o[0].point.toArray()):(Dp("getModelPointAtViewCoordinate:  no objects found at coordinate:",e,t),null)):null},_Viewer.prototype.projectModelPointToViewCoordinate=function(e,t,n){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),Dp("projectModelPointToViewCoordinate",i.b.stringsByLabel.VIEWER_LOGGER_projectModelPointToViewCoordinate);var a=new _.Vector3(e,t,n);a.project(g);var o=this.domElement.width/2,s=this.domElement.height/2;return[a.x*o+o,this.domElement.height-(a.y*s+s)]},_Viewer.prototype.convertParameterToModelPoint=function(e,t){r.b._isString(e,!0),r.b._isNumber(t,!0),Dp("convertParameterToModelPoint",i.b.stringsByLabel.VIEWER_LOGGER_convertParameterToModelPoint);var n=b.getObjectByPsId(e);if(n)if("Edge"===n.type){var a=this.getExtensionManager(Hn);if(a)return a.convertUtoModelSpace(xtId,t)}else if("FaceShape"===n.type&&n.face){var o=n.parent.geometry.index.array,s=n.parent.geometry.attributes.position.array,l=o[n.face.start],c=o[n.face.start+n.face.count-1];if(0===t)return[s[3*l],s[3*l+1],s[3*l+2]];if(1===t)return[s[3*c],s[3*c+1],s[3*c+2]]}return Dp("convertParameterToModelPoint",i.b.stringsByLabel.VIEWER_LOGGER_warn_convertParameterToModelPoint),null},_Viewer.prototype.convertModelPointToParameter=function(e,t,n,a){r.b._isString(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Dp("convertModelPointToParameter",i.b.stringsByLabel.VIEWER_LOGGER_convertModelPointToParameter);var o=b.getObjectByPsId(e);if(o)if("Edge"===o.type){var s=this.getExtensionManager(Hn);if(s)return s.convertModelSpaceToU(xtId,[t,n,a])}else if("FaceShape"===o.type&&o.face){var l=o.parent.geometry.index.array,c=o.parent.geometry.attributes.position.array,u=l[o.face.start],h=l[o.face.start+o.face.count-1];if(r.b._vertexEqual(t,n,a,c[3*u],c[3*u+1],c[3*u+2],1e-4))return 0;if(r.b._vertexEqual(modelPoint[0],modelPoint[1],modelPoint[2],c[3*h],c[3*h+1],c[3*h+2],1e-4))return 1}return Dp("convertModelPointToParameter",i.b.stringsByLabel.VIEWER_LOGGER_warn_convertModelPointToParameter),null},_Viewer.prototype.exportProductStructure=function(){return Rp("exportProductStructure is deprecated.  Please see Viewer.getProductStructureInfo instead."),{}},_Viewer.prototype.setDefaultMaterialSide=function(e){r.b._isBoolean(e,!0),Bp("setDefaultMaterialSide",i.b.stringsByLabel.VIEWER_LOGGER_setDefaultMaterialSide),ne=e?_.FrontSide:_.DoubleSide,this[Vp._render](),this[Vp._render]()},_Viewer.prototype.getDefaultMaterialSide=function(){return Bp("getDefaultMaterialSide",i.b.stringsByLabel.VIEWER_LOGGER_getDefaultMaterialSide),ne},_Viewer.prototype.setDefaultBackgroundRGBA=function(e,t,n,i){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(i,!0),G.color.setRGB(e,t,n),G.alpha=i,this.clearBackgroundColor()},_Viewer.prototype.getDefaultBackgroundRGBA=function(){return{r:G.color.r,g:G.color.g,b:G.color.b,a:G.alpha}},_Viewer.prototype.clearBackgroundColor=function(){s.setClearColor(G.color.getHex(),G.alpha),this[Vp._render]()},_Viewer.prototype.setBackgroundColor=function(e,t){Bp("setBackgroundColor",i.b.stringsByLabel.VIEWER_LOGGER_setBackgroundColor+e),s.setClearColor(e,t),this[Vp._render]()},_Viewer.prototype.getActiveCameraControl=function(){return Bp("getActiveCameraControl",i.b.stringsByLabel.VIEWER_LOGGER_getActiveCameraControl),v},_Viewer.prototype.setTransformationMatrixByPsId=function(e,t){if(r.b._isString(e,!0),r.b._isArray(t,!0,r.b._isNumber),Bp("setTransformationMatrixByPsId",i.b.stringsByLabel.VIEWER_LOGGER_setTransformationMatrixByPsId),e!==this.psId){var n=b.getObjectByPsId(e,!0);if(n){var a=(new _.Matrix4).fromArray(t);n.matrixAutoUpdate=!1,n.matrix.copy(a),n.updateMatrixWorld(!0),n.updateMatrixWorld(),this[Vp._updateModelBoundingBox]()}this[Vp._render]()}},_Viewer.prototype.getTransformationMatrixByPsId=function(e){r.b._isString(e,!0),Bp("getTransformationMatrixByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getTransformationMatrixByPsId);var t=b.getObjectByPsId(e,!0);if(t)return(new _.Matrix4).copy(t.matrix).elements;Dp("getTransformationMatrixByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_getTransformationMatrixByPsId)},_Viewer.prototype.getWorldMatrixByPsId=function(e){r.b._isString(e,!0),Bp("getWorldMatrixByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getWorldMatrixByPsId);var t=b.getObjectByPsId(e,!0);return t&&t.matrixWorld?t.matrixWorld.elements.slice(0):t instanceof ze.Vertex&&t.parent&&t.parent.matrixWorld?t.parent.matrixWorld.elements.slice(0):void Dp("getWorldMatrixByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getWorldMatrixByPsId)},_Viewer.prototype.getBoundingBoxByPsId=function(e){r.b._isString(e,!0);var t=b.getObjectByPsId(e,!0),n=null;return t&&t.boundingBox&&((n={}).min=t.boundingBox.min.toArray(),n.max=t.boundingBox.max.toArray()),n},_Viewer.prototype.getBoundingBoxCenterByPsId=function(e){r.b._isString(e,!0),Bp("getBoundingBoxCenterByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getBoundingBoxCenterByPsId);var t=b.getObjectByPsId(e,!0),n=new _.Vector3;if(t&&t.boundingBox)return t.boundingBox.getCenter(n),n.applyMatrix4(t.matrixWorld),n.toArray();Dp("getBoundingBoxCenterByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_getBoundingBoxCenterByPsId)},_Viewer.prototype.getVisibleModelBoundingBoxCenter=function(){Bp("getVisibleModelBoundingBoxCenter",i.b.stringsByLabel.VIEWER_LOGGER_getVisibleModelBoundingBoxCenter);var e=c.visibleModelBoundingBox,t=new _.Vector3;return e.isEmpty()&&(e=c.modelBoundingBox),e.isEmpty()?(Dp("getVisibleModelBoundingBoxCenter",i.b.stringsByLabel.VIEWER_LOGGER_warn_getVisibleModelBoundingBoxCenter),[0,0,0]):(e.getCenter(t),Dp("getVisibleModelBoundingBoxCenter",i.b.stringsByLabel.VIEWER_LOGGER_finest_getVisibleModelBoundingBoxCenter+t.toArray()),t.toArray())},_Viewer.prototype.getVisibleModelBoundingBoxLength=function(){Bp("getVisibleModelBoundingBoxLength",i.b.stringsByLabel.VIEWER_LOGGER_getVisibleModelBoundingBoxLength);var e=c.visibleModelBoundingBox;if(e.isEmpty()&&(e=c.modelBoundingBox),e.isEmpty())return Dp("getVisibleModelBoundingBoxLength",i.b.stringsByLabel.VIEWER_LOGGER_warn_getVisibleModelBoundingBoxLength),null;var t=e.max.distanceTo(e.min);return Dp("getVisibleModelBoundingBoxLength",i.b.stringsByLabel.VIEWER_LOGGER_finest_getVisibleModelBoundingBoxLength+t),t},_Viewer.prototype.setCameraOrientationFromPLMXML=function(e,t,n){r.b._isString(e,!0),r.b._isString(t,!0),r.b._optionalArgCheck(n,r.b._isFunction),Bp("setCameraOrientationFromPLMXML",i.b.stringsByLabel.VIEWER_LOGGER_setEdgesVisibilityByPsId),n=n||function(){};var a=new XMLHttpRequest,o=b.getObjectByPsId(t);if(o){var s=function _getScalingFactor(e){var t=1;switch(e){case m.E.MICROMETER:t=1e6;break;case m.E.MILLIMETER:t=1e3;break;case m.E.CENTIMETER:t=100;break;case m.E.DECIMETER:t=10;break;case m.E.METER:t=1;break;case m.E.KILOMETER:t=.001;break;case m.E.INCH:t=39.3701;break;case m.E.FEET:t=3.28084;break;case m.E.YARD:t=1.09361;break;case m.E.MILE:t=621371e-9;break;case m.E.MIL:t=39370.078;break;default:t=1}return t}(o.unit);a.onload=function(){var e;if(null!==a.responseXML?e=a.responseXML:null!==a.response&&void 0!==a.response&&a.response.length>0&&(e=(new window.DOMParser).parseFromString(a.response,"text/xml")),null===e||void 0===e||200!==a.status&&0!==a.status)Dp("setCameraOrientationFromPLMXML",i.b.stringsByLabel.VIEWER_LOGGER_warn2_setCameraOrientationFromPLMXML),Gp(i.b.stringsByLabel.GENERAL_CONSOLE_warn_FailedResponse),n(!1);else{for(var t=e.getElementsByTagName("ViewFrom")[0].childNodes[0].nodeValue.split(" "),r=e.getElementsByTagName("ViewTo")[0].childNodes[0].nodeValue.split(" "),o=e.getElementsByTagName("ViewVertical")[0].childNodes[0].nodeValue.split(" "),l=0,c=t.length;l<c;++l)t[l]=parseFloat(t[l])*s,r[l]=parseFloat(r[l])*s,o[l]=parseFloat(o[l]);var u=new _.Vector3(0,1,0),h=new _.Vector3(o[0],o[1],o[2]),d={pos:t,tgt:r,rot:(new _.Quaternion).setFromUnitVectors(u,h).toArray()};this.setCameraOrientationInfo(d),v.update(),this.getAutoDraw()&&this[Vp._render](),n(!0)}}.bind(this),a.onerror=function(){Dp("setCameraOrientationFromPLMXML",i.b.stringsByLabel.VIEWER_LOGGER_warn3_setCameraOrientationFromPLMXML+e),Rp(i.b.stringsByLabel.GENERAL_CONSOLE_err_FailedToRetrieve+e),n(!1)},a.open("GET",e),a.send(),Dp("setCameraOrientationFromPLMXML",i.b.stringsByLabel.VIEWER_LOGGER_finest_setCameraOrientationFromPLMXML)}},_Viewer.prototype.setCameraToStandardView=function(e,t,n){if(r.b._isNumber(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean),r.b._optionalArgCheck(n,r.b._isBoolean),r.b._isBoolean(t)||(t=!0),r.b._isBoolean(n)||(n=!0),!Te){Bp("setCameraToStandardView",i.b.stringsByLabel.VIEWER_LOGGER_setCameraToStandardView);var a=this.getCameraOrientationInfo(),o=this.getCameraOrientationInfo();o.rot=[0,0,0,1];var s=x.Easing.Linear.None;switch(e){case m.C.X:o.pos=[-1,0,0],o.rot=[1,0,0,1],s=x.Easing.Linear.None;break;case m.C.NEGATIVE_X:o.pos=[1,0,0],o.rot=[1,0,0,1],s=x.Easing.Linear.None;break;case m.C.Y:o.pos=[0,-1,0],s=x.Easing.Cubic.Out;break;case m.C.NEGATIVE_Y:o.pos=[0,1,0],o.rot=[1,0,0,1],s=x.Easing.Cubic.Out;break;case m.C.Z:o.pos=[0,0,-1],s=x.Easing.Cubic.In;break;case m.C.NEGATIVE_Z:o.pos=[0,0,1],s=x.Easing.Cubic.In;break;case m.C.ISOMETRIC:o.pos=[-1,-1,1],o.rot=[1,0,0,1],s=x.Easing.Cubic.In;break;case m.C.ISOMETRIC_2:o.pos=[1,-1,1],o.rot=[1,0,0,1],s=x.Easing.Cubic.In;break;case m.C.ISOMETRIC_3:o.pos=[1,1,1],o.rot=[1,0,0,1],s=x.Easing.Cubic.In;break;case m.C.ISOMETRIC_4:o.pos=[-1,1,1],o.rot=[1,0,0,1],s=x.Easing.Cubic.In;break;case m.C.NEGATIVE_ISOMETRIC:o.pos=[1,1,1],o.rot=[-1,0,0,1],s=x.Easing.Cubic.In;break;case m.C.TRIMETRIC:o.pos=[.71887306,-.58504861,.37541923],o.rot=[.50468495,.23996553,.35609957,.74893438],s=x.Easing.Cubic.InOut}o.tgt=[0,0,0];var l=!1;ie&&(l=!0,this.setAutoDraw(!1)),this.setCameraOrientationInfo(o);var c=new _.Box3;if(_getModelBoundingBox(c,b,!1),c.isEmpty()?this.fitToModel():this.fitToVisible(),c=null,o=this.getCameraOrientationInfo(),this.setCameraOrientationInfo(a),l&&this.setAutoDraw(!0),ie&&t){var u=(new _.Vector3).fromArray(o.pos),h=(new _.Quaternion).fromArray(o.rot),d=new _.Vector3(0,1,0).applyQuaternion(h),p=(new _.Vector3).fromArray(o.tgt);startTween.call(this,u,p,d,s)}else this.setCameraOrientationInfo(o);n&&_Viewer.prototype[Vp._render]()}},_Viewer.prototype.setCameraPosition=function(e,t){if(r.b._isArray(e,!0,r.b._isNumber),r.b._optionalArgCheck(t,r.b._isBoolean),r.b._isNullOrUndefined(t)&&(t=!0),!Te&&Array.isArray(e)&&3===e.length){Bp("setCameraPosition",i.b.stringsByLabel.VIEWER_LOGGER_setCameraToStandardView);var n=this.getCameraOrientationInfo();if(n.pos===e)return;var a=this.getCameraOrientationInfo();n.rot=[0,0,0,1];var o=x.Easing.Linear.None;n.pos=e,n.tgt=[0,0,0];var s=!1;ie&&(s=!0,this.setAutoDraw(!1)),this.setCameraOrientationInfo(n);var l=new _.Box3;if(_getModelBoundingBox(l,b,!1),l.isEmpty()?this.fitToModel():this.fitToVisible(),l=null,n=this.getCameraOrientationInfo(),this.setCameraOrientationInfo(a),s&&this.setAutoDraw(!0),ie&&t){var c=(new _.Vector3).fromArray(n.pos),u=(new _.Quaternion).fromArray(n.rot),h=new _.Vector3(0,1,0).applyQuaternion(u),d=(new _.Vector3).fromArray(n.tgt);startTween.call(this,c,d,h,o)}else this.setCameraOrientationInfo(n);_Viewer.prototype[Vp._render]()}},_Viewer.prototype.getTextureTransparencyDefault=function(){return Bp("getTextureTransparencyDefault",i.b.stringsByLabel.VIEWER_LOGGER_getTextureTransparencyDefault),Q},_Viewer.prototype.setTextureTransparencyDefault=function(e){r.b._isBoolean(e,!0),Bp("setTextureTransparencyDefault",i.b.stringsByLabel.VIEWER_LOGGER_setTextureTransparencyDefault),Q=void 0!==e&&e},_Viewer.prototype.getObjectTypeByPsId=function(e){r.b._isString(e,!0),Bp("getObjectTypeByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getObjectTypeByPsId);var t=b.getObjectByPsId(e,!0);if(void 0!==t&&null!==t)switch(t.type){case"Part":return"Part";case"Body":return"Body";case"FaceShape":return"Face";case"EdgeShape":case"Edge":return"Edge";case"SectionEdgeShape":return"Section Edge";case"Vertex":case"VertexShape":return"Vertex";case"Assembly":return"Assembly";case"Instance":return"Instance";case"PointShape":return"Point";case"Container":return"Container";default:Gp("Encountered unknown object with psId "+e+".")}return""},_Viewer.prototype.setFaceWireframeVisibilityByPsId=function(e,t,n){r.b._isString(e,!0),r.b._isBoolean(t,!0),r.b._optionalArgCheck(n,r.b._isNumber),Bp("setFaceWireframeVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_setFaceWireframeVisibilityByPsId),n=r.b._isNumber(n)?n:0;var a=!1,o=b.getObjectByPsId(e);return o&&o instanceof _.Object3D&&o.traverse(function(e){e instanceof ce&&!e.isAssembly?c.setWireframes(e,t,n)&&(a=!0):o.wireframeVisible=t}),a&&this[Vp._render](),a},_Viewer.prototype.getFaceWireframeVisibilityByPsId=function(e){r.b._isString(e,!0),Bp("getFaceWireframeVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getFaceWireframeVisibilityByPsId);var t=b.getObjectByPsId(e);return!(!t||!0!==t.wireframeVisible)||(Dp("getFaceWireframeVisibilityByPsId",i.b.stringsByLabel.VIEWER_LOGGER_warn_getFaceWireframeVisibilityByPsId),!1)},_Viewer.prototype.getVerticesByPsId=function(e){r.b._isString(e,!0),Bp("getVerticesByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getVerticesByPsId+e);var t=b.getObjectByPsId(e);if(t){if("Part"!==t.type&&"Body"!==t.type||!r.b._notNullOrUndefined(t.vertices)){if("Vertex"!==t.type)return null;t=t.parent}else t=t.vertices;if("VertexShape"===t.type){for(var n={},a=0,o=t.vertices.length;a<o;a++)n[a]=[t.vertices[a].position.x,t.vertices[a].position.y,t.vertices[a].position.z];return n}}},_Viewer.prototype.getVertexByPsId=function(e){r.b._isString(e,!0),Bp("getVertexByPsId",i.b.stringsByLabel.VIEWER_LOGGER_getVertexByPsId+e);var t=b.getObjectByPsId(e);if("Vertex"===t.type)return[t.position.x,t.position.y,t.position.z]},_Viewer.prototype.getVertexIdsById=function(e){r.b._isString(e,!0),Bp("getVertexIdsById",i.b.stringsByLabel.VIEWER_LOGGER_getVertexIdsById+e);var t=b.getObjectByPsId(e),n=[];if(r.b._notNullOrUndefined(t)&&("Part"!==t.type&&"Body"!==t.type||!r.b._notNullOrUndefined(t.vertices)?"Edge"===t.type||"FaceShape"===t.type?t.vertices.forEach(function(e){n.push(t.parent.parent.userData.psId+"|"+t.parent.parent.vertices.userData.psId+"|"+e.index)}):"Vertex"===t.type&&n.push(e):t.vertices.vertices.forEach(function(e){n.push(t.vertices.userData.psId+"|"+e.index)}),r.b._notNullOrUndefined(t.children)&&t.children.length>0))for(var a=0;a<t.children.length;a++)Array.prototype.push.apply(n,this.getVertexIdsById(t.children[a].userData.psId));return n.length>0?n:null},_Viewer.prototype.getEdgeIdsById=function(e){r.b._isString(e,!0),Bp("getEdgeIdsById",i.b.stringsByLabel.VIEWER_LOGGER_getEdgeIdsById+e);var t=b.getObjectByPsId(e),n=[];if(r.b._notNullOrUndefined(t)){if("Part"!==t.type&&"Body"!==t.type||!r.b._notNullOrUndefined(t.edges))"FaceShape"===t.type?t.edges.forEach(function(e){n.push(e.userData.psId)}):"Edge"===t.type&&n.push(e);else for(var a in t.edges)t.edges[a]&&n.push(t.edges[a].userData.psId);if(r.b._notNullOrUndefined(t.children)&&t.children.length>0)for(var o=0;o<t.children.length;o++)Array.prototype.push.apply(n,this.getEdgeIdsById(t.children[o].userData.psId))}return n.length>0?n:null},_Viewer.prototype.getFaceIdsById=function(e){r.b._isString(e,!0),Bp("getFaceIdsById",i.b.stringsByLabel.VIEWER_LOGGER_getFaceIdsById+e);var t=b.getObjectByPsId(e),n=[];if(r.b._notNullOrUndefined(t)){if("Part"!==t.type&&"Body"!==t.type||!r.b._notNullOrUndefined(t.faces))"Edge"===t.type?t.faces.forEach(function(e){n.push(e.userData.psId)}):"FaceShape"===t.type&&n.push(e);else for(var a in t.faces)t.faces[a]&&n.push(t.faces[a].userData.psId);if(r.b._notNullOrUndefined(t.children)&&t.children.length>0)for(var o=0;o<t.children.length;o++)Array.prototype.push.apply(n,this.getFaceIdsById(t.children[o].userData.psId))}return n.length>0?n:null},_Viewer.prototype.getBodyIdsById=function(e){r.b._isString(e,!0),Bp("getBodyIdsById",i.b.stringsByLabel.VIEWER_LOGGER_getBodyIdsById+e);var t=b.getObjectByPsId(e),n=[];if(r.b._notNullOrUndefined(t)&&("Edge"!==t.type&&"FaceShape"!==t.type&&"VertexShape"!==t.type||!r.b._notNullOrUndefined(t.bodies)?"Body"===t.type&&n.push(e):n.push(t.parent.parent.userData.psId),r.b._notNullOrUndefined(t.children)&&t.children.length>0))for(var a=0;a<t.children.length;a++)Array.prototype.push.apply(n,this.getBodyIdsById(t.children[a].userData.psId));return n.length>0?n:null},_Viewer.prototype.setEventPriority=function(e,t,n){r.b._isObject(e,!0),r.b._isString(t,!0),r.b._isNumber(n,!0),Bp("setEventPriority",i.b.stringsByLabel.VIEWER_LOGGER_setEventPriority+e.component+", "+t+", "+n),e.component===m.h.Viewer?function _setEventPriority(e,t){Ve&&(e===$n.EventTypes.Down?(Ne[$n.EventTypes.Down]=t,Ve.updateEventListener($n.EventTypes.Down,K,t)):e===$n.EventTypes.Move?(Ne[$n.EventTypes.Move]=t,Ve.updateEventListener($n.EventTypes.Move,ee,t)):e===$n.EventTypes.Up?(Ne[$n.EventTypes.Up]=t,Ve.updateEventListener($n.EventTypes.Up,$,t)):e===$n.EventTypes.Scroll&&(Ne[$n.EventTypes.Scroll]=t,Ve.updateEventListener($n.EventTypes.Scroll,renderLoopControlMouseWheel.bind(this),t)))}(t,n):e.component===m.h.Navigation?v.setEventPriority(t,n,e.name):e.component===m.h.AreaSelect&&Re.setEventPriority(t,n)},_Viewer.prototype.getEventPriority=function(e,t){r.b._isObject(e,!0),r.b._isString(t,!0),Bp("getEventPriority",i.b.stringsByLabel.VIEWER_LOGGER_getEventPriority+e.component+", "+t);var n=void 0;return e.component===m.h.Viewer?n=function _getEventPriority(e){var t=void 0;e===$n.EventTypes.Down?t=Ne[$n.EventTypes.Down]:e===$n.EventTypes.Move?t=Ne[$n.EventTypes.Move]:e===$n.EventTypes.Up?t=Ne[$n.EventTypes.Up]:e===$n.EventTypes.Scroll&&(t=Ne[$n.EventTypes.Scroll]);return t}(t):e.component===m.h.Navigation?n=v.getEventPriority(t,e.name):e.component===m.h.AreaSelect&&(n=Re.getEventPriority(t)),n},_Viewer.prototype.setMouseEasing=function(e){r.b._isNumber(e,!0),Bp("setMouseEasing",i.b.stringsByLabel.VIEWER_LOGGER_setMouseEasing+e),r.b._isFunction(v.setMouseEasing)&&(e>=0&&e<=1?v.setMouseEasing(e):Bp("setMouseEasing",i.b.stringsByLabel.VIEWER_LOGGER_err_setMouseEasing))},_Viewer.prototype.getMouseEasing=function(){var e=void 0;return r.b._isFunction(v.getMouseEasing)&&(e=v.getMouseEasing()),Bp("getMouseEasing",i.b.stringsByLabel.VIEWER_LOGGER_getMouseEasing+e),e},_Viewer.prototype[Vp._clearSectionShapes]=function(e){c.clearSectionShapes(e)},_Viewer.prototype[Vp._setHashBothSectionSide]=function(e){c.hasBothSectionSide=e},_Viewer.prototype[Vp._addSectionEdges]=function(e,t,n,r,i,a){c.addSectionEdges(e,t,n,r,i,a)},_Viewer.prototype[Vp._addSectionCaps]=function(e,t,n,r,i,a){c.addSectionCaps(e,t,n,r,i,a)},_Viewer.prototype.zoomArea=function(e,t,n,i){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(i,!0);var a=null;a=u===m.c.PERSPECTIVE?p:f;var o=s.domElement.width,l=s.domElement.height,c=o/(n-e),h=this.getCameraOrientationInfo(),d=new _.Vector3(h.pos[0]-h.tgt[0],h.pos[1]-h.tgt[1],h.pos[2]-h.tgt[2]),g=new _.Plane(new _.Vector3(d.x/d.length(),d.y/d.length(),d.z/d.length())),v=new _.Vector3(h.pos[0],h.pos[1],h.pos[2]),y=new _.Vector3,b=new _.Vector3;_getPlaneCoordinateAtViewPort(y,e,t,o,l,v,a,g),_getPlaneCoordinateAtViewPort(b,n,i,o,l,v,a,g);var x=[(y.x+b.x)/2,(y.y+b.y)/2,(y.z+b.z)/2],w=new _.Vector3(d.x/c,d.y/c,d.z/c),M=[x[0]+w.x,x[1]+w.y,x[2]+w.z];this.setCameraOrientationInfo({pos:M,rot:h.rot,tgt:x})},_Viewer.prototype.replaceMaterialByPsId=function(e,t,n){if(r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isObject),r.b._notNullOrUndefined(n)&&!r.b._isString(n)&&!r.b._isObject(n))throw new TypeError("Expecting a string or an object value.");t=t||{};var a=b.getObjectByPsId(e,!0);if(a instanceof ze.Part&&r.b._notNullOrUndefined(a.shapes))for(var o=0;o<a.shapes.length;o++){var s=a.shapes[o];if(s instanceof ze.PartShape){a=s.faces[0];break}}if(a instanceof ze.FaceShape){var l=a.materialIndex,c=a.parent.material[l];if(r.b._notNullOrUndefined(t.diffuse)&&c.uniforms.diffuse.value.setHex(t.diffuse),r.b._notNullOrUndefined(t.emissive)&&c.uniforms.emissive.value.setHex(t.emissive),r.b._notNullOrUndefined(t.specular)&&c.uniforms.specular.value.setHex(t.specular),r.b._notNullOrUndefined(t.shininess)&&(c.uniforms.shininess.value=t.shininess),r.b._notNullOrUndefined(t.opacity)&&(c.uniforms.opacity.value=t.opacity,c.uniforms.opacity.value=r.b._getValidOpacity(c.uniforms.opacity.value),c.transparent=!!(t.opacity&&t.opacity<1)),r.b._notNullOrUndefined(a.parent.geometry.attributes.uv))if(r.b._isString(n)){var u=(new _.TextureLoader).load(n,function(){this[Vp._render]()}.bind(this));c.uniforms.map.value=u}else if(n instanceof Object&&n.colors instanceof Uint8Array){if(n.height=n.height||1,n.colors.length!==n.width*n.height*3)return void Rp(i.b.stringsByLabel.VIEWER_LOGGER_replaceMaterialByPsId);r.b._isNullOrUndefined(c.uniforms.map.value.image.data)?((u=new _.DataTexture(n.colors,n.width,n.height,_.RGBFormat)).needsUpdate=!0,c.uniforms.map.value=u):(c.uniforms.map.value.image.data=n.colors,c.uniforms.map.value.image.width=n.width,c.uniforms.map.value.image.height=n.height,(u=c.uniforms.map.value).needsUpdate=!0)}a.parent.material[l]=c,a.parent.original.needsUpdate=!0,this[Vp._render]()}},_Viewer.prototype.getAncestryByPsId=function(e,t){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean),r.b._isBoolean(t)||(t=!0);var n,i,a=[];if(xt&&this.isExtensionLoaded(xt)){var o=this.getExtensionManager(xt);o&&(n=o[bt._getAncestryByPsId](e,a))}for(i=n||b.getObjectByPsId(e,!0);r.b._notNullOrUndefined(i.userData.psId)&&"-1"!==i.userData.psId&&"-3"!==i.userData.psId;){var s={};s.psId=i.userData.psId,s.type=i.type.replace("Shape",""),r.b._notNullOrUndefined(i.original)&&r.b._notNullOrUndefined(i.original.protoId)&&(s.protoId=i.original.protoId),i instanceof Xn?s.id=i.xtBody.bodyId:i instanceof ze.FaceShape?s.id=i.face?i.face.faceId:i.index:i instanceof ze.EdgeShape?s.id=i.edge.edgeId:i instanceof ze.Edge?s=null:r.b._notNullOrUndefined(i.psId)&&(s.id=i.psId),s&&a.push(s),!t&&(i instanceof ze.Edge||i instanceof ze.Vertex)&&(i=i.parent),(i=i.parent)instanceof ze.PartShape&&(i=i.parent),!t&&i instanceof Xn&&(i=i.parent)}return a},_Viewer.prototype.updateGeometryAttributeByPsId=function(e,t){t=t||{};var n=b.getObjectByPsId(e,!0);if((n instanceof Xn||n instanceof ze.Part)&&r.b._notNullOrUndefined(n.shapes)){for(var i={},a=0;a<n.shapes.length;a++){var o=n.shapes[a];o instanceof ze.PartShape&&Object.assign(i,o.geometry.attributes)}r.b._notNullOrUndefined(t.uv)&&r.b._notNullOrUndefined(i.uv)&&t.uv.constructor.name===i.uv.array.constructor.name&&t.uv.length===i.uv.array.length&&(i.uv.array=t.uv,i.uv.needsUpdate=!0),r.b._notNullOrUndefined(t.position)&&r.b._notNullOrUndefined(i.position)&&t.position.constructor.name===i.position.array.constructor.name&&t.position.length===i.position.array.length&&(i.position.array=t.position,i.position.needsUpdate=!0),r.b._notNullOrUndefined(t.normal)&&r.b._notNullOrUndefined(i.normal)&&t.normal.constructor.name===i.normal.array.constructor.name&&t.normal.length===i.normal.array.length&&(i.normal.array=t.normal,i.normal.needsUpdate=!0),r.b._notNullOrUndefined(t.color)&&r.b._notNullOrUndefined(i.color)&&t.color.constructor.name===i.color.array.constructor.name&&t.color.length===i.color.array.length&&(i.color.array=t.color,i.color.needsUpdate=!0),this[Vp._render]()}},_Viewer.prototype.addOnTopEdges=function(e,t={color:16711935,showSilhouettes:!1}){r.b._isArray(e,!0,r.b._IsString),r.b._notNullOrUndefined(t,!0);let n={color:16711935,showSilhouettes:!1};r.b._isObject(t)?(r.b._optionalArgCheck(t,r.b._isObject),r.b._optionalArgCheck(t.color,r.b._isNumber),r.b._optionalArgCheck(t.showSilhouettes,r.b._isBoolean),n.color=r.b._isNumber(t.color)?t.color:16711935,n.showSilhouettes=!!r.b._isBoolean(t.showSilhouettes)&&t.showSilhouettes):(r.b._optionalArgCheck(t,r.b._isNumber),n.color=t),Re.addOnTopEdges(e,n),this[Vp._render](!0,!1)},_Viewer.prototype.removeOnTopEdges=function(e){r.b._isNullOrUndefined(e)?Re.clearOnTopEdges():(r.b._isArray(e,!0,r.b._IsString),Re.removeOnTopEdges(e)),this[Vp._render](!0,!1)},new _Viewer(e)};Np.prototype={constructor:Np,_name:"Viewer"};
// EXTERNAL MODULE: ./node_modules/resize-observer-polyfill/dist/ResizeObserver.es.js
var Up=n(13),Fp=o()("PLMVisWeb:debug:Control"),zp=o()("PLMVisWeb:error:Control");
// CONCATENATED MODULE: ./staging/Control.js
zp.enabled=!0;o()("PLMVisWeb:warning:Control");var kp=window.ResizeObserver||Up.a,jp=0,Hp=function(e){if(Fp("Control"),!r.b._checkLicense())return zp(i.b.stringsByLabel.CONTROL_LOGGER_License),{};var t,n=null,a=null,o=function(e){if(t){var n=e[0].contentRect;t[Vp._setSize](n.width,n.height)}},s=function(e){var s,l;Fp("_Control",i.b.stringsByLabel.CONTROL_LOGGER_Constructor),(e=e||{}).host?(a=e.host).children&&a.children.length>0&&zp(i.b.stringsByLabel.CONTROL_LOGGER_Constructor2):((a=document.createElement("div")).id="ControlHost_"+jp,a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.margin="0",a.style.padding="0",a.style.width="100%",a.style.height="100%",a.style.overflow="hidden",a.style.zIndex=1,document.body.appendChild(a),s=parseInt(e.width),l=parseInt(e.height),s&&(a.style.width=s+"px"),l&&(a.style.height=l+"px"),s=s||a.offsetWidth||a.clientWidth||a.scrollWidth,l=l||a.offsetHeight||a.clientHieght||a.scrollHeight,s||(s=800,a.style.width=s+"px"),l||(l=400,a.style.height=l+"px")),s=s||parseInt(e.width)||a.offsetWidth||a.clientWidth||a.scrollWidth,l=l||parseInt(e.height)||a.offsetHeight||a.clientHieght||a.scrollHeight,(n=document.createElement("div")).id="Control_"+jp,n.style.position="relative",n.style.top="0",n.style.left="0",n.style.overflow="hidden",n.style.width="100%",n.style.height="100%",n.style.margin="0",n.style.padding="0",a.appendChild(n),o=o.bind(this),new kp(o).observe(n);var c={antialias:!r.b._isBoolean(e.antialias)||e.antialias,alpha:!r.b._isBoolean(e.alpha)||e.alpha,preserveDrawingBuffer:!r.b._isBoolean(e.preserveDrawingBuffer)||e.preserveDrawingBuffer,width:s,height:l,standardView:r.b._isNumber(e.standardView)?e.standardView:m.C.NEGATIVE_Z,domElement:n,useGpuInstancing:!r.b._isBoolean(e.useGpuInstancing)||e.useGpuInstancing,webworkerCount:r.b._isNumber(e.webworkerCount)?e.webworkerCount:4};e.jt2go&&(c.alpha=!1),e.customLoader&&(c.customLoader=e.customLoader),void 0!==e.networkManager&&(c.networkManager=e.networkManager),void 0!==e.inputManager&&(c.inputManager=e.inputManager),Fp("Control: creating viewer with args:",c),t=new Np(c),Fp("Control: created viewer:",t),jp++};return s.prototype.getExtensionManager=function(e){if(zp("Control.getExtensionManager is deprecated.  Please use Control.viewer instead!"),e===Np)return t},Fp("_apply",s),Object.defineProperties(s.prototype,{viewer:{enumerable:!0,get:function(){return t}}}),s.prototype.dispose=function(){a&&n&&(a.removeChild(n),n=null,a=null,t=null),jp--},s.prototype.setSize=function(e,o){r.b._isNumber(e,!0),r.b._isNumber(o,!0),Fp("setSize",i.b.stringsByLabel.CONTROL_LOGGER_setSize),e=parseInt(e),o=parseInt(o);var s=e.toString()+"px",l=o.toString()+"px";a.style.width=s,a.style.height=l,n.style.width=s,n.style.height=l,t[Vp._setSize](e,o)},s.prototype.getSize=function(){Fp("getSize",i.b.stringsByLabel.CONTROL_LOGGER_getSize);var e=n||a;return{height:e?e.clientHeight:-1,width:e?e.clientWidth:-1}},new s(e)};Hp.prototype={constructor:Hp};/* harmony default export */var Wp=Hp,Xp=o()("PLMVisWeb:debug:AugmentedReality");
// CONCATENATED MODULE: ./staging/AugmentedReality.js
o()("PLMVisWeb:error:AugmentedReality").enabled=!0;var qp=function(e){var t,n,a,o,s,l,c,u,h,d,p,f,g,v,y,b,x,w,M,E,S,L,T,A;function _AugmentedReality(e){t=e._parent,n=1,a=!1}function initializeAR(){if(y=t._modelObject.getObjectByPsId(d),r.b._notNullOrUndefined(y)){switch(y.unit){case m.E.UNKNOWN:case m.E.MICROMETER:n=.001;break;case m.E.MILLIMETER:n=1;break;case m.E.CENTIMETER:n=10;break;case m.E.DECIMETER:n=100;break;case m.E.METER:n=1e3;break;case m.E.KILOMETER:n=1e6;break;case m.E.INCH:n=25.4;break;case m.E.FEET:n=304.8;break;case m.E.YARD:n=914.4;break;case m.E.MILE:n=1609e3;break;case m.E.MIL:n=.0254}t.scaleByPsId(d,n,n,n),w=t.getCameraOrientationInfo(),t.setCameraOrientationInfo({pos:[0,0,1],rot:[0,0,0,1],tgt:[0,0,0]}),t.setMouseNavigationEnabled(!1),A=1.2*t._pCamera.far,o.init(function onReady(){t.domElement.offsetParent.appendChild(o.domElement),t.domElement.offsetParent.style.background="transparent",t._renderer.domElement.style.zIndex="1",o.domElement.style.zIndex="2",x?(o.domElement.style.width=t._renderer.domElement.width+"px",o.domElement.style.height=t._renderer.domElement.height+"px"):o.onResizeElement(),a=!0,t.startRenderLoop()}),(s=new M.Context({cameraParametersUrl:v,detectionMode:"mono"})).init(function onCompleted(){s.arController.addEventListener("getMarker",function(e){c=e})}),(u=new _.Group).name="arMarker";new M.MarkerControls(s,u,{type:"pattern",patternUrl:h,smooth:E,smoothCount:S,smoothTolerance:L,smoothThreshold:T});b=(new _.Matrix4).makeScale(1/p,1/p,1/p),y.applyMatrix(b),u.add(y),t._modelObject.remove(y),g=y.matrix.clone(),t._modelObject.add(u)}}function _markerCheck(e){l!==e&&(l=e)}function gotDevices(e){for(var t=0;t!==e.length;++t){var n=e[t],r=document.createElement("option");r.value=n.deviceId,"videoinput"===n.kind?(r.text=n.label||"camera "+(f.length+1),f.appendChild(r)):console.log("Found one other kind of source/device: ",n)}}function getStream(){window.stream&&window.stream.getTracks().forEach(function(e){e.stop()});var e={video:{deviceId:{exact:f.value}}};navigator.mediaDevices.getUserMedia(e).then(gotStream).catch(handleError)}function gotStream(e){window.stream=e,o.domElement.srcObject=e}return _AugmentedReality.prototype={constructor:_AugmentedReality},_AugmentedReality.prototype.startAR=function(e,t){if(r.b._isString(e,!0),r.b._isObject(t,!0),r.b._isObject(t.ARjs,!0),r.b._isString(t.camParamURL,!0),r.b._optionalArgCheck(t.markerSize,r.b._isNumber),r.b._optionalArgCheck(t.pattURL,r.b._isString),r.b._optionalArgCheck(t.imageURL,r.b._isString),r.b._optionalArgCheck(t.imageSourceURL,r.b._isString),r.b._optionalArgCheck(t.smooth,r.b._isBoolean),r.b._optionalArgCheck(t.smoothCount,r.b._isNumber),r.b._optionalArgCheck(t.smoothTolerance,r.b._isNumber),r.b._optionalArgCheck(t.smoothThreshold,r.b._isNumber),E=!r.b._isBoolean(E)||E,S=r.b._isNumber(S)?S:5,L=r.b._isNumber(L)?L:.01,T=r.b._isNumber(T)?T:2,M=t.ARjs,!r.b._isFunction(M.Source)||!r.b._isFunction(M.Context)||!r.b._isFunction(M.MarkerControls))throw new Error("BAD param.ARjs object detected!");d=e,v=t.camParamURL,r.b._isNumber(t.markerSize)&&(p=t.markerSize),r.b._isString(t.imageSourceURL)?(o=new M.Source({sourceType:"image",sourceUrl:t.imageSourceURL}),x=!0):o=new M.Source({sourceType:"webcam"}),r.b._isString(t.pattURL)?(h=t.pattURL,initializeAR()):r.b._isString(t.imageURL)&&function encodeImageURL(e,t){var n=new Image;n.onload=function(){var e=function encodeImage(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=16,t.height=16;for(var r="",i=0;i>-2*Math.PI;i-=Math.PI/2){n.save(),n.clearRect(0,0,t.width,t.height),n.translate(t.width/2,t.height/2),n.rotate(i),n.drawImage(e,-t.width/2,-t.height/2,t.width,t.height),n.restore();var a=n.getImageData(0,0,t.width,t.height);0!==i&&(r+="\n");for(var o=2;o>=0;o--)for(var s=0;s<a.height;s++){for(var l=0;l<a.width;l++){0!==l&&(r+=" ");var c=s*a.width*4+4*l+o,u=a.data[c];r+=String(u).padStart(3)}r+="\n"}}return r}(n);t(e)},n.src=e}(t.imageURL,function onComplete(e){var t=window.URL.createObjectURL(new Blob([e],{type:"text/plain"}));h=t,initializeAR()})},_AugmentedReality.prototype.isARLoaded=function(){return a},_AugmentedReality.prototype.overrideRender=function(){return a&&this._render(),a},_AugmentedReality.prototype._render=function(){!1!==o.ready&&(s.update(o.domElement),null!==c&&(1===c.data.type&&_markerCheck(!1),0===c.data.type&&(t._renderer.domElement.style.zIndex="2",o.domElement.style.zIndex="1",_markerCheck(!0)),c=null),u.updateMatrix(),u.updateMatrixWorld(!0),t._scene.updateLights(t._pCamera),t._renderer.setViewport(0,0,t._renderer.domElement.width,t._renderer.domElement.height),t._pCamera.far=A,t._pCamera.updateProjectionMatrix(),t._renderer.clear(),t._renderer.render(t._scene,t._pCamera))},_AugmentedReality.prototype.stopAR=function(){if(a){a=!1,t.stopRenderLoop();var e=t._modelObject.children[0].children[0];t._modelObject.children=[],t._modelObject.add(e),o.domElement.srcObject.getTracks().forEach(function(e){e.stop()}),o.domElement.srcObject=null,t.domElement.offsetParent.removeChild(o.domElement),o=null,s=null,y.applyMatrix(b.getInverse(y.matrix)),t.setCameraOrientationInfo(w),n=1,t[Vp._updateModelBoundingBox](),t.setMouseNavigationEnabled(!0)}},_AugmentedReality.prototype.switchCamera=function(e){r.b._isObject(e,!0),Xp("switchCamera",i.b.stringsByLabel.AUGMENTEDREALITY_LOGGER_switchCamera),f=e,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(navigator.mediaDevices.enumerateDevices().then(gotDevices).then(getStream),f.onchange=getStream):console.log("enumerateDevices() not supported.")},_AugmentedReality.prototype.resetMatrix=function(){y.matrix=g.clone()},_AugmentedReality.prototype.resizeARElement=function(){r.b._notNullOrUndefined(o)&&o.onResizeElement()},new _AugmentedReality(e)};qp.prototype={constructor:qp,_name:"AugmentedReality"};/* harmony default export */var Yp=qp,Zp=n(8),Jp=/* */n.n(Zp),Qp=o()("PLMVisWeb:debug:Markup"),Kp=o()("PLMVisWeb:error:Markup");
// EXTERNAL MODULE: ./FOSS/svg/SVG.js
Kp.enabled=!0;var $p=o()("PLMVisWeb:warning:Markup"),ef=o()("PLMVisWeb:verbose:Markup"),tf={selectColor:"#ff0000",editColor:"#00ff00",lineColor:"#000000",lineWidth:"4",lineOpacity:"1.0",freehandColor:"#000000",freehandWidth:"4",freehandOpacity:"1.0",fillColor:"none",fillOpacity:"0.0",edgeColor:"#000000",edgeWidth:"4",edgeOpacity:"1.0",fontColor:"#000000",fontName:"Calibri, sans-serif",fontSize:20},nf=function(e){var t=function(e){this.manager=e};return t.prototype.reset=function(){},t.prototype.draw=function(e,t,n,r){},t.prototype.add=function(e){return null},t.prototype.remove=function(e){},t.prototype.set=function(e,t){},t.prototype.setAttribute=function(e,t,n){},t.prototype.getAttribute=function(e,t){return null},new t(e)},rf=function(e){var t=new _.Vector2(0,0),n=new _.Vector2(0,0),r=!1,i=null,a=null,o="#000000",s=function(e){nf.call(this,e)};return(s.prototype=Object.create(nf.prototype)).constructor=rf,s.prototype.reset=function(){a&&("text"===a.tagName?a.setAttribute("fill",o):a.setAttribute("stroke",o),a.setAttribute("pointer-events","all"),a=null),i=null,t.x=0,t.y=0,n.x=0,n.x=0,o="#000000",r=!1},s.prototype.draw=function(e,s,l,c){var u=l.type;if("mousedown"===u)if(a&&this.reset(),t.x=l.layerX-e.offsetLeft,t.y=l.layerY-e.offsetTop,n.x=l.layerX-e.offsetLeft,n.y=l.layerY-e.offsetTop,r=!0,c)r=!0,c(l);else{var h=l.target;if(e.childNodes[0]!==h){if("tspan"===(i=h).nodeName){var d=i.parentNode;i=d}i.parentNode.appendChild(i),i.setAttribute("pointer-events","none"),"text"===i.tagName?(o=i.getAttribute("fill"),i.setAttribute("fill",tf.selectColor)):(o=i.getAttribute("stroke"),i.setAttribute("stroke",tf.selectColor));var p=i.getCTM();t.x=n.x-Number(p.e),t.y=n.y-Number(p.f),a=i,l.override=!0}}else if("mouseup"===u){if(r=!1,i){h=l.target;i.setAttribute("pointer-events","all"),i=null,l.override=!0}}else if("mousemove"===u)if(n.x=l.layerX-e.offsetLeft,n.y=l.layerY-e.offsetTop,c)r&&(r=!1,c(l));else if(i){if(r){var f=n.x-t.x,m=n.y-t.y;i.setAttribute("transform","translate("+f+","+m+")")}l.override=!0}},s.prototype.add=function(e){return null},s.prototype.remove=function(e){a&&(a.parentNode.removeChild(a),i=null,a=null,o="#000000")},s.prototype.set=function(e,t){"text"===(i=t).tagName?(o=i.getAttribute("fill"),i.setAttribute("fill",tf.selectColor)):(o=i.getAttribute("stroke"),i.setAttribute("stroke",tf.selectColor)),a=i},s.prototype.setAttribute=function(e,t,n){},s.prototype.getAttribute=function(e,t){return null},Object.defineProperties(s.prototype,{mode:{value:m.l.Select,writable:!1,configurable:!1},selectColor:{get:function(){return tf.selectColor},set:function(e){tf.selectColor=e}},editColor:{get:function(){return tf.editColor},set:function(e){tf.editColor=e}}}),new s(e)},af=function(e){var t=new _.Vector2(0,0),n=new _.Vector2(0,0),r=!1,i=null,a=function(e){nf.call(this,e)};return(a.prototype=Object.create(nf.prototype)).constructor=af,a.prototype.reset=function(){t.x=0,t.y=0,n.x=0,n.x=0,r=!1,i=null},a.prototype.draw=function(e,a,o,s){var l=o.type;if("mousedown"===l)t.x=o.layerX-e.offsetLeft,t.y=o.layerY-e.offsetTop,n.x=o.layerX-e.offsetLeft,n.y=o.layerY-e.offsetTop,r=!0,i=(new Jp.a.Line).stroke(tf.lineColor),a.node.appendChild(i.node);else if("mouseup"===l){if(r)if(t.equals(n))a.node.removeChild(i.node);else if(s){var c=i.node.getAttribute("id");this.reset(),s(c)}this.reset()}else"mousemove"===l&&r&&(n.x=o.layerX-e.offsetLeft,n.y=o.layerY-e.offsetTop,i.node.setAttribute("x1",t.x),i.node.setAttribute("x2",n.x),i.node.setAttribute("y1",t.y),i.node.setAttribute("y2",n.y),i.node.setAttribute("stroke",tf.lineColor),i.node.setAttribute("stroke-width",tf.lineWidth),i.node.setAttribute("stroke-opacity",tf.lineOpacity))},a.prototype.add=function(e){var r;return(i=(new Jp.a.Line).stroke(tf.lineColor)).node.setAttribute("x1",t.x),i.node.setAttribute("x2",n.x),i.node.setAttribute("y1",t.y),i.node.setAttribute("y2",n.y),i.node.setAttribute("stroke",tf.lineColor),i.node.setAttribute("stroke-width",tf.lineWidth),i.node.setAttribute("stroke-opacity",tf.lineOpacity),e.node.appendChild(i.node),r=i.node.getAttribute("id"),this.reset(),r},a.prototype.remove=function(e){},a.prototype.set=function(e,r){t=e[0],n=e[1]},a.prototype.setAttribute=function(e,t,n){switch(t){case m.m.LineColor:e.setAttribute("stroke",n);break;case m.m.LineWidth:e.setAttribute("stroke-width",n);break;case m.m.LineOpacity:e.setAttribute("stroke-opacity",n)}},a.prototype.getAttribute=function(e,t){var n=null;switch(t){case m.m.LineColor:n=e.getAttribute("stroke");break;case m.m.LineWidth:n=e.getAttribute("stroke-width");break;case m.m.LineOpacity:n=e.getAttribute("stroke-opacity")}return n},Object.defineProperties(a.prototype,{mode:{value:m.l.Line,writable:!1,configurable:!1},lineColor:{get:function(){return tf.lineColor},set:function(e){tf.lineColor=e}},lineWidth:{get:function(){return tf.lineWidth},set:function(e){tf.lineWidth=e}},lineOpacity:{get:function(){return tf.lineOpacity},set:function(e){tf.lineOpacity=e}}}),new a(e)},of=function(e){var t=new _.Vector2(0,0),n=new _.Vector2(0,0),r=null,i=!1,a=null,o=function(e){nf.call(this,e)};return(o.prototype=Object.create(nf.prototype)).constructor=of,o.prototype.reset=function(){t.x=0,t.y=0,n.x=0,n.x=0,r=null,i=!1,a=null},o.prototype.draw=function(e,o,s,l){var c=s.type;if("mousedown"===c)t.x=s.layerX-e.offsetLeft,t.y=s.layerY-e.offsetTop,n.x=s.layerX-e.offsetLeft,n.y=s.layerY-e.offsetTop,r=t.x.toString()+" "+t.y.toString(),i=!0,a=(new Jp.a.Polyline).stroke(tf.freehandColor).fill("none"),o.node.appendChild(a.node);else if("mouseup"===c){if(i&&r)if(l){var u=a.node.getAttribute("id");this.reset(),l(u)}else o.node.removeChild(a.node);this.reset()}else"mousemove"===c&&i&&(t.x=n.x,t.y=n.y,n.x=s.layerX-e.offsetLeft,n.y=s.layerY-e.offsetTop,r+=" "+n.x.toString()+" "+n.y.toString(),a.node.setAttribute("points",r),a.node.setAttribute("stroke-width",tf.freehandWidth),a.node.setAttribute("stroke-opacity",tf.freehandOpacity))},o.prototype.add=function(e){var t;return(a=(new Jp.a.Polyline).stroke(tf.freehandColor).fill("none")).node.setAttribute("points",r),a.node.setAttribute("stroke-width",tf.freehandWidth),a.node.setAttribute("stroke-opacity",tf.freehandOpacity),e.node.appendChild(a.node),t=a.node.getAttribute("id"),this.reset(),t},o.prototype.remove=function(e){},o.prototype.set=function(e,t){var n=new _.Vector2(0);n=e[0],r=n.x.toString()+" "+n.y.toString();for(var i=1;i<e.length;++i)n=e[i],r+=" "+n.x.toString()+" "+n.y.toString()},o.prototype.setAttribute=function(e,t,n){switch(t){case m.m.FreehandColor:e.setAttribute("stroke",n);break;case m.m.FreehandWidth:e.setAttribute("stroke-width",n);break;case m.m.FreehandOpacity:e.setAttribute("stroke-opacity",n)}},o.prototype.getAttribute=function(e,t){var n=null;switch(t){case m.m.FreehandColor:n=e.getAttribute("stroke");break;case m.m.FreehandWidth:n=e.getAttribute("stroke-width");break;case m.m.FreehandOpacity:n=e.getAttribute("stroke-opacity")}return n},Object.defineProperties(o.prototype,{mode:{value:m.l.Freehand,writable:!1,configurable:!1},freehandColor:{get:function(){return tf.freehandColor},set:function(e){tf.freehandColor=e}},freehandWidth:{get:function(){return tf.freehandWidth},set:function(e){tf.freehandWidth=e}},freehandOpacity:{get:function(){return tf.freehandOpacity},set:function(e){tf.freehandOpacity=e}}}),new o(e)},sf=function(e){var t=new _.Vector2(0,0),n=new _.Vector2(0,0),r=!1,i=null,a=function(e){nf.call(this,e)};return(a.prototype=Object.create(nf.prototype)).constructor=sf,a.prototype.reset=function(){t.x=0,t.y=0,n.x=0,n.x=0,r=!1,i=null},a.prototype.draw=function(e,a,o,s){var l=o.type;if("mousedown"===l)t.x=o.layerX-e.offsetLeft,t.y=o.layerY-e.offsetTop,n.x=o.layerX-e.offsetLeft,n.y=o.layerY-e.offsetTop,r=!0,i=(new Jp.a.Ellipse).width(Math.abs(t.x-n.x)).height(Math.abs(t.y-n.y)).stroke(tf.edgeColor).fill(tf.fillColor).move(t.x,t.y),a.node.appendChild(i.node);else if("mouseup"===l){if(r)if(t.equals(n))a.node.removeChild(i.node);else if(s){var c=i.node.getAttribute("id");this.reset(),s(c)}this.reset()}else"mousemove"===l&&r&&(n.x=o.layerX-e.offsetLeft,n.y=o.layerY-e.offsetTop,i.node.setAttribute("rx",Math.abs(t.x-n.x)),i.node.setAttribute("ry",Math.abs(t.y-n.y)),i.node.setAttribute("width",Math.abs(t.x-n.x)),i.node.setAttribute("height",Math.abs(t.y-n.y)),i.node.setAttribute("stroke",tf.edgeColor),i.node.setAttribute("fill",tf.fillColor),i.node.setAttribute("fill-opacity",tf.fillOpacity),i.node.setAttribute("stroke-width",tf.edgeWidth),i.node.setAttribute("stroke-opacity",tf.edgeOpacity))},a.prototype.add=function(e){var r,a=0;return t.x>n.x&&(a=t.x,t.x=n.x,n.x=a),t.y>n.y&&(a=t.y,t.y=n.y,n.y=a),(i=(new Jp.a.Ellipse).width(Math.abs(t.x-n.x)).height(Math.abs(t.y-n.y)).stroke(tf.edgeColor).fill(tf.fillColor).move(t.x,t.y)).node.setAttribute("fill-opacity",tf.fillOpacity),i.node.setAttribute("stroke-width",tf.edgeWidth),i.node.setAttribute("stroke-opacity",tf.edgeOpacity),e.node.appendChild(i.node),r=i.node.getAttribute("id"),this.reset(),r},a.prototype.remove=function(e){},a.prototype.set=function(e,r){t=e[0],n=e[1]},a.prototype.setAttribute=function(e,t,n){switch(t){case m.m.FillColor:e.setAttribute("fill",n);break;case m.m.FillOpacity:e.setAttribute("fill-opacity",n);break;case m.m.EdgeColor:e.setAttribute("stroke",n);break;case m.m.EdgeWidth:e.setAttribute("stroke-width",n);break;case m.m.EdgeOpacity:e.setAttribute("stroke-opacity",n)}},a.prototype.getAttribute=function(e,t){var n=null;switch(t){case m.m.FillColor:n=e.getAttribute("fill");break;case m.m.FillOpacity:n=e.getAttribute("fill-opacity");break;case m.m.EdgeColor:n=e.getAttribute("stroke");break;case m.m.EdgeWidth:n=e.getAttribute("stroke-width");break;case m.m.EdgeOpacity:n=e.getAttribute("stroke-opacity")}return n},Object.defineProperties(a.prototype,{mode:{value:m.l.Ellipse,writable:!1,configurable:!1},fillColor:{get:function(){return tf.fillColor},set:function(e){tf.fillColor=e}},fillOpacity:{get:function(){return tf.fillOpacity},set:function(e){tf.fillOpacity=e}},edgeColor:{get:function(){return tf.edgeColor},set:function(e){tf.edgeColor=e}},edgeWidth:{get:function(){return tf.edgeWidth},set:function(e){tf.edgeWidth=e}},edgeOpacity:{get:function(){return tf.edgeOpacity},set:function(e){tf.edgeOpacity=e}}}),new a(e)},lf=function(e){var t=new _.Vector2(0,0),n=new _.Vector2(0,0),r=!1,i=null,a=function(e){nf.call(this,e)};return(a.prototype=Object.create(nf.prototype)).constructor=lf,a.prototype.reset=function(){t.x=0,t.y=0,n.x=0,n.x=0,r=!1,i=null},a.prototype.draw=function(e,a,o,s){var l=o.type;if("mousedown"===l)t.x=o.layerX-e.offsetLeft,t.y=o.layerY-e.offsetTop,n.x=o.layerX-e.offsetLeft,n.y=o.layerY-e.offsetTop,r=!0,(i=(new Jp.a.Rect).width(Math.abs(t.x-n.x)).height(Math.abs(t.y-n.y)).stroke(tf.edgeColor).fill(tf.fillColor).move(t.x,t.y)).node.setAttribute("x",n.x),i.node.setAttribute("y",n.y),a.node.appendChild(i.node);else if("mouseup"===l){if(r)if(t.equals(n))a.node.removeChild(i.node);else if(s){var c=i.node.getAttribute("id");this.reset(),s(c)}this.reset()}else"mousemove"===l&&r&&(n.x=o.layerX-e.offsetLeft,n.y=o.layerY-e.offsetTop,i.node.setAttribute("width",Math.abs(t.x-n.x)),i.node.setAttribute("height",Math.abs(t.y-n.y)),i.node.setAttribute("left",n.x),i.node.setAttribute("top",n.y),t.x>n.x&&i.node.setAttribute("x",n.x),t.y>n.y&&i.node.setAttribute("y",n.y),i.node.setAttribute("stroke",tf.edgeColor),i.node.setAttribute("fill",tf.fillColor),i.node.setAttribute("fill-opacity",tf.fillOpacity),i.node.setAttribute("stroke-width",tf.edgeWidth),i.node.setAttribute("stroke-opacity",tf.edgeOpacity))},a.prototype.add=function(e){var r,a=0;return t.x>n.x&&(a=t.x,t.x=n.x,n.x=a),t.y>n.y&&(a=t.y,t.y=n.y,n.y=a),(i=(new Jp.a.Rect).width(Math.abs(t.x-n.x)).height(Math.abs(t.y-n.y)).stroke(tf.edgeColor).fill(tf.fillColor).move(t.x,t.y)).node.setAttribute("fill-opacity",tf.fillOpacity),i.node.setAttribute("stroke-width",tf.edgeWidth),i.node.setAttribute("stroke-opacity",tf.edgeOpacity),e.node.appendChild(i.node),r=i.node.getAttribute("id"),this.reset(),r},a.prototype.remove=function(e){},a.prototype.set=function(e,r){t=e[0],n=e[1]},a.prototype.setAttribute=function(e,t,n){switch(t){case m.m.FillColor:e.setAttribute("fill",n);break;case m.m.FillOpacity:e.setAttribute("fill-opacity",n);break;case m.m.EdgeColor:e.setAttribute("stroke",n);break;case m.m.EdgeWidth:e.setAttribute("stroke-width",n);break;case m.m.EdgeOpacity:e.setAttribute("stroke-opacity",n)}},a.prototype.getAttribute=function(e,t){var n=null;switch(t){case m.m.FillColor:n=e.getAttribute("fill");break;case m.m.FillOpacity:n=e.getAttribute("fill-opacity");break;case m.m.EdgeColor:n=e.getAttribute("stroke");break;case m.m.EdgeWidth:n=e.getAttribute("stroke-width");break;case m.m.EdgeOpacity:n=e.getAttribute("stroke-opacity")}return n},Object.defineProperties(a.prototype,{mode:{value:m.l.Rect,writable:!1,configurable:!1},fillColor:{get:function(){return tf.fillColor},set:function(e){tf.fillColor=e}},fillOpacity:{get:function(){return tf.fillOpacity},set:function(e){tf.fillOpacity=e}},edgeColor:{get:function(){return tf.edgeColor},set:function(e){tf.edgeColor=e}},edgeWidth:{get:function(){return tf.edgeWidth},set:function(e){tf.edgeWidth=e}},edgeOpacity:{get:function(){return tf.edgeOpacity},set:function(e){tf.edgeOpacity=e}}}),new a(e)},cf=function(e){var t=new _.Vector2(0,0),n=null,r=null,i=!1,a=null,o=function(e){nf.call(this,e)};function setStyles(e,t){for(var n in t)e.style[n]=t[n]}return(o.prototype=Object.create(nf.prototype)).constructor=cf,o.prototype.reset=function(){t.x=0,t.y=0,n&&document.body.removeChild(n),n=null,r=null,i=!1,a=null},o.prototype.draw=function(e,o,s,l){if("mousedown"===s.type)if(i){if(r=document.getElementById("annotationText").value,document.body.removeChild(n),n=null,i=!1,r&&((a=(new Jp.a.Text).text(r).fill(tf.fontColor).move(t.x,t.y)).node.setAttribute("fill",tf.fontColor),a.node.setAttribute("font-family",tf.fontName),a.node.setAttribute("font-size",tf.fontSize),o.node.appendChild(a.node),l)){var c=a.node.getAttribute("id");this.reset(),l(c)}this.reset()}else{t.x=s.layerX-e.offsetLeft,t.y=s.layerY-e.offsetTop,(n=document.createElement("div")).style.left=s.clientX-e.offsetLeft+"px",n.style.top=s.clientY-e.offsetTop+"px",n.style.zIndex=parseInt(e.style.zIndex)+1,n.style.position="absolute";var u=document.createElement("div");u.id="annotation",setStyles(u,{position:"absolute",color:"#7C7C7C","background-color":"#FAFBFD","-moz-border-radius":"2px","-webkit-border-radius":"2px","border-radius":"2px","-webkit-box-shadow":"0px 0px 16px 0px rgba(0,0,0,0.3)","-moz-box-shadow":"0px 0px 16px 0px rgba(0,0,0,0.3)","box-shadow":"0px 0px 16px 0px rgba(0, 0, 0, 0.3)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"Default",padding:"6px 6px 6px 6px",width:"200px"});var h=document.createElement("textarea");h.id="annotationText",setStyles(h,{border:"solid 1px #FAFBFD",width:"198px",height:"50px",resize:"vertical",overflow:"hidden",outline:"none",margin:"0","line-height":"20px",color:tf.fontColor,"font-size":tf.fontSize+"px","font-family":tf.fontName});var d=document.createElement("div");d.id="annotationGlyph",setStyles(d,{content:"",position:"absolute",top:"20px",right:"100%","margin-top":"-10px",width:"0",height:"0","border-right":"10px solid #ffffff","border-top":"10px solid transparent","border-bottom":"10px solid transparent"}),u.appendChild(d),u.appendChild(h),n.appendChild(u),document.body.appendChild(n),document.getElementById("annotation").contentEditable=!0,document.getElementById("annotationText").focus(),i=!0}},o.prototype.add=function(e){var n=null;return r&&((a=(new Jp.a.Text).text(r).fill(tf.fontColor).move(t.x,t.y)).node.setAttribute("fill",tf.fontColor),a.node.setAttribute("font-family",tf.fontName),a.node.setAttribute("font-size",tf.fontSize),e.node.appendChild(a.node),n=a.node.getAttribute("id")),this.reset(),n},o.prototype.remove=function(e){},o.prototype.set=function(e,n){t=e[0],r=n},o.prototype.setAttribute=function(e,t,n){switch(t){case m.m.FontColor:e.setAttribute("fill",n);break;case m.m.FontName:e.setAttribute("font-family",n);break;case m.m.FontSize:e.setAttribute("font-size",n)}},o.prototype.getAttribute=function(e,t){var n=null;switch(t){case m.m.FontColor:n=e.getAttribute("fill");break;case m.m.FontName:n=e.getAttribute("font-family");break;case m.m.FontSize:n=e.getAttribute("font-size")}return n},Object.defineProperties(o.prototype,{mode:{value:m.l.Text,writable:!1,configurable:!1},fontColor:{get:function(){return tf.fontColor},set:function(e){tf.fontColor=e}},fontName:{get:function(){return tf.fontName},set:function(e){tf.fontName=e}},fontSize:{get:function(){return tf.fontSize},set:function(e){tf.fontSize=e}}}),new o(e)},uf=function(e){var t=new _.Vector2(0,0),n=null,i=null,a=!1,o=0,s=new _.Vector3(0,0,0),l=new _.Vector3(0,0,0),c=e,u=function(e){nf.call(this,e)};function setStyles(e,t){for(var n in t)e.style[n]=t[n]}return(u.prototype=Object.create(nf.prototype)).constructor=uf,u.prototype.reset=function(){t.x=0,t.y=0,n&&document.body.removeChild(n),n=null,i=null,a=!1,o=0,s.x=0,s.y=0,s.z=0,l.x=0,l.y=0,l.z=0},u.prototype.draw=function(s,u,h,d){if("mousedown"===h.type)if(a){if(i=document.getElementById("annotationText_"+o).value){document.getElementById("annotationText_"+o).innerHTML=i,document.getElementById("annotationText_"+o).readOnly=!0,document.getElementById("annotation_"+o).contentEditable=!1,document.body.removeChild(n);var p=c[hf._getViewer]().addExtension(yf);if(p){var f=p.createGenericAnnotation(l.x+.001,l.y+.001,l.z,n.innerHTML,l.x,l.y,l.z,65280,16711680,0,[0,0,0]);p.setOwnerNameByAnnotationId(f,"MarkupAnchoredText"),p.setAnchorHandlerOn(!0),e[hf._addToAnnotationObjs](f),n=null,d&&(this.reset(),d(f))}}else document.body.removeChild(n),n=null;this.reset()}else{t.x=h.layerX-s.offsetLeft,t.y=h.layerY-s.offsetTop;var m=r.b._getObjectAtViewportCoordinate(t.x,t.y,e[hf._getViewer]().domElement,e[hf._getViewer]()._scene,e[hf._getViewer]()._dimscene,e[hf._getViewer]()[Vp._getCamera](),e[hf._getViewer]()._scene.selectionMode);if(null!==m){o="_"+Math.random().toString(36).substr(2,9),l.x=m.point.x,l.y=m.point.y,l.z=m.point.z,(n=document.createElement("div")).id="anchor_"+o,n.style.left=h.clientX-s.offsetLeft+"px",n.style.top=h.clientY-s.offsetTop+"px",n.style.zIndex=parseInt(s.style.zIndex)+1,n.style.position="absolute";var g=document.createElement("div");g.id="annotation_"+o,setStyles(g,{position:"absolute",color:"#7C7C7C","background-color":"#FAFBFD","-moz-border-radius":"2px","-webkit-border-radius":"2px","border-radius":"2px","-webkit-box-shadow":"0px 0px 16px 0px rgba(0,0,0,0.3)","-moz-box-shadow":"0px 0px 16px 0px rgba(0,0,0,0.3)","box-shadow":"0px 0px 16px 0px rgba(0, 0, 0, 0.3)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"Default",padding:"6px 6px 6px 6px",width:"200px","margin-top":"-10px","margin-left":"+10px"});var v=document.createElement("textarea");v.id="annotationText_"+o,setStyles(v,{border:"solid 1px #FAFBFD",width:"198px",height:"50px",resize:"vertical",overflow:"hidden",outline:"none",margin:"0","line-height":"20px",color:tf.fontColor,"font-size":tf.fontSize+"px","font-family":tf.fontName});var y=document.createElement("div");y.id="annotationGlyph_"+o,setStyles(y,{content:"",position:"absolute",top:"0px",right:"100%","margin-top":"0px",width:"0",height:"0","border-right":"10px solid #ffffff","border-top":"10px solid transparent","border-bottom":"10px solid transparent"}),g.appendChild(y),g.appendChild(v),n.appendChild(g),document.body.appendChild(n),document.getElementById("annotation_"+o).contentEditable=!0,document.getElementById("annotationText_"+o).focus(),a=!0}}},u.prototype.add=function(t){var r=null;o="_"+Math.random().toString(36).substr(2,9),(n=document.createElement("div")).id="anchor_"+o,n.style.position="absolute";var a=document.createElement("div");a.id="annotation_"+o,setStyles(a,{position:"absolute",color:"#7C7C7C","background-color":"#FAFBFD","-moz-border-radius":"2px","-webkit-border-radius":"2px","border-radius":"2px","-webkit-box-shadow":"0px 0px 16px 0px rgba(0,0,0,0.3)","-moz-box-shadow":"0px 0px 16px 0px rgba(0,0,0,0.3)","box-shadow":"0px 0px 16px 0px rgba(0, 0, 0, 0.3)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"Default",padding:"6px 6px 6px 6px",width:"200px","margin-top":"-10px","margin-left":"+10px"});var s=document.createElement("textarea");s.id="annotationText_"+o,setStyles(s,{border:"solid 1px #FAFBFD",width:"198px",height:"50px",resize:"vertical",overflow:"hidden",outline:"none",margin:"0","line-height":"20px",color:tf.fontColor,"font-size":tf.fontSize+"px","font-family":tf.fontName});var u=document.createElement("div");u.id="annotationGlyph_"+o,setStyles(u,{content:"",position:"absolute",top:"0px",right:"100%","margin-top":"0px",width:"0",height:"0","border-right":"10px solid #ffffff","border-top":"10px solid transparent","border-bottom":"10px solid transparent"}),a.appendChild(u),a.appendChild(s),n.appendChild(a),s.value=i,s.innerHTML=i,s.readOnly=!0,a.contentEditable=!1;var h=c[hf._getViewer]().addExtension(yf);return h&&(r=h.createGenericAnnotation(l.x+.001,l.y+.001,l.z,n.innerHTML,l.x,l.y,l.z,65280,16711680,0,[0,0,0]),h.setOwnerNameByAnnotationId(r,"MarkupAnchoredText"),h.setAnchorHandlerOn(!0),e[hf._addToAnnotationObjs](r)),n=null,this.reset(),r},u.prototype.remove=function(e){},u.prototype.set=function(e,t){s.x=e[0].x,s.y=e[0].y,s.z=e[0].z,l.x=e[1].x,l.y=e[1].y,l.z=e[1].z,i=t},u.prototype.setAttribute=function(e,t,n){var i=document.createElement("div");i.innerHTML=e.content;var a=i.getElementsByTagName("textarea");switch(t){case m.m.FontColor:a[0].style.color=function hexToRgb(e){if(r.b._isString(e)){e=e.replace(/[^0-9A-F]/gi,"");var t=parseInt(e,16);return"rgb("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+")"}return"rgb(0,0,0)"}(n);break;case m.m.FontName:a[0].style.fontFamily=n;break;case m.m.FontSize:a[0].style.fontSize=n+"px"}a[0].readOnly=!0,e.content=i.innerHTML},u.prototype.getAttribute=function(e,t){var n=document.createElement("div");n.innerHTML=e;var i=n.getElementsByTagName("textarea"),a=null;switch(t){case m.m.FontColor:a=function rgbToHex(e){if(r.b._isString(e)){var t=(e=e.replace(/[rgb()]/gi,"")).split(","),n=parseInt(t[0]).toString(16);n=1===n.length?"0"+n:n;var i=parseInt(t[1]).toString(16);i=1===i.length?"0"+i:i;var a=parseInt(t[2]).toString(16);return"#"+n+i+(a=1===a.length?"0"+a:a)}return"#000000"}(i[0].style.color);break;case m.m.FontName:a=i[0].style.fontFamily;break;case m.m.FontSize:a=i[0].style.fontSize.replace(/[px]/gi,"")}return a},Object.defineProperties(u.prototype,{mode:{value:m.l.AnchoredText,writable:!1,configurable:!1},fontColor:{get:function(){return tf.fontColor},set:function(e){tf.fontColor=e}},fontName:{get:function(){return tf.fontName},set:function(e){tf.fontName=e}},fontSize:{get:function(){return tf.fontSize},set:function(e){tf.fontSize=e}}}),new u(e)};const hf=Object.freeze({_getViewer:Symbol(),_addToAnnotationObjs:Symbol()});var df=function(e){var t=null,n=!1,a=null,o=null,s=[],l=null,c=[],u=null,h=!1,d=[],p=null,f=function(e){var t=e.lastIndexOf(".");return".SVG"===e.substring(t,e.length).toUpperCase()},g=function(e){};function addSVGElement(){(c[m.l.Select].reset(),a)||((a=document.createElement("div")).id="myDrawing",a.style.width=t._renderer.domElement.width,a.style.height=t._renderer.domElement.height,a.style.position="absolute",a.style.top=t._renderer.domElement.top,a.style.left=t._renderer.domElement.left,a.style.zIndex=parseInt(t._renderer.domElement.style.zIndex)+1,a.width=t._renderer.domElement.width,a.height=t._renderer.domElement.height,t._renderer.domElement.parentElement.appendChild(a),o=new Jp.a("myDrawing").size(t._renderer.domElement.width,t._renderer.domElement.height))}function removeSVGElement(){if(a){listenSVGElement(!1);for(var e=0;e<s.length;e++)s[e].remove();for(;s.length;)s.pop();l=null,o.clear(),o.remove(),t._renderer.domElement.parentElement.removeChild(a),a=null,o=null}}function showCallback(e){sendEventToViewer(e),"mousemove"===e.type&&(removeAnnotationObjs(),removeSVGElement(),h=!1)}function handleSVGMouseEvt(e){e.preventDefault(),ensureActiveLayer(),h?c[m.l.Select].draw(a,l,e,showCallback):(c[m.l.Select].draw(a,l,e,null),!0!==e.override&&(u!==c[m.l.Select]?u.draw(a,l,e,g):(e.override=!1,sendEventToViewer(e))))}function listenSVGElement(e){a&&(e?(a.addEventListener("mousemove",handleSVGMouseEvt,!1),a.addEventListener("mousedown",handleSVGMouseEvt,!1),a.addEventListener("mouseup",handleSVGMouseEvt,!1),a.addEventListener("wheel",handleSVGMouseEvt,!1)):e||(a.removeEventListener("mousemove",handleSVGMouseEvt,!1),a.removeEventListener("mousedown",handleSVGMouseEvt,!1),a.removeEventListener("mouseup",handleSVGMouseEvt,!1),a.removeEventListener("wheel",handleSVGMouseEvt,!1)))}function sendEventToViewer(e){var n=document.createEvent("MouseEvent"),r=e.detail;"wheel"===e.type&&(e.wheelDelta>0?r=9:e.wheelDelta<=0?r=-9:e.deltaY&&(r=e.deltaY)),n.initMouseEvent(e.type,e.bubbles,e.cancelable,e.view,r,e.pageX||e.layerX,e.pageY||e.layerY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),t._renderer.domElement.dispatchEvent(n)}function getAnnotationObjInfo(e){var n="";if(d.length>0){var r=t.addExtension(yf);if(r)for(var i=0;i<d.length;i++){var a=d[i],o=new _.Vector3(0,0,0),s=new _.Vector3(0,0,0),l=function(e,t,i){s.x=e,s.y=t,s.z=i;var l=r.getContentByAnnotationId(a.annotationObjID);n+="<ANNOTATION><TEXT>"+o.x+","+o.y+","+o.z+","+s.x+","+s.y+","+s.z+",<CONTENT>"+l}.bind(this),c=function(e,t,n){o.x=e,o.y=t,o.z=n,r.getAnchorPositionByAnnotationId(a.annotationObjID,l)}.bind(this);void 0!==e&&null!==e&&e!==a.layerID||r.getPositionByAnnotationId(a.annotationObjID,c)}}return n}function showAnnotationObjInfo(e){var n=t.addExtension(yf);if(n)for(var r=e.split("<ANNOTATION>"),i=1;i<r.length;i++){var a=r[i].slice(0,6),o=r[i].slice(6,r[i].length);if("<TEXT>"===a){var s=o.indexOf("<CONTENT>"),c=o.substring(0,s-1).split(","),u=o.substring(s+9,o.length),h=n.createGenericAnnotation(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]),u,parseInt(c[3]),parseInt(c[4]),parseInt(c[5]),65280,16711680,0,[0,0,0]);n.setOwnerNameByAnnotationId(h,"MarkupAnchoredText");o={layerID:l.node.id,annotationObjID:h};d.push(o)}}}function removeAnnotationObjs(e){if(d.length>0){for(var n=t.addExtension(yf),r=0;r<d.length;r++){var i=d[r];void 0!==e&&null!==e&&e!==i.layerID||n.removeByAnnotationId(i.annotationObjID)}for(;d.length;)d.pop()}}function handleAnnotationEvt(e,t){t!==m.n.Selected&&t!==m.n.Editing||(c[m.l.Select].reset(),p=e)}function ensureActiveLayer(){0===s.length&&null===l&&((l=o.element("g")).node.setAttribute("visibility","visible"),s.push(l))}var v=function(e){t=e._parent,c[m.l.Select]=new rf(this),c[m.l.Line]=new af(this),c[m.l.Freehand]=new of(this),c[m.l.Ellipse]=new sf(this),c[m.l.Rect]=new lf(this),c[m.l.Text]=new cf(this),c[m.l.AnchoredText]=new uf(this),u=c[m.l.Select]};return(v.prototype={constructor:v}).showMarkupViewByFile=function(e,n){r.b._isString(e,!0),r.b._optionalArgCheck(n,r.b._isFunction),Qp(i.b.stringsByLabel.MARKUP_LOGGER_showMarkupViewByFile+e),n=n||function(){};f(e)?(this.mode=m.l.Select,t.addExtension(yf).setAnchorHandlerOn(!1),removeAnnotationObjs(),removeSVGElement(),addSVGElement(),function showSvgMarkupViewByFile(e,n){if(o){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="text",r.onload=function(){if(void 0!==r.response)if(null===r.response||0===r.response.length||200!==r.status&&0!==r.status)$p(i.b.stringsByLabel.MARKUP_LOGGER_openErrorSVG),n&&n(!1);else{var e=r.response;ensureActiveLayer(),o.svg(e),r=null;var a,s,l=document.getElementById("myDrawing").childNodes[0],c=l.getElementsByTagName("metadata")[0].textContent,u=c.indexOf("<ANNOTATION>");u<=0?a=c:(a=c.substring(0,u),s=c.substring(u));var h=JSON.parse(a);t.setCameraOrientationInfo(h),s&&showAnnotationObjInfo(s);var d=l.getElementsByTagName("metadata");d[0].parentNode.removeChild(d[0]),n&&n(!0)}else $p(i.b.stringsByLabel.MARKUP_LOGGER_openErrorSVG),n&&n(!1)},r.onerror=function(){Kp(i.b.stringsByLabel.MARKUP_LOGGER_openErrorSVG),n&&n(!1)},r.send(null)}}(e,function(e){e&&(listenSVGElement(!0),h=!0),n&&n(e)})):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.downloadMarkupView=function(e){r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_downloadMarkupView+e),f(e)?function downloadSvgMarkupView(e){if(o){var n=t.getCameraOrientationInfo(),r=JSON.stringify(n)+getAnnotationObjInfo();o.element("metadata").words(r);var i=document.getElementById("myDrawing").childNodes[0];i.setAttribute("xmlns","http://www.w3.org/2000/svg");var a=i.parentNode.innerHTML,s=i.getElementsByTagName("metadata");s[0].parentNode.removeChild(s[0]);var l=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',a],{type:"image/svg+xml;charset=utf-8"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(l,e);else{var c=URL.createObjectURL(l),u=document.createElement("a");u.href=c,u.download=e,document.body.appendChild(u),u.click(),document.body.removeChild(u)}}}(e):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.showMarkupViewByData=function(e){r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_showMarkupViewByData),this.mode=m.l.Select,t.addExtension(yf).setAnchorHandlerOn(!1),removeAnnotationObjs(),removeSVGElement(),addSVGElement(),function showSvgMarkupViewByData(e){if(o){ensureActiveLayer(),o.svg(e);var n,r,i=document.getElementById("myDrawing").childNodes[0],a=i.getElementsByTagName("metadata")[0].textContent,s=a.indexOf("<ANNOTATION>");s<=0?n=a:(n=a.substring(0,s),r=a.substring(s));var l=JSON.parse(n);t.setCameraOrientationInfo(l),r&&showAnnotationObjInfo(r);var c=i.getElementsByTagName("metadata");c[0].parentNode.removeChild(c[0])}}(e),listenSVGElement(!0),h=!0},v.prototype.getMarkupViewData=function(){return Qp(i.b.stringsByLabel.MARKUP_LOGGER_getMarkupViewData),function getSvgMarkupView(){var e=null;if(o){var n,r=t.getCameraOrientationInfo();n=JSON.stringify(r)+getAnnotationObjInfo(),o.element("metadata").words(n);var i=document.getElementById("myDrawing").childNodes[0];i.setAttribute("xmlns","http://www.w3.org/2000/svg"),e=i.parentNode.innerHTML;var a=i.getElementsByTagName("metadata");a[0].parentNode.removeChild(a[0])}return e}()},v.prototype.deleteSelected=function(){Qp(i.b.stringsByLabel.MARKUP_LOGGER_deleteSelected),null!==p?(this.deleteMarkup(p),p=null):c[m.l.Select].remove(l)},v.prototype.setMarkupProperty=function(e,t){switch(r.b._isNumber(e,!0),r.b._isString(t,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_setMarkupProperty+e+" "+t),e){case m.m.SelectColor:tf.selectColor=t;break;case m.m.EditColor:tf.editColor=t;break;case m.m.LineColor:tf.lineColor=t;break;case m.m.LineWidth:tf.lineWidth=t;break;case m.m.LineOpacity:tf.lineOpacity=t;break;case m.m.FreehandColor:tf.freehandColor=t;break;case m.m.FreehandWidth:tf.freehandWidth=t;break;case m.m.FreehandOpacity:tf.freehandOpacity=t;break;case m.m.FillColor:tf.fillColor=t;break;case m.m.FillOpacity:tf.fillOpacity=t;break;case m.m.EdgeColor:tf.edgeColor=t;break;case m.m.EdgeWidth:tf.edgeWidth=t;break;case m.m.EdgeOpacity:tf.edgeOpacity=t;break;case m.m.FontColor:tf.fontColor=t;break;case m.m.FontName:tf.fontName=t;break;case m.m.FontSize:tf.fontSize=t;break;default:ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}},v.prototype.getMarkupProperty=function(e){var t;switch(r.b._isNumber(e,!0),e){case m.m.SelectColor:t=tf.selectColor;break;case m.m.EditColor:t=tf.editColor;break;case m.m.LineColor:t=tf.lineColor;break;case m.m.LineWidth:t=tf.lineWidth;break;case m.m.LineOpacity:t=tf.lineOpacity;break;case m.m.FreehandColor:t=tf.freehandColor;break;case m.m.FreehandWidth:t=tf.freehandWidth;break;case m.m.FreehandOpacity:t=tf.freehandOpacity;break;case m.m.FillColor:t=tf.fillColor;break;case m.m.FillOpacity:t=tf.fillOpacity;break;case m.m.EdgeColor:t=tf.edgeColor;break;case m.m.EdgeWidth:t=tf.edgeWidth;break;case m.m.EdgeOpacity:t=tf.edgeOpacity;break;case m.m.FontColor:t=tf.fontColor;break;case m.m.FontName:t=tf.fontName;break;case m.m.FontSize:t=tf.fontSize;break;default:ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}return t},v.prototype.createLine=function(e,t,n,a){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_createLine);this.mode=m.l.Line,ensureActiveLayer();var o=[];return o.push(new _.Vector2(e,t)),o.push(new _.Vector2(n,a)),u.set(o,null),u.add(l)},v.prototype.createFreehand=function(e,t){r.b._isNumber(e,!0),r.b._isObject(t,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_createFreehand);var n=null;return e===t.length&&e>=0?(this.mode=m.l.Freehand,ensureActiveLayer(),u.set(t,null),n=u.add(l)):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg),n},v.prototype.createEllipse=function(e,t,n,a){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_createEllipse);this.mode=m.l.Ellipse,ensureActiveLayer();var o=[];return o.push(new _.Vector2(e,t)),o.push(new _.Vector2(n,a)),u.set(o,null),u.add(l)},v.prototype.createRect=function(e,t,n,a){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_createRect);this.mode=m.l.Rect,ensureActiveLayer();var o=[];return o.push(new _.Vector2(e,t)),o.push(new _.Vector2(n,a)),u.set(o,null),u.add(l)},v.prototype.createText=function(e,t,n){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isString(n,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_createText);this.mode=m.l.Text,ensureActiveLayer();var a=[];return a.push(new _.Vector2(e,t)),u.set(a,n),u.add(l)},v.prototype.createAnchoredText=function(e,t,n,a,o,s,c){r.b._isNumber(e,!0),r.b._isNumber(t,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),r.b._isNumber(o,!0),r.b._isNumber(s,!0),r.b._isString(c,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_createAnchoredText);this.mode=m.l.AnchoredText,ensureActiveLayer();var h=[];return h.push(new _.Vector3(e,t,n)),h.push(new _.Vector3(a,o,s)),u.set(h,c),u.add(l)},v.prototype.selectMarkup=function(e){if(r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_selectMarkup+e),e.search(!0)){var t;(t=document.getElementById(e))?(this.mode=m.l.Select,u.set(null,t)):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.deleteMarkup=function(e){if(!r.b._isString(e)&&!r.b._isNumber(e))throw new TypeError("Expecting a string or a number value.");if(Qp(i.b.stringsByLabel.MARKUP_LOGGER_deleteMarkup+e),r.b._isString(e)&&e.search(!0)){var n=null;(n=document.getElementById(e))?(this.mode=m.l.Select,n.parentNode.removeChild(n)):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}else if(r.b._isNumber(e))if(d.length>0){for(var a=t.addExtension(yf),o=-1,s=!1,l=0;l<d.length&&!s;l++){var c=d[l];c.annotationObjID===e&&(o=l,s=!0,a.removeByAnnotationId(c.annotationObjID))}-1!==o&&d.splice(o,1)}else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg);else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.setPropertyOnMarkup=function(e,n,a){if(!r.b._isString(e)&&!r.b._isNumber(e))throw new TypeError("Expecting a string or a number value.");if(r.b._isNumber(n,!0),r.b._isString(a,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_setPropertyOnMarkup+e+" "+n+" "+a),r.b._isString(e)&&e.search(!0)&&r.b._isNumber(n)&&r.b._isString(a)){var o;if(o=document.getElementById(e))switch(o.nodeName){case"line":c[m.l.Line].setAttribute(o,n,a);break;case"polyline":c[m.l.Freehand].setAttribute(o,n,a);break;case"ellipse":c[m.l.Ellipse].setAttribute(o,n,a);break;case"rect":c[m.l.Rect].setAttribute(o,n,a);break;case"text":c[m.l.Text].setAttribute(o,n,a);break;default:ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}else if(r.b._isNumber(e)&&r.b._isNumber(n)&&r.b._isString(a))if(d.length>0)for(var s=t.addExtension(yf),l=!1,u=0;u<d.length&&!l;u++){var h=d[u];if(h.annotationObjID===e){u,l=!0;var p={};p.content=s.getContentByAnnotationId(h.annotationObjID),c[m.l.AnchoredText].setAttribute(p,n,a),s.setContentByAnnotationId(h.annotationObjID,p.content)}}else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg);else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.getPropertyOnMarkup=function(e,n){if(!r.b._isString(e)&&!r.b._isNumber(e))throw new TypeError("Expecting a string or a number value.");r.b._isNumber(n,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_getPropertyOnMarkup+e+" "+n);var a=null;if(r.b._isString(e)&&e.search(!0)&&r.b._isNumber(n)){var o;if(o=document.getElementById(e))switch(o.nodeName){case"line":a=c[m.l.Line].getAttribute(o,n);break;case"polyline":a=c[m.l.Freehand].getAttribute(o,n);break;case"ellipse":a=c[m.l.Ellipse].getAttribute(o,n);break;case"rect":a=c[m.l.Rect].getAttribute(o,n);break;case"text":a=c[m.l.Text].getAttribute(o,n);break;default:ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)}else if(r.b._isNumber(e)&&r.b._isNumber(n))if(d.length>0)for(var s=t.addExtension(yf),l=!1,u=0;u<d.length&&!l;u++){var h=d[u];if(h.annotationObjID===e){u,l=!0;var p=s.getContentByAnnotationId(h.annotationObjID);a=c[m.l.AnchoredText].getAttribute(p,n)}}else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg);else ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg);return a},v.prototype.getMarkupViewImage=function(e){r.b._isFunction(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_getMarkupViewImage);var n=document.createElement("canvas"),a=n.getContext("2d"),s=!1,l=t._renderer.domElement.parentElement.getElementsByTagName("canvas")[0].width,c=t._renderer.domElement.parentElement.getElementsByTagName("canvas")[0].height;l>=c?(n.setAttribute("width",l.toString()+"px"),n.setAttribute("height",l.toString()+"px")):(n.setAttribute("width",c.toString()+"px"),n.setAttribute("height",c.toString()+"px"));var u=new Image;if(u.addEventListener("load",function(){if(s){a.clearRect(0,0,n.width,n.height),a.drawImage(u,0,0),s=!1;var t=document.getElementById("myDrawing").childNodes[0];t.setAttribute("xmlns","http://www.w3.org/2000/svg"),-1===navigator.userAgent.indexOf("MSIE")&&!0!=!!document.documentMode||t.removeAttribute("xmlns");var r=t.parentNode.innerHTML,i=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',r],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(i);u.src=o}else try{a.drawImage(u,0,0),e(n.toDataURL("image/png"))}catch(t){e(null)}}),o){s=!0;var h=t._renderer.domElement.parentElement.getElementsByTagName("canvas")[0];u.src=h.toDataURL("img/png")}},v.prototype.showMarkupLayerByFile=function(e,t){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isFunction),Qp(i.b.stringsByLabel.MARKUP_LOGGER_showMarkupLayerByFile+e),t=t||function(){};f(e)?(this.mode=m.l.Select,addSVGElement(),function showGMarkupLayerByFile(e,t){if(o){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="text",n.onload=function(){if(void 0!==n.response)if(null===n.response||0===n.response.length||200!==n.status&&0!==n.status)$p(i.b.stringsByLabel.MARKUP_LOGGER_openErrorSVG),t&&t(!1,null);else{var e=n.response;o.svg(e),n=null;var r,a=document.getElementById("myDrawing").childNodes[0],c=a.getElementsByTagName("svg"),u=c[0].getElementsByTagName("g");(l=o.element("g")).node.setAttribute("visibility","visible"),s.push(l),l.node.innerHTML=u[0].innerHTML;var h=a.getElementsByTagName("metadata")[0].textContent,d=h.indexOf("<ANNOTATION>");(r=h.substring(d))&&showAnnotationObjInfo(r);var p=a.getElementsByTagName("metadata");p[0].parentNode.removeChild(p[0]),c[0].parentNode.removeChild(c[0]),t&&t(!0,l.node.id)}else $p(i.b.stringsByLabel.MARKUP_LOGGER_openErrorSVG),t&&t(!1,null)},n.onerror=function(){Kp(i.b.stringsByLabel.MARKUP_LOGGER_openErrorSVG),t&&t(!1,null)},n.send(null)}}(e,function(e,n){e&&listenSVGElement(!0),t&&t(e,n)})):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.downloadMarkupLayer=function(e,t){r.b._isString(e,!0),r.b._isString(t,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_downloadMarkupLayer+t),f(t)?function downloadGMarkupLayer(e,t){if(o){var n=getAnnotationObjInfo(e);o.element("metadata").words(n);for(var i,a=document.getElementById("myDrawing").childNodes[0],s=a.cloneNode(!0),l=s.getElementsByTagName("g"),c=0;c<l.length;c++)l[c].id!==e&&s.removeChild(l[c]);s.setAttribute("xmlns","http://www.w3.org/2000/svg"),i=r.b._notNullOrUndefined(s.outerHTML)?s.outerHTML:(new XMLSerializer).serializeToString(s);var u=a.getElementsByTagName("metadata");u[0].parentNode.removeChild(u[0]);var h=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',i],{type:"image/svg+xml;charset=utf-8"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(h,t);else{var d=URL.createObjectURL(h),p=document.createElement("a");p.href=d,p.download=t,document.body.appendChild(p),p.click(),document.body.removeChild(p)}}}(e,t):ef(i.b.stringsByLabel.MARKUP_LOGGER_invalidInputArg)},v.prototype.showMarkupLayerByData=function(e){r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_showMarkupLayerByData);var t;return this.mode=m.l.Select,addSVGElement(),t=function showGMarkupLayerByData(e){var t=null;if(o){o.svg(e);var n,r=document.getElementById("myDrawing").childNodes[0],i=r.getElementsByTagName("svg"),a=i[0].getElementsByTagName("g");(l=o.element("g")).node.setAttribute("visibility","visible"),s.push(l),t=l.node.id,l.node.innerHTML=a[0].innerHTML;var c=r.getElementsByTagName("metadata")[0].textContent,u=c.indexOf("<ANNOTATION>");(n=c.substring(u))&&showAnnotationObjInfo(n);var h=r.getElementsByTagName("metadata");h[0].parentNode.removeChild(h[0]),i[0].parentNode.removeChild(i[0])}return t}(e),listenSVGElement(!0),t},v.prototype.getMarkupLayerData=function(e){return r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_getMarkupLayerData),function getGMarkupLayer(e){var t=null;if(o){var n=getAnnotationObjInfo(e);o.element("metadata").words(n);for(var i=document.getElementById("myDrawing").childNodes[0],a=i.cloneNode(!0),s=a.getElementsByTagName("g"),l=0;l<s.length;l++)s[l].id!==e&&a.removeChild(s[l]);a.setAttribute("xmlns","http://www.w3.org/2000/svg"),t=r.b._notNullOrUndefined(a.outerHTML)?a.outerHTML:(new XMLSerializer).serializeToString(a);var c=i.getElementsByTagName("metadata");c[0].parentNode.removeChild(c[0])}return t}(e)},v.prototype.newLayer=function(){Qp(i.b.stringsByLabel.MARKUP_LOGGER_newLayer);var e=null;return o&&((l=o.element("g")).node.setAttribute("visibility","visible"),s.push(l),e=l.node.id),e},v.prototype.deleteLayer=function(e){r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_deleteLayer+e);for(var t=-1,n=!1,a=0;a<s.length&&!n;a++)s[a].node.id===e&&(t=a,n=!0,s[a].remove());-1!==t&&(s.splice(t,1),removeAnnotationObjs(e)),l&&l.node.id===e&&(l=s.length>0?s[0]:null)},v.prototype.getNumberOfLayers=function(){return Qp(i.b.stringsByLabel.MARKUP_LOGGER_egetNumberOfLayers),s.length},v.prototype.getLayers=function(){Qp(i.b.stringsByLabel.MARKUP_LOGGER_getLayers);for(var e=[],t=0;t<s.length;t++)e.push(s[t].node.id);return e},v.prototype.setActiveLayer=function(e){r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_setActiveLayer+e);for(var t=!1,n=0;n<s.length&&!t;n++)s[n].node.id===e&&(t=!0,l=s[n])},v.prototype.getActiveLayer=function(){Qp(i.b.stringsByLabel.MARKUP_LOGGER_getActiveLayer);var e=null;if(l)for(var t=!1,n=0;n<s.length&&!t;n++)s[n].node.id===l.node.id&&(t=!0,e=l.node.id);return e},v.prototype.setLayerVisibility=function(e,n){r.b._isString(e,!0),r.b._isBoolean(n,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_setlayerVisibility+e+" "+n);for(var a=!1,o=0;o<s.length&&!a;o++)if(s[o].node.id===e){n?s[o].node.setAttribute("visibility","visible"):s[o].node.setAttribute("visibility","hidden");for(var l=t.addExtension(yf),c=0;c<d.length;c++){var u=d[c];u.layerID===e&&l.setVisibilityByAnnotationId(u.annotationObjID,n)}a=!0}},v.prototype.getLayerVisibility=function(e){r.b._isString(e,!0),Qp(i.b.stringsByLabel.MARKUP_LOGGER_getLayerVisibility+e);for(var t=null,n=!1,a=0;a<s.length&&!n;a++)s[a].node.id===e&&(n=!0,t=s[a].node.getAttribute("visibility"));return t},v.prototype[hf._getViewer]=function(){return t},v.prototype[hf._addToAnnotationObjs]=function(e){ensureActiveLayer();var t={layerID:l.node.id,annotationObjID:e};d.push(t)},Object.defineProperties(v.prototype,{enable:{get:function(){return n},set:function(e){var r;e?(addSVGElement(),listenSVGElement(!0),(u=c[m.l.Select]).reset(),(r=t.addExtension(yf)).clearSelected(),p=null,r.setAnchorHandlerOn(!0),r.registerAnnotationEvent(handleAnnotationEvt)):((r=t.addExtension(yf)).clearSelected(),p=null,r.setAnchorHandlerOn(!1),r.unregisterAnnotationEvent(handleAnnotationEvt),removeAnnotationObjs(),removeSVGElement(),u&&(u.reset(),u=null));n=e,Qp(i.b.stringsByLabel.MARKUP_LOGGER_enableMarkup+e)}},mode:{get:function(){return u?u.mode:m.l.None},set:function(e){e>=m.l.Select&&e<=m.l.AnchoredText&&(u&&u.reset(),this.enable=!0,(u=c[e]).reset(),h=!1,Qp(i.b.stringsByLabel.MARKUP_LOGGER_setMarkupMode+e))}}}),new v(e)};df.prototype={constructor:df,_name:"Markup"};
// CONCATENATED MODULE: ./staging/Annotation.js
var pf=o()("PLMVisWeb:debug:Annotation"),ff=o()("PLMVisWeb:error:Annotation");ff.enabled=!0;var mf=o()("PLMVisWeb:warning:Annotation"),gf=o()("PLMVisWeb:verbose:Annotation");const vf=Object.freeze({_clear:Symbol(),_fireAnnotationEvent:Symbol()});var yf=function(e){var t=null,n=null,a=!1,o="rgb(255, 0, 0)",s="rgb(0, 255, 0)",l=[],c=new _.Vector3,u=new _.Quaternion,h=new _.Vector3;function setSizeByDistance(e,n,r){var i=e.children[1];i.matrixWorld.decompose(c,u,h);var a=n.position.distanceTo(c),o=2*Math.tan(t.getCameraInfo().perspective.fov*(Math.PI/180)/2)*a,s=2*e.userData.markerRadius/r.getSize().height*o/2/i.geometry.boundingSphere.radius;i.scale.set(s,s,s)}function _updateAnnotation(e){if(!(e instanceof _.Line||e instanceof _.Sprite||e.id===n.id)){var r=new _.Vector3(e.children[0].geometry.attributes.position.array[0],e.children[0].geometry.attributes.position.array[1],e.children[0].geometry.attributes.position.array[2]),i=new _.Vector3(e.children[0].geometry.attributes.position.array[3],e.children[0].geometry.attributes.position.array[4],e.children[0].geometry.attributes.position.array[5]);e.children[0].visible=!r.equals(i);var o=r.clone().project(t._currentCamera),s=t._renderer.domElement.width/2,l=t._renderer.domElement.height/2;if(e.userData.domObj.style.left=Math.round(o.x*s+s)+"px",e.userData.domObj.style.top=Math.round(-o.y*l+l)+"px",!a&&!e.onTop){var c=new _.Vector3;c.copy(t._currentCamera.position),c.sub(t._cameraControls.target),e.userData.domObj.style.zIndex=parseInt(t._renderer.domElement.style.zIndex)+parseInt(r.dot(c)/c.length()>=0?1:-1)}void 0!==e.userData.markerRadius&&setSizeByDistance(e,t._currentCamera,t._renderer)}}var d=function(e){t=e._parent};function hexToRgb(e){if(r.b._isString(e)){e=e.replace(/[^0-9A-F]/gi,"");var t=parseInt(e,16);return"rgb("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+")"}return pf("hexToRgb: bad input value"),"rgb(0,0,0)"}function _onmousedown(e){for(var t=0;t<n.children.length;t++)if("MarkupAnchoredText"===n.children[t].name){var r=document.getElementById(n.children[t].userData.domObj.childNodes[0].id);r&&(r.contains(e.target)?r.style.backgroundColor===s||(r.style.backgroundColor!==o&&d.prototype[vf._fireAnnotationEvent](n.children[t].id,m.n.Selected),r.style.backgroundColor=o,r.readOnly=!0,r.contentEditable=!1,r.childNodes[1].readOnly=!0,r.childNodes[1].contentEditable=!1):("rgb(250, 251, 253)"!==r.style.backgroundColor&&d.prototype[vf._fireAnnotationEvent](n.children[t].id,m.n.Deselected),r.style.backgroundColor="rgb(250, 251, 253)",r.readOnly=!0,r.contentEditable=!1,r.childNodes[1].readOnly=!0,r.childNodes[1].contentEditable=!1))}}function _ondblclick(e){for(var t=0;t<n.children.length;t++)if("MarkupAnchoredText"===n.children[t].name){var r=document.getElementById(n.children[t].userData.domObj.childNodes[0].id);r&&(r.contains(e.target)?(r.style.backgroundColor!==s&&d.prototype[vf._fireAnnotationEvent](n.children[t].id,m.n.Editing),r.style.backgroundColor=s,r.readOnly=!1,r.contentEditable=!0,r.childNodes[1].readOnly=!1,r.childNodes[1].contentEditable=!0):("rgb(250, 251, 253)"!==r.style.backgroundColor&&d.prototype[vf._fireAnnotationEvent](n.children[t].id,m.n.Deselected),r.style.backgroundColor="rgb(250, 251, 253)",r.readOnly=!0,r.contentEditable=!1,r.childNodes[1].readOnly=!0,r.childNodes[1].contentEditable=!1))}}function _dragstart(e){e.dataTransfer.setData("text",e.target.id+","+e.offsetX+","+e.offsetY)}function _drop(e){for(var t=e.dataTransfer.getData("text").split(","),r=0;r<n.children.length;r++)void 0!==n.children[r].userData.domObj&&t[0]===n.children[r].userData.domObj.childNodes[0].id&&d.prototype.setPositionByAnnotationIdByViewCoordinates(n.children[r].id,e.layerX-t[1]-10,e.layerY-t[2]+10);return e.preventDefault(),!1}function _dragover(e){return e.preventDefault(),!1}function _updateAnnotationObj(){if(null!==n&&n.children.length>0)for(var e=n.children,t=0,r=e.length;t<r;++t)_updateAnnotation(e[t])}return d.prototype={constructor:d},d.prototype[vf._clear]=function(){this.clearAnnotationData()},d.prototype.clearAnnotationData=function(){if(pf("Annotation- clearAnnotationData API- Removing all the annotation data."),null!==n){for(var e=n.children.length,r=0;r<e;++r)this.removeByAnnotationId(n.children[0].id);t._scene._annotationContainer.remove(n),n=null,t[Vp._render]()}},d.prototype.createGenericAnnotation=function(e,a,o,s,l,c,u,h,d,p,f){if(r.b._isNumber(e,!0),r.b._isNumber(a,!0),r.b._isNumber(o,!0),!(s instanceof HTMLElement||r.b._isString(s)))throw new TypeError("Expecting a HTMLElement or string value.");r.b._isNumber(l,!0),r.b._isNumber(c,!0),r.b._isNumber(u,!0),r.b._isNumber(h,!0),r.b._isNumber(d,!0),r.b._optionalArgCheck(p,r.b._isNumber),r.b._optionalArgCheck(f,r.b._isArray,r.b._isNumber),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_createGenericAnnotation);var m=function(e){return"number"==typeof e};if(m(e)&&m(a)&&m(o)&&m(l)&&m(c)&&m(u)&&m(h)&&m(d)&&(void 0===p||m(p))&&(void 0===f||3===f.length&&m(f[0])&&m(f[1])&&m(f[2]))){l=void 0===l?e:l,c=void 0===c?a:c,u=void 0===u?o:u,h=void 0===h?0:h,d=void 0===d?0:d;var g=new _.Vector3(e,a,o),v=new _.Vector3(l,c,u),y=new _.Object3D;y.userData.domObj=document.createElement("div"),s instanceof Element?y.userData.domObj.appendChild(s):y.userData.domObj.innerHTML=s,y.userData.domObj.style.position="absolute";var b=new _.BufferGeometry,x=new _.LineBasicMaterial({vertexColors:_.VertexColors}),w=[g.x,g.y,g.z,v.x,v.y,v.z],M=[];M.push(((16711680&h)>>16)/255),M.push(((65280&h)>>8)/255),M.push((255&h)/255),M.push(((16711680&d)>>16)/255),M.push(((65280&d)>>8)/255),M.push((255&d)/255),b.addAttribute("position",new _.BufferAttribute(new Float32Array(w),3)),b.addAttribute("color",new _.BufferAttribute(new Float32Array(M),3));var E=new _.Line(b,x,_.LineSegments);if(y.add(E),f&&void 0!==p&&p>0){var S=function(){var e=new _.BufferGeometry;e.addAttribute("position",new _.BufferAttribute(new Float32Array(96),3)),e.addAttribute("color",new _.BufferAttribute(new Float32Array(96),3)),e.setIndex(new _.BufferAttribute(new Uint16Array(33),1));for(var t=2*Math.PI/32,n=0;n<32;++n)e.attributes.position.array[3*n+0]=Math.sin(t*n),e.attributes.position.array[3*n+1]=Math.cos(t*n),e.attributes.position.array[3*n+2]=0,e.attributes.color.array[3*n+0]=M[3],e.attributes.color.array[3*n+1]=M[4],e.attributes.color.array[3*n+2]=M[5],e.index.array[n]=n;return e.computeBoundingSphere(),new _.Line(e,x)}();S.position.copy(v),y.add(S);var L=(new _.Vector3).fromArray(f);S.lookAt(L),y.userData.markerRadius=p,setSizeByDistance(y,t._currentCamera,t._renderer)}null===n&&((n=new _.Object3D).name="ANNOTATIONS",t._scene._annotationContainer.add(n)),n.add(y);var T=function(e,t){e.x>t.max.x&&(t.max.x=e.x),e.y>t.max.y&&(t.max.y=e.y),e.z>t.max.z&&(t.max.z=e.z),e.x<t.min.x&&(t.min.x=e.x),e.y<t.min.y&&(t.min.y=e.y),e.z<t.min.z&&(t.min.z=e.z)};return T(g,t._modelBBox),T(v,t._modelBBox),T=null,this.setAnnotationsOnTop(this.getAnnotationsOnTop()),t._renderer.domElement.parentElement.appendChild(y.userData.domObj),t[Vp._render](),gf(i.b.stringsByLabel.ANNOTATION_LOGGER_finest_createGenericAnnotation+y.id),y.id}},d.prototype.setAnchorHandlerOn=function(e){if(r.b._isBoolean(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setAnchorHandlerOn),n){var a=t.addExtension(df);o=hexToRgb(a.getMarkupProperty(m.m.SelectColor)),s=hexToRgb(a.getMarkupProperty(m.m.EditColor));var l=!1;if(e){for(var c=0;c<n.children.length;c++)void 0!==n.children[c].userData.domObj&&(n.children[c].userData.domObj.childNodes[0].draggable=!0,n.children[c].userData.domObj.childNodes[0].addEventListener("dragstart",_dragstart,!1),l=!0);if(l){var u=t.domElement.parentNode.id;(h=document.getElementById(u))&&(h.addEventListener("dragover",_dragover,!1),h.addEventListener("drop",_drop,!1),h.addEventListener("mousedown",_onmousedown,!1),h.addEventListener("dblclick",_ondblclick,!1))}}else{for(c=0;c<n.children.length;c++)void 0!==n.children[c].userData.domObj&&(n.children[c].userData.domObj.childNodes[0].draggable=!1,n.children[c].userData.domObj.childNodes[0].removeEventListener("dragstart",_dragstart,!1),l=!0);if(l){var h;u=t.domElement.parentNode.id;(h=document.getElementById(u))&&(h.removeEventListener("dragover",_dragover,!1),h.removeEventListener("drop",_drop,!1),h.removeEventListener("mousedown",_onmousedown,!1),h.removeEventListener("dblclick",_ondblclick,!1))}}}},d.prototype.removeByAnnotationId=function(e){if(r.b._isNumber(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_removeByAnnotationId),n){var a=n.getObjectById(e);a instanceof _.Sprite?n.remove(a):void 0!==a&&(a.userData.domObj.parentNode.removeChild(a.userData.domObj),n.remove(a)),t[Vp._render](),gf(i.b.stringsByLabel.ANNOTATION_LOGGER_finest_removeByAnnotationId)}},d.prototype.setOnTopByAnnotationId=function(e,a){if(r.b._isNumber(e,!0),r.b._isBoolean(a,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setOnTopByAnnotationId),n){var o=n.getObjectById(e);void 0!==o&&o.onTop!==a&&(o.onTop=a,a?o.userData.domObj.style.zIndex=parseInt(t._renderer.domElement.style.zIndex)+1:_updateAnnotation(o))}},d.prototype.getOnTopByAnnotationId=function(e){if(r.b._isNumber(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getOnTopByAnnotationId),n){var t=n.getObjectById(e);if(void 0!==t)return gf(i.b.stringsByLabel.ANNOTATION_LOGGER_finest_getOnTopByAnnotationId),t.onTop}mf(i.b.stringsByLabel.ANNOTATION_LOGGER_warn_getOnTopByAnnotationId)},d.prototype.setVisibilityByAnnotationId=function(e,a){if(pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setVisibilityByAnnotationId),r.b._isNumber(e,!0),r.b._isBoolean(a,!0),n){var o=n.getObjectById(e);void 0!==o&&(o.visible=a,o.userData.domObj.style.display=a?"block":"none"),t[Vp._render](),gf(i.b.stringsByLabel.ANNOTATION_LOGGER_latest_setVisibilityByAnnotationId)}},d.prototype.getVisibilityByAnnotationId=function(e){if(r.b._isNumber(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getVisibilityByAnnotationId),n){var t=n.getObjectById(e);if(void 0!==t)return t.visible}mf(i.b.stringsByLabel.ANNOTATION_LOGGER_warn_getVisibilityByAnnotationId)},d.prototype.setPositionByAnnotationId=function(e,a,o,s){if(r.b._isNumber(e,!0),r.b._isNumber(a,!0),r.b._isNumber(o,!0),r.b._isNumber(s,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setPositionByAnnotationId),n){var l=n.getObjectById(e);void 0!==l&&(l.children[0].geometry.attributes.position.array[0]=a,l.children[0].geometry.attributes.position.array[1]=o,l.children[0].geometry.attributes.position.array[2]=s,l.children[0].geometry.attributes.position.needsUpdate=!0,a>t._modelBBox.max.x&&(t._modelBBox.max.x=a),o>t._modelBBox.max.y&&(t._modelBBox.max.y=o),s>t._modelBBox.max.z&&(t._modelBBox.max.z=s),a<t._modelBBox.min.x&&(t._modelBBox.min.x=a),o<t._modelBBox.min.y&&(t._modelBBox.min.y=o),s<t._modelBBox.min.z&&(t._modelBBox.min.z=s)),t[Vp._render]()}},d.prototype.setAnchorPositionByAnnotationId=function(e,a,o,s){if(r.b._isNumber(e,!0),r.b._isNumber(a,!0),r.b._isNumber(o,!0),r.b._isNumber(s,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setAnchorPositionByAnnotationId),n){var l=n.getObjectById(e);void 0!==l&&(l.children[0].geometry.attributes.position.array[3]=a,l.children[0].geometry.attributes.position.array[4]=o,l.children[0].geometry.attributes.position.array[5]=s,l.children[0].geometry.attributes.position.needsUpdate=!0,a>t._modelBBox.max.x&&(t._modelBBox.max.x=a),o>t._modelBBox.max.y&&(t._modelBBox.max.y=o),s>t._modelBBox.max.z&&(t._modelBBox.max.z=s),a<t._modelBBox.min.x&&(t._modelBBox.min.x=a),o<t._modelBBox.min.y&&(t._modelBBox.min.y=o),s<t._modelBBox.min.z&&(t._modelBBox.min.z=s),l.userData.markerRadius&&l.children[1].position.set(a,o,s)),t[Vp._render]()}},d.prototype.getPositionByAnnotationId=function(e,t){if(r.b._isNumber(e,!0),r.b._isFunction(t,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getPositionByAnnotationId),n){var a=n.getObjectById(e);void 0!==a&&t(a.children[0].geometry.attributes.position.array[0],a.children[0].geometry.attributes.position.array[1],a.children[0].geometry.attributes.position.array[2])}},d.prototype.getAnchorPositionByAnnotationId=function(e,t){if(r.b._isNumber(e,!0),r.b._isFunction(t,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getAnchorPositionByAnnotationId),n){var a=n.getObjectById(e);void 0!==a&&t(a.children[0].geometry.attributes.position.array[3],a.children[0].geometry.attributes.position.array[4],a.children[0].geometry.attributes.position.array[5])}},d.prototype.getContentByAnnotationId=function(e){r.b._isNumber(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getContentByAnnotationId);var t=null;if(n){var a=n.getObjectById(e);void 0!==a&&(t=a.userData.domObj.innerHTML)}return t},d.prototype.setContentByAnnotationId=function(e,t){if(pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getContentByAnnotationId),n){var r=n.getObjectById(e);void 0!==r&&(r.userData.domObj.innerHTML=t)}},d.prototype.setPositionsByAnnotationId=function(e,a,o,s,l,c,u){(r.b._isNumber(e,!0),r.b._isNumber(a,!0),r.b._isNumber(o,!0),r.b._isNumber(s,!0),r.b._isNumber(l,!0),r.b._isNumber(c,!0),r.b._isNumber(u,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setPositionsByAnnotationId),n)&&(void 0!==n.getObjectById(e)&&(this.setPositionByAnnotationId(e,a,o,s),this.setAnchorPositionByAnnotationId(e,l,c,u)),t[Vp._render]())},d.prototype.setAnnotationsOnTop=function(e){if(r.b._isBoolean(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setAnnotationsOnTop),n&&a!==e)if(a=e,e&&null!==n)for(var o=0,s=n.children.length;o<s;++o)n.children[o].userData.domObj.style.zIndex=parseInt(t._renderer.domElement.style.zIndex)+1;else _updateAnnotationObj()},d.prototype.getAnnotationsOnTop=function(){return pf(i.b.stringsByLabel.ANNOTATION_LOGGER_getAnnotationsOnTop),a},d.prototype._postRender=function(){_updateAnnotationObj()},d.prototype.setPositionByAnnotationIdByViewCoordinates=function(e,n,a){r.b._isNumber(e,!0),r.b._isNumber(n,!0),r.b._isNumber(a,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setPositionByAnnotationIdByViewCoordinates);var o=function(r,i,o){var s=new _.Vector3(r,i,o),l=new _.Vector3(n/t._renderer.domElement.width*2-1,-a/t._renderer.domElement.height*2+1,0);l.unproject(t._currentCamera);var c=new je.a(t._currentCamera.position,l.sub(t._currentCamera.position).normalize()),u=t._cameraControls.target.clone().sub(t._currentCamera.position).normalize(),h=(new _.Plane).setFromNormalAndCoplanarPoint(u,s),d=new _.Vector3;c.ray.intersectPlane(h,d),null!==d&&this.setPositionByAnnotationId(e,d.x,d.y,d.z)}.bind(this);this.getPositionByAnnotationId(e,o)},d.prototype.addSprite=function(e,a,o,s,l,c,u){if(r.b._isNumber(e,!0),r.b._isString(a,!0),r.b._isNumber(o,!0),r.b._isNumber(s,!0),r.b._isNumber(l,!0),r.b._isNumber(c,!0),r.b._isNumber(u,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_addSprite),void 0!==e&&null!=e){var h=void 0,d=function(e){if(null!==e){null===n&&((n=new _.Object3D).name="ANNOTATIONS",t._scene._annotationContainer.add(n)),n.add(e),t._scene.addIndexedShape(e);var r=new _.Vector3,i=new _.Quaternion,a=new _.Vector3,c=new _.Vector3(o,s,l);e.matrix.decompose(r,i,a),e.parent.worldToLocal(c),e.matrix.compose(c,i,a),t[Vp._render](),e.name=e.type+":"+e.id,h=e.name}};return e===m.B.IMAGE?function _makeimageSprite(e,t,n,r){(new _.TextureLoader).load(e,function(e){var i=new _.SpriteMaterial({map:e}),a=new ze.Sprite(i);a.matrix.makeScale(t,n,1),r(a)},void 0,function(e){ff("An error happened while loading Image sprite."+e)})}(a,c,u,d):e===m.B.TEXT&&function _makeTextSprite(e,t,n,r){var i,a=document.createElement("canvas"),o=a.getContext("2d");o.font="normal 100px Arial",i=o.measureText(e).width,a.width=i,a.height=100,o.font="normal 100px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="rgba(255, 0, 0, 0.9)",o.fillText(e,i/2,50);var s=new _.Texture(a);s.needsUpdate=!0,s.minFilter=_.LinearFilter;var l=new _.SpriteMaterial({map:s});l.transparent=!0;var c=new ze.Sprite(l);c.matrix.makeScale(t,n,1),r(c)}(a,c,u,d),h}},d.prototype.setOwnerNameByAnnotationId=function(e,t){if(r.b._isNumber(e,!0),r.b._isString(t,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_setOwnerNameByAnnotationId),n){var a=n.getObjectById(e);void 0!==a&&(a.name=t)}},d.prototype.registerAnnotationEvent=function(e){r.b._isFunction(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_registerAnnotationEvent),void 0!==e&&null!==e&&"function"==typeof e&&-1===r.b._eventMapIndex(l,e)&&l.push(e)},d.prototype.unregisterAnnotationEvent=function(e){if(r.b._isFunction(e,!0),pf(i.b.stringsByLabel.ANNOTATION_LOGGER_unregisterAnnotationEvent),void 0!==e&&null!==e&&"function"==typeof e){var t=r.b._eventMapIndex(l,e);-1!==t&&l.splice(t,1)}},d.prototype.clearSelected=function(){if(pf(i.b.stringsByLabel.ANNOTATION_LOGGER_clearSelected),n)for(var e=0;e<n.children.length;e++)"MarkupAnchoredText"===n.children[e].name&&(n.children[e].userData.domObj.childNodes[0].style.backgroundColor="rgb(250, 251, 253)")},d.prototype[vf._fireAnnotationEvent]=function(e,t){for(var n=0,r=l.length;n<r;n++)l[n](e,t)},new d(e)};yf.prototype={constructor:yf,_name:"Annotation"};
// CONCATENATED MODULE: ./staging/Navigator.js
var bf=function(e){var t,n,i,a,o,s,l,c,u={NONE:-1,ROTATE:0,PAN:1,ZOOM:2,SCROLLZOOM:3,ZOOMAREA:4,PANZOOM:5,FITALL:6},h=e,d=new _.Vector3,p=1e-6,f={left:0,top:0,width:0,height:0,widthCenter:0,heightCenter:0},g=u.NONE,v=[],y=null,b=[],x=[],w=[],M=null,E=null,S=!1,L=!1,T={};T[$n.EventTypes.Down]=1/0,T[$n.EventTypes.Move]=1/0,T[$n.EventTypes.Up]=1/0,T[$n.EventTypes.Scroll]=1/0;var A=1e-5,C=Math.PI/180,P=function(){Yn.makeDisposable(this),this.dispose=function dispose(){!function removeEventListeners(){var e=h.inputManager;e&&(e.removeEventListener($n.EventTypes.Down,n),e.removeEventListener($n.EventTypes.Move,a),e.removeEventListener($n.EventTypes.Up,o),e.removeEventListener($n.EventTypes.Scroll,i))}()}.bind(this),this.lastPosition=new _.Vector2,this.name="Navigator",this.rotate={start:new _.Vector3,end:new _.Vector3},this.pan={start:new _.Vector3,end:new _.Vector3},this.zoom={start:new _.Vector3,end:new _.Vector3,startDist:0,stopDist:0},this.zoomarea={start:new _.Vector2,end:new _.Vector2},this.enabled=!0,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,s=h.target.clone(),l=h.camera.position.clone(),c=h.camera.up.clone(),t=this,n=function downInput(e){if(g=u.NONE,t.enabled&&void 0!==e){var n=h.inputManager;n&&(n.addEventListener($n.EventTypes.Move,a),n.addEventListener($n.EventTypes.Up,o));if(void 0!==e.button){var i=void 0,s=void 0;switch(0===e.button&&void 0!==(s=getNavModeAction())&&(i=s),void 0===i&&void 0!==(s=getMaskAction("down",e))&&(i=s),void 0===i&&(i=e.button),i){case u.ROTATE:h.navSettings.rotate.enabled&&(g=u.ROTATE);break;case u.PAN:if(h.navSettings.pan.enabled){g=u.PAN;var l=r.b._getMousePositionAsPercentage(e,h.canvas);this.lastPosition=l}break;case u.ZOOM:h.navSettings.zoom.enabled&&(g=u.ZOOM);break;case u.ZOOMAREA:h.navSettings.zoom.enabled&&(g=u.ZOOMAREA);break;case u.FITALL:h.viewer.fitAll();break;default:g=u.NONE}}else if(void 0!==e.touches&&e.touches.length>0)switch(e.touches.length){case 1:h.navSettings.rotate.enabled&&(g=u.ROTATE);break;case 2:(h.navSettings.pan.enabled||h.navSettings.zoom.enabled)&&(g=u.PANZOOM);break;default:g=u.NONE}g!==u.NONE&&getPtInScene.call(this,"start",e),E=h.camera.position.clone()}}.bind(this),i=function scrollInput(e){if(!1===t.enabled)return;if(h.navSettings.zoom.enabled){getPtInScene.call(this,"start",e);var n=0;e.wheelDelta?n=e.wheelDelta/-40:e.deltaY?n=-e.deltaY/-3:e.detail&&(n=-e.detail/-3),t.zoom.start.y+=.01*n,g=u.SCROLLZOOM,S||(S=!0,_fireCameraChangedEvents(m.b.PRE)),null!==M&&clearTimeout(M),M=setTimeout(cameraChangedEventsTimerCheck,400)}else{var r=h.viewer.getCameraMode();if(r===m.c.PERSPECTIVE){var i=h.navSettings.zoom.speed,a=window.innerWidth,o=window.innerHeight,s=e.clientX/a*2-1,l=-e.clientY/o*2+1,c=new _.Vector3(s,l,1);c.unproject(h.camera),c.sub(h.camera.position).normalize(),c.multiplyScalar(i),e.deltaY>0?(h.camera.position.add(c),h.target.add(c)):(h.camera.position.sub(c),h.target.sub(c))}else if(r===m.c.ORTHOGRAPHIC){var n=0;e.wheelDelta?n=-e.deltaY/4e4*h.navSettings.zoom.speed:e.deltaY&&(n=e.deltaY/3e3*h.navSettings.zoom.speed);var d=h.camera.zoom-n;if(0!==d){var p=e.clientX/h.viewer._renderer.domElement.width*2-1,f=-e.clientY/h.viewer._renderer.domElement.height*2+1,v=new _.Vector3;v.set(p,f,1).unproject(h.camera).sub(h.camera.position).multiplyScalar(n/d),h.camera.position.subVectors(h.camera.position,v),h.target.subVectors(h.target,v),h.camera.zoom=d}}S||(S=!0,_fireCameraChangedEvents(m.b.PRE)),null!==M&&clearTimeout(M),M=setTimeout(cameraChangedEventsTimerCheck,400)}}.bind(this),a=function moveInput(e){if(!1===t.enabled)return;var n=!1,r=void 0;1===e.buttons&&void 0!==(r=getNavModeAction())&&r!==g&&(n=!0);void 0===r&&void 0!==(r=getMaskAction("move",e))&&r!==g&&(n=!0);if(n){var i=h.inputManager;i&&(i.removeEventListener("moveEvent",a),i.removeEventListener("upEvent",o)),g=u.NONE}else S||(S=!0,_fireCameraChangedEvents(m.b.PRE));getPtInScene.call(this,"end",e)}.bind(this),o=function upInput(e){if(!1===t.enabled)return;var n=h.inputManager;n&&(n.removeEventListener("moveEvent",a),n.removeEventListener("upEvent",o));getPtInScene.call(this,"end",e),g===u.ZOOMAREA&&(h.canvas.style.cursor="default",null!==y&&null!==y.parentNode&&(y.parentNode.removeChild(y),y=null),h.viewer.zoomArea(Math.min(t.zoomarea.start.x,t.zoomarea.end.x),Math.min(t.zoomarea.start.y,t.zoomarea.end.y),Math.max(t.zoomarea.start.x,t.zoomarea.end.x),Math.max(t.zoomarea.start.y,t.zoomarea.end.y)));null!==E&&E.distanceToSquared(h.camera.position)>p&&(g!==u.ROTATE&&g!==u.PAN&&g!==u.ZOOM&&g!==u.PANZOOM||(E=null,S=!1,_fireCameraChangedEvents(m.b.POST)));g=u.NONE}.bind(this);var e=h.inputManager;e&&(e.addEventListener($n.EventTypes.Down,n),e.addEventListener($n.EventTypes.Scroll,i))};function _fireCameraChangedEvents(e){for(var t=h.viewer.getCameraInfo(),n={type:m.i.cameraChanged,cameraInfo:t,cameraChange:e},r=0;r<w.length;++r)w[r](t,e);if(e===m.b.POST)for(r=0;r<x.length;++r)x[r](t,e);else if(e===m.b.PRE)for(r=0;r<b.length;++r)b[r](t,e);h.viewer._scene.dispatchEvent(n)}P.prototype={constructor:P},Object.defineProperties(P.prototype,{type:{value:bf,writable:!1,configurable:!1}}),P.prototype.rotateCamera=function(){var n=new _.Vector3,r=new _.Quaternion;return function(){var i=Math.acos(t.rotate.start.dot(t.rotate.end)/t.rotate.start.length()/t.rotate.end.length());if(i){if(n.crossVectors(t.rotate.start,t.rotate.end).normalize(),i*=h.navSettings.rotate.speed,r.setFromAxisAngle(n,-i),d.applyQuaternion(r),!h.navSettings.rotate.aroundTarget){var a=(new _.Vector3).fromArray(h.viewer.getVisibleModelBoundingBoxCenter()),o=(new _.Vector3).subVectors(h.target,a);o.applyQuaternion(r).add(a),h.target.copy(o)}e.camera.up.applyQuaternion(r),t.rotate.end.applyQuaternion(r),r.setFromAxisAngle(n,i*(t.dynamicDampingFactor-1)),t.rotate.start.applyQuaternion(r)}}}(),P.prototype.zoomCamera=function(){if(g===u.PANZOOM){if(0!==t.zoom.stopDist){var e=t.zoom.startDist/t.zoom.stopDist;t.zoom.startDist=t.zoom.stopDist,d.multiplyScalar(e)}}else 1!==(e=1+(t.zoom.end.y-t.zoom.start.y)*h.navSettings.zoom.speed)&&e>0&&(d.multiplyScalar(e),h.navSettings.zoom.enabled&&h.viewer.getCameraMode()===m.c.ORTHOGRAPHIC&&(h.camera.left*=e,h.camera.right*=e,h.camera.top*=e,h.camera.bottom*=e,h.camera.updateProjectionMatrix()),t.zoom.start.y+=(t.zoom.end.y-t.zoom.start.y)*t.dynamicDampingFactor)},P.prototype.panCamera=function(){var e=new _.Vector2,n=new _.Vector3,r=new _.Vector3;return function(){e.copy(t.pan.end).sub(t.pan.start),e.lengthSq()&&(e.multiplyScalar(d.length()*h.navSettings.pan.speed),r.copy(d).cross(h.camera.up).setLength(e.x),r.add(n.copy(h.camera.up).setLength(e.y)),h.camera.position.add(r),h.target.add(r),t.pan.start.add(e.subVectors(t.pan.end,t.pan.start).multiplyScalar(t.dynamicDampingFactor)))}}(),P.prototype.zoomAreaCamera=function(){var e=new _.Vector2,n=new _.Vector3,r=new _.Plane,i=new je.a,a=new _.Vector2,o=new _.Vector2,s=new _.Vector3;a.set(t.zoomarea.start.x/h.viewer._renderer.domElement.width*2-1,-t.zoomarea.start.y/h.viewer._renderer.domElement.height*2+1),o.set(t.zoomarea.end.x/h.viewer._renderer.domElement.width*2-1,-t.zoomarea.end.y/h.viewer._renderer.domElement.height*2+1),s.set(0,0,-1),s.applyEuler(h.camera.rotation),n.set(0,0,-h.camera.near),h.camera.localToWorld(n),r.setFromNormalAndCoplanarPoint(s,n),n.set(0,0,-h.camera.far),h.camera.localToWorld(n),e.set(a.x<o.x?a.x:o.x,a.y>o.y?a.y:o.y),i.setFromCamera(e,h.camera);var l=i.ray.intersectPlane(r);e.set(a.x>o.x?a.x:o.x,a.y>o.y?a.y:o.y),i.setFromCamera(e,h.camera);i.ray.intersectPlane(r);e.set(a.x<o.x?a.x:o.x,a.y<o.y?a.y:o.y),i.setFromCamera(e,h.camera);i.ray.intersectPlane(r);e.set(a.x>o.x?a.x:o.x,a.y<o.y?a.y:o.y),i.setFromCamera(e,h.camera);var c=i.ray.intersectPlane(r),u=new _.Box3;u.min.set(l.x,l.y,l.z),u.max.set(c.x,c.y,c.z);var d=new _.Vector3(-(l.x+c.x)/2,-(l.y+c.y)/2,-(l.z+c.z)/2);u.getCenter(d),h.target.copy(d),h.camera.worldToLocal(d),h.camera.lookAt(h.target),h.viewer._render();var p=h.camera.position.clone();p.sub(h.target);var f=new _.Sphere;u.getBoundingSphere(f);var m=parseInt(h.viewer._renderer.domElement.height);h.viewer._renderer.domElement.width<h.viewer._renderer.domElement.height&&(m=parseInt(h.viewer._renderer.domElement.width));var g=h.viewer.getCameraInfo().perspective.fov*(Math.PI/180),v=Math.abs(t.zoomarea.start.x-t.zoomarea.end.x),y=v;Math.abs(t.zoomarea.start.y-t.zoomarea.end.y)<v&&(y=v);var b=y*f.radius/(m*Math.tan(g/2));p.setLength(b),p.add(h.target),h.camera.position.copy(p)},P.prototype.handleResize=function(){var e={left:0,top:0,width:0,height:0,bottom:0,right:0},t=!1;if(document.body.contains(h.canvas)?(e=h.canvas.getBoundingClientRect())&&(t=!0):0===f.width&&0===f.height&&(t=!0,e={top:h.canvas.offsetTop,width:h.canvas.width,height:h.canvas.height,left:h.canvas.offsetLeft,bottom:e.top+e.height,right:e.left+e.width}),t){var n=h.canvas.ownerDocument.documentElement;f.left=e.left+window.pageXOffset-n.clientLeft,f.top=e.top+window.pageYOffset-n.clientTop,f.width=e.width,f.height=e.height,f.widthCenter=.5*e.width,f.heightCenter=.5*e.height}},P.prototype.preupdate=function(){L=!0,_fireCameraChangedEvents(m.b.PRE)},P.prototype.update=function(){d.subVectors(h.camera.position,h.target),h.navSettings.rotate.enabled&&g===u.ROTATE&&t.rotateCamera(),(h.navSettings.zoom.enabled&&g===u.ZOOM||g===u.SCROLLZOOM||g===u.PANZOOM)&&t.zoomCamera(),g===u.PANZOOM&&t.panCamera(),e.camera.position.addVectors(h.target,d),function checkDistances(){(h.navSettings.zoom.enabled||h.navSettings.pan.enabled)&&(d.lengthSq()>t.maxDistance*t.maxDistance&&h.camera.position.addVectors(h.target,d.setLength(t.maxDistance)),d.lengthSq()<t.minDistance*t.minDistance&&h.camera.position.addVectors(h.target,d.setLength(t.minDistance)))}(),e.camera.lookAt(h.target),h.prevCameraPosition.distanceToSquared(h.camera.position)>p?(h.prevCameraPosition.copy(h.camera.position),g!==u.ROTATE&&g!==u.PAN&&g!==u.ZOOM&&g!==u.PANZOOM&&g!==u.SCROLLZOOM&&(S=!1,L=!1,_fireCameraChangedEvents(m.b.POST))):L&&(L=!1,_fireCameraChangedEvents(m.b.POST))},P.prototype.reset=function(){g=u.NONE,h.target.copy(s),h.camera.position.copy(l),h.camera.up.copy(c),d.subVectors(h.camera.position,h.target),h.camera.lookAt(h.target),h.prevCameraPosition.copy(h.camera.position)},P.prototype.overrideMouseNavigationInput=function(e,t){var n=void 0;switch(e){case m.u.ROTATE:n=u.ROTATE;break;case m.u.PAN:n=u.PAN;break;case m.u.ZOOM:n=u.ZOOM;break;case m.u.ZOOMAREA:n=u.ZOOMAREA;break;case m.u.FITALL:n=u.FITALL}if(void 0!==n){var r=new function(e,t){this.action=e,this.mask=t}(n,t);v.push(r)}},P.prototype.registerCameraChangedEvent=function(e,t){t=r.b._isNumber(t)?t:m.b.POST,r.b._isFunction(e)&&(t===m.b.BOTH?-1===r.b._eventMapIndex(w,e)&&w.push(e):t===m.b.POST?-1===r.b._eventMapIndex(x,e)&&x.push(e):t===m.b.PRE&&-1===r.b._eventMapIndex(b,e)&&b.push(e))},P.prototype.unregisterCameraChangedEvent=function(e,t){if(t=r.b._isNumber(t)?t:m.b.POST,r.b._isFunction(e))if(t===m.b.BOTH)-1!==(n=r.b._eventMapIndex(w,e))&&w.splice(n,1);else if(t===m.b.POST){-1!==(n=r.b._eventMapIndex(x,e))&&x.splice(n,1)}else if(t===m.b.PRE){var n;-1!==(n=r.b._eventMapIndex(b,e))&&b.splice(n,1)}},P.prototype.handleEvent=function(e){r.b._isFunction(this[e.type])&&this[e.type](e)},P.prototype.setEventPriority=function(e,t){var r=h.inputManager;r&&(e===$n.EventTypes.Down?(T[$n.EventTypes.Down]=t,r.updateEventListener($n.EventTypes.Down,n,t)):e===$n.EventTypes.Move?(T[$n.EventTypes.Move]=t,r.updateEventListener($n.EventTypes.Move,a,t)):e===$n.EventTypes.Up?(T[$n.EventTypes.Up]=t,r.updateEventListener($n.EventTypes.Up,o,t)):e===$n.EventTypes.Scroll&&(T[$n.EventTypes.Scroll]=t,r.updateEventListener($n.EventTypes.Scroll,i,t)))},P.prototype.getEventPriority=function(e){var t=void 0;return e===$n.EventTypes.Down?t=T[$n.EventTypes.Down]:e===$n.EventTypes.Move?t=T[$n.EventTypes.Move]:e===$n.EventTypes.Up?t=T[$n.EventTypes.Up]:e===$n.EventTypes.Scroll&&(t=T[$n.EventTypes.Scroll]),t},P.prototype.setMouseEasing=function(e){e>=0&&e<=1&&(this.dynamicDampingFactor=e)},P.prototype.getMouseEasing=function(){return this.dynamicDampingFactor};var I=new _.Vector3,O=new _.Vector3;function translate(e){if(r.b._epsilonIsZero(A,e))return!1;var t=1,n=0,i=0;if(h.viewer.getCameraMode()===m.c.PERSPECTIVE){i=(n=2*Math.tan(h.camera.fov/2*C)*.79)*h.camera.aspect,I=h.target.clone();var a=h.camera.position.clone();t=O.subVectors(I,a).length()}else n=h.camera.top,i=h.camera.right;e.x=e.x*i,e.y=e.y*n;var o=function VPCSToWCSVector(e){var t=new _.Matrix4,n=new _.Matrix4;return t.copy(h.camera.matrixWorldInverse),n.getInverse(t),r.b._vectorMatrixMultiply(e,n),e}.call(this,new _.Vector3(-e.x*t,e.y*t,0));if(r.b._epsilonIsZero(A,o))return!1;h.camera.position.add(o),h.target.add(o)}var B=function(){var e=new _.Vector2;return function(t,n){return e.set((t-f.left)/f.width,(n-f.top)/f.height),e}}(),R=function(){var e=new _.Vector3,t=new _.Vector3,n=new _.Vector3;return function(r,i){n.set((r-f.left-f.widthCenter)/f.widthCenter,(f.top-i+f.heightCenter)/f.heightCenter,0);var a=n.length();return h.navSettings.roll.enabled?a>1?n.normalize():n.z=Math.sqrt(1-a*a):a<Math.SQRT1_2?n.z=Math.sqrt(1-a*a):n.z=.5/a,d.copy(h.camera.position).sub(h.target),e.copy(h.camera.up).setLength(n.y),e.add(t.copy(h.camera.up).cross(d).setLength(n.x)),e.add(d.setLength(n.z)),e}}();function getMaskAction(e,t){if(v.length>0)for(var n=function getEventMask(){var n=0;return"down"===e&&(0===t.button&&(n+=m.v.LMB),1===t.button&&(n+=m.v.MMB),2===t.button&&(n+=m.v.RMB)),"move"===e&&(1===t.buttons&&(n+=m.v.LMB),4===t.buttons&&(n+=m.v.MMB),2===t.buttons&&(n+=m.v.RMB)),!0===t.altKey&&(n+=m.v.ALT),!0===t.ctrlKey&&(n+=m.v.CTRL),!0===t.shiftKey&&(n+=m.v.SHIFT),t.detail>1&&(n+=m.v.DBLCLK),n}(),r=0;r<v.length;++r){var i=v[r];if(n===i.mask)return i.action}}function getNavModeAction(){var e=void 0;switch(h.viewer.getMouseNavigationMode()){case m.t.ROTATE:e=u.ROTATE;break;case m.t.PAN:e=u.PAN;break;case m.t.ZOOM:e=u.ZOOM;break;case m.t.ZOOMAREA:e=u.ZOOMAREA;break;case m.t.CONTEXT:}return e}function cameraChangedEventsTimerCheck(){M=null,g===u.SCROLLZOOM&&(E=null,S=!1,_fireCameraChangedEvents(m.b.POST))}function getContactPts(e){var t=[];return e.touches&&e.touches.length>0?(t[0]={x:e.touches[0].pageX,y:e.touches[0].pageY},e.touches.length>1&&(t[1]={x:e.touches[1].pageX,y:e.touches[1].pageY})):t[0]={x:e.pageX,y:e.pageY},t}function getPtInScene(e,n){if(t.enabled){var i=void 0;if(g===u.ROTATE&&h.navSettings.rotate.enabled){var a=getContactPts(n);i=R(a[0].x,a[0].y),"end"===e?t.rotate.end.copy(i):(t.rotate.start.copy(i),t.rotate.end.copy(t.rotate.start))}else if(g===u.ZOOM&&h.navSettings.zoom.enabled){a=getContactPts(n);i=B(a[0].x,a[0].y),"end"===e?t.zoom.end.copy(i):(t.zoom.start.copy(i),t.zoom.end.copy(t.zoom.start))}else if(g===u.PAN&&h.navSettings.pan.enabled&&"end"===e){var o=r.b._getMousePositionAsPercentage(n,h.canvas);translate.call(this,new _.Vector3(o.x-this.lastPosition.x,o.y-this.lastPosition.y,0)),this.lastPosition=o}else if(g===u.PANZOOM){if((a=getContactPts(n)).length>1){var s=a[0].x-a[1].x,l=a[0].y-a[1].y;if(h.navSettings.pan.enabled){i=t.pan.start,"end"===e&&(i=t.pan.end);var c=(a[0].x+a[1].x)/2,d=(a[0].y+a[1].y)/2;i.copy(B(c,d)),"end"===e?t.pan.end.copy(i):(t.pan.start.copy(i),t.pan.end.copy(t.pan.start))}h.navSettings.zoom.enabled&&(t.zoom.stopDist="end"===e?Math.sqrt(s*s+l*l):t.zoom.startDist=Math.sqrt(s*s+l*l))}}else if(g===u.ZOOMAREA&&h.navSettings.zoom.enabled){a=function getOffsetPts(e){var t=[];return e.touches&&e.touches.length>0?(t[0]={x:e.touches[0].offsetX,y:e.touches[0].offsetY},e.touches.length>1&&(t[1]={x:e.touches[1].offsetX,y:e.touches[1].offsetY})):t[0]={x:e.offsetX,y:e.offsetY},t}(n);if("end"===e)t.zoomarea.end.x=a[0].x,t.zoomarea.end.y=a[0].y,null!==y&&(y.style.width=Math.abs(t.zoomarea.end.x-t.zoomarea.start.x)+"px",y.style.height=Math.abs(t.zoomarea.end.y-t.zoomarea.start.y)+"px",y.style.left=t.zoomarea.end.x-t.zoomarea.start.x<0?t.zoomarea.end.x+"px":t.zoomarea.start.x+"px",y.style.top=t.zoomarea.end.y-t.zoomarea.start.y<0?t.zoomarea.end.y+"px":t.zoomarea.start.y+"px");else{t.zoomarea.start.x=a[0].x,t.zoomarea.start.y=a[0].y,t.zoomarea.end.x=t.zoomarea.start.x,t.zoomarea.end.y=t.zoomarea.start.y;var p=document.getElementById("zoomareaRectangle");p?y=p:((y=document.createElement("div")).className="zoomareaRectangle",y.style.left=t.zoomarea.end.x+"px",y.style.top=t.zoomarea.end.y+"px",y.style.border="1px solid #FF0000",y.style.position="absolute",y.style.zIndex="99",y.style.pointerEvents="none"),h.viewer._renderer.domElement.parentElement.appendChild(y),h.canvas.style.cursor="crosshair"}}}}var G=new P;return G.handleResize(),G.update(),G};bf.prototype={constructor:bf,_name:"Navigator",initialize:function(e){return new bf(e)}},Yn.makeContributableObject(bf.prototype,"NavigationManager",yp);/* harmony default export */var xf=bf,_f=o()("PLMVisWeb:debug:Properties"),wf=o()("PLMVisWeb:warning:Properties"),Mf=o()("PLMVisWeb:verbose:Properties"),Ef=function(e){var t=null,n=function(e){t=e._parent};function _getObject(e){var n=t.isExtensionLoaded(xt)?t.getExtensionManager(xt):null,r=t._modelObject.getObjectByPsId(e);return!r&&n&&n._pmiObject&&(r=n._pmiObject.getObjectByPsId(e)),r}return(n.prototype={constructor:n}).loadProperties=function(e,n){var a;r.b._isString(e,!0),r.b._optionalArgCheck(n,r.b._isFunction),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_loadProperties),n=n||function(){};var o=t._modelObject.getObjectByPsId(e);o&&o.baseRef?a=o.baseRef:n(!1,0);var s=e.split(":")[0],l=a+"plm_properties.json",c=new XMLHttpRequest;c.open("GET",l),c.responseType="text",c.onload=function(){if(void 0!==c.response)if(null==c.response||0===c.response.length||200!==c.status&&0!==c.status)wf(i.b.stringsByLabel.GENERAL_CONSOLE_warn_FailedRequest),n(!1,0);else{var e=JSON.parse(c.response).properties;c=null;var t=function _loadPropertiesHelper(e,t){for(var n=0,r=0;r<t.length;r++){var i=e+":"+t[r].psId.toString(),a=_getObject(i);a&&(a instanceof ce||a instanceof ze.Assembly||a instanceof ze.Container||a instanceof st)&&(a.userData.plmProperties=t[r].values,n++)}return n}(s,e);n(!0,t)}else wf(i.b.stringsByLabel.GENERAL_CONSOLE_warn_FailedResponse),n(!1,0)},c.onerror=function(){Mf(i.b.stringsByLabel.PROPERTIES_LOGGER_warn_loadProperties),error(i.b.stringsByLabel.GENERAL_CONSOLE_err_FailedToRetrieve+l),n(!1,0)},c.send(null)},n.prototype.getProperties=function(e,t){r.b._isString(e,!0),r.b._optionalArgCheck(t,r.b._isBoolean),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_getProperties),t=!!r.b._isBoolean(t)&&t;var n=_getObject(e);if(r.b._notNullOrUndefined(n)){if("Edge"===n.type||"FaceShape"===n.type||"Vertex"===n.type){var a={psId:n.userData.psId,type:n.type};return r.b._notNullOrUndefined(n.userData.plmProperties)&&(a.properties=n.userData.plmProperties),a}return function _getPropertiesHelper(e,t){if(e&&(e instanceof ce||e instanceof ze.Assembly||e instanceof ze.Container||e instanceof st)){var n={psId:e.userData.psId,name:e.name},i=[];if(t=null!=t&&t,r.b._notNullOrUndefined(e.userData.plmProperties)&&(n.properties=e.userData.plmProperties),t&&void 0!==e.children&&e.children.length>0){for(var a=e.children.length,o=0;o<a;o++){var s=_getPropertiesHelper(e.children[o],t);r.b._isObjectEmpty(s)||i.push(s)}r.b._isObjectEmpty(s)||(n.children=i)}return n}}(n,t)}},n.prototype.getProperty=function(e,t){r.b._isString(e,!0),r.b._isString(t,!0),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_getProperty);var n=_getObject(e),a=null;return r.b._notNullOrUndefined(n.userData.plmProperties)&&(a=n.userData.plmProperties[t]),a},n.prototype.loadAllProperties=function(e){r.b._optionalArgCheck(e,r.b._isFunction),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_loadAllProperties),e=e||function(){};var n=t._modelObject,a=n.children.length,o=0,s=0,l=function(t,n){o+=n,++s===a&&e(t,o)};if(void 0!==n.children&&n.children.length>0){a=n.children.length;for(var c=0;c<a;++c)this.loadProperties(n.children[c].userData.psId,l)}},n.prototype.addProperty=function(e,t,n){r.b._isString(e,!0),r.b._isString(t,!0),r.b._notNullOrUndefined(n,!0),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_addProperty);var a=_getObject(e);r.b._notNullOrUndefined(a)&&(r.b._isNullOrUndefined(a.userData.plmProperties)&&(a.userData.plmProperties={}),a.userData.plmProperties[t]=n)},n.prototype.addProperties=function(e,t){r.b._isString(e,!0),r.b._isObject(t,!0),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_addProperties);var n=_getObject(e);if(r.b._notNullOrUndefined(n))for(var a in r.b._isNullOrUndefined(n.userData.plmProperties)&&(n.userData.plmProperties={}),t)n.userData.plmProperties[a]=t[a]},n.prototype.removeProperty=function(e,t){r.b._isString(e,!0),r.b._isString(t,!0),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_removeProperty);var n=_getObject(e);r.b._notNullOrUndefined(n.userData.plmProperties)&&(delete n.userData.plmProperties[t],0===Object.keys(n.userData.plmProperties).length&&delete n.userData.plmProperties)},n.prototype.removeAllProperties=function(e){r.b._isString(e,!0),_f(i.b.stringsByLabel.PROPERTIES_LOGGER_removeAllProperties);var t=_getObject(e);r.b._notNullOrUndefined(t.userData.plmProperties)&&delete t.userData.plmProperties},new n(e)};
// CONCATENATED MODULE: ./staging/Properties.js
Ef.prototype={constructor:Ef,_name:"Properties"};/* harmony default export */var Sf=Ef;
// CONCATENATED MODULE: ./staging/index.js
/* harmony export (binding) */n.d(t,"InstancedLineBufferGeometry",function(){return Lf}),
/* harmony export (binding) */n.d(t,"InstancedMeshBufferGeometry",function(){return Tf}),
/* harmony export (binding) */n.d(t,"InstancedVertexColorBufferGeometry",function(){return Af}),
/* harmony export (binding) */n.d(t,"Container",function(){return Cf}),
/* concated harmony reexport */n.d(t,"PLMVisWeb",function(){return f}),
/* concated harmony reexport */n.d(t,"Control",function(){return Wp}),
/* concated harmony reexport */n.d(t,"Viewer",function(){return Np}),
/* concated harmony reexport */n.d(t,"InputManager",function(){return $n}),
/* concated harmony reexport */n.d(t,"Dimension",function(){return Ci}),
/* concated harmony reexport */n.d(t,"AugmentedReality",function(){return Yp}),
/* concated harmony reexport */n.d(t,"CullingLegacy",function(){return Ja}),
/* concated harmony reexport */n.d(t,"Culling",function(){return Xa}),
/* concated harmony reexport */n.d(t,"PMI",function(){return xt}),
/* concated harmony reexport */n.d(t,"CacheLoaderExtension",function(){return wa}),
/* concated harmony reexport */n.d(t,"AsyncObjectLoader",function(){return fo}),
/* concated harmony reexport */n.d(t,"Annotation",function(){return yf}),
/* concated harmony reexport */n.d(t,"Section",function(){return $i}),
/* concated harmony reexport */n.d(t,"Shapes",function(){return _p}),
/* concated harmony reexport */n.d(t,"Measurement",function(){return Hn}),
/* concated harmony reexport */n.d(t,"Markup",function(){return df}),
/* concated harmony reexport */n.d(t,"Properties",function(){return Sf}),
/* concated harmony reexport */n.d(t,"setLicenseKey",function(){return setLicenseKey}),
/* concated harmony reexport */n.d(t,"checkLicense",function(){return checkLicense}),
/* concated harmony reexport */n.d(t,"VERSION",function(){return p}),
/* concated harmony reexport */n.d(t,"PRODUCT",function(){return ut}),
/* concated harmony reexport */n.d(t,"COPYRIGHT",function(){return ht}),
/* concated harmony reexport */n.d(t,"SpriteType",function(){return m.B}),
/* concated harmony reexport */n.d(t,"Layer",function(){return m.k}),
/* concated harmony reexport */n.d(t,"MeasurementType",function(){return m.s}),
/* concated harmony reexport */n.d(t,"MeasurementMode",function(){return m.p}),
/* concated harmony reexport */n.d(t,"MeasurementModeString",function(){return m.q}),
/* concated harmony reexport */n.d(t,"PMINodeEvents",function(){return m.w}),
/* concated harmony reexport */n.d(t,"Units",function(){return m.E}),
/* concated harmony reexport */n.d(t,"UnitsString",function(){return m.F}),
/* concated harmony reexport */n.d(t,"ShapeTypes",function(){return m.A}),
/* concated harmony reexport */n.d(t,"SectionSide",function(){return m.z}),
/* concated harmony reexport */n.d(t,"ExplodeMode",function(){return m.j}),
/* concated harmony reexport */n.d(t,"CameraMode",function(){return m.c}),
/* concated harmony reexport */n.d(t,"CameraChange",function(){return m.b}),
/* concated harmony reexport */n.d(t,"MouseMode",function(){return m.t}),
/* concated harmony reexport */n.d(t,"PickingMode",function(){return m.x}),
/* concated harmony reexport */n.d(t,"MeasurementOptions",function(){return m.r}),
/* concated harmony reexport */n.d(t,"PsIdType",function(){return m.y}),
/* concated harmony reexport */n.d(t,"MaterialType",function(){return m.o}),
/* concated harmony reexport */n.d(t,"EdgeType",function(){return m.g}),
/* concated harmony reexport */n.d(t,"EventTypes",function(){return m.i}),
/* concated harmony reexport */n.d(t,"StandardViewType",function(){return m.C}),
/* concated harmony reexport */n.d(t,"ClippingSide",function(){return m.d}),
/* concated harmony reexport */n.d(t,"TriState",function(){return m.D}),
/* concated harmony reexport */n.d(t,"AttributeFlag",function(){return m.a}),
/* concated harmony reexport */n.d(t,"NavigationAction",function(){return m.u}),
/* concated harmony reexport */n.d(t,"NavigationMask",function(){return m.v}),
/* concated harmony reexport */n.d(t,"MarkupMode",function(){return m.l}),
/* concated harmony reexport */n.d(t,"MarkupProperty",function(){return m.m}),
/* concated harmony reexport */n.d(t,"MarkupState",function(){return m.n}),
/* concated harmony reexport */n.d(t,"EventConsumer",function(){return m.h}),
/* concated harmony reexport */n.d(t,"ClassFactory",function(){return Yn}),
/* concated harmony reexport */n.d(t,"Snapshot",function(){return ft}),
/* concated harmony reexport */n.d(t,"NavigationManager",function(){return yp}),
/* concated harmony reexport */n.d(t,"DimensionControlPointType",function(){return br}),
/* concated harmony reexport */n.d(t,"DimensionComponentType",function(){return xr}),
/* concated harmony reexport */n.d(t,"DimensionSide",function(){return _r}),
/* concated harmony reexport */n.d(t,"DimensionLineType",function(){return wr}),
/* concated harmony reexport */n.d(t,"TextAlign",function(){return Mr}),
/* concated harmony reexport */n.d(t,"TextOrientation",function(){return Er}),
/* concated harmony reexport */n.d(t,"SceneLoader",function(){return Ra}),
/* concated harmony reexport */n.d(t,"Utilities",function(){return r.a}),
/* concated harmony reexport */n.d(t,"HashMap",function(){return ke.b}),
/* concated harmony reexport */n.d(t,"Raycaster",function(){return je.a}),
/* concated harmony reexport */n.d(t,"WCSTrihedron",function(){return mp}),
/* concated harmony reexport */n.d(t,"DMEnvMapBlending",function(){return He.a}),
/* concated harmony reexport */n.d(t,"THREE",function(){return _}),
/* concated harmony reexport */n.d(t,"CullingLayer",function(){return m.e}),f.setLicenseKey=setLicenseKey,f.checkLicense=checkLicense,f.VERSION=p,f.PRODUCT=ut,f.COPYRIGHT=ht,f.InputManager=$n,f.Dimension=Ci,f.AugmentedReality=Yp,f.CullingLegacy=Ja,f.Culling=Xa,f.Properties=Sf,console.log([ut,p,ht].join(" ")),f.SpriteType=m.B,f.Layer=m.k,f.MeasurementType=m.s,f.MeasurementMode=m.p,f.MeasurementModeString=m.q,f.PMINodeEvents=m.w,f.Units=m.E,f.UnitsString=m.F,f.ShapeTypes=m.A,f.SectionSide=m.z,f.ExplodeMode=m.j,f.CameraMode=m.c,f.CameraChange=m.b,f.MouseMode=m.t,f.PickingMode=m.x,f.MeasurementOptions=m.r,f.PsIdType=m.y,f.MaterialType=m.o,f.EdgeType=m.g,f.EventTypes=m.i,f.StandardViewType=m.C,f.ClippingSide=m.d,f.TriState=m.D,f.AttributeFlag=m.a,f.NavigationAction=m.u,f.NavigationMask=m.v,f.MarkupMode=m.l,f.MarkupProperty=m.m,f.MarkupState=m.n,f.EventConsumer=m.h,f.ClassFactory=Yn,f.Snapshot=ft,f.Shapes=_p,f.NavigationManager=yp,f.Navigator=xf,f.DimensionControlPointType=br,f.DimensionComponentType=xr,f.DimensionSide=_r,f.DimensionLineType=wr,f.TextAlign=Mr,f.TextOrientation=Er,f.Utilities=r.a,f.HashMap=ke.b,f.Raycaster=je.a,f.SceneLoader=Ra,f.DMEnvMapBlending=He.a;var Lf=ze.InstancedLineBufferGeometry,Tf=ze.InstancedMeshBufferGeometry,Af=ze.InstancedVertexColorBufferGeometry;f.InstancedLineBufferGeometry=Lf,f.InstancedMeshBufferGeometry=Tf,f.InstancedVertexColorBufferGeometry=Af;var Cf=ze.Container;f.Container=Cf,f.CullingLayer=m.e,f.THREE=_},
/* 142 */
/***/function(e,t){var n;
// This works in non-strict mode
n=function(){return this}();try{
// This works if eval is allowed (see CSP)
n=n||Function("return this")()||(0,eval)("this")}catch(e){
// This works if the window reference is available
"object"==typeof window&&(n=window)}
// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}
e.exports=n},
/* 143 */
/***/function(e,t){
/**
 * Helpers.
 */
var n=1e3,r=60*n,i=60*r,a=24*i,o=7*a,s=365.25*a;
/**
 * Pluralization helper.
 */
function plural(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}
/***/
/**
 * Parse or format the given `val`.
 *
 * Options:
 *
 *  - `long` verbose formatting [false]
 *
 * @param {String|Number} val
 * @param {Object} [options]
 * @throws {Error} throw an error if val is not a non-empty string or a number
 * @return {String|Number}
 * @api public
 */
e.exports=function(e,t){t=t||{};var l=typeof e;if("string"===l&&e.length>0)
/**
 * Parse the given `str` and return milliseconds.
 *
 * @param {String} str
 * @return {Number}
 * @api private
 */
return function parse(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var l=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*a;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}
/**
 * Short format for `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api private
 */(e);if("number"===l&&!1===isNaN(e))return t.long?
/**
 * Long format for `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api private
 */
function fmtLong(e){var t=Math.abs(e);if(t>=a)return plural(e,t,a,"day");if(t>=i)return plural(e,t,i,"hour");if(t>=r)return plural(e,t,r,"minute");if(t>=n)return plural(e,t,n,"second");return e+" ms"}(e):function fmtShort(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+"d";if(t>=i)return Math.round(e/i)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},
/* 144 */
/***/function(e,t,n){e.exports=
/**
 * This is the common logic for both the Node.js and web browser
 * implementations of `debug()`.
 */
function setup(e){
/**
    * Selects a color for a debug namespace
    * @param {String} namespace The namespace string for the for the debug instance to be colored
    * @return {Number|String} An ANSI color code for the given namespace
    * @api private
    */
function selectColor(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return createDebug.colors[Math.abs(t)%createDebug.colors.length]}
/**
    * Create a debugger with the given `namespace`.
    *
    * @param {String} namespace
    * @return {Function}
    * @api public
    */
function createDebug(e){let t;function debug(...e){
// Disabled?
if(!debug.enabled)return;const n=debug,r=Number(new Date),i=r-(t||r);
// Set `diff` timestamp
n.diff=i,n.prev=t,n.curr=r,t=r,e[0]=createDebug.coerce(e[0]),"string"!=typeof e[0]&&
// Anything else let's inspect with %O
e.unshift("%O");
// Apply any `formatters` transformations
let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,r)=>{
// If we encounter an escaped % then don't increase the array index
if("%%"===t)return t;a++;const i=createDebug.formatters[r];if("function"==typeof i){const r=e[a];t=i.call(n,r),
// Now we need to remove `args[index]` since it's inlined in the `format`
e.splice(a,1),a--}return t}),
// Apply env-specific formatting (colors, etc.)
createDebug.formatArgs.call(n,e),(n.log||createDebug.log).apply(n,e)}return debug.namespace=e,debug.enabled=createDebug.enabled(e),debug.useColors=createDebug.useColors(),debug.color=selectColor(e),debug.destroy=destroy,debug.extend=extend,
// Debug.formatArgs = formatArgs;
// debug.rawLog = rawLog;
// env-specific initialization logic for debug instances
"function"==typeof createDebug.init&&createDebug.init(debug),createDebug.instances.push(debug),debug}function destroy(){const e=createDebug.instances.indexOf(this);return-1!==e&&(createDebug.instances.splice(e,1),!0)}function extend(e,t){return createDebug(this.namespace+(void 0===t?":":t)+e)}
/**
    * Enables a debug mode by namespaces. This can include modes
    * separated by a colon and wildcards.
    *
    * @param {String} namespaces
    * @api public
    */
/**
    * Convert regexp to namespace
    *
    * @param {RegExp} regxep
    * @return {String} namespace
    * @api private
    */
function toNamespace(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}
/**
    * Coerce `val`.
    *
    * @param {Mixed} val
    * @return {Mixed}
    * @api private
    */return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(e){return e instanceof Error?e.stack||e.message:e},createDebug.disable=
/**
    * Disable debug output.
    *
    * @return {String} namespaces
    * @api public
    */
function disable(){const e=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(e=>"-"+e)].join(",");return createDebug.enable(""),e}
/**
    * Returns true if the given mode name is enabled, false otherwise.
    *
    * @param {String} name
    * @return {Boolean}
    * @api public
    */,createDebug.enable=function enable(e){let t;createDebug.save(e),createDebug.names=[],createDebug.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+e.substr(1)+"$")):createDebug.names.push(new RegExp("^"+e+"$")));for(t=0;t<createDebug.instances.length;t++){const e=createDebug.instances[t];e.enabled=createDebug.enabled(e.namespace)}},createDebug.enabled=function enabled(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=createDebug.skips.length;t<n;t++)if(createDebug.skips[t].test(e))return!1;for(t=0,n=createDebug.names.length;t<n;t++)if(createDebug.names[t].test(e))return!0;return!1},createDebug.humanize=n(143),Object.keys(e).forEach(t=>{createDebug[t]=e[t]}),
/**
    * Active `debug` instances.
    */
createDebug.instances=[],
/**
    * The currently active debug mode names, and names to skip.
    */
createDebug.names=[],createDebug.skips=[],
/**
    * Map of special "%n" handling functions, for the debug "format" argument.
    *
    * Valid key names are a single, lower or upper-case letter, i.e. "n" and "N".
    */
createDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}},
/* 145 */
/***/function(e,t){
// shim for using process in browser
var n,r,i=e.exports={};
// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)
//normal enviroments in sane situations
return setTimeout(e,0);
// if setTimeout wasn't available but was latter defined
if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{
// when when somebody has screwed with setTimeout but no I.E. maddness
return n(e,0)}catch(t){try{
// When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
return n.call(null,e,0)}catch(t){
// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{r="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){r=defaultClearTimeout}}();var a,o=[],s=!1,l=-1;function cleanUpNextTick(){s&&a&&(s=!1,a.length?o=a.concat(o):l=-1,o.length&&drainQueue())}function drainQueue(){if(!s){var e=runTimeout(cleanUpNextTick);s=!0;for(var t=o.length;t;){for(a=o,o=[];++l<t;)a&&a[l].run();l=-1,t=o.length}a=null,s=!1,function runClearTimeout(e){if(r===clearTimeout)
//normal enviroments in sane situations
return clearTimeout(e);
// if clearTimeout wasn't available but was latter defined
if((r===defaultClearTimeout||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{
// when when somebody has screwed with setTimeout but no I.E. maddness
return r(e)}catch(t){try{
// When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
return r.call(null,e)}catch(t){
// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
// Some versions of I.E. have different rules for clearTimeout vs setTimeout
return r.call(this,e)}}}(e)}}
// v8 likes predictible objects
function Item(e,t){this.fun=e,this.array=t}function noop(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new Item(e,t)),1!==o.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",// empty string to avoid regexp issues
i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}
/******/])});
//# sourceMappingURL=plmvisweb.min.js.map
